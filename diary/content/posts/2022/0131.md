---
title: "ヘルスチェックのレスポンスのステータスコード"
date: "2022-01-31T07:29:38+09:00"
dates: [2022/01]
cover: ""
tags: [kubernetes]
showFullContent: true
---

1時に寝て6時に起きた。

## 404 のレスポンスをヘルスチェック

ここ数日はお仕事でインフラ周りの調査をしていた。たまたまログをみていて、ELB のヘルスチェックが 404 になっているのを大量にみつけた。てっきりヘルスチェックを使ってないのだろうと思ってインフラ担当者に問い合わせたら、404 が返ってくることをヘルスチェックしているという。404 をチェックすることになんの意味もなく、ただ急ぎで設定する必要があったからとりあえず動かせるためにそう設定したという。一方でアプリケーション側は spring boot で開発していて、[Spring Boot Actuator](https://www.baeldung.com/spring-boot-actuators) も導入されているので `/actuator/health` にアクセスすれば 200 が返ってくるようになっている。どういう経緯だったかはわからないけど、開発者に一言聞けば 404 のレスポンスをヘルスチェックすることは何もない状態でずっと運用されていたことがわかった。

アプリケーション側の [Kubernetes: Ingress](https://kubernetes.io/docs/concepts/services-networking/ingress/) のマニフェストにもそういった設定が入っていて、インフラ側の CDK のコードにもそういったマニフェストがあって、両方の設定変更が必要なのか、アプリケーション側のものだけでいいのか、少し調査が必要ということになった。私も Ingress というのがなにものなのか、よくわかってないので調べて理解する機会としよう。
