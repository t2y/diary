---
title: "無障害インフラ移行"
date: "2022-07-27T08:16:42+09:00"
dates: [2022/07]
cover: ""
tags: [infrastructure]
showFullContent: true
---

0時に寝て6時に起きた。

## 本番環境リリースのサポート

[サービスイン]({{< ref "posts/2022/0719.md#2つ目のサービスイン" >}}) のバタバタによって毎週の定例リリースを先週はやらなかった。そのため、今回は2週間分の変更をまとめてリリースすることになった。インフラの変更が複数あったので私も万全の準備をして作業に備えた。

* [waf を使ったメンテナンス切り替えの導入]({{< ref "posts/2022/0725.md#waf-のカスタムレスポンス" >}})
* [k8s のノードグループと nodeSelector の導入]({{< ref "posts/2022/0720.md" >}})

他にもいくつか本番のマスターデータの更新など、箇条書きにした作業項目は15個になった。今回はインフラとアプリケーションが相互に依存する変更を加えているので意図した順番で作業しないといけない。ノードグループ導入による k8s の作業内容は wiki にすべて作業方法を書いていたのでその通りに作業してもらった。メンテナンスモードに切り替える初動もうまくいったので現場の運用担当者が間違って使うこともない。意図した作業内容と順番でうまくリリース作業もできた。メンテナンス時間を2時間もらっていて、宿泊業だとその時間帯が12-14時になる。宿泊客のチェックアウト後、チェックイン前の空き時間だ。メンテナンス後に運用担当者にすぐ確認もしてもらえるし、リリース作業の時間帯としては深夜早朝にしなくてよいのは助かる。私が想定した通りに作業は進み、1時間でリリース作業を終えた。障害も一切なかった。インフラ担当者は想定外の障害に備えて、切り戻しやリスク管理をする。まったく問題なく想定内だったので晴れ晴れしい気持ちになった。こういう気持ちはインフラ担当者にしかわからないと思う。
