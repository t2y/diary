---
title: "フロントエンドのビルドツールと vite"
date: "2023-11-17T11:13:20+09:00"
dates: [2023/11]
cover: ""
tags: [vite, svelte]
showFullContent: true
---

22時に寝て0時に起きて2時間ほどネットで遊んで寝て5時に起きて7時に起きた。

## svelte/kit と vite

水曜日から [vite](https://vitejs.dev/) の機能や振る舞いについて調べている。厳密には svelte/kit (svelte と svelte kit の両方を指している) はどうやって `.svelte` ファイルや他のソースコードをコンパイルしているのかを調べ始めた。kit のコードを調べても svelte のコンパイルをしているようにはみえない。vite.config.ts には次のように kit が提供しているプラグインを使っているようにみえる。

```typescript
import { sveltekit } from '@sveltejs/kit/vite';

...

export default defineConfig({
	plugins: [sveltekit()]
});
```

このコードを追っていくと、次のように [vite-plugin-svelte](https://github.com/sveltejs/vite-plugin-svelte) からプラグインを設定するコードがある。

```typescript
import { svelte } from '@sveltejs/vite-plugin-svelte';
...
export async function sveltekit() {
    ...
    return [...svelte(vite_plugin_svelte_options), ...kit({ svelte_config })];
}
```

vite-plugin-svelte のコードを調べていくと、[load や transform といったフックポイント](https://vitejs.dev/guide/api-plugin.html#universal-hooks) に svelte のコンパイラを呼び出すコードがみえてくるようになる。

```javascript
compileData = await compileSvelte(svelteRequest, code, options);
```

svelte のコンパイルは vite の仕組みを使って vite-plugin-svelte に実装されている。それなら vite はどうやってフレームワークのコンパイルを実現しているのだろうか？という疑問に行き着く。その背景を調べたり、ドキュメントを読んだり、実際にサンプルコードを動かしながら検証したりをこの3日間やっていた。自分なりの仮説はできたけれど、本当にその仮説のような振る舞いをしているかの実証がまだできていない。週末に余裕があれば、それをやっていきたい。
