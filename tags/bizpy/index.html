<!doctype html><html lang=en><head><title>bizpy :: forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/tags/bizpy/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="bizpy"><meta property="og:description" content><meta property="og:url" content="/diary/tags/bizpy/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/tags/bizpy/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><h1>Posts for: #bizpy</h1><div class=posts><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0122/>バーで会食</a></h1><div class=post-meta><time class=post-date>2022-01-22</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;</span><div class=post-content><p>4時に寝て10時に起きた。昨日は体調悪くて夕方仮眠して、体調よくなった22時頃から作業を再開したので3時ぐらいまでやってた。</p><h2 id=ストレッチ>ストレッチ</h2><p>今週もあまりストレッチができなかったものの、今日の開脚幅は開始前172cmで、ストレッチ後170cmだった。特別なことは何もしてないのだけど、数値がよくなった。開脚の仕方によって3cmぐらいは変わってきたりするのかな。開始前に測ったときに172cmになった理由もよくわからなかった。太もも後ろの張りは先週よりよくなっていたものの、腰の疲労は溜まっていて毎週毎週コンディションが違うなというのを実感する。</p><h2 id=会員制バーでふりかえり>会員制バーでふりかえり</h2><p>先日 <a href=/diary/posts/2022/0118/#会員制バー予約>予約した会員制バー</a> へ行ってきた。バーとか連れられてしか行ったことないので慣れる意図もある。<a href=/diary/posts/2022/0119/#bizpy-勉強会>bizpy の機械学習勉強会</a> のふりかえりも兼ねてわたなべさんと行ってきた。ビジネスパーソンという対象者の属性や前提知識などを確認したり、コンテンツの細分化や進め方、次回の予定など幅広くわいわいやってた。</p><p>バーについては思ったより店内は広くて10席ほどのカウンターのみだけど、幅広の椅子が置かれているのでパーソナルスペースが広くてゆったり過ごせる空間な気がした。19時に行ったら他のお客さんは誰もいなくて21時までいて誰も他のお客さんは来なかった。貸し切りみたいな感じだった。オミクロン株が流行も関係しているのだろう。うちらにしたら他のお客さんがいないから感染リスクが減ってよかったと思う。コース料理を頼んでいた。一品一品凝った感じの料理で接待にはちょうどよい。普通の晩ご飯に食べるにはお洒落過ぎて私には無用のものだと思う。量がたくさんあるわけでもないけど、1品ずつ出てきて2時間かけて食べるので割とお腹はいっぱいになって満足した。それなりの値段もするので当然おいしかった。</p><p><figure><img src=/diary/img/2022/0122_dish1.jpg></figure><figure><img src=/diary/img/2022/0122_dish2.jpg></figure></p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0119/>最初のフォロワー</a></h1><div class=post-meta><time class=post-date>2022-01-19</time></div><span class=post-tags>#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
#<a href=/diary/tags/machine-learning/>machine learning</a>&nbsp;</span><div class=post-content><p>0時に寝て4時に起きた。1時間ほどだらだらして1時間ほどドラクエタクトして6時半にバッチの初動監視をしてた。</p><h2 id=bizpy-勉強会>bizpy 勉強会</h2><p><a href=https://bizpy.connpass.com/event/234387/>Python で機械学習をやってみる勉強会</a> を開催した。わたなべさんに講師を務めていただいた。スタッフが2人いると、1人は勉強会が円滑にまわるようにサポートに注力できる。1人だと、講師として説明するのに精一杯で質問を拾い上げたり、わかりにくい説明を補足したりするといったことがリソース制約上できない。今回は私がサポート役だったので随時、質問をしたりしていた。</p><p>今回の勉強会は質問がたくさん出た。いつもは1-2人が数個といった回数なのに、今回は5-6人から十数個の質問がでて、口頭でもいくつものやり取りが発生した。あとで振り返って考えると、おそらくこれは私が質問をぽんぽんしていたからだと考えられる。</p><p>TED に <a href=https://sites.google.com/site/tedjapaneseenglishnote/list/derek_sivers_how_to_start_a_movement>デレク・シヴァーズ 「社会運動はどうやって起こすか」</a> がある。最初のフォロワーが重要という話が出てくる。静かな勉強会で最初に質問するのは勇気がいる。質問して他の人の邪魔にならないか？講師から質問を嫌がられないか？質問が的外れだったら恥をかかないか？など、最初に質問する人が躊躇する理由はたくさんある。私が簡単な質問や的はずれな質問、講義をぽんぽん止めているのをみているうちに、そういうことをやっても大丈夫な勉強会であることが参加者へ自然と伝わる。その結果として参加者から多くの質問が出るような勉強会になったのではないかと考えられる。</p><p>質問が多くでる=コミュニケーションが活発だとコミュニティの価値も上がると思う。今後もサポート体制のようなものはうまく仕組み化して勉強会に取り入れていきたい。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2021/1218/>スクラム本を読了</a></h1><div class=post-meta><time class=post-date>2021-12-18</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;</span><div class=post-content><p>0時に寝て6時に起きてだらだらしてて8時に起き上がった。</p><h2 id=ストレッチ>ストレッチ</h2><p>今週もお仕事に注力してた。ストレッチは2-3日/週かな。普通ぐらいの頻度。夜は寒くなって外に出掛けるのが億劫で1日ウォーキングしたかなぐらい。今日の開脚幅は開始前169cmで、ストレッチ後170cmで、久しぶりに170cm台に戻した。いい感じ。右股関節の不可動領域がよくなっているのが実感できるようになってきているので調子はよさそう。今日は全体的に右半身 (太もも後ろ、腰、大胸筋) と張りがあって疲労もやや溜まってそうに思えた。基本的に週末もなにかしら作業していて疲労が蓄積していないのは毎週のストレッチの効果も大きいと考えている。</p><h2 id=次の-bizpy-勉強会>次の bizpy 勉強会</h2><p>1月の bizpy 勉強会のイベント、<a href=https://bizpy.connpass.com/event/234387/>Python で機械学習をやってみる勉強会</a> を公開した。次回はわたなべさんに講師をやってもらう。このイベントページも作っていただいた。運営が2人になったのでお互いの忙しいときは分担しながらコミュニティを運営していける。本当にありがたい。わたなべさんが担当している間に私も次のネタの下調べや仕込みをする余裕がもてる。メタバースの勉強会やってもいいなとは考えているけど、私だけではコンテンツが弱くて、よそから詳しい人を招いてこないといけない。どうしたものか。</p><h2 id=アジャイル開発とスクラム-第2版>アジャイル開発とスクラム 第2版</h2><p>読了した。全12章の後にもコラムと対談があって、この内容も読み応えがあっていくつも示唆を与えられるものだった。</p><ul><li>コラム 野中理論とスクラム</li><li>スペシャルトーク 野中氏と平鍋氏の対談<ul><li>イノベーションに必要なのは、対話を通じて共振・共感・共鳴する実践知リーダーシップであり、それがスクラムの心だ</li></ul></li><li>おわりに</li></ul><p>12章で出てきた実践知について、実践知とは何か、実践知リーダーシップとはどういうことかというのが対談の中でも繰り返し出てきてその理解が深まった。私の中では暗黙知と実践知の境界が曖昧だったが、暗黙知と形式知を行ったり来たりすること、そして身体性を伴っているというのが実践知であること。そこには「もの」や「こと」の目に見えない関係性を洞察しながら判断し、本質を考え抜く知力が必要であると述べられていた。昔は <a href=https://ja.wikipedia.org/wiki/%E7%9F%A5%E8%A1%8C%E5%90%88%E4%B8%80>知行合一</a> と言ったらしいが、90年代以降の日本は分析過多、計画過多、コンプライアンス過多になってしまったという。また時間のあるときに所感をまとめようと思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2021/1201/>師走入り</a></h1><div class=post-meta><time class=post-date>2021-12-01</time></div><span class=post-tags>#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/dapr/>dapr</a>&nbsp;
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;</span><div class=post-content><p>1時から1時間ほど仮眠をとって2時から4時過ぎまで作業して帰ってお風呂に入ってそのまま6時から <a href=https://kobe-sannomiya-dev.connpass.com/event/232426/>【三宮.dev オンライン】リモート朝活もくもく会</a> の朝活に参加した。30分ほど雑談して眠くなって7時過ぎから9時前まで寝てた。</p><h2 id=dapr-の-pubsub-の-dead-letter-サポート>dapr の pubsub の dead letter サポート</h2><p>お仕事で dapr を触っている。pubsub で dead letter queue の仕組みを導入しようとしているが、<a href=https://github.com/dapr/dapr/issues/2217>PubSub&rsquo;s DeadLetter Topic #2217</a> によると v1.6 (2022年1月20日リリース予定) のマイルストーンになっている。本当にその予定ならそろそろベータ版が実装されていて、開発ブランチあったらテストしようかと考えていた。調べてたら rabbitmq はすでに v1.5 で dead letter のサポートがマージされているのを発見した。</p><ul><li><a href=https://github.com/dapr/docs/pull/1844>Add dead letter support for RabbitMQ pubsub #1844</a></li></ul><p>たまたま、いま使っている pubsub も rabbitmq だった。ドキュメントをみたら確かにその設定が追加されている。</p><blockquote><p><a href=https://docs.dapr.io/reference/components-reference/supported-pubsub/setup-rabbitmq/>dapr RabbitMQ</a></p><table><thead><tr><th>Field</th><th>Required</th><th>Details</th><th>Example</th></tr></thead><tbody><tr><td>enableDeadLetter</td><td>N</td><td>Enable forwarding Messages that cannot be handled to a dead-letter topic. Defaults to &ldquo;false&rdquo;</td><td>&ldquo;true&rdquo;, &ldquo;false&rdquo;</td></tr><tr><td>maxLen</td><td>N</td><td>The maximum number of messages of a queue and its dead letter queue (if dead letter enabled). If both maxLen and maxLenBytes are set then both will apply; whichever limit is hit first will be enforced. Defaults to no limit.</td><td>&ldquo;1000&rdquo;</td></tr><tr><td>maxLenBytes</td><td>N</td><td>Maximum length in bytes of a queue and its dead letter queue (if dead letter enabled). If both maxLen and maxLenBytes are set then both will apply; whichever limit is hit first will be enforced. Defaults to no limit.</td><td>&ldquo;1048576&rdquo;</td></tr></tbody></table></blockquote><p>enableDeadLetter=true に設定して、適当にエラーが発生しそうなリクエストを作って dead letter にメッセージが入るかどうかを検証してた。ひとまず dead letter にメッセージが入ること自体は確認できた。</p><h2 id=bizpy-勉強会>bizpy 勉強会</h2><p><a href=https://bizpy.connpass.com/event/229239/>Python で Slack のインテグレーションをやってみる勉強会 #3</a> を開催した。月曜日から2時間もあればできる資料作成をだらだら先送りしていて夜中に作った。なんか体調を崩しているのかもしれない。たまたま勉強会の前にせらさんから激励のコメントをいただいて嬉しかった。</p><blockquote><p>今日の分も含めコンテンツ拝見しましたが、素晴らしいですね</p></blockquote><p>私見だけど、slack インテグレーションで調べものをしているとせらさんの記事や issue のやり取りをみかけることが多い。twitter で slack インテグレーションに関してつぶやくと100%せらさんからレスポンスがある (個人の経験談) 。過去に私は外資の ISV で働きたいと思って活動したこともあったけど、せらさんをみていて自分のレベルでは無理だったなと得心がいった。なにがすごいって、bizpy の勉強会のようなところにもわざわざやってきて、講師にコメントしたりアドバイスしてくれるんだからね。</p><p>2ヶ月に渡り、slack インテグレーションのチュートリアルレベルの記事を実際に設定してみて、サンプルコード書いてみて、動かしてみて、slack でどんなことができそうかの理解を深めることができた。今回の内容はビジネスパーソン向けではなかったのでちょっと敷居が高かったかもしれないが、全3回でやり切ることができてよかった。終わってから運営に新たにわたなべさんが加わったことを参加者に紹介しつつ、次回の企画について雑談していた。次回はわたなべさんから機械学習入門のような勉強会をしてもらうことに決まった。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2021/1128/>slack ペイロードの response_url にはまった</a></h1><div class=post-meta><time class=post-date>2021-11-28</time></div><span class=post-tags>#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;</span><div class=post-content><p>1時に寝て8時に起きた。昨日は喋り倒して疲れてよく眠れた。午前中は溜まった日記を書き殴って、お仕事でやっているカスタム github actions で気になったコードを修正して、午後から bizpy の勉強会の準備を始めた。なんか気乗りせずにだらだらやって最終的には出来上がった。たいていだらだらやるときは頭の中ではもう出来上がってて集中したら2-3時間でできるのを脳が把握していて、まだ時間に余裕があるから怠けるみたいなときがある。そういうときは作業やめて散歩に出掛けるようにしている。</p><h2 id=bizpy-勉強会の資料作り>bizpy 勉強会の資料作り</h2><p>次の <a href=https://bizpy.connpass.com/event/229239/>Python で Slack のインテグレーションをやってみる勉強会 #3</a> のサンプルコードの実装をしていた。内容はだいたい次の通り。あとは資料をまとめるだけ。</p><ul><li>slash command の設定と実装</li><li>ephemeral メッセージ (本人だけみえるメッセージ) の実装</li><li>block kit でモーダルダイアログに入力した情報を使ってチャットに書き込む<ul><li><a href=https://openweathermap.org/>OpenWeather API</a> を使って天気の情報を連携する</li></ul></li></ul><p>たまたまモーダルダイアログを取り上げただけなんだけど、モーダルダイアログを submit したときにチャットに書き込むのは、そのままではできなくて、なんらかの特別な処理が必要になって、そこにはまってた。response_url の扱いはわりとややこしいみたい。</p><ul><li><a href=https://qiita.com/seratch/items/ed29acd565af36e65072>Slack ペイロードに含まれる response_url を完全に理解する</a></li></ul></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2021/1110/>低空飛行</a></h1><div class=post-meta><time class=post-date>2021-11-10</time></div><span class=post-tags>#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;</span><div class=post-content><p>3時に寝て7時半に起きた。昨日2時まで呑んだくれてたので水曜日の朝活はお休み。完全に忘れてたし寝坊した。やや2日酔いでしんどかったけど、朝にはちゃんと起きれたので体調はよい。お仕事では会議体の見直しがあって、私が必要な会議に invite されてなくてバタバタしてた。</p><h2 id=bizpy-勉強会>bizpy 勉強会</h2><p><a href=https://bizpy.connpass.com/event/229091/>Python で Slack のインテグレーションをやってみる勉強会 #2</a> を開催した。10人ほど参加してくれた。資料は作ってあったし、内容も難しくないものだったので管理画面の設定とコードをみながら1時間ほどで説明して、30分ほど質疑応答や雑談をしながら8時半には勉強会を終えた。前日の睡眠不足でしんどかったので早く終えて帰りたかったのもある。あと一回 Block Kit の開発をやって slack インテグレーションの勉強会は終えようと思う。次は12月1日なので年内はそれで終わりでいいかな。いまのうちに忘年会やりたい気持ちがあるけど、神戸だと人が集まらんやろなぁ。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2021/1107/>普通の休日の翌日</a></h1><div class=post-meta><time class=post-date>2021-11-07</time></div><span class=post-tags>#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;</span><div class=post-content><p>5時に寝て10時に起きた。昨日は夕方に2-3時間寝てたのでその分、夜に調べものをしていた。休みたい気持ちもあるけど、調べるものが多過ぎて全然時間が足りない。</p><h2 id=bizpy-勉強会の資料作り>bizpy 勉強会の資料作り</h2><p><a href=/diary/posts/2021/1106/#slack-apps-の調査>昨日</a> の続き。昨日サンプルコードを実装したので、その設定や要点を <a href=https://github.com/t2y/python-study/tree/master/BizPy/slack/20211027>資料</a> に作成した。現時点で <a href=https://bizpy.connpass.com/event/229091/>Python で Slack のインテグレーションをやってみる勉強会 #2</a> の参加者は10人。連続シリーズは回を重ねるごとに減っていくものなのでこんなもんかな。あともう1回やったら終わりにする。</p><h2 id=udemy-kubernetes入門>udemy: Kubernetes入門</h2><p>友だちから udemy の k8s のコースがよいと聞いたんだけど、そのコースはいまは提供されていなくて、せっかくなので適当に検索してヒットした <a href=https://www.udemy.com/course/kubernetes-basics-2021/>Kubernetes入門</a> を受講することに決めた。本当は英語の本格的なコースを受講した方がよいのだろうけど、余裕のあるときはそれでいいけど、いま数日で概要を把握して使えるようにしたいので日本語のコースにしてみた。</p><ul><li><a href=https://blog.ayakumo.net/entry/2018/01/27/010000>Udemy の Learning Docker and Kubernetes by Lab がとてもよい</a></li><li><a href=https://blog.ayakumo.net/entry/2018/02/15/232918>Docker, Kubernetes 学習とツールとコンピュータサイエンス</a></li></ul><p>昨日インストールした minikube のクラスターを使って「Kubernetes入門」のセクション1からセクション5までやった。だいたい半分ぐらい。所感としては、全く何も知らない人には要点をかいつまんで教えてくれるのと、最初に覚えるとよい基本的な CLI のコマンドとその振る舞いや設定を紹介してくれるのでよかった。初めて k8s に挑戦する自分にとってはちょうどよいレベル感だった。全体像の概念を捉えてコンテキストに沿って順番にハンズオン形式で学習していくスタイル。<a href=https://github.com/nakamasato/kubernetes-basics>nakamasato/kubernetes-basics</a> を使って自分でも CLI でコマンドを打ちながら進めてみた。yaml ファイルを定義するのもこれはこれで面倒だけど、この辺は慣れの問題かな？とも思う。いくつか学んだことを整理しておく。</p><h3 id=セクション1-introduction>セクション1 Introduction</h3><p>k8s には2つのコンポーネントがあり、これを k8s クラスターと呼んでいる。</p><ul><li>Control Plane (API サーバー)</li><li>複数の Worker (Kubelet)</li></ul><p>yaml で設定する Desired State (理想状態) と呼ばれる設定が登録されると、Control Plane の API サーバーと Worker の kubelet が通信してそれを実現しようとする。pod とは k8s のデプロイの最小単位となる。コンテナ、ポート、レプリカ数などを設定する。pod をそれぞれの Worker にデプロイしたり、Worker がダウンしたときに別の Worker で起動させたりする。</p><h3 id=セクション2-kubernets-概要>セクション2 Kubernets 概要</h3><p>k8s はコンテナ化したアプリケーションのデプロイ、スケーリング、管理を行うためのオープンソースのコンテナオーケストレーションシステムである。</p><ul><li>コンテナ<ul><li>独立した環境でアプリケーションを実行する仕組み</li><li>コンテナの実態はプロセス</li><li>Kernel Namespaces を利用し、プロセスID、ネットワークインターフェース、リソースなどを分離してコンテナ間で干渉しない</li><li>ホストマシンへの依存度を最小化してアプリケーションをどこでも実行可能にする<ul><li>従来のやり方の最大の違いはライブラリがホストマシンにインストールされるのではなく、コンテナの内部にインストールされる</li></ul></li></ul></li><li>オーケストレーション<ul><li>デプロイ、スケーリング、管理などの仕組み</li></ul></li></ul><p>1つのアプリケーションは複数のマシン上で動かすことで可用性を高めたいが、コンテナを動かすために考えることが増えていくと管理コストも増えていく。コンテナオーケストレーション機能により次のようなシステム管理者が行っていたことが自動化される。</p><ul><li>デプロイメント</li><li>スケジューリング</li><li>オートスケーリング<ul><li>負荷に応じてコンテナ数やマシン数を増減させる</li></ul></li><li>ネットワーク</li><li>リソースマネジメント</li><li>セキュリティ<ul><li>ネットワークポリシーやリソースの権限定義</li></ul></li></ul><p>k8s クラスターの構造は次になる。</p><ul><li>Control Plane<ul><li>api: kubelet と通信するサーバー</li><li>etcd: 設定などを格納するキーバリューストア</li><li>shed: kube スケジューラー</li><li>c-m: コントロールマネージャー</li><li>c-c-m: クラウドプロバイダと api 連携する<ul><li>ローカルで使うときは必要ない</li></ul></li></ul></li><li>Worker ノードはコンテナランタイムをいインストールしておく必要がある<ul><li>kubelet は Control Plane と通信するためのエージェントとして動作する</li></ul></li></ul><p>一番需要なこととして、k8s は理想状態と現実状態を比較して、理想状態に近づけようとする。app.yaml の理想状態を kubectl を用いて api サーバーを介して etcd に格納する。現実状態は kubelet から api サーバーを介して etcd に格納される。c-m は理想状態と現実状態のチェックを行い、異なっていれば理想状態に近づけることをしていく。</p><h3 id=セクション4-kubectl>セクション4 kubectl</h3><p>minikube で最初に起動しているのは Control Plane を起動していることが理解できた。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ minikube start
</span></span><span style=display:flex><span>$ kubectl config current-context
</span></span><span style=display:flex><span>minikube
</span></span></code></pre></div><p>同時に ~/.kube/config に kubectl の設定も追加される。<code>minikube</code> という名前でクラスター、ユーザー、コンテキストが設定される。</p><p>リソース一覧の確認。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl api-resources
</span></span></code></pre></div><p>出力フォーマットも様々。例えば、デフォルトの表示は次になる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get node
</span></span><span style=display:flex><span>NAME       STATUS   ROLES                  AGE     VERSION
</span></span><span style=display:flex><span>minikube   Ready    control-plane,master   7m21s   v1.22.2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl get node -o wide
</span></span><span style=display:flex><span>NAME       STATUS   ROLES                  AGE     VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME
</span></span><span style=display:flex><span>minikube   Ready    control-plane,master   8m38s   v1.22.2   192.168.49.2   &lt;none&gt;        Ubuntu 20.04.2 LTS   5.11.0-38-generic   docker://20.10.8
</span></span></code></pre></div><p>より詳細な情報をそれぞれのフォーマットで表示する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get node -o json
</span></span><span style=display:flex><span>$ kubectl get node -o yaml
</span></span></code></pre></div><p>namespace を確認する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get namespace
</span></span><span style=display:flex><span>NAME              STATUS   AGE
</span></span><span style=display:flex><span>default           Active   10m
</span></span><span style=display:flex><span>kube-node-lease   Active   10m
</span></span><span style=display:flex><span>kube-public       Active   10m
</span></span><span style=display:flex><span>kube-system       Active   10m
</span></span></code></pre></div><p>namespace を指定して pod 一覧を取得する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get pod --namespace kube-system
</span></span><span style=display:flex><span>NAME                               READY   STATUS    RESTARTS      AGE
</span></span><span style=display:flex><span>coredns-78fcd69978-qxqbn           1/1     Running   <span style=color:#ae81ff>0</span>             11m
</span></span><span style=display:flex><span>etcd-minikube                      1/1     Running   <span style=color:#ae81ff>0</span>             11m
</span></span><span style=display:flex><span>kube-apiserver-minikube            1/1     Running   <span style=color:#ae81ff>0</span>             11m
</span></span><span style=display:flex><span>kube-controller-manager-minikube   1/1     Running   <span style=color:#ae81ff>0</span>             11m
</span></span><span style=display:flex><span>kube-proxy-g55hg                   1/1     Running   <span style=color:#ae81ff>0</span>             11m
</span></span><span style=display:flex><span>kube-scheduler-minikube            1/1     Running   <span style=color:#ae81ff>0</span>             11m
</span></span><span style=display:flex><span>storage-provisioner                1/1     Running   <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>10m ago<span style=color:#f92672>)</span>   11m
</span></span></code></pre></div><p>グローバルな CLI のオプションを確認する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl options
</span></span></code></pre></div><p>ノードの詳細を表示する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl describe node
</span></span></code></pre></div><p>describe は名前の接頭辞を指定できるので namespace ならこんな感じに実行できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl describe namespace kube-
</span></span></code></pre></div><h3 id=セクション5-kubernetes-リソース>セクション5 Kubernetes リソース</h3><p>pod とは k8s 上のデプロイの最小単位である。</p><ul><li>1つまたは複数のコンテナをもつ</li><li>ネットワークやストレージを共有リソースとしてもつ</li><li>コンテナの実行方法に関する仕様をもつ</li></ul><p>pod が使えなくなった場合に他のノードにデプロイされることもある。1つのアプリケーションを複数の pod でデプロイすることが多い。なるべく複数のアプリケーションを1つの pod に入れない。個別の pod を直接操作しない。</p><p>共有コンテキスト</p><ul><li>同一 pod 内のコンテナは同じストレージにアクセスできる</li><li>同一 pod 内のコンテナは ip アドレスとポートを含むネットワーク名前空間を共有する</li></ul><p>k8s オブジェクト</p><ul><li>クラスタの状態を表現する</li><li>2つのフィールドをもつ<ul><li>spec: 理想状態 (desired status)</li><li>status: 現実状態 (current status)</li></ul></li></ul><p>pod の作成は k8s オブジェクトを作成している。オブジェクト作成時の必須フィールドが4つある。</p><ul><li>apiVersion</li><li>kind</li><li>metadata</li><li>spec</li></ul><p>namespace は同一クラスター上で複数の仮想クラスターの動作をサポートする。</p><ul><li>仮想クラスターとは、物理的には同じマシンで動いているかもしれないが、仮想的に環境を分離している<ul><li>1つのクラスターを論理的にわける</li><li>チームや部署ごとにわけて使い分けたりすることも多い</li></ul></li></ul><p>namespace を使うメリットは次になる。</p><ul><li>pod やコンテナのリソースの範囲設定</li><li>namespace 全体の総リソース制限</li><li>権限管理</li></ul><p>初期の namespace として4つあるが、初心者は最初の2つだけをまず覚えておく。</p><ul><li>default:</li><li>kube-system:</li><li>kube-public:</li><li>kube-node-lease</li></ul><p>namespace と cluster の違い。</p><ul><li>Namespace-scoped リソース<ul><li>namespace に属しているリソース</li></ul></li><li>Cluster-scoped リソース<ul><li>クラスター全体で使われるもの</li></ul></li></ul><p>次のコマンドで確認できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl api-resources --namespaced<span style=color:#f92672>=</span>true 
</span></span></code></pre></div><p>namespace の作成</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl create namespace my-namespace
</span></span></code></pre></div><p>ワークロードリソースとは複数の pod を作成・管理するためのリソース。ワークロードリソースは pod テンプレートを使って pod を作成する。</p><ul><li>ReplicaSet<ul><li>常に指定したレプリカ数の pod を保つ</li></ul></li><li>Deployment<ul><li>ローリングアップデートやロールバックなどのアップデート機能を提供</li><li>ReplicaSet のロールアウト</li><li>不安定な場合の前のバージョンへロールバック</li><li>使用頻度が高い<ul><li>ほとんどのアプリケーションは Deployment で管理</li></ul></li></ul></li><li>Secret<ul><li>機密情報を保存・管理し、Pod から参照可能</li><li>主な使用方法としてコンテナの環境変数の設定<ul><li>アプリケーションの DB のパスワードなどに使う</li></ul></li></ul></li><li>Service<ul><li>pod の集合を抽象化して公開する<ul><li>pod の集合に対する DNS 名</li><li>pod の集合に対する負荷分散</li></ul></li></ul></li></ul></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2021/1027/>bizpy 再開</a></h1><div class=post-meta><time class=post-date>2021-10-27</time></div><span class=post-tags>#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/recipe/>recipe</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;</span><div class=post-content><p>2時に寝て6時に起きた。前日の夜にウォーキングしたせいか、よく眠れた。朝活を終えてから朝ご飯を作って食べてそのままオフィスに出社した。6時起きを日課にした方が生活のリズムがよい。夕方に眠くなって1時間ほど昼寝した。</p><h2 id=朝活-ミクロ経済学入門の入門>朝活: ミクロ経済学入門の入門</h2><p><a href=https://kobe-sannomiya-dev.connpass.com/event/228969/>【三宮.dev オンライン】リモート朝活もくもく会</a> で第4章の供給曲線を読んだ。需要曲線の逆からの視点なので考え方は同じで図の形が異なる。用語がいくつか出てきたのでまとめる。</p><ul><li>収穫逓減 (しゅうかくていげん): 製品をより多く生産するのにかかる経費が増大していくこと<ul><li>生産活動において2倍の生産量を生み出すには2倍以上の経費がかかる</li></ul></li><li>費用関数: 生産量と費用との関係をあらわす</li><li>限界費用: 追加的に1単位生産する費用<ul><li>3個を生産する費用は、1個目の限界費用 + 2個目の限界費用 + 3個目の限界費用<ul><li>個数が増えるごとに費用は高くなっていく</li></ul></li><li>費用を図示するときは限界費用に分解した方が視覚的にわかりやすい</li></ul></li><li>限界費用逓増: 生産するごとに限界費用が高まっていくこと</li></ul><p>「<a href=https://dictionary.goo.ne.jp/word/kanji/%E9%80%93/>逓</a>」という漢字は「つぎつぎ」や「だんだん」という意味をもつ。</p><ul><li>プライステイカー: 自分の生産量が価格に影響を与えられない<ul><li>減産により希少価値を高め価格を吊り上げる市場操作ができない</li></ul></li><li>独占企業: プライステイカーの反対。</li><li>利潤: 売上 - 経費</li><li>最適解: 利潤を最大化する生産量<ul><li>あと1個追加して生産すると利益がマイナスになるところ</li></ul></li><li>生産者余剰: すべての企業の利潤の和</li><li>供給曲線: すべての企業の限界費用をヨコに足し合わせた曲線</li></ul><figure><img src=/diary/img/2021/1027_supply-curve.png></figure><h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2><p>昨日の続き。8.4 を読んで8章分散システムの問題を読み終えた。全体としても学びになったけれど、とくに 8.3 信頼性の低いクロックの節が全く開発・運用で意識したことがなかったので私にとっては学びになった。</p><blockquote><p>分散システムにおいて発生する厄介な問題がある。</p><ul><li><p>ネットワーク経由でパケットを送信しようとした場合、そのパケットはロストしたり、どれほど遅延するか分からない。同様に、レスポンスもロストしたり遅延したりするので、レスポンスを受け取れなかった場合には元々のメッセージが到達したかどうかも分からない</p></li><li><p>ノードのクロックは他のノードと大きくずれているかもしれない（できる限りの努力をして NTP をセットアップしたとしても）。クロックは急に進んだり戻ったりするかもしれず、たいていはクロックの誤差をうまく計る方法がないので、クロックに依存するのは危険</p></li><li><p>プロセスは処理中にいつどれほどの長さ一時停止するかもしれず（おそらくはstop-the-worldガベージコレクタのため）、他のノードから落ちていると見なされた後に自身に一時停止があったことを理解しないままに復活するかもしれない。</p></li></ul><p>こういった <strong>部分障害</strong> が生じうるのが分散システムの特徴と言える。ソフトウェアが他のノードが関わる何かをしようとした場合、それは時おり失敗したり、ランダムに速度が落ちたり、まったくレスポンスが返されない（そして最終的にはタイムアウトする）といった可能性がある。分散システムでは、部分障害への耐性をソフトウェアに組み込み、システムの構成要素が一部破損していてもシステム全体としては機能し続けられるようにする。</p><p>フォールトに耐えるための最初のステップはフォールトを <strong>検出</strong> することだが、それさえも難しい。多くのシステムは、ノードに障害が生じていることを検出する正確な仕組みを持たないので、ほとんどの分散アルゴリズムはリモートノードが生きているかどうかを判断するのにタイムアウトに頼る。しかし、タイムアウトはネットワークの障害とノードの障害を区別できず、ネットワークの遅延変動のために間違ってノードがクラッシュしていると誤検知することもある。弱っているものの落ちてはいないノードは、きれいに落ちているノードよりもさらに扱いが難しくなる可能性がある。</p><p>フォールトが検出されたとして、システムがそれに耐えられるようにすることも簡単ではない。マシン間にはグローバルな変数も、共有メモリも、共通の情報やその他何らかの共有された状態もない。ノードは現在の時刻についてさえ合意できず、ましてやもっと重大なことに合意することなどできない。あるノードから他のノードへ情報を流せる唯一の方法は、その情報を信頼できないネットワークを通じて送ることだけである。重要な判断は単一のノードだけで安全に下すことができないので、他のノードの助けを得てクオラムが合意に至るようにするためのプロトコルが必要となる。</p><p>同じ操作をすれば決まって同じ結果を返してくれるような、単一コンピュータにおける理想化された数学的な完全さの中でソフトウェアを書くのに慣れていると、分散システムの雑然とした物理的な現実への移行はちょっとしたショックを伴う。一方、分散システムのエンジニアは、しばしば単一のコンピュータ上で解決できる問題を簡単なものだと見なすが、実際のところ今日では単一のコンピュータがこなせる仕事量はかなりのものになっている。単一のマシンでシンプルにことを済ませられるなら、概してそうする価値はある。</p><p>分散システムを利用する理由はスケーラビリティだけではない。耐障害性や低レイテンシ（地理的にユーザーの近くにデータを置けることによる）も同様に重要な目標であり、こういったことは単一ノードでは実現できない。本章ではネットワーク、クロック、プロセスの信頼性の低さが避けがたい自然の法則なのかも調べた。安全ではなく、クリティカルではないシステムの多くでは、高価な高信頼性よりも安価な低信頼性が選択される。また、信頼性の高いコンポーネントを前提としているスーパーコンピュータも取り上げました。スーパーコンピュータはその前提が故に、コンポーネントに障害が生じてしまった場合には完全に停止させて再起動することになる。これに対し、分散システムはサービスレベルでは中断することなくいつまでも動作し続けられる。これは、少なくとも理論上はすべてのフォールトやメンテナンスはノードレベルで処理できるためである。</p></blockquote><h2 id=お昼ご飯>お昼ご飯</h2><p>気分でスーパー寄って買いものして家に帰り、お昼ご飯を作って食べた。前に適当に作った <a href=/diary/posts/2021/1025/#お昼寝>かぼちゃの煮物</a> がおいしかったので再挑戦してみた。今度は圧力鍋を使っていろいろ具材を入れてみた。過去に作っておいしかった料理のレシピを evernote に書いたりしていたけど、もういまは書いてないので気が向いたら日記に書くようにする。</p><p>材料</p><ul><li>A<ul><li>水 900cc</li><li>めんつゆ 100c</li><li>醤油 適量</li></ul></li><li>B<ul><li>かぼちゃ 1/4切れ</li><li>なす 3個</li><li>にんじん 2本</li><li>玉ねぎ 1個</li><li>しめじ 1パック</li></ul></li><li>C<ul><li>卵 2個</li><li>豆苗</li><li>せみ餃子</li></ul></li></ul><p>作り方</p><ol><li>圧力鍋に A を入れて火にかける</li><li>B の野菜を切りながら圧力鍋に入れていく</li><li>圧力鍋に B をすべて入れたら圧をかける (高圧30秒)</li><li>圧が下がったら蓋をあけて C を入れる</li><li>C に火が通るまで2分ほど煮込む</li></ol><p>所感</p><p>圧力が強過ぎたのか、かぼちゃが煮汁に溶け出してしまって原形がなくなってしまった。スープとして飲んでもおいしいけれども、水を入れ過ぎたのかもしれない。肉の代わりに餃子を使ってみた。水餃子っぽくなるので焼き餃子で油使うよりヘルシーな気持ちになっておいしい。</p><figure><img src=/diary/img/2021/1027_pumpkin.jpg></figure><h2 id=bizpy-勉強会>bizpy 勉強会</h2><p><a href=https://bizpy.connpass.com/event/198717/>Python で Slack のインテグレーションをやってみる勉強会 #1</a> を開催した。半年以上開催してなかったので億劫になってしまっていたけど、再開できてよかった。10名ほどが参加してくれた。用意したコンテンツを話し終えたら8時半ぐらいで時間もちょうどよかった。初参加者も数人いた。slack インテグレーションの調査も兼ねてあと2-3回は集中的にやっていきたい。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2021/1011/>BizPy 再始動</a></h1><div class=post-meta><time class=post-date>2021-10-11</time></div><span class=post-tags>#<a href=/diary/tags/python/>python</a>&nbsp;
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
#<a href=/diary/tags/harassment/>harassment</a>&nbsp;
#<a href=/diary/tags/code-reading/>code reading</a>&nbsp;</span>
<img src=/diary/img/2021/1011_hot-entory.png class=post-cover alt="BizPy 再始動" title="Cover Image"><div class=post-content><p>昨日は晩ご飯食べてからのんびりしていた。寝て起きての繰り返しだったので何時に寝たのかよくわからない。夜、本を読もうと思っていたのにダラダラ過ごしてしまった。朝は7時半に起きた。朝起きたら <a href=https://t2y.hatenablog.jp/entry/2019/06/29/150125>Python で Unicode 正規化 NFC/NFD の文字列を扱う</a> がはてブでホットエントリ化してた。昨日、書評を書いたからその記事かと期待したけど、なぜか2年ほど前に書いた古い記事だった。なんかがっかり。そして、その理由は全くわからない。1日経って夜の時点ではてブが82個ついている。昔は10個もついたら嬉しかったものだけど、いまは100個ぐらいついてもなんとも思わない。</p><h2 id=fin-pyコードリーディング会に発表準備>fin-pyコードリーディング会に発表準備</h2><p><a href=https://fin-py.connpass.com/event/226933/>fin-pyコードリーディング会#4</a> に参加することにした。過去にオブジェクトストレージの開発に関わっていたからデータストアやストレージに関することは興味がある。たまたまツールの <code>store.py</code> を題材にしていたので読んでしまった。簡単にコードを読んで気になったところをイベントの hackmd に記載した。やっていることの詳細をよくわかっていないので、コードレビューみたいになってしまった。</p><ul><li><a href=https://hackmd.io/bFBFaPbYS1Kqfc97HMlp7Q?view>https://hackmd.io/bFBFaPbYS1Kqfc97HMlp7Q?view</a></li></ul><h2 id=bizpy-のコミュニティ活動を再開>BizPy のコミュニティ活動を再開</h2><p>前にやってたお仕事がうまくいかなくて他のことに時間を費やす余裕がなくてお休みしてた。本当はもっと早く再開してもよかったんだけど、新しいことに挑戦しているときにあまり他のことに注意を取られたくないという考えもあって少し保留していた。新しいことへの活動も一段落して方向性や展望もみえてきたので BizPy も再開することにした。ちょうど Slack のインテグレーションを調べようと思ったところだったので弾みを付ける意図でも都合がよい。複数の意味でタイミングがよかった。また参加者が戻ってきてくれると嬉しい。</p><ul><li><a href=https://bizpy.connpass.com/event/198717/>Python で Slack のインテグレーションをやってみる勉強会 #1</a></li></ul><h2 id=プロコンの続き>プロコンの続き</h2><p>ネットで話題になったせいか、当事者同士で話し合う場が設けられたという公式発表が行われた。</p><blockquote class=twitter-tweet><p lang=ja dir=ltr>第32回高専プロコン秋田大会自由部門プレゼン審査発表順番号５の質疑応答について、発表者・質問者双方の相互理解の場を設けさせて頂きました。<a href="https://twitter.com/hashtag/procon32?src=hash&ref_src=twsrc%5Etfw">#procon32</a> <a href=https://t.co/nlzujvJ7Hv>pic.twitter.com/nlzujvJ7Hv</a></p>&mdash; KosenProcon (@KosenProcon) <a href="https://twitter.com/KosenProcon/status/1447192976946384901?ref_src=twsrc%5Etfw">October 10, 2021</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>これ以上、外野がとやかく言う必要はないと思うけど、一方で立場の強い人が有利になってしまうため、運営はハラスメント行為を行った審査員へ然るべき措置をすべきといった意見もみられた。一理あるかもしれないが、そこまでするほどの問題かというのは個人的に思う。タイムラインを眺めていると、ハラスメントを問題視する人は、その背景や経緯や意図はすべて横に置いておいてハラスメント的言動や態度を糾弾する。この人たちと背景も考慮して整理しようとする人たちとは全く議論が噛み合わない。ハラスメントは絶対許すまじという社会の変化や誤った人への行き過ぎたキャンセルカルチャーに私はやや圧倒される。</p><p>そう思っていると、私のタイムラインでは「まさかりを投げる」という表現そのものや行為のハラスメントの是非の議論も巻き起こっていた。あまり最近はまさかりを投げるという表現は見かけないんだけど、「マウント禁止」というのをちょくちょくみかける。ハラスメントと根っこは同じで悪気の有無に関係なく発信側が責めを負うようになったんだなと感じる。</p><blockquote class=twitter-tweet><p lang=ja dir=ltr>まさかりの議論とは別に、最近勉強会で「マウント禁止」というルールもよくみかける。これもマウントされたと感じる人と、知っていることを教えようとする人との関係の難しさを感じる。多少の間違いやもっとこうした方がいいよといったアドバイスをしなくなる人も多いのでは？という気はする。</p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1447429693959860236?ref_src=twsrc%5Etfw">October 11, 2021</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script></div></article><div class=pagination><div class=pagination__buttons></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>