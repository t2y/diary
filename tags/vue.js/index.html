<!doctype html><html lang=en><head><title>vue.js :: forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/tags/vue.js/><link rel=stylesheet href=/diary/assets/style.css><link rel=stylesheet href=/diary/assets/green.css><link rel=stylesheet href=/diary/style.css><link rel=apple-touch-icon href=/diary/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="vue.js"><meta property="og:description" content><meta property="og:url" content="/diary/tags/vue.js/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><link href=/diary/tags/vue.js/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0825/>vuetify のコンポーネント調査</a></h1><div class=post-meta><span class=post-date>2022-08-25</span></div><span class=post-tags>#<a href=/diary/tags/vue.js/>vue.js</a>&nbsp;</span><div class=post-content><p>0時に寝て7時に起きた。</p><h2 id=vuetify-で検索フォームのコンポーネント作成>vuetify で検索フォームのコンポーネント作成</h2><p>ページング処理ができた。次に検索リクエストのための検索条件を扱うフォームを汎用コンポーネントで作ってみることにした。コンポーネントを生成するための検索条件のオブジェクトを外部から渡して、あとはよしなに <a href=https://vuetifyjs.com/en/components/grids/>grid</a> に構成要素を配置する。v-date-picker のところは本当はもっと凝った作りをしないといけない。ここでは型で分岐してコンポーネントを配置する概念を表しているだけ。v-col は cols は1から12までの数字を受け取る。この数値を調整して v-spacer を入れることで行の位置調整もできるのがひと工夫しているところ。イベントハンドラーは <code>click:search</code> とか <code>click:searchClear</code>のように名前を付け替えて、外部から意図したイベントのみをフックできるように考慮している。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span>&lt;<span style=color:#f92672>template</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>container</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>row</span> <span style=color:#a6e22e>dense</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>col</span> <span style=color:#a6e22e>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>for</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;item in conditions&#34;</span> <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>cols</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;item.col&#34;</span> <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>key</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;item.label&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>switch</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>if</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Boolean === item.type&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>model</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;item.value&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>label</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;$t(item.label)&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>clearable</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>        /&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>text</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>field</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>if</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;String === item.type&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>model</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;item.value&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>label</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;$t(item.label)&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>clearable</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>        /&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>text</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>field</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>if</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Number === item.type&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>model</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;item.value&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>label</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;$t(item.label)&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>clearable</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>        /&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>date</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>picker</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>if</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Date === item.type&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>model</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;item.value&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>clearable</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>        /&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>spacer</span> <span style=color:#a6e22e>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>if</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;null === item.type&#34;</span>&gt;
</span></span><span style=display:flex><span>          <span style=color:#75715e>&lt;!--</span> <span style=color:#a6e22e>use</span> <span style=color:#a6e22e>an</span> <span style=color:#a6e22e>empty</span> <span style=color:#a6e22e>block</span> <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>grid</span> <span style=color:#a6e22e>layout</span> <span style=color:#f92672>--&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/v-spacer&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/v-col&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/v-row&gt;</span>
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>row</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>col</span> <span style=color:#a6e22e>cols</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;4&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>btn</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>text</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;$t(&#39;label.clearSearchCondition&#39;)&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>click</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;_searchClear&#34;</span>
</span></span><span style=display:flex><span>        /&gt;
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/v-col&gt;</span>
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>col</span> <span style=color:#a6e22e>cols</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;3&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>btn</span> <span style=color:#a6e22e>color</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;primary&#34;</span> <span style=color:#a6e22e>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>text</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;$t(&#39;label.search&#39;)&#34;</span> <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>click</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;_search&#34;</span> /&gt;
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/v-col&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/v-row&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/v-container&gt;</span>
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>template</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>lang</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ts&#34;</span>&gt;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>PropType</span>, <span style=color:#a6e22e>defineComponent</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@vue/composition-api&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>SearchConditionItem</span>&lt;<span style=color:#f92672>T</span> <span style=color:#960050;background-color:#1e0010>=</span> <span style=color:#a6e22e>any</span>&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>PropType</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>label?</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>col</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value?</span>: <span style=color:#66d9ef>any</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fromValue?</span>: <span style=color:#66d9ef>string</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>toValue?</span>: <span style=color:#66d9ef>string</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>defineComponent</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>components</span><span style=color:#f92672>:</span> {},
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>props</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>conditions</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> Array <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>PropType</span>&lt;<span style=color:#f92672>SearchConditionItem</span><span style=color:#960050;background-color:#1e0010>[]</span>&gt;,
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> [],
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setup</span>(<span style=color:#a6e22e>props</span>, <span style=color:#a6e22e>context</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {};
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>methods</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_search</span>(<span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>any</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>$emit</span>(<span style=color:#e6db74>&#39;click:search&#39;</span>, <span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_searchClear</span>(<span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>any</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>c</span> <span style=color:#66d9ef>of</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>conditions</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>fromValue</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>toValue</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>$emit</span>(<span style=color:#e6db74>&#39;click:searchClear&#39;</span>, <span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><p>呼び出し側ではこんな感じ。任意の conditions を渡し、検索ボタンをクリックしたときのイベントハンドラーを登録する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span>&lt;<span style=color:#f92672>search</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>condition</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>form</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>conditions.sync</span><span style=color:#960050;background-color:#1e0010>=&#34;</span><span style=color:#a6e22e>searchCondition</span><span style=color:#960050;background-color:#1e0010>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>click</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>search</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;search&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>on</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;$listeners&#34;</span>
</span></span><span style=display:flex><span>/&gt;
</span></span></code></pre></div><p>vuetify で初めてコンポーネントを作ってみた。雰囲気だけで実装している個人的な所感だけど、template, script, style を1つのファイルに同梱する考え方が私には馴染まない。1つのファイルに複数の構文が混在する認知負荷が気になるのと、1つのファイルに複数のコードを同梱しているメリットが私には感じられない。もしかしたら小さいシンプルなコンポーネントなら見通しがよいのかもしれない。しかし、業務での開発だと一定の複雑さをもつコンポーネントの方が大半だと思うので1ファイルが1画面におさまらない。どうせエディターを画面分割して複数画面でソースを読むのであれば、その画面のソースが1つのファイルでも別のファイルでも私にとってあまり大差ない。ファイル間の依存関係さえ適切に管理できればファイルは用途ごとに分割できた方が人間にとってわかりやすいのではないかとも思う。一方でフレームワーク側からみたら依存関係の解決はやや煩雑な処理になるので開発や依存管理がシンプルになってビルドが速くなるといったメリットがあったりするのかもしれない。どうなんだろう？</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0824/>vuejs の template 調査</a></h1><div class=post-meta><span class=post-date>2022-08-24</span></div><span class=post-tags>#<a href=/diary/tags/operation/>operation</a>&nbsp;
#<a href=/diary/tags/vue.js/>vue.js</a>&nbsp;</span><div class=post-content><p>0時に寝て6時に起きた。</p><h2 id=連日のサービスイン作業>連日のサービスイン作業</h2><p>引き続きサービスインの運用対応は大変そうでちゃんと検証していない修正を慌ててマージしようとしているからテスト環境まで壊れてて関係ない開発にも影響が出ていた。今日も別の施設のサービスインだったらしくて、ある機能がないとそのサービスインの切り替え作業ができないという話しだったそうで、当日に慌てて pr を作ってマージしてた。先週からわかっていた必要な機能を実装してなくて、週末は残業も休出もしてなくて、今日になって慌てて修正してマージしてた。昔の開発と比べてがんばっててできないのではなくて、いまの開発はがんばってないからできないという雰囲気になったなという印象。</p><h2 id=vuejs-の-template-と-expression>vuejs の template と expression</h2><p>あるフォームのコンポーネントを作ろうと思って interface を定義していてデフォルト値をテンプレート側に指定できるといいんじゃないかと考えた。というのは typescript の interface のメンバーは値を保持できないから。例えば、次のようなコードで <code>:cols="item.col ?? 2"</code> のように表現できたら嬉しいように思う。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;v-row</span> <span style=color:#960050;background-color:#1e0010>dense</span> <span style=color:#a6e22e>v-for=</span><span style=color:#e6db74>&#34;item in conditions&#34;</span> <span style=color:#a6e22e>:key=</span><span style=color:#e6db74>&#34;item.label&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;v-col</span> <span style=color:#a6e22e>:cols=</span><span style=color:#e6db74>&#34;item.col ?? 2&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    {{ element }}
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/v-col&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/v-row&gt;</span>
</span></span></code></pre></div><p>余談だけど、<code>??</code> は null 合体演算子という名前は知っていたけど、これを英語で何と呼ぶのか知らなかった。<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator>Nullish coalescing operator</a> と言う。ググってみると vuejs の issue でもそこそこ議論されていて vue3 からサポートするとしながら、根強い要望があるのか？ vue2 でも 2.7 でサポートしたらしい。こういうモダンな javascript の expression を ESNext syntax と呼んだりするみたい。それすらも知らなかった。</p><ul><li><a href=https://github.com/vuejs/vue/issues/11088>Optional chaining in templates does not seem to work #11088</a></li></ul><p>たまたまうちで使っているのは vue 2.6.14 なので vue 2.7 で動くのかどうか検証できないけど、いま使っている nuxtjs2 との依存関係があるのでそれ次第で vue 2.7 にアップグレードの可否が決まるらしい。全然フロントエンドの開発がわからないので、こういう基本的なところで引っかかると背景を調べるのに時間がかかる。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0823/>vuetify のイベントリスナーの調査</a></h1><div class=post-meta><span class=post-date>2022-08-23</span></div><span class=post-tags>#<a href=/diary/tags/vue.js/>vue.js</a>&nbsp;</span><div class=post-content><p>4時に寝て7時に起きた。日曜日にたくさん寝たせいか、昨日は眠れなかった。サービスインの運用対応はまだまだドタバタしていてデータの不整合に苦しんでいるみたい。大変そうだけど、なにもやることない。</p><h2 id=vuetify-の-v-data-table-のページング処理>vuetify の v-data-table のページング処理</h2><p>昨日から vuetify のページング処理を調査している。コンポーネント的には2種類ある。</p><ul><li><a href=https://vuetifyjs.com/en/api/v-pagination/>v-pagination</a>: 汎用のページングコンポーネント</li><li><a href=https://vuetifyjs.com/en/api/v-data-table/>v-data-table</a>: data table のコンポーネント (ページング機能がある)</li></ul><p>既存のアプリケーションは nuxtjs で実装されているので vuetify や vue.js のサンプルコードをそのまま動かせるわけではない。丸1日、試行錯誤していてビューと値の束縛、イベントの伝搬などの振る舞いをだいたい理解できた。宣言的なフレームワークなので振る舞いを理解できれば開発量は少なく済む。但し、理解するまで振る舞いを理解するのに設定を試行錯誤で試して動かすのでデバッグは時間がかかる。一覧画面で使っている v-data-table のページング処理対応から始める。<a href=https://vuetifyjs.com/en/components/data-tables/#server-side-paginate-and-sort>Server-side paginate and sort</a> を参考にしながら v-data-table に加えた主な変更はこれら。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span>&lt;<span style=color:#f92672>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>data</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>table</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>...</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>server</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>items</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>length</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;serverItemsLength&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>disable</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>pagination</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;disablePagination&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>hide</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>default</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>footer</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;hideDefaultFooter&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>options.sync</span><span style=color:#960050;background-color:#1e0010>=&#34;</span><span style=color:#a6e22e>options</span><span style=color:#960050;background-color:#1e0010>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>footer</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>props</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    itemsPerPageOptions: [10, 20, 50, 100],
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>bind</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;$attrs&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>v</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>on</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;$listeners&#34;</span>
</span></span><span style=display:flex><span>&gt;
</span></span></code></pre></div><p>v-data-table をラップするコンポーネントでは次のようにイベントリスナーを登録する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span>&lt;<span style=color:#f92672>my</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>nice</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>component</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>...</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>￼</span> <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>server</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>items</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>length</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;serverItemsLength&#34;</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>￼</span> <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>disable</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>pagination</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;false&#34;</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>￼</span> <span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>hide</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>default</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>footer</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;false&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>update</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#a6e22e>options</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;dataOptionsHandler&#34;</span>
</span></span><span style=display:flex><span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>dataOptionsHandler</span>(<span style=color:#a6e22e>options</span>: <span style=color:#66d9ef>DataOptions</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>page</span> <span style=color:#f92672>??</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>limit</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>itemsPerPage</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>offset</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>limit</span> <span style=color:#f92672>*</span> (<span style=color:#a6e22e>page</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// limit/offset を使った web api リクエスト
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span></code></pre></div><p><a href=https://v2.vuejs.org/v2/api/#vm-listeners>vm.$listeners</a> によると <code>v-on="$listeners"</code> のように書くと、ラップしているコンポーネントのイベントリスナーをよしなに伝搬してくれるみたい。これはこれで便利だけど、イベントリスナーの定義がどこにもでてこないのでコード検索ができなくなる。最近の宣言的なフレームワークの流行りと言えばそうだけど、知ってないとなんで動くのかわからないコードにはなる。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0817/>たまには画面作り</a></h1><div class=post-meta><span class=post-date>2022-08-17</span></div><span class=post-tags>#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
#<a href=/diary/tags/migration/>migration</a>&nbsp;
#<a href=/diary/tags/vue.js/>vue.js</a>&nbsp;</span><div class=post-content><p>1時に寝て6時に起きた。</p><h2 id=リファクタリングとインフラ移行>リファクタリングとインフラ移行</h2><p>ここ2週間ほどリファクタリングやらインフラ変更やらをしてきて、来週からまた新しい施設がサービスインするので区切りとしてリファクタリングは一旦終わりにする。今日がその集大成となるインフラ移行も含めた本番リリースだった。インフラ移行するときはなにかしら障害が起きる前提で待機しているものの、今日もすんなりと意図した通りに移行できて、してやったりではあるものの、モノ足りなさで拍子抜けしてしまった。また昨日から社内 wiki にも minikube の使い方、k8s cronjob の設計、バッチ処理の設計と実装についてドキュメントなどを書いていた。いままですべて私が1人で担当していたものを他メンバーでも作業できるようにドキュメント化した。近いうちにいなくなるので引き継ぎのドキュメントにもなる。</p><h2 id=nuxt-で画面作り>nuxt で画面作り</h2><p>ここ最近2種類の web api の機能を作ったのでその管理画面も2つ作る必要がある。私はフロントエンド開発の素人なので他のメンバーが作ってくれないかと声をかけてはいたけど、みんな忙しいようなので私が作ることにした。今週は <a href=https://nuxtjs.org/ja/>nuxtjs</a> の新規画面の開発をがんばってみようと思う。既存のソースを読む限りはそんなに複雑ではなさそう。素人が雰囲気で実装しても動くんじゃないかと思っている。ソースコードを読んでいて url 設計はめちゃくちゃだし、一覧画面にはページング機能も実装されていない。素人がソースを読んで基本的な骨子や機能が正しく実装されてないことがわかってしまうのは品質レベルとしてなにかがおかしい。圧倒的低品質と呼ぶのか、こんなことが起こってしまうのはよい開発文化がないせいなのだろうと考えている。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0330/>暇つぶしのフロントエンド開発</a></h1><div class=post-meta><span class=post-date>2022-03-30</span></div><span class=post-tags>#<a href=/diary/tags/vue.js/>vue.js</a>&nbsp;</span><div class=post-content><p>0時に寝て4時に起きた。起きてから sns のタイムラインを眺めてぼーっとしてた。</p><h2 id=フロントエンド開発>フロントエンド開発</h2><p>先週からタスクがなくて (社員さんが多忙で今スプリントのタスク洗い出しができていない) だらだらしていて、来週から引き取ろうと思っている cdk 周りのインフラ構築の調査を事前に始めようかと考えていた。そういう話を社員さんにしたらフロントエンドの開発を手伝ってほしいと言われた。</p><p>種々雑多なフロントエンドの ui に関する改善要望が十数個あがっていて対応できないのでちょっとでもやってほしいという依頼。少し前に <a href=/diary/posts/2022/0315/##フロントエンド開発>初めてフロントエンド開発</a> に着手して、4つほど PR を送ってマージされた。にも関わらず、社員さんに「開発環境の作り方わかりますか？」と質問を受けた。ちょっときょとんとして「前に PR をいくつか送りましたが、なにか他にやらないといけないことがありますか？」と質問に質問で返した。社員さんもテンパっているのか、過去に私がフロントエンドの PR を出していたことを認識してなかったみたい。vue.js も nuxt も全くわからないので開発スタイルも以前のまま。</p><blockquote><p>全然わからない。俺たちは雰囲気で開発している。</p></blockquote><p>5つほど ui 改善のチケットを fix した。難しいことはわからないので私でもできそうな簡単なものから選択して直していった。そしたら、翌日のデイリースクラムで業務の人たちからすごい勢いで直してくれてるみたいにめっちゃ感謝された。もともと社員さんが他のタスクに忙しくていまできないって業務の人たちに前日断っていたタスク群を、いま手持ちのタスクが何もないので暇を持て余してますという私が fix しているんだから、世の中、訳がわからない。私は普段バックエンド開発している人間だから業務の人たちに感謝されることはおろか、やっていることさえ理解されない方なんだけど、たまに ui とか改善すると感謝されて嬉しいという気持ちは他の開発者よりも強いかもしれない。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0315/>フロントエンド開発着手</a></h1><div class=post-meta><span class=post-date>2022-03-15</span></div><span class=post-tags>#<a href=/diary/tags/vue.js/>vue.js</a>&nbsp;</span><div class=post-content><p>0時に寝て3時に起きて6時に起きた。やっぱり起きてからドラクエタクトしてた。</p><h2 id=フロントエンド開発>フロントエンド開発</h2><p>デプロイ改善が完了したので新しいタスクに取り組み始めた。もともとこの開発チームはバックエンドもフロントエンドも全部やるというチームなので、やりかけ中のタスクのフロントエンド側の変更に着手して、既存の画面に新規項目を追加するといった作業をやってみた。フロントエンドは vue.js + nuxt で開発している。ビルドに30秒ぐらいかかる。ちょっと遅い。宣言型 ui のよいところかもしれないけど、vue.js も nuxt もまったく触ったことないけど、ripgrep で検索してちょちょっとコピペしたらそれっぽく動いた。これはまさにあれだ。</p><blockquote><p>全然わからない。俺たちは雰囲気で開発している。</p></blockquote><p>動いたらラッキーみたいな感じで PR を作って、たまたまレビューも通って、テスト環境で動いたんでラッキーだった。</p></div></div><div class=pagination><div class=pagination__buttons></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/diary/assets/main.js></script>
<script src=/diary/assets/prism.js></script></div></body></html>