<!doctype html><html lang=en><head><title>go :: forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/tags/go/><link rel=stylesheet href=/diary/assets/style.css><link rel=stylesheet href=/diary/assets/green.css><link rel=stylesheet href=/diary/style.css><link rel=apple-touch-icon href=/diary/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="go"><meta property="og:description" content><meta property="og:url" content="/diary/tags/go/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><link href=/diary/tags/go/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1230/>お仕事戻し</a></h1><div class=post-meta><span class=post-date>2022-12-30</span></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/testing/>testing</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;
#<a href=/diary/tags/day-off/>day off</a>&nbsp;</span>
<img src=/diary/img/2022/1230_chair.jpg class=post-cover alt=お仕事戻し><div class=post-content><p>0時に寝て5時に起きた。昨日も疲れていたのか、不思議とよく眠れた。</p><h2 id=年末のお仕事戻し>年末のお仕事戻し</h2><p>朝から近所のマクドナルドへ。今週は月・火とお休みしたため、いつも火曜日に書いている週報を書いていなかった。言うても3日分の作業なのでちゃっちゃと書いて送付した。私が休んだ日の定例会議はスキップされたようでその確認はなし。その後、issue のコメントをみたり、マージリクエストのコードレビューをしたりした。メンバーが課題管理システムを使うようになっているので、私が休んでいても後で見返してコメントを返せる。非同期／テキストコミュニケーションは働く時間帯があわないときに役に立つ。そういう雰囲気を学ぶ機会になればいいかもしれない。ある文字列の変換関数に go 1.18 で追加された fuzzing テストを実装してみようというリファクタリングの issue を追加していた。</p><ul><li><a href=https://go.dev/doc/tutorial/fuzz>Tutorial: Getting started with fuzzing</a></li></ul><p>私自身、まだ自分で実装したことはなかった。fuzzing テストを実装したマージリクエストがあったのでコードレビューした。実際に実行して動いているようにはみえるが、デバッグログを出力できなくてどういった振る舞いをしているのかを確認できなかった。簡単にできるんやと思っていたら意外と難しかった。また後で自分でも実装してデバッグしてみて振る舞いを再確認する。</p><h2 id=小さい椅子>小さい椅子</h2><p>葬儀で斎場に2泊3日過ごしたときに畳の控え室に小さい椅子が4つほど置いてあった。正座が難しいお年寄り向けだと推測する。あの控え室でその小さい椅子を最も活用していたのは私だった。地べたに座るのと小さな椅子に腰掛けるので腰の負担がこんなに違うとは思わなかった。おそらく太ったことも影響している。ラップトップでキー入力するときに正座にしろ、あぐらにしろ、どちらも長時間続けることはできなかった。この小さい椅子なら2-3時間ぐらいは平気で作業できる。気持ち程度の高さでも十分に椅子の役割を果たせるところに感心した。家用に購入して、いま小さい椅子でこの日記を書いている。</p><p><a href="https://www.amazon.co.jp/gp/product/B003VIW0PG?ie=UTF8&th=1&linkCode=li1&tag=t2y-diary-22&linkId=233bef8ca8a08ce7593f84b75fbea8cf&language=ja_JP&ref_=as_li_ss_il" target=_blank><img border=0 src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B003VIW0PG&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=t2y-diary-22&language=ja_JP"></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=t2y-diary-22&language=ja_JP&l=li1&o=9&a=B003VIW0PG" width=1 height=1 border=0 alt style=border:none!important;margin:0!important></p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1211/>休日のオンライン学習</a></h1><div class=post-meta><span class=post-date>2022-12-11</span></div><span class=post-tags>#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/migration/>migration</a>&nbsp;
#<a href=/diary/tags/team-building/>team building</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/programming/>programming</a>&nbsp;</span><div class=post-content><p>0時に寝て夜中に吐き気がして2回ほど起きて3時と5時に起きて8時に起きた。なかなか苦しい寝方をした。</p><h2 id=ヤフートラベルと一休comのシステム統合>ヤフートラベルと一休.comのシステム統合</h2><p>アーカイブ公開されたらみようと思いつつ忘れてたので見返した。</p><div class=video-container><iframe src=https://www.youtube.com/embed/JN4kGYbQMJ8 allowfullscreen title="ヤフートラベルのシステムリニューアル 一休 com とのシステム統合 -日本語版-"></iframe></div><p>雑なめも。また機をみて見返すこともあるかも。</p><ul><li>バックエンドは完全に一休側に寄せるという大きな意志決定を2016年に行った<ul><li>この意志決定はフロントエンド統合にも大きな影響を与えた</li><li>ふじもんさんの意志決定がよかった？</li></ul></li><li>今日の話しはマルチブランドデザインシステム統合がメイン<ul><li>開発者が50-60人程度で半年ぐらいで launch できた</li><li>nuxt/vuejs で開発している</li><li>スタイルは tailwindcss を使っている</li><li>実は launch した後にこのシステムが必要だとわかった<ul><li>開発者とデザイナー間の細かい意思疎通が困難</li><li>外部からデザインシステムに詳しい人にも来てもらっていろんな議論をした</li><li>ガイドラインを言語化するところから始め、最終的にソースコードの共有ができるようになった</li></ul></li><li>終わってからデザインシステムそのものは重要ではないと気付いた<ul><li>この過程で開発者とデザイナー間のどのように共通化するか、あるいはしないかと議論を繰り返し行ったことが重要だったと当事者がインタビューで語っていた</li><li>デザインシステムの開発を通じてデザインの共通認識をもてたことがよかった</li></ul></li></ul></li><li>波及効果<ul><li>同じソースコードから少し異なる体験の開発のノウハウができた</li><li>ふるさと納税に特化した宿泊予約サイトを作った</li></ul></li><li>統合は終わりではない、lauch したところが始まり<ul><li>統合後にいろいろな施策をすることで課題がみえてくることがある</li></ul></li><li>全国旅行支援は1つの開発で2つの体験をつくることができた</li><li>Q. デザイナーと開発者はわりと仲が悪いのでは？価値観や考え方が異なるのですり合わせるのは難しいのでは？<ul><li>過去の一休でも起きていた</li><li>一休のチームはデザイナーと PM と開発者で構成されている<ul><li>このチームが一緒に働いていてチームでなるべく意志決定している</li><li>普段から一緒に働いていると仲が悪いということはなかった</li><li>とはいえ、仕事のプロセスが異なるので課題はあった<ul><li>地道に丁寧にすり合わせを行った</li><li>外部から講師を読んで中立的な立場でワークショップを何度も行った</li></ul></li></ul></li><li>デザイナーと開発者を別の組織にしているとコミュニケーションの壁ができてしまうかもしれない</li></ul></li></ul><h2 id=go-の学び直し>go の学び直し</h2><p><a href=/diary/posts/2022/1123/#go-の学び直し>テストの学び直し</a> に引き続き、<a href=https://tenntenn.connpass.com/event/267564/>Gopher塾 #2 - Goらしいコードの書き方 - DAY 1</a> に参加した。</p><p>テストの次のプログラミングの話しだったので内容そのものは難しくはなかったけど、改めて重要な項目を選抜しているのだと考えると学びはあったと思う。参考になったことをいくつか覚えている範囲でまとめる。名前の付け方について感覚的に理解していたし、実際に私はそうしているけど、コードレビューしていて自然になっていないコードを指摘する機会も多いので一定の習熟を要するのかもしれない。いま毎週勉強会をやっていて私が講師として話している。ネタがなくなってきたり大変になったきたら準備の少ないコードリーディング会もやってみたいと思った。</p><ul><li><a href=https://google.github.io/styleguide/go/>google Go Style</a></li><li><a href="https://cs.opensource.google/go/x/pkgsite/+/master:internal/derrors/derrors.go;l=237">derrors.Wrap</a></li><li>名前に文脈を与えるという概念<ul><li>相対的な名前をつける</li></ul></li><li>準備の少ないコードリーディング会<ul><li>お題（読むパッケージ）を決める</li><li>選んだお題に期待することを当日話す</li><li>時間を決めてみんなでそれぞれ読む（20分とか）</li><li>読みながらSlackのスレッドにメモをしていく</li><li>残りの時間で気になったところを議論する</li><li>自分が気づけなかった点を知ることができる</li></ul></li></ul></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1206/>echo のよさの1つはテストがやりやすい</a></h1><div class=post-meta><span class=post-date>2022-12-06</span></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;</span><div class=post-content><p>にわかサッカーファンになって、20時頃に1-2時間寝て24時からワールドカップのクロアチア戦をみて3時に寝て8時に起きた。睡眠のリズムが完全に狂ってしまった。</p><h2 id=echo-のテストのやりやすさ>echo のテストのやりやすさ</h2><p>うちのチームでは http フレームワークに <a href=/diary/posts/2022/1122/#echo-を採用>echo を採用</a> している。その後、開発を継続していていくつか http ハンドラーも実装されてきた。そろそろ http ハンドラーのテストを書いていこうと参照実装を私が書いてみた。メンバーが知らないことは、マネージャーの私が参照実装して教えるといったやり方をしている。echo.HandlerFunc に echo.Context を渡すシンプルなインターフェースはテストを書くときに http ハンドラー以外の依存関係 (例えば db とのコネクションなど) を context を介することでモックと差し替えるのが容易になる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>tests</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>name</span>    <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ctx</span>     <span style=color:#a6e22e>echo</span>.<span style=color:#a6e22e>Context</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span>     <span style=color:#f92672>*</span><span style=color:#a6e22e>echo</span>.<span style=color:#a6e22e>HTTPError</span>
</span></span><span style=display:flex><span>} {
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>func</span>() <span style=color:#a6e22e>echo</span>.<span style=color:#a6e22e>Context</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>data</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>`{...}`</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>c</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>newEchoContext</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>MethodPost</span>, <span style=color:#e6db74>&#34;/endpoint&#34;</span>, <span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Set</span>(<span style=color:#e6db74>&#34;db&#34;</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>myMockDB</span>{})
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>
</span></span><span style=display:flex><span>	}(),
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>myHTTPHandler</span>(<span style=color:#a6e22e>ctx</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>こんな感じで context にモックを入れてしまえば http ハンドラーそのものの単体テストを簡単に書ける。そんなことをツィートした。</p><blockquote class=twitter-tweet><p lang=ja dir=ltr>その後 echo を採用して echo のよいところに1つ気付いた。echo.HandlerFunc に echo.Context を渡すインターフェースはテストがやりやすい。例えば、コンテキストで db のコネクションを保持しておけば、テストのときにモックに差し替えて http ハンドラーの単体テストを実装しやすい。</p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1600337204286746624?ref_src=twsrc%5Etfw">December 7, 2022</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>そしたら podhmo からレスをもらったので go のリクエストコンテキストの扱いについても議論した。</p><ul><li>リクエストスコープのものを context に入れるのは同意</li><li>それ以外のスコープのものを context に入れるのは懸念がある<ul><li>http ハンドラーのレイヤーとアプリケーションのレイヤーが明確に分かれているならまだ理解できる</li><li>アプリケーションのレイヤーで context を自由に使うと依存関係や統制が取れなくなる<ul><li>これは私も同意するところでアプリケーションのレイヤーにリクエストコンテキストを渡す必要はない</li></ul></li></ul></li></ul><blockquote class=twitter-tweet><p lang=ja dir=ltr><a href=https://t.co/Yomdbyh1H0>https://t.co/Yomdbyh1H0</a><br><br>昔にこういう記事を書いてた。<br>chiはルーティングライブラリと考えるとスムーズ。<br><br>あとはnet/httpのミドルウェアを使いたいかechoなど専用のものを書くかの違いくらいかな。 <a href=https://t.co/9LtoanpY0c>https://t.co/9LtoanpY0c</a></p>&mdash; po (@podhmo) <a href="https://twitter.com/podhmo/status/1600338082242646016?ref_src=twsrc%5Etfw">December 7, 2022</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><h2 id=オフィス住所の更新>オフィス住所の更新</h2><p>引き続き、住所変更の手続きを時間をみつけてやっている。同じ銀行の住所変更の手続きでも PayPay 銀行と三菱 UFJ 銀行ではまったく異なる。前者はオンラインでアカウント情報を変更するだけで済んだ。簡単。一方で後者はオンラインではできず、来店予約をとって対面で行う。当日に登記事項証明書の原本をもってこいと。なんという面倒臭さ。よくよく考えたら法人の登記事項証明書は誰でも取得できる。行政のシステムがどうなっているか知らないが、銀行が法人の住所変更を自分たちで調べることもやろうと思えばできるはず。登記事項証明書をオンラインで取得する手数料は500円になる。来店予約すると応対する人の人件費を考えたらシステムの手数料を支払った方が安いのではないか。</p><p>国税庁の管轄ではあるが、<a href=https://www.houjin-bangou.nta.go.jp/>国税庁法人番号公表サイト</a> から法人の住所変更そのものは確認できる。これは e-tax で次の2つの書類を申請した。登記事項証明書がなくても申請はできた。なにも言ってこなければ問題ないのかな？</p><ul><li>異動届</li><li>給与支払事務所等の開設・移転・廃止の届出</li></ul><p>有償にはなるが <a href=https://www1.touki.or.jp/night.html>登記情報提供サービス</a> というのがあって登記情報をオンラインで確認できる。このサービスを会社で契約していればいつでも確認できるはず？</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1123/>go の学び直し テスト編</a></h1><div class=post-meta><span class=post-date>2022-11-23</span></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/testing/>testing</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;</span><div class=post-content><p>23時に寝て2時に起きて気分悪くて寝付けずにだらだらしながら気付いたら5時になっていた。その後いつの間にか寝て8時に起きた。</p><h2 id=go-の学び直し>go の学び直し</h2><p><a href=https://tenntenn.connpass.com/event/265342/>Gopher塾 #1 - Testing - DAY 3</a> に参加した。</p><p>マネージャーとして go 開発のマネジメントをしているため、メンバーの開発者よりは知識やスキルが高くないとコードレビューや適切な指示ができない。2018年ぐらいまで go 開発をしていたが、その後はずっと java 開発をしていたため、最近の go 開発の話題はあまり把握していない。毎週チーム勉強会 (いまのところ、go 開発の話題) をやっていると、チーム外からも開発者が参加してくれるようになった。チーム外からの開発者が go 開発するときの参考にもなるよう、マネージャーのお仕事の付加価値として、組織全体へ go 開発の知識やスキルを提供できればと考えながら働いている。</p><p>今回はテストについて話題で7割ぐらいは知っている知識ではあったが、3割ぐらいは最近の話題や静的解析の知見からの深い洞察を話されていてとても参考になった。知っている知識でも幅広いテストの話題の中で厳選されたコンテンツになるのだろうから本質的に大事なことや最初に学ぶべき優先事項を知ることもできた。私がメンバーに教えるときのコンテンツの参考として役に立つ。まったく知らなかった話題としては、txtar というテキストをアーカイブしたフォーマットをファイルシステムとして扱えるようにした <a href=https://github.com/josharian/txtarfs>txtarfs</a> や、1.18 から追加された <a href=https://go.dev/security/fuzz/>fuzzing</a> というテストの入力値を自動生成する機能が追加されたこと。あと groovy でいうところの power assert に近い機能を提供するライブラリとして <a href=https://github.com/google/go-cmp>google/go-cmp</a> をいまはテストに使うらしい。たまたま <a href=https://github.com/golang/go/wiki/TestComments#equality-comparison-and-diffs>Go Test Comments</a> を読んでいたら go-cmp は go の開発チームが保守していて go のバージョンに依らずほとんどの比較の要件にあうツールのように説明されていて利用を推奨している。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1122/>元同僚の来訪</a></h1><div class=post-meta><span class=post-date>2022-11-22</span></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;
#<a href=/diary/tags/kobe/>kobe</a>&nbsp;</span><div class=post-content><p>0時に寝て4時に起きてドラクエタクトしてだらだらして7時に起きた。</p><h2 id=echo-を採用>echo を採用</h2><p>昨日の続き。echo か chi でそれぞれサンプルコードを書いたものを定例でメンバーに説明して echo に決まった。echo は知っているメンバーもいたけど、chi は知らなかったみたい。アプリケーションに近いせいか echo の方が認知度が高いみたい。既存コードの移行は私がちゃちゃとやろうと着手したものの、わりとコードが込み入っていて2-3時間でできるものでもなかった。環境変数周りの処理も dry の原則に違反していたので <a href=https://github.com/caarlos0/env>caarlos0/env</a> を使うことにした。エントリーポイント周りのコードをリファクタリングして merge request を作成した。明日中には既存の http ハンドラー周りの移行をしてレビューができるようにしておきたい。</p><h2 id=遠方より来たる>遠方より来たる</h2><p>たまたまタイムラインで元同僚が近くに来るというのをみかけてせっかくの機会なので晩ご飯を食べに行ってきた。大阪に泊まっているのにわざわざ神戸まで足を運んでくれた。感謝。ゲームのコミュニティに属していると私は思っていたのだけど、最近はゲームよりも vr の世界の住人らしくて、vr の世界のコミュニティに入り浸っているらしい。そんな生活を何年もしているうちに仲間うちで仲良くなって、たまにオフ会で会ったりもするとのこと。全国に vr の世界の仲間がいるから出張したときにオフ会したりするそうな。oculus quest 2 をもっているけど workrooms ぐらいしか使ってなくて、若い人はもっと進んでいるなと感心をもって聞いていた。</p><p>内製のデータベースのプロダクトが完成して社内でも使ってもらう運用段階まできたとのこと。データベースをフルスクラッチから3年かけて開発できるだけの余裕のある会社は少ないだろう。本人もいくつか社内・社外の事情が重なってプロジェクトが中止にならず運がよかったと話されていた。開発の区切りもついたので今後のキャリアや転職も含めていろいろ考える時期になっているみたい。まだ30歳前後だと思うのでいろいろ挑戦したらよいと思う。</p><p>帰りに三ノ宮の街並みも少し紹介した。三宮という地名は他にも一宮から八宮まであって <a href=https://www.shoko-dw.com/shrine8/index.html>神戸八社</a> と言う。間違えて九まであると言ってしまった。八までだった。2021年に <a href=https://ja.wikipedia.org/wiki/%E7%A5%9E%E6%88%B8%E4%B8%89%E5%AE%AE%E9%98%AA%E6%80%A5%E3%83%93%E3%83%AB>神戸三宮阪急ビル</a> が完成して阪急三宮駅の周辺が再整備された。夜歩きしても楽しめる雰囲気にはなっている。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1121/>http フレームワークの選び方</a></h1><div class=post-meta><span class=post-date>2022-11-21</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/design/>design</a>&nbsp;</span><div class=post-content><p>昨夜いろいろあって帰ってくるのが0時過ぎになった。23時過ぎから雨降りで雨の中、自転車で帰ってきた。2時に寝て5時に起きて7時半に起きた。危うく寝坊するところだった。</p><h2 id=母の入院>母の入院</h2><p>昨夜のいろいろのすべて。最悪の事態を想定してお手伝い先にも今日休むかも？と昨日の夜時点で一報を入れていた。結論としては休む必要はなかった。「ろれつが回らない」という連絡を受けて姉が救急車で病院へいくことを指示して即検査で即入院した。母は過去に目がみえなくなって脳梗塞だったことがある。幸い一通り検査して問題はなかったものの、念のために2日間入院して明日退院する予定。姉に病院の付き添いとかいろいろやってもらったので、私も週末に帰って様子をみてくる。お仕事が立て込んでてんやわんやだけど、そのために神戸で自分の会社をやっているのもあるので仕方ない。母は車を運転しない方がよいだろうという見立てで週末にレンタカーも借りた。久しぶりに高速バスではなく、高速道路をドライブしながら実家へ帰る。</p><h2 id=echo-と-chi-でサンプルコードを書いてみた>echo と chi でサンプルコードを書いてみた</h2><p><a href=/diary/posts/2022/1117/#go-の-http-フレームワークの選定>go の http フレームワークの選定</a> の続き。明日、定例があるのでメンバーにソースコードを共有しつつ、http フレームワークの採用を決めようと考えている。特定のルーティングとミドルウェアの適用をする簡単なサンプル。</p><ul><li><a href=https://gitlab.com/t2y/echo-sample>https://gitlab.com/t2y/echo-sample</a></li><li><a href=https://gitlab.com/t2y/chi-sample>https://gitlab.com/t2y/chi-sample</a></li></ul><p>net/http のレイヤーであれこれカスタマイズしたいなら <a href=https://github.com/go-chi/chi>chi</a> でよい気もするけど、web api のアプリケーションのレイヤーにのみ注力したいなら <a href=https://echo.labstack.com/>echo</a> を使った方が楽そうという私の第一印象。web api サーバーを書いてて request のパラメーターを扱うことはあっても response writer を扱う必要性をあまり感じたことがない。json しか返さないのだし、構造体を返したら勝手に json に変換してくれたらそれでいいんじゃないかと私は考えている。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1118/>新しいお仕事で3週間</a></h1><div class=post-meta><span class=post-date>2022-11-18</span></div><span class=post-tags>#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;</span><div class=post-content><p>2時に寝て4時に起きて仮眠して6時半に起きた。たぶん寝たんだろうぐらいの感覚。10月まで対外的には週4日で働いていたのを、11月から週5日フルタイムの働き方に移行して、やっぱりしんどいという実感がある。対外的に週4日でも10月もオフィスに来て自社のお仕事をしていたり、半日ぐらいは社外のお仕事をしたりはしていた。それでも働く義務の有無によって、意識の違いか、プレッシャーやストレスの面からなにか働き方が違うように思える。生活も働き方もまったく同じなのに。</p><h2 id=盛り上がってないイベント>盛り上がってないイベント</h2><p><a href="https://twitter.com/hashtag/techverse_ja?src=hashtag_click&f=live">ハッシュタグ</a> をみてもほとんど関係者や発表者しかコメントしていないようにみえた。過去に新規事業の立ち上げに協力したプロジェクトの発表があると元同僚のタイムラインで知ったのでその発表だけみてみた。私が辞めてから3年ほど経つので新規サービスも追加されていてその内容がメインだったように思う。</p><ul><li><a href=https://tech-verse.me/ja/sessions/133>DataSolution事業を支える技術</a></li></ul><iframe class=speakerdeck-iframe frameborder=0 src=https://speakerdeck.com/player/86cb588632a647e9baf4697c8f79110e title="Technologies that Support the Data Solution Business" allowfullscreen mozallowfullscreen=true webkitallowfullscreen=true style="border:0;background:padding-box padding-box rgba(0,0,0,.1);margin:0;padding:0;border-radius:6px;box-shadow:rgba(0,0,0,.2)0 5px 40px;width:560px;height:314px" data-ratio=1.78343949044586></iframe><p>あまり技術的な内容ではなく、ビジネス向けでもなく、どういった属性の聴衆向けの発表なのか、私にはあまりピンとこなかった。発表の準備不足な印象を受けた。発表を無理やり押し付けられたのかもしれない。</p><h2 id=go-の-time-型とタイムゾーン>go の Time 型とタイムゾーン</h2><p>go の <a href=https://pkg.go.dev/time#Time>Time</a> 型は <a href=https://pkg.go.dev/time#Location>Location</a> をもっていて、タイムゾーンも一緒に扱える。モダンな言語なら時刻を扱うときにタイムゾーンをセットで扱うのでよいと私も思う。タイムゾーンをもっていない時刻型とタイムゾーンを設定するための余分なコードのことを考えずに済む。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>mustGetJST</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Location</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>jst</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>LoadLocation</span>(<span style=color:#e6db74>&#34;Asia/Tokyo&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>jst</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>now</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;now:&#34;</span>, <span style=color:#a6e22e>now</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;jst:&#34;</span>, <span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>In</span>(<span style=color:#a6e22e>mustGetJST</span>()))
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;utc:&#34;</span>, <span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>UTC</span>())
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>実行結果。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ export TZ<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;CET&#34;</span>
</span></span><span style=display:flex><span>$ go run test_time_now.go
</span></span><span style=display:flex><span>now: 2022-11-18 17:00:30.08305121 +0100 CET m<span style=color:#f92672>=</span>+0.000011788
</span></span><span style=display:flex><span>jst: 2022-11-19 01:00:30.08305121 +0900 JST
</span></span><span style=display:flex><span>utc: 2022-11-18 16:00:30.08305121 +0000 UTC
</span></span></code></pre></div></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1117/>技術選定の根拠</a></h1><div class=post-meta><span class=post-date>2022-11-17</span></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/programming/>programming</a>&nbsp;</span><div class=post-content><p>0時に寝て5時に起きた。夜中に目覚めたかどうかはわからないぐらいにはたぶん寝てたと思う。</p><h2 id=go-の-http-フレームワークの選定>go の http フレームワークの選定</h2><p>net/http で実装していた web api サーバーにフレームワーク導入しようかと考えている。いままでは認証・認可を外部で行う想定だったが、やっぱり api サーバーに実装した方がよいだろうと要件を再確認したので routing と middleware を再利用できるフレームワークを使うメリットが出てくる。net/http 上で直接 routing, middleware を実装するのは別に難しくないから自分で実装すればよいという考え方がある。一方で誰が実装しても大して変わらないものを車輪の再発明する必要があるのかというところに私は懸念に感じる。また <a href=https://pkg.go.dev/context>context</a> があとから標準ライブラリに追加されたため、net/http の HandlerFunc は context をシグネチャにもっていない。リクエストコンテキストをもっていないのが net/http の欠点だと私は考えていた。しかし、調べてたら <a href=https://pkg.go.dev/net/http#NewRequestWithContext>NewRequestWithContext</a> が追加されていてハンドラーではなくリクエストからリクエストコンテキストを扱えるようになっていた。これは私の勘違いだった。</p><p>フレームワークを使おうと決めて難しいのはなにを選ぶか。最近の流行り廃りや動向を私は知らないので基準がない。たまたましぶかわさんの記事をみつけて読んでいた。</p><ul><li><a href=https://future-architect.github.io/articles/20210714a/>Goのおすすめのフレームワークはnet/http</a></li></ul><p>この中で紹介されている <a href=https://github.com/go-chi/chi>chi</a> か <a href=https://echo.labstack.com/>echo</a> のどちらかにしようと直観で決めた。echo は以前 go の勉強会をしたときにいけうちさんが採用していたのでよく覚えている。そのときの話しを聞いていてもよさそうにみえた。たまたま echo のサイトをみたら Shiguredo さんのロゴがあって驚いた。スポンサーをされているらしい。chi はまったく知らない。どちらも十分によく使われていて middleware も揃っているフレームワークにみえる。本質的にはどちらを選んでも構わない。一方でマネージャーとしてどういう調査をして、どういう根拠で、どの技術を選定するのか。メンバーに対して説明責任を果たすためにこの2つのフレームワークの調査をすることに決めた。私自身がどちらもフレームワークも使ったことがないので軽くコードも書いてみてどんな雰囲気なのか感触を掴みつつ、フレームワークのソースコードも読んでみようと思う。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1114/>久しぶりに go のテストコードを書いた</a></h1><div class=post-meta><span class=post-date>2022-11-14</span></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/testing/>testing</a>&nbsp;</span><div class=post-content><p>0時に寝て3時と5時に起きて7時に起きた。まぁまぁ眠れたと思う。</p><h2 id=go-のテストコードのサンプル>go のテストコードのサンプル</h2><p>先日 <a href=/diary/posts/2022/1111/#Logger-の再実装>Logger のコード</a> を書いて、テストコードのサンプルも書いてみた。いま微妙に <a href=https://github.com/golang/go/wiki/TableDrivenTests>TableDrivenTests</a> が書けてないので参照実装として Logger のデータ駆動テストを書いてチームに共有した。私も future さんのテストのチュートリアル記事を読みながら復習してた。</p><ul><li><a href=https://future-architect.github.io/articles/20200601/>Goのテストに入門してみよう！</a></li></ul><p>昔、私が go 開発していた頃にはなかった新機能としてサブテストを並列に実行できる。</p><ul><li><a href=https://pkg.go.dev/testing#hdr-Subtests_and_Sub_benchmarks>Subtests and Sub-benchmarks</a></li></ul><h2 id=uuid-ライブラリの歴史的経緯>uuid ライブラリの歴史的経緯</h2><p>たまたま Version 1 UUID を返す <a href=https://pkg.go.dev/github.com/google/UUID#NewUUID>NewUUID</a> のコードをみていて、err を返しているけど、現時点の実装では err が返ることはなく、これは歴史的経緯でシグネチャを変える方が影響が大きいだろうという意図でそうなっているらしい。</p><ul><li><a href=https://github.com/google/uuid/issues/83>https://github.com/google/uuid/issues/83</a></li></ul><p>ここでは <a href=https://pkg.go.dev/github.com/google/UUID#New>New</a> を使えとも書いてあるけれど、これはエラーが発生したときに panic が発生するのでこれはこれでいいんやろか？という疑問も出てくる。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1111/>ログおじさん</a></h1><div class=post-meta><span class=post-date>2022-11-11</span></div><span class=post-tags>#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
#<a href=/diary/tags/mermaid/>mermaid</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/logging/>logging</a>&nbsp;</span><div class=post-content><p>23時に寝て3時半に起きて眠れそうになかったからそのまま5時からオフィスで作業してた。</p><h2 id=システム構成の検討>システム構成の検討</h2><p>コンサルタントから顧客要件のヒアリングを行い、プロダクトを提供するインフラのシステム概要を mermaid で書いた。オンプレとクラウド環境のそれぞれを同じコンテナアプリケーションで動かすための構成を検討した。クラウド環境の一例として aws の構成を考えていて、https と http のプロトコル変換のようなことをするには api gateway を経由しないといけないと考えていたら、alb に証明書を設定して api gateway なくてもいけるとはらさんに教えてもらった。昔からできたそうで、なぜか私が長い間ずっと勘違いしていた。また時間があるときに自分でもやってみようと思う。</p><ul><li><a href=https://dev.classmethod.jp/articles/for-begginer-ssl-communication-by-aws-certificate-manager/>AWS Certificate Managerを使用してインターネットからELBへの通信をHTTPS化してみた</a></li></ul><h2 id=logger-の再実装>Logger の再実装</h2><p>プロダクトのコアな部分の実装は私がみた方がよいだろうと考えていて、そのうちの1つ Logger の設計がよくなかったので私が作り直した。といっても <a href=https://github.com/cybozu-go/log>cybozu-go/log</a> を使った薄いラッパーを設けただけ。チームメンバーからどこでエラーが起きているか追跡しにくいという声があったのでログ出力したところのソースコードの情報を出力しようと考えた。ググればたくさん出てくる。スタックフレームにアクセスする標準パッケージとして runtime を使うとできる。<a href=https://pkg.go.dev/runtime#Caller>runtime.Caller</a> と runtime.Callers は似て非なる関数のようでファイル名と行番号だけでよければ Caller を使った方がシンプルになると思う。関数名もほしかったら Callers を使ったスタックフレーム自体から取得する必要がある。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Trace</span>(<span style=color:#a6e22e>skip</span> <span style=color:#66d9ef>int</span>) (<span style=color:#a6e22e>file</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>funcName</span> <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pc</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>uintptr</span>, <span style=color:#ae81ff>15</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>n</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>Callers</span>(<span style=color:#a6e22e>skip</span>, <span style=color:#a6e22e>pc</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>frames</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>CallersFrames</span>(<span style=color:#a6e22e>pc</span>[:<span style=color:#a6e22e>n</span>])
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>frame</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>frames</span>.<span style=color:#a6e22e>Next</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>_file</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>frame</span>.<span style=color:#a6e22e>File</span>[<span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Index</span>(<span style=color:#a6e22e>frame</span>.<span style=color:#a6e22e>File</span>, <span style=color:#a6e22e>sourceRepositoryPath</span>)<span style=color:#f92672>+</span><span style=color:#ae81ff>8</span>:]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>file</span> = <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;%s:%d&#34;</span>, <span style=color:#a6e22e>_file</span>, <span style=color:#a6e22e>frame</span>.<span style=color:#a6e22e>Line</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>frame</span>.<span style=color:#a6e22e>Function</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>この情報を cybozu-go/log の map に追加するようなログ関数を提供するようにした。cybozu-go/log は標準の log パッケージに足りないところだけを追加していて、そのシンプルさと拡張性の高さを私は気に入ってよく使っている。私が気に入っているのでもっと有名になってほしい。</p><p>前のお手伝いでもログ基盤を含めて Logger を作っていて、またいまも Logger を作り直していて、気付いたら私は Logger やログ出力に一家言あるような、ログおじさんになりつつある。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1110/>よい go コードを書くためのガイド</a></h1><div class=post-meta><span class=post-date>2022-11-10</span></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/programming/>programming</a>&nbsp;</span><div class=post-content><p>2時に寝て6時に起きて2度寝したら8時だった。生活リズムがおかしい。</p><h2 id=go-code-review-comments-の学び直し>Go Code Review Comments の学び直し</h2><p>私の周りでは <a href=https://github.com/golang/go/wiki/CodeReviewComments>Go Code Review Comments</a> というドキュメントが引用されているのをよくみかける。google 社での go のコードレビューのときによくある指摘をまとめたものである。pr/mr を送る前にこれぐらいは自分でチェックしようといったガイドになる。私自身、過去に何度か読んでいるとは思うが、久しぶりに go 開発をするので学び直しも兼ねて読み直すことにした。うちのチームは java 開発者が多いせいか、go のコードで go っぽくないところがいくつか散見されていた。チームメンバーにも共有する意図も含めて2回にわけて勉強会をしてみんなで読み合わせをする。その下調べとして既存のコードでこのガイドに準拠していないコードがあればそれはわかりやすい事例になるので探したりしていた。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1108/>設計談義</a></h1><div class=post-meta><span class=post-date>2022-11-08</span></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/design/>design</a>&nbsp;</span><div class=post-content><p>0時に寝て6時に起きた。2時と3時ぐらいに起きたけど、まぁまぁ眠れた。</p><h2 id=go-の-interface-の考え方>go の interface の考え方</h2><p>メンバーと設計の議論をしていて interface の考え方の概念を誤解しているように感じたので <a href=https://github.com/golang/go/wiki/CodeReviewComments#interfaces>Go Code Review Comments の interfaces</a> で書いてあることの意図や背景などを解説した。メンバー全員を集めて30分ほどで説明した。既存のコードは過剰に interface を設計していて、特定のメソッドを呼び出すラッパー関数を設けて、そのシグネチャに interface を受け取って構造体のメソッドを呼び出すコードを書いている。こんな感じのコード。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>myBehavior</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>doSome</span>(<span style=color:#a6e22e>data</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>myObject</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>myBehavior</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>o</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>myObject</span>) <span style=color:#a6e22e>doSome</span>(<span style=color:#a6e22e>data</span> <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>handleSome</span>(<span style=color:#a6e22e>o</span> <span style=color:#a6e22e>myBehavior</span>, <span style=color:#a6e22e>data</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>doSome</span>(<span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>handleSome のようなラッパー関数は不要だし、myObject の構造体に interface を埋め込む必要はないし、Go Code Review Comments では構造体を定義しているところで interface を提供しない方が保守コストが下がってよいよと提案している。これは java のような nominal subtyping と go の structural subtyping の違いで go らしい interface は構造体の提供側ではなく、呼び出し側で勝手に定義して任意の振る舞いを強制できるといった内容を java と go のコードを比較しながら説明した。そして、この話しが重要になるのはサードパーティのライブラリを利用するときに interface が変わると、それを使っている開発者に大きな影響を与えるので interface を提供するなら慎重に練ったものを公開しないといけないという java 開発から得られた知見などが影響しているのではないかという私見も話した。さらに自分たちが管理しているコードなら interface が変わろうが struct のメソッドが変わろうが、すべて自分たちが変更できる権限をもっているから設計時に厳密に interface やメソッドの振る舞いを詰めきれなかったとしても、後から必要ならいつでもいくらでも変えればいいだけと一緒に話した。開発のバランス感覚は経験からでないと身に付かないものだと思う。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1104/>出張の最終日</a></h1><div class=post-meta><span class=post-date>2022-11-04</span></div><span class=post-tags>#<a href=/diary/tags/information-exchange/>information exchange</a>&nbsp;
#<a href=/diary/tags/issue-tracking-system/>issue tracking system</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;</span>
<img src=/diary/img/2022/1104_book-and-bed1.jpg class=post-cover alt=出張の最終日><div class=post-content><p>0時に寝て7時に起きた。疲れているせいか、よく眠れたと思う。わりと出張でよく眠れているので普段眠れていなかったのは体力が余っているからではないかという気もしてきた。</p><h2 id=課題の洗い出し>課題の洗い出し</h2><p>一昨日の続きでわかっていることや進捗のあったものを確認しながら、追加で課題を作って整理していく。まだまだ課題が足りないのでどんどん作っていかないといけない。それと同時に go のソースコードを読みながら設計や改善の要点を私の中で把握していく。java に慣れたプログラマーが書いた go のコードなので java の考え方の影響が強いようにみえた。私がいくつかアドバイスする余地はあるようにみえた。google でコードレビュー時によくある指摘事項をまとめた有名な wiki がある。メンバーに聞いたらちゃんと読んだことがないということだったので2-3回かけてみんなで読んで学ぶ機会にする。私自身、数年前に読んで忘れていていることも多いだろうから学び直し。テストのページは2019年9月に追加されている。たぶん読んだことない。</p><ul><li><a href=https://github.com/golang/go/wiki/CodeReviewComments>https://github.com/golang/go/wiki/CodeReviewComments</a></li><li><a href=https://github.com/golang/go/wiki/TestComments>https://github.com/golang/go/wiki/TestComments</a></li></ul><h2 id=課題管理勉強会>課題管理勉強会</h2><p>1時間分ぐらいの資料を用意したつもりが35分で終わってしまった。勉強会の雰囲気が固かったのか、慣れない場所での説明だったのか、マスクした状態で長々と話すことも過去に一度もやったことなくて話しにくかった。初めての試みであまりうまくいかなかったが、初めてやることでうまくいかないのは私にとって当たり前のことなので次の勉強会に向けて改善していきたい。どのぐらい伝わったのかわからないけれど、もっと参加者を巻き込んだ活気のある勉強会になるように努めていきたい。</p><h2 id=リアル飲み会>リアル飲み会</h2><p>19時から3年ぶりに友だちとリアル飲み会。せっかく東京に行く機会だからと5日のうち3日飲んでいたので後半になるほどバテていった。これは加齢による体力低下もあるのだろう。娯楽はどういうものか？という定義や在り方の議論が盛り上がって、私は暇つぶしの時間であって何もしないのでぼーっとしているのも退屈だからその時間を埋めるもの、楽しければいいけど楽しくなくても、どうせ何もしない時間なのであまり気にしないといった考え方をしている。私の友だちは楽しむために娯楽に集中するとか、その時間を無駄にしないようになるべく楽しめる娯楽を選択するとか、24時間のうち、1時間足りとも無駄な時間にはしないぞという姿勢がみえて、私からみたらそんな生活はしんどくないですか？みたいな気持ちになった。おそらく時間を無駄にしたことがストレスになるからそういう姿勢になるのだろうと推測する。娯楽をしながらだらだら時間を過ごすということはないらしい。オンライン飲み会はちょくちょくしていたものの、3年ぶりにオフ会をしたので飲食代をご馳走になった。感謝。前も会社を作った後の飲み会でご馳走になっていて、なかなか私からお返しできていない。それを覚えておくためにもここに書いておく。</p><h2 id=本棚に埋もれて眠る>本棚に埋もれて眠る</h2><p>この日は <a href=https://bookandbedtokyo.com/ja/shinjuku/>新宿 BOOK AND BED TOKYO</a> に泊まった。前に浅草の同施設に泊まったことはあったけれど新宿は初めて。大雑把に言えば本屋とカプセルホテルが合体したような施設になる。この非日常の雰囲気が好きなので機会があれば泊まるようにしている。宿泊費は6,000円とカプセルホテルより高くビジネスホテルより安いという価格帯。ここに来て本を読んだり泊まったりしている人はコワーキングスペースもしくはコミュニティ的なスペースが好きで本も好きな人たちだと思う。勉強会に行く感覚と似ている。そういう自分と似た人たちが集まる空間そのものが価値観の共有だったり安心感につながっていて私はそういう空気も楽しんでいたりする。とはいえ、バテバテで疲れていたので少しだけ本を読んでわりとすぐに寝た。</p></div></div><div class=pagination><div class=pagination__buttons><span class="button previous"><a href=/diary/tags/go/><span class=button__icon>←</span>
<span class=button__text>最近の日記</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/diary/assets/main.js></script>
<script src=/diary/assets/prism.js></script></div></body></html>