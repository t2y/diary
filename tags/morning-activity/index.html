<!doctype html><html lang=en>
<head>
<title>morning activity :: forest nook</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=keywords content>
<meta name=robots content="noodp">
<link rel=canonical href=/diary/tags/morning-activity/>
<link rel=stylesheet href=/diary/assets/style.css>
<link rel=stylesheet href=/diary/assets/green.css>
<link rel=stylesheet href=/diary/style.css>
<link rel=apple-touch-icon href=/diary/img/apple-touch-icon-192x192.png>
<link rel="shortcut icon" href=/diary/favicon.ico>
<meta name=twitter:card content="summary">
<meta name=twitter:site content="t2y">
<meta name=twitter:creator content>
<meta property="og:locale" content="en">
<meta property="og:type" content="website">
<meta property="og:title" content="morning activity">
<meta property="og:description" content>
<meta property="og:url" content="/diary/tags/morning-activity/">
<meta property="og:site_name" content="forest nook">
<meta property="og:image" content="/diary/favicon.ico">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<link href=/diary/tags/morning-activity/index.xml rel=alternate type=application/rss+xml title="forest nook">
</head>
<body class=green>
<div class="container full headings--one-size">
<header class=header>
<div class=header__inner>
<div class=header__logo>
<a href=/diary>
<div class=logo>
forest nook
</div>
</a>
</div>
<div class=menu-trigger>menu</div>
</div>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/diary/about>自己紹介</a></li>
<li><a href=/diary/dates>月別一覧</a></li>
<li><a href=/diary/tags>タグ一覧</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/diary/about>自己紹介</a></li>
<li><a href=/diary/dates>月別一覧</a></li>
<li><a href=/diary/tags>タグ一覧</a></li>
</ul>
</nav>
</header>
<div class=content>
<div class=posts>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1015/>日本酒いただきもの</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-15
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
</span>
<img src=/diary/img/2021/1015_sake.jpg class=post-cover alt=日本酒いただきもの>
<div class=post-content>
<p>0時に寝て6時に起きた。だいたい夜中に2-3回は起きるのが普通になりつつあって、前日ジョギングしてたせいか腰やお尻の筋肉に張りがあったので3時頃起きてストレッチして張りの箇所を伸ばしたりしながら寝てた。午前中、いけさんから上等なお酒をいただいた。造り酒屋の一族らしい。感謝。</p>
<h2 id=朝活>朝活</h2>
<p>朝起きる目的にいいかも？と思って <a href=https://www.youtube.com/channel/UC1rVx0vAg66su1WvH3X-RJg>Webデザイントレンドのよりみち</a> の金朝つめとぎに参加してみた。やっぱり目的があれば6時に起きれる。でも、終わってから1時間ほど寝てたので今日はプラスマイナスゼロ。<a href=/diary/posts/2021/1013/#朝活>前回の朝活</a> と同様、ミクロ経済学の入門書を読んでた。第2章の予算線と最適化を読んだ。経済学とはこういうものだという説明が腑におちた。当たるかどうかよりも考え方を理解しておく方が大事なように思えた。</p>
<blockquote>
<p>ときどき経済学に対して「経済学が想定するほど実際の消費者は懸命に選択しているとは限らない」といった批判がなされることがある。でもこれまでの説明から明らかなように、その批判は勘違いにもとづくものだ。批判したいなら「経済学は、消費者がはたから見て確実に愚かな選択をしても、それを非難しない傾向が強い」というほうが適切だろう。</p>
</blockquote>
<p>もう1つおもしろかったのがこの一節。</p>
<blockquote>
<p>予算線と選好を用いたミクロ経済学的分析は、現金給付のよさを指摘する。ただし、制度の悪用、人々の支持、必要原理といったことを考えると、現物給付のほうが好ましいとなる。現金給付と現物給付のどちらが総合的によいのか、これらの話だけで結論づけることはできない。とはいえここで、ミクロ経済学が有用な政策分析ツールたりえること、またミクロ経済学だけで政策を論じるのは不十分ということが分かったのは十分な収穫である。</p>
</blockquote>
<p>人間の活動を予測するような学問の便宜上、前提条件や制約を課している。経済という人間にとって重要な社会システムを扱う経済学への期待値が大き過ぎるがために経済学の言うことが当たった・当たってないといった議論になりがちなのかもしれないと思えた。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>5章レプリケーションを読んだ。200ページ超えたことで1/3を読み終えた。まだまだ先は長い。</p>
<p>シングルリーダーレプリケーションは一般的なものだし、Cassandra の運用をしていたのでリーダーレスレプリケーションもだいたいは知っていた。並行書き込みの問題は意識したことがなかった。そういう状況が発生するアプリケーションにおいてはとても難しい問題なことが理解できた。Cassandra で採用されている衝突解決アルゴリズムは <strong>最後の書き込みを勝たせる（last write wins、LWW）</strong> というものであり、これで十分なように考えていたけど、不十分なケースもあることがわかった。</p>
<blockquote>
<p>レプリケーションとは、ネットワークで接続された複数のマシンに同じデータのコピーを保持しておくこと。</p>
<ul>
<li>データを地理的にユーザーの近くで保持しておく => レイテンシを下げる</li>
<li>一部に障害があってもシステムが動作し続けられる => 可用性を高める</li>
<li>読み取りクエリを処理するマシンをスケールアウトする => スループットを高める</li>
</ul>
<p>レプリケーションはいくつかの目的で使われる。</p>
<ul>
<li>高可用性/耐障害性</li>
<li>レイテンシ</li>
<li>スケーラビリティ</li>
</ul>
<p>対象のデータが時間が経っても変化しないのであれば、レプリケーションは容易。単にデータのコピーを各ノードに一度だけコピーすれば完了するから。レプリケーションの難しさは、すべてレプリケーションされたデータへの変更の扱いから生じる。変更をノード間でレプリケーションするのに広く使われているアルゴリズムは次の3つになる。</p>
<ul>
<li>シングルリーダーレプリケーション
<ul>
<li>クライアントはすべての書き込みを1つのノード（リーダー）に送り、リーダーはデータ変更イベントのストリームを他のレプリカ（フォロワー）に送る</li>
<li>読み取りは任意のレプリカから行えるが、フォロワーから読み取るデータは古い可能性がある</li>
</ul>
</li>
<li>マルチリーダーレプリケーション
<ul>
<li>クライアント群は、それぞれの書き込みを複数あるリーダーノードのいずれかに送信する</li>
<li>これらのリーダーノードはどれも書き込みを受け付ける</li>
<li>リーダー群は、データ変更イベントのストリームをお互いに、そしてすべてのフォロワーノードに送信する</li>
</ul>
</li>
<li>リーダーレスレプリケーション
<ul>
<li>クライアントは、それぞれの書き込みを複数のノードに送信し、古いデータを持つノードを修正するために読み取りを複数のノードから並列に行う</li>
</ul>
</li>
</ul>
<p>データベースのレプリケーションの原理は1970年代から研究されていてそれほど変わっていない。とはいえ、分散データベースがメインストリームで利用されるようになったのは最近のこと。アプリケーション開発者の経験不足により <strong>結果整合性</strong> のような問題に関しては多くの誤解が生じた。いずれのレプリケーションのアプローチにもメリットとデメリットがある。シングルリーダーレプリケーションは理解しやすく、衝突解決を気にする必要がないことから、広く使われている。マルチリーダーとリーダーレスのレプリケーションは、ノードの障害、ネットワークの障害、レイテンシのスパイクがあっても頑健になる。しかし障害の理由を説明するのが難しく、一貫性についても弱い保証しか示せない。</p>
<p>レプリケーションは、 <strong>同期</strong> で行うことも <strong>非同期</strong> で行うこともできる。どちらにするのかは、障害があったときのシステムの振る舞いに大きく影響する。非同期のレプリケーションは、システムがスムーズに動作しているときには高速に動作するが、重要なのはレプリケーションのラグが大きくなったり、サーバーに障害が生じたりしたときに何が起こるのかを理解しておくことになる。リーダーに障害が発生し、非同期に更新されていたフォロワーを新しいリーダーに昇格させたら、直前にコミットされたデータは失われてしまう可能性がある。</p>
<p>レプリケーションラグが生じている状況下でアプリケーションがどのように振る舞うべきなのかを決める際に役立つ一貫性モデル。</p>
<ul>
<li><strong>書き込み後読み取り (read-your-writes)</strong>
<ul>
<li>ユーザーは、自分自身が投入したデータを常に見れる</li>
</ul>
</li>
<li><strong>モノトニック読み取り (monotonic reads)</strong>
<ul>
<li>ある時点のデータをユーザーが一度見たら、それ以前の時点のデータは見れない</li>
</ul>
</li>
<li><strong>一貫性のあるプレフィックス読み取り</strong>
<ul>
<li>ユーザーは、たとえば質問とその質問への回答を適切な順序でといったように、適切な因果関係を保持した状態でデータを見れる</li>
</ul>
</li>
</ul>
<p>マルチリーダーとリーダーレスのアプローチは本質的に並行性の問題を抱えている。複数の書き込みが並列に行われることがあるので、衝突が生じる場合がある。ある操作が他の操作よりも先に行われたのか、あるいはそれらが並行して行われたかを判断するためのアルゴリズムについて説明されている。</p>
</blockquote>
<h2 id=slack-apps-の調査>Slack apps の調査</h2>
<p><a href=https://www.instagram.com/workstreams.ai/>Workstreams.ai</a> を試してみた。</p>
<blockquote>
<p>Results-driven task management for Slack, Microsoft Teams and Google</p>
</blockquote>
<p>結果駆動タスクマネジメントという聞いたことない用語が書いてある。SaaS 型の Web アプリケーションとしての課題管理システムとチャットツールとの連携が密になったプロダクトにみえる。UI もよく作り込まれている。Workstreams.ai のアカウント管理は <a href=https://api.slack.com/authentication/sign-in-with-slack>Sign in with Slack</a> を使っている。ドキュメントによると openid connect と oauth 2.0 の仕組みを組み合わせているのかな。認証よくわかってないので背景も勉強しないといけない。簡単にタスク作成やコメント、更新などを Slack クライアントと Web アプリケーション上で触ってみた。</p>
<p>もう1つ <a href=https://slack.com/app-pages/google-sheets>Google Sheets for Workflow Builder</a> というのも試してみた。ワークフロービルダーのステップに簡単に Google Sheet との連携を実装できるのでめっちゃ簡単。ワークフロービルダーは本当によくできているな。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1013/>vimgrep 検索の嬉しさ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-13
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<img src=/diary/img/2021/1013_vimgrep.png class=post-cover alt="vimgrep 検索の嬉しさ">
<div class=post-content>
<p>2時頃に寝て6時に起きる。普段、日記は vim で書いている。ちょっとした過去の日記の検索に <code>vimgrep</code> でこと足りるのが嬉しい。テキストで日記を書いていることの利点かな。夜に <a href=https://fin-py.connpass.com/event/226933/>fin-pyコードリーディング会#4</a> に参加した。事前に <a href=https://hackmd.io/bFBFaPbYS1Kqfc97HMlp7Q?view>hackmd</a> に発表内容のメモを書いてた。いろんな発表者の視点があってコードリーディングのイベントはおもしろかった。</p>
<h2 id=朝活>朝活</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/227678/>【三宮.dev オンライン】リモート朝活もくもく会</a> に参加してみた。何もなかったらだいたい7時頃に起きるのがなにか目的があると6時に起きれる。人体の不思議。せっかく起きたので <a href=/diary/posts/2021/0929/#joel-on-software>前に More Joel on Software を読んだとき</a> に学生向けのアドバイスにあったミクロ経済学の勉強のためにその入門書を読み始めた。参加者が勉強会の常連ばかりだったので朝からわりと雑談してた。2人転職するという話で2人とも東京の会社でフルリモートワークで働くらしい。働き方が変わったなと感じる。その後、第1章の無差別曲線を読んだ。</p>
<h2 id=youtube-配信と集中力>YouTube 配信と集中力</h2>
<p>あんちぽさんの <a href=https://kentarokuribayashi.com/journal/2021/10/09/2021%e5%b9%b410%e6%9c%889%e6%97%a5>2021年10月9日</a> の日記でスライド作成の興がのらないので YouTube 配信しながらやったら集中できてよかったと書いてあったのでちょっと眺めてみた。なんかスライドの作成のやり方とか、自分と違うのかな？とか思いながらみたけど、やり方自体は普通だった。ただ集中できてよかったとあるので普段のやり方とは異なることをすることに意義があるのかな？とも思えた。試しに YouTube Live やってみようとしたら初期設定？に24時間かかるとのこと。代わりに <a href=https://launchpad.net/kazam>kazam</a> というスクリーンリコーダーの使い方を調べてた。勉強会で作業したログとかを録画しておいてなにかに使えたりするかもしれない。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>半日ほどかかって3章ストレージと抽出を読んだ。読みながら書いているので時間がかかる。今日はこれだけ。まとめはこんな感じ。</p>
<blockquote>
<p>データベースのシステムには2つの用途があり、その特性やパフォーマンスを最適化するためにストレージエンジンやデータ構造が異なるもので運用されるようになってきた。</p>
<ul>
<li>オンライントランザクション処理 (OLTP)
<ul>
<li>行指向、トランザクション処理</li>
</ul>
</li>
<li>オンライン分析処理 (OLAP)
<ul>
<li>列指向、分析クエリ</li>
</ul>
</li>
</ul>
<p>OLTP には2つの主要なストレージエンジンがある。</p>
<ul>
<li>B ツリー
<ul>
<li>1970年代からあり、成熟していて且つ効率的なインデックスのデータ構造</li>
</ul>
</li>
<li>LSM ツリー
<ul>
<li>比較的最近開発された、ディスク上でのランダムアクセスをシステム的にシーケンシャルアクセスに変換して、書き込みのスループットを高める手法。もとは Google の BigTable の論文？</li>
</ul>
</li>
</ul>
<p>OLAP の典型的なデータウェアハウスの高レベルでのアーキテクチャでは、大量の行をシーケンシャルにスキャンしなければならないクエリの場合、インデックスはあまり関係なく、データを非常にコンパクトにエンコードし、クエリがディスクから読まなければならないデータの量を最小限にとどめることが重要となる。この目標を達成するのに列指向のストレージが役立つ。</p>
</blockquote>
<p>過去に Cassandra を使ったプロダクトの開発に関わっていたから B ツリーと LSM ツリーの概要は知っていて3章で書いてあることはだいたい理解できた。データウェアハウスに関しては、前にお手伝いしていた会社で普通のログを Amazon Athena で処理すると1時間とかかかって分析クエリが Parquet に変換すると数分で完了したりするのを目の当たりにしてた。分析処理で読み込むデータ量を削減する列指向の考え方は理解しておく必要がある。行指向のデータを列指向フォーマットである <a href=https://parquet.apache.org/>Parquet</a> に変換する <a href=https://github.com/reproio/columnify>columnify</a> のコードも読んだことがあったので内容のイメージはできるけど、実務経験が少ないと全体像がわかっておらず、本書を読みながら学び直ししてた。</p>
</div>
</div>
<div class=pagination>
<div class=pagination__buttons>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class="copyright copyright--user">
<span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span>
</div>
</div>
</footer>
<script src=/diary/assets/main.js></script>
<script src=/diary/assets/prism.js></script>
</div>
</body>
</html>