<!doctype html><html lang=en><head><title>Health :: </title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/tags/health/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="Health"><meta property="og:description" content><meta property="og:url" content="/diary/tags/health/"><meta property="og:site_name" content><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/tags/health/index.xml rel=alternate type=application/rss+xml title></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><h1>Posts for: #Health</h1><div class=posts><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0928/>バドミントンのひとり練習</a></h1><div class=post-meta><time class=post-date>2024-09-28</time></div><span class=post-tags>#<a href=/diary/tags/refactoring/>refactoring</a>&nbsp;
#<a href=/diary/tags/health/>health</a>&nbsp;
#<a href=/diary/tags/politics/>politics</a>&nbsp;
#<a href=/diary/tags/badminton/>badminton</a>&nbsp;</span><div class=post-content><p>今日のバドミントン練習はリフティングを30分した。連続最大回数は27回だった。</p><h2 id=最後の厄介なリファクタリング>最後の厄介なリファクタリング</h2><p>10時頃に起きて11時にはオフィスへ来て作業をしていたと思う。昨日ジョギングと筋トレしたから寝起きジョギングはやめて普通にオフィスへ行って作業していた。この issue はどこまでリファクタリングするかの決めの問題もあり、少し寝かせてあった。私のもてるスキルを駆使して思い切りやることを決めて土日で大半を終わらそうと思う。いくつかの葛藤と逡巡を振り払って着手はした。昼間は既存のコードの本質的な問題の分析、再設計のための要項の調査、軽くコードを書きながらの感触の確認などをしていた。その後、ストレッチに出掛けて戻ってきてから続きをやるつもりが、いろいろ雑務をやっていたら22時ぐらいになってしまってまた明日でいいやと諦めた。モチベーションが足りない。一回休み。</p><h2 id=ストレッチ>ストレッチ</h2><p>昨日、久しぶりに筋トレをして夜は全然平気だったのに寝て起きたらあちこち全身筋肉痛でストレッチもかなりきつかった。悪い痛みではないから筋肉をほぐしてもらった感じになる。今日の開脚幅は開始前146cmで、ストレッチ後153cmだった。筋肉痛だから硬めのように思えたが、数字だけ比べたら普段とそんなに変わらなかった。</p><p>トレーナーさんと自民党の総裁選挙の話題になって、一通りニュースをみて私も思うところはあったものの、政治的な話題のやり取りする場所がないから誰と話すこともないだろうとしまいこんでた矢先、トレーナーさんから話題が出てきたのでいろいろ話してみた。石破さんは自民党内で嫌われているから決戦投票で勝てないだろうという大方の見通しを覆したのは見事だったし、石破さんは良識なリベラル、且つ金融所得課税の強化に前向きだったりもするから市場の反応は悪い。これまでは総理大臣が変わったタイミングはご祝儀相場のように歓迎されることが多かったのに対して、月曜日は株価が急落するようにみられている。これほど市場からネガティブな反応が出るのも珍しいなという所感。余談だが、私はいまどちらのポジションもとっていないので株価が下がってもあまり影響はない。個人的にはシステムへの理解が深いという側面だけで河野さんを応援しているものの (一方で官僚に対するもの言いがパワハラ的なところがマイナス)、今回は後ろから2番目と不人気だった。日本では自民党総裁=総理大臣なわけではあるが、政治家が影響力をもつタイミングというのは本当に難しい。石破さんも5回目の総裁選ということで悲願が叶ってよかったんじゃないかと応援したい。</p><h2 id=ひとりでできるバドミントンの練習>ひとりでできるバドミントンの練習</h2><p>ストレッチを終えてから <a href=/diary/posts/2024/0927/#ラケット選び>購入したラケットを受け取り</a> してきた。試し打ちではないけど、買ったばかりで使ってみたいから KALIDIA チャンネルから1人でできる練習を探してみた。次の練習はラケットとシャトルとの距離感を掴むための練習になるという。なるべく日課としてしばらく続けてみたい。</p><ol><li>シャトルのキャッチ</li><li>バドミントンの技を3つ行う<ul><li>スピンネット</li><li>ミニクロスネット</li><li>ロビング</li></ul></li><li>リフティング</li><li>屋外で向かい風に向かってロビングを打つ</li></ol><div class=video-container><iframe src=https://www.youtube.com/embed/QJx8jHvzqFQ allowfullscreen title=「素振り」や「壁打ち」以外の上達に必要な力が身につく一人で出来る練習方法【バドミントン】></iframe></div></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0921/>よい土曜日</a></h1><div class=post-meta><time class=post-date>2024-09-21</time></div><span class=post-tags>#<a href=/diary/tags/exercise/>exercise</a>&nbsp;
#<a href=/diary/tags/badminton/>badminton</a>&nbsp;
#<a href=/diary/tags/health/>health</a>&nbsp;
#<a href=/diary/tags/coworking/>coworking</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;</span><div class=post-content><p>土曜日はだらだらしがちなのが、今日は朝から起きて活動できた。お昼に少しコードを書いて、夕方にストレッチして、夜はカフーツさんへ行ってきた。よい一日になった。</p><h2 id=みなとのもりの運動>みなとのもりの運動</h2><p><a href=/diary/posts/2024/0907/#みなとのもりの運動>前回の所感</a> 。起きてからシャワーを浴びようとしたときにふと軽く走ってこようと思い立って9時過ぎから公園へ出掛けてトラックを3周ほどジョギングしてきた。公園に近いマンションに引っ越したことのメリットを活用できた。運動するとそれだけで報酬系を刺激して気分がよい。これまでは起きてもしんどくて出掛ける余裕がなかった。ジョギングへ出掛けられるぐらいには体力が回復してきたのかもしれない。来週も朝からジョギングへ出掛けてみたい。</p><h2 id=ラケット選び>ラケット選び</h2><ul><li><a href=https://www.ganbaranai-bad.com/c/sp_racket>バドミントンラケットの選び方</a></li><li><a href=https://tetsu-bado-minton.com/%E3%80%90%E3%83%90%E3%83%89%E3%83%9F%E3%83%B3%E3%83%88%E3%83%B3%E3%80%91%E3%83%88%E3%83%83%E3%83%97%E3%83%A9%E3%82%A4%E3%83%88%E3%83%A9%E3%82%B1%E3%83%83%E3%83%88%E3%81%A8%E3%81%AF%EF%BC%9F%E3%81%8A/>バドミントンラケットのヘッドライトラケットとは？最新のおすすめ16選も紹介！</a></li></ul><p>うちらの業界で言えば未経験者が「どのプログラミング言語を学べばよいですか？」という質問の答えになる。私なら一番無難なのは typescript で、データ分析や汎用用途で学ぶなら python、バックエンドが好みなら go といったようにお奨めする。こういう答えのない問いは経験者にこれと決めてもらうのがよい。ラケット選びのサイトをみてもパラメーターがいくつかあるのは理解できたが、最初にどのラケットを選択してよいかがわからない。経験者のやまとさんに相談してみた。エントリーモデルの、価格帯は1万円前後のものでよいという。振った感じで合う合わないがあったりするから、お店へ行って店員さんに相談したり試し打ちさせてもらったりするのがよいとのこと。相談に乗ってくれる近所のバドミントンショップを教えてもらった。モチベーションを上げていく意図で道具を揃えていくのもよいと思う。</p><h2 id=ストレッチ>ストレッチ</h2><p><a href=/diary/posts/2024/0918/#体育館でバドミントン>水曜日にバドミントン</a> をしたことによる筋肉痛が残っていた。腰や背中のあちこちが痛かった。あと右腕や右肩もバドミントンでラケットをたくさん振ったことによる影響で張りや硬さがみられた。運動した張りをストレッチでほぐすようなサイクルになれば健康にもよさそうにみえる。今日の開脚幅も開始前149cmで、ストレッチ後153cmだった。</p><h2 id=カフーツさん訪問>カフーツさん訪問</h2><p>ストレッチを終えてからビールとおつまみをもって久しぶりにカフーツさんへ行ってきた。先週末にだらだらしてしまったからその反省も踏まえて出掛けることにした。ちょうどバドミントンのイベントをよく手伝ってくれている方がいて、あちこち友だち探しをしているようにみえるのでその一つとしてカフーツさんを紹介していて <a href=/diary/posts/2024/0717/#キャンプ飯部と居場所>以前にもキャンプ飯部</a> に参加していた。知っている人がいないとなかなか参加しにくいと伺っていたので一緒に参加してきた。しかし、参加者内で女性1人なってしまって、これはこれで居心地が悪そうにもみえた。他に女性の参加者が何人かいそうなカフーツさんのイベントを紹介した方がよかったなと反省した。</p><p>書店というビジネスの在り方について、いとうさんと議論していて、この本を読めと <a href=https://coriolisbooks.stores.jp/items/668652e4444fad00327f84ef>取り戻す旅</a> という本を貸してくれた。本当は自分で買ってよいのだけど、なんとなくそのまま借りてみた。読んで内容がよかったら買ってみようと思う。本書では <a href=https://www.cultipay.net/about/>Culti Pay(カルチペイ)</a> という取り組みをしていて <a href=https://www.minna-no-ginko.com/>みんなの銀行</a> を介して著者に投げ銭のようなこともできるという。新しい価値観に触れるという意図でも読み終えた後でやってみようと思う。</p><ul><li><a href=https://note.com/kanzan10to9/n/ne730028c9861>カルチペイはただの送金システムではなく新しい経済圏を作っている：今日のアウトテイク#310（2024-09-23）</a></li></ul></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0914/>連休の初日</a></h1><div class=post-meta><time class=post-date>2024-09-14</time></div><span class=post-tags>#<a href=/diary/tags/health/>health</a>&nbsp;</span><div class=post-content><p>昨日も2時頃までコードを書いていて帰って寝たらお昼ぐらいまで寝ていた。ストレッチ終えてからコードを書こうと思っていたものの、モチベーションがあがらなくてだらだらしていた気がする。</p><h2 id=ストレッチ>ストレッチ</h2><p>今週もデスクワークの時間が長かったせいか、軽く腰の張りを感じた。トレーナーさんからも運動不足からカラダの硬さがみえるといった指摘があった。先週はレビューの時間が多くてあまり時間を時間を取れなくて業務があまり進捗しなかった。そのストレスもあってなのか、また生活の余裕がなくなってきた。今日の開脚幅も開始前149cmで、ストレッチ後153cmだった。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0907/>集中力の正体</a></h1><div class=post-meta><time class=post-date>2024-09-07</time></div><span class=post-tags>#<a href=/diary/tags/audio-media/>audio media</a>&nbsp;
#<a href=/diary/tags/exercise/>exercise</a>&nbsp;
#<a href=/diary/tags/health/>health</a>&nbsp;
#<a href=/diary/tags/programming/>programming</a>&nbsp;
#<a href=/diary/tags/motivation/>motivation</a>&nbsp;
#<a href=/diary/tags/psychology/>psychology</a>&nbsp;</span><div class=post-content><p>昨日は20時半頃にお仕事を終えて帰った。スーパーで買いものして、家に帰って晩ご飯を作って食べて、休んだらオフィスへ戻るつもりがそのまま寝てしまった。</p><h2 id=メッセージ作成>メッセージ作成</h2><p>年一ゲストとして出演している <a href=https://podcast.terapyon.net/>terapyon channel</a> の <a href=https://terapyon.connpass.com/event/326314/>100回記念公開収録</a> があった。いつもお世話になっているので私は参加できないがカンパ枠で応援していた。昨日てらださんから音声メッセージを作ってほしいと依頼され、本当は昨日の夜に作ろうと思っていたものの、疲れて寝てしまったので朝起きてから慌ててオフィスへ行って作成した。ubuntu の apt でインストールできるツールとして <a href=https://www.audacityteam.org/>audacity</a> を使って録音した。簡単に使えた。お祝いのメッセージを文章に書き出して、マイクテストも含めて最終的には7回撮り直した。文章を書いてから、話してみると、流れが悪かったり、語呂が悪かったり、途中で詰まったり、かんでしまったりと、なにか気になるところをみつけて、文章を推敲して録音しながら1時間ほどやってた。録音して聞き直すと、いかに自分の話し方が下手であるかがよくわかる。話し方を練習しないとうまくならないのだろうな。</p><h2 id=みなとのもりの運動>みなとのもりの運動</h2><p><a href=/diary/posts/2024/0724/#みなとのもりの運動>前回の所感</a> 。14時頃に作業を終えてストレッチまで1時間ほど時間が空いた。ふと運動してからストレッチへ行くとよさそうだと思い立ってジョギングと縄跳びをしてきた。前回が7月24日なので1ヶ月半ほど運動していなかった。1kmほどジョギングしてから縄跳びを15分間した。以前と比較したら軽めに流したにも関わらず、久しぶりに運動したら体力が落ちていてかなりバテた。習慣的に運動していないとすぐに衰える。久しぶりに運動できたので、また再開するきっかけになるかもしれない。</p><h2 id=ストレッチ>ストレッチ</h2><p>今日の開脚幅も開始前148cmで、ストレッチ後152cmとあまり数値は出なかった。直前に運動して行ったのでよく伸びるかな？と予測したものの、測ってみるとそうでもなかった。それでも運動した後にストレッチを受けるのはカラダによさそうにも思える。ここ1ヶ月半ほど運動できていないものの、体重は67kg台を維持していて体脂肪率や筋肉量はあまり変わっていない。トレーナーさんとそういう話をしていたら、筋肉は落ちにくくつきにくいから1ヶ月ではそんなもんとのこと。</p><h2 id=プログラミングの集中力と生産性への考察>プログラミングの集中力と生産性への考察</h2><p>ストレッチを受けているときにトレーナーさんと話していて思うことがあったのでまとめておく。いまの開発フェーズは開発者としてプロジェクトに参加している。平均すると1日10時間ぐらいお仕事していて、早く帰る日もあるから遅い日は日付が変わるぐらいまではコードを書いていることがある。家に帰ると休んでしまうからオフィスで晩ご飯を食べることも多い。なぜプログラミングに集中していると運動ができないのか？を考察してみた。</p><ul><li>他の余分なことを排除すると集中力が増す</li></ul><p>いまやっている開発のお仕事は1日で完了するような簡単な開発ではない。1年半開発しているので残っている課題は厄介で複雑な問題への対応であることが多い。新規機能を追加するときも既存機能や仕様や依存関係を考慮しないといけない。そうすると2-3日かけて課題を解決することが多い。そのときに他の余分なことを排除した方が脳のリソースを課題解決に割り当てられる。通勤しているときも、寝ているときも、ご飯を食べているときも取り組んでいる課題のことを四六時中考えている。他のことに脳のリソースを割くと課題解決の品質が下がる可能性が高い。ずっと考え続けることが複雑な問題の課題解決に重要となる。</p><ul><li>システム開発とはタイムアタック競技である</li></ul><p>システム開発のプロジェクトマネジメントにおいてもっとも重要な概念はタイムボックスだと私は考えている。適度な期間 (うちは2週間) を設け、モノゴトに取り組む最初と最後を作ること。認知心理学の研究からも記憶の仕組みからも期間の最初と最後がもっとも学習効果が高いことを示唆している。このことは私の経験則においてもシステム開発で当てはまる。作業期間が適切でないと人間はだらだらしてしまう (<a href=https://ja.wikipedia.org/wiki/%E3%83%91%E3%83%BC%E3%82%AD%E3%83%B3%E3%82%BD%E3%83%B3%E3%81%AE%E6%B3%95%E5%89%87>パーキンソンの法則</a>) 。プログラミングにおいて動くのは当たり前で、動いた上でいかに品質をあげられるかが腕の見せ所になる。エラー処理を適切に制御できているか、他人がコードを読んでも理解しやすく保守しやすいか、将来の拡張性を考慮して設計されているか、など品質をよくするための取り組みには答えがない。仕事ができる・できないを分ける行動の1つとして、答えのない問いにどれだけ準備できるか、考え続けられるかと言い換えられるかもしれない。答えがないからいくらでも品質をあげるための施策がある。しかし、現実の業務には期限があるため、期限内に最善の品質を目指すことになる。そのため、タイムボックスでシステム開発をマネジメントする限り、いつもタイムアタック競技をしているのと同義になるから時間が足りない。</p><p>プログラミングはいつも妥協を強いられる。完璧で最高のシステムなどありえない。その時々で開発途中における最善の動くものをスナップショットとしてバージョン管理しているに過ぎない。この妥協するレベルが私にとってはマネージャーと開発者という役割で大きく異なるのだろうと思う。マネージャーとしての遊撃なら先送りできても、開発者としては多少の負荷があっても解決してしまう。自身の基準を満たす働き方に違いがあるのではないかと思う。言語化してみると、この考え方はプログラミングに限らず、そのときに取り組む対象によって何にでも応用できそうに思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0831/>その後の台風の影響</a></h1><div class=post-meta><time class=post-date>2024-08-31</time></div><span class=post-tags>#<a href=/diary/tags/health/>health</a>&nbsp;
#<a href=/diary/tags/comic/>comic</a>&nbsp;
#<a href=/diary/tags/history/>history</a>&nbsp;</span><div class=post-content><p>台風の影響で昨日も今日も終日、新幹線は取りやめになっていた。<a href=/diary/posts/2024/0829/>木曜日に帰ってこれた</a> ことには大きな意味があった。本当に助かった。</p><h2 id=ストレッチ>ストレッチ</h2><p>今日の開脚幅も開始前149cmで、ストレッチ後156cmと普段通りの数値だった。運動できていないので筋肉痛もなく、デスクワークの疲労ぐらいしかない。いつも通りトレーナーさんと雑談して硬くなったカラダをほぐしてもらう感じだった。今週は出張していたのと、出張中の業務時間も普段より少なかったのでとくに疲労がたまっているわけでもなかった。運動せず筋肉痛もなくストレッチを受けるともったいないような気分にもなってきた。いまの開発フェーズが終わったらまた運動を再開できるかなぁ。</p><h2 id=成就しない結末への期待>成就しない結末への期待</h2><p>今期のアニメで <a href=https://nigewaka.run/>逃げ上手の若君</a> を見始めた。最初は「ながら」でみていたせいか、あまりぱっとしなかったものの、改めてちゃんと数話を見返したらおもしろい作品だと思えた。もともと私は歴史漫画が好きなので歴史ジャンルというだけでもみてしまう。著者の <a href=https://ja.wikipedia.org/wiki/%E6%9D%BE%E4%BA%95%E5%84%AA%E5%BE%81>松井優征</a> さんの作品は過去に「暗殺教室」を読んだこともあって好きな漫画家の1人でもある。したがって、私はもともとこの作品を知っていたし、関心をもっていた。いままで読んでいなかっただけ。主人公は <a href=https://ja.wikipedia.org/wiki/%E5%8C%97%E6%9D%A1%E6%99%82%E8%A1%8C>北条時行</a> という、室町幕府が成立する時代の、鎌倉幕府最後の北条家の跡継ぎになる。<a href=https://ja.wikipedia.org/wiki/%E8%B6%B3%E5%88%A9%E5%B0%8A%E6%B0%8F>足利尊氏</a> は歴史の授業で習うが、北条時行を私は覚えていないから習わなかったのかもしれない。歴史の影というのか、この作品は敗者を描く作品になる。</p><p>余談だが、神戸駅のすぐ近くに <a href=/diary/posts/2022/0108/#初詣>湊川神社</a> がある。逃げ上手の若君の作品内でも出てくる <a href=https://ja.wikipedia.org/wiki/%E6%B9%8A%E5%B7%9D%E3%81%AE%E6%88%A6%E3%81%84>湊川の戦い</a> の、あの「湊川」であり、神戸という地元応援の文脈で <a href=https://ja.wikipedia.org/wiki/%E6%A5%A0%E6%9C%A8%E6%AD%A3%E6%88%90>楠木正成</a> も応援している。楠木正成は没後から江戸時代まで知名度は低かったが、なぜか徳川光圀公に評価され、その後、幕末の維新志士から崇敬の対象となり、歴史上の時間が経ってから知名度があがった稀有な武将でもある。そういう背景もあってなのか、逃げ上手の若君の作品内でも特異な武将として描かれていて、史実から湊川の戦いで足利尊氏に負けてしまうのだけれども、それでも格好よく戦って、その智謀を発揮している。この作品を読んでさらに楠木正成への関心が出てきた。</p><p>歴史漫画は結果がわかっているから予定調和で読み進める。主人公が勝者であれば安心して読めるが、この作品は敗者なので結末は悲劇となる。ある意味、敗者だからあまり史実の資料が残っていなくて創造性を発揮できるところもあるだろう。そこが漫画家の腕の見せ所だと思う。北条時行による「中先代の乱」があったから南北朝が生まれ、その後の室町幕府への影響も大きかったように、この作品内では描かれている。敗者も歴史を作っていく上での重要な役割を担っているという表現になっていて歴史の背景を想像して楽しみながら読める作品になっていると思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0824/>multipart/form-data リクエストの扱い</a></h1><div class=post-meta><time class=post-date>2024-08-24</time></div><span class=post-tags>#<a href=/diary/tags/health/>health</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/testing/>testing</a>&nbsp;</span><div class=post-content><p>9時に起きて2度寝して10時頃に起きたものの、お昼までだらだらしていた。それからオフィスへ行って溜まっていた日記をまとめて書いて、<a href=https://nigewaka.run/>逃げ上手の若君</a> をみながら作業をしていた。来週は出張の週だから事前にやっておくことがいくつかある。</p><h2 id=ストレッチ>ストレッチ</h2><p><a href=/diary/posts/2024/0817/>先週は実家へ帰っていた</a> ために2週間ぶりのストレッチになる。とはいっても、いまは運動をしているので筋肉痛もない。しかし、机に向かってデスクワークする時間が増えている分の負荷がかかっている。トレーナーさんからも腰から背中にかけて硬いと指摘された。今日は硬くなっているカラダ全体をほぐしてもらった感じだった。おかげで今後も体調よく机に向かえる。今日の開脚幅は開始前149cmで、ストレッチ後155cmと普段通りの数値だった。</p><h2 id=multipartform-data-リクエストを扱う結合テスト>multipart/form-data リクエストを扱う結合テスト</h2><p>昨日の夜に汎用のファイル操作の api を実装した。今日はその結合テストを追加してマージリクエストを作成した。multipart/form-data のリクエストを作るのはちょっと面倒くさい。go のライブラリのテストコードや stackoverflow のサンプルコードなどを調べながら自分で実装した。次のような multipart/form-data リクエストを扱う writer や buffer を生成するためのユーティリティを作る。一通りの結合テストを実装するのに3時間ほどかかった。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>createMultiPartFormData</span>(
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fileBody</span> []<span style=color:#66d9ef>byte</span>, <span style=color:#a6e22e>formField</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>multipart</span>.<span style=color:#a6e22e>Writer</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>Buffer</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>b</span> <span style=color:#f92672>:=</span> new(<span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>Buffer</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mw</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>multipart</span>.<span style=color:#a6e22e>NewWriter</span>(<span style=color:#a6e22e>b</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>k</span>, <span style=color:#a6e22e>v</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>formField</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fw</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mw</span>.<span style=color:#a6e22e>CreateFormField</span>(<span style=color:#a6e22e>k</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fw</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#a6e22e>v</span>)); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fw</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mw</span>.<span style=color:#a6e22e>CreateFormFile</span>(<span style=color:#e6db74>&#34;file&#34;</span>, <span style=color:#e6db74>&#34;path/to/file&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fw</span>.<span style=color:#a6e22e>Write</span>(<span style=color:#a6e22e>fileBody</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mw</span>.<span style=color:#a6e22e>Close</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>mw</span>, <span style=color:#a6e22e>b</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>このユーティリティを使って http リクエストのテストデータを生成するのは次のようなコードになる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>u</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>URL</span>{
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Scheme</span>: <span style=color:#e6db74>&#34;http&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Host</span>:   <span style=color:#e6db74>&#34;localhost&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Path</span>:   <span style=color:#a6e22e>path</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>mw</span>, <span style=color:#a6e22e>body</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>createMultiPartFormData</span>(<span style=color:#a6e22e>fileBody</span>, <span style=color:#a6e22e>formField</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to create multipart form data: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>NewRequest</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>MethodPost</span>, <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>String</span>(), <span style=color:#a6e22e>body</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;http create new request error. err: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Set</span>(<span style=color:#e6db74>&#34;Content-Type&#34;</span>, <span style=color:#a6e22e>mw</span>.<span style=color:#a6e22e>FormDataContentType</span>())
</span></span></code></pre></div><p>あと結合テストでファイルをアップロードすると実際にファイルシステム上に保存されてしまうのでそれらを削除するには <a href=https://pkg.go.dev/testing#T.Cleanup>Cleanup</a> を使うと簡単に後始末できた。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestFileUpload</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Cleanup</span>(<span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>RemoveAll</span>(<span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>FilesDir</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to remove files directory: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0821/>寝ている間に再設計</a></h1><div class=post-meta><time class=post-date>2024-08-21</time></div><span class=post-tags>#<a href=/diary/tags/issue-management/>issue management</a>&nbsp;
#<a href=/diary/tags/communication/>communication</a>&nbsp;
#<a href=/diary/tags/programming/>programming</a>&nbsp;
#<a href=/diary/tags/health/>health</a>&nbsp;</span><div class=post-content><p>昨日のもやもやは寝ている間に整理され、今日は標準的な開発者としての過ごし方になった感じがする。</p><h2 id=マネージャーとの-1on1>マネージャーとの 1on1</h2><p>これまでは私がマネージャーとして 1on1 をしてきたが、今後は交代したメンバーがマネージャーを務める。この開発フェーズでは私は開発者 (メンバー) として 1on1 をしてもらうといった感じかな。自分が開発者側だと思うと、いま私が取り組んでいることの話しをしやすかったりした。立場によって 1on1 のやり方は変わることを実感した。マネージャーはメンバーの話しを聞く方に注力したり、プロジェクト全体の話しをしがちになる。開発者として臨むと、自分の抱えている issue に集中して話せるといった違いがあった。</p><h2 id=cpap-の中断>CPAP の中断</h2><p>夜に睡眠外来へ行ってきた。以前に <a href=/diary/posts/2024/0314/>CPAP 装置</a> を借りて3ヶ月ぐらいやっていたものの、ここ2ヶ月ほどやらなくなってしまっていた。もともとは体脂肪コントロールの疲労回復のために始めたものだった。体脂肪コントロールがうまくいって目標達成したことで睡眠改善を行う目的もなくなってしまって関心を失ってしまった。借りているだけで毎月5千円ほどかかるので中断して機器を返却することにした。旅行のときなど、一時的に借りられないかを聞いてみたら、それは不可とのこと。また再開したくなったらいつでも言えばよいとのこと。</p><h2 id=ツールの再設計>ツールの再設計</h2><p><a href=/diary/posts/2024/0820/>昨日の続き</a> 。睡眠外来から帰ってきて、晩ごはん食べて、軽く飲みながら24時過ぎまでコードを書いていた。今日もまる一日ツールの再設計をしていた。昨日のノーアイディアな状況から少しずつ好転していって、ある処理で歯車が噛み合ってからはいつも通り着実に進捗していく様がみられた。意図的にやっていることではあるけど、課題について考えながら一晩寝ると、寝ている間に無意識に刷り込まれて脳が考えてくれる。それで徐々によい設計が現れてくるようになって明確な実装に落ち着いたのではないかと推測する。今日はよい感じに集中できた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0814/>バドミントンという健康的な趣味</a></h1><div class=post-meta><time class=post-date>2024-08-14</time></div><span class=post-tags>#<a href=/diary/tags/programming/>programming</a>&nbsp;
#<a href=/diary/tags/health/>health</a>&nbsp;
#<a href=/diary/tags/exercise/>exercise</a>&nbsp;</span><div class=post-content><p>昨日、大きな仕様変更を入れた内容の、API ドキュメントを書き直していた。大きな変更をしたのでドキュメントの修正量も大きくて半日以上かかった。こういった効率化しにくい、地道にコツコツやらないといけない作業が忙しいときに降りかかるのがつらい。誰でもそうだとは思うけど。元来、私は積み重ねをしていく地道な作業は得意な方だと考えている。しかし、いまはリーダーとして他のメンバーを引っ張っていく立場にあるため、時間のかかる作業をしていると足踏みしているような罪悪感を感じてしまう。一方でそういった実務をちゃんとやることをメンバーにみせることも大事かなと思って、面倒な作業を自分でやるときもある。ケースバイケース。</p><h2 id=体育館でバドミントン>体育館でバドミントン</h2><p><a href=/diary/posts/2024/0727/#体育館でバドミントン>前回の所感</a> 。19時からバドミントンへ行ってきた。19時の時点では3人しかいなかったものの、後半にながいさんも来られて、最終的な参加者数は4人だった。ここ1-2週間は椅子にすわってデスクワークばかりやっていて、ほとんど運動できていないのでカラダを動かすのにちょうどよい機会になった。今回も <a href=/diary/posts/2024/0616/#line-のオープンチャット開設>line のオープンチャット</a> 経由で加古川から初参加で来てくれた方がいた。三宮は職場の通勤途中になるらしく、それもあって立ち寄ってくれたようだ。その方も私と同じ世代で初心者からバドミントンを始めて1年ほどの経験らしい。毎週、地元の体育館で練習していると話されていた。うちらに比べればずっと上手だった。うちらはみんな初心者だから適当にやってきたのだけど、(うちらと比べて) 熟練者が来てくれたのでバドミントンの練習方法もいろいろ教えてもらった。その方は次の動画をみて勉強していると話されていた。私も後でみてみようと思う。</p><ul><li><a href=https://www.youtube.com/channel/UCA53HK4vrSI8Wyo1-4H4IxA>KALIDIAバドミントンチャンネル</a></li></ul><p>バドミントン経験1年の方の振る舞いをみていて、バドミントンは趣味でずっと続けていくのによいスポーツだなと思えた。運動にもなるし、カラダを痛めるといった健康を害することもなさそうだし、お金もかからないし、老若男女、初心者誰でもできるコミュニティ向けのスポーツでもある。教える方のスキルが高いほど、初心者の練習相手として、初めてイベントに来られた方がバドミントンに関心をもつ手助けもできそうに思えた。いまのお仕事の開発が一区切りつけば、有料のバドミントン教室へ通ってみて基礎を教えてもらいに行こうかなと思い始めた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0810/>なにもしていない一日</a></h1><div class=post-meta><time class=post-date>2024-08-10</time></div><span class=post-tags>#<a href=/diary/tags/health/>health</a>&nbsp;</span><div class=post-content><p>お昼までゆっくりして午後からストレッチへ行ってオフィスで作業していた。本当は夕方から実家へ帰ろうと思っていたものの、作業がまったく捗らなくて翌日へ持ち越した。</p><h2 id=ストレッチ>ストレッチ</h2><p>今週は運動も料理も何もせずひたすらコードを書いていた。どこも筋肉痛はなくなっているものの、腰に張りがあったりしたのは椅子に座っている時間が長かったからだと思う。今日の開脚幅は開始前151cmで、ストレッチ後156cmとこれまでよりは数値がよかった。筋肉痛だとカラダが硬くなってしまったりしているみたい。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0803/>mongodb も一応は外部結合できる</a></h1><div class=post-meta><time class=post-date>2024-08-03</time></div><span class=post-tags>#<a href=/diary/tags/mongodb/>mongodb</a>&nbsp;
#<a href=/diary/tags/design/>design</a>&nbsp;
#<a href=/diary/tags/health/>health</a>&nbsp;</span><div class=post-content><p>今日は出張中にたまっていた日記をまとめて書いていた。昨日筋トレしたから運動はおやすみ。</p><h2 id=mongodb-における外部結合>mongodb における外部結合</h2><p>出張中のふりかえりやプロジェクトマネジメントの合間に mongodb の <a href=https://www.mongodb.com/docs/manual/reference/operator/aggregation/lookup/>$lookup (aggregation)</a> 機能を調査していた。一言で言えば、rdbms で言うところの外部結合 (join) を mongodb で実現する機能と言える。しかし、aggregation の機能として実装されていることから rdbms の外部結合とはパフォーマンスの側面で大きく違うのでは？と推測する。mongodb のような kvs では基本的に外部結合のようなことは行わず、結合済みのコレクションを定義するやり方がプラクティスとされる。一方で整合性を保証するには外部結合は有効なデザインパターンの1つなので使いたい場面があってもおかしくない。実際に mongodb に $lookup が実装されているのだから、そのニーズは大きいのだと思われる。</p><p>ちょうどいまやっている開発でその要件があったので <a href=https://github.com/mongodb/mongo-go-driver>mongo-go-driver</a> の次のチュートリアルをみながら実装してみた。</p><ul><li><a href=https://www.mongodb.com/blog/post/quick-start-golang--mongodb--data-aggregation-pipeline>Quick Start: Golang & MongoDB - Data Aggregation Pipeline</a></li></ul><p>例えば、次のような2つのコレクションがある。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Group</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ID</span>          <span style=color:#66d9ef>string</span>      <span style=color:#e6db74>`bson:&#34;_id&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span>        <span style=color:#66d9ef>string</span>      <span style=color:#e6db74>`bson:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>UpdatedAt</span>   <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>   <span style=color:#e6db74>`bson:&#34;updatedAt&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>MyData</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ID</span>           <span style=color:#66d9ef>string</span>    <span style=color:#e6db74>`bson:&#34;_id&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>GroupID</span>      <span style=color:#66d9ef>string</span>    <span style=color:#e6db74>`bson:&#34;groupID&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>RegisteredAt</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span> <span style=color:#e6db74>`bson:&#34;registeredAt&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>MyData の GroupID フィールドが Group コレクションの ID を保持して外部参照している。MyData コレクションに対する aggregate に渡すパラメーターとして pipeline を渡す。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>myPipeline</span> = <span style=color:#a6e22e>mongo</span>.<span style=color:#a6e22e>Pipeline</span>{
</span></span><span style=display:flex><span>	{{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Key</span>: <span style=color:#e6db74>&#34;$lookup&#34;</span>, <span style=color:#a6e22e>Value</span>: <span style=color:#a6e22e>bson</span>.<span style=color:#a6e22e>D</span>{
</span></span><span style=display:flex><span>			{<span style=color:#a6e22e>Key</span>: <span style=color:#e6db74>&#34;from&#34;</span>, <span style=color:#a6e22e>Value</span>: <span style=color:#e6db74>&#34;group&#34;</span>},
</span></span><span style=display:flex><span>			{<span style=color:#a6e22e>Key</span>: <span style=color:#e6db74>&#34;localField&#34;</span>, <span style=color:#a6e22e>Value</span>: <span style=color:#e6db74>&#34;groupID&#34;</span>},
</span></span><span style=display:flex><span>			{<span style=color:#a6e22e>Key</span>: <span style=color:#e6db74>&#34;foreignField&#34;</span>, <span style=color:#a6e22e>Value</span>: <span style=color:#e6db74>&#34;_id&#34;</span>},
</span></span><span style=display:flex><span>			{<span style=color:#a6e22e>Key</span>: <span style=color:#e6db74>&#34;as&#34;</span>, <span style=color:#a6e22e>Value</span>: <span style=color:#e6db74>&#34;foreignGroup&#34;</span>},
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>	}},
</span></span><span style=display:flex><span>	{{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Key</span>: <span style=color:#e6db74>&#34;$unwind&#34;</span>, <span style=color:#a6e22e>Value</span>: <span style=color:#a6e22e>bson</span>.<span style=color:#a6e22e>D</span>{
</span></span><span style=display:flex><span>			{<span style=color:#a6e22e>Key</span>: <span style=color:#e6db74>&#34;path&#34;</span>, <span style=color:#a6e22e>Value</span>: <span style=color:#e6db74>&#34;$foreignGroup&#34;</span>},
</span></span><span style=display:flex><span>			{<span style=color:#a6e22e>Key</span>: <span style=color:#e6db74>&#34;preserveNullAndEmptyArrays&#34;</span>, <span style=color:#a6e22e>Value</span>: <span style=color:#66d9ef>false</span>},
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>	}},
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>$lookup の操作の後に $unwind で配列を flatten する処理がセットになる。result set にマッピングするためには flatten が必要になるのだと推測する。aggregate() を呼び出すと cursor が返ってきて、その cursor に外部結合される値の配列を渡すことで result set を取得できる。デバッグはややこしいし、コード上もちょっとわかりにくいけど、これは mongodb のお作法だと割り切ってユーティリティ化してしまえばよいものだと思う。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>joinedMyData</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ID</span>           <span style=color:#66d9ef>string</span>    <span style=color:#e6db74>`bson:&#34;_id&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Group</span>        <span style=color:#a6e22e>Group</span>     <span style=color:#e6db74>`bson:&#34;foreignGroup&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>RegisteredAt</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span> <span style=color:#e6db74>`bson:&#34;registeredAt&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>cursor</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>collection</span>.<span style=color:#a6e22e>Aggregate</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>myPipeline</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>joined</span> []<span style=color:#a6e22e>joinedMember</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>cursor</span>.<span style=color:#a6e22e>All</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>joined</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>また時間があるときにある程度のデータ量でどのぐらいの負荷に対してパフォーマンスが出るのかを測ってみたい。</p><h2 id=ストレッチ>ストレッチ</h2><p>昨日1週間ぶりに筋トレをしたせいか、今朝から筋肉痛になっていてカラダが痛い。その影響もあって今日の開脚幅は開始前146cmで、ストレッチ後152cmとカラダが硬かった。足も腰も肩周りも全身にわたって軽い筋肉痛だった。それだけよい感じの負荷をかけて筋トレができていたと言えるのかもしれない。あちこち筋肉痛はあったものの、ストレッチを受けていての辛さのようなものは感じなかった。ちょうどよい感じにほぐされているような印象を受けた。もしかしたらトレーナーさんが気を遣っていつもよりは弱めにストレッチしてくれたのかもしれない。トレーナーさんが立候補していた店長選挙は落選してしまったらしい。もし店長になったらよそのお店へ転勤になって担当者が変わってしまうのかなとも思っていた。トレーナーさんは私が通っているお店の副店長を務める方向で調整しているらしい。待遇をあげていくにはキャリアアップをしていかないといけないといった背景もあるようにみえる。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0727/>食べなければ痩せるという真理</a></h1><div class=post-meta><time class=post-date>2024-07-27</time></div><span class=post-tags>#<a href=/diary/tags/exercise/>exercise</a>&nbsp;
#<a href=/diary/tags/health/>health</a>&nbsp;
#<a href=/diary/tags/career/>career</a>&nbsp;</span><div class=post-content><p>今日の運動はバドミントン,散歩,ハンドグリップをした。統計を <a href="https://docs.google.com/spreadsheets/d/1bg85QtM-LciUgey8I79uI7vW2PEwsP6TVdeIRVkACBg/edit?usp=sharing">運動の記録</a> にまとめる。オフィスで <a href=/diary/posts/2024/0707/#右股関節をよくするための体操>右股関節の改善体操</a> をした。</p><h2 id=体重と体脂肪率の考察の続き>体重と体脂肪率の考察の続き</h2><p>先週 <a href=/diary/posts/2024/0720/#体重と体脂肪率の考察>体重と体脂肪率の考察</a> をした。運動直後と空腹状態という状況で計測したら 66.9kg になったという記録を書いた。今週は維持しようと努めていたら普通に 67.0kg を切れるようになった。同じように金曜日の計測は筋トレして縄跳びまでした後にお風呂に入ってから計測しているから特異な値が出ている。運動量は以前より減っているのに、なぜ体重と体脂肪率が減り続けているかを考えたら、ひとえに食事を摂生しているからだと推測する。摂取カロリーが低いから体重が減っていく。</p><figure><img src=/diary/img/2024/0727_weight.jpg></figure><p>定常的に目標を達成できるようになったので暫定的に次の目標を体重 64.5kg、体脂肪率を14.0%に設定した。しかし、この目標は達成しなくてもよいと考えている。いまと同程度の体重と体脂肪率を維持していく取り組みに変えていきたい。もっと筋肉をつけておきたい。</p><h2 id=体育館でバドミントン>体育館でバドミントン</h2><p><a href=/diary/posts/2024/0710/#体育館でバドミントン>前回の所感</a> 。前回は平日の夕方に、今回は土曜日のお昼に開催してみた。今日は6人参加してくれた。4人が2対2で試合をして、疲れたら休んでいる人たちと交代するといった流れで2時間やった。前回は3人でずっとバドミントンしていたから疲れた。4人以上いれば適宜、休憩をとれるのでよかったと思う。この人数を安定的に集めるのが難しいかなぁ。そして、これ以上の人数が来てしまっても時間を持て余してしまう懸念もある。平日の方が参加しやすい人たちと土日の方が参加しやすい人たちは両方存在する。月1-2回ぐらいの頻度で平日と土曜日で調整ができれば、無理なくてちょうどよさそうな気がする。参加人数が増えてきて私が毎回参加しなくてよくなれば、抽選や予約数を増やしてもよいとは思う。時間に余裕があって常連として参加できるメンバーが増えてきたら管理者的なポジションも委譲していって、私が参加しなくてもまわるようにしていきたい。</p><h2 id=ストレッチ>ストレッチ</h2><p>バドミントンを終えてから毎週のストレッチへ行く。今日の開脚幅は開始前147cmで、ストレッチ後153cmと少しカラダが硬い。腰回りが張っていると伝えて、トレーナーさんに重点的にみてもらったらかなり張りがあるという。おそらくこれは背筋を鍛える機器による筋トレの筋肉痛だと話していて気付いた。水曜日か木曜日の寝起きから腰に張りがあると感じて、そのときは寝違えたのかなと思っていた。よくよく考えたら火曜日に筋トレしているから時間が経ってから筋肉痛がきたのだと推測する。そして金曜日も筋トレしているから張りが継続していてもおかしくない。腰から背中にかけて、トレーナーさんに念入りにストレッチしてもらって、かなりきつくて辛かったが、それはそれでよい調整になったと思う。</p><p>たまたまストレッチへ行く前の隙間時間で次の記事を読んでトレーナーさんと雑談した。</p><ul><li><a href=https://shueisha.online/articles/-/251154>〈兵庫県庁、2人目の自死を公表〉「弔慰金集めを“牛タン倶楽部”が妨害」なぜ阪神・オリックス優勝パレード担当課長の死は徹底隠蔽されたのか？</a></li></ul><p>パワハラや不正で公務員の関係者が2人自殺しているという悲惨な状況になっている。現場の公務員がなぜ自殺するのか？と考えたとき、キャリアを築けていないからだと推測する。公務員という仕事は潰しがきかない。シニア世代は同じ待遇で転職できない。シニア世代の公務員が本人の意志とは関係なくても不正に関わってしまうと、懲戒処分であったり、公務員としてのキャリアに傷がつく。そのときに公務員をやめても実力を活かして転職できればよいのだろうけれど、公務員はそれが相当に難しいのだと推測する。だからその職場での自身の信頼を失ってしまうことへの不安に耐えきれなくて自殺してしまうのではないかと推測する。</p><p>カフーツさんの <a href=/diary/posts/2024/0717/#キャンプ飯部と居場所>キャンプ飯部のイベント</a> のとき、やまさきさんは家がない状況でもなんとかやっていけているのは「仕事がある」ということが大きいように感じた。仕事があることが社会に帰属しているという精神的な充足に寄与している。本当の意味では公務員をやめても仕事はいくらでもあるのに、シニアはそれなりの待遇を得ているだろうから、同じ待遇の仕事をみつけられないというところで不安感や絶望感が強いのではないか。自身で制御できないものに依存した働き方は脆い。日本も今後はメンバーシップ型からジョブ型の働き方へ変わっていく。公務員は典型的なメンバーシップ型雇用と言える。若い人は公務員にならない方がよいと思う。</p></div></article><div class=pagination><div class=pagination__buttons><a href=/diary/tags/health/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span>
</a><a href=/diary/tags/health/page/3/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>