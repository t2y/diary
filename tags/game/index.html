<!doctype html><html lang=en><head><title>game :: forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/tags/game/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="game"><meta property="og:description" content><meta property="og:url" content="/diary/tags/game/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/tags/game/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0813/>戦略シミュレーションと特性</a></h1><div class=post-meta><time class=post-date>2022-08-13 (Sat.) ::</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/game/>game</a>&nbsp;</span><div class=post-content><h2 id=ストレッチ>ストレッチ</h2><p>今日の開脚幅は開始前158cmで、ストレッチ後161cmだった。先週よりやや数字が悪くなった。それでも先週はストレッチを受けていても体全体のだるさのようなものを感じていたのが、今回はちゃんと筋を伸ばしている感覚があって先週の体調の悪さはなくなったように思える。右股関節周りの詰まりに加えて、右前ももの張りがいつもより大きかった気がする。毎週ストレッチを受けていると物理的な体調の良し悪しもわかるのがよい。</p><h2 id=わざと負ける理由>わざと負ける理由</h2><p><a href=/diary/posts/2022/0812/#ドラクエタクトのリアルタイム対戦>一昨日からリアルタイム対戦</a> にはまっている。数をこなしていてわかってきたことがたくさんある。戦略シミュレーションゲームはやればやるほど学びがある。</p><ul><li>パーティーの特性によって相性のよい対戦相手とそうじゃないのがある<ul><li>リアルタイム対戦のマッチングは選択できないのでマッチングしないと相手がわからない</li><li>相性の悪い相手だとマッチング時点で辞退する (負けを認める) 相手もいる</li></ul></li><li>こっちの戦略に呼び込むための布石がいる<ul><li>3つぐらい戦略を用意して最終的にどの戦略に呼び込むかを相手の動きをみながら考えないといけない</li><li>キャラを動かす制限時間が15秒なのでわりと忙しい</li><li>こちらの布石にはめて最終的に勝てると達成感がある<ul><li>中盤まで負けていて向こうに勝ったと思わせて逆転できるとなお嬉しい</li><li><a href=https://game8.jp/dqtact/395606>ダークドレアム</a> は奇数ターン (1, 3, 5, 7 &mldr;) ごとに攻撃力・守備力・すばやさ・かしこさが1段階上がるバフがかかる<ul><li>ダークドレアムはすばやさが低いので徐々にすばやさが上がっていって先制できるようになると最後の1手違いで勝つ状況が出来上がる</li><li>ダークドレアムで5ターンまで戦闘を継続できれば勝率が高い</li></ul></li></ul></li></ul></li><li>すばやさの高いパーティーには何もできないから勝てない<ul><li>高すばやさ (且つ、高火力または状態異常) パーティーには絶対に勝てない<ul><li>リアルタイム対戦でダークドレアムがあまり使われていない理由だと思う</li></ul></li><li>初手前にパーティーの半分ぐらいがやられている</li><li>相手の攻撃が届かない初期配置がないので絶対に防げない</li></ul></li><li>状態異常攻撃の主体パーティーは対戦していておもしろくない<ul><li>混乱・麻痺・眠り・魅了といった状態異常になると2ターン何もできない</li><li>状態異常攻撃 + 高すばやさのキャラの攻撃を防ぐ方法はない<ul><li><a href=https://game8.jp/dqtact/455291>創造神マデサゴーラ</a> が出てきたら高い確率で勝てない</li></ul></li></ul></li><li>パーティー編成のウェイト制限がうまく調整されている<ul><li>高ランク (ステータス高い) のキャラばかりを編成できないようにウェイト制限がある</li><li>これにより、パーティー編成が4人か5人かにわかれる</li><li>低ランク (ステータス低い) のキャラはウェイトも低いので5人目には入れやすい<ul><li><a href=https://game8.jp/dqtact/390466>たたかいのベホイム</a> が使える <a href=https://game8.jp/dqtact/344037>ホイミスライム</a> が活躍したりする</li></ul></li></ul></li></ul><p>本題のわざと負ける理由だが、わかってきた。リアルタイム対戦のマッチングは同じランク内で行われる。上位のランクになればなるほど、対戦相手も強くなる (強くなければ上位のランクに上がれない) 。一定量のポイントを獲得するとランクアップしていけるが、負けるとポイントが下がるペナルティがつく。一定のランクで勝ち負けを繰り返すとそのランクに留まり続けるということができる。私も自分の限界までランクアップしてみて気付いたのは周りも強いので限界に到達すると勝ったり負けたりを繰り返す。ここで別のルールで勝った回数に応じてコインが支払われるボーナスがある。強い人が低いランクで勝ち数を稼ぐのは限界に近いランクで勝ったり負けたりを繰り返すよりもはるかに効率がよい。それはリアルタイム対戦のマッチングに時間制限があるからなおさらそうなる。実力が均衡した相手と時間をたくさん使って2勝3敗を繰り返すよりも、わざと負けながら弱い相手に勝ち続ける5勝?敗を繰り返す方が絶対数としての勝ち数を稼ぐには効率がよい。おそらく負けたときのペナルティがあるランクからわざと負ける人が現れ始めていると思う。なるほどなぁ。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0812/>dto に対するリフレクションの是非</a></h1><div class=post-meta><time class=post-date>2022-08-12 (Fri.) ::</time></div><span class=post-tags>#<a href=/diary/tags/game/>game</a>&nbsp;
#<a href=/diary/tags/java/>java</a>&nbsp;</span><div class=post-content><p>1時に寝て7時に起きた。</p><h2 id=ドラクエタクトのリアルタイム対戦>ドラクエタクトのリアルタイム対戦</h2><p>もう2年間もずっとゲームし続けている。最近 <a href=https://game8.jp/dqtact/462546>リアルタイム対戦</a> モードがリリースされた。全然やる気なかったんやけど、リアルタイム対戦で得たコインでもらえるアイテムが魅力的なのでやることにした。そして、実際にアルタイム対戦をやってみるとはまる。運営の手の平でゲームさせられている。</p><ul><li>人間が相手で狡猾な戦略で負けると悔しい</li><li>人間が相手の戦略の方が創意工夫があって学びになる</li><li>実際にやり始めるとおもしろくなってきてずっとやってしまう</li></ul><p>できる時間を制限しているというのもうまいやり方だなと思っている。朝・昼・晩の7-9時、12-14時、19-22時に制限している。そこまでしてリアルタイムに人間同士をマッチングしてゲームさせる必要があるのか？という素朴な疑問に私は辿りつくが、おそらくゲーム開発者からみたらそうじゃない大事なユーザー体験があるのだろうと推測する。あと不思議なことが1つ。マッチングしていると、たまにわざと負けてくれる人がマッチングされる。チームのメンバーが1人で向こうが先行なら戦いを辞退 (こちらの勝ちになる) するし、こちらが先行でもすぐにやっつけられる。ちゃんと統計をとってないけど、20回に1回ぐらいの頻度でわざと負けてくれる人とマッチングする。あの人たちは一体どういう理由でわざと負けているんだろう？</p><h2 id=リフレクションのユーティリティを作った>リフレクションのユーティリティを作った</h2><p>いまお手伝いで開発している api サーバーは外界と内部のデータの境界を明確にわけていて、外向けのオブジェクト定義と内部向けのオブジェクト定義が異なる。ほとんど同じデータであっても dto を介して値を受け渡ししないといけない。そうすると、次のような dto と他のオブジェクトとの値渡しのための処理が型ごとにあちこちに実装されている。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> MyRecord <span style=color:#a6e22e>toMyRecord</span><span style=color:#f92672>(</span>MyDataInput in<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    var record <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyRecord<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    record<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> in<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>    record<span style=color:#f92672>.</span><span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> in<span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    record<span style=color:#f92672>.</span><span style=color:#a6e22e>someId1</span> <span style=color:#f92672>=</span> in<span style=color:#f92672>.</span><span style=color:#a6e22e>someId1</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    record<span style=color:#f92672>.</span><span style=color:#a6e22e>someId2</span> <span style=color:#f92672>=</span> in<span style=color:#f92672>.</span><span style=color:#a6e22e>someId2</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    record<span style=color:#f92672>.</span><span style=color:#a6e22e>someId3</span> <span style=color:#f92672>=</span> in<span style=color:#f92672>.</span><span style=color:#a6e22e>someId3</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    record<span style=color:#f92672>.</span><span style=color:#a6e22e>sortOrder</span> <span style=color:#f92672>=</span> in<span style=color:#f92672>.</span><span style=color:#a6e22e>sortOrder</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    record<span style=color:#f92672>.</span><span style=color:#a6e22e>createUser</span> <span style=color:#f92672>=</span> in<span style=color:#f92672>.</span><span style=color:#a6e22e>createUser</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    record<span style=color:#f92672>.</span><span style=color:#a6e22e>updateUser</span> <span style=color:#f92672>=</span> in<span style=color:#f92672>.</span><span style=color:#a6e22e>updateUser</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>メンバー数が20-30ぐらいあると、たまに値のセット忘れがあったり、あとから追加したメンバーの保守ができてないとか、たまにトラブルが起きる。これ自体は間違っているわけじゃなくて境界を明確にわけるメリットもあるのでプログラミングの煩雑さとトレードオフと言える。</p><p>最近、私が管理系の web api のエンドポイントを作る機会が多いせいか、dto と外部向けのオブジェクトを明確にわける必要のない要件もあったりする。試しにリフレクションを使って同名のフィールド間の値の受け渡しは自動でやってみたらどんな感じかな？と思って作ってみた。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ReflectionUtil</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>ReflectionUtil</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> AssertionError<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;ReflectionUtil is a utility class&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> Field <span style=color:#a6e22e>getField</span><span style=color:#f92672>(</span>Class<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> klass<span style=color:#f92672>,</span> String fieldName<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> klass<span style=color:#f92672>.</span><span style=color:#a6e22e>getDeclaredField</span><span style=color:#f92672>(</span>fieldName<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>NoSuchFieldException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>T1<span style=color:#f92672>,</span> T2<span style=color:#f92672>&gt;</span> T2 <span style=color:#a6e22e>mapFieldValues</span><span style=color:#f92672>(</span>T1 fromInstance<span style=color:#f92672>,</span> T2 toInstance<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        var fromClass <span style=color:#f92672>=</span> fromInstance<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>var toField <span style=color:#f92672>:</span> toInstance<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredFields</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            toField<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            var fromField <span style=color:#f92672>=</span> getField<span style=color:#f92672>(</span>fromClass<span style=color:#f92672>,</span> toField<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>fromField <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                fromField<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    toField<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span>toInstance<span style=color:#f92672>,</span> fromField<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>fromInstance<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IllegalAccessException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> toInstance<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>これを使うと、先のコードがこれだけで済む。煩わしい値の受け渡しだけのコードを削減できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>var record <span style=color:#f92672>=</span> ReflectionUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>mapFieldValues</span><span style=color:#f92672>(</span>in<span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> MyRecord<span style=color:#f92672>());</span>
</span></span></code></pre></div><p>こんなことやると、セキュリティ的によくないとか反論されるかな？と思いながら pr を出してみたら思いの外、好評だったのでちょっと使ってみようと思う。</p></div></article><div class=pagination><div class=pagination__buttons></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>