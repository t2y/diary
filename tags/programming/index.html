<!doctype html><html lang=en><head><title>Programming :: </title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/tags/programming/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="Programming"><meta property="og:description" content><meta property="og:url" content="/diary/tags/programming/"><meta property="og:site_name" content><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/tags/programming/index.xml rel=alternate type=application/rss+xml title></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><h1>Posts for: #Programming</h1><div class=posts><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0813/>プロジェクトのボトルネック解消への壁</a></h1><div class=post-meta><time class=post-date>2024-08-13</time></div><span class=post-tags>#<a href=/diary/tags/programming/>programming</a>&nbsp;
#<a href=/diary/tags/motivation/>motivation</a>&nbsp;</span><div class=post-content><p>週末は休んでいたので今日は調子よかった。週末にある程度やっておこうと思っていた実装作業が手つかずだったものの、午前中の定例会議でメンバーに設計内容の最終確認をした。それから集中してコードを書いていたら日付が変わるぐらいの時間まではやっていたけれど、大きな仕様変更を完了した。</p><p>連休の週末に時間があったにも関わらず、なにもやらなかったのはこの仕様変更のための作業に私自身が本当の意味で関心をもっていないのではないかという仮説をたてた。仕事でやらなければいけない、面倒でやや規模の大きな作業を、個人の時間で取り組むほどのモチベーションをもっていない。そして無意識的に脳が業務時間だけでできると判断してしまっている。実際にそれで完了することも多い。開発の前倒しはできないが。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0809/>今週は開発者として実装に集中していた</a></h1><div class=post-meta><time class=post-date>2024-08-09</time></div><span class=post-tags>#<a href=/diary/tags/programming/>programming</a>&nbsp;
#<a href=/diary/tags/investing/>investing</a>&nbsp;</span><div class=post-content><h2 id=久しぶりに実装に集中した金曜日>久しぶりに実装に集中した金曜日</h2><p>既存の web api のある機能を再設計する。既存機能のエンドポイントの見直しも含むのでテストコードなども移行しないといけない。ひとまずエンドポイントの移行と機能分割はできた。最低限の進捗。まだこれから仕様変更や拡張を追加していく。似て非なる機能を分割しているので名前の付け方をわかりやすくしないといけない。用途と名前空間をうまく組み合わせてわかりやすくしたいが、こういう作業は深夜よりも朝の方がうまくいく気がするのでまた明日にする。朝起きれるかなぁ。</p><h2 id=オプトラン中間決算>オプトラン中間決算</h2><p><a href=/diary/posts/2024/0802/#日経平均株価の急落>先週の金曜日にオプトランの株価が1500-1600円台まで落ちれば</a> 割安で狙い目ではないかと書いた。実際に月曜日に歴史的な暴落があって寄りと引けで購入していて、それぞれ 1,490 と 1,466 だった。過去5年の最安値が 1,420 なので割安だろうと考えた。昨日、中間決算があって <a href=https://www.optorun.co.jp/ir/upload_file/m000-/2024_0808_2q.pdf>2024年12月期 第2四半期 決算説明資料</a> をみていた。通期での業績は変更していないものの、直近の四半期の業績はよくなかった。前四半期がかなりよかったため、半期の累計としてみたら通期目標に対する進捗はよいと言える。しかし、直近の四半期の業績はよくないから、この空気は売り込まれるやつだと昨日の夜の時点では予想していた。経営陣もそれを見越してなのか <a href=https://www.optorun.co.jp/ir/upload_file/tdnrelease/6235_20240808566828_P01_.pdf>7.72% の自社株買い</a> を発表している。月曜日に割安と考えた見立ては失敗だったかなと諦めつつ、今朝の時点では、大きく売り込まれたらまた買い増ししようとも考えていた。結果的に今日の株価は 1,640 で始まって 1,697 で終わった。自社株買いのおかげ？私のこれまでのオプトランの観察眼では、大きく売り込まれるはずだったのが、なにもなく過ぎ去った。また定期的に少しずつ買い集めていって2024年12月期の決算が終わったときに覚えていたらふりかえってみたい。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0808/>寝不足でバテた</a></h1><div class=post-meta><time class=post-date>2024-08-08</time></div><span class=post-tags>#<a href=/diary/tags/programming/>programming</a>&nbsp;</span><div class=post-content><h2 id=久しぶりに実装に集中した翌々日>久しぶりに実装に集中した翌々日</h2><p>火・水と連日で遅くまでコードを書いていてバテた。晩ごはんをオフィスで食べて帰って20時頃からそのまま寝てた。区切りがよかったのもあって今日は休むことにした。疲れが溜まっていたからすぐ眠れた。2時頃に一度起きたものの、わりとぐっすり眠れた。深夜までコードを書いていたから単純に寝不足だったように思う。私がボトルネックに成りうる大きな課題の1つを解消した。よいペース。今週中にもう1つの大きな課題を fix したい。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0807/>一開発者としてコードを書く日々</a></h1><div class=post-meta><time class=post-date>2024-08-07</time></div><span class=post-tags>#<a href=/diary/tags/programming/>programming</a>&nbsp;</span><div class=post-content><h2 id=久しぶりに実装に集中した翌日>久しぶりに実装に集中した翌日</h2><p><a href=/diary/posts/2024/0806/>昨日に引き続き</a>、日中コードを書いて、晩ごはんを食べた後にまたコードを書き始めて、翌1時半ぐらいまで書いていた。昼間はどうしても他メンバーの進捗をみたり、質問を受けたりするから割り込みで作業を中断されがち。夜は割り込みが入らないことがわかっているからコードを書くことに集中さえできれば区切りのよいところまで一気に書ける。いままで夜に運動していた時間をしばらくはコードを書くことに割く。いま私がボトルネックになりそうな課題を抱えているのでそこを早めに解消しておきたい。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0806/>一開発者としてコードを書く</a></h1><div class=post-meta><time class=post-date>2024-08-06</time></div><span class=post-tags>#<a href=/diary/tags/programming/>programming</a>&nbsp;</span><div class=post-content><h2 id=久しぶりに実装に集中>久しぶりに実装に集中</h2><p>8時半から20時半までコードを書いて、気分転換に買いものへ行ってきて、22時から仕様変更した内容に関するドキュメントを書いて24時までお仕事をしていた。<a href=/diary/posts/2024/0731/>プロジェクトマネージャーを移行</a> して開発者に戻ったことにより、心理的にコードを書くことに集中しやすくなった。1年半ほど開発者から離れていたことの、勘どころのようなものも徐々に取り戻していく。運動と一緒でコードを集中して書いていると嫌なことを忘れられてよい。コードを書くことも私にとっては瞑想に近いものになっている。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0410/>go の generics に慣れてきた</a></h1><div class=post-meta><time class=post-date>2024-04-10</time></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/design/>design</a>&nbsp;
#<a href=/diary/tags/programming/>programming</a>&nbsp;</span><div class=post-content><p>今日の運動は腹筋ローラー,スクワット,縄跳び(両足跳)をした。統計を <a href="https://docs.google.com/spreadsheets/d/1bg85QtM-LciUgey8I79uI7vW2PEwsP6TVdeIRVkACBg/edit?usp=sharing">運動の記録</a> にまとめる。</p><h2 id=go-の-generics-の扱い>go の generics の扱い</h2><p>今日はほぼまる一日コードを書いていた。あるデータ型のリファクタリングをしていて次のような constraint とメソッドの組み合わせで型チェックできることを理解した。generics 使って1年以上開発しているので感覚的にも慣れてきた。User と Group のどちらかを受け取る constraint とそのデータストアの定義は次のようになる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserOrGroup</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>User</span> | <span style=color:#a6e22e>Group</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>GetPrimaryID</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserOrGroupStore</span>[<span style=color:#a6e22e>E</span> <span style=color:#a6e22e>UserOrGroup</span>] <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>generic</span>.<span style=color:#a6e22e>Store</span>[<span style=color:#a6e22e>E</span>]
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>FindByPrimaryID</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>primaryID</span> <span style=color:#66d9ef>string</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>E</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>この型定義を使う関数では次のようになる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>find</span>[
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>E</span> <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>UserOrGroup</span>,
</span></span><span style=display:flex><span>](
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>store</span> <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>UserOrGroupStore</span>[<span style=color:#a6e22e>E</span>], <span style=color:#a6e22e>primaryID</span> <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>E</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>e</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>store</span>.<span style=color:#a6e22e>FindByPrimaryID</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>primaryID</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ee</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>e</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ee.PrimaryID はコンパイルが通らない
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>_</span> = <span style=color:#a6e22e>ee</span>.<span style=color:#a6e22e>GetPrimaryID</span>() <span style=color:#75715e>// 現時点ではメソッド呼び出しが必要
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>ここで UserOrGroup に <code>GetPrimaryID()</code> というメソッドを追加している。本来は両方の構造体に保持するメンバー属性ではあるものの、現時点の go のコンパイラはメンバー属性を正しくチェックできない。そのため、メソッドにして generics の型チェックが正しく通るようにしないといけない。go の issue にも上がっているのでいずれはメンバー属性を解決できるようになるのだろうと推測する。</p><ul><li><a href=https://github.com/golang/go/issues/48522>proposal: spec: permit referring to a field shared by all elements of a type set #48522</a><ul><li><a href=https://github.com/golang/go/issues/63940>spec: investigate if we can remove (most or all) needs for the concept of a core type #63940</a></li></ul></li></ul></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1006/>税理士さんの選定</a></h1><div class=post-meta><time class=post-date>2023-10-06</time></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/programming/>programming</a>&nbsp;</span><div class=post-content><p>1時に寝て3時頃に吐き気で起きて1時間ぐらい苦しんでた。久しぶりにやばかった。その後なんとか寝て7時半に起きた。</p><h2 id=税理士さんとの打ち合わせ1>税理士さんとの打ち合わせ1</h2><p>うちの会社のイベントとして毎年ワーケーション (開発合宿) をやろうかと考えている。コワーキングやコミュニティの延長上でワーケーションを行うわけだが、いくらかうちの会社の持ち出しで費用負担してよいと考えている。しかし、そのときの支出はどういった建付けで経費として扱えるのかどうか、私は税理士ではないのでよくわかっていない。そういったことを相談するために税理士さんに顧問になってもらおうと考えている。うちから税理士さんへの要件としては freee のデータを正として扱ってくれればそれでいいかな。</p><p>また2021年度は赤字決算になったので2022年度に <a href=/diary/posts/2022/0626/#法人税の修正申告と欠損金の繰り戻し還付の訂正依頼>法人税の欠損金の繰り戻し還付</a> を行った。このお金を2022年度に計上していないため、その分の金額が資産のマイナスとして2023年度の決算に残ってしまっている。法人税の支払いは正しいのだが、還付金を2023年度に雑収入として登録するか、2022年度に遡って未計上の金額を登録するかのどちらかで訂正しないといけない。過去の法人決算の訂正自体も行う仕組みはあるので手続きするだけだが、それも手間暇がかかるのでついでに税理士さんにやってもらうと考えている。</p><ul><li><a href=https://support.freee.co.jp/hc/ja/articles/204403124-%E7%A8%8E%E7%90%86%E5%A3%AB-%E4%BC%9A%E8%A8%88%E5%A3%AB%E3%81%ABfreee%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%85%B1%E6%9C%89%E3%81%99%E3%82%8B>税理士・会計士にfreeeの情報を共有する</a></li></ul><p>会計システムに freee を使っているので freee さんの税理士紹介サービスを使って選定する。3事務所ピックアップしてくれたので順番に打ち合わせしていく。今日はその最初の税理事務所の方と打ち合わせした。話した感覚でうちの会社の考え方や規模にあった税理士さんだったのでこの方でいいんじゃないかとも思っているけれど、せっかく他の事務所もピックアップしてくれたので他の税理士さんの話も来週また聞いてみる。</p><h2 id=コードレビュー>コードレビュー</h2><p>まる一日コードレビューをしていた。私もマージリクエストを投げていてレビューしてもらいつつ、メンバーのコードレビューも順番にやっていった。その中で smtp の仕様を把握しておく必要があっていくつかシニアエンジニアの方からもアドバイスをもらって、私もそうだったんだと勉強していた。メールヘッダーのエンコーディング、昔は覚えていたけど、ずっとメールを送るコードを書いてなかったので私も忘れてしまっていた。こういうことをさらっと指摘できるのがシニアエンジニアのすごいところ。</p><ul><li><a href=https://fumiyas.github.io/2014/12/13/sendmail.postfix-advent-calendar.html>sendmail コマンドによるメール発信 - Postfix Advent Calendar 2014 - ダメ出し Blog</a></li></ul><p>go だと標準ライブラリに <a href=https://pkg.go.dev/mime>mime</a> パッケージがある。mime パッケージを使って件名を utf-8 でエンコーディングされた文字列で指定すると次のようになる。q エンコーディングと b エンコーディングの2種類がある。b エンコーディングの方がデータ量が減ってよさそう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Subject: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>mime</span>.<span style=color:#a6e22e>QEncoding</span>.<span style=color:#a6e22e>Encode</span>(<span style=color:#e6db74>&#34;utf-8&#34;</span>, <span style=color:#e6db74>&#34;テスト&#34;</span>))
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Subject: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>mime</span>.<span style=color:#a6e22e>BEncoding</span>.<span style=color:#a6e22e>Encode</span>(<span style=color:#e6db74>&#34;utf-8&#34;</span>, <span style=color:#e6db74>&#34;テスト&#34;</span>))
</span></span></code></pre></div><pre tabindex=0><code>Subject: =?utf-8?q?=E3=83=86=E3=82=B9=E3=83=88?=
Subject: =?UTF-8?b?44OG44K544OI?=
</code></pre><ul><li><a href=https://go.dev/play/p/zQjMMp17bKf>https://go.dev/play/p/zQjMMp17bKf</a></li></ul></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0527/>go のジェネリクスと型の集合</a></h1><div class=post-meta><time class=post-date>2023-05-27</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/design/>design</a>&nbsp;
#<a href=/diary/tags/programming/>programming</a>&nbsp;</span><div class=post-content><p>0時に寝て何度か起きて7時に起きた。22時頃に素麺を食べたら夜に吐き気がして食べるんじゃなかった。</p><h2 id=ストレッチ>ストレッチ</h2><p>今週はいつも通りの普通の1週間を過ごした感じ。休養していたわけでもなく負荷が高かったわけでもない。私の感覚的には右太もも後ろの筋と右腰の張りが強かった。トレーナーさん的には腰は大丈夫そうに言っていて、股関節全体の硬さは常態化しているものだけど、すねの筋もやや張りがあったように話していた。私の感覚とトレーナーさんの感覚がちょっとズレていた。今日の開脚幅は開始前154cmで、ストレッチ後158cmだった。一時期の3-4月の疲弊した状態ではないので一番悪い時期は脱したようにもみえる。</p><h2 id=go-の学び直し>go の学び直し</h2><p><a href=https://tenntenn.connpass.com/event/282717/>Gopher塾 #5 - ジェネリクスが書けるようになろう</a> に参加した。</p><p>すでにうちのプロダクトはジェネリクスを使った開発を行ってはいるけれど、私自身まだ曖昧なところがあったり、どういった設計がよいのかの手探り状態である。go はオブジェクト指向言語ではない (それ自体は構わない) ところが java のジェネリクスとは異なっていて、なにがその根本的な違いになっているのかを、私の中ではまだ理解できていなかった。その答えがこの勉強会に出てわかった気がする。もう少し独学して理論的に理解する必要はあるが、私に足りなかった知識が参加前よりも明確になったのでこの後の学習は容易に思える。</p><p>イベントではワークシートに自分で理解したメモや課題の回答を書き出すよう tenntenn さんが促していた。私はメモを自社の課題管理システムに書いていたのでワークシートには書いていないが、自分の理解を書き出すことの重要性は同意できる。tenntenn さんは次のように説明していた。</p><blockquote><p>概念や理解したことを自分の言葉で表現できるか？を確認するために書くことは大事。</p><p>もし書いた内容が間違っていても、間違ったことを認識できることにも意味がある。</p><p>つまり、学んだことを書くことは正しくても間違っていても得られるものがある。</p></blockquote><p>この考え方は私が提唱する課題管理にも通じている。なぜ書くかの理由の1つは自分の理解を整理するためでもある。そして、その文章を外部から監視できることで上長が助言できる。私にとっては習慣として身に付いた事柄ではあるけれど、改めてこういうことをチームのメンバーに啓蒙したり、開発ガイドに書いておくとよいように思えた。go の勉強会に参加して課題管理で学ぶことがあるとは思わなかった。よいこと尽くめだ。</p><p>閑話休題。本題のジェネリクスについて3割ぐらい知らないことがあった。私が java のジェネリクスと比べて go のジェネリクスを完全に理解できていなかったところの要因は <a href=https://go.dev/blog/intro-generics>型の集合 (Type sets)</a> の概念を理解できていなかったところに起因する。go ではジェネリクスを導入するにあたってインターフェースに型の集合という概念を導入した。それまでのインターフェースはメソッドの集合を管理するだけだったが、型の集合も管理できるようになった。また go には <a href=https://go.dev/ref/spec#Underlying_types>Underlying types</a> という概念が当初から存在したが、それを意識してプログラミングすることはなかった。これを日本語にすると「基底型」となるが、オブジェクト指向言語で言うところの基底型とはまったく異なる。なにせ継承できないのだから。インターフェースに型の集合として次の記述ができるようになった。Underlying types はこれまで概念としてしか存在していなかったのがチルダを用いた文法で表現できるようになったため、その理解も強いられるようになった。</p><p><a href=https://zenn.dev/nobishii/articles/99a2b55e2d3e50>Go の &ldquo;Type Sets&rdquo; proposal を読む</a> によると、現時点での型の集合とは次の2つを指す。</p><ul><li>~T approximation element (近似要素)</li><li>T | U union element (合併要素)</li></ul><p>union 型のようなものは他言語でもある概念なのでイメージしやすいが、Underlying types をチルダを使って指定するのは go 独自？の概念なので新たに学び直す必要がある。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0316/>ポインタの学び直し、参照とは違う</a></h1><div class=post-meta><time class=post-date>2023-03-16</time></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/programming/>programming</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;</span><div class=post-content><p>2時に寝て7時に起きた。深夜に葬送のフリーレン10巻を読んでからなんとなく眠れなくて夜更かししてた。木曜日は会議がなくて自分のために時間を使える。機能開発に集中して実装していた。</p><h2 id=go-の学び直し>go の学び直し</h2><p><a href=https://tenntenn.connpass.com/event/275805/>Gopher塾 #4 - 私も解説できるポインタ - DAY1</a> に参加した。</p><p>今日のテーマはポインタ。tenntenn さんが話すのだから深い内部実装の話しなどもあるのかな？と期待していたけれど、これは基本的な go のポインタの扱いを学ぶ講義だった。私にとっては9割は知っていることだった。それでも1割は知らないことがあったので参加して勉強にはなった。この歳になると本やイベントから1-2割学べたら十分だと思う。go は内部的にすべて値渡しで何でもコピーするするといった振る舞いをする。ポインタを渡すと、ポインタの値であるアドレスをコピーすることでプログラムが動く。コピーなので大きな構造体をそのまま渡すとその分のメモリのオーバーヘッドがあって遅くなったりする。ポインタならアドレスだけのコピーで済む。</p><p>go には参照の概念はないという説明があって、ポインタと参照は別の概念なんだと今更ながらに気付いた。gpt-4 にポインタと参照の違いを尋ねたりしていた。参照は初期化後に変更できなかったり、null を参照できなかったり、ポインタ演算のようなことができなかったりすることで安全にプログラミングするための言語機能と言える。一般的には参照はポインタを使って実装される。ポインタの方が低レイヤで制約が少ないと言える。参照はポインタの一部の機能を安全にプログラマーに提供していると言える。</p><p>次に go のポインタの特徴をまとめる。</p><ul><li>型付け<ul><li>ポインタは型付けされていて、特定の型の変数のアドレスだけがその型のポインタに割り当てられる</li></ul></li><li>アドレス演算子とデリファレンス演算子<ul><li>これらを単項演算子と呼ぶ</li><li>アドレス演算子 (&) で変数のアドレスを取得してポインタを作成する</li><li>デリファレンス演算子 (*) でポインタが指すアドレスに格納されている値にアクセスする</li></ul></li><li>ポインタ演算制限</li><li>ポインタ演算は許可されていない、メモリアクセスの誤りやセキュリティ上の問題が軽減される</li><li>new と make 関数<ul><li>new 関数を使うと指定された型の新しい変数を作成してそのアドレスを返す</li><li>make 関数は、スライス、マップ、チャネルなどの複合データ構造を作成および初期化して、それらへのポインタを返す</li></ul></li><li>ポインタの nil 値<ul><li>ポインタは、無効なアドレスを表す特別な値である nil をもてる</li><li>nil ポインタにアクセスしようとすると、実行時に panic が発生する</li></ul></li><li>メソッドレシーバとしてのポインタ<ul><li>メソッドレシーバとしてポインタを使うとメソッド内でレシーバオブジェクトの変更ができる<ul><li>値レシーバは意図せぬ不具合を招く可能性があるから基本的にはポインタレシーバを使う方がよいのではないかといった話しもあった</li></ul></li></ul></li></ul></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1211/>休日のオンライン学習</a></h1><div class=post-meta><time class=post-date>2022-12-11</time></div><span class=post-tags>#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/migration/>migration</a>&nbsp;
#<a href=/diary/tags/team-building/>team building</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/programming/>programming</a>&nbsp;</span><div class=post-content><p>0時に寝て夜中に吐き気がして2回ほど起きて3時と5時に起きて8時に起きた。なかなか苦しい寝方をした。</p><h2 id=ヤフートラベルと一休comのシステム統合>ヤフートラベルと一休.comのシステム統合</h2><p>アーカイブ公開されたらみようと思いつつ忘れてたので見返した。</p><div class=video-container><iframe src=https://www.youtube.com/embed/JN4kGYbQMJ8 allowfullscreen title="ヤフートラベルのシステムリニューアル 一休 com とのシステム統合 -日本語版-"></iframe></div><p>雑なめも。また機をみて見返すこともあるかも。</p><ul><li>バックエンドは完全に一休側に寄せるという大きな意志決定を2016年に行った<ul><li>この意志決定はフロントエンド統合にも大きな影響を与えた</li><li>ふじもんさんの意志決定がよかった？</li></ul></li><li>今日の話しはマルチブランドデザインシステム統合がメイン<ul><li>開発者が50-60人程度で半年ぐらいで launch できた</li><li>nuxt/vuejs で開発している</li><li>スタイルは tailwindcss を使っている</li><li>実は launch した後にこのシステムが必要だとわかった<ul><li>開発者とデザイナー間の細かい意思疎通が困難</li><li>外部からデザインシステムに詳しい人にも来てもらっていろんな議論をした</li><li>ガイドラインを言語化するところから始め、最終的にソースコードの共有ができるようになった</li></ul></li><li>終わってからデザインシステムそのものは重要ではないと気付いた<ul><li>この過程で開発者とデザイナー間のどのように共通化するか、あるいはしないかと議論を繰り返し行ったことが重要だったと当事者がインタビューで語っていた</li><li>デザインシステムの開発を通じてデザインの共通認識をもてたことがよかった</li></ul></li></ul></li><li>波及効果<ul><li>同じソースコードから少し異なる体験の開発のノウハウができた</li><li>ふるさと納税に特化した宿泊予約サイトを作った</li></ul></li><li>統合は終わりではない、lauch したところが始まり<ul><li>統合後にいろいろな施策をすることで課題がみえてくることがある</li></ul></li><li>全国旅行支援は1つの開発で2つの体験をつくることができた</li><li>Q. デザイナーと開発者はわりと仲が悪いのでは？価値観や考え方が異なるのですり合わせるのは難しいのでは？<ul><li>過去の一休でも起きていた</li><li>一休のチームはデザイナーと PM と開発者で構成されている<ul><li>このチームが一緒に働いていてチームでなるべく意志決定している</li><li>普段から一緒に働いていると仲が悪いということはなかった</li><li>とはいえ、仕事のプロセスが異なるので課題はあった<ul><li>地道に丁寧にすり合わせを行った</li><li>外部から講師を読んで中立的な立場でワークショップを何度も行った</li></ul></li></ul></li><li>デザイナーと開発者を別の組織にしているとコミュニケーションの壁ができてしまうかもしれない</li></ul></li></ul><h2 id=go-の学び直し>go の学び直し</h2><p><a href=/diary/posts/2022/1123/#go-の学び直し>テストの学び直し</a> に引き続き、<a href=https://tenntenn.connpass.com/event/267564/>Gopher塾 #2 - Goらしいコードの書き方 - DAY 1</a> に参加した。</p><p>テストの次のプログラミングの話しだったので内容そのものは難しくはなかったけど、改めて重要な項目を選抜しているのだと考えると学びはあったと思う。参考になったことをいくつか覚えている範囲でまとめる。名前の付け方について感覚的に理解していたし、実際に私はそうしているけど、コードレビューしていて自然になっていないコードを指摘する機会も多いので一定の習熟を要するのかもしれない。いま毎週勉強会をやっていて私が講師として話している。ネタがなくなってきたり大変になったきたら準備の少ないコードリーディング会もやってみたいと思った。</p><ul><li><a href=https://google.github.io/styleguide/go/>google Go Style</a></li><li><a href="https://cs.opensource.google/go/x/pkgsite/+/master:internal/derrors/derrors.go;l=237">derrors.Wrap</a></li><li>名前に文脈を与えるという概念<ul><li>相対的な名前をつける</li></ul></li><li>準備の少ないコードリーディング会<ul><li>お題（読むパッケージ）を決める</li><li>選んだお題に期待することを当日話す</li><li>時間を決めてみんなでそれぞれ読む（20分とか）</li><li>読みながらSlackのスレッドにメモをしていく</li><li>残りの時間で気になったところを議論する</li><li>自分が気づけなかった点を知ることができる</li></ul></li></ul></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1117/>技術選定の根拠</a></h1><div class=post-meta><time class=post-date>2022-11-17</time></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/programming/>programming</a>&nbsp;</span><div class=post-content><p>0時に寝て5時に起きた。夜中に目覚めたかどうかはわからないぐらいにはたぶん寝てたと思う。</p><h2 id=go-の-http-フレームワークの選定>go の http フレームワークの選定</h2><p>net/http で実装していた web api サーバーにフレームワーク導入しようかと考えている。いままでは認証・認可を外部で行う想定だったが、やっぱり api サーバーに実装した方がよいだろうと要件を再確認したので routing と middleware を再利用できるフレームワークを使うメリットが出てくる。net/http 上で直接 routing, middleware を実装するのは別に難しくないから自分で実装すればよいという考え方がある。一方で誰が実装しても大して変わらないものを車輪の再発明する必要があるのかというところに私は懸念に感じる。また <a href=https://pkg.go.dev/context>context</a> があとから標準ライブラリに追加されたため、net/http の HandlerFunc は context をシグネチャにもっていない。リクエストコンテキストをもっていないのが net/http の欠点だと私は考えていた。しかし、調べてたら <a href=https://pkg.go.dev/net/http#NewRequestWithContext>NewRequestWithContext</a> が追加されていてハンドラーではなくリクエストからリクエストコンテキストを扱えるようになっていた。これは私の勘違いだった。</p><p>フレームワークを使おうと決めて難しいのはなにを選ぶか。最近の流行り廃りや動向を私は知らないので基準がない。たまたましぶかわさんの記事をみつけて読んでいた。</p><ul><li><a href=https://future-architect.github.io/articles/20210714a/>Goのおすすめのフレームワークはnet/http</a></li></ul><p>この中で紹介されている <a href=https://github.com/go-chi/chi>chi</a> か <a href=https://echo.labstack.com/>echo</a> のどちらかにしようと直観で決めた。echo は以前 go の勉強会をしたときにいけうちさんが採用していたのでよく覚えている。そのときの話しを聞いていてもよさそうにみえた。たまたま echo のサイトをみたら Shiguredo さんのロゴがあって驚いた。スポンサーをされているらしい。chi はまったく知らない。どちらも十分によく使われていて middleware も揃っているフレームワークにみえる。本質的にはどちらを選んでも構わない。一方でマネージャーとしてどういう調査をして、どういう根拠で、どの技術を選定するのか。メンバーに対して説明責任を果たすためにこの2つのフレームワークの調査をすることに決めた。私自身がどちらもフレームワークも使ったことがないので軽くコードも書いてみてどんな雰囲気なのか感触を掴みつつ、フレームワークのソースコードも読んでみようと思う。</p></div></article><div class=pagination><div class=pagination__buttons><a href=/diary/tags/programming/page/2/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>