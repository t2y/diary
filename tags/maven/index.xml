<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>maven on forest nook</title><link>/diary/tags/maven/</link><description>Recent content in maven on forest nook</description><generator>Hugo -- gohugo.io</generator><language>ja-jp</language><copyright>© 2021 Tetsuya Morimoto</copyright><lastBuildDate>Thu, 23 Dec 2021 08:35:00 +0900</lastBuildDate><atom:icon>/diary/favicon.ico</atom:icon><icon>/diary/favicon.ico</icon><atom:link href="/diary/tags/maven/index.xml" rel="self" type="application/rss+xml"/><item><title>maven のバージョンチェック処理の振る舞い</title><link>/diary/posts/2021/1223/</link><pubDate>Thu, 23 Dec 2021 08:35:00 +0900</pubDate><guid>/diary/posts/2021/1223/</guid><description>23時に寝て1時に起きてまた寝て6時半に起きた。変なライフサイクルになってきた。
maven のアップデートポリシー maven が依存解決するとき、例えばバージョンの範囲を指定して最新バージョンを取得するといった設定ができる。実行していると、新しいバージョンをチェックしにいくときとそうじゃないときがあって、どういう仕組みで動いているのかよくわからなかったのでデバッグした。言うても DEBUG ログを出力させて、ログの内容をソースで grep しながら関連するところを読んだだけ。
DefaultUpdateCheckManager.isUpdateRequired の中でポリシーが最終チェック日付を確認していいる。ここから辿っていくと ArtifactRepositoryPolicy という仕組みがある。
return ( lastCheckDate == null ) || policy.checkOutOfDate( lastCheckDate ); ドキュメントでそれっぽい内容を調べると updatePolicy を設定できるようになっている。デフォルトは daily なので日次でチェックしにいくような振る舞いをする。バージョンチェックするときとしないときの何が違うのか、よくわかっていなかった振る舞いを理解できた。これはビルドキャッシュの有無に関係ないのでキャッシュがあるからバージョンチェック処理をスキップできるわけではない。もちろん、更新をチェックさせたくないのであれば never に設定してもいいのかもしれない。
updatePolicy
The frequency for downloading updates - can be &amp;ldquo;always&amp;rdquo;, &amp;ldquo;daily&amp;rdquo; (default), &amp;ldquo;interval:XXX&amp;rdquo; (in minutes) or &amp;ldquo;never&amp;rdquo; (only if it doesn&amp;rsquo;t exist locally).
https://maven.apache.org/ref/3.6.3/maven-settings/settings.html</description><content>&lt;p>23時に寝て1時に起きてまた寝て6時半に起きた。変なライフサイクルになってきた。&lt;/p>
&lt;h2 id="maven-のアップデートポリシー">maven のアップデートポリシー&lt;/h2>
&lt;p>maven が依存解決するとき、例えばバージョンの範囲を指定して最新バージョンを取得するといった設定ができる。実行していると、新しいバージョンをチェックしにいくときとそうじゃないときがあって、どういう仕組みで動いているのかよくわからなかったのでデバッグした。言うても DEBUG ログを出力させて、ログの内容をソースで grep しながら関連するところを読んだだけ。&lt;/p>
&lt;p>&lt;a href="https://github.com/apache/maven/blob/maven-3.6.3/maven-compat/src/main/java/org/apache/maven/repository/legacy/DefaultUpdateCheckManager.java#L110">DefaultUpdateCheckManager.isUpdateRequired&lt;/a> の中でポリシーが最終チェック日付を確認していいる。ここから辿っていくと &lt;a href="https://github.com/apache/maven/blob/maven-3.6.3/maven-artifact/src/main/java/org/apache/maven/artifact/repository/ArtifactRepositoryPolicy.java#L115">ArtifactRepositoryPolicy&lt;/a> という仕組みがある。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">(&lt;/span> lastCheckDate &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">||&lt;/span> policy&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">checkOutOfDate&lt;/span>&lt;span style="color:#f92672">(&lt;/span> lastCheckDate &lt;span style="color:#f92672">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ドキュメントでそれっぽい内容を調べると &lt;code>updatePolicy&lt;/code> を設定できるようになっている。デフォルトは &lt;code>daily&lt;/code> なので日次でチェックしにいくような振る舞いをする。バージョンチェックするときとしないときの何が違うのか、よくわかっていなかった振る舞いを理解できた。これはビルドキャッシュの有無に関係ないのでキャッシュがあるからバージョンチェック処理をスキップできるわけではない。もちろん、更新をチェックさせたくないのであれば &lt;code>never&lt;/code> に設定してもいいのかもしれない。&lt;/p>
&lt;blockquote>
&lt;p>updatePolicy&lt;/p>
&lt;p>The frequency for downloading updates - can be &amp;ldquo;always&amp;rdquo;, &amp;ldquo;daily&amp;rdquo; (default), &amp;ldquo;interval:XXX&amp;rdquo; (in minutes) or &amp;ldquo;never&amp;rdquo; (only if it doesn&amp;rsquo;t exist locally).&lt;/p>
&lt;p>&lt;a href="https://maven.apache.org/ref/3.6.3/maven-settings/settings.html">https://maven.apache.org/ref/3.6.3/maven-settings/settings.html&lt;/a>&lt;/p>
&lt;/blockquote></content></item></channel></rss>