<!doctype html><html lang=en><head><title>slack :: forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/tags/slack/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="slack"><meta property="og:description" content><meta property="og:url" content="/diary/tags/slack/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/tags/slack/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0923/>slack apps 開発に着手</a></h1><div class=post-meta><time class=post-date>2022-09-23 (Fri.) ::</time></div><span class=post-tags>#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
#<a href=/diary/tags/quarkus/>quarkus</a>&nbsp;</span><div class=post-content><p>0時に寝て6時に起きた。あまりうまく眠れなかった。</p><h2 id=bolt-for-java>bolt for java</h2><p>slack apps を開発するためのフレームワークとして <em>bolt</em> と呼ばれる高レベルのフレームワークが提供されている。このフレームワークは <em>slack sdk</em> を使って作られていて、slack apps の開発が簡単になるようにユーティリティが提供されている。<a href=https://api.slack.com/tools/bolt>The Bolt family of SDKs</a> によると、javascript, python, java 向けに提供されている。以前 bizpy でも slack アプリ開発のチュートリアルの勉強会をしたことがある。そのときは bolot for python を使っていた。</p><ul><li><a href=https://github.com/t2y/python-study/tree/master/BizPy/slack>python-study/BizPy/slack</a></li></ul><p>一度触ったことがあったので <em>bolt</em> がどういうものかはすでに知っている。その java 版を使って slack apps を作ってみようと取り組み始めた。まずはチュートリアルを一通りやってみようと次のリポジトリでやってみた。</p><ul><li><a href=https://github.com/t2y/bolt-java-sample>https://github.com/t2y/bolt-java-sample</a></li></ul><p>チュートリアルの内容を動かすだけならすぐできた。次に java の waf は何を使おうかを調べてた。<a href=https://slack.dev/java-slack-sdk/guides/supported-web-frameworks>Supported Web Frameworks</a> によると、次の4つがある。</p><ul><li>spring boot</li><li>micronaut</li><li>quarkus undertow</li><li>helidon se</li></ul><p>さらに <a href=https://github.com/slackapi/java-slack-sdk#modules>slackapi/java-slack-sdk#modules</a> をみると、次の2つも追加されている。どちらも kotlin 向けのフレームワークらしい。</p><ul><li>http4k</li><li>ktor</li></ul><p>それぞれのフレームワークの説明を読んだり、この機に kotlin をやってみることも検討してみた。長期間の保守を前提にすると、一時的に触るだけの言語を使うのもどうかな？と思うところはあってやはり java でやることにした。spring boot はお仕事でよく使っていてどういうものかを理解しているので選択するなら他の3つのどれか。</p><blockquote><p>Quarkus was created to enable Java developers to create applications for a modern, cloud-native world. Quarkus is a Kubernetes-native Java framework tailored for GraalVM and HotSpot, crafted from best-of-breed Java libraries and standards. The goal is to make Java the leading platform in Kubernetes and serverless environments while offering developers a framework to address a wider range of distributed application architectures.</p><p><a href=https://quarkus.io/about/>https://quarkus.io/about/</a></p></blockquote><p>いま kubernetes に好印象をもっていることもあり、この説明を読んで <a href=https://quarkus.io/>quarkus</a> を選択することに決めた。そんなことをつぶやいていたら、せらさんからいくつかアドバイスをいただけた。slack について何かをつぶやくと100%返信がくる (ソースは私の経験) 。感謝。</p><p><blockquote class=twitter-tweet><p lang=ja dir=ltr>そうですね。App クラス側は servlet やその他のライタイム含め、何にも依存していないので標準でアダプターがない場合にも自分で書けば任意の Web フレークワークで動かせます。 <a href="https://twitter.com/hashtag/SlackDevJP?src=hash&ref_src=twsrc%5Etfw">#SlackDevJP</a></p>&mdash; Kazuhiro Sera (瀬良) (@seratch_ja) <a href="https://twitter.com/seratch_ja/status/1573205191071240192?ref_src=twsrc%5Etfw">September 23, 2022</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><blockquote class=twitter-tweet><p lang=ja dir=ltr>Quarkus いいですよ！ただ、GraalVM については少なくとも短期的にはサポート予定ありません。 <a href=https://t.co/0cVGgohLez>https://t.co/0cVGgohLez</a> <a href="https://twitter.com/hashtag/SlackDevJP?src=hash&ref_src=twsrc%5Etfw">#SlackDevJP</a></p>&mdash; Kazuhiro Sera (瀬良) (@seratch_ja) <a href="https://twitter.com/seratch_ja/status/1573205502808686598?ref_src=twsrc%5Etfw">September 23, 2022</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script></p><p>java アプリケーションを実行可能なバイナリにコンパイルする機能を <a href=https://www.graalvm.org/>graalvm</a> が提供している。graalvm ではこのバイナリのことを <a href=https://www.graalvm.org/22.1/reference-manual/native-image/>native image</a> と呼んでいる。quarkus は java の web アプリケーションフレームワークであり、graalvm を使って native image を作ることも考慮して設計されている。コンテナでデプロイすることを想定したフレームワークと言える。残念ながら slack sdk が使っているライブラリである gson はリフレクションを多用していて、それが graalvm とは相性が悪いだろうという話しで現時点では native image 化は難しいみたい。たしか native image でリフレクションを使うには使っている箇所を設定にすべて列挙しないといけなかった気がする。リフレクションのような動的に用いるものと静的な設定は相性が悪く、がんばれば特定のバージョンで動くものは設定できるかもしれないけど、ライブラリのようなものでバージョンアップに追随するのはしんどいという話しなのかなと思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0501/>chatbot やめて slack apps</a></h1><div class=post-meta><time class=post-date>2022-05-01 (Sun.) ::</time></div><span class=post-tags>#<a href=/diary/tags/slack/>slack</a>&nbsp;</span><div class=post-content><h2 id=slack-と-backlog-の連携>slack と backlog の連携</h2><p>backlog の rest api を使って課題一覧に定型的なフィルター処理を実行してその結果を slack に通知したい。日々のスクラムイベントで画面をぽちぽちしながらチェックするのにそろそろ飽きてきた。運用が熟れて、みないといけない課題のフィルター条件が明確になったとも言える。こういうのを人間が手作業でフィルターするのをやめて誰でも操作できて、頻繁に目に付くようにすることでメンバーの運用に変化をもたらす。人間の行動や運用を変えるのは並大抵のことではないので、こういった小さな気づきを絶え間なく与え続けることが大事だと私は考えている。気付く人はすぐに気付く。もちろんそうじゃない人もいるが。</p><p><a href=https://backlog.com/integrations/slack/>backlog 公式 slack app</a> は backlog で発生したイベントに対するデータを通知することしかできない。たぶん機能拡張されることもなさそうなので足りない機能は自分で作るしかない。当初は知人が働いている会社の次の記事を読んで <a href=https://aws.amazon.com/jp/chatbot/>aws chatbot</a> を使おうと考えていた。</p><ul><li><a href=https://note.com/nissan_nkm_blog/n/na30a8150ac5d>プロジェクトにChatOpsを導入してみる</a></li></ul><p>いろいろ調べてみると、chatbot は基本的に aws とのサービス連携を前提としたものだとわかった。もちろん lambda と連携することで backlog の rest api を呼び出すことはできるだろうけど、backlog にアクセスしたいだけなら最初から slack apps を自前で作ってそこから backlog の rest api を使った方が構成がシンプルでカスタマイズもしやすいのではないかと思えてきた。slack apps をどこにどうやってデプロイするかは検討課題と言える。lambda にデプロイすることもできるし、専用に ec2 インスタンスを設けてもいいかもしれない。すぐには結論が出ないのでデプロイは作った後で考えることにする。</p><p>次にサードパーティの slack apps のセキュリティはどうやって担保するのだろう？と調べてみた。slack 社もレビューはするけど、セキュリティを保証するものではない。適当にググってみつかった記事を読んでみても、基本的に悪意のない slack apps かどうかを検証する方法はなさそう。slack のメッセージを不正な用途に使われる可能性があるというリスクを受け入れつつ、サードパーティの slack apps をインストールするときに権限が適切かどうかを確認するぐらいしかできない。</p><ul><li><a href=https://api.slack.com/security-review>Slack App Security Review</a></li><li><a href=https://www.polymerhq.io/blog/third-party-apps-on-slack-lurking-data-security-threat/>Third-Party Apps on Slack: Lurking Data Security Threat</a></li></ul><p>従って、サードパーティ製の backlog slack apps を作ろうと思ったらソースコードを公開して悪意がないことを訴求するぐらいしかできることはなさそうにみえる。ソースコードを公開しておけば、それぞれの組織内でデプロイする手段も取れる。当社のプロダクトとしてクラウド上にパブリックに公開するかどうかはある程度、作り込んでから後で考えることにする。github のカスタム action は java で作ったけど、今回は go で作ろうと思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2021/1109/>呑んだくれ</a></h1><div class=post-meta><time class=post-date>2021-11-09 (Tue.) ::</time></div><span class=post-tags>#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;</span><div class=post-content><p>1時半に寝て6時に起きた。夜にウォーキングに出かけようとしたらたまたま雨が降ってきて諦めた。そしたら寝付けなかった。やっぱり歩いて疲弊すると寝付けやすいのかもしれない。ストレッチしたりしてたら寝るの遅くなった。</p><h2 id=中間申告の納付>中間申告の納付</h2><p>法人税・地方法人税の申告用紙が届いていたので内容を確認しながら e-tax で申請して pay-easy で税金の支払いを完了した。国税は一番最後に書類が届く。今年の書類が届いた日はこんな感じ。毎年記録しているから届く時期に準備していて慌てなくて済む。</p><ul><li>法人市民税: 10月16日</li><li>法人県民税: 10月20日</li><li>法人税・地方法人税: 11月8日</li></ul><p>国税の納付をもって中間申告をすべて終えた。中間申告は税金の先払いだからキャッシュフローが悪いと払えないみたいなことが起きる可能性がある。そうすると仮決算して支払い金額を抑えるみたいなことが必要になるんだろうな。まさに貧乏暇無し。</p><h2 id=github--slack-integration>GitHub + Slack Integration</h2><p><a href=https://github.com/integrations/slack>integrations/slack</a> の内容をみて subscribe する内容を確認した。4月頃にアップグレードしてそれまでの設定の互換性をなくして、その影響でうまく動かなかったりしてた。</p><blockquote class=twitter-tweet><p lang=ja dir=ltr>github の slack 連携のときの commits:all が commits:* に変更されたみたい。4月中旬のバージョンアップ以降に作ったリポジトリか設定だと commits:all だと連携されないみたい。<a href=https://t.co/mGVUyEbgGQ>https://t.co/mGVUyEbgGQ</a></p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1387999605959188481?ref_src=twsrc%5Etfw">April 30, 2021</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>その後、追いかけてなかったけど、いま README をみたら次の5つのイベントはデフォルトで有効になるみたい。</p><ul><li>issues</li><li>pulls</li><li>commits</li><li>releases</li><li>deployments</li></ul><p>必要に応じて他のイベントも追加するとよいみたい。私は次の3つかな。</p><ul><li>reviews</li><li>comments</li><li>commits:*</li></ul><p>デフォルトのイベントは指定しなくてもよいけど、コピペですべて明示的に設定するならこんな感じ。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/github subscribe owner/repo issues,pulls,commits:*,releases,deployments,reviews,comments
</span></span></code></pre></div><h2 id=みんなの-python-勉強会>みんなの Python 勉強会</h2><p><a href=https://startpython.connpass.com/event/228136/>みんなのPython勉強会#75</a> で発表した。参加者は190人となっているけど、実際に zoom に参加していた人の最高値は110人ぐらいだったかな。190 * 0.6 = 114 なので無料イベントの参加者数は6割前後の法則に合致する。人数が増えるほどこの法則は精度が高いように思う。発表者は3人いて、私は2番目に発表して、持ち時間は30分だった。録画していたので後でアーカイブをみれるようにするみたい。私は録画否定派で録画すると参加者がオンタイムで見なくなるのと、いつでも見れるものは見ないということもあるので勉強会のレベルは録画しなくてもいいんじゃないかと考えている。もちろん大きなカンファレンスは録画があった方が参加できない人も後から興味のある発表を見返せていいとは思う。25分発表で質疑応答5分で発表の時間配分はうまくいった。あまり準備できなかった割には伝えたいことはだいたい話せたと思う。なんか質疑応答で「カザモリ社は python のお仕事を受けてくれますか？」といった質問があってちょっと驚いた。ここ数年 python をメインにしたお仕事してなくて、仕事は java, go が多いと言っているせいか、python の仕事はやってないようにみえてしまうのかもしれない。python, java, go の3つの言語のお仕事は受けますよと回答した。発表終わってから1時間ほど懇親会をした。ほとんどコミュニティの主催者と発表者で雑談してた。久しぶりに外部の勉強会でいろんな人とお話することができて楽しかった。たまには外に出かけていくことに重要性も認識できた。またネタがあったら発表したいなとは思う。</p><h2 id=呑み>呑み</h2><p>懇親会が終わったのが22時で、疲れと空腹から仲のよい焼き鳥屋さんのお店に寄って晩ご飯を食べることにした。時短が終わっているので22時からでも飲みに行ける。お店は翌2時まで営業している。22時過ぎに行ったらお客さんは誰もいなくて、野菜サラダと焼き鳥を注文してマスターと雑談してた。</p><p>時短が終わってから景気はどうかを聞いてみると、まだまだお客さんの戻りはコロナ前とくらべてまだまだだという。0時まわってから他の飲食店で働いている人たちが店内を埋まるぐらいは来てくれていたそうだけど、まだまだ余裕がないのか全然戻ってきてないと話されていた。0時半頃に2人組で「○○さんの紹介で来ました」みたいな既に酔っ払っているお客さんが来たりして、終電終わってからこういうお客さんが来たりしていたんだなと雰囲気は理解できた。マスターも2時に閉店して5時まで開いている他の飲食店に飲みに行くと話してた。そうやってお互いにお店に飲みに行って付き合いのようなものができているんだというのが理解できた。どこかのスナック行って3万円ほど使っても、必ずそのスナックの人がお店に来てくれて3万円以上使ってくれるという。お金をまわすってそういうことなんやなとマスターの話しを聞いていて理解できた。自分のお店を2時に閉店して、5時まで飲み歩いて、それから寝てまた次の日に仕事というのは体力的にすごくしんどそうで、マスター自身もコロナ明けは体調をみながら飲み歩いているとも話されてた。結局、2時前までマスターと雑談してて、私も22時から4時間弱ほど居座ってた。久しぶりに外で飲んでハイになっていたかもしれない。</p><p>マスターのお勧めで <a href=https://www.hamadasyuzou.co.jp/daiyame_brand>だいやめ</a> という芋焼酎をお湯割りで飲んだ。香熟芋という珍し？芋を使っていて、ライチのような香りのする芋焼酎でおいしかった。お土産によさそうなので覚えておこうと思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2021/1106/>普通の休日</a></h1><div class=post-meta><time class=post-date>2021-11-06 (Sat.) ::</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/saying/>saying</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;</span><div class=post-content><p>0時に寝て5時半に起きたが、休日だからゆっくりするかと思って二度寝して8時に起きた。知人のタイムラインで紹介されていていい言葉だなと思ったので書いておく。日記があるとこういう流れていくちょっとしたことを書く場所にもなるな。コミュニティ活動の本質はこれなんじゃないかという気もする。</p><blockquote><p>自分にまったく利益をもたらさない人間を、どう扱うかでその人がどんな人間かがはっきりわかる</p><p><a href=https://ja.wikipedia.org/wiki/%E3%82%B5%E3%83%9F%E3%83%A5%E3%82%A8%E3%83%AB%E3%83%BB%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%BD%E3%83%B3>サミュエル・ジョンソン</a></p></blockquote><h2 id=ストレッチ>ストレッチ</h2><p>今週もジョギングの代わりにウォーキングをしてた。ジョギングやると筋肉痛や疲労から他の日を休みがちになるけど、ウォーキングならジョギングよりは継続しやすい。今週は4-5日ほど歩いた。ただストレッチはさぼってて2日しかできなかった。ウォーキングのせいかわからないけど、右足太もも後ろの筋が張るようになった。ストレッチを始めてから日々の運動や生活の変化と関節や筋肉の張りが変化するのも意識するようにもなってきた。今日の開脚幅は開始前167.5cmで、ストレッチ後168cmだった。前週よりは数値がよくなっているのでこんなもんかもしれない。</p><h2 id=神戸のコワーキングスペースの半歩先の未来を考える>神戸のコワーキングスペースの半歩先の未来を考える</h2><p>たまたまタイムラインでみかけたので <a href=https://2021.078kobe.jp/events/16089/>神戸のコワーキングスペースの半歩先の未来を考える</a> を視聴していた。私はシェアオフィスとコワーキングスペースが併設された場所で働いているのでテーマには関心がある。途中からだけど、13時半から15時までみていた。</p><p>第一部はコワーキングスペースの運営者が登壇して、どちらかというそれぞれの運営者がやっていることの、宣伝的な要素が強かったように思う。ある運営者が起業家を育てるのは大学生からでは遅くて、保育園から起業家教育をしているという話題があった。そこで何を教えているかというと、子どもの頃から徹底的に自己肯定感を高めるための教育をしているらしい。たまたま <a href=https://studyhacker.net/self-esteem-high>自己肯定感が高い人の4大特徴が明らかに！</a> の記事をみたら、自己肯定感が高い人は他人も肯定するという内容がある。たしかに日本/日本人の同調圧力は異質なものを拒む傾向があると考えると、自己肯定感の高低がそういった文化の背景にも現れているのかもしれないと思えた。</p><p>第二部はコワーキングスペースの利用者として、二地域居住シェアハウスプロジェクトの研究/実践をしている佐藤さんと、メディアアートをされている <a href=https://www.nobumichiasai.com/>浅井宣通</a> さんが登壇していた。佐藤さんが冒頭でコワーキングスペースにはびっくりするほどすごい人がいるみたいな話しをした後で、浅井さんが登場するといった流れが偶然できてて、ほんとだ、これはすごいとなったw 浅井さんはメディアアートを言葉で説明しても伝わりにくいので動画でみてもらうようにしていると話されていた。私もみてこれはすごい人だとすぐに理解できた。私が興味をもつ作品だと <a href=http://www.sign.site/koukaku_vr/>攻殻機動隊 新劇場版Virtual Reality Diver</a> の Creative Director も務められたらしい。企業やイベントの PR のための映像で浅井さんが手伝っている作品はいくつもあるそうだ。</p><p>浅井さんは東京を脱出したいという想いがずっとあって、コロナでリモートワークが普通になり、奥さんの実家の須磨に引っ越してきたらしい。ただ自身は神戸にはほとんど知り合いがいない状態でコワーキングスペースを利用しているうちに、人を紹介してもらって人脈を形成することができたという。東京は大半が地方から出てきた人たちの集まりなので必然として孤立しており、競争関係になってしまうという。神戸の人たちは地元で育ってそのつながりが強いという違いを感じているらしい。地元の人なので協力の関係を築きやすい。コワーキングスペースがその触媒になっていると話されていた。人がつながるには、場所や触媒が必要でコミュニティマネージャーもそういった役割を担っていて大事だという。</p><p>多様性は大事だが、多様性だけでも人のつながりができない。同じ分野だとライバル関係になってしまったりする。そこで対話の深さが重要だと話されていた。同じ分野であってもお互いが対話を通して理解を深めると、共通項があったり、細かい得意分野が違ったりもする。デザイナー同士がかぶってしまうと、よく競争の関係になってしまうし、全然違う人と話しても話が噛みあわなくて仕事で苦労することもあったという話があった。それで対話の深さが大事ということに気付いたといった話だった。もう1点、おもしろかった話が地元の人は土地への感情として、この場所・土地が好きだという共通項があるので協力の関係を築きやすいのではないかと。東京は多くの人が生まれ育った土地ではないのでそういった感情は抱きにくいが、神戸っ子という言葉があるように神戸の人たちにはそういった土地に根ざした愛着があり、それを媒介につながるのも美しいといったことを話されていた。</p><p>第三部はコワーキングスペースを支える人たちとして、<a href=http://cahootz.jp/>カフーツ</a> の伊藤さん、<a href=https://jocr.jp/sunday/repo/1656/>ANCHOR KOBE の立ち上げ</a> に関わった神戸市のイノベーション専門官の松山さん、<a href=https://fixu.jp/>fixU</a> というサービスを提供している山岡さんが登壇していた。</p><p>私がもっとも興味深かったのは伊藤さんの話しだったのでそれをまとめておく。コワーキングスペースはただ作業する場所ではなく、課題を解決したい人がいて、それを手伝いたいという人がつながることで価値が生まれるという。長い間、コワーキングスペースに関わってきたことから経験が積み重なってわかってきたことがあると話されていた。「コミュニティはどうやって作るんですか？」という質問に答えるのは難しいものの、その取っ掛かりとして、まず課題をみえる化するのが大事だという話しをされていた。イベントなどで課題を表明して、多くの人たちに知ってもらうことで、その課題の解決に興味をもつ人たちが集まってきて、それが協調となり、コミュニティへとつながっていくという。Facebook 社が Meta 社に社名変更して、Microsoft もそれに追従し、メタバースの話題が盛り上がっている。ビッグワードに流されるつもりはないが、コロナによりオンラインでできることの幅が広いことを、仕事はオンラインでよいと多くの人たちは気付いた。じゃあ人と人との関わりがどんな価値をもつのか、コロナが落ち着いてくる時期 (この先1-2年) でそういう方法論も新たに出てくるんじゃないかとも話されていた。</p><h2 id=slack-apps-の調査>Slack apps の調査</h2><p>次回の bizpy 勉強会向けに <a href=https://api.slack.com/lang/ja-jp/app-home-with-modal>新機能、アプリのホーム・ヴューを活用しよう🏡</a> を読んで実際に <a href=https://github.com/slackapi/bolt-python>bolt-python</a> やってみた。UI の設定は JSON で記述できるようになっていて、<a href=https://app.slack.com/block-kit-builder/>Block Kit Builder</a> でぽちぽちやるとどんな JSON を書けばよいかのサンプルのペイロードを確認できる。これらの UI に対して操作すると、プログラミングの用語で言えば、すべてイベントが発生してリクエストが届くような仕組みになっている。bolt のコード上ではそれぞれ <code>event</code> と <code>action</code> と <code>view</code> という名前が付いたイベントを扱うことで任意のモーダル画面を表示したり、そのフォームのユーザー入力を取得したりできる。一通りサンプルコードはできた。あとは簡単に資料をまとめるだけ。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2021/1027/>bizpy 再開</a></h1><div class=post-meta><time class=post-date>2021-10-27 (Wed.) ::</time></div><span class=post-tags>#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/recipe/>recipe</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;</span><div class=post-content><p>2時に寝て6時に起きた。前日の夜にウォーキングしたせいか、よく眠れた。朝活を終えてから朝ご飯を作って食べてそのままオフィスに出社した。6時起きを日課にした方が生活のリズムがよい。夕方に眠くなって1時間ほど昼寝した。</p><h2 id=朝活-ミクロ経済学入門の入門>朝活: ミクロ経済学入門の入門</h2><p><a href=https://kobe-sannomiya-dev.connpass.com/event/228969/>【三宮.dev オンライン】リモート朝活もくもく会</a> で第4章の供給曲線を読んだ。需要曲線の逆からの視点なので考え方は同じで図の形が異なる。用語がいくつか出てきたのでまとめる。</p><ul><li>収穫逓減 (しゅうかくていげん): 製品をより多く生産するのにかかる経費が増大していくこと<ul><li>生産活動において2倍の生産量を生み出すには2倍以上の経費がかかる</li></ul></li><li>費用関数: 生産量と費用との関係をあらわす</li><li>限界費用: 追加的に1単位生産する費用<ul><li>3個を生産する費用は、1個目の限界費用 + 2個目の限界費用 + 3個目の限界費用<ul><li>個数が増えるごとに費用は高くなっていく</li></ul></li><li>費用を図示するときは限界費用に分解した方が視覚的にわかりやすい</li></ul></li><li>限界費用逓増: 生産するごとに限界費用が高まっていくこと</li></ul><p>「<a href=https://dictionary.goo.ne.jp/word/kanji/%E9%80%93/>逓</a>」という漢字は「つぎつぎ」や「だんだん」という意味をもつ。</p><ul><li>プライステイカー: 自分の生産量が価格に影響を与えられない<ul><li>減産により希少価値を高め価格を吊り上げる市場操作ができない</li></ul></li><li>独占企業: プライステイカーの反対。</li><li>利潤: 売上 - 経費</li><li>最適解: 利潤を最大化する生産量<ul><li>あと1個追加して生産すると利益がマイナスになるところ</li></ul></li><li>生産者余剰: すべての企業の利潤の和</li><li>供給曲線: すべての企業の限界費用をヨコに足し合わせた曲線</li></ul><figure><img src=/diary/img/2021/1027_supply-curve.png></figure><h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2><p>昨日の続き。8.4 を読んで8章分散システムの問題を読み終えた。全体としても学びになったけれど、とくに 8.3 信頼性の低いクロックの節が全く開発・運用で意識したことがなかったので私にとっては学びになった。</p><blockquote><p>分散システムにおいて発生する厄介な問題がある。</p><ul><li><p>ネットワーク経由でパケットを送信しようとした場合、そのパケットはロストしたり、どれほど遅延するか分からない。同様に、レスポンスもロストしたり遅延したりするので、レスポンスを受け取れなかった場合には元々のメッセージが到達したかどうかも分からない</p></li><li><p>ノードのクロックは他のノードと大きくずれているかもしれない（できる限りの努力をして NTP をセットアップしたとしても）。クロックは急に進んだり戻ったりするかもしれず、たいていはクロックの誤差をうまく計る方法がないので、クロックに依存するのは危険</p></li><li><p>プロセスは処理中にいつどれほどの長さ一時停止するかもしれず（おそらくはstop-the-worldガベージコレクタのため）、他のノードから落ちていると見なされた後に自身に一時停止があったことを理解しないままに復活するかもしれない。</p></li></ul><p>こういった <strong>部分障害</strong> が生じうるのが分散システムの特徴と言える。ソフトウェアが他のノードが関わる何かをしようとした場合、それは時おり失敗したり、ランダムに速度が落ちたり、まったくレスポンスが返されない（そして最終的にはタイムアウトする）といった可能性がある。分散システムでは、部分障害への耐性をソフトウェアに組み込み、システムの構成要素が一部破損していてもシステム全体としては機能し続けられるようにする。</p><p>フォールトに耐えるための最初のステップはフォールトを <strong>検出</strong> することだが、それさえも難しい。多くのシステムは、ノードに障害が生じていることを検出する正確な仕組みを持たないので、ほとんどの分散アルゴリズムはリモートノードが生きているかどうかを判断するのにタイムアウトに頼る。しかし、タイムアウトはネットワークの障害とノードの障害を区別できず、ネットワークの遅延変動のために間違ってノードがクラッシュしていると誤検知することもある。弱っているものの落ちてはいないノードは、きれいに落ちているノードよりもさらに扱いが難しくなる可能性がある。</p><p>フォールトが検出されたとして、システムがそれに耐えられるようにすることも簡単ではない。マシン間にはグローバルな変数も、共有メモリも、共通の情報やその他何らかの共有された状態もない。ノードは現在の時刻についてさえ合意できず、ましてやもっと重大なことに合意することなどできない。あるノードから他のノードへ情報を流せる唯一の方法は、その情報を信頼できないネットワークを通じて送ることだけである。重要な判断は単一のノードだけで安全に下すことができないので、他のノードの助けを得てクオラムが合意に至るようにするためのプロトコルが必要となる。</p><p>同じ操作をすれば決まって同じ結果を返してくれるような、単一コンピュータにおける理想化された数学的な完全さの中でソフトウェアを書くのに慣れていると、分散システムの雑然とした物理的な現実への移行はちょっとしたショックを伴う。一方、分散システムのエンジニアは、しばしば単一のコンピュータ上で解決できる問題を簡単なものだと見なすが、実際のところ今日では単一のコンピュータがこなせる仕事量はかなりのものになっている。単一のマシンでシンプルにことを済ませられるなら、概してそうする価値はある。</p><p>分散システムを利用する理由はスケーラビリティだけではない。耐障害性や低レイテンシ（地理的にユーザーの近くにデータを置けることによる）も同様に重要な目標であり、こういったことは単一ノードでは実現できない。本章ではネットワーク、クロック、プロセスの信頼性の低さが避けがたい自然の法則なのかも調べた。安全ではなく、クリティカルではないシステムの多くでは、高価な高信頼性よりも安価な低信頼性が選択される。また、信頼性の高いコンポーネントを前提としているスーパーコンピュータも取り上げました。スーパーコンピュータはその前提が故に、コンポーネントに障害が生じてしまった場合には完全に停止させて再起動することになる。これに対し、分散システムはサービスレベルでは中断することなくいつまでも動作し続けられる。これは、少なくとも理論上はすべてのフォールトやメンテナンスはノードレベルで処理できるためである。</p></blockquote><h2 id=お昼ご飯>お昼ご飯</h2><p>気分でスーパー寄って買いものして家に帰り、お昼ご飯を作って食べた。前に適当に作った <a href=/diary/posts/2021/1025/#お昼寝>かぼちゃの煮物</a> がおいしかったので再挑戦してみた。今度は圧力鍋を使っていろいろ具材を入れてみた。過去に作っておいしかった料理のレシピを evernote に書いたりしていたけど、もういまは書いてないので気が向いたら日記に書くようにする。</p><p>材料</p><ul><li>A<ul><li>水 900cc</li><li>めんつゆ 100c</li><li>醤油 適量</li></ul></li><li>B<ul><li>かぼちゃ 1/4切れ</li><li>なす 3個</li><li>にんじん 2本</li><li>玉ねぎ 1個</li><li>しめじ 1パック</li></ul></li><li>C<ul><li>卵 2個</li><li>豆苗</li><li>せみ餃子</li></ul></li></ul><p>作り方</p><ol><li>圧力鍋に A を入れて火にかける</li><li>B の野菜を切りながら圧力鍋に入れていく</li><li>圧力鍋に B をすべて入れたら圧をかける (高圧30秒)</li><li>圧が下がったら蓋をあけて C を入れる</li><li>C に火が通るまで2分ほど煮込む</li></ol><p>所感</p><p>圧力が強過ぎたのか、かぼちゃが煮汁に溶け出してしまって原形がなくなってしまった。スープとして飲んでもおいしいけれども、水を入れ過ぎたのかもしれない。肉の代わりに餃子を使ってみた。水餃子っぽくなるので焼き餃子で油使うよりヘルシーな気持ちになっておいしい。</p><figure><img src=/diary/img/2021/1027_pumpkin.jpg></figure><h2 id=bizpy-勉強会>bizpy 勉強会</h2><p><a href=https://bizpy.connpass.com/event/198717/>Python で Slack のインテグレーションをやってみる勉強会 #1</a> を開催した。半年以上開催してなかったので億劫になってしまっていたけど、再開できてよかった。10名ほどが参加してくれた。用意したコンテンツを話し終えたら8時半ぐらいで時間もちょうどよかった。初参加者も数人いた。slack インテグレーションの調査も兼ねてあと2-3回は集中的にやっていきたい。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2021/1025/>新しい生活リズムへの移行</a></h1><div class=post-meta><time class=post-date>2021-10-25 (Mon.) ::</time></div><span class=post-tags>#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;</span>
<img src=/diary/img/2021/1025_pumpkin.jpg class=post-cover alt=新しい生活リズムへの移行 title="Cover Image"><div class=post-content><p>3時に寝て6時に起きた。今日はちゃんと起き上がって朝からお茶を煮出して粗熱とって冷やしたりしてた。その後、準備してオフィスに着いたのが7時20分。いつもより1時間早く起きているのでオフィスに着くのも1時間早くなる。<a href=/diary/posts/2021/1022/>先週</a> の水曜日と金曜日だけ朝活やってみて逆に生活のリズムが乱れてよくない感じがした。今週は毎日6時に起きて朝活に参加してみるのを試す。</p><h2 id=ミクロ経済学入門の入門>ミクロ経済学入門の入門</h2><p>早起きしたので打ち合わせ前の隙間時間に第3章の需要曲線を読んだ。まずは用語の整理から。</p><ul><li>上級財: 所得が増えたときに消費が増える財</li><li>下級財: 所得が増えたときに消費が減る財</li></ul><blockquote><p>一般的な傾向として、ものは消費するほど有り難みが減る。たとえば僕はコーヒー1杯目に最大4ドルまでなら払ってよいけれど、2杯目には最大2ドルまでしか払いたくない、そして3杯目には最大1ドルまでしか払いたくない、というように。</p></blockquote><p>食べものとか実際にボリュームディスカウントされることが多いので食べものだとイメージしやすい。スーパーで半額になった豚カツを2枚買うときの私の気持ちはこんな感じ。定価なら1枚しか買わないのに半額なら2枚買ってもいいかと思ったりする。たまに2枚を一度に食べて気分悪くなって後悔する。たいていは晩ご飯に1枚、翌日のお昼ゴハンに1枚を分けて食べる。</p><ul><li>余剰: 価格と消費者がお金を払ってもよい金額との差額<ul><li>コーヒー1杯に400円払ってよいと考えていて、100円のコーヒーを買うなら300円が余剰といえる<ul><li>さらにコーヒー2杯目を50円で買ってよいと考えるなら350円が余剰と言える</li></ul></li></ul></li></ul><p>すべての消費者の余剰を計算したものを消費者余剰という。需要曲線からある価格 p を取るときの次のグラフにおける面積を消費者余剰と呼ぶ。グラフにすると直観的にわかりやすい。</p><figure><img src=/diary/img/2021/1025_consumer-surplus.png></figure><p>消費者余剰に対して、売る側の利潤の合計を生産者余剰と呼ぶ。消費者余剰と生産者余剰との和を社会的余剰と呼ぶ。社会的余剰を「市場のよさ」のモノサシとして使うと談合は禁止すべしということになる。</p><ul><li>ベルトラン価格競争<ul><li>同品質で同費用の業者が価格競争をした場合、顧客は価格が安い方から商品を購入する。こうした市場をベルトラン寡占市場と呼ぶ</li><li>このとき業者間の価格競争は最終的に「底辺への競争」が起こり、経費と同じ価格に近づく<ul><li>この状態をベルトラン均衡と呼ぶ</li></ul></li><li>業者間で談合して価格を据え置けばよいが、業者の数が多くなるとこれは難しい<ul><li>裏切りが発生したり、信頼関係を維持するのが難しかったりして、長期的な利益や全体の利益を追求するのが難しい<ul><li>ゲーム理論の話しのように読めた</li></ul></li></ul></li></ul></li><li>価格弾力性<ul><li>価格の変化によって需要がどのぐらい弾んで動くかをあらわす</li><li>弾力性が低いというと、価格が動いても需要はあまり変わらない状態をいう</li><li>弾力性が高い財は値上げすると需要が大幅に下がる<ul><li>必需品は値上げしても需要が下がりにくい<ul><li>課税で考えると、必需品への課税は貧しい人の生活に与えるダメージが大きい</li></ul></li></ul></li></ul></li><li>ギッフェン財<ul><li>需要曲線は右下がりのカーブになるのが通常だが、経験的事実に即している<ul><li>そうした財を正常財と呼ぶ</li></ul></li><li>ごく稀に価格が上がるにつれ売れ行きが増すものがある、それをギッフェン財と呼ぶ</li></ul></li><li>代替効果: ある商品が値上げしたときに別の商品に置き換えたくなる</li><li>所得効果: 生活にゆとりがなくなると、高いものは買えなくなり、安いものを買おうとする</li></ul><p>内容はそう難しくないが、急にたくさんの用語が出てきて読み解くのに時間がかかった。</p><h2 id=設計ドキュメントレビュー>設計ドキュメントレビュー</h2><p>先週から作っていた設計ドキュメントを顧問さんと一緒にレビューした。スライド40枚を2時間がっつり話してめっちゃ疲れた。話し終えて20-30分抜け殻になって軽く散歩してきた。ここ3ヶ月、調べものをしてきた内容の集大成でもあり、頭の中にしかなかった課題管理の実践知を明文化するといった取り組みの (途中) 結果でもある。品質の良し悪しで言えば、たった3ヶ月で出来たものなので大したことはない。あくまで途上における段階でしかないのだけど、私の中でも納得感は出てきたし、レビューしてもらって厳しい指摘もなかったので方向性は出てきた感じがある。このまま時間のあるときに進めていく。</p><h2 id=slack-apps-の調査>Slack apps の調査</h2><p>この水曜日にある勉強会の <a href=https://github.com/t2y/python-study/tree/master/BizPy/slack/20211027>資料作成</a> が完了した。Slack apps の調査を勢いよくやりたいので2週間ごとに開催することにする。ドキュメントを眺めていて次回は <a href=https://api.slack.com/lang/ja-jp/app-home-with-modal>新機能、アプリのホーム・ヴューを活用しよう:house_with_garden:</a> のチュートリアルをやってみることに決めた。</p><h2 id=お昼寝>お昼寝</h2><p>睡眠時間が短かったせいか、朝早かったせいか、夕方に集中力がなくなったので17時に切り上げて帰って寝てた。今日は雨だったので徒歩通勤だったのもありウォーキングにもなった。途中でスーパーに寄って買いものして帰った。運動目的だと1時間ぐらい歩いても平気なのに通勤だと15分歩くだけで疲れる。同じ行動をしていても目的意識で変わってくる。18時ぐらいには家に着いてそのまま4時間ほど寝てた。その後、また起きて夜の作業に入った。起きてからお腹すいて即席でめんつゆと醤油とかぼちゃとささみと卵で煮物を作ってみたら意外とおいしかった。お腹すいているとちょっとしたものでもおいしい。気に入ったのでカバー画像にしてみた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2021/1024/>bolt アプリ開発</a></h1><div class=post-meta><time class=post-date>2021-10-24 (Sun.) ::</time></div><span class=post-tags>#<a href=/diary/tags/slack/>slack</a>&nbsp;</span>
<img src=/diary/img/2021/1024_bolt-app.png class=post-cover alt="bolt アプリ開発" title="Cover Image"><div class=post-content><p>2時に寝て9時に起きた。寝る前に1時間ほどウォーキングしてきたせいか、よく眠れた。田んぼをしたり運動をしたり体を動かして疲れた方がよく眠れるような気がしてきた。しばらく続けてみようと思う。お昼は調べものをしていて夕方に眠くなって2時間ほど寝てまた夜も調べものをしていた。</p><h2 id=slack-apps-の調査>Slack apps の調査</h2><p>この水曜日に勉強会があるので調査と <a href=https://github.com/t2y/python-study/blob/master/BizPy/slack/20211027/README.md#slack-apps>資料作成</a> をしていた。いつの間にか slack app 作成のためのドキュメントもいくつか <a href=https://api.slack.com/lang/ja-jp>日本語化</a> されていることに気付いた。<a href=https://api.slack.com/lang/ja-jp/hello-world-bolt>Bolt フレームワークを使って Slack Bot を作ろう</a> のドキュメントをみながら <a href=https://github.com/slackapi/bolt-python>bolt-python</a> を使って簡単な bot アプリを作成した。アプリの設定・開発の流れはだいたいこんな感じ。</p><ol><li>slack app 作成</li><li>bot ユーザー作成</li><li>oauth スコープの設定</li><li>bolt アプリケーションの実装</li><li>イベントサブスクリプションの設定</li></ol><p>bolt とは別に <a href=https://github.com/slackapi/python-slack-sdk>python-slack-sdk</a> というライブラリが提供されていて、このライブラリを使って bolt というフレームワークが実装されている。bolt でやりにくいことがあったら直接 sdk を触ることもあるのかもしれない。</p><p>現時点で勉強会の参加者は17人もいる。半年以上さぼっていたけど、けっこうな人数が参加してくれている。slack app の調査も兼ねて3-4回ぐらいは勉強会を開く予定。初回はアプリを作成するときの雰囲気を学んでもらえればと思う。</p></div></article><div class=pagination><div class=pagination__buttons><a href=/diary/tags/slack/page/2/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>