<!doctype html><html lang=en><head><title>Life :: </title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/tags/life/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="Life"><meta property="og:description" content><meta property="og:url" content="/diary/tags/life/"><meta property="og:site_name" content><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/tags/life/index.xml rel=alternate type=application/rss+xml title></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><h1>Posts for: #Life</h1><div class=posts><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0513/>書きものしていただけの土曜日</a></h1><div class=post-meta><time class=post-date>2023-05-13</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;</span><div class=post-content><p>0時に寝て何度か起きて6時に起きた。朝からなんとなくだらだらしていた。午後から日記を書きながら外をみると雨降りでのんびり過ごした一日だった。</p><h2 id=ストレッチ>ストレッチ</h2><p>今週も資料作りをしていただけでプレッシャーやストレスなどは皆無なので体調よいのだろうと思っていたけど、思いの外、腰の張りはあったので想定したよりは疲れていたかもしれない。もしかしたら、その前の週が連休だっただけに連休明けの週だから身体的に余計に疲れたのかもしれない。今日の開脚幅は開始前155cmで、ストレッチ後159cmだった。いつも通りの数値。初めて縦方向に開脚するストレッチをしてみたら、股関節の可動域のよくないところがきつかった。家でも意識して伸ばしてみようと思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0510/>未登記の建物の扱い</a></h1><div class=post-meta><time class=post-date>2023-05-10</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/registration/>registration</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;</span><div class=post-content><p>1時に寝て7時に起きた。来週は出張なのでその準備もいるし、連休明けから急に忙しくなってきた。今日も一日中資料を作成していた。来週に東京出張して集中的に打ち合わせする。その叩き台の資料を作っていた。</p><h2 id=建物の登記>建物の登記</h2><p>登記の専門家として <a href=https://www.chosashi.or.jp/investigator/about/>土地家屋調査士</a> という士業があるらしい。相続に関して土地家屋調査士さんと話したので少し書いておく。相続のやり取りで実家の建物を母が相続する段取りで進めていたが、どうやらうちの建物はすべて未登記らしい。土地家屋調査士さんが言うには、未登記の建物は相続できないという。いまは建物を建てると原則として法務局に不動産として登記することが義務付けられている。昔もそうだったかもしれないけど、昔はいまよりも適当だったので未登記の建物がたくさんあるという。</p><p>最近は法律が改正され、未登記だと10万円以下の過料を支払うという罰則が設けられた。しかし、歴史的経緯によって現実として世の中に未登記の建物がたくさんあるとわかっていて、本当にすべての建物に10万円以下の過料を行政が取り立てるのか？というと、土地家屋調査士さんもそれは懐疑的だという。おそらく過渡期においてはなんらかの救済措置が取られるのではないかといった話しもされていた。</p><p>建物が未登記であっても固定資産税の支払いはできるために、実質的に登記というのは誰がその建物を所有しているかを第3者向けに証明するのみに過ぎない。例えば融資を受ける場合には必須となる。他人が住んでいる建物を自分のものだと主張して裁判になるといったことは、普通に生活していて起きることではない。未登記でも実質的に困ることはない。何十年も昔から未登記でそんなことは1度も起こっていない。固定資産税は地方自治体が管理している固定資産税評価額に基づいて支払うため、その金額に基づいて相続税も申告して支払える。土地家屋調査士さんによれば、未登記の建物は相続できないのに。これは行政の管轄の違いによって起きていると推測される。</p><p>そして、いま未登記だということは、祖父から父への相続がなされていないという解釈になるという。そのため、登記にあたって父ではなく、祖父の相続人に対しての確認をした上でいくつかの手順を踏んで登記の手続きを進めないといけないという。</p><ul><li><a href=https://www.yasiro.co.jp/eitaikuyo/media/archives/6972>未登記建物がもたらすリスクとは？登記方法と相続する場合の手続きも解説</a></li></ul><blockquote><p>表題登記を行うためには、司法書士への依頼費用が2〜3万円ほど、土地家屋調査士へ依頼する費用が8〜12万円ほど必要です。</p></blockquote><p>調べていると、なぜ未登記の建物が多いかというと士業への費用を節約するためだという。士業の方々に登記を依頼するとそれなりの費用がかかる。この費用を支払っても得られるメリットがないときにこれまで未登記が選択されてきたという。土地家屋調査士さんに「このまま未登記で困ることありますか？」と聞いたら、親族でお金に困った人が出てきたときにその建物の所有権を主張して云々みたいな話しを始めたので、途中で嫌になって「そのリスクは受け入れます。」と遮ってしまった。ほとんど資産価値のない、田舎にある老朽化した建物を、お金に困った人が所有権を主張するとは現実的に考えにくい。</p><p>うちにとっては未登記の建物のデメリットは事実上ないようにみえる。土地家屋調査士さんの作業だけで登記できるならやってもらって構わないが、祖父からの相続を考慮して親戚をまわって念書と印鑑証明を集めて登記するといったことは、デメリットに対して労力が大き過ぎると私は判断した。相続税は支払うが、建物は未登記／未相続で進めてもらってよいという主旨の回答をした。士業の方々がその要件に納得するかどうかはまだわからない。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0508/>法人決算を完了</a></h1><div class=post-meta><time class=post-date>2023-05-08</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/web-design/>web design</a>&nbsp;</span><div class=post-content><p>1時に寝て7時に起きた。<a href=https://emg.yahoo.co.jp/>ヤフー防災速報</a> を設定したら昨日の大雨で次から次へと通知が届いた。状況を注視しておいた方がよいのかもしれないけど、どんどん通知が届くことに驚いた。アプリ自体はよく出来ていると思うのだけど、大雨が強くなっていく過程で様々な通知が届くようになって、通知が届いたところで私はなにかするわけでもないため、徐々に通知を無視するようになってしまって、本当に重要な通知を見逃したりしないかと心配になった。そういう意味で通知設定のカスタマイズが大事なのかもしれない。</p><h2 id=法人決算>法人決算</h2><p>連休中に申告書の作成は完了していた。8時30分からの e-tax の稼働を待ってマイナンバーカードで署名して電子申告した。すぐに納付情報が返ってくるので pay-easy で法人税と地方法人税の納付をした。その後、紙の決算書を税務署へ提出しにいく。経験則から朝早い時間帯に税務署へ行くと2-3人ぐらいしか訪問者がいないため、ほぼ待ち時間なく窓口の受け付けができる。e-tax のドキュメントには電子申告の受付番号を書けとあるけど、窓口ではいつ電子申告したか日付だけでよいと指示された。おそらくシステムの検索条件に使うだけなのだろう。</p><p>本日の9時15分をもって第4期の法人決算を完了した。まだ5月上旬の段階で決算を終えられたので気分がよい。昨年は月末にぎりぎり提出でバタバタしていた。お仕事の区切りが4月末だったというタイミングの良さがこの余裕につながっていると思う。昨年は初めての電子申告だったせいか、1ヶ月後ぐらいに書類の書き方が間違っていると指摘があり、訂正して修正申告することになった。今年はどうだろうか。</p><h2 id=ワイヤーフレームのレビュー>ワイヤーフレームのレビュー</h2><p>先日からコーポレートサイトのデザインをリニューアルしようとデザイナーさんとやり取りしている。最初のワイヤーフレームが出来たので21時から顧問のはらさんとワイヤーフレームのレビューをしていた。他に契約書の叩き台のレビューも兼ねていたので時間がかかって1時間半ほど雑談していた。デザイン変更にあたって、どうしたいという運営者の要件があって、それに対してデザインや訪問者の ui/ux があるので一概にこうだとも言えない。いくつか私が気付いていなかったアイディアも出て、うちみたいな動きのない、しょぼいサイトデザインでも確認事項はいくつも出てくることに気付いた。デザインに対してあれこれ意見が出ること自体はよいことだという。発散した意見をデザイナーさんがどう現実に落とし込んでいくのかが腕の見せ所なんだろう。私はデザインの素人なので要件以外にあまり口出しするつもりはない。一方でどういった内容が要件なのか詳細なのかの境界もよくわかっていないので今回はデザイナーさんと一緒にやり取りしながら学ぶ機会とする。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0506/>法人決算の続きの続き</a></h1><div class=post-meta><time class=post-date>2023-05-06</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;</span><div class=post-content><p>0時に寝て7時に起きた。<a href=https://www.youtube.com/channel/UCQXwvYkiHyEfzV66-fols3w>竹原テレビ</a> をみながら寝てた。youtube ばかりみていてバカになるんじゃないかと思い始めてきた。</p><h2 id=ストレッチ>ストレッチ</h2><p>今週はお休みなものの、私は基本的にオフィスでデスクワークをしていた。言うても所々遊びに出掛けたりもしているので普段よりは座っている時間は短かったはず。腰の負担は低かった。今日の開脚幅は開始前155cmで、ストレッチ後160cmだった。数値もよい。右股関節の可動域が狭い以外は全体として問題なかった。私の普段の生活を振り返ってわかったことの1つは働かなければ体調がよい。働きたくない。</p><h2 id=法人決算>法人決算</h2><p>午後から法人決算の続き。<a href=https://www.eltax.lta.go.jp/>eltax</a> が稼働していたので次の地方税の申告と納付を行った。</p><ul><li>法人住民税<ul><li>法人県民税</li><li>法人市民税</li></ul></li><li>法人事業税<ul><li>法人事業税</li><li>特別法人事業税</li></ul></li></ul><p>手で計算した税金の金額と eltax の帳票に入力してバリデーションチェックされた金額が一致していることを確認できた。帳票を作成したらマイナンバーカードの公的個人認証サービスを使って電子署名して申告する。申告した後に納付情報の取得リクエストを送って返ってきた納付情報をみて <a href=http://www.pay-easy.jp/>pay-easy</a> で納付する。納付を終えたらその明細を会計システムと連動して3月31日の未払法人税の明細に対して消し込みを行う。1時間ほどで地方税の申告と納付と会計システムへの記帳を完了した。</p><p>地方税を確定した上で別表四と別表五を確定させて決算書の作成を完了した。これで法人税の算出は完了。あとは手間がかかるだけのコツコツ記入していけばいいだけの書類のみになる。</p><ul><li>法人事業概況説明書</li><li>勘定科目の内訳書<ul><li>預貯金等</li><li>売掛金(未収入金)</li><li>仮払金(前渡金)</li><li>買掛金(未払金・未払費用)</li><li>仮受金(前受金・預り金)</li><li>役員報酬⼿当等及び⼈件費</li><li>地代家賃等の内訳書・⼯業所有権等の使⽤料</li><li>雑益・雑損失等</li></ul></li></ul><p>今日は e-tax が休止なので提出できないものの、すべての帳票を作成完了にした。決算書 (財務諸表) は xml/xbrl, csv での添付が可能なものの pdf 添付が許可されていないため、決算書だけ税務署へ行って紙で提出する必要がある。</p><blockquote><p>電子データ（XML形式又はXBRL形式）による提出が可能な添付書類（例：法人税申告の財務諸表及び勘定科目内訳明細書、所得税申告の青色申告決算書及び譲渡所得の内訳書など）</p><p><a href=https://www.e-tax.nta.go.jp/toiawase/qa/imagedata/03.htm>イメージデータによる提出の対象となる添付書類には、どのようなものがありますか。</a></p></blockquote><p>freee 申告の有償サービスを使えば会計システムと連動して電子申告できる。そのためだけに24,800円 (売上換算だと約25万円) を払う価値があるかどうか、まだ迷っている。というのは、法人決算は年に1回だけで丸1日もあれば完了する作業だし、業務のワークフローを思い出すために自分でやるのもいいなと考えている。決算書を印刷して税務署と往復するのは30分ぐらいの工数だが、そんなところに注意を払わずにお金を払ったらいいやんという意見はあるかもしれない。私もそうかなと思う気持ちもある。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0502/>飛び石のお仕事</a></h1><div class=post-meta><time class=post-date>2023-05-02</time></div><span class=post-tags>#<a href=/diary/tags/docker/>docker</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/career/>career</a>&nbsp;</span><div class=post-content><p>0時に寝て何度か起きて7時に起きた。休んでもよかったんだけど、休む理由がないので飛び石でお仕事することにした。</p><h2 id=docker-エコシステムの調査>docker エコシステムの調査</h2><p>少し前に <a href=/diary/posts/2023/0327/>docker をライブラリとして使って運用ツールを作った</a> 。その内容をテックブログに書こうと思って docker のソフトウェアスタックやアーキテクチャの背景を調べ直していた。もっとたくさんいろんな記事を読んだのだけど、次の記事とそこから辿れるものを読むとよいだろうと思う。</p><ul><li><a href=https://blog.inductor.me/entry/2019/11/22/072353>Docker社がエンタープライズ事業を譲渡した今、Dockerの父が思うこと</a></li><li><a href=https://www.tutorialworks.com/difference-docker-containerd-runc-crio-oci/>The differences between Docker, containerd, CRI-O and runc</a><ul><li><a href=https://thenewstack.io/oci-building-way-kubernetes-run-containers-without-docker/>Red Hat, Google Engineers Work on a Way for Kubernetes to Run Containers Without Docker</a></li></ul></li></ul><p>コンテナに関して cri と oci という2つの標準化があることを学び、その実装として docker 社が使っているツールに関係があるのが次の3つになる。おもしろいことにすべて docker 社のリポジトリにはなく、oss として然るべき所管の organization にリポジトリがある。</p><ul><li><a href=https://github.com/moby/moby>https://github.com/moby/moby</a></li><li><a href=https://github.com/opencontainers/runc>https://github.com/opencontainers/runc</a></li><li><a href=https://github.com/containerd/containerd>https://github.com/containerd/containerd</a></li></ul><p>すべて docker 社がオリジナルを作って、いまも moby は docker 社が主体となって開発を継続しているだろうけれど、コンテナの実行環境のプラットフォームは k8s に取って変わられ、cri のコンテナランタイムとしての containerd があれば moby は docker daemon や docker engine のためのツールでしかなくなっている。当初 docker と moby を分割したのは、docker を開発ツール、moby を infrastructure にするという判断の下、moby を k8s のようなプラットフォームにしたかったはずである。しかし、結果的にその標準化競争に破れ containerd があれば dockerd daemon は不要になったとも解釈できる。docker という名前はコンテナのエコシステムにおいて docker 社が提供するコマンドラインやプロダクトの総称としての名前でしかなくなってしまっていて、一世を風靡した docker というパッケージングシステムの開発元に同情してしまう感もある。いまの docker engine は docker daemon と containerd の2つの daemon を起動していて docker 社としては微妙なアーキテクチャになっているのではないかと推測する。とくに swarm なんか最早削除したいだろう。</p><p>こういった docker を取り巻くエコシステムやツールの背景を説明するだけでも1つの記事になりそうなことが1日調べていてわかった。</p><h2 id=しくじり先生>しくじり先生</h2><p>たまたま <a href=https://www.tv-asahi.co.jp/shikujiri/backnumber2/0099/>竹原慎二先生「５０歳過ぎてもケンカを売られ続けてバリしんどい先生」</a> をみたらおもしろかった。ガチンコをリアルタイムでみていた世代なので竹原氏には好感をもっている。少し前に <a href=https://www.nhk.or.jp/kenko/atc_731.html>【あの人の健康法】元プロボクサー・竹原慎二の膀胱（ぼうこう）がんとの闘い</a> のような、闘病生活の記事もみかけていた。病気は克服してがんばっているといるようにみえる。よかった。もう51歳なのか。</p><p>この番組の中で若い頃に上京してボクシングジムへ通ったときに根性の定義が変わったという話しが出てくる。</p><blockquote><p>殴られても耐えることを根性だと思っていた。そのときに初めて殴られようが何しようが毎日辛い練習を重ねるのが根性だと気付かされた。</p></blockquote><p>地元で最強だったのが、ボクシングジムのヤンキーでもない先輩にまったく太刀打ちできなかったという。そのとき1番違うのはスタミナだったらしく、竹原氏は1分で息がきれるのに相手は軽く流すといった様相だった。この先輩にボコボコにされた経験を経てそれから心を改めて真面目になったと言う。その後ボクシングと真剣に向き合い、1995年に日本人初のミドル級世界チャンピオンになる。おそらく番組の主旨的に若ものへのメッセージとして「強さ」について話されていた。</p><blockquote><p>「ケンカに強い」だけが「強さ」じゃない、「強さ」の意味を履き違えずに生きよう。大人になると、いろんな強さを知る。大切な人のために仕事をどれだけ頑張れるか、辛い状況でもじっと耐えることができるか。そういう強さもある。</p></blockquote><p>私は誰かのために仕事をがんばったことないし、辛い状況を耐えるみたいなこともほぼやってなくて、嫌になったら仕事を辞めてて、こういう言葉にあうと自分を恥じてしまう。その後、喧嘩自慢で youtube 動画を検索していたらまさにそういうのがあった。竹原氏が「勝てるはずねぇだろ、お前らこんな茶番なことすんなよ」とぼやいていた。先の番組の中でも触れていたが、本当に真剣勝負したいと思って来ているのではなく、記念に戦ってみたいという不純な動機でやってくる人が多いらしい。たしかにそれは相手するのがしんどそう。</p><div class=video-container><iframe src=https://www.youtube.com/embed/O2rjpxf9W7U allowfullscreen title=懲りない喧嘩自慢に終止符を打ってみた></iframe></div></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0501/>対外的なお仕事をお休みしてドライブ</a></h1><div class=post-meta><time class=post-date>2023-05-01</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
</span><img src=/diary/img/2023/0501_anago-don.jpg class=post-cover alt=対外的なお仕事をお休みしてドライブ title="Cover Image"><div class=post-content><p>3時に寝て7時に起きた。翌日がお休みだと思うとはしゃいでうまく眠れなかった。午前中と夕方にオフィスへ行って作業していたので今日は day off じゃないけど、お出掛けする私用もあったのでお手伝い先のお仕事はお休みした。</p><h2 id=明石までドライブ>明石までドライブ</h2><p>11時半から車で明石市にある弁護士さんの事務所まで行ってきた。高速道路をわーっと走って明石市へ。ついでに明石市周辺も軽くドライブして浜辺なども走ってきた。毎週のように天気がよかったら車に乗ろうと思うものの、立体駐車場から車を出すのが面倒なのでなにか目的がないとなかなか乗る機会にならない。電車で明石へ行ってもほとんど時間は変わらないものの、ちょうどよい車を動かす機会だったのでドライブしてきた。昼間は天候もよくて気持ちよかった。戻ってきてから急に天気が崩れてちょうど雨が振り始める前のよい時間帯に走れた。たまにしか乗らないからかドライブするのもなかなか楽しい。お昼に焼き穴子丼定食を食べた。地元の食べものって感じで心地よかった。</p><h2 id=弁護士さんと相続打ち合わせ>弁護士さんと相続打ち合わせ</h2><p>3-4月と私がいっぱいいっぱいで忙しいから相続の打ち合わせを遅らせてもらっていた。相続税を10カ月以内に支払わないと追徴課税になる。弁護士さんから直接会って話したいということで明石の事務所まで行ってきた。私との会話の雰囲気から温度感をみたかったと弁護士さんは話されていた。</p><p>母・姉・私の3人で法定相続を行う。表現はよくないが、うちの家族は相続なんかどうでもよくて誰も関心をもっていない。一方で弁護士さんは利害関係の調整人になるので細かい数字の詳細確認やところどころで経費がかかることへの承諾を求めてくる。税理士さん、司法書士さん、弁護士さんと士業揃い踏みで相続の書類を作ってもらっている。田舎なので相続する建てものが登記されていませんとか普通に起きる。3月の時点で私が大きな方針だけ伝えて詳細はすべて専門家に委譲して経費も然るべきものはすべて言い値でよいから勝手に進めてみたいな指示を出していた。弁護士さんからしたら本当にそんな投げやりでいいのか？みたいな最終確認に face to face で打ち合わせしたかったんだと思う。私がメールのやり取りでそっけない対応をし過ぎたのかもしれない。</p><p>例えば、不動産の価値を評価するにも3つの価格がある。</p><ul><li>固定資産税評価額<ul><li>自治体が決める</li><li>弁護士はこの金額を使いたい</li></ul></li><li><a href=https://www.rosenka.nta.go.jp/>路線価</a><ul><li>国税庁が決める</li><li>税理士はこの金額を使いたい</li></ul></li><li>不動産屋さんの評価額<ul><li>市場が決める</li></ul></li></ul><p>不動産を評価するときに弁護士と税理士で扱う価格が異なると金額も変わってきてそれぞれの金額を、、、と話そうとするところで、私は複数の金額を調整とかしなくてよいので、シンプルでわかりやすい形でどれか1つの価格で評価してもらったらそれでよいですと突っ込む。母も姉も私も金額を計算し直すとかやらないし、それによる多少の損得があってもそんなのどうでもよいと弁護士さんへ伝える。家によっては、お墓や法事にかかる費用を誰が出すかで、相続とは別にその費用を相続のタイミングで多めにもらっておくといった手続きをすることもあるという。なるほど。うちは母がすべて出している。母が支払うので問題ないし、わざわざそんなことを文書で残さなくても大丈夫ですみたいなやり取りが必要になる。いまから書類を作って相続人にハンコを押してもらって手続きをを終えるのが9月頃の見込み。期限は10月中なのでいまからやってちょうどよい時期らしい。相続の手続きは大変。</p><h2 id=自動車税の支払い>自動車税の支払い</h2><p>4月1日に自動車をもっていると5月末までに自動車税を納めないといけない。自動車税は県に対して支払う。社用車の初めての自動車税なので毎年の手続きを忘れないための社内手続きをしていた。言うても google カレンダーと jira に issue 登録するだけなんやけど。送られてきた納付書から pay-easy で即時支払い手続きをした。自動車税の勘定科目は租税公課か車両費のどちらかで会計システムに登録すればよいらしい。うちは租税公課で自動車税という品目を割り当てて会計処理している。また1つ税金について学びを得た。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0429/>yubikey bio を触ってみた</a></h1><div class=post-meta><time class=post-date>2023-04-29</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;
#<a href=/diary/tags/pam/>pam</a>&nbsp;
#<a href=/diary/tags/auth/>auth</a>&nbsp;
#<a href=/diary/tags/security/>security</a>&nbsp;</span><div class=post-content><p>3時半に寝て7時に起きた。リリース終えたので晩ご飯を食べてから自分の会社のお仕事をしていたら遅くなった。</p><h2 id=ストレッチ>ストレッチ</h2><p>今週もリリース明けでそれほど座っている時間が長かったわけでもないため、腰の張りはあまりなく、負荷は低くなっているのではないかと推測する。今日の開脚幅は開始前156cmで、ストレッチ後158cmだった。右股関節周りの硬さは相変わらず大きく変化はないが、他がよくなった分、右ふともも前の筋を伸ばすと張りがきつくてしんどいように感じた。しばらく余裕のある生活ができるので歩いたりストレッチしたりする余裕が出てくるかもしれない。</p><h2 id=yubikey-bio-を触ってみた>yubikey bio を触ってみた</h2><p>先日 <a href=/diary/posts/2023/0416/#yubikey-bio-の購入>yubikey bio をオンラインストアで購入</a> した。会社の経費で業務で使うことを目的に購入したのでこの場合は商用利用の輸入にあたる。また別途、輸入についての会計処理を書く。yubico はスウェーデンの会社でどうやら日本向けはスウェーデンの首都ストックホルムから発送されてきたらしい。安いエコノミープランで注文していた。発送メールを受け取ったのが 4/17 でオフィスの郵便受けに入っていることに気付いたのが 4/29 になる。12日で届いたことになる。船便にしては早いからなにかしら航空便の安いプランで届いたのだと推測する。</p><blockquote><p>Economy - 10-20 Working Days - No tracking available</p></blockquote><p>早速、接続していろいろ触ってみた。結論から言って ubuntu 22.04 で fido2 pin を設定して u2f を使って2要素認証のメソッドとして pam や web アプリケーションから問題なく使えた。ubuntu 向けのアプリケーションも ppa のリポジトリを追加して apt からインストールできる。</p><ul><li><a href=https://support.yubico.com/hc/en-us/articles/360016649039-Installing-Yubico-Software-on-Linux>Installing Yubico Software on Linux</a></li></ul><p>このドキュメントには次の4つのアプリケーションのインストールが書いてある。</p><ul><li>YubiKey Manager (CLI): <code>sudo apt install yubikey-manager</code></li><li>YubiKey Personalization Tool: <code>sudo apt install yubikey-personalization-gui</code></li><li>libpam-yubico: <code>sudo apt install libpam-yubico</code></li><li>libpam-u2f: <code>sudo apt install libpam-u2f</code></li></ul><p>yubikey は他にもいろいろな認証の用途に使えるらしい。今回は fido2 の設定のみを紹介する。fido2 pin を登録するには YubiKey Manager の GUI を使った方が簡単なので次のアプリケーションも一緒にインストールするとよい。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo apt install -y yubikey-manager-qt
</span></span><span style=display:flex><span>$ ykman-gui
</span></span></code></pre></div><p>おそらく ykman の cli でも登録できると思うけど、yubikey や認証設定に慣れていない初心者は gui のナビゲーションに従って作業して結果を確認した方が安心だと思う。fido2 pin は ssh でいうところのパスフレーズのようなものなのかな？デバイスが盗まれるのを防ぐために pin があるという。一方で web アプリケーションが fido2 で認証するときに pin を要求するかどうかは任意になるらしい。よくあるパターンは初めて使うときは pin を要求して2回目以降はスキップするといった用途が多いのではないかと推測する。</p><figure><img src=/diary/img/2023/0429_ykman-gui1.png></figure><p>この fido2 pin を使って <a href=https://en.wikipedia.org/wiki/Universal_2nd_Factor>Universal 2nd Factor (u2f)</a> の設定を行う。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ mkdir -p ~/.config/Yubico
</span></span><span style=display:flex><span>$ pamu2fcfg &gt; ~/.config/Yubico/u2f_keys
</span></span><span style=display:flex><span>Enter PIN <span style=color:#66d9ef>for</span> /dev/hidraw3: ***  &lt;<span style=color:#f92672>=</span> このときに yubikey manager で設定した fido2 pin を入力
</span></span></code></pre></div><p>この後 yubikey デバイスが点滅するので丸いセンサー部分を指でタッチすると完了する。このときに指紋登録しているのか、物理的にタッチすることを要求しているだけなのか、よくわかっていない。この前に <a href=https://www.yubico.com/setup/yubikey-bio-series/>chrome で指紋登録</a> をしていたのでそれが使われているのかもしれない。いま ykman で設定をみたら <code>Fingerprints registered</code> とあるのでどこかしらに指紋登録されているらしい。おそらく chrome じゃないかと推測する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ykman fido info
</span></span><span style=display:flex><span>WARNING: PC/SC not available. Smart card <span style=color:#f92672>(</span>CCID<span style=color:#f92672>)</span> protocols will not <span style=color:#66d9ef>function</span>.
</span></span><span style=display:flex><span>PIN is set, with <span style=color:#ae81ff>8</span> attempt<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> remaining.
</span></span><span style=display:flex><span>Fingerprints registered, with <span style=color:#ae81ff>3</span> attempt<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> remaining.
</span></span><span style=display:flex><span>Always Require User Verification is turned on.
</span></span></code></pre></div><p>linux で認証時に u2f を使いたいときは <code>pam_u2f.so</code> を使って pam の設定をするとよい。ubuntu だと <code>/etc/pam.d/</code> 配下にいろんな認証設定がある。例えば login 時に2要素認証をしたい場合は次のようにフックする。パスワード入力した後に yubikey のセンサーを物理的にタッチして指紋認証を行える。セキュリティに厳しい会社はこういった運用をしているのかもしれない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo vi /etc/pam.d/login
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#75715e># Standard Un*x authentication.</span>
</span></span><span style=display:flex><span>@include common-auth
</span></span><span style=display:flex><span>auth       required    pam_u2f.so
</span></span></code></pre></div><p>パスワード認証の代替として使いたい場合は通常の認証の前に <code>sufficient</code> として呼び出せば指紋認証が成功したときにそれ以降の処理がスキップされる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>auth       sufficient    pam_u2f.so
</span></span><span style=display:flex><span>@include common-auth
</span></span></code></pre></div><p>これらの設定を確認にするには <a href=https://pamtester.sourceforge.net/>pamtester</a> というツールを使うと簡単にできる。認証の設定を誤るとログインできなくなってしまうので慎重にテストして振る舞いを確認した上で実際の運用を行うとよい。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pamtester login t2y authenticate  &lt;<span style=color:#f92672>=</span> このときに yubikey デバイスが点滅するので指紋認証する
</span></span><span style=display:flex><span>pamtester: successfully authenticated
</span></span></code></pre></div><p>せっかく購入したので 1password アカウントや github の2要素認証に設定してみた。ワンタイムパスワードの otp の代替として使える。ワンタイムパスワードを入力するより yubikey のセンサーをタッチする方が日々の運用としては少しお手軽と言える。設定していて otp と yubikey でお互いに2要素認証のバックアップを兼ねることに気付いた。認証方法が増えるのでセキュリティ的には脆弱になるけれど、サービスとセキュリティのトレードオフの考え方から、yubikey の分だけ脆弱になっても物理的なセキュリティを担保できるのであれば利便性を考慮してよいように私には思えた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0426/>とりわけて書くことのない日</a></h1><div class=post-meta><time class=post-date>2023-04-26</time></div><span class=post-tags>#<a href=/diary/tags/project-management/>project management</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;</span><div class=post-content><p>1時に寝て何度か起きて7時に起きた。昨日は23時半に帰ってきてから十割蕎麦を茹でて食べたけど、吐き気はなかった。蕎麦ぐらいなら大丈夫か。</p><h2 id=開発方法論の見直し>開発方法論の見直し</h2><p>開発が一区切りしたタイミングで開発方法論やガイドのドキュメントも見返して、過去に作ったときからみて現状の内容や気付き事項などを加筆修正していた。これを繰り返すうちに開発文化が言語化できていく雰囲気はする。その後は issue の洗い出しや1on1 やってインストール手順の検証やドキュメントの更新などをしていた。これと言って成果を出した一日ではなかったものの、wiki をあちこち更新して整理していたらいつの間にか時間が過ぎていたという所感。</p><h2 id=歯科検診>歯科検診</h2><p>17時から歯科検診へ行ってきた。いつも通り歯のお掃除をして1年ぶりに歯のレントゲンを撮ることになった。新たにレントゲンを撮る機械が導入されていて、台に顔を置くとカメラが顔周りを移動してレントゲンが撮られた。これまでは位置固定のための器具を噛んでパシャパシャ撮るやり方だったので面倒だったのが便利になっていた。帰りにカードリーダーが置いてあることに気付いて、受付の担当者さんに尋ねたら、マイナンバーカードに保険証を設定すれば使えることを教えてもらった。次回はマイナンバーカードで保険証提示をやってみたい。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0422/>のびのびと働く土曜日</a></h1><div class=post-meta><time class=post-date>2023-04-22</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/writing/>writing</a>&nbsp;
#<a href=/diary/tags/food/>food</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;</span><div class=post-content><p>昨日は夜に晩ご飯の買い出しにオフィスを出てから、また戻って作業して22時頃に帰ってきて0時に寝て7時に起きた。今日はここ1-2ヶ月では久しぶりにプロジェクトの締め切りに追われずに落ち着いてやりたいことができた。</p><h2 id=ストレッチ>ストレッチ</h2><p>先週に比べれば負荷は減っていたので右腰の張りは少しよくなった。むしろ先週が悪過ぎた。いつも通り右足全般は張りがあるのと、お尻と太ももの境界のツボもいつもより効く感じがして辛かった。今日の開脚幅は開始前155cmで、ストレッチ後158cmだった。リリースに向けての根を詰めてやってきた作業も一段落したのでこれからは体調をよくする方向に意識を向けていけるかもしれない。</p><h2 id=プロダクトのドキュメント>プロダクトのドキュメント</h2><p>追われてないので余裕をもって昨日の続きで2時間ほど書いてた。3 (ページ) ファイルを追加した。ドキュメントは一気に書くとしんどい。少しずつ書いていけば徐々に文量が増えてさらに内容も洗練されていく。休日にドキュメントを書いていると途中で割り込みが入らないから集中できて効率がよい。ソースコードにしろ、文章にしろ、書くときに割り込みが入らない状況は重要なことに最近気付いた。この日記もまとめて数日分を (下書きから) 書くときがあるが、それは集中して書ける時間を取れそうと見計らって書いている気がする。どうやら私は割り込みの有無と書くときのモチベーションに相関関係があるように思える。</p><h2 id=きんとん>きんとん</h2><p>夕方にたまたま出掛けて、よく行くお店で晩ご飯食べようと思ったら開店の20分前で諦めて帰ろうとしていたときにたまたま目にとまった。以前から人気のあるお店であることは知っていたし、いつか入りたいと思っていたお店で、中途半端な時間帯だからお客さんも少なくて、いまがその「いつか」だと気付いて <a href=https://tabelog.com/hyogo/A2801/A280101/28049009/>きんとん 神戸店</a> に入ってみた。後で食べログのとんかつ百名店2022の1つであることを知った。昔からあるから古いお店だと思い込んでいたけど、実際はそうでもなく、店内はオープンでモダンな佇まいで少し驚いた。特選ロースかつ定食が1900円。ちょっと高め。おいしかったので十分に満足した。タレもとんかつソース、わさび醤油、ヒマラヤ岩塩があって、それぞれに味わいがあってよかったし、キャベツにかけるドレッシングもオリジナルでおいしかった。接待にもよさそう。</p><figure><img src=/diary/img/2023/0422_tonkatsu.jpg></figure><h2 id=第4期のふりかえり>第4期のふりかえり</h2><p>年度が変わって1ヶ月が経とうとしている中、ようやく昨年度のふりかえりができる状況になってきた。今年は3月に余裕がなくて少し後ろにずれ込んでいる。この年度ふりかえりも毎年やっているから知見も溜まっていくし、新しい発見もある。来週の雑談に向けてまずは叩き台を作った。もう2-3日ほどかけて資料を洗練させていく。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0415/>休出デバッグ</a></h1><div class=post-meta><time class=post-date>2023-04-15</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/gpt/>gpt</a>&nbsp;
#<a href=/diary/tags/debug/>debug</a>&nbsp;</span><div class=post-content><p>昨日は久しぶりに飲みに行っきて1時に寝て8時に起きた。</p><h2 id=ストレッチ>ストレッチ</h2><p>外がだいぶ暖かくなってきて散歩に行く機会も増えてきた気がする。今日の開脚幅は開始前157cmで、ストレッチ後159cmだった。先週と違って今週は忙しくて座っている時間が大幅に増えた。そして、その分の右腰の張りは強かった。腰の張り具合はその週の忙しさや労働時間で推測できるぐらいにはわかってきた。それ以外はだいたい可もなく不可もなくな感じだったと思う。</p><h2 id=淡路牛の受け取り>淡路牛の受け取り</h2><p>姉からお肉が届くという連絡があったので日時を調整して受け取った。<a href=https://www.awajikoku.com/shimasalad/2022/12/04/20221204094613/>島サラダフェア2022</a> という懸賞に応募していたのが当たったらしい。5000円相当の淡路牛らしい。お正月に食べるようなお肉だと言えば伝わるかな。A賞の5名のうちの1人がここにいるので総応募数は推して知るべし。姉が言うには全然応募ないらしい。こういうの調べて真面目に応募してメルカリで売るみたいなことやったらそれなりに儲かるのかもしれない。運営はマーケティングのやり方を変えた方がいいんじゃないかとか心配になって話していた。</p><figure><img src=/diary/img/2023/0415_awaji-beef.jpg></figure><h2 id=openldap-の-overlay-のデバッグ>openldap の overlay のデバッグ</h2><p>午後から昨日の続き。<a href=https://openai.com/blog/chatgpt>chatgpt</a> と一緒に openldap サーバーのカスタム overlay モジュールのデバッグをしていた。昨日の時点では2つの問題があることを確認できていた。今日は個々の問題の詳細をデバッグしながらワークアラウンドとして動かすためのコードを書いた。1つはビルドの問題じゃないかと思える不可思議な現象が起きていて、もう1つは openldap の ppolicy の仕様とカスタム overlay モジュールの仕様のどちらが正しいのかを設計者に確認する必要がある。15年ぶりぐらいに c 言語のコードを書いている。かなり怪しいけど、gdb をインタラクティブな repl のようにして振る舞いを確認しながら書いている。カスタム overlay モジュールでエラーが発生すると openldap はその処理をスキップするようにみえて、なんのログも出ない。細かくログ出力してどこまで動いたのかを確認しながら開発するとよさそうな雰囲気がわかった。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0409/>ubuntu の環境構築</a></h1><div class=post-meta><time class=post-date>2023-04-09</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/linux/>linux</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;</span><div class=post-content><p>0時に寝て8時に起きた。昨日は出張から遅くに帰ってきたのでバテた。</p><h2 id=ストレッチ>ストレッチ</h2><p>昨日はもくもく会で遅くに帰ってきたので毎週のストレッチを土曜日から日曜日に変更していた。ここ1-2ヶ月ほどでは最も調子がよかった。今週は出張していて普段より健康的な生活をしていた。というのは、お手伝い先のオフィスでは原則として私は9-18時でしか働けないため、業務の都合でずっと座りっぱなしにならない。例えば、自社のオフィスだとだいたい8時から始業して遅いと23時ぐらいまでずっと座りっぱなしになってしまう。たまたまホテルもいつもよりも離れた場所にとり、10分ほど歩く距離だったのでちょうどよかった。帰ってからホテルで2-3時間作業していたりもするのだが、それでも同じ姿勢でずっと座り続けている方が体にとってはよくないことがわかる。今日の開脚幅は開始前152cmで、ストレッチ後156cmだった。座っている時間が短かったために腰の張りはほとんどなかった。</p><h2 id=ubuntu-2204-lts-の環境構築>ubuntu 22.04 lts の環境構築</h2><p>先日 <a href=/diary/posts/2023/0325/#dell-マシンに-ubuntu-をインストール>マシンに ubuntu をインストールした</a> 続きの話し。東京出張があったり、開発の終盤でいろいろやっている中で開発環境を作り直すインセンティブが低かったので環境構築が遅くなった。過去の環境構築の issue が残っているのでそれをみながらやれば5-6時間もあれば作り直せた。結論から言って、マシンスペックが上がって、os も新しいものに変わったので開発環境としてはめちゃくちゃ快適になった。好みだが、私はリソースの潤沢なデスクトップマシンに linux をインストールして開発するのが一番しっくりくる。主観的に感情的にその構成が好きだというもの。</p><p>realforce の bluetooth キーボードの設定をするのにもう1つキーボードが必要なことに気付いた。私は <a href=http://www.bluez.org/>bluez</a> というツールを使って bluetooth キーボードのペアリングをしている。ペアリングするためには bluez の bluetoothctl という cli から操作してペアリングを行う。realforce のキーボードは有線/bluetooth 接続を両方同時につなぐことはできないため、bluetooth 接続するためには別のキーボードを接続して cli 操作しないといけない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ bluetoothctl
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>bluetooth<span style=color:#f92672>]</span><span style=color:#75715e># power on</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>bluetooth<span style=color:#f92672>]</span><span style=color:#75715e># agent on</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>bluetooth<span style=color:#f92672>]</span><span style=color:#75715e># scan on</span>
</span></span></code></pre></div><p>bluetooth キーボードから接続要求を送る。</p><pre tabindex=0><code>...
[NEW] Device F6:9D:A5:41:B7:1F REALFORCE_2
...
[bluetooth]# info F6:9D:A5:41:B7:1F
Device F6:9D:A5:41:B7:1F (random)
	Name: REALFORCE_2
	Alias: REALFORCE_2
	Appearance: 0x03c1
	Icon: input-keyboard
	Paired: no
	Trusted: no
	Blocked: no
	Connected: no
	LegacyPairing: no
	UUID: Human Interface Device    (00001812-0000-1000-8000-00805f9b34fb)
	RSSI: -51
</code></pre><p>マシンからデバイスを検出したらデバイス情報を確認してペアリングを実行する。</p><pre tabindex=0><code>[bluetooth]# pair F6:9D:A5:41:B7:1F
Attempting to pair with F6:9D:A5:41:B7:1F
[CHG] Device F6:9D:A5:41:B7:1F Connected: yes
[agent] Passkey: ***
</code></pre><p>これでペアリングが実行されて bluetooth 接続できるようになる。ubuntu 20.04 lts の頃より進化しているのは接続／切断時に電池の残量も表示されるようになった。キーボードには充電池を使っているので地味に嬉しい。残量が少なくなってきたら帰るときに充電を仕掛けて帰れる。</p><p>今回の環境構築で1つはまったものがある。vagrant の仮想環境として virtualbox を使う。<a href=https://wiki.ubuntu.com/UEFI/SecureBoot>secure boot</a> のために virtualbox をインストールするときにパスワードを mok (Machine-Owner Key) に登録しないといけない。この作業手順が分からなくて右往左往していた。インストール時に mok のダイアログが表示されてパスワードを登録するが、この後に os を再起動して bios 起動時に特別なダイアログが表示されて mok に登録したいパスワードを入力する。アプリケーションのインストール時に bios の設定が必要という概念が私の頭の中になくて分からなかった。これをやらないと virtualbox サービスが正常に起動しない。調べていると ubuntu 標準の virtualbox は壊れていて 3rd party の contrib なパッケージを使えという古い記事も出てくる。22.04 なら ubuntu 標準の virtualbox でも問題なく、mok の登録後に systemd から virtualbox サービスが起動することを確認した。再起動後の mok のダイアログは1度しか出てこないのでうっかり見逃してしまったら再設定しないといけない。次の cli で再設定できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo dpkg-reconfigure virtualbox-dkms
</span></span></code></pre></div><blockquote class=twitter-tweet><p lang=ja dir=ltr>dell の xps 8950 に ubuntu 22.04 lts をインストールして開発環境を一通り構築した。ほとんどトラブルなく構築できた。いろいろ快適になったので集中力が上がる。開発の追い込みなのでちょうどよい。</p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1646055812224417792?ref_src=twsrc%5Etfw">April 12, 2023</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script></div></article><div class=pagination><div class=pagination__buttons><a href=/diary/tags/life/page/9/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span>
</a><a href=/diary/tags/life/page/11/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>