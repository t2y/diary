<!doctype html><html lang=en><head><title>device :: forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/tags/device/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="device"><meta property="og:description" content><meta property="og:url" content="/diary/tags/device/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/tags/device/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0429/>yubikey bio を触ってみた</a></h1><div class=post-meta><time class=post-date>2023-04-29 (Sat.) ::</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;
#<a href=/diary/tags/pam/>pam</a>&nbsp;
#<a href=/diary/tags/auth/>auth</a>&nbsp;
#<a href=/diary/tags/security/>security</a>&nbsp;</span><div class=post-content><p>3時半に寝て7時に起きた。リリース終えたので晩ご飯を食べてから自分の会社のお仕事をしていたら遅くなった。</p><h2 id=ストレッチ>ストレッチ</h2><p>今週もリリース明けでそれほど座っている時間が長かったわけでもないため、腰の張りはあまりなく、負荷は低くなっているのではないかと推測する。今日の開脚幅は開始前156cmで、ストレッチ後158cmだった。右股関節周りの硬さは相変わらず大きく変化はないが、他がよくなった分、右ふともも前の筋を伸ばすと張りがきつくてしんどいように感じた。しばらく余裕のある生活ができるので歩いたりストレッチしたりする余裕が出てくるかもしれない。</p><h2 id=yubikey-bio-を触ってみた>yubikey bio を触ってみた</h2><p>先日 <a href=/diary/posts/2023/0416/#yubikey-bio-の購入>yubikey bio をオンラインストアで購入</a> した。会社の経費で業務で使うことを目的に購入したのでこの場合は商用利用の輸入にあたる。また別途、輸入についての会計処理を書く。yubico はスウェーデンの会社でどうやら日本向けはスウェーデンの首都ストックホルムから発送されてきたらしい。安いエコノミープランで注文していた。発送メールを受け取ったのが 4/17 でオフィスの郵便受けに入っていることに気付いたのが 4/29 になる。12日で届いたことになる。船便にしては早いからなにかしら航空便の安いプランで届いたのだと推測する。</p><blockquote><p>Economy - 10-20 Working Days - No tracking available</p></blockquote><p>早速、接続していろいろ触ってみた。結論から言って ubuntu 22.04 で fido2 pin を設定して u2f を使って2要素認証のメソッドとして pam や web アプリケーションから問題なく使えた。ubuntu 向けのアプリケーションも ppa のリポジトリを追加して apt からインストールできる。</p><ul><li><a href=https://support.yubico.com/hc/en-us/articles/360016649039-Installing-Yubico-Software-on-Linux>Installing Yubico Software on Linux</a></li></ul><p>このドキュメントには次の4つのアプリケーションのインストールが書いてある。</p><ul><li>YubiKey Manager (CLI): <code>sudo apt install yubikey-manager</code></li><li>YubiKey Personalization Tool: <code>sudo apt install yubikey-personalization-gui</code></li><li>libpam-yubico: <code>sudo apt install libpam-yubico</code></li><li>libpam-u2f: <code>sudo apt install libpam-u2f</code></li></ul><p>yubikey は他にもいろいろな認証の用途に使えるらしい。今回は fido2 の設定のみを紹介する。fido2 pin を登録するには YubiKey Manager の GUI を使った方が簡単なので次のアプリケーションも一緒にインストールするとよい。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo apt install -y yubikey-manager-qt
</span></span><span style=display:flex><span>$ ykman-gui
</span></span></code></pre></div><p>おそらく ykman の cli でも登録できると思うけど、yubikey や認証設定に慣れていない初心者は gui のナビゲーションに従って作業して結果を確認した方が安心だと思う。fido2 pin は ssh でいうところのパスフレーズのようなものなのかな？デバイスが盗まれるのを防ぐために pin があるという。一方で web アプリケーションが fido2 で認証するときに pin を要求するかどうかは任意になるらしい。よくあるパターンは初めて使うときは pin を要求して2回目以降はスキップするといった用途が多いのではないかと推測する。</p><figure><img src=/diary/img/2023/0429_ykman-gui1.png></figure><p>この fido2 pin を使って <a href=https://en.wikipedia.org/wiki/Universal_2nd_Factor>Universal 2nd Factor (u2f)</a> の設定を行う。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ mkdir -p ~/.config/Yubico
</span></span><span style=display:flex><span>$ pamu2fcfg &gt; ~/.config/Yubico/u2f_keys
</span></span><span style=display:flex><span>Enter PIN <span style=color:#66d9ef>for</span> /dev/hidraw3: ***  &lt;<span style=color:#f92672>=</span> このときに yubikey manager で設定した fido2 pin を入力
</span></span></code></pre></div><p>この後 yubikey デバイスが点滅するので丸いセンサー部分を指でタッチすると完了する。このときに指紋登録しているのか、物理的にタッチすることを要求しているだけなのか、よくわかっていない。この前に <a href=https://www.yubico.com/setup/yubikey-bio-series/>chrome で指紋登録</a> をしていたのでそれが使われているのかもしれない。いま ykman で設定をみたら <code>Fingerprints registered</code> とあるのでどこかしらに指紋登録されているらしい。おそらく chrome じゃないかと推測する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ykman fido info
</span></span><span style=display:flex><span>WARNING: PC/SC not available. Smart card <span style=color:#f92672>(</span>CCID<span style=color:#f92672>)</span> protocols will not <span style=color:#66d9ef>function</span>.
</span></span><span style=display:flex><span>PIN is set, with <span style=color:#ae81ff>8</span> attempt<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> remaining.
</span></span><span style=display:flex><span>Fingerprints registered, with <span style=color:#ae81ff>3</span> attempt<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> remaining.
</span></span><span style=display:flex><span>Always Require User Verification is turned on.
</span></span></code></pre></div><p>linux で認証時に u2f を使いたいときは <code>pam_u2f.so</code> を使って pam の設定をするとよい。ubuntu だと <code>/etc/pam.d/</code> 配下にいろんな認証設定がある。例えば login 時に2要素認証をしたい場合は次のようにフックする。パスワード入力した後に yubikey のセンサーを物理的にタッチして指紋認証を行える。セキュリティに厳しい会社はこういった運用をしているのかもしれない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo vi /etc/pam.d/login
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#75715e># Standard Un*x authentication.</span>
</span></span><span style=display:flex><span>@include common-auth
</span></span><span style=display:flex><span>auth       required    pam_u2f.so
</span></span></code></pre></div><p>パスワード認証の代替として使いたい場合は通常の認証の前に <code>sufficient</code> として呼び出せば指紋認証が成功したときにそれ以降の処理がスキップされる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>auth       sufficient    pam_u2f.so
</span></span><span style=display:flex><span>@include common-auth
</span></span></code></pre></div><p>これらの設定を確認にするには <a href=https://pamtester.sourceforge.net/>pamtester</a> というツールを使うと簡単にできる。認証の設定を誤るとログインできなくなってしまうので慎重にテストして振る舞いを確認した上で実際の運用を行うとよい。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pamtester login t2y authenticate  &lt;<span style=color:#f92672>=</span> このときに yubikey デバイスが点滅するので指紋認証する
</span></span><span style=display:flex><span>pamtester: successfully authenticated
</span></span></code></pre></div><p>せっかく購入したので 1password アカウントや github の2要素認証に設定してみた。ワンタイムパスワードの otp の代替として使える。ワンタイムパスワードを入力するより yubikey のセンサーをタッチする方が日々の運用としては少しお手軽と言える。設定していて otp と yubikey でお互いに2要素認証のバックアップを兼ねることに気付いた。認証方法が増えるのでセキュリティ的には脆弱になるけれど、サービスとセキュリティのトレードオフの考え方から、yubikey の分だけ脆弱になっても物理的なセキュリティを担保できるのであれば利便性を考慮してよいように私には思えた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0416/>yubikey bio を購入してみた</a></h1><div class=post-meta><time class=post-date>2023-04-16 (Sun.) ::</time></div><span class=post-tags>#<a href=/diary/tags/auth/>auth</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;
#<a href=/diary/tags/project-management/>project management</a>&nbsp;</span><div class=post-content><p>0時に寝て7時に起きた。午前中は洗濯して、昨日届いたお肉を焼いて朝ご飯にしながらドラクエタクトやってた。</p><h2 id=yubikey-bio-の購入>yubikey bio の購入</h2><p>デスクトップマシンが不調だった1-2ヶ月ほど <a href=/diary/posts/2022/1004/#m2-macbook-air-購入>m2 macbook air</a> でお仕事をしていた。デスクトップマシンと比べて明らかに便利だったことがある。<a href=https://1password.com/jp/>1password</a> にログインするときに os のシステムアカウントも利用できて、具体的には指紋認証によりパスワード入力を必要としなかった。デフォルトでは2週間ごとにパスワード入力を必要とする設定になっているが、これも無効にすることもできる。パスワードを忘れないように1ヶ月に1回ぐらいは手入力してもよいかもしれない。生体認証はその精度にまだ懸念はあるそうだけど、こういった日常的な認証における用途ならそれほど高い精度を要求しないことに気付いた。私は個人でお仕事しているから日常でオフィスに保管している物理的なデバイスを盗むのは難しい。他にも linux で使える指紋認証のデバイスを探してみた。しかし、現時点では usb の指紋認証デバイスは windows 一択になっていて linux はサポートされていない。YubiKey ぐらいしか、私はみつけることができなかった。</p><p><a href=https://www.yubico.com/jp/product/yubikey-bio-series/yubikey-bio/>YubiKey Bio - FIDO Edition</a> をオンラインストアで購入した。船便で購入したので届くまで1ヶ月ほどかかる。急ぐものではないので気長に待つ。</p><pre tabindex=0><code>YubiKey Bio - FIDO Edition
$90

Shipping &amp; handling
Economy - 10-20 Working Days - No tracking available
$5

Duties, taxes and/or carrier subcharges
$14.68 USD
</code></pre><p>日本にお店がないので輸入扱いで関税がかかるのかな？また会計システムに登録するときに税金の計上方法を調べる必要がありそう。</p><h2 id=自分たちでやろうとしないことを他人は助けられない>自分たちでやろうとしないことを他人は助けられない</h2><p>他社のプロジェクト開発のお手伝いでプロジェクトマネージャーとしてこの半年をマネジメントしてきて分かるようになったことが1つある。米軍がアフガニスタンから撤退するときの方便のようにみかけ、ロシアのウクライナ侵攻のときにウクライナ軍が善戦して西側諸国の支持を得たことでその正しさを再確認できた言葉がある。</p><blockquote><p>バイデン大統領は演説で「当事国の軍隊が戦う意思がないのにアメリカが戦うわけにはいかない」という趣旨を繰り返した。</p><p><a href=https://www.jfss.gr.jp/article/1569>アフガニスタン崩壊と日本への教訓</a></p></blockquote><p>2月からプロジェクトの開発遅れがみえていてスケジュール調整している。プロジェクトの開発がうまくいかないことの全責任は私にあることは間違いない。その点には一切の懸念も疑問もない。昨今の働き方改革で有休取得が大事なことも理解していて、平均して取得するなら毎月1-2日休むことになる。それは理解できるが、開発が遅延していても有休で休み、その遅延をマネージャである私が休出して開発を肩代わりするという調整を1ヶ月以上続けてきて、この歪みは開発やプロジェクトにとってよくないということもわかってきた。</p><p>私個人のモチベーション管理にも多少の影響はあるが、私は指示されて休出しているわけではなく、自分の目的のためにやっているのでこの影響はそれほど重要ではない。</p><p>なにが問題かというとプロダクトオーナーシップを開発者がもたないという点にある。私はお手伝いであるから、いずれいなくなる。周りからどうみえようと最終的にプロダクトオーナーシップは契約形態としてもてない。そして、お手伝い先の開発メンバーがもつようになるのが望ましい。しかし、そういう雰囲気はみえない。これまで他社の人間がマネージャーをやっているようなプロジェクトに私が参加したことがなかったためにそういった視点がなかった。そして、私は自分がイニシアティブをもって開発するプロダクトはすべてプロダクトオーナーシップをもって臨んできた。そのため、開発者に裁量を与えることで必然的にプロダクトオーナーシップをもつようになると信じてきたが、いまのやり方だとそうならない気がしている。なぜならば、放っておいても問題になる前に私が勝手に対応してしまうために開発者のインセンティブやモチベーションを阻害してしまうからだ。</p><p>プロジェクトにおけるスケジュールや品質を担保するためにはマネージャーである私が一定の尽力をするのは合理的ではある。一方でそれをやり過ぎることで開発メンバーのプロダクトオーナーシップを遠ざけてしまう。プロダクトオーナーシップをもっていない開発者が休出してまで開発に尽力する意味など普通にはない。仮に私が開発メンバーでもそう思うだろう。<a href=/diary/posts/2023/0310/>昔の上長</a> がやっていたことをみて私が学んだことを、外部の人間として開発メンバーに教えることはとても難しいことを理解できた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0409/>ubuntu の環境構築</a></h1><div class=post-meta><time class=post-date>2023-04-09 (Sun.) ::</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/linux/>linux</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;</span><div class=post-content><p>0時に寝て8時に起きた。昨日は出張から遅くに帰ってきたのでバテた。</p><h2 id=ストレッチ>ストレッチ</h2><p>昨日はもくもく会で遅くに帰ってきたので毎週のストレッチを土曜日から日曜日に変更していた。ここ1-2ヶ月ほどでは最も調子がよかった。今週は出張していて普段より健康的な生活をしていた。というのは、お手伝い先のオフィスでは原則として私は9-18時でしか働けないため、業務の都合でずっと座りっぱなしにならない。例えば、自社のオフィスだとだいたい8時から始業して遅いと23時ぐらいまでずっと座りっぱなしになってしまう。たまたまホテルもいつもよりも離れた場所にとり、10分ほど歩く距離だったのでちょうどよかった。帰ってからホテルで2-3時間作業していたりもするのだが、それでも同じ姿勢でずっと座り続けている方が体にとってはよくないことがわかる。今日の開脚幅は開始前152cmで、ストレッチ後156cmだった。座っている時間が短かったために腰の張りはほとんどなかった。</p><h2 id=ubuntu-2204-lts-の環境構築>ubuntu 22.04 lts の環境構築</h2><p>先日 <a href=/diary/posts/2023/0325/#dell-マシンに-ubuntu-をインストール>マシンに ubuntu をインストールした</a> 続きの話し。東京出張があったり、開発の終盤でいろいろやっている中で開発環境を作り直すインセンティブが低かったので環境構築が遅くなった。過去の環境構築の issue が残っているのでそれをみながらやれば5-6時間もあれば作り直せた。結論から言って、マシンスペックが上がって、os も新しいものに変わったので開発環境としてはめちゃくちゃ快適になった。好みだが、私はリソースの潤沢なデスクトップマシンに linux をインストールして開発するのが一番しっくりくる。主観的に感情的にその構成が好きだというもの。</p><p>realforce の bluetooth キーボードの設定をするのにもう1つキーボードが必要なことに気付いた。私は <a href=http://www.bluez.org/>bluez</a> というツールを使って bluetooth キーボードのペアリングをしている。ペアリングするためには bluez の bluetoothctl という cli から操作してペアリングを行う。realforce のキーボードは有線/bluetooth 接続を両方同時につなぐことはできないため、bluetooth 接続するためには別のキーボードを接続して cli 操作しないといけない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ bluetoothctl
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>bluetooth<span style=color:#f92672>]</span><span style=color:#75715e># power on</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>bluetooth<span style=color:#f92672>]</span><span style=color:#75715e># agent on</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>bluetooth<span style=color:#f92672>]</span><span style=color:#75715e># scan on</span>
</span></span></code></pre></div><p>bluetooth キーボードから接続要求を送る。</p><pre tabindex=0><code>...
[NEW] Device F6:9D:A5:41:B7:1F REALFORCE_2
...
[bluetooth]# info F6:9D:A5:41:B7:1F
Device F6:9D:A5:41:B7:1F (random)
	Name: REALFORCE_2
	Alias: REALFORCE_2
	Appearance: 0x03c1
	Icon: input-keyboard
	Paired: no
	Trusted: no
	Blocked: no
	Connected: no
	LegacyPairing: no
	UUID: Human Interface Device    (00001812-0000-1000-8000-00805f9b34fb)
	RSSI: -51
</code></pre><p>マシンからデバイスを検出したらデバイス情報を確認してペアリングを実行する。</p><pre tabindex=0><code>[bluetooth]# pair F6:9D:A5:41:B7:1F
Attempting to pair with F6:9D:A5:41:B7:1F
[CHG] Device F6:9D:A5:41:B7:1F Connected: yes
[agent] Passkey: ***
</code></pre><p>これでペアリングが実行されて bluetooth 接続できるようになる。ubuntu 20.04 lts の頃より進化しているのは接続／切断時に電池の残量も表示されるようになった。キーボードには充電池を使っているので地味に嬉しい。残量が少なくなってきたら帰るときに充電を仕掛けて帰れる。</p><p>今回の環境構築で1つはまったものがある。vagrant の仮想環境として virtualbox を使う。<a href=https://wiki.ubuntu.com/UEFI/SecureBoot>secure boot</a> のために virtualbox をインストールするときにパスワードを mok (Machine-Owner Key) に登録しないといけない。この作業手順が分からなくて右往左往していた。インストール時に mok のダイアログが表示されてパスワードを登録するが、この後に os を再起動して bios 起動時に特別なダイアログが表示されて mok に登録したいパスワードを入力する。アプリケーションのインストール時に bios の設定が必要という概念が私の頭の中になくて分からなかった。これをやらないと virtualbox サービスが正常に起動しない。調べていると ubuntu 標準の virtualbox は壊れていて 3rd party の contrib なパッケージを使えという古い記事も出てくる。22.04 なら ubuntu 標準の virtualbox でも問題なく、mok の登録後に systemd から virtualbox サービスが起動することを確認した。再起動後の mok のダイアログは1度しか出てこないのでうっかり見逃してしまったら再設定しないといけない。次の cli で再設定できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo dpkg-reconfigure virtualbox-dkms
</span></span></code></pre></div><blockquote class=twitter-tweet><p lang=ja dir=ltr>dell の xps 8950 に ubuntu 22.04 lts をインストールして開発環境を一通り構築した。ほとんどトラブルなく構築できた。いろいろ快適になったので集中力が上がる。開発の追い込みなのでちょうどよい。</p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1646055812224417792?ref_src=twsrc%5Etfw">April 12, 2023</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0325/>ubuntu のインストール</a></h1><div class=post-meta><time class=post-date>2023-03-25 (Sat.) ::</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/linux/>linux</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;</span><div class=post-content><p>1時に寝て5時に起きて7時に起きた。今週も開発に集中していたのでバテ気味。時間がなくて2ヶ月以上行ってなかった散髪に行ってきた。前髪が目にかかって鬱陶しかったのでいつもよりも短くしてもらった。頭が軽いと日々の生活のストレスも軽減しそう。</p><h2 id=ストレッチ>ストレッチ</h2><p>今日の開脚幅は開始前153cmで、ストレッチ後153cmだった。ストレッチ後の開脚幅はいつもとは計り方を変えたので数値は低くなっているが普段と同じぐらいのものだろう。すねの外側の筋は気にならないぐらいになったので復調したと言っていいだろう。今日は右股関節から太ももにかけての張りと右腰の張りが大きかった。今週も根を詰めて長時間オフィスで作業していたので座っているとかかる部位の負荷が高くなっていると想定される。納期が4月末なのでこの生活はもうしばらく続くといったところ。</p><h2 id=dell-マシンに-ubuntu-をインストール>dell マシンに ubuntu をインストール</h2><p>いつも通りオフィスで会社の事務手続きをしながら、並行して <a href=/diary/posts/2023/0323/>購入した dell マシン</a> に ubuntu をインストールする。いまお仕事で開発しているアプリケーションの成果物は amd64 をターゲットにしているのでローカルに amd64 の開発環境がないとインフラ周りやコンテナ周りの検証に一手間かかる。この状況を解消するために早くローカルの dell マシンを置き換えて開発環境を構築したい。dvd-r から ubuntu 22.04.01 (サイズ超過で dvd-r におさまらなくて 22.04.02 は断念) のインストールを行う。bios で一時的に secure boot の機能を無効にしないと署名チェックで起動しなかった。インストール作業中に予期せぬ不具合が発生しました的なポップアップが2-3回発生したけど、無視して継続できた。インストールして普通に起動すればいいやと緩い感覚で進めた。いつもはパーティションも自分で設定したりしているけれど、今回は windows 領域を残してデュアルブートな環境にしてみた。ディスク領域もインストーラーから windows 領域を 160GiB、残りをすべて ubuntu 領域にするといった設定ができた。すごい簡単。余裕があるときに windows の wsl を使うのも試してみれればと思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0323/>デスクトップマシンの買い替え</a></h1><div class=post-meta><time class=post-date>2023-03-23 (Thu.) ::</time></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;</span><div class=post-content><p>1時に寝て5時に起きて7時に起きた。昨日も吐き気がしてうまく眠れなかった。</p><h2 id=dell-マシンの買い替え>dell マシンの買い替え</h2><p><a href=/diary/posts/2023/0123/#デスクトップマシンの調子が悪い>1月頃からデスクトップマシンの調子が悪かった</a> 。ちょうど3年経ったところでそろそろ故障してもおかしくないと言える。ちょうど年度末なので dell の半期に一度の大感謝祭を待って購入することにした。これまでは <a href=https://www.dell.com/ja-jp/shop/%E8%A3%BD%E5%93%81%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BA/sf/vostro-desktops>vostro</a> を使っていた。そろそろメモリが16GiBだと厳しくなってきたところ。メモリが32GiBついているデスクトップマシンは限られてくる。
その制約もあって <a href=https://www.dell.com/ja-jp/shop/%E8%A3%BD%E5%93%81%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BA/sf/xps-desktops>xps</a> マシンを購入をすることにした。</p><p>昨日のお昼過ぎに注文したのに翌日の午前中にマシンが届いた。あまりの早さに驚いた。dell の配送のワークフローの凄さを実感した。デスクトップマシンを注文して1週間ぐらいで来たらいいと普通の感覚で思っていたら翌日なんやもんな。24時間も経ってなかったしな。</p><p>グラフィックボードからモニタに接続しようとしたら4つのインターフェースのうち3つが displayport で1つが hdmi になっていた。いまどきは displayport が主流なんやね。そんなことすらも知らなくて変換アダプタ買わないととか思っていたら、モニターも displayport をもっていて、モニターの箱にも displayport ケーブルが同梱されていて、そのまま接続できることに気付いた。3年ぐらいでマシンを買い替えないとハードウェアのデバイスの変更にもついていけないのだなということも実感した。</p><p>私はもう世の中についていけてなくて、たまに普段やらないことをやるとそこで起きることに驚いて右往左往している。windows を起動して dell update から bios やファームウェアを最新のもの更新したりしていた。windows 上からダウンロードして設定して、再起動時に自動的に bios の更新がかかるような振る舞いをする。uefi のなせる技なんだろうけど、こういうところにも驚いて感心したりする。</p><p>ubuntu 22.04.02 が 4.8GiB あって dvd-r にぎりぎりおさまらない。もう dvd-r でもインストールメディアを作ることができなくなったんやなと気付く。22.04.01 は 3.6 GiB なので1つ前のバージョンをインストールしてアップグレードすればいいかとやってみたらブート時に次のようなエラーになった。</p><blockquote><p>Verification failed:(0x1A) Security Violation</p></blockquote><p>bios に secure boot 機能なるものがあって 22.04.01 ではインストールできないように署名チェックが行われるらしい。古いディストリビューションをインストールするには secure boot を一時的に無効にするしかなさそう。</p><ul><li><a href=https://askubuntu.com/questions/1456460/verification-failed-0x1a-security-violation-while-installing-ubuntu>https://askubuntu.com/questions/1456460/verification-failed-0x1a-security-violation-while-installing-ubuntu</a></li></ul></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0123/>人間の体調もマシンの調子も悪い</a></h1><div class=post-meta><time class=post-date>2023-01-23 (Mon.) ::</time></div><span class=post-tags>#<a href=/diary/tags/nginx/>nginx</a>&nbsp;
#<a href=/diary/tags/tls/>tls</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;</span><div class=post-content><p>1時に寝て7時に起きた。冬のせいか、朝起きるのが辛くなってきた。自身の体調がパッとしないと思っていたらマシンにも移ってしまった。</p><h2 id=デスクトップマシンの調子が悪い>デスクトップマシンの調子が悪い</h2><p>何の前触れもなく os がいきなりストールする。これまでも稀にあったり、サスペンドから復帰しないとかも1ヶ月に1回ぐらいはあったりしていたけど、今日は2時間以内に3回発生した。使い始めてちょうど3年を超えたところなのでそろそろ故障が出てきてもおかしくはない。もっとも疑わしいディスクの S.M.A.R.T チェックをやってみた。<a href=https://qiita.com/ken-yossy/items/ffecfd31d41d71f27dca#smart--health-information%E3%81%AE%E5%86%85%E5%AE%B9>SMART / Health Informationの内容</a> をみると、<em>Percentage Used</em> という値がメーカーが独自計算した耐久値を表しているとのころ。しかし、値は13%なのでまだまだ大丈夫そう。その他のエラーチェックなどでもまったく問題は検出されなかった。どうやらディスクではないみたい。</p><pre tabindex=0><code>=== START OF SMART DATA SECTION ===
SMART overall-health self-assessment test result: PASSED

SMART/Health Information (NVMe Log 0x02)
Critical Warning:                   0x00
Temperature:                        28 Celsius
Available Spare:                    100%
Available Spare Threshold:          50%
Percentage Used:                    13%
Data Units Read:                    48,536,210 [24.8 TB]
Data Units Written:                 57,978,947 [29.6 TB]
Host Read Commands:                 1,818,481,150
Host Write Commands:                1,973,810,058
Controller Busy Time:               9,182
Power Cycles:                       1,863
Power On Hours:                     4,576
Unsafe Shutdowns:                   80
Media and Data Integrity Errors:    0
Error Information Log Entries:      0
Warning  Comp. Temperature Time:    0
Critical Comp. Temperature Time:    0
Temperature Sensor 1:               28 Celsius
Thermal Temp. 1 Transition Count:   90
Thermal Temp. 2 Transition Count:   50
Thermal Temp. 1 Total Time:         2246
Thermal Temp. 2 Total Time:         50
</code></pre><h2 id=nginx-の-multi-upstream-対応>nginx の multi upstream 対応</h2><p><a href=/diary/posts/2023/0120/#sveltekit-アプリのデプロイ>先週末の続き</a> 。docker compose でデプロイして node.js 上のポートに http 接続できるところまでやっていた。nginx のリバースプロキシ経由でアクセスできるようにする。web api も外部から https 接続できるようにすると2つの upstream が必要になる。ホスト名を dns 登録していないから同じ ip アドレスでアクセスしているため、ポート番号を変えないといけない。そのまま server 設定を行うと location 設定が dry の原則に反してしまう。どうやったら再利用できるかを調べたら conf として外部に出してしまって include すればいいとあったので次のようにして再利用できた。これで node.js アプリは 443 を、web api は 8443 で https 接続できた。</p><pre tabindex=0><code>http {

    upstream my-app {
        server app:3000;
    }

    upstream web-api {
        server api:18080;
    }

    server {
        listen 443 ssl;
        server_name server-app;
        location / {
            include     /etc/nginx/common_proxy.conf;
            proxy_pass  http://my-app;
        }
    }

    server {
        listen 8443 ssl;
        server_name server-api;
        location / {
            include     /etc/nginx/common_proxy.conf;
            proxy_pass  http://web-api;
        }
    }
}
</code></pre></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0101/>ジャンプスターター使ってみた</a></h1><div class=post-meta><time class=post-date>2023-01-01 (Sun.) ::</time></div><span class=post-tags>#<a href=/diary/tags/hugo/>hugo</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/day-off/>day off</a>&nbsp;</span><div class=post-content><p>1時に寝て7時半に起きた。なんともなく新年あけた。朝ご飯食べて孤独のグルメをみながら宅急便が届くのを待った。</p><h2 id=hugo-のスタイル修正>hugo のスタイル修正</h2><p>日付に曜日を付けるように変更した。タグから過去の日記をみたときに曜日があると役に立つときがたまにある。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;span</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;post-date&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  {{ .Date.Format &#34;2006-01-02 (Mon.)&#34; }}
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/span&gt;</span>
</span></span></code></pre></div><p>テーマの <a href=https://github.com/panr/hugo-theme-terminal>terminal</a> のバージョンをあげたらビルドに失敗するようになった。<code>extended</code> をインストールしないと scss/sass 周りのビルドに失敗するらしい。github actions の hugo セットアップの設定も変更した。</p><ul><li><a href=https://gohugo.io/troubleshooting/faq/#i-get-this-feature-is-not-available-in-your-current-hugo-version>https://gohugo.io/troubleshooting/faq/#i-get-this-feature-is-not-available-in-your-current-hugo-version</a></li></ul><h2 id=ジャンプスターター>ジャンプスターター</h2><p>年末に注文したジャンプスターターが届いた。実家の軽トラのバッテリーがあがってしまいエンジンをかけられないという。いつもはディーラーさんに来てもらってバッテリー交換なり他の車と接続してエンジンをかけるなりをやってもらっていた。たまたまテレビをみていたら雪国での役立つツールとしてジャンプスターターと呼ばれるものがあることを知った。スマートデバイスなどの予備バッテリーの形状で車のバッテリーに接続してエンジンをかけられるらしい。さっそく amazon で検索してベストセラーのタグがついている「PHILIPS フィリップス ジャンプスターター 12000mAh大容量 ピーク電流800A 12V車用 エンジンスターター」を購入した。うちの軽トラでも試してみたら問題なくエンジンが始動した。車のバッテリーが弱っている場合、boost ボタンを押してブーストモードで接続しないといけないようだ。boost ボタンを押すのがわかって接続・設定したらエンジンがすぐに始動した。うちみたいな小さい兼業農家でたまに軽トラを使うといった家でも携帯バッテリーは充電がすぐできて、保管も場所取らずでとても便利。これはよい買いものだと思えた。</p><p><a href="https://www.amazon.co.jp/gp/product/B091Y9Y22G?ie=UTF8&psc=1&linkCode=li2&tag=t2y-diary-22&linkId=b31c3d97937c844d911bb79486599b0c&language=ja_JP&ref_=as_li_ss_il" target=_blank><img border=0 src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B091Y9Y22G&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=t2y-diary-22&language=ja_JP"></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=t2y-diary-22&language=ja_JP&l=li2&o=9&a=B091Y9Y22G" width=1 height=1 border=0 alt style=border:none!important;margin:0!important></p><h2 id=温泉>温泉</h2><p>実家近くの <a href=http://awajiinfo.com/uzusio-onsen/>うずしお温泉</a> を提供している <a href=https://xn--y8jwbo3jva.com/>ゆとりっく</a> に行く。私にとっては銭湯へ行く感覚で実家に帰ったとき1回は行く。いつも通り温泉に浸かってそれから三ノ宮へ戻ることにした。</p></div></article><div class=pagination><div class=pagination__buttons><a href=/diary/tags/device/page/2/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>