<!doctype html><html lang=en><head><title>Posts :: forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/posts/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="Posts"><meta property="og:description" content><meta property="og:url" content="/diary/posts/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/posts/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1111/>ポッキーの日</a></h1><div class=post-meta><time class=post-date>2023-11-11 (Sat.) ::</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/investing/>investing</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;</span><div class=post-content><p>なんか深夜にお腹空いて2時から冷凍食品の横綱ラーメン作って食べた。深夜に食べるラーメンはおいしかった。それから寝て6時に起きて8時に起きた。</p><h2 id=ストレッチ>ストレッチ</h2><p>先週は筋肉痛で大変な状態だったが、今週は十分に休養して元に戻った。今日の開脚幅は開始前156cmで、ストレッチ後157cmだった。いつも通り。とくにどこかの部位が極端に疲労したり張りがあったりする感じはなかったが、左ふとももの後ろと左腰がやや張りが強かったように感じた。私のお気に入りのストレッチの部位としてふとももの後ろの筋を伸ばすのが痛気持ちいい。これは自分では伸ばせない筋なのでトレーナーさんにお願いしないといけない。張りがあっても痛気持ちよい。トレーナーさんと話していて今日が「ポッキーの日」だと教えてもらった。スーパーのクーポンでポッキーお奨めされているなと思っていたけど、そういうことだったのか。</p><h2 id=イオン-オーナーズカード>イオン オーナーズカード</h2><p><a href=https://www.aeon.info/ir/stock/benefit/>イオンの株主優待制度</a> としてオーナーズカードがある。イオン系列のスーパーなどで買いものしたときに半年後にキャッシュバックを受けられる。持ち株数に応じて 3, 4, 5, 7% のキャッシュバックになる。<a href=/diary/tags/sightseeing/>6月末に四国旅行</a> へ行ったときに同室に泊まった方と話していて、イオンのオーナーズカードがお得だよと教えてもらった。私が普段買いものしているスーパーは3つある。</p><ul><li><a href=https://www.kohyo.co.jp/>KOHYO</a></li><li><a href=https://www.hankyu-oasis.com/>阪急オアシス</a></li><li><a href=http://www.lifecorp.jp/>ライフ</a></li></ul><p>このうち、もっともよく行くスーパーが KOHYO である。その理由はもっとも家から近いから。KOHYO はイオン系列になる。オーナーズカードをもつとお得になることに気付いてイオンの株を購入してみた。8月末と2月末の年2回、権利確定が行われる。私の場合、8月末に権利確定され、いろいろ手続きをして、オーナーズカードが10月末に届いた。</p><p>カードを持ち運ぶのは面倒なので調べてみると <a href=https://www.aeon.com/aeonapp/>iAEON アプリ</a> でオーナーズカードを連携すれば代用できることに気付いた。iAEON アプリの会員証にオーナーズカードを連携できる。スーパーで買いものするときにスマホでオーナーズカードの認証ができる。このアプリでオーナーズカードを連携するには waon ポイントカードが必要にある。これも名前がおかしいのだけど、カードを作るという手続きをするが、物理カードを作らなくてもよくて、アプリ上で waon ポイントを管理できる。</p><p>waon とはイオンが提供している電子マネーのことで waon で書いものしたときに貯まるポイントが waon ポイントである。しかし、オーナーズカードで購入しても waon ポイントを貯めることができる、現金で支払ったとしても。これも名前が混乱してしまうが waon ポイントは waon 以外の決済でもポイントが貯まるのである。waon とは別に <a href=https://aeon.co.jp/service/lp/aeonpay/>AEON Pay</a> もある。iAEON アプリ上で AEON Pay が使える。AEON Pay は paypay のようなバーコード決済で、イオンカード以外にも銀行口座からもチャージできる。paypay 銀行は選択できなかったが、都市銀行や地方銀行などを選択して銀行口座から直接チャージできた。AEON Pay には waon ポイントを貯めるという仕組みはなく、AEON Pay の支払いをイオンカードにすることでイオンカードの利用によって waon ポイントが還元されるという仕組みになるため、銀行口座からチャージすると本来は waon ポイントが貯まらない。しかし、オーナーズカードの支払いは waon ポイントが貯まるので、オーナーズカードの認証をした上で AEON Pay をする分には waon ポイントが貯まっているようだ。</p><p>たまたま iAEON アプリで近所の KOHYO を登録すると、その店舗で使えるクーポンが発行されていることに気付く。なぜかクーポンを選択という手作業の登録をする必要がある。クーポンは商品ごとにたくさんあって、1つずつ選択して登録するのが面倒なので「一括選択」というボタンがある。このボタンをタップするとすべてのクーポンが選択済みになって登録される。いま選択済みのクーポンが46個ある。この次は「一括選択」をタップしなくても自動的にクーポンを選択済みの状態にしてほしい。クーポンを選択済みの状態で iAEON アプリで会員証の認証をしてから決済をするとクーポンが適用されて割引を受けられる。クーポンには何度も使える装備タイプと1回使うとなくなる道具タイプがある。そして、KOHYO のクーポンに何度でも使える全品3%引きの装備タイプのクーポンがある。さらに土曜日はそれが5%引きクーポンにクラスチェンジする。つまり、土曜日に KOHYO で買いものすれば、オーナーズカードで3%キャッシュバック、装備タイプのクーポンで5%引き、その上で waon ポイントがつくという、おそらく一番よい装備が整ったという雰囲気だ。</p><p>試しにポッキーのクーポンを使ってみようと、夜にスーパーへ行ったらすべて売り切れていた。仕方なく同じクーポンが適用されるプリッツを買ってきた。トマトプリッツ118円が、5%割引で112円になって、さらに別クーポンのバフがかかって10円引きで102円になる。この時点で 102/118 ≒ 86% なので14%引きになっている。さらにオーナーズカードで3%キャッシュバックになるので17%引きになる。なるほど、物価の上昇を吹き飛ばすような効果がありそうだ。</p><p>今週はここまでの設定をするのにいろいろ調べていた。waon なにそれ？みたいな人間がアプリダウンロードして、アカウント作ったり、waon ポイントカードを作ったり、オーナーズカードを連携したり、あれこれやって理解できた。</p><h2 id=ふるさと納税>ふるさと納税</h2><p>いつも年末に購入している。このぐらいの時期になると急に思い出して、思い出したときに購入しないと忘れてしまうので一気に買いものした。私は2019年から毎年ふるさと納税をしている。いつも食べものをいくつか、工芸品を1つぐらい選択している。気に入るものがなかったら食べものしか買わないときもある。とくに深い意図はなくて、適当に検索して今年は次の4つに決めた。</p><ul><li><a href="https://www.satofull.jp/products/detail.php?product_id=3163482">[北海道清水町] 十勝スロウフード 牛とろ丼セット</a></li><li><a href="https://www.satofull.jp/products/detail.php?product_id=1368233">[長崎県壱岐市]クラフトビール 6本詰め合わせ(3種類×2本)</a></li><li><a href="https://www.satofull.jp/products/detail.php?product_id=1320793">[大阪府泉佐野市]コンパクトバスタオル6枚&lt;シックグレー> 速乾中厚の泉州タオル 010B962</a></li><li><a href="https://www.satofull.jp/products/detail.php?product_id=1053132">[滋賀県甲賀市]信楽焼・明山のとなりのトトロ totoro-01</a></li></ul><p>普通にサラリーマンとして働いている人はふるさと納税のメリットがある。寄付金控除の限度額まで、実質2,000円で好きな返礼品をもらうことができる。私は毎年確定申告をしているのでワンストップ特例制度を利用する必要もなく、手続き上の手間暇もほぼないと言っていい。ふるさと納税の問題点としては次のようなことが指摘されている。</p><ul><li>(一般的に) 都市から地方へ税金が流出するので都市の自治体の税収が減る</li><li>収入の高い人ほど寄付金控除の限度額が高いために得をする傾向がある</li><li>寄付金 (税金) の3割以下 (返戻率と呼ぶ) のお金が本来の使途ではなく返礼品として流出する</li></ul><p>問題や懸念があることは私も知っているが、私のような人間は、こういう機会がないと本来使わないお金を使っていたりするので購買意欲を換気するという側面もある。どのみち、都市に住む人が納めた税金を地方交付税という形で国が地方自治体へ分配している。ふるさと納税が地方交付税の割合に影響を与えているかどうかは知らないが、都市に住む人が納めた税金が地方へ分配されるのはそう変わらないのではないかと思ったりもする。都市に住んでいる人の大半は地方出身者であり、私もそうだが、地方出身者が都市で働いて税金を納めることで都市を支えているとみなすこともできる。都市も地方から働きに来てもらわないと都市を維持できなない。地方と都市は共依存の関係でもある。そして、返礼品を購入してもそのお金は地方の地元企業の経済活動に使われる。それ自体に問題があるわけでもないのではないか。本来の税金の使途が返礼品という、どちらかと言えば、嗜好品に使われているのがやや懸念ではあるが、地方の経済をまわすことに役立っていれば、それはそれで別の意義も出てくるのではないかと思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1110/>資産運用の新たなツール</a></h1><div class=post-meta><time class=post-date>2023-11-10 (Fri.) ::</time></div><span class=post-tags>#<a href=/diary/tags/investing/>investing</a>&nbsp;
#<a href=/diary/tags/finance/>finance</a>&nbsp;
#<a href=/diary/tags/failure/>failure</a>&nbsp;</span><div class=post-content><p>3時に寝て6時半に起きた。晩ごはん食べて、夜の作業して、寝る前に paypay 証券の積立の仕組みを調べて設定したりしていた。昨日あまり寝ていなかったせいか、今日は17時でお仕事を終えて、帰ってきて晩ごはんを食べて、すぐ1-2時間寝落ちした。あまりこういう居眠りは少ない。21時過ぎに起きてまたオフィスへ戻って作業していた。</p><h2 id=決算後の評価>決算後の評価</h2><p><a href=/diary/posts/2023/1109/#ソフトバンクグループ-第2四半期-決算>昨日の続き</a> 。おそらくネガティブな評価になるだろうという予測通り、寄り付きの価格は大きく下落して場中もどんどん下がって次のような結果になった。</p><table><thead><tr><th style=text-align:center>日付</th><th style=text-align:right>始値</th><th style=text-align:right>高値</th><th style=text-align:right>安値</th><th style=text-align:right>終値</th><th style=text-align:right>出来高</th><th style=text-align:right>調整後終値</th></tr></thead><tbody><tr><td style=text-align:center>2023-11-09</td><td style=text-align:right>6,152</td><td style=text-align:right>6,333</td><td style=text-align:right>6,098</td><td style=text-align:right>6,305</td><td style=text-align:right>7,250,900</td><td style=text-align:right>6,305</td></tr><tr><td style=text-align:center>2023-11-10</td><td style=text-align:right>6,000</td><td style=text-align:right>6,016</td><td style=text-align:right>5,721</td><td style=text-align:right>5,790</td><td style=text-align:right>27,804,300</td><td style=text-align:right>5,790</td></tr></tbody></table><p>寄り付きの成り行き、指値、前場引け、後場引けと段階的に空売りの返済が進んで1日で約 77% を返済した。今月中には完済してしまおうとは考えているものの、今日1日で思ったより捌けたのは予想以上にザラ場でも価格が落ちていったから。十分な収益にはなったので来週中には適当なタイミングで完済してしまう。</p><h1 id=paypay-証券のつみたて>paypay 証券の「つみたて」</h1><p>口座を開設していたものの、ずっと放置していた paypay 証券のアプリを久しぶりにたまたま開いてみた。だいぶアプリも改善されたようで機能が増えているようにみえる。適当に触っていて、投信や外国株の購入オプションに「つみたて」があることに気付いた。定期的に決められた金額を購入できる。paypay 証券のよいところは最低1,000円から購入できるところ。これなら財形貯蓄のような用途に使える。</p><ul><li><a href=https://www.paypay-sec.co.jp/news/20230403_2.html>PayPay証券アプリに機能追加！ 〜米国株式つみたてができる！さらに見やすく・使いやすく！～</a></li></ul><p>私は2016年ぐらいから株式投資を始め、もう5年以上は継続している。そのぐらいやって気付いたことはたった1つで、私には投資運用のスキルもなく、そのモチベーションも高くない。資産運用の効率を考慮して貯金に懸念があるから株式投資をしているに過ぎない。あとは経営の勉強の延長で投資や経済の先行きを自分なりに組み立てて予想したりするのにも応用している。それはともかく、これまであまりうまく投資運用してこれなかった経験から、私にとっての株式投資の最適解は <a href=https://ja.wikipedia.org/wiki/%E3%83%89%E3%83%AB%E3%83%BB%E3%82%B3%E3%82%B9%E3%83%88%E5%B9%B3%E5%9D%87%E6%B3%95>ドル・コスト平均法</a> になる。中二病の1つだと思うが、自分ならもっとうまく資産運用できると思ってあれこれやった結果、普遍的なドル・コスト平均法の凄さを理解しただけだった。一番よくない投資は一度に大きなお金を動かすことだと思う。一方で、自分の好きな会社に投資したいという思いはあって paypay 証券のような、会社を指定して「つみたて」というドル・コスト平均法のようなオプションはもっとも望ましいとずっと考えていて、これまで手動でやっていた方法だった。</p><p>試しに毎週1,000円ずつ購入する「つみたて」をいくつか設定してみた。どうやら外国株もすべてが選択できるわけではなさそう。アトラシアンやアームは検索結果に出てこなかった。</p><ul><li>ファイザー</li><li>クラウドフレア</li><li>アマゾン・ドットコム</li></ul><p>あと投信も1つぐらい設定しておこうと思って、これも同じように「つみたて」してみた。</p><ul><li>ひふみプラス</li></ul><p>とりあえず1,000円から始めて、世の中の状況をみながら期間や金額を調整するぐらいの、その程度のカスタマイズで十分。いままでも証券会社のアプリケーションでそういったことができたのかどうか、私はよく知らないけど、スマホアプリだと、ちゃちゃっと触って操作できるのでお手軽でよい。自分が詳しくないものを扱うのはスマホアプリが便利でよい。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1109/>儲かっていない会社に中間申告はない</a></h1><div class=post-meta><time class=post-date>2023-11-09 (Thu.) ::</time></div><span class=post-tags>#<a href=/diary/tags/management/>management</a>&nbsp;
#<a href=/diary/tags/investing/>investing</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;</span><div class=post-content><p>0時に寝て何度か起きて7時過ぎに起きた。髭を剃っていて唇を切った。</p><h2 id=ソフトバンクグループ-第2四半期-決算>ソフトバンクグループ 第2四半期 決算</h2><p>孫さんが決算発表の場に出てこなくなってまったく関心がなくなっている。ここ数ヶ月ほどタイミングを見計らって少しずつ空売りしてきた。ちょうど年の暮れだしこのタイミングで空売りの返済をしてしまおうと考えている。昨今の雰囲気からまだまだ投資の時期ではなく、なんとなくソフトバンクグループの決算は悪いのだろうと予測していた。虎の子の ARM も上場してしまって他に材料もないだろうと。</p><ul><li><a href=https://group.softbank/event/earnings_2023q2>ソフトバンクグループ 2024年3月期 第2四半期 決算</a></li></ul><p>とくにみるつもりはなかったけれど、作業しながら CFO の説明を聞いていて、「守り」がうんたら、財務が健全だと何度か話していることに気付いた。周りから財務を不安視されて懸念を持たれていることの裏返しように聞こえた。普通、投資会社なら投資の成果をもっとアピールすればいいと思えるが、財務の健全性をアピールするというのがおもしろおかしく聞こえた。arm が上場したにも関わらず、現在の株価と <a href=https://group.softbank/ir/stock/sotp>1株当たりNAV情報</a> の差も前回の決算時よりも開いてしまったと説明していた気がする。それが市場の答えにも思えた。</p><p>おそらく明日の寄り付きの価格は下がると推測するけれど、明日はマイナー SQ だし、この決算でどのぐらい下がるのか、やや楽しみ。11月中には空売りを返済してしまうつもり。</p><h2 id=中間申告>中間申告</h2><p>前期は黒字決算だったので自動的に中間申告が必要なのだと思い込んでいた。しかし、例年ならすでに納税のための通知やデータが届いているはずが一向に来ない。</p><p>昨日、消費税の中間申告の通知が届いた。2年前から消費税を支払っているはずだけど、昨年は中間申告の通知が来てないような？まぁいいや。e-tax のメッセージボックスには中間申告のデータも届いていて、それを使って申告書を作成して pay-easy でそのまま納付した。作業時間は15分といったところ。中間申告はめっちゃ簡単。</p><p>本題の法人税などの中間申告の通知が来ないので厳密な中間申告の条件について調べてみた。</p><blockquote><p>中間申告が必要なのは、前事業年度の法人税額が20万円を超える場合です。中間申告が必要となったとき、その提出期限と税金の納期限は、事業年度開始後6月を経過した日から2月以内です。なお、法人税の中間申告の対象となる人は、地方税（都道府県税、市町村民税、事業税等）についての申告も必要です。</p><p><a href=https://keiriplus.jp/tips/houjinzei_cyukansinkoku/>法人税の中間申告とは？目的や申告方法を基礎から解説！ | 経理・会計業務を効率化「経理プラス」</a></p></blockquote><p>法人税が20万円を超えないと中間申告は不要だという。前期の法人税を調べたら 187,800 円だった。これで法人税と地方法人税の中間申告は不要であることがわかった。</p><blockquote><p>また、事業年度が6カ月を超える法人で法人税の中間申告義務のある法人は、その事業年度開始の日から6カ月を経過した日から2カ月以内に原則として前事業年度の税額の半分の額を予定（中間）申告して納めます。</p><p><a href=https://web.pref.hyogo.lg.jp/kk22/pa04_000000008.html>法人県民税・事業税、特別法人事業税・地方法人特別税</a></p></blockquote><p>次に法人県民税も「法人税の中間申告義務のある法人」とあるので法人税の判定基準と同じになる。</p><blockquote><p>予定申告は、法人税において前事業年度の確定法人税額に前事業年度の月数で除し6を乗じて計算した金額が10万円以下の場合はその年度の申告の必要はありません。</p><p><a href=https://www.city.kobe.lg.jp/a35984/kurashi/tax/houjin/200.html#unker6>神戸市：法人市民税に関するQ&A</a></p></blockquote><p>実際に計算してみると、187,800 / 12 * 6 = 93,900 円となって10万円以下なので中間申告は必要ないとのこと。</p><p>要約すると、あまり納税していない会社は中間申告しなくてよいってことだと理解できた。前期は iphone 14 pro, m2 macbook, 社用車、デスクトップマシンといろいろお金を使ったので納税額が少なかったみたい。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1108/>rbac なロールでの動的な権限チェック</a></h1><div class=post-meta><time class=post-date>2023-11-08 (Wed.) ::</time></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/design/>design</a>&nbsp;
#<a href=/diary/tags/auth/>auth</a>&nbsp;</span><div class=post-content><p>23時に寝て何度か起きて7時に起きた。夜に作業するつもりが、<a href=http://miabyss.com/>メイドインアビス</a> を見ながら寝落ちした。</p><h2 id=ldap-で認証したユーザーの権限管理>ldap で認証したユーザーの権限管理</h2><p><a href=/diary/posts/2023/1026/>rbac なロール管理</a> の仕組みを api サーバーに実装した。初期実装したときは静的にリソース (url) に対して acl から権限が許可されているかどうかのみをチェックするだけでよかった。ldap で認証したユーザーは自分の情報は更新できるが、他人の情報は更新できないといったリクエスト単位に権限が許可されているかどうかをミドルウェアで判別したい。いわば、リクエスト時に動的にリソースの情報をチェックしないといけない。</p><p>いくつか試行錯誤して、あーでもないこーどもないとやった結果、次のように落ち着いた。</p><ul><li>リソースは動的な権限チェックのために AuthorizeFunc を取得するための AuthorizeKey をもつ</li><li>AuthorizeFunc は Context から取得する</li><li>AuthorizeFunc が true を返す場合は権限を付与する</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Role</span>) <span style=color:#a6e22e>CanAccess</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>resourceName</span>, <span style=color:#a6e22e>target</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>ac</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>ACL</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>ac</span>.<span style=color:#a6e22e>Resource</span>.<span style=color:#a6e22e>Match</span>(<span style=color:#a6e22e>resourceName</span>) {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>perm</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>ac</span>.<span style=color:#a6e22e>Permissions</span> {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>perm</span>.<span style=color:#a6e22e>IsGranted</span>(<span style=color:#a6e22e>target</span>) {
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>authorize</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Value</span>(<span style=color:#a6e22e>ac</span>.<span style=color:#a6e22e>Resource</span>.<span style=color:#a6e22e>Key</span>).(<span style=color:#a6e22e>AuthorizeFunc</span>); <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>authorize</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>resourceName</span>, <span style=color:#a6e22e>target</span>) {
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ロールに渡す Context にはあらかじめ、AuthorizeKey と AuthorizeFunc を登録しておく。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>ctx</span> = <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithValue</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>role</span>.<span style=color:#a6e22e>LDAPResource</span>, <span style=color:#a6e22e>role</span>.<span style=color:#a6e22e>IsLDAPResourceOwner</span>)
</span></span></code></pre></div><p>リソースを生成するときに AuthorizeKey をセットしておく。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>ldapUserResource</span> = <span style=color:#a6e22e>rbac</span>.<span style=color:#a6e22e>NewResource</span>(
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;ldap-user-specific-operation&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;(/api/ldap/entry|/api/ldap/entry/.*)&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>LDAPResource</span>,
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>ちょっと設定は煩雑になるが、ひとまずこれで要件を満たせた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1107/>葛藤も逡巡もしない</a></h1><div class=post-meta><time class=post-date>2023-11-07 (Tue.) ::</time></div><span class=post-tags>#<a href=/diary/tags/animation/>animation</a>&nbsp;
#<a href=/diary/tags/psychology/>psychology</a>&nbsp;</span><div class=post-content><p>2時に寝て4時に起きて6時に起きて7時半に起きた。意味なくあまりよく眠れなかった。自分の pr のレビュー待ちやリファクタリングと他人のデザインレビュー／コードレビューなど、いろいろ雑多なことをやって隙間の1日になった。</p><h2 id=メイドインアビス-烈日の黄金郷>メイドインアビス 烈日の黄金郷</h2><p>ちょっと時期は遅れていると思うけど、<a href=http://miabyss.com/index.html>メイドインアビス</a> の新しい作品が配信されているのに気付いた。晩ごはんを食べてから見始めたらおもしろくて、夜に別作業をするつもりが寝落ちするまで見続けてしまった。</p><p><a href=http://miabyss.com/movie/>劇場版「メイドインアビス」-深き魂の黎明-</a> も何度もみた。好きな作品の1つだ。敵としてボンボルドというキャラクターが出てくるが、ボンボルドの在り方は一概に悪とか非道とか、サイコパスと断じられるものでもなく、なにか強い印象に残っていた。</p><p>今回の「烈日の黄金郷」においても敵でないが、ワズキャンというリーダーキャラクターが出てくる。メイドインアビスは、その世界観として死が身近な状況における強いリーダーシップを描いているようにみえる。それが世界観のせいなのか、作者の独特の感性なのか、その両方なのかはわからないが、とても特異なリーダーシップにみえてしまう。現代の生活や価値観から言えばサイコパスのようにみえるが、作品の世界観から言えば、強いリーダーシップと解釈できる。そのリーダーの選択、決断、思考、信念、潔さのどれもが淡々としたストーリーの展開をミステリアスなものにしている。</p><p>なぜか私はこの作品のちょっと特異なリーダーに共感するところがあっておもしろくみることができる。共感するところの1つに、メイドインアビスに出てくるリーダーは葛藤や逡巡をしない。括弧とした信念があるから仲間を犠牲にしても自責しない。それがある種の潔さや偽善を感じない爽快さにつながっていて私の価値観にあっているように思える。そう、失敗しても潔いのが私は好きなのだ。誰かの責任にもしないし、その結果で自暴自棄になったりもしない。なにが起きてもそれは自分の人生で受け入れていくしかない。メイドインアビスに出てくるリーダー像はまさにそれを体現しているように思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1106/>考えないという傷のある現場</a></h1><div class=post-meta><time class=post-date>2023-11-06 (Mon.) ::</time></div><span class=post-tags>#<a href=/diary/tags/ldap/>ldap</a>&nbsp;
#<a href=/diary/tags/communication/>communication</a>&nbsp;
#<a href=/diary/tags/team-building/>team building</a>&nbsp;</span><div class=post-content><p>2時に寝て7時半に起きた。昨日からよく寝た。また心機一転。</p><h2 id=ldap-エントリーの-crud-api>ldap エントリーの crud api</h2><p>先週から ldap クライアントや <a href=/diary/posts/2023/1102/#コネクションを共有しないプール>そのプール</a> を実装して結合テストも一通り書いていた。今日はそれらを使った crud な web api を一通り実装した。クライアント実装もテストもしっかり出来ているので後は時間の問題で1つずつ確認しながらコードを書いていくだけだった。こういう作業になると、まとまった時間があればすぐに終わる。他のメンバーのコードレビューをみたり、設計の話しをしたり、他に意識を取られてあまり自分の作業に集中できなかった。</p><h2 id=言葉が通じないもどかしさ>言葉が通じないもどかしさ</h2><p>先週「参考にして」と指示したものが「全コピー」で驚いてしまった。私がいくつか指摘したらすぐに削除し始めてさらに落胆した。自分の頭で考えて作業していないようにみえる。</p><p>開発というお仕事は自分で考えて、コードの1つ1つに明確な意図や根拠をもって書くものだ。もちろん、情報不足や設計に自信がもてなくて一時的に曖昧な実装にするときもあるけれど、それは懸念事項として把握しておくことで将来対応すればよい。基本的に追加するコードにはすべて意味がある。</p><p>他人が分からなくても自分が理解できているのなら、自分の考えを説明し、それが論理的であったり筋が通っていれば、私は自分の考えと違っていても構わない。説明できないコードを追加して、ツッコミを受けてなにも説明できない状況をみているのは本当に悲しい。</p><p>山田ズーニーさんの著書に書いてあった「考えないという傷」を思い出した。</p><ul><li><a href=https://www.1101.com/essay/2010-03-17.html>「働きたくない」というあなたへ ７</a></li></ul></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1105/>秋休み3</a></h1><div class=post-meta><time class=post-date>2023-11-05 (Sun.) ::</time></div><span class=post-tags>#<a href=/diary/tags/day-off/>day off</a>&nbsp;</span><div class=post-content><p>2時に寝て何度か起きて8時に起きた。休むつもりはなかったのだけれども、お昼までゆっくりしていたら、今日はもういっかと思ってそのままお休みすることにした。疲れていたのかもしれない。1日のんびりしていた。</p></div></article><div class=pagination><div class=pagination__buttons><a href=/diary/posts/page/7/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span></a>
<a href=/diary/posts/page/9/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>