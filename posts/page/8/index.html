<!doctype html><html lang=en><head><title>Posts :: </title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/posts/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="Posts"><meta property="og:description" content><meta property="og:url" content="/diary/posts/"><meta property="og:site_name" content><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/posts/index.xml rel=alternate type=application/rss+xml title></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0104/>年始は事務手続きからぼちぼち</a></h1><div class=post-meta><time class=post-date>2024-01-04 (Thu.) ::</time></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/eltax/>eltax</a>&nbsp;</span><div class=post-content><p>0時に寝て何度か起きて7時過ぎに起きた。午前中はだらだらして午後からオフィスに出て会計や税務の財務の事務手続きをまとめてやっていた。</p><p>今日の筋トレは腹筋:10x1,腕立て:10x1,スクワット10x2をした。昨日さぼったから罪悪感が出て今日はちゃんとやろうと思った。</p><h2 id=給与支払報告書の申告>給与支払報告書の申告</h2><p><a href=/diary/posts/2023/1229/#年末の事務手続き>年末に作成済みの書類データ</a> を送信した。</p><p>給与支払報告書は神戸市へ、ほとんど同じ内容の法定調書合計表と源泉徴収票を税務署へ提出する。eltax のアカウントに e-tax のアカウントも紐付けることで、給与支払報告書の送信時に e-tax へ法定調書合計表と源泉徴収票のデータも送信してくれる。本来は2つ行う必要がある書類の作成／データ送信の作業が1つに軽減されるのでこれは便利な仕組みだと思う。</p><p>うちは社員1人なので手入力で書類を新規作成している。それ自体は簡単なのだけど、年に1回しかやらない作業なので書類のどこにどの値を入力するか、毎回忘れて過去の issue をみながら作業することになる。</p><h2 id=償却資産-固定資産税-の申告>償却資産 (固定資産税) の申告</h2><p>会計システムの固定資産台帳だけを眺めていると、基本的には30万円以内の機器を購入して次の特例を使って一括損金算入するので減価償却中の固定資産はないようにみえる。</p><ul><li><a href=https://www.nta.go.jp/taxes/shiraberu/taxanswer/hojin/5408.htm>No.5408 中小企業者等の少額減価償却資産の取得価額の損金算入の特例</a></li></ul><p>しかし、この特例は国税 (法人税と地方法人税) の減税のための制度であって、地方税である固定資産税とは無関係になる。だから固定資産台帳にある取得価額を資産が増加したら申告データに含めて登録する必要がある。課税標準額が150万円未満であれば、固定資産税そのものは課税されないが、申告そのものは必要になる。私も起業してから2年目のときにはらさんと話していて国税と地方税の違いによるこの誤解に気付いた。この申告も年に1回しかやらないので書類のフォーマットを思い出して理解するのにいつもまごまごする。</p><p>オンラインで調べると、課税標準額は先方で自動算出されるように書いてあったりするので eltax のアプリ内で算出してくれたらよいようにも思うのだけど、アプリ上ではとくに算出されない。もしかしたら取得価額の合計が150万円未満ならそもそも非課税になるので計算しないといった仕様なのかもしれないし、課税標準額も定額法や定率法のなにで算出するかで変わってくるから一概に算出できないのかもしれない。謎い。</p><h2 id=源泉所得税の納付>源泉所得税の納付</h2><p>半期に1回の源泉所得税の納付。これは手慣れたもので15分あれば申請と納付と会計システムに取引明細の登録までできる。</p><ul><li><a href=https://www.nta.go.jp/taxes/shiraberu/taxanswer/gensen/2505.htm>No.2505 源泉所得税及び復興特別所得税の納付期限と納期の特例</a></li></ul><h2 id=小規模企業共済オンライン手続きポータルのログイン確認>小規模企業共済オンライン手続きポータルのログイン確認</h2><p>以前 <a href=/diary/posts/2023/1127/#小規模企業共済オンライン手続きポータル>アカウント申請して</a> 翌日には本登録されていたものの、その後、ログインしていなかった気がしたのでついでに調べてみた。</p><p>ログインしたら <a href=https://e-shishobako.ne.jp/resources/pages/esapos8030.html>e-私書箱</a> と連携しろと言われ、そのシステムと連携したら今度は e-私書箱と <a href=https://myna.go.jp/>マイナポータル</a> を連携しろと言われて、3つのシステムを連携した。開発者の私でもこれは？？？になってしまう。私はシステム側の都合があることを理解できるが、こんな一方的な複数のシステム間連携を一般ユーザーは理解できるのかな？とか疑問に思いつつ、ひとまず連携設定はしておいた。マイナンバーカードで何度もパスワード入力さえすればすぐに連携できる。</p><p>小規模企業共済オンライン手続きポータルにおいても年間の納付データや証明書を取得できた。そして連携しているe-私書箱でも確認できるようになっていて、おそらくこの状態ならマイナポータルにも連携されるのだろうと推測する。私の場合、確定申告は freee で書類作成してやるからマイナポータルから確定申告をまとめてやることはないけれど、いずれ移行する可能性はあるのでシステム間連携は徐々に進めて仕組みなども理解していこうとは思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0103/>冬休み1</a></h1><div class=post-meta><time class=post-date>2024-01-03 (Wed.) ::</time></div><span class=post-tags>#<a href=/diary/tags/day-off/>day off</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;</span><div class=post-content><p>離れで0時に寝て3時半に起きて5時半に起きて8時前に起きた。起きたときの室温が5℃ぐらい。農業倉庫のせいか、部屋の保温性はほぼない。エアコンを入れないと室温と外気温はほぼ同じように感じた。普通に布団と毛布で寝る分にはエアコンなしでも問題はないが、外気温が一桁だとエアコンなしで作業するのは厳しい。</p><p>今日の筋トレは腹筋:10x1のみだった。ちょっとさぼった。</p><h2 id=戻神戸>戻神戸</h2><p>お昼から雨降りという予報だったので朝ご飯を食べてからお昼前には神戸に戻ってきた。とくに予定もなかったので午後からオフィスで作業しようかと思っていたものの、帰ってきて一息ついて、いつの間にか昼寝していて、そのままだらだらしていた。まぁいっかと思ってお休みしていた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0102/>MBTI 性格診断とか</a></h1><div class=post-meta><time class=post-date>2024-01-02 (Tue.) ::</time></div><span class=post-tags>#<a href=/diary/tags/day-off/>day off</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/network/>network</a>&nbsp;</span><div class=post-content><p>2時過ぎに寝て6時半に起きて7時半に起きた。夜に相棒の元旦スペシャルをみていて、最後の方でニュースに切り替わって、その後、相棒の別の再放送？がまた始まるみたいな変な番組編成になっていた。起きてから神棚にお供えをしたり親戚を迎える準備をしていた。</p><p>今日の筋トレは腹筋:10x1,腕立て:10x1,スクワット10x1のように毎日書いていけば1ヶ月ぐらいは継続できるのではないか？</p><h2 id=親戚とお昼ご飯>親戚とお昼ご飯</h2><p>毎年2日は親戚がやってきてお昼ご飯を食べる。昨年は訃報でやらなかったので2年ぶり。今年は離れのスペースにダイニングテーブルを2つ入れた。この形態でやるのは初めて。鍋にすき焼きをつくり、あとお寿司とお刺身を7人で食べた。このぐらいの人数でご飯を食べるのはとくに問題なさそう。ご飯を食べたりするなら電子レンジもあった方が便利だと気付いた。11時から準備して12時頃から食べ始めて14時前ぐらいで解散。お年玉をあげたり、親戚の姪や甥の話しを聞いたりしていた。</p><p>この春から働き始める姪が言うには <a href=https://www.16personalities.com/ja>MBTI 性格診断</a> というのが流行っていて、就職活動で適正診断の1つとしてやるようなものになる。なぜかそれが一般にも流行っていて、若い人だとこのタイプをインスタのプロフィールに書いてあったりもするらしい。試しにやってみたら私は <a href=https://www.16personalities.com/ja/intj%E5%9E%8B%E3%81%AE%E6%80%A7%E6%A0%BC>建築家 INTJ-A</a> タイプだった。タイプが16個あるので複数人でやったらタイプがバラけて盛り上がるのかもしれない。今度の開発合宿でもネタの1つにみんなにやってもらってもよいかもしれない。</p><h2 id=iphone-のテザリングの自動切断>iphone のテザリングの自動切断</h2><p>iphone を wifi ルーター代わりにテザリングをしていると気付かないときに切断していることがある。調べてみると、通信がないと約90秒で自動切断するという仕様になっているらしい。これはテザリング接続のアクセスポイントの電波も停止してしまっていることから、iphone の設定を開いてインターネット共有の on/off をしないといけないという面倒さがある。</p><p>この振る舞いはバッテリーを節約したいデバイス側と通信帯域を節約したいキャリア側の思惑が一致するせいか、ユーザー設定でこの振る舞いをカスタマイズすることはできないようにみえる。</p><ul><li><a href=https://note.com/runisan/n/n81c34518e1e0>iPhone-iPad間テザリングの接続切れ問題を解消したので解説したい</a></li></ul><p>なにかしら通信していれば自動切断はしない仕様にみえるので ping コマンドで icmp パケットを定期的に (次の例では60秒ごと) に送るといったことをしていれば切断はされないようにみえる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>&gt; ping -i <span style=color:#ae81ff>60</span> www.yahoo.co.jp
</span></span></code></pre></div><p>開発者ならすぐワークアラウンドを思いつくが、一般ユーザー向けに iphone のテザリングが自動切断されない接続アプリのようなものを作ってあげると一般ユーザーにウケるんじゃないかと考えたりもした。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0101/>筋トレの習慣作り</a></h1><div class=post-meta><time class=post-date>2024-01-01 (Mon.) ::</time></div><span class=post-tags>#<a href=/diary/tags/day-off/>day off</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/coworking/>coworking</a>&nbsp;
#<a href=/diary/tags/health/>health</a>&nbsp;</span><div class=post-content><p>離れで2時過ぎに寝て7時半に起きた。いつもと寝床が違うせいか、起きたらやや腰が痛い。昨日は暖かくて室温が13℃ほどあったのでエアコンなしで寝てもとくに寒くはなかった。</p><h2 id=すぐやる筋トレ>すぐやる筋トレ</h2><p>朝からテレビをみていたら <a href=https://ja.wikipedia.org/wiki/%E8%B0%B7%E6%9C%AC%E9%81%93%E5%93%89>谷本道哉</a> 先生が出演していて筋トレについて紹介していた。最近の研究で1週間に30-60分筋トレをすることで総死亡・心血管疾患・がん・糖尿病などのリスクが10〜17%下がるらしい。なにもしないより、やった方が健康によさそうというのは直感的でもある。先生のモットーは次になると言う。</p><blockquote><p>筋トレはやるか、すぐやるか</p></blockquote><p>やるのは前提でいつやるかだけを言っている。こういうキャッチフレーズはいいなと素直に感心してテレビでやっている筋トレを実際にやってみた。10-20回/1セットをやればよいという。紹介していた筋トレを今日は10回2セットをやってみた。</p><ul><li>椅子に座っての足上げ (腹筋)</li><li>机を使っての腕立て伏せ (腕立て)</li><li>スクワット (スクワット)</li></ul><p><a href=https://www.nobetech-mag.jp/column/%E8%B0%B7%E6%9C%AC%E9%81%93%E5%93%89%E7%AD%8B%E8%82%89%E8%B2%AF%E9%87%914/>谷本道哉【第4回】いますぐできる！オフィスでかんたん筋トレ – 筋肉貯金で長くたくましく働ける体を作る</a> の記事で紹介されているものが近い。これぐらいならオフィスでも確かにすぐできる。なにかを始めても長続きせずすぐにやめてしまう。人間が弱いから継続できない。<a href=/diary/posts/2021/1130/#習慣化のための平均66日>習慣化のための平均66日</a> という仮説がある。日記はこの仮説を意識して習慣化に成功した数少ない事例の1つ。簡単なことは1ヶ月程度でよいはず。もしこの筋トレを1月いっぱい継続できれば習慣化できるかもしれない。なるべく朝か午前中にやるのがよいのではないかと考えている。先生によると、筋トレすると乳酸が出てくる。これまで乳酸はよくないものと考えられていたが、最近の研究では乳酸が脳のエネルギー源になっているとわかってきたらしい。</p><p>日記はほぼ毎日書くのでここに筋トレのやった回数を書いていくのがやらないといけない強制力が働いてよいような気がしてきた。試しに明日からやってみようと思う。</p><h2 id=コワーキングスペース化へ向けての準備>コワーキングスペース化へ向けての準備</h2><p>実家の離れをコワーキングスペース化するために少しずつ取り組む。もともと使っていない部屋だったので、半分は物置となっていた。不要な棚やタンスなども放置されていた。昔は祖父が住んでいたこともあるので祖父の生活品なども少しそのまま残っている。まずはそれらを整理しないといけない。具体的には不要なものを捨てて粗大ゴミとして出す。コワーキングスペースとして足りないものを備えていく必要もある。</p><p>今日のところは次の大きなものを外に排出した。その後、掃いたり拭いたり掃除をしていた。物を動かすといろいろ汚い。</p><ul><li>タンス</li><li>棚</li><li>こたつ</li><li>ローテーブル</li><li>ベッド</li><li>マットレス</li><li>付随するいろいろ</li></ul><p>空きスペースができて広くなった。いずれはソファも片付けて椅子のみにしたい。</p><figure><img src=/diary/img/2024/0101_hanare.jpg></figure><p>いまダイニングテーブルは2つある。スペース的にはもう1つ置けそう。あとテーブルと椅子を一式探してみようと思う。</p><table><thead><tr><th style=text-align:right>縦 (cm)</th><th style=text-align:right>幅 (cm)</th><th style=text-align:right>高さ (cm)</th><th>色</th></tr></thead><tbody><tr><td style=text-align:right>80</td><td style=text-align:right>130</td><td style=text-align:right>68</td><td>ダークブラウン</td></tr><tr><td style=text-align:right>75</td><td style=text-align:right>120</td><td style=text-align:right>70</td><td>ナチュラル</td></tr></tbody></table><p>ダイニングテーブルの前後に向かい合って2人で使うのがスペースを広く使えて快適に思える。どうせそんな多くの人は来ない。せいぜい4-5人程度がゆったり作業できればよい。</p><p>その他、気付いたこと。</p><ul><li>4-5人が作業できるだけの wifi ネットワークをどうするか<ul><li>いまは <a href=/diary/posts/2023/0721/#iijmio-ギガプランの変更>iijmio 5ギガプラン</a> を使っている</li><li>1ヶ月に1週間お仕事する程度ならこれで十分</li></ul></li><li>昼間は電気をつけても少し暗い感じがする<ul><li>補助的な光を置いてもよいかもしれない</li></ul></li><li>部屋の隅には蜘蛛の巣がある</li><li>夏は暑く冬は寒いので窓をカスタマイズしてもよいかもしれない</li><li>宿泊はスペースと布団の準備がいるのでしばらくはやらない</li></ul></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1231/>だらだらした大晦日</a></h1><div class=post-meta><time class=post-date>2023-12-31 (Sun.) ::</time></div><span class=post-tags>#<a href=/diary/tags/day-off/>day off</a>&nbsp;
#<a href=/diary/tags/comic/>comic</a>&nbsp;
#<a href=/diary/tags/team-building/>team building</a>&nbsp;
#<a href=/diary/tags/motivation/>motivation</a>&nbsp;</span><div class=post-content><p>夜に <a href=https://yanmaga.jp/comics/%E3%82%A2%E3%83%B3%E3%83%80%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B8%E3%83%A3>アンダーニンジャ</a> を読み始めて、途中で寝たりしながら気付いたら7時に起きた。それから起きないといけなかったんだけど、なんとなくのんびりしてお昼ぐらいまで過ごし、その後も軽く食べてから3時頃までだらだらしていた。</p><h2 id=帰島>帰島</h2><p>夕方ぐらいから車で実家に帰る。雨がぱらぱらしていたり、大晦日でもそこそこ交通量が多かった。途中の淡路 SA でお土産をいくつか買って1時間半ぐらいで実家に着いた。</p><p><a href=https://www.tbs.co.jp/program/wbc2023sp_20231231/>WBC2023 ザ・ファイナル</a> を見始めたら最後までみてしまった。私はニュースでしか知らなかったので当時のダイジェスト映像で試合を振り返ることもできてよかったと思う。とくにダルビッシュ選手の振る舞いや役割に共感できた。自分が選手として活躍するよりも、若い人たちがチームに馴染みやすいようチームビルディングに献身している姿勢がよかった。番組内のダルビッシュ選手の若い頃のエピソードを聞いているとそういう社交的な選手ではなかったようだ。それは2009年のWBCのイチロー氏の影響もあったのだと思える。私もいまマネージャーをやっていて、自分がその業務をできないわけではないが、若い人たちになにをどう教えたらよいかを考え込むことが多い。</p><p>テレビを見終えてから離れで机に向かって日記を書いている。私は家と作業場所を完全に分けるのが気持ちの切り替えにうまくいく。モチベーションや集中力を制御するために場を変えるというのを、昔はそれほど自覚的に行っておらず、いまほどうまく活用できていなかった気もする。いまはもっとうまく場を活用できるんじゃないかと思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1230/>年末の読書</a></h1><div class=post-meta><time class=post-date>2023-12-30 (Sat.) ::</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/management/>management</a>&nbsp;</span><div class=post-content><p>1時には寝ようとしていたが、飲み過ぎで気分が悪くてあまり眠れなかった。気付いたら7時ぐらいになっていて、今日はもうしんどいと思ってそのまま寝ていたら9時45分にストレッチに出掛けるアラームで起きた。アラーム設定していなかったらドタキャンしていた。危ない。</p><h2 id=ストレッチ>ストレッチ</h2><p>急いで準備して行ったわりにはなんとか間に合って普通にストレッチを受けてきた。今週はほぼ休みに入っていてあまりお仕事していないこともあってとくに負荷がかかっているわけでもないように考えていたが、座って作業していることに変わりはないことから太ももの後ろの筋だけはいつも通りに張りがあった。今日の開脚幅は開始前152cmで、ストレッチ後156cmだった。</p><p>トレーナーさんが年明けに全社集会のようなイベントがあって、全国からそれぞれの店舗の社員さんが東京に集まるという。そこまでは普通だとして、そのときに社員同士の懇親のための催しでけん玉とルービックキューブとクイズ大会をやるという。それを聞いて「私だったら会社辞めるわ」とか冗談を言いながら、やるとしてもいまどきのゲームとか、フットサルとか、もっと若い人が身近に楽しめるものにしたらいいのにと返した。トレーナーさんも誰がどういう背景でこんな企画をしているのか、まったく分からないと言う。過去に働いていた会社でも似たようなことがあったなと私も過去を思い出しながら聞いていた。</p><h2 id=絶対無理なんて絶対ない>「絶対無理」なんて「絶対」ない！</h2><p>たまたま知った <a href=/diary/posts/2023/1228/#マネーの虎たちのその後>南原竜樹さん</a> のその後に影響を受けて著書を買っていた。最近の amazon の配送日時はまったく当てにならず、年明けに届く予定が2日後に郵便ポストに入っていたりする。受け取りが必要ないものは早い分には困らない。たまたま手に取ったので読み始めた。本書は2012年2月に出版されている。すでに10年以上が経過している。そんな本を買って役に立つのかと訝しむ人も多いと思う。</p><p>私自身、自分で経営をやってきて、これまで身近に聞いてきた経営者の言葉でよくわかるようになったことがある。経営とは基本的な作法や論理を整えたらあとはその経営者の価値観でしかないのだ。その価値観が時代にあう・あわない、ビジネスモデルとして表現できるかどうか、世の中の役に立つかどうかは多くのケースでやってみないとわからない。他者の経営を学ぶことは、自身の価値観に近いものがあれば参考にしたり取り入れたりすればよいし、そうじゃなければ、自分の価値観とは違うがそういう考え方もあるのかと見識を広めるために使えばよいのだと思う。経営者がどういう価値観をもって経営するかがその会社の独自性や差別化につながる。したがって南原さんの価値観を学ぶには古い本でもよいだろうと考えた。</p><p>その冒頭で出版業界が斜陽なのであえて出版社を作るということに挑戦している。<a href=https://ja.wikipedia.org/wiki/AT%E3%83%91%E3%83%96%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3>ATパブリケーション</a> という会社になる。本書もこの会社から出版されている。ググると当時の記事もみつかる。</p><ul><li><a href=https://www.itmedia.co.jp/makoto/articles/1203/21/news078.html>なぜこのタイミングで出版社を立ち上げたのか――南原竜樹さんの考え方</a></li></ul><p>どうやら企業サイトがリンク切れしているのでもう存在していないのかもしれない。PR TIMES も2015年を最後にプレスリリースが途絶えている。</p><ul><li><a href=https://prtimes.jp/main/html/searchrlp/company_id/9711>https://prtimes.jp/main/html/searchrlp/company_id/9711</a></li></ul><p>この会社のビジネスはうまくいかなかったのかもしれない。しかし、それは結果であって、経営の価値観とはあまり関係がない。年末に読み進めてみようと思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1229/>2回目の仕事納め</a></h1><div class=post-meta><time class=post-date>2023-12-29 (Fri.) ::</time></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/management/>management</a>&nbsp;
#<a href=/diary/tags/eltax/>eltax</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/food/>food</a>&nbsp;
#<a href=/diary/tags/community/>community</a>&nbsp;
#<a href=/diary/tags/coworking/>coworking</a>&nbsp;
#<a href=/diary/tags/issue-management/>issue management</a>&nbsp;</span><div class=post-content><p>2時に寝て何度か起きて7時過ぎに起きてゲームして10時ぐらいからオフィスに出掛けた。</p><h2 id=年末の事務手続き>年末の事務手続き</h2><p>年末調整と給与支払報告書の作成を行った。年末は平時の月末と異なるからわちゃわちゃしてたら25日の給与の支払いも忘れていた。いや、忘れていたというよりは年末調整を12月分の給与で調整したいから年末調整を完了しないと給与確定できないと放置していた。今日は金曜日で平日だからシステムは稼働しているだろうと安易に考えていたら eltax も e-tax も稼働日を次のように書いてあった。</p><blockquote><p>土・日・祝日、年末年始12/29～1/3は除く</p></blockquote><p>eltax のアプリケーションで書類データは作成できたけれど、作成したデータを送信することはできなかった。年明けの4日まで持ち越し。こういう失敗が最近増えてきた。がっかりして嫌になる。あと eltax や e-tax の運用停止時間に遭遇することが私はとても多い。月に1回も使わないようなシステムなのに年間で2-3回ほどは使えない時間に遭遇する。それは当たり前で、私が余裕のある時間は早朝・深夜と休日になるため、メンテナンスの日程と重なることが多い。システムは基本的に24時間365日動いていないとダメだということがわかる。なにかトラブルがあったときの運用対応は年明けでも構わないが、定型的なデータ処理は24時間365日できるはずだと思う。</p><p>その後に自社の請求書を作成したり、他社の請求書の対応や会計の明細登録などをしていた。キャッシュフローも眺めていて <a href=/diary/posts/2023/0331/>今季はもともと赤字想定で予算策定</a> していたが、受託開発のお仕事が長引いて黒字決算で着地する予定。あと3ヶ月しかないのでブレることもないだろうと思う。本当は今季に事業の体制変更もやらないといけなかったことが来季へずれ込む。計画通りに進捗していないという面からは、いろいろあって事業も経営もあまりうまくいっていない。</p><h2 id=カフーツさんの忘年会>カフーツさんの忘年会</h2><p>初めての参加。昨年も参加する予定が <a href=/diary/posts/2022/1226/>父の訃報</a> があってドタキャンしたのでリトライ。手土産に <a href=https://issindo-osaka.com/>一心堂</a> のフルーツ大福をもっていくことにした。神戸の阪急百貨店にお店があったのでてっきり神戸発祥のお店かと思ったら大阪発祥だった。種別によって値段は異なるが、だいたい1個410-640円 (税抜き) ぐらい。9個入の詰め合わせにしてもらった。</p><figure><img src=/diary/img/2023/1229_daihuku.jpeg></figure><p>他に持ち寄りであった食べものに <a href=https://www.ikkanrou.jp/>三宮一貫樓</a> のちび豚まんと焼売を撮った。神戸に住み始めて商店街の一角にあるのは知っていたのだけど、神戸の名物の1つだと知ったのは住み始めて2-3年経ってからだった。勉強会の食べものの定番はピザだけど、神戸なら一貫楼の <a href=https://www.ikkanrou.jp/items/394>中華パーティーセット</a> (送料/消費税込みで10,750円) などを頼むのもよいのかもしれない。</p><figure><img src=/diary/img/2023/1229_ikkanrou.jpg></figure><h2 id=コミュニティとコワーキングの違い>コミュニティとコワーキングの違い</h2><p>いとうさんと話していて、以前よりコミュニティとコワーキングの違いが明確になった。私の中では似て非なるものという考えはあったものの、あまり違いを明文化できていなかった。</p><p>コミュニティマネージャーと <a href=https://www.coworkingmgr.com/>コワーキングマネージャー</a> では求められるスキルセットが大きく異なる。キャリアとしてもコワーキングマネージャーの方がずっと難易度の高いものであるように話されていた。集合で言えば、コワーキングマネージャーはコミュニティマネージャーのスキルセットを含む。コミュニティマネージャーは私も身近なものだし、コミュニティマネージャー (会社によっては DevRel と呼ばれたりもする) を社員として雇用する会社も増えてきた。会社に雇われるコミュニティマネージャーというキャリアは、その会社のサービスやプロダクトのコミュニティを盛り上げたり宣伝したりといったマーケティング活動の一環とみなされることが多い。一方でコワーキングマネージャーというのは、会社に雇われるというよりもコワーキングスペースや地域のようなコミュニティに根付くものかもしれない。</p><p>コミュニティというのは、それ自体を1つの意思をもった人のように扱い、そこに集まる人たちがコミュニティの思想にあうよう1つにまとまって活動する、協調するといった趣きが強い。そのため、コミュニティマネージャーはコミュニティの理念にあうようメンバーをまとめたり、逆にあわない人たちを排除することもある。一方、コワーキングというのは、個々がそれぞれの背景をもち、得意・不得意があり、性格や思想も様々で多様な価値観をもつ人たちが集まり、それぞれの特性を活かした上で協調するといった趣きがある。そして、コワーキングマネージャーは個々人にあわせたホスピタリティを提供するという。これは主従において大きな違いの1つでもあると理解できた。コミュニティはそれ自体が主でその理念にメンバーが従う。コワーキングは個々が主でその人たちが協調するかどうかはそれぞれのコワーカーの判断に委ねられる。そして、コワーカー同士が協調しやすいように縁の下で支えるのがコワーキングマネージャーだという。コワーキングマネージャーは、訪れたコワーカーとコミュニケーションを取る中で、一緒に考え、相談にのり、そして答えや結論を出さなくてもよいという。コワーカーと一緒に考えてあげるだけでよいというのだ。どこかに落とし所に着地させたり、全体をまとめたりしないという点がコミュニティマネージャーと大きく異なる。</p><p>そこで素朴な疑問。コワーキングマネージャーが個々人に向き合うとしたら、そこには <a href=https://ja.wikipedia.org/wiki/%E3%83%80%E3%83%B3%E3%83%90%E3%83%BC%E6%95%B0>ダンバー数</a> (100-150人？) のように人間の認知能力の限界が出てくる。数千人や数万人が所属するコミュニティも存在するが、コミュニティといった枠組みで集団を抽象化して管理できなければ認知能力に限界がある。次の問いを投げかけてみた。</p><blockquote><p>コワーキングマネージャーが個々人にホスピタリティを提供するとしたら、小さい規模や小集団でしか機能しないのではないか？スケールしないのではないか？</p></blockquote><p>いとうさんが言うには、この弱点を補うのがツールの力だという。コワーキングマネージャーのチームを作り、コワーカーそれぞれと話した内容やその人の背景や特性、いまやっていることなどを記録し、その記録をチーム内で共有する。これなら個人の認知能力を拡張できるし、コンテキストを引き継いだ上で初めて会うコワーキングマネージャーとコワーカー間におけるホスピタリティも担保できるかもしれない。</p><p>ここまで聞いて、これはまさに私が開発の現場でやっている課題管理そのものだということに気付いた。日々の開発のアクティビティを課題管理システムにコメントとして記録し、そのタイムラインをメンバー全員で共有しながら、リアルタイムに必要なコミュニケーションをもって相互に情報共有または協調するといったことを、まさに私のチームでは実践している。これをコワーキングスペースにいるコワーキングマネージャー間で行う、もっと言えば、複数のコワーキングスペース間で共有できれば、それはさらに大きなホスピタリティになるのかもしれない。別のコワーキングスペースへ行っても、自分の背景が共有されていて、よりよいホスピタリティを受けることができるのかもしれない。</p><p><a href=/diary/posts/2022/0618/>初めてカフーツさんに訪問したのが2022年6月</a> だった。当時いとうさんと話してみて、課題管理に通じるところがあると直感的に感じて、その後、やり取りを継続してきて、1年半経った。ようやくコワーキングと課題管理がつながった。いとうさんからみれば、課題管理とはコワーキングマネージャーが備えるべきホスピタリティの延長上にあるチームで協調するための概念なのだと思う。そして、私からみれば、コワーキングとは課題管理そのものなんだと理解できた。</p><p>課題管理システムの利用状況を表すメトリクスの1つに <a href="https://developers.google.com/chart/interactive/docs/gallery/calendar?hl=ja">カレンダーチャート</a> がある。これがいま課題管理を知らないチームでその実践を指導する上で想定外に役に立つことがわかった。この他にも課題管理特有のメトリクスを増やしていきたいと私は考えていた。そのアイディアの1つに「コワーキングチャート」というものを作ろうと思う。おそらく世の中にはないし、課題管理とコワーキングの両方を研究している人にしか、この発想は出てこないと思う。来年、他社のお手伝いを終えた後のアイディアの1つに寝かしておこうと思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1228/>年末のデスクワーク</a></h1><div class=post-meta><time class=post-date>2023-12-28 (Thu.) ::</time></div><span class=post-tags>#<a href=/diary/tags/communication/>communication</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
#<a href=/diary/tags/coworking/>coworking</a>&nbsp;
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/finance/>finance</a>&nbsp;</span><div class=post-content><p>0時に寝て何度か起きて気分が悪くて吐きそうになりながら7時過ぎに起きた。昨日は飲み過ぎた。やはり年末でだらけているのでオフィスへ出勤したのが9時44分だった。</p><h2 id=slack-コネクト>slack コネクト</h2><p>昨日の <a href=/diary/posts/2023/1227/>税理士さんとの打ち合わせ内容</a> の1つに chatwork のフリープランの <a href=https://help.chatwork.com/hc/ja/articles/900001118283#1>メッセージの閲覧制限</a> への対応がある。以前は制限がなかったらしいが、どこかのタイミングで40日制限に変更されたという。slack もフリープランは3ヶ月に制限しているので世の中の流れとしては仕方ないのかもしれない。それはともかく、chatwork に (先方の負担で) 課金するか、<a href=https://slack.com/intl/ja-jp/connect>slack コネクト</a> へ移行するかの相談をしたら slack でも構わないという。先方も slack を有料プランで事務所内では使っているという話しだった。問題提起してヒアリングしてみたらなんのコストもなく移行できることがわかった。</p><p>早速、今日、調べて税理士さんを招待した。その際に社外の個人アカウントを使って slack コネクトの振る舞いも検証した。slack コネクトのよいところは次になる。</p><ul><li>通常のメンバー同様、slack コネクトで招待したメンバーはチャンネル、プライベートチャンネル、ダイレクトメッセージを使える</li><li>自分のワークスペースに他組織のワークスペースのチャンネルを追加できる (<strong>参加するワークスペースが増えない</strong>)</li><li>チャンネル名、トピック、説明はそれぞれのワークスペース管理となる<ul><li>とくにチャンネル名を自組織のワークスペースの都合で名前を付けられるのがよいと思う</li></ul></li></ul><p><a href=https://slack.com/intl/ja-jp/help/articles/115002422943-%E7%84%A1%E6%96%99%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E4%BD%BF%E7%94%A8%E5%88%B6%E9%99%90>無料ワークスペースに設定されている使用制限</a> によると、フリープランは slack コネクトを利用できない。invitation を送るとフリープランでも接続できるが、それは pro のトライアルになるため、3ヶ月だけ使えるみたい。</p><h2 id=開発合宿の打ち合わせ>開発合宿の打ち合わせ</h2><p>先日 <a href=/diary/posts/2023/1224/>作成した旅のしおり</a> を使って開発合宿の打ち合わせをした。打ち合わせをする前に見直していると、いくつも不備や誤りに気付いて1時間前ぐらいから修正したりしていた。私の作る資料は手直ししないと小さい誤りがいくつもある。参加者は現時点で7名で、いまのところ、これ以上増える見込みはない。昨年は4名だったのでおよそ2倍に増える。きのいえは9名まで宿泊できるようにみえる。神戸組4人に対して関東組は3人参加してもらえる。関東からわざわざ来てもらえるのは本当にありがたい。このぐらいの規模で数年継続できるような仕組みや体制を作るのが当初の目標でよい気がする。昨年は初めてだったので手探りだったが、今年は2回目なのでもう少し段取りやノウハウを使ってうまく運営できればと思う。</p><p>みんな時間通りに打ち合わせに集まってくれて、自己紹介して、主旨を説明して、大雑把なタイムスケジュールを紹介して、質疑応答をした。私の知人に声をかけているので神戸組と新規参加の関東組とはまったく面識がない。そういった人たちを少しでも話しやすいよう話題を設けたり、きっかけを作ったりすることがコミュニティマネージャーとしては求められる。別に私がコミュニティマネージャーを目指しているわけでもないが、コワーキングやコミュニティの価値の実践的なものを理解していく上で避けられないと考えている。私自身コミュ障で他人と話したくない人間なので、役割としてやらないといけないというポジションに追い込むことでその機会を得ていると言える。あと2ヶ月、詳細の詰めをしていく段階に入ってきた。</p><h2 id=マネーの虎たちのその後>マネーの虎たちのその後</h2><p>たまたまみたらおもしろかった。昔リアルタイムでみていた。いまの感覚でみればハラスメントやら人格否定しまくりの時代背景の史料の1つも思える。そのときボロクソに言っていた社長たちもその後破産している社長は多いみたい。そして、すごいのが数十億といった負債を抱えて破産してもまたやり直して復活している社長もいるということ。その再起のきっかけにセミナーや講演をしてマネーの虎を宣伝文句として使っているところが本当にダサいとは思うけど、そういったなりふり構わず売上を上げるためなら何でもやるといった姿勢が復活するためのバイタリティになっているのかもしれない。昭和世代のハングリー精神のようなものを感じる。</p><div class=video-container><iframe src=https://www.youtube.com/embed/VOTyYGjUm4M allowfullscreen title=【ゆっくり解説】マネーの虎で出場者をボロクソに批判した社長達の末路６選></iframe></div><p>その中でも南原竜樹さんがすごい。年商100億の会社が取引会社の突然の倒産から資金繰りが悪化して破産して、2年かけてすべての負債 (20億円) を返済して、ホームレスになってからまた再起してまた年商100億まで復活したらしい。経営能力がある人はゼロから成功できるというのがよく分かるモデルケースにみえる。失敗して門前払いする人がいる一方、助けてくれる人もいたみたい。</p><ul><li><a href=https://www.moneypost.jp/966227>元『￥マネーの虎』南原竜樹さん 年商100億円社長が45歳でホームレスに転落、どん底からの復活劇</a></li></ul><blockquote><p>一方で、手を差し伸べてくれる人もいた。中でもありがたかったのは、旧知の社長が会社の空きスペースの提供を申し出てくれたことだ。すべてを失った南原さんは、間借りしたオフィスで「過去の成功にとらわれず、心を入れ替えて再出発する」ことを心に誓った。</p></blockquote><blockquote><p>「僕は、“老害化”した経営者をたくさん見てきました。高齢になった経営者がいきなり頓珍漢なことを言い出して、周囲を困惑させるケースも少なくない。だからちょっと早めに準備して、いろんな方に事業を引き継いでもらいました。(&mldr;中略&mldr;) 頭も体もしっかりしているうちに、自ら退くのが一番なんです」</p></blockquote><blockquote><p>手持ちの資金はゼロだったので昼夜を問わず働いた。<br>「資金を得るためにオートバックスで8時間、吉野家で8時間、モービル石油で8時間バイトして、吉野家ではお客さんがいない時に立ったまま寝ていました（笑）。</p></blockquote></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1227/>一周まわって飲み会も大事</a></h1><div class=post-meta><time class=post-date>2023-12-27 (Wed.) ::</time></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;</span><div class=post-content><p>0時に寝て何度か起きて7時過ぎに起きた。9時までにはオフィスへ行くつもりが、気が緩んで9時はまわっていたと思う。年末でだらけている。</p><h2 id=税理士さんとの打ち合わせ>税理士さんとの打ち合わせ</h2><p>この3ヶ月ほど <a href=/diary/posts/2023/1208/#隔週の雑談>税理士さんとやり取り</a> してきた懸念事項の共有または改善も含め、<a href=https://www.nta.go.jp/law/joho-zeikaishaku/sonota/jirei/tokusetsu/index.htm>電子帳簿保存法</a> への対応の打ち合わせをしてきた。打ち合わせのため、姫路市にある税理士さんの事務所を訪問してきた。オンラインでできないわけではなかったが、1度も直接会ったことがなかったので、こちらの言い分や相手の言い分も気兼ねなく出し合う機会にしようと思って出掛けた。打ち合わせ後に一緒に晩ご飯を食べに行って、その後も2件飲み屋さんをはしごして、結果的には親睦を深めてお互いの考え方や人間性などを理解する機会になってよかったと思う。17時から22時まで飲み歩いてた。古い時代の人間関係では当たり前だったことが、いまどきの付き合いでは珍しいことかもしれない。</p><p>晩ご飯は <a href=https://tabelog.com/hyogo/A2805/A280501/28013652/>プロ酒場</a> というお店を紹介してもらった。路地裏の隠れた場所にあって地元の人が行くお店って感じだった。「プロ」はプロフェッショナルではなく、労働者を指す <a href=https://ja.wikipedia.org/wiki/%E3%83%97%E3%83%AD%E3%83%AC%E3%82%BF%E3%83%AA%E3%82%A2%E3%83%BC%E3%83%88>プロレタリアート</a> に由来するという。</p><p>あまり先方からはどういった運用をしたいという考えや既存のワークフローはないようで、ほぼこちらの言い分は通って改善へ向けての最初の切り口として収穫は大きかった。実際にそういった運用ができるかどうかはこれから徐々に実践して取り組んでいく。当社としてもこちらの要望だけを主張するつもりはなく、先方の状況や考えも聞いた上でお互いに合意できるところを探っていきましょうと伝えた。業務をうまくまわすために協調しましょうということは理解してもらえたのではないかと思う。</p><h2 id=姫路駅の雰囲気>姫路駅の雰囲気</h2><p>姫路駅の北側には姫路城がそびえている。駅を降りるとすぐに姫路城が目に入るようになっている。そして観光客向けのお店とアーケード街のお店も並んでいて、それほど人がいるわけではないけど活気がある。20分ほど駅から北側へ歩くと姫路城に辿り着く。</p><figure><img src=/diary/img/2023/1227_himeji-castle1.jpg></figure><figure><img src=/diary/img/2023/1227_himeji-castle2.jpg></figure><p>駅の南側はうってかわってオフィス街となっている。ビルが立ち並びお店などはあまりない。駅の南北で役割分担をしているような、おそらく都市計画でそういった整備が行われているのだと推測する。税理士さんの事務所まで、姫路駅から徒歩20分ぐらい歩いた。あらかじめ調べた上で歩いたわけだけど、それでもやや遠かった。体力が落ちていて駅から徒歩20分とか、普通には歩けないようになりつつあるのかもしれない。帰りはタクシーを使ったら運賃が1300円だった。三ノ宮から姫路まで JR で990円なのにこの距離で1300円なのかとか、いろいろ思うことがあるな。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1226/>1回目の仕事納め</a></h1><div class=post-meta><time class=post-date>2023-12-26 (Tue.) ::</time></div><span class=post-tags>#<a href=/diary/tags/project-management/>project management</a>&nbsp;
#<a href=/diary/tags/issue-management/>issue management</a>&nbsp;</span><div class=post-content><p>1時に寝て何度か起きて7時過ぎに起きた。寒くてなにもできない。</p><h2 id=定例会議>定例会議</h2><p>年末という追い込みもあってか、このマイルストーンで対応した issue 数も多くて、ふりかえりの内容や議論する内容がいつもの定例よりも多かった。1時間の会議時間を20分ほどオーバーしながら定例会議を終えた。</p><p><a href=/diary/posts/2023/1211/#テックブログを読む会>テックブログを読む会</a> の調査報告をして年明けぐらいから社内でもやってみようかという話しをしていて、メンバーから開発が忙しいから勉強時間が取れないといった意見が出た。これは課題管理の文脈で取り組むよい問いに思えた。一番勉強しないといけないメンバーから出た意見でもあった。私の過去の経験則でもこの類の発言はスキルの高い開発者からは出ない。それは勉強することの価値を理解しているからだと推測する。</p><p>いまテスト駆動開発はどちらかと言うと文化に近いと言われる。その所以はテストを書かないから開発が遅くなるということをヒューリスティックもしくは経験則として理解している開発者が多いからだと私は考えている。現実のシステム開発でテストを書かないと開発と、テストを書く開発を定量的に評価したり比較することは相当に難しい。事実上そんなことはできない。なぜならば、業務はそのどちらか一方しか選択できないからだ。だから、これは開発者の感覚としてテストを書いて当たり前だという文化をもって、その実益もあると信じて業務に組み込むしかない。だから文化と言われる。それと同じで開発や技術の勉強をせずに、目の前の開発だけやっていてもスキルアップできないのは経験を積んだ開発者からみたら自明だが、それをどう伝えていくか、もしくはその気付きを課題管理の文脈で与える仕組みはないかな？と考えていたりした。</p><h2 id=納会>納会</h2><p>今日はお手伝い先の仕事納めになる。私もそれにあわせて15時半にはお仕事を終えて退勤した。1人だけ働いていてもテンションが上がらないかなと思ってそうした。その後、お手伝い先の納会途中の写真がアップされていてスマブラやりながらのほほんしていたみたい。</p><blockquote><p>納会：何かの出来事や物事が終わった時に締めくくりとして催す会</p></blockquote><p>昔から会社の納会ってなんの意味があるのだろう？と思っている。だいたいお疲れ様でしたって感じで軽食とお酒があって、それを飲み食いしたらすぐ帰る人もいれば、そのまま残って雑談してから帰る人もいる。いつ帰ってもよい流れ解散となる。会社によってもやり方は異なるのだと思うけど、どうせイベントをやるならもうちょっとちゃんとやったらいいんじゃないかと思わないでもない。だらだらしたイベントが納会ってイメージすらある。</p><p>本当は夕方から明日の打ち合わせの議題を整理しようと思っていたものの、夕方から急にお腹が痛くなって、帰ってお腹を下して寝ていた。お昼に食べたもののせいかもしれない。寝ていたら直ったのでそんな大したことはないみたい。うちの会社の業務としてはいつも通りで29日までは働く予定。ちょうどカフーツさんの忘年会が29日17時からあるのでそれを２回目の仕事納めにするのがよさそう。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1225/>RemoteAddr はほとんど役に立たない</a></h1><div class=post-meta><time class=post-date>2023-12-25 (Mon.) ::</time></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/design/>design</a>&nbsp;
#<a href=/diary/tags/security/>security</a>&nbsp;</span><div class=post-content><p>0時に寝て何度か起きて7時に起きた。寒くて朝起きれなくなってきた。</p><h2 id=ローカルネットワークからのリクエストのみを受け付けるミドルウェア>ローカルネットワークからのリクエストのみを受け付けるミドルウェア</h2><p><a href=https://pkg.go.dev/net/http#Request>Request</a> 構造体の中にある <code>RemoteAddr</code> を参照すればすぐできるだろ思って、すぐにできた。すぐにできたんだけど、これは実際の運用で使えるものではない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>LocalNetworkConfig</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Skipper</span> <span style=color:#a6e22e>middleware</span>.<span style=color:#a6e22e>Skipper</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>localNetworkWithConfig</span>(<span style=color:#a6e22e>cfg</span> <span style=color:#a6e22e>LocalNetworkConfig</span>) <span style=color:#a6e22e>echo</span>.<span style=color:#a6e22e>MiddlewareFunc</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>next</span> <span style=color:#a6e22e>echo</span>.<span style=color:#a6e22e>HandlerFunc</span>) <span style=color:#a6e22e>echo</span>.<span style=color:#a6e22e>HandlerFunc</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>echo</span>.<span style=color:#a6e22e>Context</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>cfg</span>.<span style=color:#a6e22e>Skipper</span>(<span style=color:#a6e22e>c</span>) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>next</span>(<span style=color:#a6e22e>c</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>req</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Request</span>()
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>addr</span>, <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>SplitHostPort</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>RemoteAddr</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>slog</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;failed to get remote address&#34;</span>,
</span></span><span style=display:flex><span>					<span style=color:#e6db74>&#34;err&#34;</span>, <span style=color:#a6e22e>err</span>, <span style=color:#e6db74>&#34;addr&#34;</span>, <span style=color:#a6e22e>addr</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>echo</span>.<span style=color:#a6e22e>ErrForbidden</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>ip</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>ParseIP</span>(<span style=color:#a6e22e>addr</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>ip</span>.<span style=color:#a6e22e>IsPrivate</span>() <span style=color:#f92672>||</span> <span style=color:#a6e22e>ip</span>.<span style=color:#a6e22e>IsLoopback</span>() {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>next</span>(<span style=color:#a6e22e>c</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>slog</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;requested from an external network&#34;</span>, <span style=color:#e6db74>&#34;ip&#34;</span>, <span style=color:#a6e22e>ip</span>.<span style=color:#a6e22e>String</span>())
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>echo</span>.<span style=color:#a6e22e>ErrForbidden</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewLocalNetwork</span>() <span style=color:#a6e22e>echo</span>.<span style=color:#a6e22e>MiddlewareFunc</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>localNetworkWithConfig</span>(<span style=color:#a6e22e>LocalNetworkConfig</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Skipper</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>echo</span>.<span style=color:#a6e22e>Context</span>) <span style=color:#66d9ef>bool</span> { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span> },
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>過去にも同じようなことをやらかしたような既視感がある。</p><blockquote><p>golangのnet.Request構造体内にはRemoteAddr属性があり、当然のことながら要求元のリモートアドレスが含まれています。これで仕事は終わりですね？しかし、リバースプロキシやロードバランサーをアプリケーションに使っている場合はそうではありません。これはgoサーバには常に、すべてのリクエストがロードバランサから来ているかのように見えます。これは、これを何らかのスロットリングの指標として使いたいのであれば、最悪なことです。ですから、何らかの形のリバースプロキシの後ろでなく、goサーバーが1つだけ動いているのでない限り、私たちの目的には役に立たないとして、すぐにこれを捨てることができます。</p><p><a href=https://husobee.github.io/golang/ip-address/2015/12/17/remote-ip-go.html>https://husobee.github.io/golang/ip-address/2015/12/17/remote-ip-go.html</a></p></blockquote><p>途中のロードバランサーやアプリケーションゲートウェイ、リバースプロキシなど、中継するサーバーの ip アドレスに置き換わってしまうため、ネットワークのインフラを管理していないとどこからリクエストされたかを追跡することはできない。<code>X-Real-IP</code> や <code>X-Forwarded-For</code> という http ヘッダーに中継したサーバーの ip アドレスを記録するという慣習があるようだけど、これはクライアント側で書き換えできるのでこれ単体でアクセス制御のようなものに使うことはできない。</p><p>次に同じ失敗をしないようにここに書いておく。</p></div></article><div class=pagination><div class=pagination__buttons><a href=/diary/posts/page/7/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span>
</a><a href=/diary/posts/page/9/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>