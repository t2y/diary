<!doctype html><html lang=en><head><title>Posts :: </title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/posts/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="Posts"><meta property="og:description" content><meta property="og:url" content="/diary/posts/"><meta property="og:site_name" content><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/posts/index.xml rel=alternate type=application/rss+xml title></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0516/>helm 調査の一時中断</a></h1><div class=post-meta><time class=post-date>2022-05-16 (Mon.) ::</time></div><span class=post-tags>#<a href=/diary/tags/cdk/>cdk</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;</span><div class=post-content><p>0時に寝て6時半に起きた。</p><h2 id=eks-クラスターの-helm-管理の調査>eks クラスターの helm 管理の調査</h2><p><a href=/diary/posts/2022/0513/#eks-クラスターの-helm-管理の調査>先週から調査</a> していて、調査結果から <code>kubectlRoleArn</code> を生成してデプロイを実行してみた。以前発生していた権限エラーは解消したものの、lambda 内からの kubectl と k8s クラスターの認証に失敗する。もう1つ <code>kubectlLambdaRole</code> という設定もあるので、ここに <code>system:masters</code> 権限をもつ iam ロールを設定してみたものの、エラー結果は変わらない。お手上げかなと思ってたら <a href=https://github.com/aws/aws-cdk/issues/20008>aws-eks: Cluster.FromClusterAttributes ignores KubectlLambdaRole #20008</a> という issue があって、まさにいま起こっている現象と合致するのでこのせいかもしれない。cdk のバグならそれが解消しないと検証を進められないため、この調査は一旦打ち切って、cdk のバグが修正されて新しいバージョンがリリースされてから再試行することに決めた。</p><h2 id=backlog-のいろいろ>backlog のいろいろ</h2><p>たまたまタイムラインでスライドをみかけて、backlog の開発をしている方の記事をみつけた。scala と play framework で実装されているらしい。もう10年以上開発しているプロダクトなのかな。それ自体はすごいなぁと感心しながらスライドを眺めてた。</p><ul><li><a href=https://muziyoshiz.hatenablog.com/entry/2021/08/28/154859>ヌーラボ入社後に書いたブログ記事＆プレゼン資料まとめ</a></li></ul></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0515/>オフラインのもくもく会</a></h1><div class=post-meta><time class=post-date>2022-05-15 (Sun.) ::</time></div><span class=post-tags>#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;</span><div class=post-content><p>6時半に起きて漫画読んで8時に起きた。</p><h2 id=ワーケーションの打ち合わせ>ワーケーションの打ち合わせ</h2><p>参加者で <a href=/diary/posts/2022/0422/#ワーケーションのリトライ>ワーケーションのリトライ</a> の最終確認ならびに共有事項の打ち合わせをした。今回は3回目のワクチン接種をし終えたばかりだし、オミクロン株も一応は収束したみたいな雰囲気になっているので延期することはないはず。旅程の確認を一通りしつつ、少し雑談していた。今後の開発合宿のような取り組みをコミュニティでやるのか、会社でやるのかはまだわからないけど、そういう取り組みも非日常の刺激を受ける機会だったり、普段やらないことでなにか新しい価値を見い出す行動だったりにつなげられればと考えている。今回はそのためのリハーサルなのでたくさん失敗しつつノウハウを溜めていきたい。</p><h2 id=もくもく会>もくもく会</h2><p><a href=https://kobe-sannomiya-dev.connpass.com/event/246658/>【三宮.dev】もくもく会</a> に参加した。オフライン開催で参加者は6人。他者と雑談しながら作業するというのを、久しぶりにやった感じだった。私は jjug ccc 2022 spring の資料作りをしていた。骨子レベルの内容はだいたいできたので後はスライド資料を作り込むだけ。今回はビデオ撮影を事前しないといけないのが初めての試み。でも、当日は質疑応答だけでよいから楽になってこれはこれで有りだとは思う。終わってからワーケーションの参加者3人で軽く飲みに行ってきた。勉強会へ行って飲み会でわいわいやって帰るみたいな昔の勉強会の雰囲気に戻った感じがして懐かしかった。地域コミュニティはこういうつながりもあっていいと思う。バックエンド周りのバッチ処理の最適化で話題になったときに「私を雇え、値段は高いけど」と宣伝したりもしてた。自分の会社をやっていると、こういうノリでお仕事がきてもまぁいっかみたいな気持ちになれるからそれも含めて楽しい。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0514/>漫画ばかり読んでる</a></h1><div class=post-meta><time class=post-date>2022-05-14 (Sat.) ::</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/comic/>comic</a>&nbsp;</span><div class=post-content><p>漫画を読みながら寝て5時半に起きて漫画読んで8時に起きた。今日はほとんど漫画読んでた。</p><h2 id=ストレッチ>ストレッチ</h2><p>今週は漫画ばかり読んでいたせいか、体が硬くなってしまっていた。今日の開脚幅は開始前153cmで、ストレッチ後158cmだった。今週は雨降りの日が多くて徒歩通勤する機会が多かった。普段よりは運動したような気はしていたけど、ストレッチの数値はよくなかった。疲労度は腰がもっとも蓄積していて、肩甲骨周りも相変わらず硬い。ベッドで漫画ばかり読んでたから不健康になってしまったのかもしれない。</p><h2 id=神之塔>神之塔</h2><p>先週ぐらいから <a href="https://manga.line.me/product/periodic?id=Z0000197">神之塔</a> を読み始めた。少し前 (と言っても2年前) に <a href=https://tog-anime.com/>アニメ化</a> されていて、当時たまたまみたらおもしろかったので印象に残っていた。一言でこの作品を表すと「基本的に訳がわからないのだけど、おもしろい」といったところ。私は普段 LINE を使っていないので LINE と密接なアプリやプラットフォームも使っていない。神之塔は LINE マンガでしか読めないみたいなのでこの漫画を読むために仕方なくインストールした。通常は1日1話しか無料で読めないけど、なにかのキャンペーン期間中は100話ぐらい無料で読めたりする。数日前からキャンペーン期間になっているので読んでいて疲れたら寝て起きたら読むみたいな生活をしている。300話まで読んだ。50話から100話ぐらいで1つのエピソードが終わるのでテンポもいい。おもしろい。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0513/>マーケティング施策の取り組み開始</a></h1><div class=post-meta><time class=post-date>2022-05-13 (Fri.) ::</time></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/cdk/>cdk</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;</span><div class=post-content><p>23時に寝て1時に起きて漫画を読んで6時に起きて漫画読んでた。</p><h2 id=隔週の雑談>隔週の雑談</h2><p>顧問のはらさんと隔週の打ち合わせ。今日の議題は <a href=/diary/posts/2022/0503/#打ち合わせ資料の作成>先日作成した第4期の展望</a> について雑談した。あまり深く考えずに起業して初期の頃に作った10ヶ年計画に対してわりとその通りに推移している。来期ぐらいで業務委託のお仕事は終える予定。来期か再来期ぐらいからプロダクト開発の期間に入る。自社プロダクトを作る前から徐々にマーケティングもしていかないといけない。そのため、今期からマーケティング施策を少しずつ増やしていて、まずは会社の信頼度を上げるところからやっていく。売上を上げるためのマーケティングではなく信頼度を上げるためのマーケティングを行う。金森氏が言うようにどんなに優れたプロダクトを作ったとしても売れるかどうかは別問題だ。</p><iframe width=500 height=250 scrolling=no src="https://alu.jp/series/%E6%98%A0%E5%83%8F%E7%A0%94%E3%81%AB%E3%81%AF%E6%89%8B%E3%82%92%E5%87%BA%E3%81%99%E3%81%AA%EF%BC%81/crop/embed/X8MNLWdDgPeZ5RIF25sD/0?referer=oembed" style=margin:auto></iframe><h2 id=eks-クラスターの-helm-管理の調査>eks クラスターの helm 管理の調査</h2><p>昨日の続き。権限設定がなんもわからんみたいな様相になったので調査のやり方を変えることにした。検証用の eks クラスターを cdk から新規に作成して helm をインストールするときのリソースや権限設定がどうなるのかを調査した。lambda 関数が5個ぐらい、ロールは10個ぐらい作成された。lambda の生成に時間がかかるのか？新規作成するのに25分、削除するときは30分ぐらいかかった。rds もそうだけど、eks のような複雑なインフラを cdk で管理すると実行するのにけっこう時間がかかる。設定が難しくなければ別によいけど、eks のような権限やリソースの設定が複雑なインフラはトライ&エラーで何度も実行する必要があるから、こういうものは cdk で管理するのには向かないインフラだと言えると思う。一定の設定のプラクティスが溜まるまでは eks は cdk で管理しない方がよいかもしれない。</p><p>CreationRole というのが設定されて trust relationships に次のような設定が追加される。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Version&#34;</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Statement&#34;</span>: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Principal&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;AWS&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:iam::${accountId}:root&#34;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;sts:AssumeRole&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>このロールに含まれるカスタムポリシーには次のような設定がある。たぶんこんな感じのロールを新規に作成して <code>kubectlRoleArn</code> として指定してやればいいんじゃないかと思う。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Version&#34;</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Statement&#34;</span>: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;iam:PassRole&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:iam::${accountId}:role/${EksClusterIamRole}&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Action&#34;</span>: [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;eks:CreateCluster&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;eks:DescribeCluster&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;eks:DescribeUpdate&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;eks:DeleteCluster&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;eks:UpdateClusterVersion&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;eks:UpdateClusterConfig&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;eks:CreateFargateProfile&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;eks:TagResource&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;eks:UntagResource&#34;</span>
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Resource&#34;</span>: [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;arn:aws:eks:ap-northeast-1:${accountId}:cluster/tmp-test-eks-cluster-by-morimoto&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;arn:aws:eks:ap-northeast-1:${accountId}:cluster/tmp-test-eks-cluster-by-morimoto/*&#34;</span>
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Action&#34;</span>: [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;eks:DescribeFargateProfile&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;eks:DeleteFargateProfile&#34;</span>
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:eks:ap-northeast-1:${accountId}:fargateprofile/tmp-test-eks-cluster-by-morimoto/*&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Action&#34;</span>: [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;iam:GetRole&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;iam:listAttachedRolePolicies&#34;</span>
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;*&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;iam:CreateServiceLinkedRole&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;*&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Action&#34;</span>: [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;ec2:DescribeInstances&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;ec2:DescribeNetworkInterfaces&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;ec2:DescribeSecurityGroups&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;ec2:DescribeSubnets&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;ec2:DescribeRouteTables&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;ec2:DescribeDhcpOptions&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;ec2:DescribeVpcs&#34;</span>
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;*&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0512/>cdk と eks と lambda と iam がわからん</a></h1><div class=post-meta><time class=post-date>2022-05-12 (Thu.) ::</time></div><span class=post-tags>#<a href=/diary/tags/cdk/>cdk</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;</span><div class=post-content><p>0時に寝て3時に起きて漫画読んで5時に寝て8時に起きた。</p><h2 id=eks-クラスターの-helm-管理>eks クラスターの helm 管理</h2><p>昨日の続き。helm のよさはわかったので dapr を helm で管理しようとしている。その際になるべく cdk で管理できた方がよい。eks は cdk の外部で管理しているのだけど、既存の eks クラスターをインポートする機能も提供されていることに気付いた。</p><ul><li><a href=https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_eks-readme.html#using-existing-clusters>Using existing clusters</a></li></ul><p>それなら既存の eks クラスターをインポートして cdk で helm だけ管理しようと思って始めたものの、これがとても難しくて丸1日作業してわからなかった。設定項目は少ないけど、権限の問題で動かない。1回あたりの実行に15分ぐらいかかるのでトライ&エラーするのもなかなか大変。</p><blockquote><p><code>kubectlRoleArn</code> - the ARN of an IAM role mapped to the system:masters RBAC role. If the cluster you are importing was created using the AWS CDK, the CloudFormation stack has an output that includes an IAM role that can be used. Otherwise, you can create an IAM role and map it to system:masters manually. The trust policy of this role should include the the arn:aws::iam::${accountId}:root principal in order to allow the execution role of the kubectl resource to assume it.</p></blockquote><p><code>kubectlRoleArn</code> の設定をどうするかだけなんだが、この説明でどう設定していいか理解できなかった。cdk で新規に eks クラスターを作成するなら自動で作ってくれるけど、既存の eks クラスターの場合は自分で設定しないといけない。ややこしいことに cdk は kubectl の実行を lambda 経由で実行するので eks と lambda と iam のロールやポリシーを適切に設定する必要がある。lambda にどういう権限を設定するのが適切なのかは本当に難しい。サーバーレスはよいアイディアだとは思うけど、lambda は難し過ぎて私はなるべく使いたくないサービスではある。結局わからなくて翌日に持ち越し。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0511/>helm を調べた</a></h1><div class=post-meta><time class=post-date>2022-05-11 (Wed.) ::</time></div><span class=post-tags>#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;
#<a href=/diary/tags/helm/>helm</a>&nbsp;</span><div class=post-content><p>1時に寝て6時半に起きて8時に起きた。前日は資料づくりで遅くまでオフィスに残っていたせいか、なんか寝坊した。</p><h2 id=helm-調査>helm 調査</h2><p><a href=/diary/posts/2022/0201/#kubernetes-のログ管理と-datadog-agent-のログ連携不具合>k8s 上の datadog-agent</a> が <a href=https://helm.sh/>helm</a> で管理されていて、あるバージョンから <a href=https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-deploy/#install-with-helm-advanced>dapr も helm 管理できる</a> ようになった。dapr は cli からもインストールできるけど、helm のことをよくわかってなかったので調べることにした。そんなたくさん記事をみたわけではないけど、いくつか記事を読んで quora のやり取りが一番よかった。</p><ul><li><a href=https://www.quora.com/When-should-you-use-Kubernetes-Helm-and-not-use-it>When should you use Kubernetes Helm and not use it?</a></li></ul><p>ざっくりまとめるとこうかな。</p><ul><li>helm は oss 且つ cncf の公式プロジェクトだからまぁ安心</li><li>helm はサードパーティのパッケージのインストールや設定の利便性を高める<ul><li>k8s はテンプレート機能が弱いので共通設定と特定環境向けの設定を管理するのがあまり得意ではない</li><li>セキュリティを考慮した k8s 設定は自分でやるよりコミュニティに任せた方がよい場合もある</li><li>パッケージなのでバージョン管理は得意</li></ul></li><li>helm は k8s 向けのパッケージマネージャとレポジトリマネージャーとマーケットプレイスを組み合わせたみたいなもの</li></ul><p>k8s 上でサードパーティのパッケージを自分で設定したい特別な理由がない限りは helm を使うのがよさそうという結論になった。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0510/>スライドデザインのレビュー</a></h1><div class=post-meta><time class=post-date>2022-05-10 (Tue.) ::</time></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;</span><div class=post-content><p>1時に寝て6時半に起きた。</p><h2 id=スライドマスターのデザインレビュー>スライドマスターのデザインレビュー</h2><p>はらさんと一緒にレビューした。私とは全然視点が違うので参考になった。自分が得意ではない分野の相談相手がいると本当に助かる。いくつか取り上げる。あれこれ、私が気になったところもヒアリングしながら意見をもらった。あとでデザイナーさんにフィードバックする。</p><ul><li>外国人が作ると文字のレイアウトが日本語と異なることを考慮する必要がある<ul><li>日本語には y や q のような下にはみ出る文字がない</li></ul></li><li>スライド全体の色使いで目立たせるときの注目色を作ってもらった方がよい</li><li>インジケーターのようなデザインがあると聴衆がいま発表のどの辺りかわかって嬉しい</li><li>会社の自己主張が強過ぎない方がよさそう</li></ul></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0509/>スライドデザインの作成</a></h1><div class=post-meta><time class=post-date>2022-05-09 (Mon.) ::</time></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/migration/>migration</a>&nbsp;</span><div class=post-content><p>0時に寝て4時に起きて6時半に起きたつもりが、なんか3度寝して8時に起きた。</p><h2 id=スライドマスターのデザイン作成>スライドマスターのデザイン作成</h2><p>うちの会社のロゴは <a href=https://99designs.jp/profiles/dsevarika>Ševarika™</a> というデザイナーさんに作ってもらった。言語にセルビア語とあるので旧ユーゴスラビア地域の国の出身なのかなと推測する。このご時世なので NATO 加盟国なのだろうか？とか調べてみたけど、旧ユーゴスラビア地域の国々の歴史は複雑ですぐにわかるものではなかった。閑話休題。私は会社のロゴをとても気に入っているし、ロゴを作ってもらうときの取り引きも円滑にできたのでそのデザイナーさんを信頼している。今回も2年半ぶりに連絡をとったら快くスライドマスターの作成を引き受けてくれた。4月30日に契約して、とくに急いでいないのでデザイナーの都合がついたらでという緩い依頼をしたんだけど、昨日さっそく最初の草稿が届いた。いくつか私の好みのスライドデザインのサンプルを渡したりしていたので、私の好みのスタイルは外していない。ただ私はデザインのことは何もわからないので、今回は顧問のはらさんにもレビューしてもらってご意見をもらうことにした。</p><h2 id=ベースライン移行>ベースライン移行</h2><p>先日の <a href=/diary/posts/2022/0506/#データベースの移行処理>flyway のデータベース移行</a> の続き。管理しているマイクロサービスが4つあるのでそれぞれのサービスごとに設定していかないといけない。サーバーサイドって共通化できるのが大きなメリットなのに、同じサーバーサイドの仕組みを複数導入しないといけないというのはマイクロサービスのデメリットと言えばそうだし、アーキテクチャとしても正しいんやろか？という気持ちも出てくる。おそらく1つのチームが複数のマイクロサービスを開発する体制がよくない。変更作業と検証で約1日を費やした。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0508/>法人決算の続き</a></h1><div class=post-meta><time class=post-date>2022-05-08 (Sun.) ::</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;</span><div class=post-content><p>0時に寝て5時半に起きた。実家にいると、親が5時ぐらいから起き始めるのでつられて早めに起きている。親が8時からアルバイトなのでそのタイミングでバス停に送ってもらって9時半には戻ってきた。</p><h2 id=消費税申告書と欠損金の還付請求書の作成>消費税申告書と欠損金の還付請求書の作成</h2><p>先日から <a href=/diary/posts/2022/0505/#法人決算>法人決算に着手</a> していた。</p><p>まずは消費税の申告書と未払い消費税の振替伝票の起票をしていた。初めての会計処理でいろいろ調べてた。<a href=https://www.nta.go.jp/taxes/shiraberu/taxanswer/shohi/6610.htm>No.6610 法人に係る消費税の確定申告書の提出期限について</a> によると、消費税の申告期限も法人決算と同様、課税期間 (事業年度) の終了の日から2ヶ月以内に行う必要がある。厳密には消費税にも2種類あって国税と地方税にわけられる。地方消費税は国税ではなく地方税であるため、本来は都道府県に納税すべきものではあるが、手続きの利便性のため？なのか、国税と一緒に所管税務署へ納付するのでよいらしい。</p><ul><li><a href=https://biz.moneyforward.com/tax_return/basic/70/#i>消費税とは？地方消費税とは？</a></li></ul><p>つぎに前期は赤字なので前々期に支払った法人税と地方法人税の一部を還付してもらう。前々期の所得と支払った法人税、前期の欠損金 (マイナスの所得に対する法人税法上の用語) の3つの数字があれば算出できる。計算してみたら支払った法人税のうち26.4%を還付できることがわかった。算出後に請求書をダウンロードして書類に数字を記入した。</p><h2 id=ストレッチ>ストレッチ</h2><p>いつもは土曜日の10時に通っているが、実家に帰っていたので予定変更。今日から新しいトレーナーさんに師事することになる。今日の開脚幅は開始前160cmで、ストレッチ後162cmだった。昨日、草刈りをして筋肉痛になっていたのでそんなもんかな。腕と腰に張りがあった。新しいトレーナーさんも初めてなのでまずはどこの筋が張っていて、どこの関節が詰まっているかを確認しながら進めていくといった感じだった。話しを聞いていたら、新しいトレーナーさんも前のトレーナーさん同様、筋トレをしていて、週3日ぐらいはやっているらしい。やっぱりトレーナー業をする人は筋トレに興味をもつ人が多いのかもしれない。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0507/>アボカドを植えた</a></h1><div class=post-meta><time class=post-date>2022-05-07 (Sat.) ::</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;</span><div class=post-content><p>1時に寝て4時に起きて6時半に起きた。なんか寝付けない。とくに用事があるわけでもないのだけど、たまに実家に帰らないといけないので帰る。病院へお見舞い行って、草刈りして、焼肉食べて、温泉入って実家でくつろいでた。</p><h2 id=アボカドを植える>アボカドを植える</h2><p>1ヶ月半前から水耕栽培を始めたアボカドの種から根が出始めた。いくつか持って帰って土に植えてもらうことにした。<a href=http://www.lifecorp.jp/>ライフ</a> に売っているアボカドは他のスーパーよりも100円ぐらい高いけれど、ハズレがなくておいしい。アボカドはライフでしか買わなくなった。そのアボカドの種なのできっとおいしいアボカドの木になるはず。種から育てると実をつけるには10年ぐらいかかるという。さらに1年おきしか実をつけないみたい。実をつけなくても観葉植物として育てるという趣もあるみたい。</p><ul><li><a href=https://kurashi-no.jp/I0026458>アボカド栽培に挑戦！種から収穫までの上手な育て方をご紹介！剪定方法のコツも！</a></li></ul><figure><img src=/diary/img/2022/0507_avocado.jpg></figure></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0506/>flyway を触ってみた</a></h1><div class=post-meta><time class=post-date>2022-05-06 (Fri.) ::</time></div><span class=post-tags>#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/database/>database</a>&nbsp;
#<a href=/diary/tags/migration/>migration</a>&nbsp;</span><div class=post-content><p>0時に寝て4時に起きてタイムライン眺めながらだらだらして6時半に起き上がった。</p><h2 id=データベースの移行処理>データベースの移行処理</h2><p>半年前から導入したいという話しは聞いていたものの、先送りになっていたライブラリに <a href=https://flywaydb.org/>flyway</a> がある。データベースの移行処理のためのスクリプト (sql) を管理するツールでどの移行スクリプトを実行したかを記録したり、未適用の処理を自動で適用してくれたりする。spring boot だとすぐ組み込める状態になっていて <a href=https://flywaydb.org/documentation/usage/plugins/springboot>Community Plugins and Integrations: Spring Boot</a> をみながら設定したらすぐに動いた。flyway 自体の設定も <a href=https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html>Common Application Properties</a> を参考に spring boot の設定ファイルで行える。</p><p>例えば、こんな感じ。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>flyway</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>￼    enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#f92672>￼    schemas</span>: <span style=color:#ae81ff>public</span>
</span></span><span style=display:flex><span><span style=color:#f92672>￼    locations</span>: <span style=color:#ae81ff>classpath:db/migration</span>
</span></span><span style=display:flex><span><span style=color:#f92672>￼    baseline-version</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>￼    baseline-on-migrate</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>移行処理の履歴情報は <code>flyway_schema_history</code> テーブルに保持される。既存のテーブルが存在して flyway の履歴データがない場合 (初回起動時) に移行処理を実行するかどうかを baseline-on-migrate で決める。実行するなら baseline-version でどのバージョンをベースラインとするかも設定できる。ゼロにすることで <code>V1</code> からの sql ファイルを適用してくれる。ベースラインの考え方は実際に何度かデータベースの初期状態を変えて実行しないとわかりにくいかもしれない。</p><ul><li><a href=https://flywaydb.org/documentation/tutorials/baselineMigrations>Tutorial: Baseline Migrations</a></li></ul></div></article><div class=pagination><div class=pagination__buttons><a href=/diary/posts/page/60/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span>
</a><a href=/diary/posts/page/62/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>