<!doctype html><html lang=en><head><title>Posts :: forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/posts/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="Posts"><meta property="og:description" content><meta property="og:url" content="/diary/posts/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/posts/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1022/>田んぼ作業 1日目</a></h1><div class=post-meta><time class=post-date>2022-10-22 (Sat.) ::</time></div><span class=post-tags>#<a href=/diary/tags/agriculture/>agriculture</a>&nbsp;
#<a href=/diary/tags/day-off/>day off</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;</span>
<img src=/diary/img/2022/1022_field-before.jpg class=post-cover alt="田んぼ作業 1日目" title="Cover Image"><div class=post-content><p>親が4時に起きてくるので一緒に起きて、なんか話して、6時ぐらいまでだらだらしてた。10月だと6時とか外も暗いしね。7時ぐらいから田んぼに出掛けていった。</p><h2 id=田んぼ作業-1日目>田んぼ作業 1日目</h2><p>雨降りで2週流れて3度目の正直。草場になっていた田んぼをトラクターで耕した。中途半端に作物を植えたりしているので空きスペースの草場になっているところだけを耕した。12時前には終えてたかな。朝早くから始めると涼しいので作業が捗る。</p><p><figure><img src=/diary/img/2022/1022_field-after1.jpg></figure><figure><img src=/diary/img/2022/1022_field-after2.jpg></figure></p><p>田んぼを耕したときはいつも facebook にも写真をアップしている。なぜか今回はいつもよりいいねが多かったように思う。たまたまみた人もいるのかもしれないけど、お昼ご飯にこんなもの食べたという料理の写真より、見栄えのない田んぼの写真の方が多くのいいねを集めるのはまったく理解できない。田んぼの写真のどこに関心があるのだろうか？</p><h2 id=お見舞い>お見舞い</h2><p>15時頃に戻ってきて16時から父のお見舞い。通常はタブレットでリモート面会を行う。前週にたまたまリモート面会する部屋が空いてなくて母がリアル面会できたそうで、私が来ているから同じようにできないか？と看護師さんに頼んだらそうしてくれた。もうコロナも落ち着きつつあるから病院側の壁も低くなりつつある。但し、リアル面会は1人10分 (リモート面会は20分) という決まりがあるそうで、私を優先したので母は面会できなかった。5分ずつ交代はできないか？と聞いたけど、それは不可とのこと。素人考えでは合理的な理由はなく決まりだからというようにみえた。もしかしたら1年以上、父とリアル面会してなかったかもしれない。意思疎通はできないけれど、顔色もよく元気そうにはみえた。少し前に床ズレで細胞が壊死してその部位を手術で切断したという話しを聞いていた。経過も良好ということでぱっと見た感じでは不具合があるようにはみえなかった。10分近況を話してお見舞いを終えた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1021/>夕方から実家帰り</a></h1><div class=post-meta><time class=post-date>2022-10-21 (Fri.) ::</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/movie/>movie</a>&nbsp;</span><div class=post-content><p>21時に寝て何度か起きながらも睡眠をとって6時に起きた。眠れなくなってなんか疲れが溜まっている気がする。いつも通り淡々と開発してた。</p><h2 id=早退け>早退け</h2><p>翌日に朝から田んぼ作業をするため、17時にはオフィスを出て帰り支度をして高速バスで実家に帰る。平日の18時40分発という帰宅時間だったせいか、わりとバスは混雑していてほぼ満席だった。こんな時間に淡路島行きのバスに乗ったことがなかったので通勤で使っている人もいるんやろなと思う。20時ぐらいに最寄りのバス停に着いて20時半には実家に帰れた。</p><h2 id=るろうに剣心-最終章-the-beginning>るろうに剣心 最終章 The Beginning</h2><p>たまたま金曜ロードショーで <a href=https://wwws.warnerbros.co.jp/rurouni-kenshin2020/home_entertainment/beginning.php>るろうに剣心 最終章 The Beginning</a> をやっていた。実写版の他のるろうに剣心をみたことないけど、漫画から実写になっているものは大抵つまらないだろうという先入観があった。しかし、この作品はおもしろかった。言うても、るろうに剣心の原作ファンがみないとぼそぼそ喋るお侍が殺し合いする訳の分からない映画にしかみえないとは思う。おそらく原作ファン向けの映画なんだとは思うけれど、その世界観を知っている人向けに、超人的な技とかなくて達人の域での殺し合いにおける緊張感と原作のストーリーがマッチしてて映画としてよかったと思う。あと斉藤一の牙突もかっこよかった。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1020/>オフィスの引っ越しが確定</a></h1><div class=post-meta><time class=post-date>2022-10-20 (Thu.) ::</time></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;</span><div class=post-content><p>2時に寝て5時前に起きて7時に起きた。いつも通り淡々と開発してた。</p><h2 id=窓付きオフィスの契約>窓付きオフィスの契約</h2><p><a href=/diary/posts/2022/1014/#窓付きのオフィスの連絡>窓付きのオフィスを法人契約に切り替える</a> 手続きを進めていた。登記事項証明書を写真に撮って必要書類をまとめて申請していた。無事に審査も通過して契約書が送られてきたので内容を精査して、クラウドサインだったので契約締結も円滑に進められた。いま風に言えば DX だろうけれど、契約を紙の書類でやらなくてよいのは手間暇が少なくて嬉しい。すぐに契約金も支払って引っ越しの日程を12月3-4日と定めた。取引先に迷惑がかからないよう、土日にこっそりと引っ越しする。なにもしていないのに自分の希望が叶うといった事象が起きると生きていてよかったなと思うことが多い (大袈裟過ぎるが) 。そんなこと人生で稀にしかないと思うんだけど、長生きしているとたまにそういうことがある。オフィスの引っ越しできるのが嬉しくて多くの人に話してしまった。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1019/>イベントはしご</a></h1><div class=post-meta><time class=post-date>2022-10-19 (Wed.) ::</time></div><span class=post-tags>#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/management/>management</a>&nbsp;</span><div class=post-content><p>1時に寝て4時に起きて6時に起きた。</p><h2 id=jackson-の-tips>jackson の tips</h2><p>jackson で調べているとググったときに stackoverflow に書いてある内容が、機能的には正しいけれど、deprecated になっているアノテーションが多々ある。そのときに新しいやり方はどう設定していいか分からないということがある。今日たまたま実装した処理に2つアノテーションが出てきたので備忘録として書いておく。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@JsonNaming</span><span style=color:#f92672>(</span>PropertyNamingStrategies<span style=color:#f92672>.</span><span style=color:#a6e22e>SnakeCaseStrategy</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)</span>
</span></span></code></pre></div><ul><li>デシリアライズするときに <code>my_field</code> のようなスネークケースのフィールド名を <code>myField</code> のメンバーにマッピングする</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@JsonIgnoreProperties</span><span style=color:#f92672>(</span>ignoreUnknown <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>)</span>
</span></span></code></pre></div><ul><li>デシリアライズするときに json に存在してクラスに存在しないフィールドを無視する</li><li>データ構造の移行時にエラーを出さないとか、不要なフィールドがあるときに設定するとよい</li></ul><h2 id=上司道-リーダーはレジリエンスを高める自己肯定感を学ぼう>上司道 リーダーはレジリエンスを高める自己肯定感を学ぼう</h2><p>以前 <a href=/diary/posts/2022/1005/#SECI-モデルのワークショップ>SECI モデルのワークショップ</a> に参加して、同じチームにおられた方が <a href=https://tomoaki2222ok.wixsite.com/mysite>上司道</a> という勉強会コミュニティを運営しているのでお誘いを受けた。せっかくの縁だと思ったのでコミュニティに参加した。その勉強会で <a href=https://self-esteem.or.jp/>日本セルフエスティーム普及協会</a> の工藤氏による自己肯定感の紹介イベントがあったので試しに参加してみた。</p><p>軽く私の自己肯定感をチェックしてみると普通。低くも高くもない。私はどこかのタイミングで他人と比較するのをやめた。それは自己肯定感を高めるためにはよい慣習らしい。そのおかげで私は自己肯定感が低くはないようにみえる。自己肯定感には社会的と絶対的の2つの構成概念がある。</p><ul><li>社会的自己肯定感</li><li>絶対的自己肯定感</li></ul><p>重要なのは絶対的の方になるらしいが、多くの人は社会的の方が割合として大きいらしい。社会的に頼っていると、キャリア戦略に失敗したり、会社でリストラされたりすると自尊心が傷つきやすくなる。私もこのタイプだと思う。近い将来リストラされることを想定して自分の会社を作ったという背景もある。自分の会社があると、自分で自分をリストラしない限りは集団に帰属しているという社会的欲求を満たせる。それが社会的自己肯定感と関係があるように思える。いまの私の環境は自尊心が傷つきやすい状況ではないため、あまりセミナーの内容には関心をもてなかった。それよりも参加者が共有していた自尊心を脅かされる状況の経験談にひどいものが多くて、それらと比べると私の環境は恵まれていて世の中に感謝する気持ちになった。</p><h2 id=後藤達也さんのオンラインミーティング>後藤達也さんのオンラインミーティング</h2><p>たまたま21時半からコアメンバー向けの zoom ミーティングを行うという投稿をみかけたので参加してみた。2時間ぐらいやってたのかな？軽く聞いて帰ろうと思っていたものの、なんだかんだで最後まで参加していた。</p><ul><li><a href=https://note.com/goto_finance/n/nc4140548387a>【募集停止します】月980円プラン</a></li></ul><p>軽く計算すると note のメンバーシップだけで約774万円/月の売上になる。すごい。</p><blockquote><p>(500 * 9577) + (3016 * 980) = 7,744,180</p></blockquote><p>こんな儲かっているサブスクリプションの新規募集を停止する背景として、これ以上コアメンバーが増えてもコミュニティとしての運営が難しくなるからやりたくないのだという。例えば、すでに3000人いるが、この人数でオフ会を開催することはできない。月々の料金を高くしてメンバー数を減らすというのが経済学的な解であることは理解しているが、後藤さん1人で提供しているようなサービスに月980円を超える料金をとることに抵抗感があるから値段をあげたくないと話されていた。とても謙虚な人だと思う。コミュニティ運営を難しくせず料金もあげないという戦略からコアメンバーをこれ以上増やさないという判断をしたそうだ。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1018/>dapr のアップグレード準備</a></h1><div class=post-meta><time class=post-date>2022-10-18 (Tue.) ::</time></div><span class=post-tags>#<a href=/diary/tags/dapr/>dapr</a>&nbsp;
#<a href=/diary/tags/rabbitmq/>rabbitmq</a>&nbsp;</span><div class=post-content><p>1時に寝て7時に起きた。寝る前に閃光のハサウェイを見始めたら夜更ししてしまった。</p><h2 id=dapr-の-highly-available-モードの検証>dapr の Highly-available モードの検証</h2><p>先週からテスト環境で dapr の <a href=https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-production#highly-available-mode>Highly-available mode</a> を試している。ついでに dapr の 1.8.x へのアップグレードも行う。<a href=https://blog.dapr.io/posts/2022/07/08/dapr-v1.8-is-now-available/>Dapr v1.8 is now available</a> をみると、一番上に書いてあるのだから pubsub サービスの Dead letter topics がもっとも注目すべき新機能と言えるのだろう。これは pubsub のミドルウェアすべての Dead letter topics の機能が実装されたことを言っている。うちは rabbitmq を使っていて、それは次の pr で v1.5 で追加されていて、うちの環境では v1.7 から実運用していた。rabbitmq は Dead letter topics 対応が始まった初期のうちに実装されたと言える。</p><ul><li><a href=https://github.com/dapr/components-contrib/pull/883>Add dead letter support in RabbitMQ pubsub #883</a></li></ul><p>現時点での dapr の最新の安定版は 1.8.5 になる。</p><ul><li><a href=https://github.com/dapr/dapr/releases/tag/v1.8.5>https://github.com/dapr/dapr/releases/tag/v1.8.5</a></li></ul><p>Highly-available を有効にする設定ファイル values.yml の書き方は次になる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>global</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ha</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>来週には本番環境への適用&アップグレード作業を行うので wiki の作業手順のドキュメントを書いてた。</p><p>helm リポジトリ設定の更新。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ helm repo add dapr https://dapr.github.io/helm-charts/
</span></span><span style=display:flex><span>$ helm repo update
</span></span><span style=display:flex><span>$ helm search repo dapr --versions | grep 1.8.5
</span></span><span style=display:flex><span>dapr/dapr	1.8.5        	1.8.5      	A Helm chart <span style=color:#66d9ef>for</span> Dapr on Kubernetes
</span></span></code></pre></div><p>任意の設定を施した values.yml を指定して dapr をアップグレードする。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ helm upgrade dapr dapr/dapr --version 1.8.5 --namespace dapr-system --values ./values.yml --wait
</span></span></code></pre></div><p>dapr はデフォルトで <code>dapr-system</code> という名前空間を使う。アップグレードした helm のパッケージ情報を確認する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ helm list -n dapr-system
</span></span></code></pre></div></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1017/>副反応終わり</a></h1><div class=post-meta><time class=post-date>2022-10-17 (Mon.) ::</time></div><span class=post-tags>#<a href=/diary/tags/cdk/>cdk</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;</span><div class=post-content><p>0時に寝て7時半に起きた。久しぶりによく寝た。ワクチン接種の副反応はおさまり体調は回復した。昼間は UI 改善やバグ修正をしていた。</p><h2 id=インフラ勉強会>インフラ勉強会</h2><p>引き継ぎを兼ねて cdk の使い方、簡単な本番環境向けのデプロイ作業を共有した。wiki に一通りの説明は書いてあって、実際に cdk アプリケーションのソースや設定をみたり、cloud formation のドリフトを検出して解消するのを実践したりしてた。そんな中、別の不具合もみつけた。rds のデータベースのバージョン情報が次のように差分として出力される。</p><pre tabindex=0><code>Resources
[~] AWS::RDS::DBInstance GodPostgreSQL/Instance1 GodPostgreSQLInstance1857D2683
 └─ [-] EngineVersion
     └─ 13.6
</code></pre><p>少し前にたまたま cdk のバージョンを 2.44.0 にアップグレードしてあったのだけど、この差分は 2.44.0 以降で発生する。次の issue の説明によると、メジャーバージョンをまたぐ rds のアップグレードを cdk で実行すると、Stack が回復不能な状態になるのでそのワークアラウンドとしてバージョン情報をみえなくしてしまって、誤って cdk で rds のアップグレードできないようにしているとのこと。この差分はとくに気にする必要なく、一度デプロイしてしまえば次回からは出力されなくなる。インフラにも影響は与えないとのこと。</p><ul><li><a href=https://github.com/aws/aws-cdk/issues/21758>(rds): AWS::RDS::DBInstance should not have EngineVersion property set for Aurora clusters #21758</a></li></ul><p>過去にマイナーバージョンアップは試したことがあって、やはりエラーにはなるのだけど、実際のインフラはアップグレードされて、それで運用上は問題なかったようにみえる。但し、cdk 正しく rds のアップグレードを扱えないというのは確かであるようにみえる。</p><blockquote class=twitter-tweet><p lang=ja dir=ltr>試しに今日 aurora postgresql のバージョンを 13.4 から 13.6 にアップグレードしたらデプロイは失敗してるのに実際のインフラはアップグレードして、cf のテンプレートが実際のインフラと不整合になった。手動でテンプレートを更新して cdk のコードと同期する必要がある。</p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1517831237997838336?ref_src=twsrc%5Etfw">April 23, 2022</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1016/>安静状態</a></h1><div class=post-meta><time class=post-date>2022-10-16 (Sun.) ::</time></div><span class=post-tags>#<a href=/diary/tags/day-off/>day off</a>&nbsp;</span><div class=post-content><p>2時に寝て8時に起きた。前日遅くまで飲み歩いてたのと、ワクチン接種後の発熱もあったから安静にしようと思って基本的に一日中寝てた。</p></div></article><div class=pagination><div class=pagination__buttons><a href=/diary/posts/page/57/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span></a>
<a href=/diary/posts/page/59/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>