<!doctype html><html lang=en><head><title>Posts :: forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/posts/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="Posts"><meta property="og:description" content><meta property="og:url" content="/diary/posts/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/posts/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1215/>おいしい 🦀 を食べに行く</a></h1><div class=post-meta><time class=post-date>2023-12-15 (Fri.) ::</time></div><span class=post-tags>#<a href=/diary/tags/docker/>docker</a>&nbsp;
#<a href=/diary/tags/container/>container</a>&nbsp;
#<a href=/diary/tags/network/>network</a>&nbsp;
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
#<a href=/diary/tags/community/>community</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;</span><div class=post-content><p>22時頃に寝てしまって1時に起きて5時に起きて6時過ぎに起きた。とくになにもしていないのにバテている気がする。今週はずっと mongodb のレプリカセットの調査やインフラの移行作業などをやっていたせいか、普段よりもエネルギーを消費しているのかもしれない。朝から疲労困憊でオフィスへ向かった。</p><h2 id=docker-のコンテナネットワークの調査>docker のコンテナネットワークの調査</h2><p>docker のコンテナネットワークから解決できる名前がなになのか、よくわかってなくて、その調査のためにサンプルの compose サービスを作った。</p><ul><li><a href=https://github.com/t2y/docker-compose-sample>https://github.com/t2y/docker-compose-sample</a></li></ul><p>myimage から nginx のコンテナの名前解決がどうなるかを試してみる。</p><pre tabindex=0><code>c67a5ca94a77:/app# dig +short 00c719491558
192.168.240.3
c67a5ca94a77:/app# dig +short mynginx
192.168.240.3
c67a5ca94a77:/app# dig +short nginx
192.168.240.3
c67a5ca94a77:/app# dig +short yournginx
192.168.240.3
</code></pre><p>基本的にはサービス名、コンテナ名 (container_name)、コンテナー ID、ホスト名 (hostname) はすべて名前解決できる。hostname があるときはそのコンテナの /etc/hosts にその名前が追加され、ないときはコンテナ ID が追加されていた。</p><pre tabindex=0><code>yourcontainer:/app# cat /etc/hosts
127.0.0.1	localhost
...
172.18.0.3	yourcontainer
</code></pre><h2 id=冬の開発合宿の準備>冬の開発合宿の準備</h2><p><a href=/diary/posts/2023/0526/#開発合宿の日程確定>日程を決めたのが5月末</a> で、うちの会社のワークスペースに slack のチャンネルを開設したのが10月。現時点で7人の参加者がいる。もうこのメンバーでいいかなと考えている。今回はコミュニティのワーケーションイベントというより、自社の開発合宿という体をとっている。スポンサーとしていくらか会社からお金も出す。その理由の1つは slack チャンネルにログを残したいという意図がある。コミュニティの slack だとフリープランになるので3ヶ月以上過去のログがみえなくなってしまう。それを解消するには自社の有料プランの slack チャンネルに置いておくのがもっともログを制御できて嬉しい。</p><p>城崎温泉では11月から 🦀 が解禁となって、今年は冬に行くので 🦀 を食べるというのも目的の1つ。チャンネルで盛り上げようと、たまに城崎温泉の記事を貼り付けたりしていた。そろそろ、メンバーと顔合わせの情報共有の打ち合わせをしようと思って調整さんを作った。他の人たちは、わざわざうちの slack のワークスペースにゲスト参加しているから、あまり無理強いをせずに情報共有できるようにしておきたい。たった1つの、ほとんどやり取りしないチャンネルのために slack のワークスペースをオープンしておかないといけないという用途はなかなか面倒だ。私が逆の立場でもそう思う。どうにか普段使っているワークスペースから、必要なときだけ連携できるような仕組みがないだろうか？</p><p>年末・年始の情報共有の打ち合わせへ向けて旅のしおりも準備していく。日々の業務に忙殺されて後回しにしがちなので自分を追い込むためにも予定を入れた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1214/>コンテナイメージの移行</a></h1><div class=post-meta><time class=post-date>2023-12-14 (Thu.) ::</time></div><span class=post-tags>#<a href=/diary/tags/mongodb/>mongodb</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
#<a href=/diary/tags/container/>container</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;</span><div class=post-content><p>1時に寝て3時に起きて6時半に起きた。スマホで呪術廻戦のゲームを開いたまま寝てた。</p><h2 id=サードパーティの-mongodb-コンテナへの移行>サードパーティの mongodb コンテナへの移行</h2><p>昨日の <a href=/diary/posts/2023/1211/>mongodb のサードパーティのコンテナイメージ調査</a> の続き。</p><h3 id=レプリカセットの削除>レプリカセットの削除</h3><p>基本的に一度作ったレプリカセットを削除することはないせいか、レプリカセットを削除するユーティリティは提供されていない。なんらかの理由でレプリカセットを再作成したいときは、レプリカセットの設定が保存されている local database を削除する。</p><p>またレプリカセットの稼働中に local database を削除することはできないため、mongod サーバーを <code>--replSet</code> を指定していない状態で起動させ、そのときに次のようにして local database を削除できる。</p><pre tabindex=0><code>test&gt; use admin
admin&gt; db.grantRolesToUser(&#34;root&#34;, [&#34;__system&#34;]);
{ ok: 1 }
admin&gt; use local
switched to db local
local&gt; db.dropDatabase()
{ ok: 1, dropped: &#39;local&#39; }
local&gt; use admin
switched to db admin
admin&gt; db.revokeRolesFromUser(&#34;root&#34;, [&#34;__system&#34;]);
{ ok: 1 }
</code></pre><h3 id=コンテナを使ったレプリカセットの初期設定>コンテナを使ったレプリカセットの初期設定</h3><p><a href=https://hub.docker.com/r/bitnami/mongodb>bitnami/mongodb</a> を使うと、ローカルのシングルノードでレプリカセットを使うには次のような設定になる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>  <span style=color:#f92672>mongo</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>docker.io/bitnami/mongodb:7.0.1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>user</span>: <span style=color:#ae81ff>root </span> <span style=color:#75715e># デフォルトは非 root ユーザーで起動するのでローカルの開発環境なら root で実行した方が手間がない</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./volumes/mongodb:/bitnami/mongodb</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>MONGODB_ROOT_USER</span>: <span style=color:#e6db74>&#34;${MONGO_USER}&#34;</span>  <span style=color:#75715e># 認証ユーザー</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MONGODB_ROOT_PASSWORD</span>: <span style=color:#e6db74>&#34;${MONGO_PASSWORD}&#34;</span>  <span style=color:#75715e># 認証ユーザーのパスワード</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MONGODB_ADVERTISED_HOSTNAME</span>: <span style=color:#e6db74>&#34;mongo-primary&#34;</span>  <span style=color:#75715e># レプリカセットのノードを ip アドレスではなくホスト名で指定する</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MONGODB_REPLICA_SET_NAME</span>: <span style=color:#e6db74>&#34;myrs&#34;</span>  <span style=color:#75715e># レプリカセットの名前</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MONGODB_REPLICA_SET_MODE</span>: <span style=color:#e6db74>&#34;primary&#34;</span>  <span style=color:#75715e># プライマリノードとして設定</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MONGODB_REPLICA_SET_KEY</span>: <span style=color:#e6db74>&#34;my/replication/common/key123&#34;</span>  <span style=color:#75715e># キーファイルのコンテンツ (base64 でデコードできる値)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MONGODB_SYSTEM_LOG_VERBOSITY</span>: <span style=color:#ae81ff>0</span>  <span style=color:#75715e># ログレベル</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>mongo-primary </span> <span style=color:#75715e># コンテナの内外から解決できるホスト名を指定</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>mongo </span> <span style=color:#75715e># コンテナ名 (docker container ls で表示される名前)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>27017</span>:<span style=color:#ae81ff>27017</span>  <span style=color:#75715e># レプリカセットを運用する場合はポート番号のマッピングを一致させる必要がある</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#e6db74>&#34;always&#34;</span>
</span></span></code></pre></div><p>この設定でレプリカセットを初期した場合、レプリカセットの initialize 処理は、次のような config/member をもつ。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>members</span><span style=color:#f92672>:</span> [{ <span style=color:#a6e22e>_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>host</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;mongo-primary:27017&#34;</span>, <span style=color:#a6e22e>priority</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5</span> }]
</span></span></code></pre></div><p>コンテナの内部からは mongo-primary というホスト名に対して、コンテナネットワーク内のローカル ip アドレスが解決される。</p><pre tabindex=0><code>c67a5ca94a77:/app# dig +short mongo-primary
192.168.240.3
</code></pre><p>ここで host os 上のアプリケーションから mongo コンテナに対してレプリカセット接続をする場合 <code>replicaSet=${レプリカセットの名前}</code> のパラメーターを追加する。</p><pre tabindex=0><code>mongodb://root:password@localhost:27017/?authMechanism=DEFAULT&amp;replicaSet=myrs
</code></pre><p>これは localhost:27017 にレプリカセットの接続を試行し、接続できるとレプリカセットのメンバーが返される。</p><p>レプリカセットのメンバーには <code>mongo-primary:27017</code> という設定が行われているため、mongo-primary というホスト名に対して host os 上で名前解決できる必要がある。そのために /etc/hosts に次の設定を行う。</p><pre tabindex=0><code>$ sudo vi /etc/hosts
...
127.0.0.1 	mongo-primary
</code></pre><p><a href=https://www.mongodb.com/products/tools/compass>compass</a> で接続した場合、レプリカセット接続であれば、レプリカセットの名前が接続情報として表示される。</p><h2 id=ダイニングテーブル引き取り>ダイニングテーブル引き取り</h2><p>実は火曜日にも長机を引き取りに行ってきて、今日はダイニングテーブルを引き取りに行ってきた。この3日間で2つもテーブルが手に入った。いつも目ぼしいと思ったものは、すぐに他の人と取り引きが成立してしまうのに、たまたま続けて私と取り引きが成立した。車で20分ぐらいの距離のマンションまで引き取りに行った。20時の予定を、19時10分には着いてしまって、先方も快く対応してくれた。私よりも見た目すこし年配の方で人当たりのよい感じの方だった。ジモティのやり取りはその人の性格が出るもので、受け渡しだけささっとやって余計な話しはしないパターンもあれば、愛想よく話しながら受け渡しをするパターンもある。先方によると、大事に使っていたテーブルのようにみえるので私も離れのオフィススペースで大事に使おうと思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1213/>mongodb のサードパーティのコンテナイメージ</a></h1><div class=post-meta><time class=post-date>2023-12-13 (Wed.) ::</time></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/design/>design</a>&nbsp;
#<a href=/diary/tags/mongodb/>mongodb</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
#<a href=/diary/tags/container/>container</a>&nbsp;</span><div class=post-content><p>23時に寝て3時に起きて寝たかどうか覚えていないうちに6時半になっていて7時半に起きた。</p><h2 id=json-を介した-go-の-bool-値のバリエーション>json を介した go の bool 値のバリエーション</h2><p><a href=https://github.com/go-playground/validator>go-playground/validator</a> のバリデータには <a href=https://pkg.go.dev/github.com/go-playground/validator/v10#hdr-Required>required</a> というバリデーションオプションがある。しかし、このオプションは go のゼロ値でないことをチェックするという仕様になっている。bool のゼロ値は false となるため、リクエストした JSON データに false を設定していたのか、未設定だったのかの違いを検出できない。これはバリデータの問題ではなく、go の json ライブラリの制約のようなもので使い勝手のよい仕様とは言えない。私もこの振る舞いに起因する不具合に遭遇したこともあるし、こういうときにどうしたらよいかも過去に3回ぐらいは調べている気がする。</p><ul><li><a href=https://github.com/go-playground/validator/issues/142>How to validate bool #142</a></li></ul><p>現時点での私の最適化は次のコードになる。データ構造として <code>*bool</code> 型にすれば、ポインタ型のゼロ値は nil となるため、true, false, nil の3値でバリデーションできる。しかし、私はこのデータ構造を好ましく思わない。というのは、内部的には true/false の2値でしか管理しないメンバーを、json のバリデーションのためだけに nil も許容する3値にすることがよい設計だと私は思えない。そこでバリデータによるバリデーションは諦めて、json の Unmarshal 処理をフックしてバリデーション相当の処理を自分で実装する。このやり方のデメリットはメンバーが追加されたときに自分で UnmarshalJSON() メソッドを保守する必要がある点になる。しかし、メリットとして内部のデータ構造の型は <code>bool</code> 型で扱える。一概にどちらがよいとは言いにくいかもしれないし、設計上の好みかもしれない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>reqMyData</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span>       <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>View</span>       <span style=color:#f92672>*</span><span style=color:#66d9ef>bool</span>  <span style=color:#e6db74>`json:&#34;view&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>MyData</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span>       <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>View</span>       <span style=color:#66d9ef>bool</span>   <span style=color:#e6db74>`json:&#34;view&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>d</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>MyData</span>) <span style=color:#a6e22e>UnmarshalJSON</span>(<span style=color:#a6e22e>data</span> []<span style=color:#66d9ef>byte</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>tmp</span> <span style=color:#a6e22e>reqMyData</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>data</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>tmp</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to unmarshal as reqMyData&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tmp</span>.<span style=color:#a6e22e>View</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;required view field&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>Name</span> = <span style=color:#a6e22e>tmp</span>.<span style=color:#a6e22e>Name</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>View</span> = <span style=color:#f92672>*</span><span style=color:#a6e22e>tmp</span>.<span style=color:#a6e22e>View</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=サードパーティの-mongodb-コンテナイメージ>サードパーティの mongodb コンテナイメージ</h2><p>先日の <a href=/diary/posts/2023/1211/>mongodb のレプリカセット調査</a> の続き。コードレビューをしていて <a href=https://hub.docker.com/r/bitnami/mongodb>bitnami/mongodb</a> というサードパーティのコンテナイメージを使った方がよいのではないか？というコメントがあったのでその調査をしてみた。VMware 社が提供しているサードパーティのコンテナイメージらしい。</p><blockquote><p>MongoDB(R) is run and maintained by MongoDB, which is a completely separate project from Bitnami.</p></blockquote><p>まず MongoDB プロジェクトとはまったく別管理であることが書いてある。</p><blockquote><p>Bitnami イメージを使用する理由</p><ul><li>Bitnamiはアップストリームソースの変更を綿密に追跡し、自動化されたシステムを使用してこのイメージの新しいバージョンを迅速に公開します。</li><li>Bitnami イメージでは、最新のバグ修正と機能をできるだけ早く利用できます。</li><li>Bitnamiのコンテナ、仮想マシン、クラウドイメージは、同じコンポーネントと構成アプローチを使用しているため、プロジェクトのニーズに応じて形式を簡単に切り替えることができます。</li><li>Bitnamiのイメージはすべて、minideb（最小限のDebianベースのコンテナイメージ）またはscratch（明示的に空のイメージ）をベースにしています。</li><li>Docker Hubで利用可能なすべてのBitnamiイメージは、Docker Content Trust（DCT）で署名されています。DOCKER_CONTENT_TRUST=1 を使用して、イメージの完全性を確認できます。</li><li>Bitnamiコンテナイメージは定期的にリリースされ、最新のディストリビューションパッケージが利用可能です。</li></ul><p>MongoDB®を本番環境で使用したいですか？Bitnami Application Catalogのエンタープライズ版であるVMware Tanzu Application Catalogをお試しください。</p></blockquote><p><a href=https://hub.docker.com/_/mongo>mongo</a> の公式イメージは ubuntu をベースイメージにしている。ubuntu よりは minideb の方が軽いのかな？そしてちゃんと upstream にも追随しているみたい。このベースイメージの違いによるものかは定かではないが、結合テストのイメージも移行してみたところ、10-20秒ほど結合テストの実行時間が速くなった。割合にすると10%程度かな。</p><blockquote><p>KubernetesにMongoDB®をデプロイするには？</p><p>Bitnami アプリケーションを Helm Chart としてデプロイすることは、Kubernetes 上で当社のアプリケーションを使い始める最も簡単な方法です。インストールの詳細については、Bitnami MongoDB® Chart GitHub リポジトリを参照してください。</p><p>Bitnami コンテナは、クラスタへの Helm Charts のデプロイと管理に Kubeapps と一緒に使用できます。</p></blockquote><p>helm chart も提供しているようで、いずれクラウド版を作るときに MongoDB も k8s 上にデプロイする上でこのことは都合がよいように思える。</p><p>レプリケーションを前提とした初期設定があり、entrypoint スクリプトもいくつか読んでみた感じだと、きれいに管理されていて保守もちゃんとやってくれそうにみえる。</p><ul><li><a href=https://github.com/bitnami/containers/tree/main/bitnami/mongodb>https://github.com/bitnami/containers/tree/main/bitnami/mongodb</a></li></ul><p>昨日、導入したばかりの公式イメージ + 自作スクリプトによるレプリケーション設定を廃止して、Bitnami のコンテナイメージを使うことに決めた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1212/>モチベーションを揺らすもの</a></h1><div class=post-meta><time class=post-date>2023-12-12 (Tue.) ::</time></div><span class=post-tags>#<a href=/diary/tags/postmortem/>postmortem</a>&nbsp;
#<a href=/diary/tags/team-building/>team building</a>&nbsp;
#<a href=/diary/tags/motivation/>motivation</a>&nbsp;</span><div class=post-content><p>0時に寝て2時に起きて6時に起きて7時に起きた。まぁまぁ普通に眠れた。</p><h2 id=定例会議>定例会議</h2><p>いよいよこのマイルストーンを終えると、あと1つで機能開発の終わりとなる。いくつかの要因があって開発の進捗は遅れ気味になっている。メンバーがどうこうというわけではなく、私がうまく段取りを組めていなかったり、自身がマネジメントの業務をちゃんとまわせていないところが開発スケジュールの遅延につながっている。いまの状況は私が失敗したあのときのあれや、このときのこれから全体の進捗へ影響を与えているなとわかるぐらいにはマネジメントの動きが読めるようになってきた気がしている。読めるんだったら対応しろよというのはわかっているものの、モチベーションが足りなくて成り行きに任せていて成るようになっていないなといったところ。私のモチベーションが足らないところも含め、今フェーズの開発にはマネジメントの反省材料がいくつかある。</p><h2 id=真面目にやった人を不当に咎める>真面目にやった人を不当に咎める</h2><p>昔から私はわりとワーカホリックだったので興が乗るとずっとお仕事をしていることが多かった。若い頃はやったらやった分だけ成果が出て評価されて、それはそれで楽しかったものの、30代になるとできて当たり前、成果のレベルがよほど飛び抜けていない限りは評価されることはなくなった。仮に10段階で例えると、若い頃は3しかできないと思っていた人が8ぐらいやると評価されやすいし、30代では8やって当たり前だと思われているから10やっても12やっても大差ないとみなされる。もはやお金のためにお仕事をしているのではないため、評価されなくても気にはならないし、いまは自分で契約の判断ができるので嫌なら契約を終了して別のお仕事を探せばよいだけという割り切りもある。</p><p>そんな中、昔からずっと思っていることが1つあって、真面目にやっている人たちを適切に評価しない上司が多い。要はなにも言わなくてもちゃんとやってくれているから放置するといった傾向がある。そして、さぼっている人たちや成果を出せていない人たちをかばう傾向がある。それはパフォーマンスが低い人たちを悪く言うと、さらにモチベーションを下げて、もっと悪くなるから励ますという意図があるのだと思う。しかし、その対応が度を過ぎると、真面目にちゃんとやった人たちのモチベーションを吹き飛ばしてしまう。その典型的な言葉が「みんながんばった」になる。実際は数人のコアメンバーが業務の大半をやっているのに上司は個々人の差異をなくしたがる。チームの一体感とか、空気を悪くしたくないとか、ハレーションを防ぐとか、いろいろあるのだろう。私は一緒に働いている人なら誰でも気付けるレベルの、みんながんばってないのに、そういった問題を指摘することもなく、なぁなぁで済ませるのをいくつもみてきて、これは日本の会社や組織で共通する傾向があると思う。なにを危惧しているのかわからないが、問題の本質に触れようとしないことが度々起こる。気付いたら対応しないといけないから気付いてないことにしたいと言い換えてもよいかもしれない。そういう状況をみると「またか」と思って私のモチベーションが落ちる。誰だって働きたくない。</p><p>私はよくやってくれている個人を、何度でも、よくやってくれていると明言して評する。がんばっていない人たちを咎めたりはしないが、がんばっていないのにがんばったとは絶対に言わない。状況によってはもっとがんばってほしいと言う。個人差があることを曖昧にしたりはしない。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1211/>owner/permission の違うファイルとリポジトリ管理</a></h1><div class=post-meta><time class=post-date>2023-12-11 (Mon.) ::</time></div><span class=post-tags>#<a href=/diary/tags/mongodb/>mongodb</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
#<a href=/diary/tags/container/>container</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/blog/>blog</a>&nbsp;</span><div class=post-content><p>23時に寝て2時に起きて6時に起きて7時過ぎに起きた。なんか微妙な寝方をした。</p><p>先日の <a href=/diary/posts/2023/1207/>mongodb のレプリカセットの調査</a> の整理をしてマージリクエストを作成した。共通鍵の keyFile をどう扱えばいいのか、わからなくて、一旦コンテナ内の tmp 領域にコピーして、それを entrypoint スクリプトでコピーしてから owner/permission を変更するというやり方で、リポジトリ管理で共有しやすいようにしてみた。entrypoint スクリプトは root 権限で実行されることも理解した。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>./mongo/keyfile:/var/tmp/keyfile.orig</span>
</span></span><span style=display:flex><span><span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>mongod</span>
</span></span><span style=display:flex><span>  - --<span style=color:#ae81ff>keyFile</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>/data/keyfile</span>
</span></span><span style=display:flex><span>  - --<span style=color:#ae81ff>replSet</span>
</span></span><span style=display:flex><span>  - <span style=color:#e6db74>&#34;myrs&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>entrypoint</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>bash</span>
</span></span><span style=display:flex><span>  - -<span style=color:#ae81ff>c</span>
</span></span><span style=display:flex><span>  - |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    if [[ ! -f /data/keyfile ]]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      cp /var/tmp/keyfile.orig /data/keyfile
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      chmod 400 /data/keyfile
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      chown mongodb:mongodb /data/keyfile
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    exec docker-entrypoint.sh $$@</span>    
</span></span></code></pre></div><h2 id=テックブログを読む会>テックブログを読む会</h2><p>昨日、西原さんに教えてもらった <a href=/diary/posts/2023/1210/>テックブログを読むイベント</a> を探したら毎週月曜日に行われているようだった。早速 <a href=https://blogreading.connpass.com/event/304979/>テックブログ一気読み選手権20231211杯</a> に参加した。HackMD で <a href=https://hackmd.io/kefgM317StqiBSCF7kWPDA>読んだメモ</a> を管理している。記事を選択して、読んで、所感をまとめて、他の人たちと共有する。ただそれだけのイベント。ちょうど30分で終わって、自分の勉強にもなったし、他の人の話しも聞いて参考になった。たった30分でも、なにもやらないよりずっとよい。1ヶ月ほど参加してやり方を学んだらチームにも展開してみようかと考えている。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1210/>2023年のふりかえりとコミュニティの価値</a></h1><div class=post-meta><time class=post-date>2023-12-10 (Sun.) ::</time></div><span class=post-tags>#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/review/>review</a>&nbsp;
#<a href=/diary/tags/community/>community</a>&nbsp;
#<a href=/diary/tags/blog/>blog</a>&nbsp;</span><div class=post-content><p>23時に寝て2時に起きて4時半に起きて6時までゲームやって8時に起きた。朝からオフィスで発表資料を作ってた。</p><h2 id=2023年ふりかえり>2023年ふりかえり</h2><p><a href=https://kobe-sannomiya-dev.connpass.com/event/302551/>今年を振り返ろう！LT大会</a> に参加した。</p><p>昨日の夜に LT 資料を作ろうと思っていたものの、晩ご飯食べたら面倒になってそのまま家で休んでいた。朝からオフィスで作り始めたら徐々に興が乗ってきて想定した以上にちゃんと作ってしまった。やぎさんにレビューしてもらっていくつか気付きを得た。ちょうど <a href=/diary/posts/2023/1206/>レビューサービス</a> あったら依頼したいなと思ったところだったのでレビューしてくれる人の存在に感謝した。この資料はまたなにか他の機会のイベントでも再利用しようと思う。カフーツさんの忘年会で発表してもよいかもしれない。</p><ul><li><a href="https://docs.google.com/presentation/d/1LVYOqR7ynsRJlsAjsG1nZTV-0tnhfhxE_g-pUe3koQc/edit?usp=sharing">2023年ふりかえり</a></li></ul><p>北海道から <a href=https://www.docswell.com/user/tomio2480>西原さん</a> という方が参加されていた。全国あちこちのコミュニティに参加して、そこに集う人たちの支援や盛り上げ、ひいては日本の IT コミュニティを活性化させて、世の中をよくしようといった取り組みをされている。これは私も共感するところで大半の人はコミュニティ活動に関心がない。それ自体は個人の好みで構わないのだけど、プログラミングを学びたいと考えているのに行動できない人たちというのが一定数いて、そういう人たちの受け皿として IT コミュニティで始めるのはよいことだと思う。西原さんはまさにそういう活動をされている。とても尊いことだと思う。</p><p>短時間にも関わらず、いろいろな話しをして私自身収穫もあったし、西原さんから学ぶことも多かった。企業のテックブログを読む会を毎週30分、社内外でやっていると話されていた。これは素晴らしいなと思ってすぐに反応した。歳のせいか、私は自分で勉強しなくなっていて、本も仕事も課題も積みまくりで、毎日どうしよう？と途方に暮れながら帰っておいしい晩ご飯を食べてゲームしている。そんな自分で勉強しない人向けにこういったコストなく、無理なく、続けられるイベントはありがたい。やり方を学ぶためにオンラインで参加してみようと思う。</p><ul><li><a href=https://note.com/tomio2480/n/nf909bb77b4b7>ブログを見つけて読んで感想書いてそれを肴に交流する会を30分でやりきっています</a></li></ul><p>コミュニティ活動の価値というのは、多くの企業もコミュニティを盛り上げようとやっていることから明らかに大きな価値があるにも関わらず、その価値を十分に明文化できていない。私自身、コミュニティからたくさんのモノや影響を受けているにも関わらず、うまく明文化できていないところがある。課題管理の研究の延長上でコミュニティの価値にも追究していきたいと考えている。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1209/>4年目の創立記念日</a></h1><div class=post-meta><time class=post-date>2023-12-09 (Sat.) ::</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;</span><div class=post-content><p>23時に寝て2時に起きて5時に起きて8時に起きた。税理士さんの件がもやもやしていてあまりよく眠れない。</p><h2 id=ストレッチ>ストレッチ</h2><p>今週もとくに負荷のかかることがあったわけではないため、とくにどこも悪くなく、張りや疲労を感じることはなかった。トレーナーさんもどこも悪くないという前提の上で上半身の肩が前屈みになってしまっているために肩甲骨周りが硬くなりがちであるとアドバイスしてくれた。寒くなると上半身の硬さが目立つようになるのかな。いつも通りの体調管理の一環としてストレッチを受けた。今日の開脚幅は開始前155cmで、ストレッチ後158cmだった。</p><h2 id=創立記念日>創立記念日</h2><p>今日が会社の創立記念日。無事に4周年を迎えた。過去20年、3年以上1つの会社で働いたことがない私が自分の会社では4年を迎えられたことも少し感慨深い。今日は土曜日なので創立記念日が休日ではあるけれど、やはりオフィスでいろいろ作業をしている。</p><p>2年目に経営的に大きな失敗をやらかして、その反省もあるせいか、3年目は財務が安定してきた。この3月で <a href=https://www.smrj.go.jp/kyosai/tkyosai/index.html>経営セーフティ共済</a> の掛金上限の800万円の積み立てを完了する。<a href=https://kazamori.jp/cases/>事例紹介</a> にも毎年1社新しい顧客が増えている。達人プログラマーではないが、毎年新しい顧客と取り引きをするというのもよいかもしれない。とはいえ、いまの取引先とのお仕事の契約が終了したら課題管理の研究や自社プロダクトの開発に取り組む。目安としては3年間を考えている。役員報酬をカットすれば財務的には5年はいける。意味もなく起業した私にとってはうちの会社は社会になにを還元するのかを問う期間として3-5年ぐらいを想定している。法人としてモラトリアムのようなものかもしれない。個人としても40代になって3年といった時間を自由に使えるというのはとても貴重な時間になるのではないかと考えている。自分で会社をやると年単位で時間を自由にできる。これだけでも起業する価値はあるのではないかと思う。</p><p>いまのお仕事でも課題管理の POC の1つとして実践している。想定通りと言えるほどの成果には至っていないが、時代背景や世の中の変化にも追随しながら私の頭の中にあるイメージと現実とのギャップを補正していく必要があるのかもしれない。</p><blockquote><p>完璧ではないが、最善は尽くしている。うぬぼれるな、矢口</p></blockquote><p>と赤坂先生に叱責されたい。</p><h3 id=過去の創立記念日>過去の創立記念日</h3><ul><li><a href=/diary/posts/2022/1209/>3年目</a></li><li><a href=/diary/posts/2021/1209/>2年目</a></li></ul></div></article><div class=pagination><div class=pagination__buttons><a href=/diary/posts/page/4/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span></a>
<a href=/diary/posts/page/6/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>