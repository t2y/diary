<!doctype html><html lang=en><head><title>Posts :: </title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/posts/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="Posts"><meta property="og:description" content><meta property="og:url" content="/diary/posts/"><meta property="og:site_name" content><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/posts/index.xml rel=alternate type=application/rss+xml title></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/1018/>exec とスクリプト</a></h1><div class=post-meta><time class=post-date>2024-10-18 (Fri.) ::</time></div><span class=post-tags>#<a href=/diary/tags/badminton/>badminton</a>&nbsp;
#<a href=/diary/tags/cli/>cli</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;</span><div class=post-content><p>今日のバドミントン練習はエアシャトルでリフティングを60分した。連続最大回数は191回だった。もう少しで200回だったのに残念。木曜日は睡眠をたくさんとって疲れは少し取れたし、安定的に50回前後は続くようになりつつも、100回までに失敗してしまう。今日は100回を超えたのが2回だけだった。ラケットのスィートスポットでとらえたときにきれいに真上にあがる感覚が楽しい。うまくいくときは数回は続く。それが自然にできるときとそうじゃないときの違いを私は制御できてなくて言語化もできない。</p><p>エアシャトルとメイビスにおけるリフティングの違いを比べてみると、メイビスの方が打ち上げて落ちてくるときにあまり回転せずコルクが下を向く傾向が多いようにみえる。エアシャトルの方がコルクが重い分、縦方向に回転し始めるとその回転が止まらず、回転しているからラケット面でとらえるのが難しくなる。だからエアシャトルの方がメイビスよりもリフティングが難しいといえる。シャトルを高く打ち上げると、落下してくる距離が長くなりその回転が落ち着く傾向があるからリフティングしやすくなるのではないかと仮説を考えた。伸び悩みかもしれないし、地道に練習を継続するときかもしれない。</p><h2 id=exec-とエントリーポイントのスクリプト>exec とエントリーポイントのスクリプト</h2><p>コンテナを起動して stop すると SIGTERM が送られる。そのときに api サーバーでシグナルの処理をしているのに、気付いたらシグナル処理が行われずタイムアウトするようになっていた。デフォルトでは10秒でタイムアウトして強制終了となる。なぜシグナルを捕捉しなくなったかを調査したら、あるときサーバーの起動前に前処理が必要になってエントリーポイントをシェルスクリプトにしていた。そのときに exec しないと、シェルスクリプトのプロセスに対してシグナルが送られるため、api サーバーがシグナルを検知できなくなるという副作用があることに気付いた。これまでも <a href=https://ja.wikipedia.org/wiki/Exec>exec</a> を使うとプロセス ID は変更されないという知識を知っていたが、それがどういう状況で役に立つかを理解できていなかった。シグナルを用いた同期処理に exec が役に立つ状況があることを学んだ。修正は次の1行のみ。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span><span style=color:#f92672>--- a/docker/entrypoint.sh
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+++ b/docker/entrypoint.sh
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span><span style=color:#75715e>@@ -2,4 +2,4 @@
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> ...
</span></span><span style=display:flex><span> ... (pre process)
</span></span><span style=display:flex><span> ...
</span></span><span style=display:flex><span><span style=color:#f92672>-./bin/api &#34;$@&#34;
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+exec ./bin/api &#34;$@&#34;
</span></span></span></code></pre></div><h2 id=go-test-からバイナリをビルドしてサーバーを起動する>go test からバイナリをビルドしてサーバーを起動する</h2><p>先日 <a href=/diary/posts/2024/1011/#go-の結合テスト向けカバレッジ計測の考察>結合テスト向けカバレッジ計測の調査</a> をした成果を使って実際に go test からカバレッジ計測のカスタマイズを施したバイナリをビルドしてサーバー起動するコードを書いてみた。やや手間取ったが、一通り動いてカバレッジを計測できた。例えば、単体テストのカバレッジを計測するための makefile のターゲットは次のようになる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=display:flex><span>GO_COVER_DIR<span style=color:#f92672>:=</span><span style=color:#66d9ef>$(</span>CURDIR<span style=color:#66d9ef>)</span>/tests/coverage
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>coverage</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>	@mkdir -p <span style=color:#66d9ef>$(</span>GO_COVER_DIR<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>	go test -tags<span style=color:#f92672>=</span>integration -race -cover ./... -covermode atomic -args -test.gocoverdir<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>GO_COVER_DIR<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p>go は <a href=https://ja.wikipedia.org/wiki/Fork>fork</a> ができない。fork の代わりに exec を使う。<a href=https://stackoverflow.com/a/28371586>How do I fork a go process?</a> に go の goroutine のスケジューリングと fork は相性が悪くてうまく動かないということが背景だと説明されている。それはともかく exec を使ってもサーバープロセスを非同期に起動できたのでそのスニペットを書いておく。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>binaryPath</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>buildBinary</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>args</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;-verbose&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;-port&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>Itoa</span>(<span style=color:#a6e22e>ServerPort</span>),
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>w</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Pipe</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bufio</span>.<span style=color:#a6e22e>NewScanner</span>(<span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Scan</span>() {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Text</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>cmd</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>exec</span>.<span style=color:#a6e22e>Command</span>(<span style=color:#a6e22e>binaryPath</span>, <span style=color:#a6e22e>args</span><span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Stdout</span> = <span style=color:#a6e22e>w</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Start</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>slog</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;failed to start api server&#34;</span>, <span style=color:#e6db74>&#34;err&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>defer</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Process</span>.<span style=color:#a6e22e>Signal</span>(<span style=color:#a6e22e>syscall</span>.<span style=color:#a6e22e>SIGTERM</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>slog</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;failed to terminate the api process&#34;</span>, <span style=color:#e6db74>&#34;err&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Process</span>.<span style=color:#a6e22e>Wait</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>slog</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;failed to wait terminating the api process&#34;</span>, <span style=color:#e6db74>&#34;err&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>slog</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;completed to terminate the api process&#34;</span>, <span style=color:#e6db74>&#34;s&#34;</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>String</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// サーバーに対するテストを実行
</span></span></span></code></pre></div><p>サーバープロセスの標準出力のログを <a href=/diary/posts/2024/0919/>io.Pipe</a> を使って出力することもできる。exec で生成したプロセスに対してもシグナルを送ったり終了を待つこともできる。デバッグしている分にはこれで意図したように制御できた。この知見は将来的に役に立つ気がする。0時過ぎから調査を再開して4時前ぐらいまでやっていた。少しはまって時間はかかったものの、久しぶりに集中してデバッグしていた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/1017/>変な疲れかた</a></h1><div class=post-meta><time class=post-date>2024-10-17 (Thu.) ::</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;</span><div class=post-content><p>今日のバドミントン練習はエアシャトルでリフティングを40分した。連続最大回数は168回だった。いくつか練習場所を転々としながら最終的にはホームのビルの軒下に行き着いた。環境のよい場所を知ってしまうと、それよりも劣る環境で練習することに抵抗を感じてしまう。昼間なら風がなくて人通りの少ないところであればどこでもそう大差はないが、<a href=/diary/posts/2024/1012/#練習場所と照明と背景の考察>夜は証明と背景でシャトル視認性</a> が変わってくる。21時まではホームのビルで、21時以降はその隣のビルでといった定番の練習場所ができつつある。今日はなんとなく調子がよくなくて練習していて手応えや集中力を感じなかった。</p><p>午前中に結合テスト改善に関するドキュメントを書いて、お昼から rpm パッケージングのリファクタリングやって、夕方に午前中に書いたドキュメントを使いながらメンバーに結合テスト改善の要項について共有した。そして17時半にはお仕事終えて帰った。晩ご飯も外食してリフティング練習も早めに切り上げて帰った。ここ数日あまり睡眠時間を取れていなかったのもあり、疲れているかも？と21時過ぎから横になって寝ていた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/1016/>テストライブラリの導入</a></h1><div class=post-meta><time class=post-date>2024-10-16 (Wed.) ::</time></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/testing/>testing</a>&nbsp;</span><div class=post-content><p>今日のバドミントン練習はエアシャトルでリフティングを25分した。連続最大回数は277回できた。初めてエアシャトルで200回を超えた。しかも夜なのに。やや高めに打ち上げれば安定的にリフティングできるようになってきた。連続回数が増えることはラケットとシャトルの距離感、ラケットコントロールが上達していることの証左でもあるので200回を超えたときは嬉しかった。</p><h2 id=テストライブラリの追加>テストライブラリの追加</h2><p>結合テストを改善するために2つのライブラリを新たに使うよう導入した。</p><ul><li><a href=https://github.com/gavv/httpexpect>gavv/httpexpect</a></li><li><a href=https://github.com/stretchr/testify>stretchr/testify</a></li></ul><p>testify は名前だけ知っていたが、実際に使ってみるのは初めて。testify は大きく3つの機能もっている。</p><ul><li>アサーション</li><li>テストスィート</li><li>モック</li></ul><p>うちらのチームで使うのはアサーション機能だけになる。モックも将来的に使う可能性はある。アサーションを使うと自分でエラーメッセージを書く手間を省ける。次のようなコードがあった場合、</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>expected</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>actual</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;expected %d, but got %d&#34;</span>, <span style=color:#a6e22e>expected</span>, <span style=color:#a6e22e>actual</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>次のようにエラーレポートを testify に委譲できる。このぐらいの利便性でしかないが、テストの規模が大きくなったり、量が増えていけば読み書きのコストを削減できるかもしれない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>assert</span>.<span style=color:#a6e22e>Equal</span>(<span style=color:#a6e22e>expected</span>, <span style=color:#a6e22e>actual</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>httpexpect はまったく知らなくて初めて使ってみたが、感触がよい。これもデフォルトのエラーレポート機能は testify のアサーション機能を使っているようにみえる。これまでは http リクエストに対して自前のユーティリティ関数と組み合わせて次のようなコードを書いていた。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>res</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>doHTTPRequest</span>(<span style=color:#a6e22e>body</span>, <span style=color:#a6e22e>UserPath</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>MethodGet</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>StatusCode</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;expected to get %d, but got %d&#34;</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>, <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>StatusCode</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>actual</span> <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>convertBody</span>(<span style=color:#a6e22e>res</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>actual</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to convert: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>httpexpect を使うと次のように簡潔に記述できる上にエラーレポートを httpexpect に委譲できる。これはかなりテストコードを読み書きする工数を削減できると思う。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>actual</span> <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>GET</span>(<span style=color:#a6e22e>UserPath</span>).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>WithJSON</span>(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#a6e22e>any</span>{ <span style=color:#f92672>...</span> }).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Expect</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>JSON</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Decode</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>actual</span>)
</span></span></code></pre></div></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/1015/>mongodb のテストデータ管理</a></h1><div class=post-meta><time class=post-date>2024-10-15 (Tue.) ::</time></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/testing/>testing</a>&nbsp;
#<a href=/diary/tags/mongodb/>mongodb</a>&nbsp;</span><div class=post-content><p>今日のバドミントン練習はエアシャトルでリフティングを45分した。連続最大回数は146回できた。調子は悪くなく安定的に30回前後は続くものの、50回を超えたぐらいで失敗してしまう。打ち上げる高さの違いかな？と気付いて少し高めに打ち上げるようにしたら100回を超えた。エアシャトルはラケット面に対して適切な角度でコルクを打たないとあらぬ方向に飛んでいってしまう。高く打ち上げるほど、重力で落ちてくるときにコルクが下を向きやすくなるため、うまくシャトルを打ち上げやすくなる。ラケットコントロールをうまくできれば、エアシャトルをより低い高さでリフティングできるようになるかもしれない。まだ私はそのレベルには満たない。</p><h2 id=json-からの-mongodb-にテストデータを追加する>json からの mongodb にテストデータを追加する</h2><p>結合テストの改善をしていてテストデータを json で管理したい。これまで go の構造体でテストデータを定義して mongodb の client で insert するといったことをしていた。それも役に立つのだけど、共有のテストデータがどこにあるのか、ソースコードに書いてしまうと時間とともに散らばっていって把握できなくなっていく。テストデータを管理するためのディレクトリを設け、そこに json で記述してどのテスト関数で使うかといったメタ情報も定義できるようにした。次のコードは mongodb に json からデータをインポートするための原理を説明するための疑似コードのようなもの。</p><p>go の構造体で定義したテストデータと json で管理するのとどちらがよいかというのは議論の余地はあるし、一概に言えないとは思う。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>testData</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Documents</span>    []<span style=color:#a6e22e>bson</span>.<span style=color:#a6e22e>Raw</span> <span style=color:#e6db74>`bson:&#34;documents&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>InsertData</span>(
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>, <span style=color:#a6e22e>client</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>mongo</span>.<span style=color:#a6e22e>Client</span>, <span style=color:#a6e22e>b</span> []<span style=color:#66d9ef>byte</span>,
</span></span><span style=display:flex><span>) (<span style=color:#66d9ef>func</span>()) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>data</span> <span style=color:#a6e22e>testData</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bson</span>.<span style=color:#a6e22e>UnmarshalExtJSON</span>(<span style=color:#a6e22e>b</span>, <span style=color:#66d9ef>false</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>require</span>.<span style=color:#a6e22e>NoError</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>err</span>, <span style=color:#e6db74>&#34;failed to get json files: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>col</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Database</span>(<span style=color:#a6e22e>dbName</span>).<span style=color:#a6e22e>Collection</span>(<span style=color:#e6db74>&#34;mycollection&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>col</span>.<span style=color:#a6e22e>InsertMany</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>docsToInterfaces</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>Documents</span><span style=color:#f92672>...</span>))
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>require</span>.<span style=color:#a6e22e>NoError</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>err</span>, <span style=color:#e6db74>&#34;failed to insert: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>insertResult</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Helper</span>()
</span></span><span style=display:flex><span>	    <span style=color:#a6e22e>col</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Database</span>(<span style=color:#a6e22e>dbName</span>).<span style=color:#a6e22e>Collection</span>(<span style=color:#e6db74>&#34;mycollection&#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>id</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>InsertedIDs</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>filter</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bson</span>.<span style=color:#a6e22e>D</span>{{<span style=color:#a6e22e>Key</span>: <span style=color:#e6db74>&#34;_id&#34;</span>, <span style=color:#a6e22e>Value</span>: <span style=color:#a6e22e>id</span>}}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>col</span>.<span style=color:#a6e22e>DeleteOne</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>filter</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to delete %s: %v&#34;</span>, <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>呼び出し側のイメージ。defer で teardown を呼ぶことでテスト完了時に追加したテストデータを削除してくれる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>teardown</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mongotest</span>.<span style=color:#a6e22e>InsertData</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>mongoClient</span>, <span style=color:#a6e22e>b</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>teardown</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span></code></pre></div><p>bson.Raw として読み込める json データは bson パッケージのユーティリティを使って dump できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>dumpAsJSON</span>(<span style=color:#a6e22e>value</span> <span style=color:#a6e22e>any</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bson</span>.<span style=color:#a6e22e>MarshalExtJSON</span>(<span style=color:#a6e22e>value</span>, <span style=color:#66d9ef>false</span>, <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>slog</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;failed to marshal as extended JSON&#34;</span>, <span style=color:#e6db74>&#34;err&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(string(<span style=color:#a6e22e>b</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/1014/>バドミントンのセンスは距離感らしい</a></h1><div class=post-meta><time class=post-date>2024-10-14 (Mon.) ::</time></div><span class=post-tags>#<a href=/diary/tags/badminton/>badminton</a>&nbsp;
</span><img src=/diary/img/2024/1014_racket.jpg class=post-cover alt=バドミントンのセンスは距離感らしい title="Cover Image"><div class=post-content><p>今日のバドミントン練習はエアシャトルでリフティングを110分 (エア110分) した。1回あたりは20-30分で休憩する。最大連続回数は192回だった。もうちょっとで200回を越せそう。</p><h2 id=ラケットとシャトルの距離感の考察>ラケットとシャトルの距離感の考察</h2><p>エアシャトルでリフティングをしていると、きれいに真上にあげられるときとシャトルにスピンがかかってしまうときがある。スピンしてしまうと、ラケットのスィートスポットでコルクをとらえるのが難しくなる。試しにエアシャトルをラケット面に並べてみた。中心部でシャトル3つ分の横幅しかない。この中心部分でラケットのコルクをとらえるとうまく弾ける。シャトルが回転していると、コルクが垂直方向から傾いた角度でラケット面に当たったりフレームに当たる確率が高くなる。ラケットの上部だとシャトル2つ分の横幅しかない。リフティングを失敗してしまうのは回転中のシャトルをはたいたり、あらぬ方向へ飛ばしてしまうことが多い。うまくラケットコントロールを行い、なるべくシャトルをスピンさせずに上げることができればリフティングが安定する。</p><p>今日は昼間と夜間にビルの軒下で練習した。風の影響も軽微だったので安定的に連続して50回前後はできていたと思う。121, 146, 192, 152, 122, 106, 102, 120 と連続して100回を越せたのが8回もあった。うち2回は夜になる。メビウスだと100回に1-2回ラケットコントロールをミスしてシャトルをうまく上げられないときがある。そのときにリカバリをうまくやれば続けられる。安定的に100回程度のリフティングができるからリカバリを連続で2-4回できれば200回を超える。この原理はエアシャトルも同様になる。仮にエアシャトルだと20回に1回うまく上げられないとする。200回を超すには連続で10回リカバリできないといけない。リカバリできるかどうかは運の要素もある。回転しているシャトルがフレームのどこに当たるかでリカバリ可能な場合とそうではない場合がある。10回連続でリカバリするよりも5回連続の方が、5回連続よりも2回連続の方が容易な状況と言える。つまり、ラケットコントロールが上達するとリフティングにおけるシャトル打ち上げのミスが減る。ミスが減るとリカバリ試行の回数が減る。リカバリ試行の回数が減ると連続回数が増えるという理屈になる。</p><p>今日エアシャトルで192回連続で続いたことはたまたまリカバリが連続的に成功した結果であり、リカバリを必要とせず安定的にどれだけ長くリフティングを続けられるかの方が重要ではある。よいときのラケットコントロールの感触を覚えておいて再現できるように努めていく。</p><p>次の動画によると、バドミントンのセンスとは「距離感」とのこと。練習しているうちに距離感は少しずつよくなる。そして速いプレーになると距離感をつかむのはもっと難しいとのこと。</p><div class=video-container><iframe src=https://www.youtube.com/embed/pOT9o7L92FI allowfullscreen title=【バドのセンス】初心者の方のよくある悩み⑩【ありますか？】></iframe></div><p>距離感をつかむための練習としては次になる。私がいまひとり練習しているのはまさにこれになる。</p><ul><li>シャトルのキャッチ</li><li>シャトルのリフティング</li><li>一人でロビングを打ってみる</li></ul><p>2人いればシャトルパスもおすすめとのこと。</p><h2 id=中学校体育館の夜間開放>中学校体育館の夜間開放</h2><p>バドミントンができる体育館探し。<a href=/diary/posts/2024/0920/#バドミントンの練習場所の確保>抽選予約のためのアカウント登録</a> を終えて初めての抽選。15日ゼロ時に抽選が行われる。初回なので0時頃に待機してみていた。本当に0時まわってから抽選のバッチ処理が動いているようでサイトで更新していると2-3分後に抽選結果が表示されるようになった。最大4つ抽選申し込みできる。残念ながらすべて落選だった。15日以降は先着順で予約できる。抽選結果が出た後も空きがあれば先着で校区以外の中学校も予約できる。校区以外の夜間開放されている中学校のうち、私が住んでいるところから近い区で駅から徒歩10-15分程度で歩いていけそうな中学校をピックアップしてみた。</p><p>灘区</p><ul><li>原田中学校</li></ul><p>中央区</p><ul><li>渚中学校</li></ul><p>兵庫区</p><ul><li>兵庫中学校</li><li>湊川中学校</li><li>須佐野中学校</li></ul><p>長田区</p><ul><li>駒ケ林中学校</li><li>長田中学校</li></ul><p>予想した通り、抽選確定後にみんな先着申し込みを検索しているらしく断続的に 504 エラーが出たりもしていた。私が検索して確認できた中では渚中学校と須佐野中学校に先着の空き枠が1つ2つあった。他の中学校はすべて埋まっていた。空きがある中学校もあるんだなと検索してみているうちに0時10分までにはそれらも誰かに先着予約されたみたいで埋まっていた。14日の深夜 (15日ゼロ時過ぎ) に街中の駅からアクセスのよい中学校の予約はすべて埋まると考えてよさそう。中学校によって貸し出し可能な日が平日／休日ともにあるところもあれば週末だけのところもある。11月はどこの体育館も予約できなかったが、今回は抽選申し込みと先着申し込みの雰囲気を把握できた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/1013/>田んぼの畝作り</a></h1><div class=post-meta><time class=post-date>2024-10-13 (Sun.) ::</time></div><span class=post-tags>#<a href=/diary/tags/agriculture/>agriculture</a>&nbsp;
#<a href=/diary/tags/badminton/>badminton</a>&nbsp;
#<a href=/diary/tags/day-off/>day off</a>&nbsp;</span><div class=post-content><p>今日のバドミントン練習は主にエアシャトルでリフティングを80分 (メイビス10分、エア70分) した。今日の連続最大回数は79回だった。メイビスなら10分以内に200回は続けられるようになってきた。ウォームアップにメイビスでリフティングを始める。今日は5回目ぐらいで250回続いた。リフティング練習を1時間もやれば1日の消費エネルギーは3,000カロリーを超える。</p><h2 id=田んぼの宿題>田んぼの宿題</h2><p><a href=/diary/posts/2024/0817/>8月に実家に帰って田んぼを耕した</a> が、土がよく乾いていて畝を作れるような状態ではなかった。その後、雨を待って土が適度に水分を含む状態になるのを待っていた。帰れるタイミングもあって今日になった。前回から約2ヶ月たつとまた雑草が茂り始めていたところだった。雑草を駆除するだけでも3ヶ月に1回ぐらいの頻度で田んぼを耕さないといけない。昨日の夜から帰っていたため、朝7時半ぐらいからトラクターで耕し始めて11時頃には畝作りも終えた。</p><p><figure><img src=/diary/img/2024/1013_field1.jpg></figure><figure><img src=/diary/img/2024/1013_field2.jpg></figure><figure><img src=/diary/img/2024/1013_field3.jpg></figure></p><p>いずれコワーキングスペースで農業体験を始めたらトラクターで田んぼを耕すのもメニューに組み込みたい。多くの人はトラクターになんか乗ったことないだろうから1度はやってみたいと思う。3ヶ月に1回は雑草駆除のために耕した方がよい。気軽に縦横無尽に田んぼを耕せる機会を提供しやすい。</p><p>その後、粗大ごみを市の処分センターにもって行ってお昼ご飯食べてから帰途につく。</p><h2 id=いつもと違う帰り道>いつもと違う帰り道</h2><p>先日の <a href=/diary/posts/2024/1008/#仕事は楽しいかね>毎日1つ新しいことを試して変化を楽しむ</a> という学びを思い出したのと、時間に余裕があったからいつもと違う道を通ってみようと、明石海峡大橋を渡って垂水ジャンクションから降りて海岸線の下道を走りながら帰ってきた。垂水ジャンクションの出口は山側になるのでそこから海岸線までわりと距離がある。海岸線に下るのに20分ほどかかる。垂水から須磨の海岸線はそんなに混雑しないので下道でもそれほど時間はかからない。10分ぐらいかな。その後、若宮からまた阪神高速に乗る。<a href=/diary/posts/2023/0813/#阪神高速3号神戸線>湊川IC付近は常に渋滞する</a> というのも知った上で軽い渋滞なら高速の方が早いだろうと予測した。やはり渋滞はしていたものの、それでも時速20-30kmで流れている程度の軽微な渋滞だったので20-30分で若宮-京橋間を走って帰宅した。垂水ジャンクションを降りずにそのまま高速道路を走るよりもずっと時間はかかっているのだけど、知らない道を走るというのも気分転換にはなる。</p><h2 id=バドミントンの練習>バドミントンの練習</h2><p>ダイソーでベルトにひっかけるポーチ (300円) とベルト (100円) を購入した。<a href=https://jp.victorsport.com/product/77634/as-airshuttle-ii>エアシャトル</a> も9個購入した。このポーチにシャトルを10個ほど詰めて、こまめにシャトルを拾わなくても効率よく練習できるようにした。</p><figure><img src=/diary/img/2024/1013_pouch.jpg></figure><p>夕方から磯上公園でリフティングをしていたが、いまひとつ続かない。調子が悪い。田んぼ作業で疲れているせい？暗くなったので場所を変える。旧居留地にある新しい練習場所としてワイズロードの近くや三井住友銀行神戸本部ビルの前とか、転々としながら試してみたがいまいち。その後、バスの営業所の駐車場へ行った。まぁまぁできたが、風がやや吹いているのが気になって、次にみなとのもり公園へ行ってみたが、そこはもっと風が強くてリフティングできる環境ではなかった。最後に <a href=https://kobe-sanbo.net/>サンボーホール</a> のビルへ行ってみた。前から試してみたいと思っていた。このビル前の広場も休日の昼間は子ども連れの家族がよく遊んでいる。日曜日の22時には誰もいない。</p><figure><img src=/diary/img/2024/1013_building.jpg></figure><p>磯上公園よりもバスの営業所よりも風の影響が小さくてとてもよかった。この場所で20分ほどエアシャトルでリフティングして安定的に20-30回をこなすことができた。最高は79回と過去最高ではないが、3回以上は連続50回を越した気がするので練習をしてしての感触は悪くなかった。そこでエアシャトルのリフティングは風の影響を受けやすいことに気付いた。エアシャトルを安定的にリフティングをするにはメイビスよりも高く打ち上げないといけない。しかし、高く打ち上げるほど風による影響を受けやすい。そよ風がふくだけでも軌道がずれる。シャトルが落ちてくる位置を目視しつつ予測しつつラケットコントロールをする。しかし、ちょっと風が吹くだけで微妙にズレてしまい、ラケットのフレームなどに当ててしまう。昼よりも夜の方が暗いから風の影響による補正が難しい。サンボーホールがもっとも風が弱くてリフティングが安定することに気付いた。そして、この場所は日曜日の夜でも照明がついている。</p><p><a href=/diary/posts/2024/1010/#バドミントンの練習場所探し>ホームのビル</a> はオフィスビルのせいか、休日は消灯している。これまで休日の夜に練習する安定的な場所がなかった。だから休日は公園で明るい時間帯に練習してきた。しかし、サンボーホールが休日でも照明がついていて風の影響を受けにくい構造なら休日の夜の練習場所になるかもしれない。偶然よい場所をみつけた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/1012/>照明の明るさや色合いとシャトル視認の考察</a></h1><div class=post-meta><time class=post-date>2024-10-12 (Sat.) ::</time></div><span class=post-tags>#<a href=/diary/tags/badminton/>badminton</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/motivation/>motivation</a>&nbsp;</span><div class=post-content><p>今日のバドミントン練習も引き続き主にエアシャトルでリフティングを70分 (駐車場10分、公園35分、ビル25分) した。土曜日なので昼間に駐車場や公園、ビルの軒下で練習した。20-30分もやれば集中力が途切れてくるので休憩と気分転換を兼ねて場所を移動している。今日の連続最大回数は122回だった。安定的に20-30回は続くようになってきた。メイビスフィールドだと10分やれば1度は200回以上続けられる程度に安定してきた。</p><p>エアシャトルのコルクが真下を向いているときにラケットのスィートスポットでとらえるとうまく上がる。失敗するときはラケットコントロールを誤ってシャトルを回転させてしまうことが多い。エアシャトルはコルクをラケットのガットでとらえないとうまく上がらない。回転しているとシャトルの裾をはたいたりコルクをフレームに当てて跳ね上がらなかったり、跳ね上がってもあらぬ方向へ飛んでいってしまう。軽い失敗で回転させてしまっても、ちょっと強めに打ち上げると重力で補正されてコルクが真下を向くように修正できるときがある。そのリカバリがうまくいくと連続回数が増えていく。</p><h2 id=練習場所と照明と背景の考察>練習場所と照明と背景の考察</h2><p>近所にバスの営業所があり、その駐車場が広くて明るかったので練習してみた。ここは24時まで照明がついている。周りは大きなマンションまたはビルに囲まれている。平日の22時台で20分ほど練習していたが誰も来なかった。広くて周りに気を遣う必要もなくシャトルも視認しやすかった。また今度行ってみようと思う。</p><figure><img src=/diary/img/2024/1012_parking1.jpg></figure><p>先の駐車場の印象がよかったので広い駐車場なら練習しやすいのかな？と思って別のところへも行ってみた。基本的に駐車場は24時間照明がついていて明るいところが多い。しかし、駐車場ならどこでもいいわけでもなかった。次の駐車場はシャトルの背景が複数のビルと夜の闇で移り変わってしまい、背景の明るさが変わる影響でシャトルを視認しにくいことに気付いた。広くて明るければどこでも練習しやすいわけではないことに気付いた。</p><figure><img src=/diary/img/2024/1012_parking2.jpg></figure><p>次に電球色なら昼白色の照明よりも目にやさしいから練習しやすいのではないかと考えた。旧居留地の有名な建物の隣のビル。写真ではわかりにくいが、次のビルの照明は橙色の電球色になる。試してみたら意外とシャトルを視認できなかった。その理由はシャトルの色が昼白色に映える赤色や黄色に着色されているため、電球色に照明に溶け込んでしまってシャトルそのものを視認しにくくなってしまうように思えた。もしかしたら白いシャトルなら逆にみやすいのかもしれない。今度また試してみる。</p><figure><img src=/diary/img/2024/1012_building.jpg></figure><p>夜にバドミントンの練習をする場所探しで大事な要素がいくつかわかってきた。一見、明るさだけをみてよさそうに思えてもシャトルを使ってリフティングしてみると視認しにくい場合がある。実際に試さないとその場所がよいかどうかはわからない。今回の調査から考察したことをまとめる。</p><ul><li>照明の明るさと色<ul><li>暗すぎたらみえない</li><li>スペース全体が明るくてもシャトルを視認しやすいとはかぎらない</li><li>照明が明る過ぎても眩しい<ul><li>照明がそれほど強力ではなくても目と照明との距離が近いと眩しい</li><li>屋根の高いビルの軒下の視認性が高いのは目と照明との距離が遠いからだと気付いた</li></ul></li><li>電球色だと赤／黄色のシャトルを視認しにくい</li></ul></li><li>視界における背景色とシャトルとのコンストラクト<ul><li>シャトルを目で追うときに背景の明るさや色が変わると視認しにくい<ul><li>背景が変わらない場所の方がその背景色に目が慣れてシャトルを視認しやすくなる<ul><li>ビルの軒下の視認性が高いのはビルからみえる壁や背景が一様だから</li></ul></li></ul></li></ul></li><li>スペースの広さ<ul><li>近くに壁や垣根、屋根があると避けようとして注意力を取られる</li><li>周りに人が来ないことがわかっている場所の方が集中できる<ul><li>駐車場は断続的に車や人が来るので集中しにくい</li></ul></li><li>広い方が照明との距離を調整しやすい</li><li>周りの背景があまり変わらない殺風景な場所の方がシャトルを視認しやすい</li></ul></li></ul><h2 id=１日ひとつだけ強くなる>１日ひとつだけ、強くなる</h2><p>昨日 <a href=/diary/posts/2024/1011/#隔週の雑談>はらさんに紹介してもらった梅原大吾の著書</a> の目次を眺めていくつか気になったところを読んでみた。1つの項目が2-3ページぐらいなのでタイトルで気になったところをすぐ読める。全体の3割ぐらいしか読んでいないけれど、それでも私には役に立ったので所感をブクログに書いてみた。</p><ul><li><a href=https://booklog.jp/users/t2y1979/archives/1/B0116H3QPG>１日ひとつだけ、強くなる。</a></li></ul><p>「格闘ゲーマーだって、正直飽きる」というタイトルがあってモチベーションコントロールについての梅原さんの考え方を読むことができた。私もプログラミングは好きだが、かといって飽きやマンネリがないわけではない。</p><blockquote><p>この義務感というのは結構な曲者だ。時折「仕事でもないのに、そんな真剣にやってられるかよ」という人がいる。これは逆ではないだろうか。仕事が持つ義務感によって、かえって向上心を持つことが難しくなることは多い。義務感によってやらされているという、受け身の状態になってしまう。これが進行すると「最低限の基準さえ保っておけばそれでいいだろう」といた気持ちにまでなりかねない。</p><p>義務感によって受け身にならないこと。受け身というのは、外部からの刺激に依存したやり方だ。刺激を与えられている間はいいけれど、それがなくなればやる気もなくなる。</p></blockquote><p>この悩みがあるときにひとりだと自分に言い訳をしてすぐ受け身の状態になってしまう。常に新しい取り組みや変化への挑戦をしていかないと、人間は怠惰で最低限の基準で受け身になってしまう。いまの私には耳の痛い話しでもある。そして、梅原さんの考え方を読んでいても、結局のところ、この状態を抜け出すにはモチベーションにとらわれない継続の仕組みを自分で見出すだけのように読めた。</p><blockquote><p>評価してもらえない内的な成長を、どれだけ意識できるかで、モチベーションは大きく変わってくる。</p></blockquote><blockquote><p>プロであれアマチュアであれ、やるべきことは結局ほとんど変わらない。僕は、少しずつ自分のペースを取り戻していった。何か打ち込んでいることや、続けていることがあるのなら、成長のループを継続することを考えてほしい。毎日の歩みがいかにわずかであっても、安定した継続というのはそれだけで自信になるからだ。</p></blockquote><p>本書のタイトルにもなっている「1日ひとつだけ」という言葉の背景として、梅原さんは1日を思い返して自身の成長を1つだけメモしているという。日記を書くことの意義とも共通する。日記の意義の1つはふりかえりを自然に行っていることになる。そして、外からみてわからない内的な成長を自分で気付いて成長を実感したり、自身の基準で肯定することが継続のためのモチベーションコントロールによいと梅原さんは実践している。この考え方は私が日記を3年書き続けていることから得た気付きとも合致する。よい時期によい本と出会えた。</p><h2 id=実家へ帰る>実家へ帰る</h2><p>先日トラクターで <a href=/diary/posts/2024/0817/>真夏の硬い田んぼ</a> を耕すのはやりにくかった。雨が降って適度に乾いた状態の田んぼを耕すために実家へ帰る。今日は親が外出しているというので20時から帰って明日、田んぼ作業をすることにした。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/1011/>ひとりではできないこと</a></h1><div class=post-meta><time class=post-date>2024-10-11 (Fri.) ::</time></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/issue-management/>issue management</a>&nbsp;
#<a href=/diary/tags/business/>business</a>&nbsp;
#<a href=/diary/tags/motivation/>motivation</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/testing/>testing</a>&nbsp;</span><div class=post-content><p>今日のバドミントン練習はエアシャトルでリフティングを30分した。連続最大回数は80回だが、ほとんどの試行は20回も続かずに失敗してしまう。難しい。</p><h2 id=隔週の雑談>隔週の雑談</h2><p>顧問のはらさんと隔週の打ち合わせ。今日の議題はこれら。</p><h3 id=課題管理と-adr-の関係の考察>課題管理と adr の関係の考察</h3><iframe class=speakerdeck-iframe frameborder=0 src=https://speakerdeck.com/player/1d21876659d244a8b6c121255e2fbce9 title=ADRを運用して3年経った僕らの現在地 allowfullscreen style="border:0;background:padding-box padding-box rgba(0,0,0,.1);margin:0;padding:0;border-radius:6px;box-shadow:rgba(0,0,0,.2)0 5px 40px;width:600px;height:auto;aspect-ratio:560/315" data-ratio=1.7777777777777777></iframe><p>数年前から adr の話題や導入した会社の記事などをみかけるようになった。私はこれまで課題管理をうまくやっていれば adr はそれほど重要ではないとあまり重視してこなかった。しかし、世の中的に認知されて流行っているものはなにかしら意義があるのだろうと最近は少し見直してきているところもある。このスライドによると2017年から流行り始めたらしい。</p><ul><li>開発に関する情報を一元管理する、または全文検索ことにビジネスチャンスはある<ul><li>検索のニーズや要件は多様で言語によっても違い、技術もまだまだ発展的でもあるからずっとビジネスの種になる気はする</li><li>gitlab issues のコメントの全文検索は有料機能なので slack 通知したチャンネルを全文検索している<ul><li>課題管理システムのプラグインでテキストをシステム間連携することで検索システムを別途構築できる可能性がある</li><li>検索できなくてもデータのアーカイブをするという視点でもビジネスニーズに応える？</li></ul></li></ul></li><li><a href=https://www.elastic.co/jp/what-is/vector-search>ベクトル検索</a> を検索がまだ一般的にはなっていない？<ul><li>テックブログを読む会でメンバーが <a href=https://zenn.dev/minedia/articles/d9f01aa05bc880>医薬品検索にベクトル検索を導入したら、デフォで検索ニーズをほぼ満たせそうだった話</a> を紹介していた</li><li>いまや rdb でも全文検索機能はあるが、実運用だと rdb の i/o がボトルネックになることは多いだろうから全文検索用途に使うモチベーションが低いと想定される</li><li>普通の全文検索とベクトル検索の違いを実際に触ってみて評価してみたい</li></ul></li><li>wiki と adr の違いの1つとして wiki になにを書いてよいかわからない問題がある<ul><li>文章を書けるようになるのは経験や習熟を必要とする</li><li>adr のようなテンプレートがあることで経験の浅い開発者も書きやすくなる狙いはある</li><li>課題管理システムの wiki に adr のラッピングをして別機能としてみせるのはよいかもしれない</li><li>業務の引き継ぎにも adr は役に立つのではないか？</li><li>adr 一覧をみたり、そこから検索することで検索効率や精度は上がるという想定</li></ul></li><li>大きい会社でも巨大な課題管理システムと wiki が1つだけあって一元管理しているという噂は聞く<ul><li>ある会社では wiki は誤っている可能性があるから信用するなという教訓があった<ul><li>wiki の情報は更新されていない可能性があるから参考にしながら必ず裏をとって業務をしなさいという話し</li></ul></li><li>wiki を編集したら必ずレビューが必要になるプロセス</li></ul></li><li>notion のプロジェクト管理の使い勝手はどうか？<ul><li>テンプレートを使ってガントチャートやカンバンを作れる<ul><li>基本的に自分でカスタマイズできることの良し悪しがある<ul><li>db をどんどん改良できるが、それだけに魔改造してしまう</li><li>時間とともに複数人が改良すると保守できなくなっていく懸念がある</li></ul></li><li>中核機能をパッケージ側で提供することは堅牢性を担保する上で重要ではないか</li></ul></li><li>タスク管理と wiki がシームレスなところはよい、はらさんは日報を書いてリンクしている</li></ul></li><li>会社のインフラに日々の開発情報を書いていくと退職後に参照できない<ul><li>フリーランスのような働き方をするにはナレッジデータベースをローカルに作りたいという欲求がある</li><li>組み込みの課題管理システムにより、自身のナレッジデータベースをローカルに残すという目的はよいかもしれない</li></ul></li></ul><h3 id=仕事は楽しいかねhahahugoshortcode1111s0hbhb-の考察><a href=/diary/posts/2024/1008/>仕事は楽しいかね？</a> の考察</h3><p>まとめを見返しながら、だいたいの項目は理解または支持できる。1つだけ次の項目が私には欠けていることに気付いた。</p><blockquote><p>毎日1つ試し続ければ必ず上達や進歩ができる</p></blockquote><ul><li>新しいことを始めると、いまやっていることを継続する時間がなくなったりしないか？</li><li>プロダクト開発ではがんばってもあまり成果が出ないような時期もある<ul><li>リファクタリングやテスト追加などはまさにそう</li><li>そういったときも1つでも変化をもたらせれば日々の生活が変わるのか？</li></ul></li><li>はらさんのお奨めは梅原さんの <a href=https://www.kadokawa.co.jp/product/301305000020/>１日ひとつだけ、強くなる。 世界一プロ・ゲーマーの勝ち続ける６４の流儀</a></li><li>本書を読んではらさんのよかったところは「試してみることに失敗はない」<ul><li>それまでも試すことはやっていたはずなのに躊躇してしまう理由として失敗したら時間の無駄だと考えてしまっていた</li><li>失敗したら嫌だと考えてしまうところがあったが、この考え方があるから vision pro を購入できる<ul><li>最近は vision pro の話題を聞かなくなったがどうか？<ul><li><a href=https://internet.watch.impress.co.jp/docs/yajiuma/1630679.html>ロードマップに影響は？ Appleに26年間在籍した「Vision Pro」の開発責任者が退職へ</a></li><li>仕事にはならないのではないか？</li></ul></li></ul></li><li>やりたいことをすぐやってみるという思考につながった</li></ul></li><li>面倒くさいときもなるべくパソコンを使うようにしてなにかしら調べる</li><li>私はオフィスにいれば、家よりはなにかしら作業するモチベーションになる</li><li>目標達成や成果をあげるには環境がもっとも大事<ul><li>個人の感情を信頼しない<ul><li>人間は面倒だとすぐ怠けてやめてしまう</li></ul></li><li>環境を整えることでワークフローを洗練させて習慣化する<ul><li>日記になにか書かないといけないから調べものをする</li><li>嫌々ながらでもやっているうちに習慣になってくるとワークフローが洗練していく</li><li>人間の運用を変えていくなにかは普遍的な価値またはビジネスチャンスがある</li></ul></li><li>調子の悪いときにどうやって早く脱却するかが大事<ul><li>ひとりでは言い訳を作ったり怠けてしまう</li><li>このときに他人の助けがいるのではないか？<ul><li>話しを聞いてもらうだけでも前へ進むきっかけになる</li></ul></li></ul></li></ul></li></ul><h2 id=go-の結合テスト向けカバレッジ計測の考察>go の結合テスト向けカバレッジ計測の考察</h2><p>以前リリースパーティーで go 1.20 で結合テスト向けのカバレッジ計測の機能が入ったことを聞いていた。次のブログ記事でやり方が紹介されている。</p><ul><li><a href=https://go.dev/blog/integration-test-coverage>Code coverage for Go integration tests</a></li><li><a href=https://netdevops.me/2023/test-coverage-for-go-integration-tests/>Test coverage for Go integration tests</a></li></ul><p>将来的に結合テストを作るときにカバレッジ計測のカスタマイズを施したバイナリを使って api server を起動する仕組みにすればこの機能を使えることに気付いた。</p><p>まずは単体テストを実行して任意のディレクトリ (<code>tests/coverage</code>) にカバレッジ計測のための中間データを生成する。</p><pre tabindex=0><code>$ mkdir -p tests/coverage
$ go test -cover ./... -covermode atomic -args -test.gocoverdir=&#34;$PWD/tests/coverage&#34;
$ go tool covdata textfmt -i=./tests/coverage -o coverage.out
</code></pre><p>coverage.out がさまざまなツールの入力となる統計情報となる。例えば、このファイルを使って次のようにしてソースコードのヒートマップの html を作成できる。</p><pre tabindex=0><code>$ go tool cover -html coverage.out -o coverage.html
</code></pre><p><a href=https://github.com/nikolaydubina/go-cover-treemap>nikolaydubina/go-cover-treemap</a> を使うと treemap でカバレッジのヒートマップを確認できる。</p><pre tabindex=0><code>$ go-cover-treemap -coverprofile coverage.out &gt; treemap.svg
</code></pre><p>カバレッジ計測向けのバイナリをビルドする。そのバイナリを起動するときに環境変数 GOCOVERDIR に単体テストのカバレッジの中間データが含まれるディレクトリを指定する。</p><pre tabindex=0><code>$ go build -cover -covermode atomic -o bin/api ./cmd/api/...
$ GOCOVERDIR=&#34;$PWD/tests/coverage&#34; ./bin/api -verbose
</code></pre><p>このバイナリを使って起動した api server に対してリクエストを呼び出すことでカバレッジを計測してくれる。結合テストからバイナリ起動した api server に対してリクエストしたときに GOCOVERDIR に中間データが追加されていく。結合テストを完了したら最終的なカバレッジの統計情報を生成する。
￼</p><pre tabindex=0><code>$ go tool covdata textfmt -i=./tests/coverage -o coverage.out
</code></pre><p>textfmt のヘルプをみたら同じディレクトリじゃなくてもよいみたい。</p><pre tabindex=0><code>$ go tool covdata textfmt -help
...
Examples:

  go tool covdata textfmt -i=dir1,dir2 -o=out.txt

  	merges data from input directories dir1+dir2
  	and emits text format into file &#39;out.txt&#39;
</code></pre></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/1010/>練習場所のビル探し</a></h1><div class=post-meta><time class=post-date>2024-10-10 (Thu.) ::</time></div><span class=post-tags>#<a href=/diary/tags/badminton/>badminton</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/testing/>testing</a>&nbsp;</span><div class=post-content><p>今日のバドミントン練習はリフティングを昼夜あわせて85分 (メイビスで75分、エアで10分) した。フォア持ちとバック持ちを交互に切り替えリファクタリングで398回続けられた。目標の200回を越せるようになった。</p><h2 id=バドミントンの練習場所探し>バドミントンの練習場所探し</h2><p>お昼休みに公園へ行って20分ほど軽く練習した。そのときに連続回数が198回だった。あと2回足りなかったのが悔しかったのと、夜にがんばったらできそうかなという見通しをもっていた。</p><p>夜は近所で練習場所によさそうなビルを探してまわってみた。まずは少しおしゃれな区役所のビルの軒下へ行ってみた。</p><figure><img src=/diary/img/2024/1010_bullding1.jpg></figure><p>たまたま時間帯が悪かったのか、この場所が風の通り道になっているのか、練習を始めて5分ほどやって風の影響が強くて難しそうだったのですぐに撤収した。人通りが少なく照明もよい感じなのだけど、バドミントンの練習は風が強いとどうにもできない。</p><figure><img src=/diary/img/2024/1010_bullding2.jpg></figure><p>付近を散策しながら旧居留地にある別のビルへ。従業員の通用口がやや近いところが懸念。従業員が出てきたときにこいつ何しているの？と思うかもしれない。私の視点からもややパーソナルスペース／練習スペースを狭く感じるところはある。風の影響は受けにくい構造にはなっている。ここで15分ほど練習して267回継続できた。初めて200回を超えた。その後、あまり回数が続かなくなったのでまた散策して別のビルへ。</p><figure><img src=/diary/img/2024/1010_bullding3.jpg></figure><p>ここも広くて明るくて夜は施錠しているようにみえる。ここは従業員と会うこともない。よい場所なんだけど、照明が明る過ぎて見上げたときにシャトルと照明が重なってしまうと眩しい。照明が明る過ぎても練習しにくいことに気付いた。ここでも20分ほど練習したのに200回を超えなくて次へ移動する。照明が目に入るせいかもしれない。</p><figure><img src=/diary/img/2024/1010_bullding4.jpg></figure><p>最後はホームのビルへ。他のビルで練習してみてホームのビルのよさを実感した。もっとも練習スペースが広い。そして照明を背中側にして練習するスペースも十分にある。そうすると、見上げても照明とシャトルが重なることはないので眩しくて失敗してしまう状況を避けられる。構造的に風の影響も受けにくい。ここで20分ほど練習していたら398回、266回、349回と200回超えを3回できた。</p><p>フォア持ちとバック持ちのリフティングをしていて安定的するようになってきた。うまくラケットのスィートスポットで打てば真上にシャトルが上がる。50回ぐらいならほとんど動くこともなく上げられる。だいたい100回に1-2回ぐらい、失敗してシャトルをラケットのフレームに当てたりしてシャトル操作が乱れる。ドタバタしてリカバリする。これまではそのときに焦ってしまってシャトルを落とすことが多かった。なぜ200回以上続くかというと、その稀に失敗したときのシャトル操作をリカバリできるようになってきたから。つまり5回ぐらいミスしたときにリカバリできれば200回は続くということになる。これはメイビスフィールドのシャトルを使ったときの話し。</p><p>次にエアシャトルを使って同様にリフティングをしてみると最高で50数回ぐらいしか続かない。これはラケットのフレームまたはフレーム近くのガットで弾いてしまうと、コルク部分がプラスチックなために反発せずに落としてしまったり、あらぬ方向へ飛んでいったりしてリカバリがとても難しい。つまり、ラケットコントロールをうまくやらないとエアシャトルでリフティングを継続するのはメイビスフィールドよりもずっと難しい。次の目標としてはエアシャトルで200回を越せるようにラケットコントロールの練習をするのがよいように思える。</p><h2 id=テストとビルドタグ>テストとビルドタグ</h2><p>go ではテスト用途のパッケージを <a href=https://pkg.go.dev/net/http/httptest>httptest</a> や <a href=https://pkg.go.dev/testing/iotest>iotest</a> といった、通常アプリケーションとしてパッケージを提供しているものもある。しかし、通常のパッケージにしてしまうと、アプリケーションをビルドしたときにテストコードもバイナリにも含まれてしまう。依存パッケージの管理やバイナリサイズを減らす上で不要なコードはビルド対象外になる方が望ましい。自分たちが書いたソースコードがアプリケーションに含まれることはサイズの視点では問題ないが、テスト向けの依存パッケージもアプリケーションに含まれると意図せずバイナリサイズが大きくなってしまったり、パッケージの依存解決に時間がかかったりしてしまう懸念がある。そのため、ビルドタグを用いてテスト用途のパッケージはテストのときしかビルドしないように制御する。</p><p>例えば <code>integration</code> というビルドタグを設ける。テスト用途の <code>util</code> パッケージを定義するときは次のようにソースコードを記述する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>//go:build integration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>util</span>
</span></span></code></pre></div><p>ビルドタグを指定せずに結合テストを実行しようとすると次のようなエラーが発生する。</p><pre tabindex=0><code>$ go test ./tests/...
# example.com/tsets/mypackage
package example.com/tsets/mypackage_test
	imports example.com/tests/util: build constraints exclude all Go files in path/to/tests/util
FAIL	example.com/tests/mypackage [setup failed]
</code></pre><p>結合テストを実行するには次のように明示的にビルドタグを指定して、テスト用途のパッケージをビルドしてテストが実行されるようにしないといけない。</p><pre tabindex=0><code>$ go test -tags=integration ./tests/mypackage/...
</code></pre></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/1009/>iphone 16 初期セットアップ</a></h1><div class=post-meta><time class=post-date>2024-10-09 (Wed.) ::</time></div><span class=post-tags>#<a href=/diary/tags/badminton/>badminton</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;
#<a href=/diary/tags/migration/>migration</a>&nbsp;
</span><img src=/diary/img/2024/1009_shuttle.jpg class=post-cover alt="iphone 16 初期セットアップ" title="Cover Image"><div class=post-content><p>今日のバドミントン練習はリフティングを35分 (メイビスで25分、エアで10分)、壁当てを5分した。近所のビルの軒下の照明は21時までと21時から24時までで明るさが異なる。段階的に照明を暗くしているようにみえる。フォア持ちとバック持ちを交互に切り替えながら行うリフティングはやや安定してきた気はするが、100回を超えたぐらいで失敗してしまう。当面は200回連続を目標に練習してみる。21時を過ぎてから風が強くなってきて集中力もなくなったので今日は練習を早めにきりあげた。</p><p>エアシャトルは高く上げた方が落下時に安定する。練習していてラケットコントロールを失敗してシャトルをビルの入口の天井に打ち上げてしまった。これはビル管理に怒られるんじゃないかと思って焦った。近くのコンビニで脚立を貸してくださいとお願いしたら店員さんが快く貸してくれた。やさしい世界。脚立を使って、横からラケットでシャトルを手繰り寄せて、ぎりぎり手が届いて回収できた。あと数十センチ中央側に止まっていたら回収できなかった。ほんと助かった。この付近では高くシャトルをあげないという学びを得た。</p><h2 id=iphone-16-の機種変更と移行>iphone 16 の機種変更と移行</h2><p>前の機種変更から2年たったので移行することに決めた。色はグリーンがよかったのでティールというミントカラーを選択して pro ではなくスタンダードなデバイスにした。実際が届いてティールのカラーをみてみると、私のイメージのグリーンとはやや異なったけど、これはこれで悪くないとは思う。これまで使っていた 14 pro とサイズはほぼ同じで厚みが少し薄くなっていた。手にもった感じでは薄くなった分だけ掴みやすかったり包み込めたりして馴染むように思えた。デバイスの触感も悪くない。</p><p>さっそく ios のクイックスタート機能を使って移行した。1時間もあれば初期設定はだいたいうまくいった。私にとって重要な移行検証は次の3つだけ。</p><ul><li><a href=https://www.microsoft.com/ja-jp/security/mobile-authenticator-app>Microsoft Authenticator</a></li><li><a href=https://1password.com/jp>1Password</a></li><li>電話／SMS</li></ul><p>sim カードを移し変えるだけで電話の発着信もできた。<a href=https://engrholiday.jp/nw/tel-test-111/>スマホで電話の発着信テストをする方法</a> から111に電話すると、その後、着信を受けられて発着信のテストができる。Authenticator の初期設定を失敗して初回起動時にバックアップから復旧する選択肢を選ばないといけなかった。誤って新規セットアップをしてしまい、どうやって移行するのかがわからなくてはまった。アプリを一度削除してから再インストールして、再度初期設定することで icloud に保存されている Authenticator のデータを移行できた。</p><p>その後、コンビニで paypay を使おうとしてデータ通信できないことにも気付いた。レジに並んでいるときに気付いてよかった。<a href="https://www.iijmio.jp/hdd/guide/apn.html?krkr=30b437c9-ac7b-415e-9338-17c929e84aae&krkr-s=dd434f94-9fe7-485a-8ecb-3c20322ef599.1728475216836#apn_ios">iijmio 乗り換えガイド (初期設定)</a> をみながら APN 構成プロファイルのインストールをする必要があった。これを設定しないと電話回線でデータ通信できない。電話の発着信ができているからデータ通信もできると私は誤解していた。全体を通して、私は少しはまって調べたりやり直したりしたが、スムーズに移行すれば1-2時間もあれば重要なデータを移行できる。あとは個別アプリの再ログインだったり、移行だったりをしていくだけ。銀行アプリなどもやや再設定は申請が必要で面倒だったりもする。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/1008/>毎日の変化を感じる</a></h1><div class=post-meta><time class=post-date>2024-10-08 (Tue.) ::</time></div><span class=post-tags>#<a href=/diary/tags/badminton/>badminton</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/motivation/>motivation</a>&nbsp;</span><div class=post-content><p>今日のバドミントン練習は昼に30分、夜に40分した。リフティングは60分 (メイビスで40分、エアで20分)、キャッチは10分した。バック持ちのリフティング練習をしているうちに腕の筋が痛くなってきた。やり過ぎかもしれない。</p><p>フォア持ちとバック持ちを交互に切り替えながらリフティングをする。片方の持ち方だけでやれば200回はできる。しかし、交互に切り替えると50-100回ぐらいしか続かない。雑になってしまったり、遠近感を見誤ったりしてしまう。リフティングを失敗するときは前後の距離感が狂ってしまうことが多い。動体視力は10代後半がピークで40代から急激に衰えていくらしい。視力が衰えるのはもう仕方ないだろうからラケットコントロールを上達させる方がよいのだろう。ビルの軒下は風が通りにくいという特徴があって公園でやるよりも風の影響がなくてやりやすいときもある。あとエアシャトルも少し高めに弾くとコルク部分が重いせいか、直進的に落ちてきてリフティングしやすいことに気付いた。</p><h2 id=仕事は楽しいかね>仕事は楽しいかね？</h2><p>プロダクト開発をしていると、開発がどんどん遅くなっていってがんばってもあまり進捗していないように実感する時期がくる。もしくは日々の開発業務がマンネリになってしまうこともある。昔からそういう状況のことを <a href=https://megalodon.jp/2011-0824-1248-00/japanese.joelonsoftware.com/Articles/FireAndMotion.html>射撃しつつ前進</a> と呼ばれていた気がする。そんな時期もあるから地道にコツコツと時間をかけて日々できることを積み重ねるしかないと私は考えていた。税理士さんと雑談していて「仕事は楽しいかね?」という名著があることを教えてもらった。要約動画がわかりやすいと紹介していただいた。</p><div class=video-container><iframe src=https://www.youtube.com/embed/Kro6ZTvCFq4 allowfullscreen title=【要約】仕事は楽しいかね？【デイル・ドーテン】></iframe></div><p>まとめは次になる。</p><ul><li>楽しく生きるには、遊び感覚で新しいことを試し続けること (価値観があう)</li><li>試してみることに失敗はない (価値観があう)</li><li>試すからこそ新しい発見がある (価値観があう)</li><li>むしろ試さないことが失敗である (価値観があう)</li><li>大きな目標はなくていい (価値観があう、課題管理)</li><li>毎日気になったことを1つ試すことを目標にすること (課題管理)</li><li>毎日1つ試し続ければ必ず上達や進歩ができる</li><li>成功者はシンプルに試す数がとても多い人 (価値観があう)</li><li>今抱えている問題点を書き出して、それを解決するために今動き出すこと (課題管理)</li><li>適切な時とか完璧な機会なんてものはない (価値観があう)</li><li>現状を把握して1つずつ試す (課題管理)</li><li>完璧な状態であっても試し続ける (価値観があう)</li></ul><p>私の価値観にあるものも多いし、いくつか課題管理で普段やっていることにも当てはまる。動画をみていて「毎日1つ試す、変化を感じるのが大事」と言っているのが気になった。日々の生活における既存のいろいろをやっていると、他のことをする余裕がなくなってしまい、いま抱えていることの区切りがついてから新しいことをしようと私は考えるところがある。いま注力していることに余裕がなければ、新しいことはしないように私はしている。一方で最近は少し余裕が出てきたこともあり、バドミントンの練習を始めたことが日々の変化になっていて、たしかに気分がよい。毎日の変化をもっと小さいもの、簡単なものにして、なにかを為さなくても日々の変化を感じることを目的にすればいま以上に日々の生活を楽しめるのかなと学びになった。</p></div></article><div class=pagination><div class=pagination__buttons><a href=/diary/posts/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span>
</a><a href=/diary/posts/page/3/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>