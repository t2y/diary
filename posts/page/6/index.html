<!doctype html><html lang=en><head><title>Posts :: forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/posts/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="Posts"><meta property="og:description" content><meta property="og:url" content="/diary/posts/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/posts/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1224/>無駄なものはそうそうない</a></h1><div class=post-meta><time class=post-date>2023-12-24 (Sun.) ::</time></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
#<a href=/diary/tags/writing/>writing</a>&nbsp;
#<a href=/diary/tags/animation/>animation</a>&nbsp;</span><div class=post-content><p>0時に寝て4時に起きてアニメをみて5時半に寝て9時に起きた。午前中はだらだらしていた。</p><h2 id=旅のしおりのたたき台作り>旅のしおりのたたき台作り</h2><p>3月に予定している <a href=/diary/posts/2023/1027/#隔週の雑談>開発合宿</a> イベントの打ち合わせを次の木曜日に行う。そのための資料作りをした。昨年の記録があるのでその内容を見返したり、写真を貼り付けたりしながら、昨年作った資料よりも詳細な「旅のしおり」を作ることができた。</p><ul><li><a href=/diary/posts/2022/0603/>1日目</a></li><li><a href=/diary/posts/2022/0604/>2日目</a></li><li><a href=/diary/posts/2022/0605/>3日目</a></li></ul><p>しばらくは冬の城崎温泉の開発合宿を、うちの会社の年中行事として継続していきたい。</p><h2 id=コワーキングの価値の考察>コワーキングの価値の考察</h2><p>独りで活動する個人事業主やマイクロ法人の役員にとってコワーキングがもたらす価値は大きいのではないかと私は考えている。以前 <a href=https://note.com/t2y1979/n/n84deed5fd934>リモートワークと相談相手</a> という記事を書いた。そのふりかえりや考察の中から <a href=/diary/posts/2022/0927/>日記を書き続ける</a> ことに決めた。それは思考の外在化を強制的に行わないと、私はすぐに劣化するということを身をもって理解した。ひとえに人間が弱いのだと思う。思考の外在化とは次になる。</p><ul><li>書くこと</li><li>話すこと</li></ul><p>これらの活動が減ることで思考が鈍化したり脳が退化したりする。書くことは日記で補えたが、話すことは相手がいないと成り立たない。顧問のはらさんに隔週で相談しているのもそうだし、カフーツさんのオンラインイベントに参加しているのもそうだし、開発合宿に社外の人たちを呼ぶのもその一環になる。そして、このことは会社員時代にあまり感じたことはなかった。それは会社員時代にはこれらの活動を伴うイベント、つまり会議だったり、報告だったり、同僚との雑談などが自然に日々の生活の中に含まれていたからだ。</p><p>無駄じゃなかったんやと思ったら次のシーンを思い出した。</p><blockquote><p>初めて、成功したよ。800年か……全く、無駄な魔法だと恨んでさえいたが。ああ、意味はあったんだな。</p></blockquote><div class=video-container><iframe src=https://www.youtube.com/embed/eZ13oxXpbH4 allowfullscreen title=フェルズの気付き></iframe></div><p>意味のない無駄なことだと思いながらも長く続けていたことが、その意図をもって実施したかの如何に関わらず、なにかの役に立つことはあるし、なにごとも継続するに無駄なことはないという気付きでもある。古代の中国においても <a href=https://ja.wikipedia.org/wiki/%E5%AD%9F%E5%98%97%E5%90%9B#%E9%B6%8F%E9%B3%B4%E7%8B%97%E7%9B%97>鶏鳴狗盗</a> という故事がある。人それぞれに長く継続できていることがあるならそのことを大事にしたらよいと私は思う。それは継続した先にしかわからないこともある。</p><p>やや非科学的な仮説ではあるが、<a href=https://ja.wikipedia.org/wiki/%E5%B0%8F%E6%9E%97%E6%AD%A3%E8%A6%B3>小林正観</a> という人物が「ありがとう」を唱えると幸せになるという仮説を提唱している。「ありがとう」を一万回となえると幸せになり、二万五千回となえると涙があふれだし、五万回となえると奇跡がおきる、もしくは年齢×一万回となえると第一段階の奇跡が起きるという。仮にこういった現象が本当に起きるのであれば、他者への感謝を述べる言葉から脳が影響を受けて、感謝の行動や考え方が身に付いて、現実の生活にも影響が出てくるのだろうと推測する。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1223/>アクセシビリティを考える機会</a></h1><div class=post-meta><time class=post-date>2023-12-23 (Sat.) ::</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/web-design/>web design</a>&nbsp;
#<a href=/diary/tags/accessibility/>accessibility</a>&nbsp;
#<a href=/diary/tags/coworking/>coworking</a>&nbsp;</span><div class=post-content><p>0時に寝て3時半に起きて5時半に起きて8時に起きた。</p><h2 id=ストレッチ>ストレッチ</h2><p>先週は実家に帰っていて通常とは異なる日程だったのでアラームを解除していた。ストレッチの時間のアラームを聞いてから出掛けていたので危うく遅刻するところだった。</p><p>今日はとくにどこも悪くなくて、可もなく不可もなくといった感じだった。
トレーナーさんによると、冬は寒くて丸くなってしまうせいか背中が硬くなりやすいという。背中のツボをあちこち押されて痛かった。たまたまトレーナーさんと物価の話しをしていて、いま物の値段がピークアウトしてサービスの値段が上がってきていて、よいインフレの傾向になっているといった記事の共有をした。</p><ul><li><a href=https://note.com/goto_finance/n/nd2587229a2a3>日本の値上げに構造変化</a></li></ul><p>ストレッチもサービス業だから値上げしてトレーナーさんの給料も上がるとよいですねと。トレーナーさんによると、定期昇給といったものはなく、歩合給はあるもののそれほど大きくなく、給料をあげようと思ったら店長になるといった役職をつけないといけないらしい。あとトレーナーさんのスキルレベルによってお客さんが支払う金額も違う。昇給していくことが見込めないと、若い人しかトレーナーさんはできないのかな？という印象も受けた。スキルの高いプログラマは単価が上がっていくことが社会的に認識されているから将来に不安はないけれど、新しい職業や業態のキャリアモデルを作るのは難しいと思えた。今日の開脚幅は開始前155cmで、ストレッチ後157cmだった。</p><h2 id=アクセシビリティの話し>アクセシビリティの話し</h2><p>以前からはらさんが登壇されるという話しは聞いていた。ちょうど法事で実家に帰っていた日にイベントがあったようだ。</p><ul><li><a href=https://kansock.industries/ja/articles/20231222_01/>XR やクローラーについて話した次世代 Web カンファレンス A11y セッションが無事終了しました</a></li></ul><p>1:31:00 ぐらいから A11y (Accessibility) のセッションが始まる。はらさんが登壇されているので一通りみた。アクセシビリティわからない人がみてもおもしろかった。</p><div class=video-container><iframe src=https://www.youtube.com/embed/JSxwRcfJoYU allowfullscreen title="次世代 Web カンファレンス 2023"></iframe></div><p>20代、30代、40代の登壇者がいてバランスがよいようにみえた。また全盲の登壇者が A11y について話しているのはかなりの説得力をもっている。多くの人にとってアクセシビリティはあまり関心がない分野であり、プログラマーだけが注意すればよい問題でもないという。プログラマー、デザイナー、組織、エンドユーザーといった、プロダクトに関係するすべての人の認識や意識を調整してアクセシビリティは成り立つ。そして、障害当事者と出会う機会があるということそのものがアクセシビリティを考えることについてのプラスになるのではないかと話していて共感できた。登壇者にとっては、目の不自由な方がスマホをどう使うのかの動画が sns でバズっているのをみて、一般の人たちは (その登壇者にとって当たり前のことを) こんなに驚くのかと驚いたという。</p><p>私はフロントエンドの画面の開発に関して、たまに手伝う程度なのでアクセシビリティを意識して作ることはあまりない。しかし、使いにくいものは使いにくいとはっきり言うので、仕様や規格に準拠しているからとか、こういったデザインが流行りだとか、そういった物差しに関係なく意見は言う。登壇者の中にも自分の頭で使いやすい・使いにくいといったことを考えてほしいというメッセージを発していた。</p><h2 id=差し入れ>差し入れ</h2><p>私は出掛けていたので参加する予定はなかったが、<a href=https://www.facebook.com/events/1415020322425147>ブログJelly Vol.137</a> に三ノ宮.dev のメンバーが参加しているというのをみかけて差し入れしてきた。若い人はいろいろな経験を積んでどんどん挑戦してほしい。たまたま出先から帰ってきたのが19時前で <a href=/diary/posts/2023/0727/#神戸阪急百貨店のデパ地下>デパ地下のお寿司</a> を買いに行った。割引になるのを待っていたら19時を過ぎると20%引きのラベルを付け始めた。それをみて、サーモン詰め合わせ、マグロ鉄火巻、握り盛り合わせの3折箱を購入した。3-4人でつまむ程度の量。20%割引で3395円だったから定価だと4244円となる。これまでは720ml (四合瓶) のお酒をもっていくことが多かった。お土産用の、ちょっとよいお酒だとだいたい3000円前後かな。お寿司の方がやや値がはる。物価も上がっているのにあわせて手土産に使う金額も3000円程度という基準から5000円ぐらいまでは引き上げてもよいかもしれない。</p><ul><li><a href=https://www.facebook.com/kanzan10to9/posts/pfbid0SM2VrVpLcFkLDxwsayFVmQStUv2FrCzTxT3wJfB4m8JSxeLq1WouZv5AxpB9TxUgl>いとうさんのコメント</a></li></ul></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1222/>マネジメントは変わっていく、変わり続けるもの</a></h1><div class=post-meta><time class=post-date>2023-12-22 (Fri.) ::</time></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/issue-management/>issue management</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;</span><div class=post-content><p>晩ご飯食べて21時頃から横になっていた。なんか寒くてなにもやる気がしない。1時に寝て何度か起きて7時に起きた。</p><h2 id=隔週の雑談>隔週の雑談</h2><p>顧問のはらさんと隔週の打ち合わせ。今日は議題を準備するのを忘れていて、ふりかえりをしながらフリートークのような雑談をした。</p><ul><li><a href=/diary/posts/2023/1210/>2023年ふりかえり</a></li></ul><p>昨日の <a href=/diary/posts/2023/1221/>組織論の動画</a> なども共有しながら課題管理の文脈でマネジメントやリーダーシップの原則として思うことを言語化していた。次のような価値観をメンバーにもってほしい。</p><ul><li>常に人間は学ぶ<ul><li>どのポジションの人も、どんな役割でも、人それぞれのペースで学ぶのは当たり前である</li><li>組織に学ばない人がいると足を引っ張るようになってしまう</li></ul></li><li>人間は時間とともに成長して変わっていく<ul><li>同じことを何年もずっとやり続ければよいという時代ではない</li><li>成長することでやり方もやることも責任も変わっていく</li></ul></li><li>プロジェクトは一期一会<ul><li>人は学び成長することから同じプロジェクトを再現することは本当の意味でできない</li><li>そのときそのメンバーで、その知識や習熟度で取り組むプロジェクトはその人の人生において1度しかない</li><li>本当の意味でプロジェクトマネジメントに再現性などないし、そのときの状況で最適解を考えて実践しないといけない</li></ul></li></ul><h2 id=知の創造研究部会第63回>知の創造研究部会第63回</h2><p><a href=https://kmsj20231222.peatix.com/>知の創造研究部会第63回</a> に参加した。内容は悪くなかったが、私が関心のあるテーマではなかった。</p><p>最初の30分ほど、会そのものの紹介やイベントの宣伝、登壇者の自己紹介が延々と続いて、ちょっと長過ぎてうんざりした。自分たちのことをちゃんと知ってもらった方が内容がわかりやすくなるというのはやや前時代的な考えだと私からは思えた。私がイベントに登壇するとき、ほとんど自己紹介を省いて本題へ入るようにしている。それはおっさんの経歴を多くの聴衆は関心がないというのもあるが、本題を聞きたいのに関係ない話しをされるのを私自身もしんどく思うようになったのがある。映画館で映画をみるとき開始前に他の映画の宣伝が10分ぐらいあるのをうんざりする気持ちと同じ。</p><p><a href=https://www.facebook.com/groups/204376119725736>知の創造部会</a> というクローズドな facebook グループがあると聞いたので参加申請した。翌日には承認されていた。今後はイベント情報などをここでチェックすればよいのかもしれない。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1221/>うまくいかなくなった組織を立て直す難しさ</a></h1><div class=post-meta><time class=post-date>2023-12-21 (Thu.) ::</time></div><span class=post-tags>#<a href=/diary/tags/management/>management</a>&nbsp;
#<a href=/diary/tags/business/>business</a>&nbsp;
#<a href=/diary/tags/issue-management/>issue management</a>&nbsp;</span><div class=post-content><p>2時に寝て4時半に起きて7時半に起きた。昨日のオンラインイベントの後に課題管理についての質問を受けたらいろいろ調べ始めてしまって帰るのが遅くなった。</p><h2 id=組織論のあれこれと元凶>組織論のあれこれと元凶</h2><p>たまたま教えてもらってみたらおもしろかった。私もこの歳までに10社以上の組織をみてきたことから、組織の問題、あるいは組織であるがゆえに避けられない問題があることは理解できるし、自分の経験則でもダメな組織の特徴などいくつも思いつく。だいたい知っている内容ではあったけれども、若いのに書籍や論文を研究して、そういう現象にこういった名前がついているというのを言語化してくれていることは知識を共有する上で大事なことでもある。そこまでは知らなかったのでとても参考になる。</p><div class=video-container><iframe src=https://www.youtube.com/embed/W_b2vp19nWA allowfullscreen title="【組織崩壊のメカニズム】元DeNA人材育成責任者が日本のマネジメントに警鐘／大企業・メガベンチャーに共通する凡庸化すごろく／優秀なリーダーはこうして潰される【MANAGEMENT SKILL SET】"></iframe></div><div class=video-container><iframe src=https://www.youtube.com/embed/1DKaP396Ybg allowfullscreen title="【最も危険な上司はこの2種類】“かっこつけシャドーボクサー”と“承認欲求サンドバッグ”に気をつけろ／リクルートの「お前はどうしたい？」にまつわる誤解【MANAGEMENT SKILL SET】"></iframe></div><p>私が思う解決策の1つに役職や地位が固定化されないような組織設計というのがある。<strong>「権力は腐敗する」</strong> という言葉がある。権力を維持したまま、いまの人間社会でこれを避ける方法はないと私は考えている。どんな優秀な人であっても。上司も役員も社長でさえも、定期的に入れ替わる。どんなに成果をあげても優秀であっても一定期間以上とどまれない。そういう新陳代謝がいいんじゃないかと思う。実際にティール組織やホラクラシーといった組織形態はこの解決策を実現している。</p><p>動画の中で、心理的安全性の誤った解釈の文脈で組織がなぁなぁになっている世の中の流れがあって、私もずっと思っていたことの1つに自己肯定感を高めるのがよいというのは本当か？という問い。たしかに過去の行き過ぎたハラスメントは意味がないものではあったのは理解するが、できない人を然るべき内容で叱らないのもどうかという思いは私の中にもあった。坂井さんによると、自己肯定感が本当によいのかどうかという成果も怪しいという。</p><blockquote><p>成果が出ていない人に対して自尊心を高めると、逆に成果が悪くなったり、他者へ横柄になったりする。</p></blockquote><p>直感的に当たり前の話しだと思う。できない人を特別扱いする必要はない。そして、坂井さんは流行りのキーワードにとらわれず、自分たちの組織では本当にそうなのか？具体的で地に足の着いた制度や施策を見極めるべきだ、ちゃんと自分たちで考えましょうといったメッセージを発信していた。これは課題管理の文脈でも私もメンバーに常々言っている。自分たちのやり方にあうかどうかを考えるのが大事だ。</p><p>一方でうまくいっていない組織を立て直すのはとても難しい。それは組織のマネジメントというのは、上位の意思決定者、役員であったり部課長であったり、幹部社員の影響力がとても大きいため、うまくいっていないことを認めることそのものが役員や幹部社員へのダメ出しとなる。私もお手伝いをしていて、本質を追究すると経営陣への批判になってしまうため、お茶を濁すときもある。もちろん重要なことで言うべきところは言うが、それほど重要ではないところはお茶を濁してしまう。それは人間関係もあるし、取引関係もあるし、誰だって嫌な人になりたくないし、厳しいことも言いたくない。外部の人間ですら怯むところがあるのに、同じ会社の上下関係や人間関係ではもっと言いにくいことはあるだろうというのは容易に察することができる。優秀な若手が会社を去るのは至って自然だし、もっと言うと年配の人たちも若い人にポジションを譲って会社を去らないといけない。1つの会社で5-10年働くのはとても難しい時代にきているのだと私は思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1220/>リリースの延期</a></h1><div class=post-meta><time class=post-date>2023-12-20 (Wed.) ::</time></div><span class=post-tags>#<a href=/diary/tags/project-management/>project management</a>&nbsp;
#<a href=/diary/tags/failure/>failure</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/coworking/>coworking</a>&nbsp;
#<a href=/diary/tags/agriculture/>agriculture</a>&nbsp;</span><div class=post-content><p>なんか疲れていて帰ってきて晩ご飯食べたらすぐに横になってた。0時に寝て5時半に起きて7時に起きた。</p><h2 id=プロジェクトのスケジュール調整>プロジェクトのスケジュール調整</h2><p>先週からお手伝い先の経営陣には一報を入れてあったのだけど、お昼にメンバーと 1on1 してスケジュール的に厳しそうという再確認をして正式にいまの開発スケジュールに対して1マイルストーン (2週間) を延期することに決めた。先週の時点で残タスクの状況と進捗をみていて厳しそうだとは私の視点からもみえていて、ある意味の予定調和ではある。いまの開発は昔のように残業したり休出したりしないため、遅れていることがわかった時点でできることは機能を減らすか、期日を延期するかの2択しかない。今回は内容的に機能を減らすことはやりにくいため、延期するという施策しか私には打ち手がなかった。</p><p>原因としてもっとも大きいことの1つは <a href=/diary/posts/2023/1128/#マイルストーン定例>新規メンバーが3ヶ月間なにもしなかった</a> ことであり、新規メンバー向けに用意した開発機能を既存メンバーで吸収しきれなかったことになる。既存メンバーに責任があるわけではなく、私がもう少し速く決断できなかったことの影響がこの遅延につながったというものではある。これはまた開発の大きなふりかえりの中でチームで議論したいと思う。</p><h2 id=コワーキングのオンラインイベント>コワーキングのオンラインイベント</h2><p>月例のカフーツさんのオンラインイベントに参加した。<a href=/diary/posts/2023/1115/#コワーキングのオンラインイベント>前回の所感はここ</a> 。今回は「今年よかったこと、来年やりたいこと」をそれぞれに発表する会になった。私は先日作成した <a href=/diary/posts/2023/1210/>2023年ふりかえりスライド</a> を参加者に共有して説明した。</p><ul><li>よかったこと: 課題管理の PoC を実務の開発で実践して成果が出ている</li><li>来年やりたいこと: 実家の離れにコワーキングスペースを作る</li></ul><p>参加者みんなが農業に関心をもっていて、IT x 農業という取り組みで新しい挑戦をすることに関心を示す人は多い。これは三ノ宮.dev においても同様で農業に関心をもっている人は多い。農業をビジネスにするのはとても難しいし、大変なことだと私は認識しているが、別にビジネスにならなくてもコミュニティ活動の一環やライフワークの1つとして、仲間たちと価値観を共有するための触媒もしくは土壌としてよさそうに考えている。いまのお手伝いのお仕事を終了したら、来年はいとうさんと一緒にコワーキング + 農業でうまく運営している先行事例を視察に行って、それらを研究して、なにかしら新しいことに取り組んでいきたいと思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1219/>結合テストのデバッグ</a></h1><div class=post-meta><time class=post-date>2023-12-19 (Tue.) ::</time></div><span class=post-tags>#<a href=/diary/tags/gitlab/>gitlab</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
#<a href=/diary/tags/mongodb/>mongodb</a>&nbsp;
#<a href=/diary/tags/testing/>testing</a>&nbsp;</span><div class=post-content><p>1時に寝て5時半に起きて7時半に起きた。なんか週の前半からバテている。</p><h2 id=gitlab-cicd-の-dind-で-mongodb-のレプリカセット接続ができない>gitlab ci/cd の dind で mongodb のレプリカセット接続ができない</h2><p>先日対応した <a href=/diary/posts/2023/1214/>mongodb のレプリカセット対応</a> で残った最後の課題。ローカルで実行すれば結合テストは動くが、gitlab ci/cd 環境では動作しないという問題が残っていた。<a href=/diary/posts/2023/1218/>gitlab-runner をローカルで実行できる</a> ようにして、設定やパラメーターを変えたり、デバッグコードを埋め込んだり、コンテナに attach して振る舞いを確認したり、いろいろデバッグして原因はレプリカセット接続におけるホスト名の解決がコンテナ間でできていなかったことがわかった。</p><p>mongodb の結合テストは <a href=https://github.com/ory/dockertest>dockertest</a> を使って実装している。これを gitlab ci/cd で動かすには dind を有効にする必要がある。dind 環境では2つのコンテナを使って結合テストが実行されるわけだが、テストが実行されるコンテナと mongodb コンテナが起動するコンテナの2つが生成される。このときにテストが実行されるコンテナから実際に mongodb が起動するコンテナのホスト名の解決と、mongodb が起動するコンテナ上での自分のホスト名の解決の2つが成立していないとレプリカセット接続ができない。要は1台のローカルホスト上で結合テストを実行するのと、2つのコンテナ上で実行されるのでは設定を変更する必要があるということに気付いた。</p><p>具体的には dockertest の次のパラメーターを、実行環境から解決するホスト名を考慮して設定すればよいと気付いた。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>pool</span>.<span style=color:#a6e22e>RunWithOptions</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>dockertest</span>.<span style=color:#a6e22e>RunOptions</span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span> 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Hostname</span>:   <span style=color:#a6e22e>executor</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Env</span>: []<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>        <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;MONGODB_ADVERTISED_HOSTNAME=%s&#34;</span>, <span style=color:#a6e22e>executor</span>),
</span></span><span style=display:flex><span>        <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p>たったこれだけの修正だし、現状の動作の振る舞いが分かればすぐに直せるものではあるけれど、このデバッグにはまた2-3時間を費やした。mongodb のレプリカセット接続はなかなか大変。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1218/>gitlab ci/cd のローカルデバッグ</a></h1><div class=post-meta><time class=post-date>2023-12-18 (Mon.) ::</time></div><span class=post-tags>#<a href=/diary/tags/gitlab/>gitlab</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
#<a href=/diary/tags/debug/>debug</a>&nbsp;</span><div class=post-content><p>23時頃から寝始めて3時に起きて5時半に起きて8時過ぎに起きた。久しぶりに寝坊した。</p><h2 id=gitlab-runner-のデバッグ>gitlab-runner のデバッグ</h2><p>mongodb のレプリカセット対応して、ローカルでは結合テストが動くものの、gitlab ci/cd 環境では動かなくなった。gitlab ci/cd は <a href=https://docs.gitlab.com/runner/>GitLab Runner</a> によって提供されている。そのデバッグのため、ローカルに gitlab-runner をインストールして調査した。</p><p><a href=https://docs.gitlab.com/runner/install/>GitLab Runner のインストール</a> ドキュメントにそれぞれの OS 向けのドキュメントがある。Debian/Ubuntu/Mint 向けのインストール手順を行う。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl -L <span style=color:#e6db74>&#34;https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh&#34;</span> | sudo bash
</span></span><span style=display:flex><span>$ sudo apt-get install gitlab-runner
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ gitlab-runner --version
</span></span><span style=display:flex><span>Version:      16.6.1
</span></span><span style=display:flex><span>Git revision: f5da3c5a
</span></span><span style=display:flex><span>Git branch:   16-6-stable
</span></span><span style=display:flex><span>GO version:   go1.20.10
</span></span><span style=display:flex><span>Built:        2023-11-24T21:11:36+0000
</span></span><span style=display:flex><span>OS/Arch:      linux/amd64
</span></span></code></pre></div><p>.gitlab-ci.yml があるディレクトリへ移動して、ジョブを指定して実行する。ローカルでの変更内容を検証するときはブランチにコミットしないといけない。コミットしていないと次のワーニングが表示される。</p><pre tabindex=0><code>WARNING: You most probably have uncommitted changes. 
WARNING: These changes will not be tested.         
</code></pre><p>dind なジョブを実行するときは <code>--docker-privileged</code> で特権を付けて実行する。環境変数は <code>--env KEY=VALUE</code> で渡せるが、<code>CI_JOB_TOKEN</code> のような組み込みの環境変数は上書きできない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ cd path/to/repo
</span></span><span style=display:flex><span>$ gitlab-runner exec docker --docker-privileged <span style=color:#e6db74>${</span>ジョブ名<span style=color:#e6db74>}</span>
</span></span></code></pre></div></div></article><div class=pagination><div class=pagination__buttons><a href=/diary/posts/page/5/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span></a>
<a href=/diary/posts/page/7/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>