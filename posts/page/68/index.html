<!doctype html><html lang=en><head><title>Posts :: forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/posts/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="Posts"><meta property="og:description" content><meta property="og:url" content="/diary/posts/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/posts/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0616/>バッチ処理のインフラ構築に着手</a></h1><div class=post-meta><time class=post-date>2022-06-16 (Thu.) ::</time></div><span class=post-tags>#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;</span><div class=post-content><p>0時に寝て5時に起きた。なんか体調がいまいちな雰囲気。</p><h2 id=ブログ記事のレビュー>ブログ記事のレビュー</h2><p>昨日の続き。会社ブログの担当者にもレビューも通って体裁を整えて会社ブログにも転記された。あとは情シスグループのリーダーレビューが最終チェックになるみたい。</p><h2 id=aws-batch>aws batch</h2><p>バッチ処理のインフラを構築しようと考えていて、これまで aws lambda で作られているのが非効率だなと思うようになってきた。<a href=https://aws.amazon.com/jp/batch/>aws batch</a> を使えないかを検討している。いまバッチ処理のための web api のエンドポイントを実装するスタイルになっていて、この流れでやっていくと将来的にバッチ処理が api サーバーに増えていく。たまたま負荷の高いバッチ処理と通常のリクエストがスパイクするとサーバーを過負荷にして通常業務に影響を及ぼす懸念がある。ec2 を作って cron でバッチ処理動かせばいいやんという気もするけど、せっかく cdk を使っているのでフルマネージドな仕組みで構築できればカッコいいなとも思ったりする。</p><h2 id=インフレ研究会>インフレ研究会</h2><p>たまたまみかけたので <a href=https://fin-py.connpass.com/>fin-py</a> のインフレ研究会に参加した。前は twitter spaces でやっていて、私はスマホに twitter アプリが入っていないから参加しにくくて微妙だった。最近は <a href=https://brave.com/ja/talk/>brave talk</a> でやっているのでパソコンからも参加しやすくなった。物価、金利、中央銀行の金融政策などの話しを私はまったくわからないのでほとんど聞いているだけ。聞いているうちに世の中のお金の流れが少しずつわかってくればいいかな。国債の値段が下がれば金利が上がるみたいなそういう話しを聞いてそうなんだという感じ。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0615/>設計談義は楽しい</a></h1><div class=post-meta><time class=post-date>2022-06-15 (Wed.) ::</time></div><span class=post-tags>#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/communication/>communication</a>&nbsp;</span><div class=post-content><p>0時に寝て4時半に起きてだらだらして2度寝して8時に起きた。</p><h2 id=jjug-のセッションの紹介>jjug のセッションの紹介</h2><p>jjug の公式アカウントがランダムにセッションのページを紹介している。私のセッションのリンクが今日ツィートされた。この日記を書いている時点で3つの「いいね」が付いている (1つは私なので除く) 。大して人気の出るような内容ではないし、なにかを期待しているわけでもないけど、誰からも関心を持たれなかったらそれはそれで発表者として寂しいなという気持ちもあって、ついつい見てしまった。ほんの2-3人でもいいから当日は発表を聴いてくれると嬉しい。そして、その流れで質問をしてくれればと考えている。もし当日、誰も聴いてくれなかったらスタッフの人が質問してくれるんやろか？</p><blockquote class=twitter-tweet><p lang=ja dir=ltr>JJUG CCC 2022 Spring 6月19日開催<br>[Track C] 10:25- <a href="https://twitter.com/hashtag/jjug_ccc_c?src=hash&ref_src=twsrc%5Etfw">#jjug_ccc_c</a><a href="https://twitter.com/hashtag/jjug_ccc?src=hash&ref_src=twsrc%5Etfw">#jjug_ccc</a><br>Java で作るカスタム GitHub Actions<a href=https://t.co/cwpuR7dPmJ>https://t.co/cwpuR7dPmJ</a></p>&mdash; JJUG (@JJUG) <a href="https://twitter.com/JJUG/status/1536868086938099715?ref_src=twsrc%5Etfw">June 15, 2022</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><h2 id=ブログ記事のレビュー>ブログ記事のレビュー</h2><p>朝一で昨日書いた記事を読み返しながら推敲した。やっぱり一晩寝ると、文章の粗が目立ってみえて細かい表現をあちこち直していた。その後に身近な人たちに記事のレビューをお願いして、概ね問題なさそうなので会社ブログの担当者にもレビュー依頼した。その返事はまだ返ってきていない。</p><h2 id=設計ミーティング>設計ミーティング</h2><p>先週から始めた <a href=/diary/posts/2022/0608/#開発チームで設計の話し>設計ミーティング</a> の2回目。時間は2時間も抑えられていて話題がなければ解散するといったやり方。今日もなんだかんだで2時間丸々話していた。うちらの開発チームは開発者で共有すべき開発情報や設計の考え方などの情報共有が不足しているんだなと、多くの時間を割いても話題が尽きないことからも実感した。私は設計を練るのが好きなのでそれ自体も楽しい。スクラムイベントで会議の時間が多い上にこのミーティングは追加で実務の時間を奪うという懸念が大いにある。しかし、2-3ヶ月やったらアプリケーションの設計や品質に何かしらよい影響を与えそうな雰囲気はしている。代わりに他のスクラムイベントを削ることはできないだろうか。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0614/>ゴーストライター</a></h1><div class=post-meta><time class=post-date>2022-06-14 (Tue.) ::</time></div><span class=post-tags>#<a href=/diary/tags/writing/>writing</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;</span><div class=post-content><p>0時に寝て6時に起きた。夜になにか作業をしようと考えていたけど、帰って晩ご飯食べたらだらだらしてた。</p><h2 id=ブログ記事の執筆>ブログ記事の執筆</h2><p>今度の jjug ccc にチームの同僚と一緒に登壇する。同僚の発表スライドをみていて15分で話すには詳細を説明できないことに気付いた。せっかくイベントで発表して、よいプラクティスもできたのにもったいないとか思い始めて、発表の補足資料となるブログ記事を書きたいと私が言い始めた。先方ものってきてくれて、会社ブログを管理している社内の担当者を紹介してくれてそこに技術記事を書こうという打ち合わせをした。聞くところによると会社のテックブログはまだなく、技術記事も1つもないという話し。今回が初めての技術記事を公開する試みになるらしい。それはともかく、<a href=https://note.com/info/n/nfa4a65bd08ea>note の新エディタ</a> が使えるようになっていたので初めて試してみた。新エディタの紹介記事を眺めてて画像のキャプションも入れられるようになったのにも気付いた。箇条書きの機能が増えたところはよいけど、勝手に段落がフォーマットされる感じが私の好みではない。エディタが勝手にフォーマットするのではなく、書き手が明示的に指示したときだけフォーマットされるような仕組みを私は好む。とはいえ、一般人は自動的によしなにやってくれる方がよいのかもしれない。半日ぐらいあーでもない、こーでもないと試行錯誤しながら一通りアウトラインに沿った草稿を書き上げた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0613/>データベースを介したテストではまった話し</a></h1><div class=post-meta><time class=post-date>2022-06-13 (Mon.) ::</time></div><span class=post-tags>#<a href=/diary/tags/spring-boot/>spring boot</a>&nbsp;
#<a href=/diary/tags/testing/>testing</a>&nbsp;</span><div class=post-content><p>1時に寝て7時に起きた。帰りにふらっと仲のよい焼き鳥屋さんに寄ったらちょっとしたハプニングがあって長居してしまった。他に来ていたお客さんのカップルが別れ話を始め、こじれてややこしい状況になって、この騒動が一段落しないと席を立てない空気になってしまって終わるのを待ってた。マスターの知り合いらしくて、そのお客さんが帰ってから当事者たちの背景を聞いたりしてた。人生いろいろあるよなぁ。</p><h2 id=spring-の-transactional-アノテーション>spring の Transactional アノテーション</h2><p>spring フレームワークには <a href=https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Transactional.html>Transactional</a> というアノテーションがある。<a href=https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/context/SpringBootTest.html>SpringBootTest</a> を使ったテストのときに使うと、テストメソッドの終了時に自動的にデータベースへの書き込みがロールバックされて便利なことを <a href=/diary/posts/2022/0208/#テストコードのリファクタリング>テストコードのリファクタリング</a> をしていたときに気付いた。</p><p>スレッドプールを使ってマルチスレッドで並行実行する処理を書いてそのテストを書いてみたら意図した結果にならない。なんでだろう？と2時間ほどはまってデバッグしていた。テストデータの書き込みが、実際にはデータベースにコミットされていないので、テストを実行しているスレッド以外のワーカースレッドからデータベースにアクセスしてもテストデータを参照できないからだと気付いた。データベースのトランザクションに細工すると、こういうはまりどころがあるなぁと気付いて Transactional を使わずに普通にテストを書いた。その分、自分でテストメソッドが呼ばれてコミットされたテストデータを削除する必要がある。調べていたときに他にも副作用がいろいろあるよという記事もみつけた。</p><ul><li><a href=https://dev.to/henrykeys/don-t-use-transactional-in-tests-40eb>Don’t Use @Transactional in Tests</a></li></ul></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0612/>オーディオコンテンツにお金を払う</a></h1><div class=post-meta><time class=post-date>2022-06-12 (Sun.) ::</time></div><span class=post-tags>#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
#<a href=/diary/tags/audio-media/>audio media</a>&nbsp;</span><div class=post-content><p>前日の夕方から寝たり起きたりでたくさん寝て7時に起きた。体力を回復した。</p><h2 id=ワーケーション記事の執筆>ワーケーション記事の執筆</h2><p>せっかくの機会なので会社ブログにもワーケーションのふりかえりを書いた。</p><ul><li><a href=https://kazamori.jp/blogs/2022/06/12/workcation-kinosaki/>ワーケーション -城崎温泉-</a></li></ul><p>いまのところ、会社のサイトをみてお仕事が来るような会社でもないんだけど、今後のマーケティングをしていく中でどんな会社なのかをみられることも増えていくと思う。そのときに会社という法人の人となりがわかるようなコンテンツがたくさんあるとよいのではないかとも考えている。基本的には技術記事をメインにするつもりだけど、たまにはそうじゃない記事もあるのはよいだろう。最近はお仕事ばかりで全然、技術記事を書けていない。私は書くのが遅いので、書けることや書きたいことに対して10分の1ぐらいしか書けず、コンテンツがまったく育たない。今後のマーケティングの課題でもあるなぁ。</p><h2 id=プレミアムリスナーになってみた>プレミアムリスナーになってみた</h2><p>いつからかな？2016年か2017年と思ってバックナンバーを遡って最初の放送を調べたら2017年5月30日が初回の放送だった。おそらく初期の時期から聴き始めたように思う。<a href=https://voicy.jp/channel/32>ベンチャーニュースで言いたい放題</a> というオーディオコンテンツがある。パーソナリティの話しがおもしろくて2-3年は聴いていた。起業した前後で余裕がなくて聴いていない時期が1年ほどあるけど、最近また余裕をもてるようになったので聴き始めた。5年前からずっと続いているし、いまも私が聴きたいと思うコンテンツを提供していることのすごさを実感する。そういった敬意も含めて <a href=https://service.voicy.jp/premium-listener>プレミアムリスナー</a> になることにした。購入はアプリ経由だと1480円、web 経由だと1000円になる。プラットフォームの制約があるのだろうけど、こんなことして apple に怒られないのかな？と心配になる。web 経由の方がお得ですよと普通に書いてある。プレミアムリスナーになると、プレミアムコンテンツを聴けるようになるが、おそらく配信されたばかりは期間限定で誰でも聴けて、時間が経ったらプレミアムリスナーしか聴けなくなるようなコンテンツにみえる。いままで何年も聴いてきたのと、今後も続けてほしいという願いも込めての料金支払いなので私はとくに不満はない。</p><p>私はいろんな仕事やプロジェクトを転々としてきたのもあり、何年も同じことをずっと続けていることそのものに尊敬の念がある。ベンチャーニュースで言いたい放題は5年継続していることになる。5年も続くとコンテンツそのものの価値や信頼、それに関するスキルもすごく上達すると思う。これまで私はプログラミングという文脈ではスキルを磨いてきたが、コンテンツを作っていくというところは素人なのでそういうところを見習いたいと考えている。そんなことも考えながら、気に入っているオーディオコンテンツにお金を払うことに決めた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0611/>ワーケーションの精算</a></h1><div class=post-meta><time class=post-date>2022-06-11 (Sat.) ::</time></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;</span><div class=post-content><p>1時に寝て7時に起きた。ふとんなしで寝ても寒くない季節になった。天気も悪かったので15時ぐらいから帰って、ドラクエタクトしたり、読み溜めてた LINE マンガ読んだり、疲れたら寝たりして普通に休んでた。</p><h2 id=ストレッチ>ストレッチ</h2><p>今週はバテバテになっていて、先週から引き続き、右股関節や右腰に張りが強い。右側が少し前に出たような形状になっているらしく、姿勢か癖かで右側に負荷が偏るなにかになっているみたい。今日の開脚幅は開始前159cmで、ストレッチ後161cmだった。現状維持といったところ。今週末は休もうと思っている。参考がてらトレーナーさんに休むときにどうするかを聞いてみた。ジムへ行って運動した後、それから考えるらしい。私の場合、起きたらひとまずオフィスへ行ってなんか調べものして過ごすことが多い。サードプレイスへ出掛けるのはわりと多くの人に共通する行動なのかなとか思えた。</p><h2 id=ワーケーションの精算>ワーケーションの精算</h2><p>今週はバタバタしていてまったく余裕がなかった。ワーケーションのお金の精算をした。同行者からも料金の一部を徴収しているのでこの金額すべてが経費ではない。食費や入浴料金、お土産を除くと次になる。</p><ul><li>宿泊費 (県民割引を適用後)<ul><li>1泊目: 26,000 (3人)</li><li>2泊目: 27,000 (4人)</li></ul></li><li>交通費<ul><li>レンタカー: 23,760</li><li>ガソリン代: 2,424</li><li>高速道路代: 5,230</li><li>駐車場代: 800</li></ul></li><li>接待<ul><li>居酒屋: 9,200</li></ul></li><li>合計: 94,414</li></ul><p>入浴料金を会社の経費にできるかどうかは福利厚生費ならできるらしい。但し、うちは社員がいないので福利厚生費を計上できない。原則として役員には福利厚生費を適用できない。福利厚生とは社員の生活や仕事の充実や向上を目的とするため、役員はそれを提供する側になる。とはいえ、役員と社員が一緒に利用する妥当な金額の福利厚生費なら認められるらしい。</p><ul><li><a href=https://www.reloclub.jp/relotimes/article/14803>役員に福利厚生は存在しない？迷いやすいポイントを解説</a></li></ul><p>高速道路の料金を etc の利用履歴から取得できないかな？と考えてググると、<a href=https://www.etc-meisai.jp/index.html>ETC利用照会サービス</a> というのをみつけた。初期登録するにはカード番号と直近の利用履歴、車両番号と車載器管理番号が必要になる。レンタカーの領収書には車載器管理番号までは記載されていなかったので店舗に電話して尋ねると快く教えてくれた。これでETC利用照会サービスに登録できたものの、登録後に利用明細が表示されるまで4時間かかるという。バッチ処理のタイミングなのか、なにかわからないけど、4時間は長過ぎでしょとか思いながら待った。待った甲斐があって明細は csv と pdf 出力できた。記録としてデータを残す上でダウンロード機能はありがたい。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0610/>リファクタリングとオブジェクト指向プログラミング</a></h1><div class=post-meta><time class=post-date>2022-06-10 (Fri.) ::</time></div><span class=post-tags>#<a href=/diary/tags/refactoring/>refactoring</a>&nbsp;</span><div class=post-content><p>0時に寝て8時に起きた。先週末の疲れが溜まってバテバテ。直近の1週間で睡眠時間が短いときは3-4時間しか寝てないのでなんか朝起きれなくて調子悪いなと思ったら単純に睡眠不足よね。なんか安心した。</p><h2 id=既存ロジックのリファクタリング>既存ロジックのリファクタリング</h2><p>ちょっと前にタイムラインで「値オブジェクト」の定義の話題で盛り上がっていた。私は詳しくないのでどちらが正しいのかの白黒を付けられないが、値オブジェクトがどういうものかの定義を知らなくても、オブジェクト指向プログラミングとしてデータ + メソッドでカプセル化していくモジュールの概念からすると普通のことであって、それの特殊ケースに名前が付いている・付いていないという議論だったのではないかと思う。</p><p>今日たまたま既存のある処理に機能を拡張するため、既存のコードを読んでいて、ロジックを扱うコンポーネントが肥大化していて、ここに手を入れていくとさらにコードの見通しが悪くなるように思えた。そのロジックコンポーネントの半分は出力用の DTO を生成する処理が占めていて、DTO を生成する処理をオブジェクトとして切り出すことでロジックコンポーネントを半分に分割できることに気付いた。パラメーターとして7つの値をそのオブジェクトの入力として、そのオブジェクトの内部であれこれやって、最終的に必要な DTO を出力できればよい。1つのコンポーネントを2つのコンポーネントに分割したことで、それぞれのコンポーネントのスコープにおけるメソッドが半分になったというだけの話し。一般的なカプセル化の話し。難しい話しをしなくても設計やオブジェクト指向プログラミングの基本的な考え方などをメンバーに教えていければいいんだけど、私はあくまで協力会社のお手伝いなので、教える業務は担っていない。次の契約更新のときにインフラやプログラミングを経験の浅い人たちに教えましょうか？みたいな話しもしたいと考えている。</p></div></article><div class=pagination><div class=pagination__buttons><a href=/diary/posts/page/67/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span></a>
<a href=/diary/posts/page/69/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>