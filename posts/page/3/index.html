<!doctype html><html lang=en><head><title>Posts :: </title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/posts/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="Posts"><meta property="og:description" content><meta property="og:url" content="/diary/posts/"><meta property="og:site_name" content><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/posts/index.xml rel=alternate type=application/rss+xml title></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/1003/>一日中テストコードを書いていた</a></h1><div class=post-meta><time class=post-date>2024-10-03 (Thu.) ::</time></div><span class=post-tags>#<a href=/diary/tags/badminton/>badminton</a>&nbsp;</span><div class=post-content><p>今日のバドミントン練習は22時半頃から近所のビル横の広場でリフティングを20分、キャッチを10分、壁当てを10分した。</p><p>リフティングや壁当てをしていて、自分の感覚とはずれてラケットを空振りしてしまうことがある。またラケットのスィートスポットでシャトルを捉えられず、フレームでこねてしまうこともある。この感覚のズレはなぜ起きるのかを考えるようになった。1つわかったことは飛んでいるシャトルを点で捉えようとすると空振りしやすい。シャトルの軌道を見極めてシャトルの移動する放物線でラケットを振ると捉えやすい。野球の球をうつときにもよく指摘される話しでもある。そのままバドミントンにも応用できるように思えた。体勢が崩れたり、向かってくるシャトルの速度にあわせられないときなど、シャトルの移動する放物線を目で捉えられなくて空振りしてしまう。理論がわかったからと言ってそんなすぐに対応できるわけでもないが、今日の練習をしていた気付いたことを書いていく。</p><p>外へ出掛けるときにラケットとシャトルをもって時間があれば、空きスペースで練習するのに慣れてきた。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/1002/>バドミントンの雨天練習場</a></h1><div class=post-meta><time class=post-date>2024-10-02 (Wed.) ::</time></div><span class=post-tags>#<a href=/diary/tags/badminton/>badminton</a>&nbsp;
</span><img src=/diary/img/2024/1002_building.jpg class=post-cover alt=バドミントンの雨天練習場 title="Cover Image"><div class=post-content><p>今日のバドミントン練習はお昼に20分、夜に30分ほどした。</p><p>15時頃コンビニへ飲みものを買いにいくついでに東遊園地へ寄り道して練習した。そんなに人が多いわけではないけど、公園でのんびりしている人たちがちょこちょこいる。空きスペースでおっさんが昼間からバドミントンの練習をするのはやや恥ずかしい。下手だし。「あの人働いてないんやろか」とか周りからみられているかもしれない。最初はそんなことを考えながらも、練習をやり始めたら集中してきてあまり気にならなくなった。昼間はリフティングを10分、キャッチを10分した。連続最大回数は127回、10分間に20回ほどキャッチできた。ほんの数十分でも毎日やっていれば徐々にうまくなっている気はする。</p><p>夜も近所でビルの玄関横の少し広いスペースをみつけた。ビルの正面玄関の電気がある。十分に明るくはないけど、ぎりぎりリフティングやキャッチの練習ならできる。しかも屋根があるから雨の日でも練習できる。22時頃ならほとんど人がいないからたぶん練習していても怒られない。なんだかんだで30分以上はやっていたと思う。シャトルを上に放り投げてキャッチするときに、一番簡単なのはシャトルが落ちてくる速度にあわせてラケット面を落としながら受ける。もっとも簡単で少し練習すれば5回に1回は成功する。しかし、このやり方は上下のシャトルの動きにしか対応できない。シャトルを上に放り投げてキャッチするときに上下のチカラの調整だけではなく、シャトルの落下速度にあわせながら横からラケットを当てて包み込むような取り方がある。うまくはまればかっこいい。失敗すると空振りするのでもう少し練習が必要になる。リフティングやキャッチのような基本的な練習でもチカラの向きやシャトルの動きから学ぶことはいくつもある。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/1001/>磯上公園での夜間練習</a></h1><div class=post-meta><time class=post-date>2024-10-01 (Tue.) ::</time></div><span class=post-tags>#<a href=/diary/tags/badminton/>badminton</a>&nbsp;
#<a href=/diary/tags/exercise/>exercise</a>&nbsp;
</span><img src=/diary/img/2024/1001_isogami.jpg class=post-cover alt=磯上公園での夜間練習 title="Cover Image"><div class=post-content><p>今日のバドミントン練習はリフティングとシャトルキャッチを30分、ながいさんと打ち合いを30分した。1時間近くバドミントン練習をしていたことで歩数で言えば5千歩相当の運動になった。バドミントンは激しい運動ではないものの、わりと動き回るので有酸素運動としても優等生だと思う。よい感じにカロリーを消費する。</p><h2 id=社内ハンズオン>社内ハンズオン</h2><p>社内向けハンズオンの2回目。<a href=/diary/posts/2024/0725/#ハンズオン>前回の社内ハンズオン</a> 。いまの開発フェーズの機能開発が落ち着いたのでハンズオンを実施して ui などのレビュー会も実施した。朝10時半から始めて、お昼休みをはさみつつ、16時頃までやっていた。私はハドルでつないで聞きながら自分の作業をやろうと思っていたものの、なにかしらハンズオン会場の会話や質問を聞いていると、その回答や背景などを slack に書いたりして注意力が取られてあまり自分の作業はできなかった。みんなでわいわい検証したり、プロダクトへのフィードバックや意見が出て楽しかった。</p><h2 id=いそがみ体育館お休み>いそがみ体育館お休み</h2><p>ながいさんとバドミントン練習する前に筋トレしようと早めにお仕事を切り上げて向かったらお休みだった。偶数月の第1火曜日が休館日らしい。それはわからんやろと帰ってきてから google カレンダーに登録した。2ヶ月ごとの第1火曜日の繰り返し予定という設定は google カレンダーで用意に登録できる。次は12月3日、その次は2月4日・・・今後はこの失敗を回避できるはず。</p><h2 id=いそがみのバドミントン練習>いそがみのバドミントン練習</h2><p>スーパーで買いものして家に戻って晩ご飯を作って食べてから20時半にいそがみ公園へ戻る。21時半まで約1時間、バドミントンの練習をした。リフティングやシャトルキャッチの練習をしていて、ながいさんが来られてから打ち合いをしてみた。街灯の隣でやればシャトルはみえなくはないけど、体育館で行うような集中したラリーにはなりそうもない。それは暗くてシャトルがみえにくいから。軽い運動で流す程度ならぎりぎりできるかもしれない。昼間と夜間で練習してみて、左右のシャトルの変化は暗くても把握しやすいが、前後のシャトルの変化は暗いと遠近感をつかみにくい。夜間の方がリフティングが難しいのも微妙に遠近感が狂うから。ラケットコントロールがうまくなればブレずにシャトルを空中に上げられて遠近感を気にせずにリフティングできるようになるかもしれない。</p><p>昨日からアウトドア用の <a href=https://www.yonex.co.jp/badminton/news/2021/04/2104161600.html>メイビスフィールド</a> と <a href=https://yonexshop.jp/item/detail/1_1_M-F2CBP_1/004>メイビスフィールドII</a> の、2つのシャトルを実際に使っていて、その違いを比べてみた。結論からいうとメイビスフィールドIIの方が性能がよいようにみえる。メイビスフィールドIIの方がシャトルをうったときの反発力は強く、軽い力で速く遠くへ飛ばせるように感じる。初期モデルに改良が施されていることが明らかに伺える。一方で初期モデルが不要かというとそうでもなく、リフティングやシャトルキャッチの練習をするなら反発力は必要ではないから跳ねない方がラケットコントロールが適切にできているかの練習になりそうな気もする。ラケットの中心 (スィートスポット) でシャトルを捉えられているか、シャトルのコルクをどの角度で捉えているかの感覚を養うにはあまり反発しない方が感触を確認しやすいようにも思えた。反発しないから強い打球をうつ練習にもなる。適材適所で使い分けようと思う。</p><p>ほかに LED ライトがついた光るシャトルというのも売っていて気になっている。電池交換は不可で数時間から数十時間ほど使えるらしい。屋外で行う <a href=https://japan-airbadminton.jp/>エアバドミントン</a> というのもある。風の影響を受けにくいエアシャトルを使う以外はバドミントンと大差なさそう。バレーとビーチバレーのような関係？これらのシャトルも近いうちに買ってみて試してみようと思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0930/>9月最終日に主開発を完了</a></h1><div class=post-meta><time class=post-date>2024-09-30 (Mon.) ::</time></div><span class=post-tags>#<a href=/diary/tags/refactoring/>refactoring</a>&nbsp;
#<a href=/diary/tags/career/>career</a>&nbsp;</span><div class=post-content><p>今日のバドミントン練習はリフティングを10分した。連続最大回数は70回できた。シャトルを上に放り投げてラケットでキャッチする練習も10分やってみた。昨日よりは少しうまくなった気がした。それでも5-10回に1回ぐらいの頻度。なかなか難しい。</p><h2 id=最後の厄介なリファクタリングを完了>最後の厄介なリファクタリングを完了</h2><p>一昨日から着手しているリファクタリング作業に朝から着手していた。一晩寝かせた効果だと思うが、昨日の夜にノーアイディアだった設計もさくさく進んでシンプルに実装できた。無意識の脳の働きがすごい。13時頃には実装を終えてマージリクエストを作るのに約1時間。なぜリファクタリングするのかの目的と意図をマージリクエストに書いた。最終的にはこの issue の対応は丸2日かけてコードを書き直した。これが早いのか遅いのか、もう私にはわからなくなってしまっている。昔の方が体力と集中力がある分、土日で終えられたかもしれないし、いまの方が経験がある分、昔よりも高い品質のコードを短い時間で書いているのかもしれない。</p><blockquote><p>老いは誰にもやってくる 歳を取れば技は練れる 駆け引きにもたける だが圧倒的なパワーに対して対抗しきれない日は必ず来る</p><p>幻海師範</p></blockquote><p>知人が「プログラミングは長い間やっているとわかるようになる」と表現していてその通りだなと私も思う。プログラミングに限らず習熟によってスキルアップする対象はだいたい同じなのかもしれない。いまバドミントンの練習を始めたばかりだが、1年後にはいまより少し上手くなっていると嬉しい。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0929/>1ヶ月ぶりの休日出勤</a></h1><div class=post-meta><time class=post-date>2024-09-29 (Sun.) ::</time></div><span class=post-tags>#<a href=/diary/tags/badminton/>badminton</a>&nbsp;
#<a href=/diary/tags/refactoring/>refactoring</a>&nbsp;
#<a href=/diary/tags/motivation/>motivation</a>&nbsp;
</span><img src=/diary/img/2024/0929_park.jpg class=post-cover alt=1ヶ月ぶりの休日出勤 title="Cover Image"><div class=post-content><p>今日のバドミントン練習はリフティングを昼間に10分、夜に10分、壁当てを10分した。連続最大回数は82回できた (昼間) 。昼間にやってみたら夜に街灯の隣でやるときとの違いに気付いた。ほんのそよ風でもシャトルは風の影響を受けるので空中で少し流れたりする。その微妙な変化が暗いとみえにくい。昼間にリフティングをやってみたことで真っ直ぐ落ちてこず微妙に風で流れていることを観察できた。あとシャトルを高くあげた方が重力による加速がつくので真っ直ぐ落ちてきやすくなるかもしれない。</p><h2 id=ポータブルネット>ポータブルネット</h2><p>外でバドミントンができる準備をしていく。調べてみたらいくつか製品の候補がみつかる。価格帯は3千円から1万円ぐらいの幅。最終的には YONEX の <a href=https://yonexshop.jp/item/detail/1_1_AC334_1/007>ポータブルネット(バドミントン用).AC334</a> に決めた。なにかの記事で初心者は製品の良し悪しの判断が難しいから YONEX を買っておけば間違いないと書いてあった。amazon で購入すると9千円ほどだった。土日の昼間に公園へ持っていって練習できるかもしれないし、バドミントン設備がない体育館を借りて練習するのもよいかもしれない。たまたま組み立てしている動画をみつけた。一緒にクリップを用意しておけば幅の調節もできるみたい。</p><div class=video-container><iframe src=https://www.youtube.com/embed/roPacqmZwZA allowfullscreen title=【YONEX/AC334】自宅で簡単にポータブルネットを組み立てよう☆></iframe></div><h2 id=お昼からずっとコードを書いてた>お昼からずっとコードを書いてた</h2><p>昨日は家に帰る途中でバドミントンの練習場所を探したり、軽く練習をしたりしていて、1時過ぎに帰ってだらだらして3時頃に寝たせいか、少し寝坊してお昼頃にオフィスへ行った。ちゃんと休日にオフィスへ行ってお仕事できるぐらいには体調 (モチベーション) が回復した。病気だったわけでもないが。本当は今日中にマージリクエストまで作りたかったが、ラストワンマイル的なところがなかなか煩雑で24時過ぎまでやって明日に持ち越すことにした。寝ているときに無意識で設計するから明日にした方がコードの品質も上がるだろうと、既存のコードのロジックの確認や設計のヒントになりそうなことの調査をして終えた。</p><p>日曜日にお仕事をしたのは1ヶ月ぶり。しかも12時から24時と途中で晩ご飯休憩をはさみながらほとんどフルタイムに働いていた。他人のコードのリファクタリングだから私が直さないといけない積極的なインセンティブがない。この開発フェーズの最後の issue だったのと、私がコードレビューして知ってしまっているからやる・やらないを選択しないといけない。やらなくても誰からも非難されないかもしれない。逆に言えば、だからこそ、やらないといけないなと昨日、決心した。覚悟したからどれだけ労力をかけようが気にならなくなった。そんな休日のモチベーション管理。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0928/>バドミントンのひとり練習</a></h1><div class=post-meta><time class=post-date>2024-09-28 (Sat.) ::</time></div><span class=post-tags>#<a href=/diary/tags/refactoring/>refactoring</a>&nbsp;
#<a href=/diary/tags/health/>health</a>&nbsp;
#<a href=/diary/tags/politics/>politics</a>&nbsp;
#<a href=/diary/tags/badminton/>badminton</a>&nbsp;</span><div class=post-content><p>今日のバドミントン練習はリフティングを30分した。連続最大回数は27回だった。</p><h2 id=最後の厄介なリファクタリング>最後の厄介なリファクタリング</h2><p>10時頃に起きて11時にはオフィスへ来て作業をしていたと思う。昨日ジョギングと筋トレしたから寝起きジョギングはやめて普通にオフィスへ行って作業していた。この issue はどこまでリファクタリングするかの決めの問題もあり、少し寝かせてあった。私のもてるスキルを駆使して思い切りやることを決めて土日で大半を終わらそうと思う。いくつかの葛藤と逡巡を振り払って着手はした。昼間は既存のコードの本質的な問題の分析、再設計のための要項の調査、軽くコードを書きながらの感触の確認などをしていた。その後、ストレッチに出掛けて戻ってきてから続きをやるつもりが、いろいろ雑務をやっていたら22時ぐらいになってしまってまた明日でいいやと諦めた。モチベーションが足りない。一回休み。</p><h2 id=ストレッチ>ストレッチ</h2><p>昨日、久しぶりに筋トレをして夜は全然平気だったのに寝て起きたらあちこち全身筋肉痛でストレッチもかなりきつかった。悪い痛みではないから筋肉をほぐしてもらった感じになる。今日の開脚幅は開始前146cmで、ストレッチ後153cmだった。筋肉痛だから硬めのように思えたが、数字だけ比べたら普段とそんなに変わらなかった。</p><p>トレーナーさんと自民党の総裁選挙の話題になって、一通りニュースをみて私も思うところはあったものの、政治的な話題のやり取りする場所がないから誰と話すこともないだろうとしまいこんでた矢先、トレーナーさんから話題が出てきたのでいろいろ話してみた。石破さんは自民党内で嫌われているから決戦投票で勝てないだろうという大方の見通しを覆したのは見事だったし、石破さんは良識なリベラル、且つ金融所得課税の強化に前向きだったりもするから市場の反応は悪い。これまでは総理大臣が変わったタイミングはご祝儀相場のように歓迎されることが多かったのに対して、月曜日は株価が急落するようにみられている。これほど市場からネガティブな反応が出るのも珍しいなという所感。余談だが、私はいまどちらのポジションもとっていないので株価が下がってもあまり影響はない。個人的にはシステムへの理解が深いという側面だけで河野さんを応援しているものの (一方で官僚に対するもの言いがパワハラ的なところがマイナス)、今回は後ろから2番目と不人気だった。日本では自民党総裁=総理大臣なわけではあるが、政治家が影響力をもつタイミングというのは本当に難しい。石破さんも5回目の総裁選ということで悲願が叶ってよかったんじゃないかと応援したい。</p><h2 id=ひとりでできるバドミントンの練習>ひとりでできるバドミントンの練習</h2><p>ストレッチを終えてから <a href=/diary/posts/2024/0927/#ラケット選び>購入したラケットを受け取り</a> してきた。試し打ちではないけど、買ったばかりで使ってみたいから KALIDIA チャンネルから1人でできる練習を探してみた。次の練習はラケットとシャトルとの距離感を掴むための練習になるという。なるべく日課としてしばらく続けてみたい。</p><ol><li>シャトルのキャッチ</li><li>バドミントンの技を3つ行う<ul><li>スピンネット</li><li>ミニクロスネット</li><li>ロビング</li></ul></li><li>リフティング</li><li>屋外で向かい風に向かってロビングを打つ</li></ol><div class=video-container><iframe src=https://www.youtube.com/embed/QJx8jHvzqFQ allowfullscreen title=「素振り」や「壁打ち」以外の上達に必要な力が身につく一人で出来る練習方法【バドミントン】></iframe></div></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0927/>2ヶ月ぶりの筋トレ</a></h1><div class=post-meta><time class=post-date>2024-09-27 (Fri.) ::</time></div><span class=post-tags>#<a href=/diary/tags/badminton/>badminton</a>&nbsp;
#<a href=/diary/tags/exercise/>exercise</a>&nbsp;
#<a href=/diary/tags/fouding/>fouding</a>&nbsp;</span><div class=post-content><p>今日は簡単な issue を2つ fix して作業の区切りがよかったので17時にはお仕事を終えた。この開発フェーズで対応する厄介な issue はあと1つだけ。それをもって私の開発者としての集中時間も一区切りとする。これ以上は自分の時間を開発に費やさず、普段通りのお仕事ペースでいこうかなと決めた。</p><h2 id=ラケット選び>ラケット選び</h2><p><a href=/diary/posts/2024/0921/#ラケット選び>先週やまとさんに教えてもらった</a> <a href=http://www.pro-champ.com/>バドミントンプロショップチャンプ</a> というお店へ行って店員さんにラケット選びの相談をしてきた。amazon やオンラインで買いものするのが当たり前となった昨今、リアル店舗で店員さんに相談してモノを買うというのはコンサル料も込みだと思うようになってきた。初心者向けのラケット選びは、ラケットを簡単に扱えることを前提として次の特徴が大事だという。</p><ul><li>ラケットの重さが軽め (4U: 80-84g が標準)</li><li>重心が手元に近い方にある (これをヘッドライトと呼ぶ)</li><li>シャフトが柔らかい</li></ul><p>一方で中上級者になると、フレームの先端側にあるヘッドヘビーが好まれるようで、その中間のバランスのよいタイプをイーブンと呼ぶ。ラケットの重さも重い方が強く返せるが操作が難しい。練習して上達したらヘッドヘビー側のラケットを選ぶようになっていくことを考慮すると、最初からヘッドライトではなく、イーブンでよいのではないか？という考え方もある。そしてイーブンを使っていてスキルアップして物足りなくなったら、そのときにヘッドヘビーのラケットを買い替えたらよいとのこと。事前調査した段階ではヘッドライトでよいと私は考えていたが、店員さんと話していてイーブンにしようと改めた。イーブンのラケットで製品の候補が3つあって最終的に <a href=https://yonexshop.jp/item/detail/1_1_ARC3_1/470>アークセイバー3. ARC3</a> に決めた。このお店では12,320円だった。他候補のアークセイバー1だと1万円台だった。主な違いはフレームが台湾製か日本製かになるという。ラケットはフレームの品質が重要らしく、その違いを私がわかるとも思えないが、2千円なら別にいいかと思ってアークセイバー3にした。ガットを張るために受け渡しは翌日になるとのこと。</p><ul><li><a href=https://tetsu-bado-minton.com/%e3%80%90%e3%83%a8%e3%83%8d%e3%83%83%e3%82%af%e3%82%b9%e3%80%91%e3%82%a2%e3%83%bc%e3%82%af%e3%82%bb%e3%82%a4%e3%83%90%e3%83%bc%ef%bc%93%e3%82%92%e3%83%ac%e3%83%93%e3%83%a5%e3%83%bc%ef%bc%81%e3%83%90/>【ヨネックス】アークセイバー3をレビュー！初心者に向けたバド上達ラケット！</a></li></ul><p>お店で買ったものの明細 (税込) 。ついでに練習用シャトルも1ダース買ってみた。</p><ul><li>ラケット: 12,320</li><li>ガット + ガット張り工賃 : 2,150</li><li>グリップテープ: 350</li><li>エアロセンサ200 (1ダース): 2,700</li></ul><h2 id=いそがみの筋トレ>いそがみの筋トレ</h2><p><a href=/diary/posts/2024/0802/#いそがみの筋トレ>前回の所感</a> 。気付いたら約2ヶ月ぶり。早めにお仕事を終えて十分に時間もあったから行ってきた。トレーニング器機の重さと回数を <a href="https://docs.google.com/spreadsheets/d/1YV4fg0m7Enpyeqj0Il1vkIt55N7UsCWtoQZvpss7L-8/edit?usp=sharing">筋トレの記録</a> に付けていた。2ヶ月ぶりだから前回の数値を覚えていないが、記録をみながら前回の数値を引き継いで筋トレできた。ちょっと辛めではあったものの、意外と同じ数値でこなすことができて、筋肉を増やすのは大変なものの、逆にそんな簡単に減りもしないということを確認できた場面でもあった。また週に2回ぐらいのペースで通えればよいなと思う。</p><h2 id=fitbit-交換とサポート対応>fitbit 交換とサポート対応</h2><p>出張へ出掛ける前に <a href=/diary/posts/2024/0923/#故障した-fitbit-の発送>故障したデバイスの返品手続き</a> をしていた。今日ちょうど交換用の新しいデバイスが届いた。サポートにトラブルシューティングの連絡をして、メールで購入証明や送り先の必要情報をやり取りして、1週間ほどで交換用デバイスが届くといった無駄のない効率的なサポート対応だったと思う。私の経験則においても、お客さんのサポートはトラブルそのものが問題ではなく、トラブル発生後に適切な対応をしてくれるが大事になる。今回のケースにおいても fitbit の故障そのものにまったくネガティブな印象はない。うちの会社もトラブルが起きたときはその原因の如何によらず、コストの損得に関わらず、そのとき出来ることの対応に努めることを法人の基本的な理念としたい。そんなことは社員を雇うときに考えることでもあるが。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0926/>非同期処理のキャンセルと中断待ち</a></h1><div class=post-meta><time class=post-date>2024-09-26 (Thu.) ::</time></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/design/>design</a>&nbsp;</span><div class=post-content><p>バックエンドで非同期のバッチ処理を実装してサーバーが shutdown したときに実行中のバッチ処理も安全に止めないといけない。</p><p>context でキャンセルするのは簡単だけど、非同期で動いている goroutine が中断してから終了したことを main プログラム側で待つ同期をどう実装しようか悩んでいた。たまたま <a href=https://zenn.dev/the_exile/articles/use-golang-context>【Go】Contextの魅力を感じる</a> の記事をみたら <a href=https://pkg.go.dev/sync#WaitGroup>sync#WaitGroup</a> と組み合わせたサンプルコードがあって、これまでも sync#WaitGroup を使ったコードを何度も書いてきて知っていたはずなのに context と組み合わせるという発想はなかったなと気付きを得た。それからライブラリとして汎用のバッチ処理の controller を実装した。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Controller</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ctx</span>    <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cancel</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>CancelFunc</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>wg</span>     <span style=color:#f92672>*</span><span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mu</span>     <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>Mutex</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Controller</span>) <span style=color:#a6e22e>Register</span>() (<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>Lock</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>Unlock</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithValue</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>ctxKey</span>{}, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>wg</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Controller</span>) <span style=color:#a6e22e>Stop</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>cancel</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Controller</span>) <span style=color:#a6e22e>Wait</span>() <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>struct</span>{} {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>Lock</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>Unlock</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>quit</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>struct</span>{}, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>slog</span>.<span style=color:#a6e22e>Debug</span>(<span style=color:#e6db74>&#34;completed to wait group in batch.Controller&#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>quit</span> <span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>struct</span>{}{}
</span></span><span style=display:flex><span>	}()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>quit</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewController</span>(<span style=color:#a6e22e>parent</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>Controller</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cancel</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithCancel</span>(<span style=color:#a6e22e>parent</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Controller</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>ctx</span>:    <span style=color:#a6e22e>ctx</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>cancel</span>: <span style=color:#a6e22e>cancel</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>wg</span>:     new(<span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>),
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>parent の context でキャンセルさせることもできるし、この controller の api からキャンセルさせることもできる。</p><p>この controller を使うアプリケーションのコードは次のようになる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>c</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>batch</span>.<span style=color:#a6e22e>NewController</span>(<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>wg</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Register</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// do something
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Done</span>():
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>slog</span>.<span style=color:#a6e22e>Debug</span>(<span style=color:#e6db74>&#34;canceled&#34;</span>, <span style=color:#e6db74>&#34;err&#34;</span>, <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Err</span>())
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>timer</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>NewTimer</span>(<span style=color:#ae81ff>10</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>timer</span>.<span style=color:#a6e22e>C</span>:
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>slog</span>.<span style=color:#a6e22e>Debug</span>(<span style=color:#e6db74>&#34;expected to complete waiting, but occur timeout&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Wait</span>():
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>slog</span>.<span style=color:#a6e22e>Debug</span>(<span style=color:#e6db74>&#34;completed to wait&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>context.Done() に習って Wait() が channel を返すことで timer と組み合わせて、バッチ処理の中断を待たずに終了するといった制御もできる。後になってふりかえると、timer の制御も Wait() メソッドに入れてしまってもよい気もするが、それは呼び出し側の要件によって変わってくるからこのままの方がライブラリのコードの見通しがよくてよい気もする。朝から設計して、昼間に実装して夕方にテストを書いて、帰りの新幹線でアプリケーションに組み込みしていた。1日でちゃちゃっと作ったわりにはよく出来たと思う。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0925/>excel が utf-8 で保存する csv ファイルは bom 付き</a></h1><div class=post-meta><time class=post-date>2024-09-25 (Wed.) ::</time></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/programming/>programming</a>&nbsp;
#<a href=/diary/tags/drink/>drink</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;</span><div class=post-content><p>昨日の定例会議で csv ファイルのエンコーディングの話しになって excel 2016 以降では utf-8 で csv ファイルを保存できるようになった。もう cp932 対応しなくてよいといった話題が出た。そのときにうろ覚えだったものの、excel は <a href=https://ja.wikipedia.org/wiki/%E3%83%90%E3%82%A4%E3%83%88%E9%A0%86%E3%83%9E%E3%83%BC%E3%82%AF>byte order mark (bom)</a> を付けていた気がして、実際にファイルを作ってもらったらそうだった。bom の有無は file コマンドや od コマンドでなどで調べられる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ file book1.csv
</span></span><span style=display:flex><span>book1.csv: Unicode text, UTF-8 <span style=color:#f92672>(</span>with BOM<span style=color:#f92672>)</span> text, with CRLF line terminators
</span></span></code></pre></div><p>ファイルの先頭に <code>0xef</code> <code>0xbb</code> <code>0xbf</code> の3バイトがつく。</p><pre tabindex=0><code>$ head -1 | od -t x1 book1.csv
0000000    ef  bb  bf  68  65  61  64  65  72  31  2c  68  65  61  64  65
0000020    72  32  2c  68  65  61  64  65  72  33  2c  68  65  61  64  65
...
</code></pre><p>印字可能な文字ではないため、テキストにするとわからないが、byte 列だと bom が付いているのがわかる。16進数の 0x68 が &lsquo;h&rsquo; になる。bom がついていると <code>header1</code> という文字列比較したときに別の文字列になってしまうので取り除かないといけない。</p><pre tabindex=0><code>文字列: &#39;header1&#39;
byte列: &#39;efbbbf68656164657231&#39;
</code></pre><p>いろんな対応方法があると思うが、<a href=https://stackoverflow.com/questions/21371673/reading-files-with-a-bom-in-go/76023436#76023436>so の回答</a> でみつけたこの方法がコードの見通しもよくて気に入った。次のように io.Reader をラップするようなコードになる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>newBOMAwaredCSVReader</span>(<span style=color:#a6e22e>reader</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Reader</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>csv</span>.<span style=color:#a6e22e>Reader</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>transformer</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>unicode</span>.<span style=color:#a6e22e>BOMOverride</span>(<span style=color:#a6e22e>encoding</span>.<span style=color:#a6e22e>Nop</span>.<span style=color:#a6e22e>NewDecoder</span>())
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>csv</span>.<span style=color:#a6e22e>NewReader</span>(<span style=color:#a6e22e>transform</span>.<span style=color:#a6e22e>NewReader</span>(<span style=color:#a6e22e>reader</span>, <span style=color:#a6e22e>transformer</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><a href=https://pkg.go.dev/golang.org/x/text@v0.18.0/transform#Transformer>Transformer</a> という仕組みがあって、準標準ライブラリの golang.org/x/text/encoding で実装されている。so の回答をみただけでコードを追加するのもよくないかと思って <a href=https://pkg.go.dev/golang.org/x/text/encoding/unicode#BOMOverride>unicode#BOMOverride</a> が返す bomOverride transformer のコードを読んで把握した上でテストを書いてマージリクエストを送った。実際の変換処理は次のようなもの。</p><ul><li>fallback として <code>encoding.Nop</code> を使う<ul><li>ソースの byte 列をそのまま使う (実際には変換しない)</li><li><a href=https://pkg.go.dev/golang.org/x/text/encoding#Encoding>https://pkg.go.dev/golang.org/x/text/encoding#Encoding</a></li></ul></li><li>最初に呼ばれたときに d.current (fallback) をセットして、2回目以降は fallback が呼ばれる</li><li>与えられた byte 列が 2byte 以上のときに bom のチェックを行う</li><li>bom があるときはそのバイト数を読み飛ばして d.current (fallback) で変換する</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>d</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bomOverride</span>) <span style=color:#a6e22e>Transform</span>(<span style=color:#a6e22e>dst</span>, <span style=color:#a6e22e>src</span> []<span style=color:#66d9ef>byte</span>, <span style=color:#a6e22e>atEOF</span> <span style=color:#66d9ef>bool</span>) (<span style=color:#a6e22e>nDst</span>, <span style=color:#a6e22e>nSrc</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>current</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>current</span>.<span style=color:#a6e22e>Transform</span>(<span style=color:#a6e22e>dst</span>, <span style=color:#a6e22e>src</span>, <span style=color:#a6e22e>atEOF</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>src</span>) &lt; <span style=color:#ae81ff>3</span> <span style=color:#f92672>&amp;&amp;</span> !<span style=color:#a6e22e>atEOF</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>transform</span>.<span style=color:#a6e22e>ErrShortSrc</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>current</span> = <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>fallback</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>bomSize</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>src</span>) <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>2</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>src</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0xFF</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>src</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0xFE</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>current</span> = <span style=color:#a6e22e>utf16le</span>.<span style=color:#a6e22e>NewDecoder</span>()
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>bomSize</span> = <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>		} <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>src</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0xFE</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>src</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0xFF</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>current</span> = <span style=color:#a6e22e>utf16be</span>.<span style=color:#a6e22e>NewDecoder</span>()
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>bomSize</span> = <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>		} <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>src</span>) <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>src</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#a6e22e>utf8BOM</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>src</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> <span style=color:#a6e22e>utf8BOM</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>src</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>==</span> <span style=color:#a6e22e>utf8BOM</span>[<span style=color:#ae81ff>2</span>] {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>current</span> = <span style=color:#a6e22e>transform</span>.<span style=color:#a6e22e>Nop</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>bomSize</span> = <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>bomSize</span> &lt; len(<span style=color:#a6e22e>src</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>nDst</span>, <span style=color:#a6e22e>nSrc</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>current</span>.<span style=color:#a6e22e>Transform</span>(<span style=color:#a6e22e>dst</span>, <span style=color:#a6e22e>src</span>[<span style=color:#a6e22e>bomSize</span>:], <span style=color:#a6e22e>atEOF</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>nDst</span>, <span style=color:#a6e22e>nSrc</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>bomSize</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>自分で実装してもなにも難しくないけど、すでに実績のあるコードがあるならそれを再利用した方が保守コストを削減できる。</p><h2 id=同期飲み会>同期飲み会</h2><p>新卒入社した会社の同期との飲み会。<a href=/diary/posts/2024/0730/#同期との飲み会>2ヶ月前と同じメンバー</a> で飲んできた。4人で飲む予定が、また1人が障害対応でドタキャンになったから3人で飲んでた。<a href=https://sake-genkabar.com/>日本酒原価酒蔵</a> という、おいしい日本酒を原価で提供するお店があるみたい。プレミアム飲み放題プランだったのでよいお酒をいろいろ飲み比べできた。どれもおいしかったし、ちょっとずついろいろ飲み比べできておもしろかった。飲み放題メニューに神戸のお酒がなかったのがよいことなのか残念なのか。前半は辛口の日本酒を飲んで、だんだん酔っ払って味がわからなくなるから、後半にコクや甘みの強い日本酒を飲むとおいしく飲めると教えてもらった。本当にその通りで日本酒の飲み方のよい勉強になった。お店で飲んだお酒のカードがもらえる。酔っ払って忘れてしまっても後で思い出せる。</p><figure><img src=/diary/img/2024/0925_sake.jpg></figure><p>特徴的なお酒で記憶に残っているもので <a href=https://miinokotobuki.com/>三井の寿</a> がスラムダンクに出てくる三井寿に由来して命名されていて、その背番号である14番と同じアルコード度数14度、日本酒度 (辛口甘口の度合いを表す) +14 と意図的？にあっているとのこと。日本酒の中ではトップクラスの辛口らしい。たしかに過去に私が飲んだことがないキレだった。もう1つは <a href=https://contents.thedann.com/entry/%E8%AE%83%E5%B2%90%E3%81%8F%E3%82%89%E3%81%86%E3%81%A7%E3%81%83%E3%81%AE%E6%97%A5%E6%9C%AC%E9%85%92%E3%82%92%E5%BE%B9%E5%BA%95%E8%A7%A3%E8%AA%AC>讃岐くらうでぃ</a> という、カルピスのような風味に近い珍しいお酒。甘いので後半に飲むとよい。うちらは酔っ払って訳がわからなくなってきたときに口直しのように飲んでた。そういう飲み方をするものかどうかはわからないが、飲みやすいのでついつい飲んでしまい、さらに酔ってしまう典型的なお酒。同期飲みは記憶をなくす感じで飲む。この歳になってこんな飲み方する相手いないなと思うとまた楽しい。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0924/>晩酌セット</a></h1><div class=post-meta><time class=post-date>2024-09-24 (Tue.) ::</time></div><span class=post-tags>#<a href=/diary/tags/biztrip/>biztrip</a>&nbsp;
#<a href=/diary/tags/food/>food</a>&nbsp;</span><div class=post-content><p>昨日はテンションがあがらなくて前泊をやめて久しぶりに始発の新幹線にのって東京へ向かう。ゼロ時頃まで作業をして帰って晩ご飯を作って食べて、お風呂入って、適当に時間を潰したり仮眠したりしているうちに5時頃になって出掛けた。新幹線でもなるべく寝ておこうと思ったものの、あまり寝付けなくて仮眠程度だったと思う。過去の経験だと、始発でいくと夕方には眠気と疲労でしんどかったりするものが、休日明けのせいか、まったくしんどくなかった。なんか体調管理もおかしい。</p><p>いつも通りマイルストーン最終日の定例会議に出席して、そのスケジュールにあわせて issue を2つ fix して、可もなく不可もなく特徴のない1日の働き方だった気がする。</p><p>お昼ご飯を食べる余裕がなくて夜にまとめて食べた。この前チームランチで行った <a href=https://tabelog.com/tokyo/A1316/A131603/13217309/>ハルピン</a> という中華料理屋さんを気に入っていて、その後も出張のときに必ず1回は行くようになった。晩酌セットというのがあって小皿3品 + 餃子3個 + 飲みもの1杯で1330円というコース。たとえば、小皿の1つは次のよだれ鶏のようなもの。</p><figure><img src=/diary/img/2024/0924_harupin2.jpg></figure><p>餃子はこんな感じ。</p><figure><img src=/diary/img/2024/0924_harupin3.jpg></figure><p>私はこの晩酌セットに単品で料理をもう1つ頼む。今回は定番料理の鶏肉のカシューナッツ炒めを食べた。おいしかった。</p><figure><img src=/diary/img/2024/0924_harupin1.jpg></figure><p>2000円ちょっとで一杯飲んでいくつか料理も味わえて満足、且つコスパもよい。今後も2泊するうちのどちらか一方の晩ご飯はこのお店になる可能性が高い。</p></div></article><article class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0923/>前泊のドタキャン</a></h1><div class=post-meta><time class=post-date>2024-09-23 (Mon.) ::</time></div><span class=post-tags>#<a href=/diary/tags/project-management/>project management</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;</span><div class=post-content><p>朝から起きてはいたものの、午前中は漫画読んでだらだらしていて、お昼からオフィスへ行って作業していた。軽くコードを書いてリファクタリング後の機能拡張の issue を2つ fix した。先週いっぱいリファクタリングして内部設計を改善したので、その先にある機能拡張は容易ですぐに対応できた。本当は今晩から移動して前泊する予定だったが、今晩のホテルを予約してなくて新幹線も遅れたりしている状況だったので明日の早朝に変更した。<a href=https://smart-ex.jp/>スマートEX</a> 便利。</p><h2 id=近況報告の資料作り>近況報告の資料作り</h2><p>昨日やろうと思っていたものの、休んでいたので今日作っていた。issue の数字だけみればまずまずの実績ではある。意図していた機能開発も動くレベルでは実装できていて完璧ではないが悪い状態ではない。先週と今週は3連休が2回続いて、9月は祝日が2日あって稼働時間が少ないことを考慮すると、十分と言える気もする。今月は若いメンバーの開発したモノをレビューしたりリファクタリングする時間を多くとった。その過程で <a href=/diary/posts/2024/0913/#隔週の雑談>相手に責任を投げてしまわない働き方</a> の考察をする機会にもなった。若いメンバーがそうなるためには経験や時間を必要とするのはわかりつつ、自律的な働き方への取り組みとしてマネジメント側からできることはあるのか、もしくはただ待つだけなのか、そういう話題も近況報告のスライドに入れてみた。</p><h2 id=故障した-fitbit-の発送>故障した fitbit の発送</h2><p>サポートとやり取りして <a href=/diary/posts/2024/0920/#fitbit-故障>デバイス異常になってしまった fitbit</a> を返品することになった。メールで添付されてきた返品票を印刷して、壊れたデバイスと一緒に梱包してファミリーマートへ持っていった。発送用の QR コードもメールに添付されていた。ファミリーマートの <a href=https://www.family.co.jp/services/delivery/home_delivery.html>宅配便・配送</a> サービスで読み取ったレシートをレジへ持っていって、店員さんから配送用のラベルを受け取って梱包物に貼り付けて発送できた。先方で返品確認してから交換用デバイスを送ってくれる予定。</p></div></article><div class=pagination><div class=pagination__buttons><a href=/diary/posts/page/2/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span>
</a><a href=/diary/posts/page/4/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>