<!doctype html><html lang=en>
<head>
<title>Posts :: forest nook</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=keywords content>
<meta name=robots content="noodp">
<link rel=canonical href=/diary/posts/>
<link rel=stylesheet href=/diary/assets/style.css>
<link rel=stylesheet href=/diary/assets/green.css>
<link rel=stylesheet href=/diary/style.css>
<link rel=apple-touch-icon href=/diary/img/apple-touch-icon-192x192.png>
<link rel="shortcut icon" href=/diary/favicon.ico>
<meta name=twitter:card content="summary">
<meta name=twitter:site content="t2y">
<meta name=twitter:creator content>
<meta property="og:locale" content="en">
<meta property="og:type" content="website">
<meta property="og:title" content="Posts">
<meta property="og:description" content>
<meta property="og:url" content="/diary/posts/">
<meta property="og:site_name" content="forest nook">
<meta property="og:image" content="/diary/favicon.ico">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<link href=/diary/posts/index.xml rel=alternate type=application/rss+xml title="forest nook">
</head>
<body class=green>
<div class="container full headings--one-size">
<header class=header>
<div class=header__inner>
<div class=header__logo>
<a href=/diary>
<div class=logo>
forest nook
</div>
</a>
</div>
<div class=menu-trigger>menu</div>
</div>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/diary/about>自己紹介</a></li>
<li><a href=/diary/dates>月別一覧</a></li>
<li><a href=/diary/tags>タグ一覧</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/diary/about>自己紹介</a></li>
<li><a href=/diary/dates>月別一覧</a></li>
<li><a href=/diary/tags>タグ一覧</a></li>
</ul>
</nav>
</header>
<div class=content>
<div class=posts>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0425/>本番環境反映の監督</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-25
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/cdk/>cdk</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
</span>
<div class=post-content>
<p>昨日は思いっきり昼寝してしまったせいか、夜に眠れなくて3時ぐらいまで起きてて、寝たのか寝てのかよくわからない雰囲気で7時前に起きた。</p>
<h2 id=インフラ作業の本番反映>インフラ作業の本番反映</h2>
<p>先週対応した <a href=/diary/posts/2022/0419/>api gateway のコード化</a> を本番環境に反映した。手動で作成されていた api gateway, vpc link, セキュリティグループとそれに関連するリソース群を cdk 管理のコードで置き換える。既存のリソースを削除してから cdk でデプロイするため、失敗しても切り戻しできないのでプレッシャーがかかる。とはいえ、想定通りに作業が進捗して2時間ほどで完了した。それと並行してテスト環境では、手動で作成された rds を cdk 管理のコードで置き換える移行作業をしていた。これも一筋縄ではいかなくて右往左往しながら作業してた。これを本番環境でやるのもまた億劫だなぁと思いながら発生したエラーや事象を書き綴っていた。あと本番環境で行う大きな移行作業はこれだけ。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0424/>個人開発楽しい</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-24
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て7時に起きた。朝から雨降りだったのでだらだらしながら家を出たけど、オフィスに着いたのは9時頃だったと思う。午前中にコードを書いてテストして、それからお昼ご飯食べて、家に戻って、ちょっとゆっくりしてからオフィスに戻ろうと思ってたら3時間ほど寝てた。</p>
<h2 id=backlog-のコミット連携の反応>backlog のコミット連携の反応</h2>
<p>たまたまツィートしていたらこみやさんが関心をもってくれた。fix, close などでチケットのステータスを変えたいという要望をもらったので作ることにした。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>同じ構成なのでちょっと気になる</p>&mdash; tk0miya (@tk0miya) <a href="https://twitter.com/tk0miya/status/1517681854539001856?ref_src=twsrc%5Etfw">April 23, 2022</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<p>3時間ほどとわりとすぐに実装できた。いまのプロジェクトでは使わない機能なので当初は乗り気ではなかったけど、やっぱり使いたいという人がいると開発のモチベーションになる。</p>
<ul>
<li><a href=https://github.com/kazamori/backlog-github-integration-action/pull/3>Add a feature to change the issue status with commit messages (fix, close) #3</a></li>
</ul>
<p>機能拡張して、テストしたり、ドキュメント書いたりしてた。github discussions も積極的に使ってみようと思っていてちょっとした faq も書いてみた。</p>
<ul>
<li><a href=https://github.com/kazamori/backlog-github-integration-action/discussions/4>About Internationalization (i18n) #4</a></li>
</ul>
<p>1-2週間ほど試験運用して問題なさそうだったら v1 のタグをつけて marketplace などに公開してもよいかもしれない。ブログにも書かないとな。まだまだタスクは残っている。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0423/>個人開発の日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-23
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。午後から昨日作った機能拡張のテストをしながらコードの修正やテストコードを追加したりしていた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今日の開脚幅は開始前161cmで、ストレッチ後161cmだった。先週はワクチン接種後にダウンして寝込んでいて数値が悪かったのが元に戻った感じ。それでもまだ復調にはいたらないのか、右の肩甲骨が硬いのと腰の張りもすごかった。3月からずっとだらだらした生活を送っているのでもうちょっと生活をびしっとしないといけない。インフラエのお仕事を引き受けてから深夜早朝に作業する機会が増えて生活のリズムを崩しているのもあるとは思う。歳をとって体調がよくない日が増えるという話しを聞いたけど、私もストレッチを始める前はそうだったような気がするけど、毎週ストレッチに通うようになってからそういう印象が解消した。もう1年以上通っているから間違っていないと思う。毎週どこそこが悪いといったことも書いたりはしているけど、それはストレッチをする上でのよくないところや前週よりも成果が出ないところの話しであって、日常生活を送る上ではまったく影響はない。ストレッチは正義。</p>
<h2 id=go-conference-2022-spring-online>Go Conference 2022 Spring Online</h2>
<p>ストレッチを終えてから <a href=https://gocon.jp/2022spring/ja/>Go Conference 2022 Spring Online</a> に参加した。いくつか発表を聞きながらコードを書いたりもしていた。一番よかったのはたいちさんの <a href=https://drive.google.com/file/d/1lsF7q74o0Akewk-5rUb9Jt9nA2MqpDDw/view>DBアクセスライブラリkra</a> の発表かな。<a href=https://github.com/taichi/kra>taichi/kra</a> というライブラリも知らなかったので機会があれば今度使ってみようという気になった。私も sql 好きだし、orm の弊害の話しも共感できてよかったと思う。orm 使うなという話しではなく、それぞれの用途にあわせて使い分けたい。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0422/>カスタム action の開発再開</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-22
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
</span>
<div class=post-content>
<p>22時に寝て0時に起きて3時に起きて5時半に起きた。</p>
<h2 id=ワーケーションのリトライ>ワーケーションのリトライ</h2>
<p>オミクロン株の流行で延期していた開発合宿を行う。レンタカーと <a href=https://kinosaki-kinoie.com/>きのいえ</a> の予約を6月3-5日で確定させた。3回目のワクチンを接種したばかりだし、世の中の雰囲気も with コロナへの取り組みになってきている気がする。行き先は同じなので前回作った旅のしおりをコピーしていくつか修正しながら再計画していく。<a href=https://goto.jata-net.or.jp/>Go To トラベル</a> 再開が6月ではないかという噂もある。</p>
<h2 id=backlog-github-integration-action-の機能拡張>backlog-github-integration-action の機能拡張</h2>
<p>先日作った <a href=/diary/posts/2022/0327/>backlog-github-integration-action</a> に push という新たなサブコマンドを追加した。コミットをリポジトリに push したときのイベントをフックしてカスタム action を実行する。インプットが github から取得できるデータになるため、<a href=https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows>GitHub Events</a> 単位にサブコマンドを作ればトリガーと扱えるインプットデータが一致してわかりやすい機能分割になるんじゃないかと思えた。ひとまずそれでやってみる。今日のところはローカルで動かしてコミット連携ができることを確認して、いくつかテストを書いていた。また明日、結合レベルのテストをやってみる。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0421/>rds の再作成</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-21
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/cdk/>cdk</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て5時半に起きた。久しぶりによく眠れた気がする。</p>
<h2 id=rds-を独立したスタックに分離>rds を独立したスタックに分離</h2>
<p>昨日の続き。ライフサイクルにあわせたスタックに分割し、スタック間の依存関係を適切に定義することで堅牢なインフラコードになる。最後に残った DatabaseStack を分離するところを朝からやっていた。</p>
<ul>
<li>DatabaseStack
<ul>
<li>BackendStack
<ul>
<li>GatewayStack
<ul>
<li>FrontendStack</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>rds を壊して、バージョンを aurora postgresql 最新の 13.x にアップグレードして、cf のテンプレートで小細工をしながら既存の環境を移行したりしていた。<a href=https://www.postgresql.org/docs/13/app-pgdump.html>pg_dump</a> を使ってテキストに dump したデータを、psql を使ってリストアしたりもした。データ量が少なかったらこれで移行してもいいかもしれない。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ pg_dump --host mydb.xxx.ap-northeast-1.rds.amazonaws.com --username user mydb &gt; mydb.dump
$ psql --host mydb.xxx.ap-northeast-1.rds.amazonaws.com --username user --dbname mydb --file ./mydb.dump
</code></pre></div>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0420/>堅牢なインフラコード</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-20
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/cdk/>cdk</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て5時に起きた。</p>
<h2 id=駐輪場の定期更新>駐輪場の定期更新</h2>
<p>3ヶ月ごとの更新。ちょうどいまのお仕事の契約と同じ更新月になっている。前回と同じ金額だったのでまだ駐輪場の料金は値上げされていない。世界的にインフレしているのに日本が全然インフレしていない理由の1つとして不動産が値上げしていないからというのを日銀の記事で見かけた気がする。どこかのタイミングで不動産関連の値上げも始まるのかもしれない。</p>
<h2 id=インフラコードの抜本的リファクタリング>インフラコードの抜本的リファクタリング</h2>
<p>約2週間かけて、新規インフラ環境の構築、既存インフラの cdk/cf と同期されていなかったインフラ (rds, security group, croudfront, api gateway, waf) の同期など、インフラコードの大きな変更をやり終えた。一部 <code>fromLookup</code> でインポートしているリソースもあるが、いま完全に cdk/cf 管理なインフラとなった。ここからはせっかく cdk でコードを書いているので、モジュール化や共通化など、再利用可能なリソースとして定義して、複数の Stack でコードを再利用するといったリファクタリングをしていく。ひとまずこのことをボーナスステージと呼ぼう。いま完全に同期されたインフラがあるため、インフラ上のリソースの差分が出なければリファクタリングは正しいことが保証される。cdk は <a href=https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib-readme.html#dependencies>Stack 間の依存関係</a> も定義できるため、適切な依存関係を定義することでより堅牢なインフラコードとなるはずである。具体的には次のような依存関係になる。然るべき堅牢なインフラコードに書き換えていく。</p>
<ul>
<li>DatabaseStack
<ul>
<li>BackendStack
<ul>
<li>GatewayStack
<ul>
<li>FrontendStack</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0419/>api gateway のデプロイ検証</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-19
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/cdk/>cdk</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。</p>
<h2 id=api-gateway-のデプロイ検証>api gateway のデプロイ検証</h2>
<p>昨日の続き。api gateway を再作成すると、当然、既存のテスト環境は疎通できなくなってしまう。他の開発者を妨害しないようにまた21時から深夜にかけて作業しようと考えていたら、いまは閑散期でテスト環境を使わないといけないような開発の状況にはないと他の開発者から教えてもらった。PO の人たちも検証は一段落しているとのこと。午後からテスト環境壊してもよいという確認が取れたので13時からインフラ作業をしていた。早ければ1時間ぐらい、遅ければ4時間と見積もって、実際にデプロイしてみると、あれやこれやの抜け・漏れ、手動で設定されていたリソースの弊害などもあって、3時間ぐらいかかった。もう2週間ほどインフラの作業ばかりやっているせいか、何が起こっても4時間ぐらいあれば調査とリストアを完了できるぐらいの自信がついてきた。最終的に cdk で再作成した api gateway を使って cloudfront の distribution 経由で web api 呼び出しが繋がった。当たり前の話なんだけど、繋がる瞬間、ローカルで web api のエンドポイントを叩いてレスポンスが返ってくるときが嬉しい。最後の大物だったインフラもたった2日でやっつけることができた。これからはボーナスステージ。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0418/>api gateway のコード化</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-18
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/cdk/>cdk</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て7時に起きた。</p>
<h2 id=api-gateway-のコード化>api gateway のコード化</h2>
<p>いま cdk で管理していない大きなインフラとして <a href=https://aws.amazon.com/jp/api-gateway/>api gateway</a> がある。さらに restful api ではなく http api という新しい仕組みを使っているため、cdk 側も experimental な機能として提供されている。experimental と言っても本番環境で使われいるので十分に production ready と言える。弊害としては cdk のサンプルコードが少なく、公式の api reference に付いているサンプルコードぐらいしか参考になるものがなく、適当にコードを書いてでデプロイし、管理画面で意図した設定になっているかを確認するといったトライ&エラーみたいなやり方しかない。今日の時点では pr まで作ってデプロイと検証は翌日にまわることにした。</p>
<p>さらに cdk の v2 系では <code>-alpha</code> というパッケージが experimental 向けの機能を提供している。バージョン番号ではなく、パッケージ名に alpha が付くという分かりにくさに拍車をかけている。お手伝い先で使っている設定は次の3つのパッケージを使うことで実現できた。api gateway, vpc link, integration, route, authorization, stage など、複数のリソースを連携して設定しないといけないのでちょっとややこしい。</p>
<ul>
<li><a href=https://www.npmjs.com/package/@aws-cdk/aws-apigatewayv2-alpha>https://www.npmjs.com/package/@aws-cdk/aws-apigatewayv2-alpha</a></li>
<li><a href=https://www.npmjs.com/package/@aws-cdk/aws-apigatewayv2-authorizers-alpha>https://www.npmjs.com/package/@aws-cdk/aws-apigatewayv2-authorizers-alpha</a></li>
<li><a href=https://www.npmjs.com/package/@aws-cdk/aws-apigatewayv2-integrations-alpha>https://www.npmjs.com/package/@aws-cdk/aws-apigatewayv2-integrations-alpha</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0417/>草稿書き</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-17
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/founding/>founding</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て7時に起きた。昨日もだらだらしていたので体調は完全に回復した。</p>
<h2 id=事例紹介の草稿作成>事例紹介の草稿作成</h2>
<p>お仕事で手伝っている会社の開発を事例紹介として紹介してよいという許諾をいただいた。草稿を提出して確認してもらわないといけないが、もう2週間前から放置してしまっていた。若い人には信じられないことだと思うけど、やろうと思った作業を後回しにしていると2週間ぐらいすぐに経つ。別にやる時間がないほど忙しいというわけではなく、なんとなく気乗りしないとか、割り込みでやるのが面倒くさいとか、今日は疲れたからまた明日やろうとかの延長で2週間が経ってしまう。若い人からみておっさんは仕事が遅いとか思われるわけだと思う。放置している2週間のうちに2回ほどちょこちょこ文章を書いたり、資料集めしたりはしていたので何もしていないわけではないが、本気を出せば2-3時間で終えることに2週間かかるのがおっさんのスピード感だと言っていいのだろうと思えた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0416/>病み上がり</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-16
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<div class=post-content>
<p>半日寝込んでいて3時に起きて7時に起きた。午後から、昨日寝込んでいたときに届いていたレビュー依頼の内容をレビューして、コードのリファクタリングをした。その後、病み上がりで調子が出ないので今日は気分転換しようと決めた。ストレッチを受けているときの、トレーナーさんの同じ体勢でいるのはよくないという言葉を思い出して、自転車でちょっとサイクリングして、その後、漫画喫茶に行って漫画読んでた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今日の開脚幅は開始前158cmで、ストレッチ後160cmだった。昨日は発熱でずっと寝込んでいたせいか、体が硬くなってしまっていていつもよりストレッチを受けていて辛い部位が多かった。トレーナーさん曰く、ずっと同じ体勢でいるのが体にとってよくないとのこと。普段よりも肩甲骨まわりの筋肉が硬くなってしまっていたらしい。病み上がりで体調が整っていないときにストレッチを受けるのも復調させるための準備としてちょうどよかったのかもしれない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0415/>ワクチンの副反応でダウン</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-15
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
</span>
<div class=post-content>
<p>3時に寝て6時に起きた。1時までインフラ作業して帰ってきて、ワクチン接種のせいか、あまりうまく眠れなかった。朝に熱を測ったら37.2℃だったのでぎりぎり平熱だった。</p>
<h2 id=隔週の雑談>隔週の雑談</h2>
<p>顧問のはらさんと隔週の打ち合わせ。今日の議題は次の通り。徐々に熱が出てきてしんどかったせいか、情報共有の報告程度で終えた。</p>
<ul>
<li>今期の予算策定</li>
<li>次のお仕事を探す段取りの見通し
<ul>
<li>現プロジェクトの区切りが5月末にあることから次の契約更新のタイミング (7月末) で契約終了する可能性がある</li>
</ul>
</li>
<li><a href=/diary/posts/2022/0115/#ワーケーション延期>延期したワーケーション</a> の再計画
<ul>
<li>6月か7月ぐらいがよさそう</li>
</ul>
</li>
</ul>
<h2 id=ワクチンの副反応>ワクチンの副反応</h2>
<p>朝オフィスで測ったときは37.2℃でこのぐらいなら普通にお仕事できるかなと始めたんだけど、段々体温が上がってきて10時ぐらいには37.9℃になって、しんどいから一旦家に帰って横になって、デイリースクラムだけ家から参加した。その後もずっと寝込んでた。何回か起きて熱を測ったら最高38.5℃まで上がった。厚労省のサイトによると、3回目の副反応は2回目と同等とある。私は2回目の副反応はここまでひどくなかったのでこの差はファイザーとモデルナの違いなのかもしれない。熱が出て寝込むとか、数年に1回ぐらいの頻度でしか起きない。病気になったらこのぐらいしんどいんだなという、しんどさを思い出すのにちょうどよかったのかもしれない。</p>
<ul>
<li><a href=https://www.cov19-vaccine.mhlw.go.jp/qa/0101.html>追加（3回目）接種ではどのような副反応がありますか。2回目より重いのでしょうか。</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0414/>コロナワクチン3回目</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-14
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
</span>
<div class=post-content>
<p>22時に寝て3時に起きた6時に起きた。季節の変わり目のせいか、いつも眠い。</p>
<h2 id=ワクチン3回目接種>ワクチン3回目接種</h2>
<p><a href=/diary/posts/2021/0927/#コロナワクチン2回目摂取>2回目は昨年の9月27日</a> に接種した。6ヶ月以上経たないといけないので3月27日以降に接種資格を得て、実際に接種券が届いたのが4月7日だった。神戸市は初回のときにまごまごしたので他の自治体よりも遅れている。これまでファイザーを2回接種したので今回はモデルナを受けてみることにした。モデルナを扱っていてネット予約できるもっとも近くの診療所を予約した。オフィスから自転車で15分ぐらいのところ。16:30の予約なのに16時過ぎぐらいに行ったら普通に受け付けしてくれてすぐに接種もできた。16:05に接種終えて16:20まで待機してオフィスに戻ってきて普通にお仕事してた。その1時間半後に熱を測ったら37.0℃だった。その後もやや熱っぽいけど、平気とは言えば平気。</p>
<h2 id=インフラ移行作業>インフラ移行作業</h2>
<p>昨日の続き。フロントエンドのテスト環境が壊れる可能性があるため、他メンバーが使っていない夜に移行作業を行う。POの人たちがQA検証を19-21時ぐらいにやっていることが多いので21時以降に作業すると連絡しておいた。なかなか大変だった。最悪の場合、数時間テスト環境を使えませんと伝えていたものの、その通りで4時間ぐらい検証作業をしていた。cloudfront の distribution 設定を CloudFrontWebDistribution から Distribution へ移行して、新しいやり方であるマネージドポリシーを使うようにした。この設定が意図した振る舞いにならなくて検証作業に時間を割いた。</p>
<p>cloudfront 経由で web api を呼び出すルートがあってキャッシュを無効にしたいのだが、無効にしたキャッシュポリシー (ttl をゼロにする) を作るとヘッダーの設定ができない。次のようなエラーになる。</p>
<pre tabindex=0><code>The parameter HeaderBehavior is invalid for policy with caching disabled.
</code></pre><p><a href=https://github.com/aws/aws-cdk/issues/13441>(cloudfront): Cache Policy cannot forward Authorization header. #13441</a> によると、maxTTL を1秒にして <code>Authorization</code> ヘッダーをオリジンに転送するようには設定できる。キャッシュメソッドは GET と HEAD なので実運用上は問題ないとは思うが、この回避策がないかどうかを調べて検証していた。結果としてはなかった。<a href=https://docs.amazonaws.cn/en_us/AmazonCloudFront/latest/DeveloperGuide/add-origin-custom-headers.html#add-origin-custom-headers-forward-authorization>Configuring CloudFront to forward the Authorization header</a> には <code>Authorization</code> ヘッダーを転送する方法は次の2通りとある。</p>
<ol>
<li>cache key に含める</li>
<li>Managed-AllViewer という origin request policy をすべての viewer requests に含める</li>
</ol>
<p>最終的には1番目のやり方で対応はしたが、2番目のオリジンリクエストポリシーを設定する方法も検証してみた。オリジンリクエストポリシーを単体で設定することはできなくて、キャッシュポリシーも一緒に設定しないといけないことからキャッシュポリシーの設定の影響を受けて意図したように <code>Authorization</code> ヘッダーの転送はできなかった。</p>
<ul>
<li>cache policy: Managed-CachingDisabled</li>
<li>origin request policy: Managed-AllViewer</li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0413/>cdk の cloudfront の distribution 設定の移行</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-13
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/cdk/>cdk</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時過ぎに起きた。</p>
<h2 id=フロントエンドのインフラ作業の続き>フロントエンドのインフラ作業の続き</h2>
<p>昨日、cloudfront の distribution 設定のビヘイビアのキャッシュ設定が誤っていることに気付いたので cdk のコードを修正していく。<a href=https://aws.amazon.com/jp/blogs/news/amazon-cloudfront-announces-cache-and-origin-request-policies/>Amazon CloudFront キャッシュポリシーとオリジンリクエストポリシーを発表</a> によると、2020年ぐらいに distribution ごとに個別設定していたのをマネージドポリシーというリソースを参照することで一元管理できるようになったらしい。cdk のコードで言えば、次の issue で対応されているが、これらの機能は <a href=https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_cloudfront.Distribution.html>aws_cloudfront.Distribution</a> のみに追加されている。従来の CloudFrontWebDistribution では使えないので distribution 設定そのものを新しいやり方に移行する必要がある。</p>
<ul>
<li><a href=https://github.com/aws/aws-cdk/issues/9644>https://github.com/aws/aws-cdk/issues/9644</a></li>
<li><a href=https://github.com/aws/aws-cdk/issues/9647>https://github.com/aws/aws-cdk/issues/9647</a></li>
</ul>
<p>基本的には同じ設定を行うので新しいクラスのメンバーや構造にあわせて移行するだけなので難しくはないけれど、1つずつ設定内容の移行方法を確認していかないといけないから手間暇はかかる。cdk のドキュメントをみると、型に対してどういった設定をすればよいかが書いてあって、あとはメソッドの定義などもみながら自分たちの設定に近いものを選択していくといった作業になる。難しくはないけど時間はかかる。半日ほどやって移行のための pr を作成した。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0412/>cloudfront のキャッシュ設定</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-12
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て5時に起きた。</p>
<h2 id=フロントエンドのインフラ作業>フロントエンドのインフラ作業</h2>
<p>これまでバックエンドのインフラ作業をしてきたが、そちらの移行作業は完了した。フロントエンドのインフラも積み残しが多々あるのでこの機にリファクタリングする。差分が出ないことを確認して cf のテンプレートのドリフト結果を解消したものをデプロイしたらフロントエンドが壊れた。具体的には xhr の web api 呼び出しに対して認可エラーが返るようになった。数時間ほどの調査の結果、cloudfront の distribution 設定のビヘイビアのキャッシュ設定で web api 呼び出しのときに authorization ヘッダーを転送するための設定が漏れていることがわかった。cdk のコードにはそんな設定がどこにもなく差分も表示されないことから、フロントエンドの cdk コードも全く保守されていないことがわかった。デプロイするときに前回のデプロイが半年前だったのでなんか悪い予感はしたんよね。インフラ担当者の怠慢が度を越し過ぎてもう何が起きても私は驚かないけど。設定に漏れがある前提でフロントエンドのインフラをリファクタリングしていかないといけない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0411/>cdk/cf の Stack とライフサイクル</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-11
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/cdk/>cdk</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時に起きた。</p>
<h2 id=インフラ変更の本番作業>インフラ変更の本番作業</h2>
<p>先週やっていた様々なインフラ構築の改善を本番環境に適用する。cf の changeset は23とかになっていた気がする。大きな括りで次の3つの移行作業をした。</p>
<ul>
<li>rds をスタックから切り離す</li>
<li>cdk の v1 から v2 へのアップグレード</li>
<li>ポリシーとセキュリティグループのドリフト解消</li>
</ul>
<p>私は本番環境へのアクセス権限をもっていないので社員さんの作業内容を伝えてやってもらう。cf のテンプレートの更新やドリフトの解消など、テスト環境で10時間以上は費やした検証結果が功を奏して、本番作業は想定外の事象も発生せず1.5時間で完了した。cdk のコードも意図した設定になるように修正済みだし、なにも問題は発生しない。cdk のコードを書くときは cf のイベントログやドリフト結果と実際のインフラの振る舞いを確認するといった検証には時間がかかるが、それができてしまえば本番環境の構築はうまくできる。それがわかっているインフラ担当者がいなくなると、また1から担当者が検証する必要があって保守は大変かもしれないけど。</p>
<p>同じ Stack でどういったリソースを管理するかというライフサイクルは難しい問題かもしれない。今回 rds を削除したのは、なんらかの理由で手動運用で rds を変更することがあって、アプリケーション Stack から外してしまった方が保守しやすいのではないかという意見が出たため。それが正しいかどうかはわからないが、一度作ったリソースを削除しないもの (vpc や s3 bucket など) をアプリケーション Stack で管理すると、再作成できなくて面倒くさいことがある。というのは、再作成は新規に作成 → 古いリソースを削除の順番で処理されるため、一意な名前をもつリソースは基本的に再作成できない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0410/>お花見リハーサル</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-10
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。たぶん休暇をとったのはお正月以来かな。今日はオフィス行かなかった。</p>
<h2 id=お花見-at-生田川公園>お花見 at 生田川公園</h2>
<p>三ノ宮.devとbizpyの合同イベントとしてお花見を開催した。とはいっても、イベントページも作らず内輪で募集したので参加者は4人と小さく開いた。私もお花見やってもいいかと思いつつ、<a href=/diary/posts/2022/0401/#生田川公園の桜>準備に着手するのが遅れた</a> ので今回はリハーサルと称して来年の本番のための布石と位置付けた。たぶんもう1-2週間早く準備に着手していればもっとできたこともあったとは思うけど、まぁ最初はこんなもんか。</p>
<p><figure><img src=/diary/img/2022/0410_hanami1.jpg>
</figure>
<figure><img src=/diary/img/2022/0410_hanami2.jpg>
</figure>
</p>
<h4 id=準備したこと>準備したこと</h4>
<p>私が事前に準備したのはこのぐらい。労力にして数時間といったところか。</p>
<ul>
<li>事前に桜の開花状況を確認して日程調整</li>
<li>ほとんどの必需品はダイソーで購入</li>
<li>参加者と連絡をとるためのプライベートチャンネル開設</li>
</ul>
<h4 id=実際にやってみてわかったこと>実際にやってみてわかったこと</h4>
<p>ダイソーで売っているこのサイズのレジャーシートが食べものを並べて4人で囲むのにちょうどよいサイズだった。</p>
<blockquote>
<p>レジャーシート約4.5畳サイズ （ブルー、約270×270cm）：300円</p>
<p><a href=https://www.daiso-sangyo.co.jp/item/12550>https://www.daiso-sangyo.co.jp/item/12550</a></p>
</blockquote>
<p>各自一品は食べものか飲みものを持ち込みと呼びかけていたら次のものが集まった。事前に何をもってくるか示し合わせたわけでもないのに、みんなバラバラになってちょうどよかった。次回は示し合わせをしようとは思うが、意外とかぶらないものだなと感心した。</p>
<ul>
<li>手羽元</li>
<li>唐揚げ</li>
<li>カルボナーラ</li>
<li>ピザ</li>
<li>551のシュウマイ</li>
<li>ミートボール</li>
<li>いなり寿司</li>
<li>ビール</li>
<li>日本酒</li>
<li>ワイン</li>
</ul>
<p>天気もよくて11-16時という昼間の開催で直射日光を浴び過ぎたせいか、帰ってから熱気があってバテてた。4月になって日差しも強くなっているので直射日光を遮るなにかを用意してもよかった。大きな桜の木があればそれでもよかったんだけど、そうでもなく、地球が自転するので最初は陰になっていた場所も移動してしまった。わりと4人でわいわい話せたので小さい勉強会やイベントの方が距離感の近いイベントになってよかったりもする。たぶん10人とかいたらまた違う距離感のイベントになっていたんじゃないかと推測する。</p>
<h4 id=ふりかえり>ふりかえり</h4>
<p><a href=https://www.kobe-park.or.jp/kouen_keikaku/2018/11/05/%E7%94%9F%E7%94%B0%E5%B7%9D%E5%85%AC%E5%9C%92/>生田川公園</a> は住んでいるところから15分ぐらい歩けば行ける場所で花見イベントができることがわかって収穫だった。桜の木がたくさんあるというわけでもないので近所の人が集まるぐらいで、わざわざ外部の地域からくるほどのスポットではない。そのため、混雑していないというのが大きな訴求点と言える。バーベキューは禁止と書いてあったけど、他にも野外イベントに使えるかもしれない。河川沿いにある公園だし、夏に花火大会とか、秋にお月見とかやれそうな気はした。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0409/>開発が遅れる空気</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-09
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/information-exchange/>information exchange</a>&nbsp;
</span>
<div class=post-content>
<p>昨日は0時過ぎまでオンライン飲み会で雑談していて、それから1時に寝て6時過ぎに起きた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今日の開脚幅は開始前161cmで、ストレッチ後162cmだった。今週はインフラエンジニアを始め、深夜と早朝に作業するため、生活が不規則になってしまった。そのせいか、腰と右股関節の張りが強いように感じた。1日は散歩に行ったり、深夜に一駅離れたスーパーに買いものに行ったり、すこし運動っぽいことも生活に取り入れるようにはしている。今週疲弊した身体をストレッチでほぐせたのでまた一週間がんばろうという気持ちになった。</p>
<h2 id=インフラ作業>インフラ作業</h2>
<p>昨日からの仕掛り中の作業をテスト環境に反映させた。昼間は環境を壊してしまうとテストや検証作業を止めてしまうリスクがあるため、開発者や業務の人たちが使っていない時間を見計らって環境変更の反映や cdk の検証などをやりたい。必然的に土日も都合がよくて気付いたら2時間半ほど作業してた。</p>
<h2 id=開発が遅れる空気>開発が遅れる空気</h2>
<p>私は勘と経験で納期の1-2ヶ月前に開発が完了しないとわかるときがある。これまでなぜわかるのか自分でもよくわかっていなかった。便宜上「遅れる空気を読む」とでも言おう。私だけわかっても他者に伝えられない、もしくは伝えても無視されることが多かったので必要以上に指摘しないようにはしている。伝えて意図がわからない人たちにそれ以上言っても無駄だから。なにかしら条件があるのではないかと思い当たるところを書き出してみる。</p>
<ul>
<li>チームメンバー (開発者) にタスクが遅れているという認識がない
<ul>
<li>経験が浅いと見積もりの精度が低いため、全体像に対する進捗を正確に把握できない</li>
<li>シニア開発者がアドバイスしてもその内容を理解できなくて役に立たないこともある</li>
</ul>
</li>
<li>遅れている開発者が遅れを取り戻すための施策 (たとえば残業) をしない
<ul>
<li>認識していないなら残業しないから当然に遅れる</li>
<li>認識していても残業を嫌う開発者は一切残業しない</li>
</ul>
</li>
<li>未知の問題や状況に対して「わからない」「困っている」といった報告があがらない
<ul>
<li>心理的安全性が低いと、無能だと思われたくなくて開発者が助けを求められない</li>
</ul>
</li>
<li>マネージャーやリーダーといったスケジュール管理に影響力のある担当者が上位の意思決定者に事実ではなく自身の解釈を述べる
<ul>
<li>例「このタスクは8割程度完了していて、あともう少しで終わりそうです」
<ul>
<li>遅れているタスクはこういう報告が何度もあがる</li>
<li>「いつ完了しますか？」と尋ねると予定日時を回答できない</li>
</ul>
</li>
</ul>
</li>
<li>マネージャーやリーダーが技術に疎く、実務担当者の言うことをそのまま受け入れる
<ul>
<li>経験が浅い開発者の見積もり精度は低いため、大きく計画が狂うことがある</li>
</ul>
</li>
<li>上位の意思決定者と現場のリーダーとの人間関係が希薄だと建前の報告になる
<ul>
<li>心理的安全性が低いと、現場の機微やもやっとしたことが共有されない</li>
</ul>
</li>
</ul>
<p>こういう空気を私は読んでいて、あるとき「この開発はもう間に合わないですね。」といきなり上長に言い始める。周りはまだ日程に余裕があるのになぜ？とびっくりする。開発って日々の積み重ねなので、日々の活動が正しい努力になっていないと1-2ヶ月後に成果が出ないというのは私からみたら自明だという話し。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0408/>壊れた cf スタックのリストアと cdk の再同期</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-08
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/cdk/>cdk</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
</span>
<div class=post-content>
<p>2時に寝て6時半に起きた。インフラエンジニアになったのでみんなが作業していない時間にインフラの保守作業をするようにしている。昼はアプリケーションエンジニア、夜はインフラエンジニアみたいな生活になっていてしんどい。</p>
<h2 id=壊れた-cf-スタックの更新>壊れた cf スタックの更新</h2>
<p>テスト環境の cf スタックを手動で更新して壊れているのを cdk で管理できるように直した。壊れていたのは次の3つ。</p>
<ul>
<li>rds をスナップショットからリストアしたので cf が管理している rds リソースが存在しない</li>
<li>iam の acl 設定が異なる</li>
<li>セキュリティグループのインバウンドルールが異なる</li>
</ul>
<p>aws 的にもそういった状況は認識していて cdk で同期できなくなった cf スタックを更新する手順を提供している。</p>
<ul>
<li><a href=https://aws.amazon.com/jp/premiumsupport/knowledge-center/delete-cf-stack-retain-resources/>AWS CloudFormation スタックを削除したときにリソースの一部を保持する方法を教えてください。</a></li>
</ul>
<p>ざっくり手順をまとめると次になる。</p>
<ol>
<li>対象のリソースに DeletetionPolicy=Retain にセットする</li>
<li>テンプレートからリソースを削除して、スタックの更新を実行する</li>
<li>テンプレート内のリソースの実際の状態を describe して、スタック内に既存のリソースをインポートする</li>
</ol>
<p>リソースの設定ぐらいなら既存のリソースからインポートしなくても cf のテンプレートを直接書き換えたものをアップロードしてスタックを更新するのでも大丈夫だったりする。しかし、cdk もそのテンプレートにあうように修正しないといけないため、cdk のコードとテンプレートのコードの両方をチェックしながら検証する必要がある。cdk でリソース管理ができるようになったからといって、それが変更前の既存のリソースの設定と同じかどうかは人間が目でみて検証しないといけない。これがあちこちで参照されているリソースだと追跡するのが面倒くさいといった手間暇がかかる。</p>
<p>cdk がよいものかどうか、私はまだ判断がつかないけど、cf を抽象化して便利になっているところは認めるものの、cf のスタックが壊れたときのトラブルシューティングが必要以上に複雑で厄介というのも事実ではある。一方で壊れた cf スタックを5時間ぐらいかけて直したのではまりポイントはいくつかも学ぶことができた。しんどかったけど。例えば、あるセキュリティグループのインバウンドルールに別のセキュリティグループを関連付けるとき、1つの設定ではうまくいかなくて次の2つの設定を追加した。これが適切かどうかわからないが、この設定で cdk でデプロイしたスタックの環境と既存リソースとの環境が整合した状態 (ドリフトが解消される) になった。こういうのが cdk の抽象化による訳のわからないところの1つ。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#a6e22e>otherSecurityGroup</span>.<span style=color:#a6e22e>addIngressRule</span>(
  <span style=color:#a6e22e>ec2</span>.<span style=color:#a6e22e>SecurityGroup</span>.<span style=color:#a6e22e>fromSecurityGroupId</span>(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#39;my security group&#39;</span>, <span style=color:#a6e22e>mySgId</span>),
  <span style=color:#a6e22e>ec2</span>.<span style=color:#a6e22e>Port</span>.<span style=color:#a6e22e>tcp</span>(<span style=color:#ae81ff>80</span>),
  <span style=color:#e6db74>&#34;my inboud rule&#34;</span>,
)
<span style=color:#a6e22e>otherSecurityGroup</span>.<span style=color:#a6e22e>addIngressRule</span>(
  <span style=color:#a6e22e>ec2</span>.<span style=color:#a6e22e>Peer</span>.<span style=color:#a6e22e>securityGroupId</span>(<span style=color:#a6e22e>mySgId</span>),
  <span style=color:#a6e22e>ec2</span>.<span style=color:#a6e22e>Port</span>.<span style=color:#a6e22e>tcp</span>(<span style=color:#ae81ff>80</span>),
  <span style=color:#e6db74>&#34;my inboud rule&#34;</span>,
)
</code></pre></div>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0407/>cdk のメジャーバージョンのマイグレーション</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-07
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/cdk/>cdk</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時に起きた。開発者にインフラ変更の影響を出さないように6時半からインフラのお仕事してた。</p>
<h2 id=cdk-v1-と-v2-の違い>cdk v1 と v2 の違い</h2>
<p><a href=https://docs.aws.amazon.com/cdk/api/versions.html>AWS CDK Versions</a> には v1 と v2 の2つがある。新規で作るものは v2 を選択すればよいけど、既存のスタックが v1 だとマイグレーションが必要になる。cdk は bootstrap したときに CDKToolkit というスタックを生成する。cdk をアップグレードするというのはこのスタックの設定も更新する必要がある。デフォルト設定をそのまま使っていればマイグレーションはそんなに難しくはないはずだけど、設定をカスタマイズしていたりするといくつかパラメーターを調整したりしなかったりしてややこしいかもしれない。</p>
<ul>
<li><a href=https://docs.aws.amazon.com/cdk/v2/guide/migrating-v2.html>Migrating to AWS CDK v2</a></li>
<li><a href=https://docs.aws.amazon.com/cdk/v2/guide/bootstrapping.html>Bootstrapping</a></li>
</ul>
<p>また v2 は v1 の experimental な機能は移行されていないため、v1 のライブラリを直接使うか、自前でその機能を実装するといったことも必要になる可能性がある。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>cdk v2 を使っていて v1 にある機能が v2 になくてあれー？って感じで調べてたら experimental な機能はまだ移行されてないらしい。<a href=https://t.co/SbRZ5ddrTj>https://t.co/SbRZ5ddrTj</a></p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1511924087450640386?ref_src=twsrc%5Etfw">April 7, 2022</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<p>例えば、v1 の apigwv2.VpcLink というメソッドは experimental で v2 に移行されていないため、v2 に移行されている stable な CfnVpcLink という機能を使って次のように実装した。これは v1 の cdk の実装をみて同じように実装しただけ。</p>
<ul>
<li><a href=https://github.com/aws/aws-cdk/pull/10531/files#diff-1cf3aaf7b2b6b2e72123b93cb3108eb9e9a3291e588d62eb2cd34dd0509d3045>https://github.com/aws/aws-cdk/pull/10531/files#diff-1cf3aaf7b2b6b2e72123b93cb3108eb9e9a3291e588d62eb2cd34dd0509d3045</a></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=color:#f92672>-    const apiGwVpcLink = new apigwv2.VpcLink(this, &#39;ApiGwVpcLink&#39;, {
</span><span style=color:#f92672>-      vpc: vpc,
</span><span style=color:#f92672>-      vpcLinkName: &#39;my-vpc-link&#39;,
</span><span style=color:#f92672>-      securityGroups: [mySecurityGroup]
</span><span style=color:#f92672></span><span style=color:#a6e22e>+    const apiGwVpcLink = new  apigwv2.CfnVpcLink(this, &#39;ApiGwVpcLink&#39;, {
</span><span style=color:#a6e22e>+     name: &#39;my-vpc-link&#39;,
</span><span style=color:#a6e22e>+     subnetIds: vpc.privateSubnets.map(sb =&gt; sb.subnetId),
</span><span style=color:#a6e22e>+     securityGroupIds: [mySecurityGroup.securityGroupId]
</span></code></pre></div>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0406/>ecs の draining とタスクの停止時間</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-06
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て4時に起きた。なんか起きてから sns のタイムラインを眺めてた。6時半にはオフィスについて cdk のコードを読み始めた。</p>
<h2 id=ecs-の-draining-に時間がかかる>ecs の draining に時間がかかる？</h2>
<p>cdk でインフラのデプロイをしていて、ecs のタスクの置き換えにやたら時間がかかっているのに気付いた。調べてみると、aws のドキュメントがすぐにヒットした。デフォルトでは停止するまでに5分ぐらいかかってしまうようだけど、それを調整したかったらいくつかパラメーターがある。</p>
<ul>
<li><a href=https://aws.amazon.com/jp/premiumsupport/knowledge-center/ecs-tasks-stop-delayed-draining/>コンテナインスタンスが DRAINING に設定されているときに、Amazon ECS タスクが停止するのに時間がかかるトラブルシューティング方法を教えてください。</a></li>
</ul>
<h4 id=ecs-サービスの-deployment-configuration>ecs サービスの deployment configuration</h4>
<ul>
<li>minimumHealthyPercent: 同時に停止できるタスクの割合設定</li>
<li>maximumPercent: draining されるタスクが停止するまで置き換えるタスクを開始するかどうかの設定？</li>
</ul>
<h4 id=ロードバランサーの-deregistration-delay>ロードバランサーの deregistration delay</h4>
<ul>
<li>deregistrationDelay: elb(nlb) が登録解除処理が完了するまでに待つ時間。タスクが draining の状態になってこの時間が過ぎた後に登録解除して target が未使用になる</li>
</ul>
<h4 id=ecs-タスク定義の-stop-timeout>ecs タスク定義の stop timeout</h4>
<ul>
<li>stopTimeout: コンテナーが正常終了しないときに ecs が強制的にプロセスを kill するまでの待ち時間</li>
</ul>
<p>それぞれのインフラの状況にあわせて適切なパラメーターを変更すればよい。私が管理しているのは次の2つを変更した。</p>
<ul>
<li>maximumPercent: 100 -> 200 (%)</li>
<li>deregistrationDelay: 300 -> 30 (秒)</li>
</ul>
<p>これで18分ほどかかっていたデプロイ時間を8分ぐらいまで短縮できた。テスト環境の設定なので多少のエラーが発生したとしても速い方がよい。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0405/>再びのインフラエンジニア</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-05
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て7時に起きた。</p>
<h2 id=インフラタスクに専念>インフラタスクに専念</h2>
<p>本当はインフラ担当者が別途いるのだけど、多忙過ぎて、インフラタスクが1ヶ月近く遅延していて、プロジェクト内で合意を得て私がすべて巻き取ることにした。内容の如何に依らず、その一切合切をすべて巻き取ると宣言した。過去に働いた会社でも他の担当者ができなかった業務を後からリカバリするのはよくやってたのでそれ自体は構わない。ただ他人のタスクを肩代わりしても評価されないことも多くて、もともと私のタスクではないから誰がやったかなんか忘れてしまうんよね。私もとくにアピールしないからそう認識されても構わないのだけど、そういう業務が増えてくるとその職場を辞めるきっかけにもなってた。</p>
<p>インフラ担当者や他の社員さんにヒアリングしながら現時点でも十数個のタスクがある。過去のインフラの負債も含めて2-3週間ぐらい、私が集中的にやればすべて片がつくのではないかと考えている。今日たまたまスクラムのリファインメントやってて、業務の人から他の機能開発が遅れているのに2-3週間もインフラ作業に専念するってどういうこと？インフラタスクってインフラ担当者にやってもらえないんですか？と質問を受けて、できるんならその方が望ましいけど、過去の実績からまったく進捗しないのでこちらでやるざるを得ない状況というのを説明した。業務の人からみたらインフラなんか何をやっているかわからないからそんなもんよね。これから2-3週間経って蓄積したインフラタスクをすべて解決した後で少し時間が経つとインフラ担当者が全部やったように外部からはみえてしまうというのを、過去に何度も経験した。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0404/>契約更新の打ち合わせ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-04
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/subcontract/>subcontract</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時過ぎに起きて7時半に起きた。</p>
<h2 id=契約更新>契約更新</h2>
<p>4月末が3ヶ月契約の区切りなので契約更新の打ち合わせをした。更新はするのだけど、契約条件が現状の働き方とあわなくなってきたのでその調整のための打ち合わせ。いくつか私の懸念やプロジェクト管理について話していて認知の歪みが起きている箇所を特定できた。いま開発の計画がストーリーポイントから見積もったスケジュールになっていて、これが私からみてデタラメな計画になっている。チームが習熟すれば精度が上がっていくというスクラムマスターの説だが、現時点ではデタラメな計画だから想定外のタスクや進捗遅れが起きてもそれが直接的に反映されない。タスクは増えるが、計画は何も変わらないということがすでにいくつも発生していて、それをおかしいと言っているのがメンバーの中で私だけという状況になっている。前に勤めていた会社でも全く同じことがあった。私だけが開発スケジュールの遅延を2ヶ月前に察していて、他のメンバーは締め切りの2週間前になって気付くということが過去にもあった。</p>
<p>いまのプロジェクトが納期に対して実際に遅れるかどうかは納期が来ないとわからないが、少なくともタスクが増えて納期が固定なら残業して終わらせるしかないと私は考えていた。しかし、開発のトップは計画を延期すべきだと考えていることがわかった。延期してよいのだ。プランニングをしていてどんなに遅延があっても計画を絶対に変えようとしないので期限が必達なのだと私が勘違いしていた。おそらく単純にストーリーポイントから見積もっているスケジュールだから、個々のタスクが増えたり遅れたりしても、それらを全体の計画にどう調整していいのかが誰もわからないのだと推測する。これもストーリーポイントの弊害の1つではあるが。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0403/>カスタムドメインの設定</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-03
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/economy/>economy</a>&nbsp;
#<a href=/diary/tags/blog/>blog</a>&nbsp;
#<a href=/diary/tags/dns/>dns</a>&nbsp;
#<a href=/diary/tags/github/>github</a>&nbsp;
</span>
<div class=post-content>
<p>3時に寝て7時半に起きた。前日の深夜にオフィスの掃除をしてた。シェアオフィスなので掃除機をかけると音がうるさくて周りに迷惑なので誰もいない時間帯を見計らって行う必要がある。</p>
<h2 id=逆イールド>逆イールド</h2>
<p>会社を経営する上で経済の状況は大きな影響を受けるので機をみて経済の勉強もしている。直近40年近くの統計では、米国債金利において、2年債の金利が10年債の金利を追い越してしまう現象が発生した場合、その1年後ぐらいに景気後退期がやってくる。この現象を <strong>逆イールド</strong> と呼ぶ。</p>
<p>なぜ逆イールドが発生すると景気後退となるのか。国債とは政府の借金。金融機関、年金、個人、海外などが貸している。金利は複雑で様々な要因で決まるので一概に言えないが、大雑把にまとめると経済の力や金融政策、世のおカネの量で決まる。政策金利によって3ヶ月債や2年債は大きく影響を受ける。利上げを急ぎでやろうとしている理由は高いインフレがある。米国は約40年ぶりの高インフレとなっている。FRB は約2%のインフレを目標としているが、現状は遥かに高い水準になるので金利を上げてインフレを抑制しようとしている。FRB は次の2つの使命を負っている。</p>
<ul>
<li>物価の安定</li>
<li>雇用の最大化</li>
</ul>
<p>いま物価が急上昇しているため、このまま金融緩和を続けるとさらに物価が上昇して悪い影響を及ぼしてしまう。いまは金融緩和を縮小して利上げをしていく必要がある。しかし、利上げは景気に対して悪影響となる可能性がある。どのぐらい利上げすればよいのかは実際には誰もわからない。最悪の状況として次がある。</p>
<ul>
<li><strong>スタグフレーション</strong>: 高インフレのまま景気が減速する現象</li>
</ul>
<p>スタグフレーションが発生すると経済対策や金融政策で対応しづらい非常にまずい状況となる。経済学者によっても意見が分かれるので、まだスタグフレーションが起こるとは限らない。しかし、起こる可能性があるという見方も出てきているらしい。</p>
<div class=video-container>
<iframe src=https://www.youtube.com/embed/apeDeUAXMdk allowfullscreen title=よくわかる「逆イールド」　景気後退のシグナル（後藤達也）></iframe>
</div>
<h2 id=英語のテックブログ開設>英語のテックブログ開設</h2>
<p>先日作った <a href=/diary/posts/2022/0327/#backlog-と-github-のインテグレーション-action>backlog-github-integration-action</a> の記事を書くことにした。会社のプロダクトとして作ったツールで汎用的なものや業務として保守していくものは積極的にアピールしていきたい。基本的に私は日本市場をあてにしていないのと、せっかく会社を作ったのだし、海外の会社と取り引きできるようになりたいという野望もある。プロダクトの情報発信は英語が基本で、余裕があったら日本語も書くといった優先度でやっていく。</p>
<p>少し前にたまたま <a href=https://hashnode.com/>hashnode</a> がイケてるというのをタイムラインでみかけたのを思い出した。せっかくなので調べてみたら、どうも <a href=https://support.hashnode.com/docs/mapping-domain>Custom Domain</a> を無償、且つお手軽に設定できるのが訴求点になっているらしい。カスタムドメインを使うと、url に統合性があってカッコいいという以外にも信頼できるドメインに対して SEO が行われるため、優良な記事を書いていると自社ドメインの信頼があがっていくといったメリットがある。コストがかからないならカスタムドメインを使わない理由は何もない。そして設定したものが次になる。</p>
<ul>
<li><a href=https://blog.kazamori.jp/>https://blog.kazamori.jp/</a></li>
</ul>
<p>ネームサーバーにカスタムドメインの設定をしていて間違って少しはまった。</p>
<p>間違った設定</p>
<pre tabindex=0><code>cname blog hashnode.network
</code></pre><p>正しい設定</p>
<pre tabindex=0><code>cname blog hashnode.network.
</code></pre><p>最後にドット <code>.</code> が必要になる。これで blog.kazamori.jp の名前解決が hashnode.network として解決される。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ dig blog.kazamori.jp
...
;; ANSWER SECTION:
blog.kazamori.jp.	198	IN	CNAME	hashnode.network.
hashnode.network.	46	IN	A	76.76.21.21
</code></pre></div><p>CNAME レコードを滅多に設定しないのでドットで終わらないといけない規則を忘れてた。設定後、dns の propagation に最大24時間ほどかかる。世界のどこからでもアクセスできるようになるには24時間ぐらいかかるかもしれないけど、ローカルで動作検証するなら数分で反映されてた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0402/>jjug の cfp に応募した</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-02
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時に起きた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今日の開脚幅は開始前161cmで、ストレッチ後164cmだった。先週とあまり変わらずといったところ。今日は腰の張りが強かった。トレーナーさんは左の張りが強いと言ってたんだけど、私は右の方が体感的に張りが強いように感じた。もう1年以上担当してくれたトレーナーさんが4月いっぱいで転勤になるらしい。社内制度で広島に最低でも半年間は転勤になるという。広島が終わっても神戸に戻ってくるとは限らず、また別の地域へ転勤になる可能性もあるという。きっと優秀な社員だから転勤するんだろうなと思えた。20代後半ぐらいの若もので個人でも筋トレが好きでボディービルダーの大会などにも参加していると聞いた。趣味と業務が近いのでトレーナーとしてのパフォーマンスも高いのだろうと推測する。若い人はなんでも挑戦して経験した方がよいと私も応援した。5月から後任で別のトレーナーに変わる。新しいトレーナーさんに変わることで前のトレーナーさんとの相対評価もできる。これはこれで楽しみでもある。</p>
<h2 id=jjug-ccc-2022-spring-の-cfp-応募>JJUG CCC 2022 Spring の cfp 応募</h2>
<p>本当は締め切りが先週末だったんだけど、募集期間が1週間伸びたのでちょうど作ったばかりのツールで応募してみた。今回はオンラインイベントなので事前にビデオを撮って送るらしい。当日は質疑応答の時間 (10分間) だけオンラインで参加すればよいという感じ。地方在住で物理的に東京に行けないという開発者にも発表しやすいと言えるかもしれない。内容的には初心者向けなので GitHub Actions というネタがいまどきどのぐらい参加者の関心を集めるか、他のプロポーザルとの競争がどのぐらいか次第かな。</p>
<ul>
<li><a href=https://fortee.jp/jjug-ccc-2022-spring/proposal/0c85f6b2-d44d-40c2-8e6d-ddc1fe821273>Java で作るカスタム GitHub Actions</a></li>
</ul>
<h2 id=生田川公園のお花見予定>生田川公園のお花見予定</h2>
<p>cfp を投稿して14時頃に気分転換がてら生田川公園に再訪した。今日は絶好のお花見日和なのでどのぐらい人がいるかを調べるために行ってきた。昨日の夜よりはたくさん人がいて、そこそこ賑わっていた。だいたいの桜の木の下は集団にスペースをとられていた。とはいえ、お花見をするためのスペースが全くないというわけでもないのでよい場所を気にしないなら普通に10人ぐらいの集団でお花見はできそう。個人的には川に入って川遊びしているのが楽しそうにみえた。公園管理者に怒られないならちょっとやってみたい。</p>
<figure><img src=/diary/img/2022/0402_park.jpg>
</figure>
<p>帰ってきてから <a href=https://sannomiya-dev.netlify.app/>三宮.dev</a> のすみよしさんと連絡をとって4月10日(日) 11:00 - 16:00 で開催することに決めた。来週中には大半が散ってしまうかも？だけど、実際にやってみてイベント開催の経験値を積むリハーサルの意図もある。bizpy はもはや全く神戸のコミュニティではなくなってしまったけれど、またいつか盛り返す可能性もあるかもしれない。その日のために素振りはしておきたい。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0401/>お花見の場所探し</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-04-01
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/spring-boot/>spring boot</a>&nbsp;
#<a href=/diary/tags/security/>security</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時過ぎに起きた。</p>
<h2 id=spring-framework-の脆弱性対応>spring framework の脆弱性対応</h2>
<p>起きてタイムライン眺めてたら spring framework の脆弱性の公式アナウンスが出ていたのですぐに準備してオフィス行って7時前から脆弱性対応の作業をしてた。</p>
<ul>
<li><a href=https://spring.io/blog/2022/03/31/spring-framework-rce-early-announcement>Spring Framework RCE, Early Announcement</a></li>
</ul>
<p>大学の研究室にいた頃、root staff と呼ばれるシステム管理者をやっていた。研究室のネットワークをすべて freebsd で自分たちで構築していたので os の脆弱性が公表されると研究室のすべての os のパッチ適用をやっていた。具体的にはパッチの当たった kernel をビルドして再起動するといった作業。</p>
<p>それを2年間やっていたせいか、脆弱性情報が公開されるとすぐに対応する癖みたいなものがついた。7時前から作業して検証して7時11分に PR を作成した。レビューアは誰も作業を始めてないけど。金曜日は非稼働日なので私が作業しなくてもよいのだけど、ここまでやったら安心して他の作業に移ることができた。</p>
<figure><img src=/diary/img/2022/0401_springframework.png>
</figure>
<h2 id=生田川公園の桜>生田川公園の桜</h2>
<p>地元のコミュニティでオミクロン株の感染が落ち着いてきたのでリアルお花見をしたいねという話題があがっている。私自身、お花見に毎年参加するような人間でもないけれど、たしかにコロナ禍になってからはお花見やってないだろうし、個人的にも数年はお花見やってないからやってもいいかなという気持ちにはなった。近場だと <a href=https://www.kobe-park.or.jp/kouen_keikaku/2018/11/05/%E7%94%9F%E7%94%B0%E5%B7%9D%E5%85%AC%E5%9C%92/>生田川公園</a> という場所があり、特筆するほど桜がとてもきれいという場所ではないが、一応は桜があって、お花見するスペースもあって、形としては成り立つようなところ。お仕事を終えてから自転車で開花状況を見に行った。19時頃に行って寒くても何組かはお花見している集団はいた。開花状況は7-8割といったところかな。今週末から来週にかけてぐらいが見頃だと思う。</p>
<p><figure><img src=/diary/img/2022/0401_park1.jpg>
</figure>
<figure><img src=/diary/img/2022/0401_park2.jpg>
</figure>
</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0331/>第3期の年度末</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-31
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/founding/>founding</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。昨日に引き続き、日中はフロントエンドのバグ修正をやって午後は本番リリースの守り神みたいなことをやって、夜は請求書を作ってた。</p>
<h2 id=年度末>年度末</h2>
<p>今年度最後の請求処理をして本当に四半期が終わるんだなぁとしみじみと感傷に浸ってた。財務の試算表と貸借対照表を軽く眺めてた。今期は赤字なので別によいところはないんだけど、また振り返りをやろうとは考えている。貸借対照表を「ちんしゃくたいしょうひょう」と読んでいて間違ってますよとツッコミもらった。なぜか素で間違えた。お仕事終えてから焼き鳥屋さんに寄ってマスターと2時間ほど雑談して帰ってきた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0330/>暇つぶしのフロントエンド開発</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-30
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/vue.js/>vue.js</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て4時に起きた。起きてから sns のタイムラインを眺めてぼーっとしてた。</p>
<h2 id=フロントエンド開発>フロントエンド開発</h2>
<p>先週からタスクがなくて (社員さんが多忙で今スプリントのタスク洗い出しができていない) だらだらしていて、来週から引き取ろうと思っている cdk 周りのインフラ構築の調査を事前に始めようかと考えていた。そういう話を社員さんにしたらフロントエンドの開発を手伝ってほしいと言われた。</p>
<p>種々雑多なフロントエンドの ui に関する改善要望が十数個あがっていて対応できないのでちょっとでもやってほしいという依頼。少し前に <a href=/diary/posts/2022/0315/##フロントエンド開発>初めてフロントエンド開発</a> に着手して、4つほど PR を送ってマージされた。にも関わらず、社員さんに「開発環境の作り方わかりますか？」と質問を受けた。ちょっときょとんとして「前に PR をいくつか送りましたが、なにか他にやらないといけないことがありますか？」と質問に質問で返した。社員さんもテンパっているのか、過去に私がフロントエンドの PR を出していたことを認識してなかったみたい。vue.js も nuxt も全くわからないので開発スタイルも以前のまま。</p>
<blockquote>
<p>全然わからない。俺たちは雰囲気で開発している。</p>
</blockquote>
<p>5つほど ui 改善のチケットを fix した。難しいことはわからないので私でもできそうな簡単なものから選択して直していった。そしたら、翌日のデイリースクラムで業務の人たちからすごい勢いで直してくれてるみたいにめっちゃ感謝された。もともと社員さんが他のタスクに忙しくていまできないって業務の人たちに前日断っていたタスク群を、いま手持ちのタスクが何もないので暇を持て余してますという私が fix しているんだから、世の中、訳がわからない。私は普段バックエンド開発している人間だから業務の人たちに感謝されることはおろか、やっていることさえ理解されない方なんだけど、たまに ui とか改善すると感謝されて嬉しいという気持ちは他の開発者よりも強いかもしれない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0329/>backlog の認可の仕組み</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-29
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/auth/>auth</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。</p>
<h2 id=backlog-の-oauth-20-の仕組み>backlog の oauth 2.0 の仕組み</h2>
<p>ユーザー単位の API キーの他、oauth 2.0 の認可の仕組みもある。<a href=https://oauth.net/2/grant-types/>OAuth Grant Types</a> は Authorization Code と Refresh Token の2つをサポートしている。</p>
<ul>
<li><a href=https://developer.nulab.com/ja/docs/backlog/auth/>https://developer.nulab.com/ja/docs/backlog/auth/</a></li>
<li><a href=https://backlog.com/developer/applications/>https://backlog.com/developer/applications/</a></li>
</ul>
<p>手順はざっくりこんな感じ。</p>
<p>開発者向けのサイトからアプリケーションを作成して認可コードのリクエストを送る。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>https://YOUR-SPACE.backlog.com/OAuth2AccessRequest.action?response_type<span style=color:#f92672>=</span>code&amp;client_id<span style=color:#f92672>=</span>xxx&amp;redirect_uri<span style=color:#f92672>=</span>http://localhost:18080/callback
</code></pre></div><p>リダイレクト先に <code>query='code=zzz'</code> な認可コードが届く。それを使ってアクセストークンを取得する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{<span style=color:#960050;background-color:#1e0010>&#39;access_token&#39;:</span> <span style=color:#960050;background-color:#1e0010>&#39;xxx&#39;,</span>
 <span style=color:#960050;background-color:#1e0010>&#39;expires_in&#39;:</span> <span style=color:#960050;background-color:#1e0010>3599,</span>
 <span style=color:#960050;background-color:#1e0010>&#39;refresh_token&#39;:</span> <span style=color:#960050;background-color:#1e0010>&#39;xxx&#39;,</span>
 <span style=color:#960050;background-color:#1e0010>&#39;token_type&#39;:</span> <span style=color:#960050;background-color:#1e0010>&#39;Bearer&#39;</span>}
</code></pre></div><p>有効期限が1時間のアクセストークンを取得できる。次のようにして認証をパスできる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl -s -H <span style=color:#e6db74>&#34;Authorization: Bearer xxx&#34;</span> <span style=color:#e6db74>&#39;https://YOUR-SPACE.backlog.com/api/v2/space&#39;</span> 
</code></pre></div><p>基本的にはユーザー単位の認証しかなくてアプリケーションアカウントの運用はできないみたい。backlog の課金プランをみると、基本的にはユーザー無制限っぽいのでアプリケーションアカウントを一般ユーザーで作成すれば、運用上問題にならないからアプリケーションアカウントを設けていないのではないかと思う。お手伝い先の管理者にインテグレーション向けの専用ユーザーを作成して API キーを github の secrets に登録してほしいという依頼を出した。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0328/>backlog-github-integration-action を運用し始めた</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-28
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
</span>
<div class=post-content>
<p>2時に寝て6時半に起きた。</p>
<h2 id=backlog-と-github-のインテグレーション-action-の試験運用>backlog と github のインテグレーション action の試験運用</h2>
<p>昨日作った backlog-github-integration-action を早速お手伝い先の github リポジトリと backlog に導入した。いま暇な時期というのもあって、誰からもクレームが出なかった。この閑散とした間隙を「乗るしかない、このビッグウェーブに」というノリで導入して運用して既成事実を作る。ses でお手伝いに行って課題管理のツールを作っているというのは頭おかしいと思うけど、周りからクレームが出る前に電光石火で運用にのせてしまう。実際に運用で使うといくつかバグがあって、いま latest の docker イメージを使ってカスタム action が動いている。バグがあったら修正して、<code>./gradlew jib</code> (docker push) で新しい docker イメージを gihtub packages に push して、不具合があった pr のジョブを再実行すれば再現環境でテストもできる。いくつかバグ修正をした。実際の運用のデータを使うとばらばらとバグがみつかる。運用で実際に使われていないツールはダメ、絶対。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0327/>backlog-github-integration-action を作った</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-27
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て7時に起きた。丸一日開発していた。構想1ヶ月、実装2日といったところか。</p>
<h2 id=backlog-と-github-のインテグレーション-action>backlog と github のインテグレーション action</h2>
<p>お手伝い先が <a href=https://backlog.com/ja/>backlog</a> を課題管理システムとして使っている。backlog は <a href=https://support-ja.backlog.com/hc/ja/sections/360005425774-Git>git 連携</a> の機能をもっているが、これは nulab 社のクラウド上に git リポジトリを構築したものと連携する機能であって、github と連携する機能ではない。そこで github と backlog と連携するためのカスタム github action を作った。</p>
<ul>
<li><a href=https://github.com/kazamori/backlog-github-integration-action>https://github.com/kazamori/backlog-github-integration-action</a></li>
</ul>
<p>カスタム github action を java で開発するのは普通にはやらないと思うが、いくつか理由があってお手伝い先が java しかできないというのと、nulab 社が提供している公式クライアント <a href=https://github.com/nulab/backlog4j>nulab/backlog4j</a> が java しかないから。最初は go で実装しようと思って go のクライアントを試したんだけど、サンプルコードをかいたら一部の処理でエラーになって、そのエラーがよくわからなくてやる気がなくなってしまった。最新の rest api の仕様にそってメンテナンスされていないのかな？と思って、やっぱり公式クライアントしかないなと。他にも次のライブラリを使っている。</p>
<ul>
<li>設定ファイル: <a href=https://github.com/lightbend/config>https://github.com/lightbend/config</a></li>
<li>コマンドライン解析: <a href=https://github.com/remkop/picocli>https://github.com/remkop/picocli</a></li>
<li>github クライアント: <a href=https://github.com/hub4j/github-api>https://github.com/hub4j/github-api</a></li>
</ul>
<p>これまでは commons-cli を使ってきたけど、サブコマンドの機能を提供していない。もうメンテされてないかも？サブコマンドの機能をもつ argument parser がほしくて picocli を選択した。初めて使っていて、実装してみたらわりと私の好みでよく出来ていると思う。今後は cli ライブラリとして picocli を使っていこうと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0326/>まん延防止等重点措置解除後の飲み会</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-26
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て2時に起きて5時に起きた。日中は昨日から着手したカスタム github action の開発をしていた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今日の開脚幅は開始前161cmで、ストレッチ後165cmだった。今日は右股関節の違和感と左の腰の張りが強かった。今週は少しだけストレッチをやった。お仕事が落ち着いてきて次の課題への谷間で気力が削がれていてメリハリがなくなっている。また生活を見直しつつ運動やストレッチに時間を割くようにしていきたい。</p>
<h2 id=会員制バーで雑談>会員制バーで雑談</h2>
<p><a href=/diary/posts/2022/0122/#会員制バーでふりかえり>1月に行って</a> からの再訪。前回はまん延防止等重点措置が実施される前だったのでお客さんはうちら2人だけだった。今回は解除された直後だったせいか、うちらの他に4人お客さんがいた。バーのマスターと友だちというわけではないけど、同じ経営者として経営がうまくいくといいなと思ってしまうのでお客さんが入っていると嬉しく思う。地域コミュニティを主催しているすみよしさんと一緒に行ってきた。今回はコースではなく、適当に料理も頼みながら普通に飲んでた。電話で予約をとったときに食べものについて確認したせいか、マスターも気をきかせて前菜を用意してくれていたみたい。前菜とパスタとおつまみでわりとお腹がふくれて、あとはお酒を飲んでた。</p>
<p>すみよしさんとは2020年から勉強会に参加したりしていたのでもう2年ぐらいの付き合いになる。わりと仲良くなってコミュニティの在り方とか、神戸界隈のベンチャー情報とか、新しい技術のあれこれとかを話したりしている。飲みながらざっくばらんにそういった雑談をしていた。</p>
<figure><img src=/diary/img/2022/0326_dish.jpg>
</figure>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0325/>カスタム github action 開発に着手</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-25
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/github/>github</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。</p>
<h2 id=歯科検診>歯科検診</h2>
<p>3ヶ月ごとの定期検診。本音は行くのが面倒くさいのだけど、こういう機会がないと検診に行かないので健康のためと思って通い続けている。基本的には30分強ぐらいで歯の掃除？みたいなことをやるだけ。下の歯の親知らずをまだ抜いていなくて、歯磨きでは届かないスポットがあって、そこが虫歯になりやすいのかな？3ヶ月に1回は掃除してもらえるのでたぶん役に立っているのだろう。今回は前にレントゲンをとって2年経ったので取り直ししましょうということで歯のレントゲンもとった。この歯医者さんにきてから2年経ったんだなということを実感した。よい歯医者さんだと思っているのでこれからも通うだろう。</p>
<h2 id=カスタム-github-action-開発>カスタム github action 開発</h2>
<p>前からやろうやろうと思っていて、他のことに時間を割かれてできていなかったことに着手した。久しぶりに gradle を触ったら使い方や設定方法を忘れてしまってドキュメントを読みながら再入門した。1つのアプリケーションであってもマルチプロジェクト構成がデフォルトになったみたい。これによってディレクトリの階層構造も変わっている。</p>
<ul>
<li><a href=https://kazamori.jp/blogs/2020/06/30/gradle-multi-project/>Gradle のマルチプロジェクト機能を試す</a></li>
</ul>
<p>今日のところは gradle 設定と main 関数と config のコードだけ書いた。java のバージョンも17を使うことにした。週末にある程度動くものを作りきれるかどうか。着手するまでが一番時間がかかので着手すればすぐにできそうな見通しはある。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0324/>spring boot の環境とログ設定</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-24
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/spring-boot/>spring boot</a>&nbsp;
#<a href=/diary/tags/logging/>logging</a>&nbsp;
#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て4時に起きて6時に起きた。</p>
<h2 id=spring-のプロファイル設定>spring のプロファイル設定</h2>
<p>spring の <a href=https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.profiles>Profiles</a> の仕組みを使って環境ごとの設定を作る。デプロイは k8s で管理しているため、spring boot の <a href=https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.external-config>Externalized Configuration</a> の仕組みを使って、環境変数から application.yml に定義された設定を書き換える。k8s は kustomize で管理していて prod, test, dev の3つの環境で任意の設定を記述できる。</p>
<p>問題はログ出力の設定を環境ごとに変えたい。具体的には datadog に連携されるログは構造化ログ (json lines) を、ローカルの開発ではコンソールログをみたい。<a href=https://logging.apache.org/log4j/2.x/log4j-spring-boot/index.html>Log4j Spring Boot Support</a> によると、1つの設定ファイルに複数のプロファイル設定を記述できるようにもみえるけど、実際にやってみたらうまく動かなかった。xml ではなく yml を使っているせいかもしれないし、私の記述方法が誤っているのかもしれない。いずれにしても yml で複数のプロファイルを設定しているサンプルをみつけられなかった。</p>
<p>そこで <a href=https://www.baeldung.com/spring-log4j2-config-per-profile>Different Log4j2 Configurations per Spring Profile</a> をみて、環境ごとにログ設定ファイルも分割することにした。application.yml には次のように記述する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>spring</span>:
  <span style=color:#f92672>profiles</span>:
    <span style=color:#f92672>active</span>: <span style=color:#ae81ff>dev</span>

<span style=color:#f92672>logging</span>:
  <span style=color:#f92672>config</span>: <span style=color:#ae81ff>classpath:log4j2-${spring.profiles.active}.yml</span>
</code></pre></div><p>ローカル開発向けの lgo4j2-dev.yml は次のようになる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>Configuration</span>:
  <span style=color:#f92672>status</span>: <span style=color:#ae81ff>warn</span>
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>YAMLConfig</span>
  <span style=color:#f92672>appenders</span>:
    <span style=color:#f92672>Console</span>:
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>STDOUT</span>
      <span style=color:#f92672>target</span>: <span style=color:#ae81ff>SYSTEM_OUT</span>
      <span style=color:#f92672>PatternLayout</span>:
        <span style=color:#f92672>Pattern</span>: <span style=color:#e6db74>&#34;%d{yyyy-MM-dd HH:mm:ss.SSS}[%t]%-5level %logger{36} - %msg%n&#34;</span>
</code></pre></div><p>k8s のマニフェストで環境変数を次のように定義すれば prod というプロファイルが設定される。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-service</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>template</span>:
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>containers</span>:
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-service</span>
        <span style=color:#f92672>env</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>spring.profiles.active</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;prod&#34;</span>
</code></pre></div><p>クラウド環境向けの log4j2-prod.yml は次のようになる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>Configuration</span>:
  <span style=color:#f92672>status</span>: <span style=color:#ae81ff>warn</span>
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>YAMLConfig</span>
  <span style=color:#f92672>appenders</span>:
    <span style=color:#f92672>Console</span>:
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>STDOUT</span>
      <span style=color:#f92672>target</span>: <span style=color:#ae81ff>SYSTEM_OUT</span>
      <span style=color:#f92672>EcsLayout</span>:
        <span style=color:#f92672>serviceName</span>: <span style=color:#ae81ff>my-service</span>
        <span style=color:#f92672>serviceNodeName</span>: <span style=color:#66d9ef>null</span>
        <span style=color:#f92672>includeMarkers</span>: <span style=color:#66d9ef>true</span>
        <span style=color:#f92672>KeyValuePair</span>:
        - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>type</span>
          <span style=color:#f92672>value</span>: <span style=color:#ae81ff>app</span>
</code></pre></div>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0323/>暇な一日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-23
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/browser/>browser</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て3時に起きて5時までだらだらしててそのまま起きた。</p>
<h2 id=タスクがない>タスクがない</h2>
<p>開発のロードマップ全体の計画が遅れているのに私のタスクが全くないみたいな状態になっている。昨日、開発のリーダーにタスクがないので適当なタスクをアサインしてくださいとお願いして、すぐアサインされるんだと思ってたら1日待ってもアサインされなかった。現スプリントのチケットはたくさんあるのにアサイン可能なチケットがないのか、アサインしなくても他の開発者で間に合うのか、その両方なのか、開発チームは5人いて、そのうち4人が外部の協力会社になる。私の感覚的には2人は余剰でタイミングが悪いとタスクがないみたいな状況になる。期限までにやらないといけないことは溜まっているのに。</p>
<h2 id=workrooms-雑談>workrooms 雑談</h2>
<p>月に1回の <a href=https://hannari-python.connpass.com/event/242619/>はんなりPython メタバース会 #4</a> に参加した。workrooms で雑談会するのもだいぶ慣れてきた。毎月1-2回はやっている。Brave というプライバシーを重視したブラウザがよいみたいな話しがあって、とくに <a href=https://brave.com/ja/talk/>Brave Talk</a> のビデオ通話がよく出来ているという話しがあった。課金しないと4人まで参加できて、$7/月でプレミアムプランになるみたい。コミュニティ用途なら zoom から Brave Talk に移行した方がよいとまで言ってたので、そんなによいものなのか、また後日触ってみたいと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0322/>イベント登壇のススメ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-22
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て7時に起きた。今日も雨。雨降りの日が増えると春が来たなって感じがしてきた。</p>
<h2 id=cfp-のススメ>cfp のススメ</h2>
<p>先日、過去に私が jjug ccc に登壇した資料を紹介していて、そう言えば jjug ccc とかいまぐらいの時期かな？と思って調べたら、ちょうど3月27日が cfp の締め切りになる。「ぼくのかんがえたさいきょうのでぷろい」は java アプリケーション開発の基本には沿っていないやり方なので発表したらおもしろいかもしれないと、slack に軽く書き込んだらわりといいねが付いたので社員さんに cfp 送ったら？と勧めた。その社員さんは島根県在住なのでリモートで登壇できるならいいかも？という話しになってイベントの要項を確認したらオンライン開催なので大丈夫そう。</p>
<p>今日がスクラムのプランニングだったのでチームに共有して業務として cfp を送るための工数も確保した。私が発表してもよいのだけど、なるべく若い人がイベントに登壇すべきだし、業務でやったことはその会社の人が発表すべきだろうというのもあって、私はバックアップにまわって発表は社員さんに任せようと思う。今月末に事例紹介させてほしいという交渉をする予定なので、それがうまくいったら、技術協力として当社のクレジットだけスライドに入れてもらえればみたいところが私の狙い。いずれにしても cfp が採択されないとその展望もないので cfp 作りにも協力していきたい。</p>
<ul>
<li><a href=https://fortee.jp/jjug-ccc-2022-spring>JJUG CCC 2022 Spring</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0321/>github actions の課金金額</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-21
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
</span>
<div class=post-content>
<p>2時に寝て何度か起きてだらだらしながら10時に起きた。</p>
<h2 id=gihtub-api-tools-のリファクタリングとデータ分析>gihtub-api-tools のリファクタリングとデータ分析</h2>
<p>実際に使ってみながらリファクタリングしたり、足りない機能を追加したりした。ツールに拡張した機能が使えるかどうかの検証のため、お仕事のプライベートリポジトリのデータを使って分析をし始めて、気付いたら分析ならびに分析結果の資料まで作ってしまった。軽く半日ぐらいのお仕事をやってしまっていた。過去5ヶ月分の課金時間の合計を算出し、単体テストの実行を github actions に追加することで増える課金時間の見積もりと金額を算出した。月間でいまより3時間30分、全体の課金時間に対して20%弱程度の追加が見込まれる。それによる課金金額を算出すると 210 * $0.008 = $1.68 になる。いままで無料枠を超えないように運用してきたわけだが、こんな200円程度の金額を節約するために github actions 上でテスト実行しないといった判断がくだされていた。開発者は誰も実際の課金金額を知らなかったし、課金金額を算出するとあほらしくなった。あと github actions はめちゃくちゃ安い。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0320/>gihtub-api-tools の拡張</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-20
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
#<a href=/diary/tags/python/>python</a>&nbsp;
</span>
<div class=post-content>
<p>5時に寝て9時過ぎに起きた。昨日は久しぶりに夜更ししてコードを書いてた。</p>
<h2 id=github-actions-のいろいろな時間の算出>github actions のいろいろな時間の算出</h2>
<p>以前作った github-api-tools を拡張して github actions の実行履歴の分析するための機能を作っている。</p>
<ul>
<li><a href=https://github.com/kazamori/github-api-tools/issues/2>Add actions statistics</a></li>
<li><a href=https://github.com/kazamori/github-api-tools/pull/4>Add gh-cli-actions command for Actions API</a></li>
</ul>
<p>ひとまずワークフローの実行履歴からジョブのステップの実行時間を積み上げた時間を算出してみた。いくつか API を調べているうちに課金時間は直接 API から取得できることに気付いた。この3つの時間は全然別の意味をもっていて、それぞれの時間は一致しない。</p>
<ul>
<li>ステップ実行時間: ジョブのそれぞれのステップの実行時間の合計</li>
<li>課金時間: 課金対象として数えられている時間の合計</li>
<li>ワークフロー実行時間: アクションのワークフローの実行にかかった時間</li>
</ul>
<p>github actions は public リポジトリに関しては課金対象ではないんやね。private リポジトリ且つ github-hosted ランナーを使っている場合のみ課金対象となるみたい。</p>
<ul>
<li><a href=https://docs.github.com/en/actions/monitoring-and-troubleshooting-workflows/viewing-job-execution-time>Viewing job execution time</a></li>
<li><a href=https://docs.github.com/en/billing/managing-billing-for-github-actions/about-billing-for-github-actions>About billing for GitHub Actions</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0319/>workrooms 雑談会をした</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-19
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/animation/>animation</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/xr/>xr</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝てたぶん夜中に起きて7時に起きた。</p>
<h2 id=映像研には手を出すな>映像研には手を出すな</h2>
<p><a href=/diary/posts/2022/0316/#映像研には手を出すな>先日から</a> 見始めて1週間ぐらいかけて12話を見終えた。個人的には4話の <a href="http://eizouken-anime.com/story/?id=4">そのマチェットを強く握れ！</a> がよかった。最初の4話をみて、この物語の演出や構成の仕組みが理解できて、その後の話しもみてみようという気になった。4話がおもしろかったから8話と12話も期待したんだけど、4話が私の中で一番はまった分だけ、8話と12話は期待し過ぎになってしまった。別におもしろくなかったわけではない。<em>パブリック・エネミー</em> という言葉が出てきて、こんな言葉を使ったことないし、人生で1度は言ってみたい言葉だなと思った。よくよく考えたらクリエイターって既存の価値観に捕われず新しい価値観を創造するのだから、それは従来の価値観や秩序をよしとする人たちからみたら秩序の破壊者にみえることもあって、クリエイターをパブリック・エネミーと呼ぶのはそれほど的外れでもないかもしれないなとか思ったりもした。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今日の開脚幅は開始前161cmで、ストレッチ後162cmだった。今週もまったくやらなかったので先週より数値が悪くなった。そろそろ暖かくなってきたし、お仕事も一段落ついて落ち着いたので新たに生活のスタイルも変えていきたいと思う。そうやってさぼっていても週に1回はストレッチを受けられて本当にラッキーだと思う。</p>
<h2 id=workrooms-雑談>workrooms 雑談</h2>
<p>てらださんが週末は暇だから <a href=https://www.oculus.com/workrooms/>Horizon Workrooms</a> をしたいと話しているのをみかけて参加してみることにした。workrooms のよいところの1つとして、現時点では仮想空間内でパソコンを扱い難いので内職をしないことがあげられる。私はもはやパソコンを持ち込まないようにしていて、その場での会話に100%集中している。これが普通のオンライン会議ツールだと、自分が関心のない話題なら個人の作業を始めたり、外部とのインタラクションがあったりするとそれに反応したりする。そういったことをしないためのツールとして workrooms がいいなと思うところもある。これはただの運用の話しだけど。</p>
<p>workrooms で2時間ほど4人で雑談した。メタバースや仮想空間の技術への取っ掛かりの1つとして workrooms を始める人が私の周りでは少しずつ増えていて、徐々にメタバースに関するなにかは盛り上がっていくのかもしれないという雰囲気も出てきている。私の場合、月に1-2回は workrooms で雑談会をするようになってきた。私もただのユーザーではなく、なにかしらツールかコンテンツを作ったりする方に行くべきかもしれないけど、まだまだ他の現実のお仕事でできていないことが山ほどあって傍観している程度。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0318/>github actions の改善</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-18
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て3時に起きて6時に起きた。</p>
<h2 id=失敗したジョブの再実行>失敗したジョブの再実行</h2>
<p>せらさんのツィートをみかけて調べたら2日ほど前に失敗したジョブからの再実行の改善が行われたらしい。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>GitHub Action で失敗したジョブだけ実行できる様になってる。今まで失敗しやすいものは再実行を小さくするために設定を分けたりとかしていたんだけど、そういうことをしなくてもよくなった。</p>&mdash; Kazuhiro Sera (瀬良) (@seratch_ja) <a href="https://twitter.com/seratch_ja/status/1504664461483085826?ref_src=twsrc%5Etfw">March 18, 2022</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<ul>
<li><a href=https://github.blog/2022-03-16-save-time-partial-re-runs-github-actions/>Save time with partial re-runs in GitHub Actions</a></li>
</ul>
<p>たまにだけど、i/o エラーみたいな内容で github actions のワークフロー実行が異常終了することがある。そんなときに途中から再実行できるといいなぁとは思っていた。これはステップ単位ではなく、ジョブ単位の実行みたいだけど、それでも途中から再実行できればワークフローの自由度や効率は上がると思う。github actions がどんどん強力になっていくのが楽しみ。あとやぎさんから教えてもらった <a href=https://miyajan.booth.pm/items/1865906>GitHub Actions 実践入門</a> も購入した。ある程度触ったところで雰囲気は掴めてきたので体系的に学んでみる。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0317/>マージできると開発が楽しい</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-17
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て3時に起きて5時半に起きた。</p>
<h2 id=開発のコミットマージのルール改定>開発のコミット/マージのルール改定</h2>
<p>過去のスクラムのふりかえりをみていて、12月15日にレビューアが1人のため、Pull Request (以下PR) のレビューにかなり時間がかかっているという指摘をしてから3ヶ月かかって、ようやくレビュー負荷が集中していた社員からレビュープロセスの改善の機会がもたらされた。なぜレビュー負荷が1人に集中するかというと、チームの開発者は5人で、正社員1人で他4人は外部の協力会社であるため、正社員の approve なしでマージすることに躊躇するという状況だった。</p>
<p>大幅にレビュープロセスが緩和された。</p>
<ul>
<li>軽微な変更は PR を作って自分でマージしてよい</li>
<li>(所属問わず) 1人以上のレビューアによる apprve があればマージしてよい</li>
<li>PO が最終レビューするものは PR レビューアの approve を得なくてもよい</li>
</ul>
<p>私の作業時間の1/3は PR レビューの待ち時間だったのでこれだけで私の生産性は1.5倍になる。どんどんコミットしていけると開発していて楽しい。</p>
<h2 id=オンライン飲み会>オンライン飲み会</h2>
<p>余りまくっている交際費の予算消化も兼ねて前にお手伝いしていた会社のたにがきさんと雑談した。近況を話したりもしつつ、たにがきさんは私が過去に働いていた会社の親会社で働いていて、その時期も重なっていて、その親会社の話しを主にしていた。その親会社は主力プロダクトの完全な作り直しを宣言して、1000億円ぐらい開発費を投じたものの、実際にはプロダクトの作り直しに失敗して、資金繰りが悪化して事実上の倒産をした。親会社の社長はカリスマ社長で新興宗教の教祖みたいな感じだったんだけど、会社がファンドに買収されて、取締役を退任させられて、しばらくは鳴りを潜めていたけど、最近はまた会社を作って精力的に活動しているらしい。近く OB 会のようなイベントがカリスマ社長から呼びかけられているらしく、どう考えてもリクルーティングの場なんだろうと話していた。また1年ぐらいしたら近況報告会をしてもいいかもしれない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0316/>最低1000万件のデータがあると思え</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-16
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/animation/>animation</a>&nbsp;
#<a href=/diary/tags/sql/>sql</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時半に起きた。</p>
<h2 id=映像研には手を出すな>映像研には手を出すな</h2>
<p>お奨めされたので <a href=http://eizouken-anime.com/>映像研には手を出すな</a> を見始めた。あまり現実と空想が入り交じる展開が新鮮と言えば新鮮だし、ストーリーがわかりにくい気もしてもやもやする。浅草氏も「アニメは設定が命」と言っているし、この設定はどうなの？とか思いながら、それでもみているんだからいいんだろうって感じ？最初はごちゃごちゃしててわかりにくい感じがしたんだけど、見続けていると徐々に独特の世界観に慣れてきたのか、ところどころおもしろいなと思うようにはなってきた。また全話みてから総括する。</p>
<h2 id=サブクエリで-group-by>サブクエリで group by</h2>
<p>お仕事でたまたま触っているところの sql をみたら次のようなものがあった。サブクエリで group by 句を使っている。仮に mytable_detail が1億件ぐらいあったらこんな sql 動くわけがない。データが溜まるごとに遅くなっていって、しきい値を超えると急激にパフォーマンスが悪化する時限爆弾みたいな sql だと思う。お手伝い先は or mapper を使っていないので開発者が sql を手で書いているにも関わらず、こんな sql が実運用されてしまうような開発体制には大きな課題があるなぁとか考え込んでしまった。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>SELECT</span> mytable.<span style=color:#f92672>*</span>, t.is_some
<span style=color:#66d9ef>FROM</span> mytable
<span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> <span style=color:#66d9ef>LATERAL</span> (
    <span style=color:#66d9ef>SELECT</span> mytable_id, bool_or(mytable_detail.is_some) <span style=color:#66d9ef>as</span> is_some
    <span style=color:#66d9ef>FROM</span> mytable_detail
    <span style=color:#66d9ef>WHERE</span> mytable_detail.mytable_id <span style=color:#f92672>=</span> mytable.mytable_id
    <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> mytable_detail.mytable_id
) <span style=color:#66d9ef>as</span> t <span style=color:#66d9ef>on</span> t.mytable_id <span style=color:#f92672>=</span> mytable.mytable_id
<span style=color:#66d9ef>WHERE</span> mytable.foreign_key_id <span style=color:#f92672>=</span> :foreignKeyId
<span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> mytable.mytable_id;
</code></pre></div><p>以前、お手伝いしていた会社の CTO が社内の開発者のデータの取り扱いの指針として書いた記事が次になる。社内では <strong>最低</strong> 1000万件のデータがあると思ってコードを書けと強く啓蒙していた。いまどきのデータ量として1000万件というのはよい指標だと思う。</p>
<ul>
<li><a href=https://joker1007.hatenablog.com/entry/2020/11/04/214646>1000万件オーバーのレコードのデータをカジュアルに扱うための心構え</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0315/>フロントエンド開発着手</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-15
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/vue.js/>vue.js</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て3時に起きて6時に起きた。やっぱり起きてからドラクエタクトしてた。</p>
<h2 id=フロントエンド開発>フロントエンド開発</h2>
<p>デプロイ改善が完了したので新しいタスクに取り組み始めた。もともとこの開発チームはバックエンドもフロントエンドも全部やるというチームなので、やりかけ中のタスクのフロントエンド側の変更に着手して、既存の画面に新規項目を追加するといった作業をやってみた。フロントエンドは vue.js + nuxt で開発している。ビルドに30秒ぐらいかかる。ちょっと遅い。宣言型 ui のよいところかもしれないけど、vue.js も nuxt もまったく触ったことないけど、ripgrep で検索してちょちょっとコピペしたらそれっぽく動いた。これはまさにあれだ。</p>
<blockquote>
<p>全然わからない。俺たちは雰囲気で開発している。</p>
</blockquote>
<p>動いたらラッキーみたいな感じで PR を作って、たまたまレビューも通って、テスト環境で動いたんでラッキーだった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0314/>平穏な一日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-14
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時半に起きた。一仕事を終えて淡々と前の作業の続きのリファクタリングなどをしていた。</p>
<h2 id=デプロイ改善のタスク完了報告>デプロイ改善のタスク完了報告</h2>
<p>週末にパイプライン処理の検証やロールバック処理の実装を行った。ドキュメントも一通り書いた。チームの開発者にそれらを説明して3スプリント(3週間)に渡った改善が完了したことを報告した。チケットにすると26、そのうち私が担当したのが22なので、私がイニシアティブをとって完遂させた。github actions を始めとする、github のサービスの理解が深まってそれなりに学びがあった。自分でもいくつかカスタム action を作ってみようと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0313/>k8s のロールバック</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-13
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て7時に起きた。</p>
<h2 id=k8s-のロールバック>k8s のロールバック</h2>
<p><a href=https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#rolling-back-to-a-previous-revision>Rolling Back to a Previous Revision</a> をみながらすぐできた。ロールバックもこれまでと同様、github actions の workflow dispatch で管理できるようにした。基本的にはこれだけでロールバックできる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl rollout undo deployment/my-app-deploy
</code></pre></div><p>ちょっと工夫したこととして、デプロイ時に <a href=https://kubernetes.io/docs/reference/labels-annotations-taints/#change-cause>kubernetes.io/change-cause</a> というアノテーションに git のリビジョンもセットしておくと確認するときにちょっと楽ができる。apply した後の deployment リソースに docker イメージのタグ情報 (= git のリビジョン) を書き込んでおく。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl apply -k <span style=color:#e6db74>${</span>{ env.DEPLOYMENT_ENV <span style=color:#e6db74>}</span><span style=color:#f92672>}</span>
$ kubectl annotate deployment my-app-deploy kubernetes.io/change-cause<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>{ env.IMAGE_TAG <span style=color:#e6db74>}</span><span style=color:#f92672>}</span> --overwrite<span style=color:#f92672>=</span>true
</code></pre></div><p>kubectl から履歴をみたときに k8s のリビジョンがどの git のリビジョンを使っているかがわかりやすい。デフォルトでは何も設定されていないかもしれない。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl rollout history deployment/my-app-deploy
deployment.apps/my-app-deploy
REVISION  CHANGE-CAUSE
<span style=color:#ae81ff>15</span>       &lt;none&gt;
<span style=color:#ae81ff>16</span>       &lt;none&gt;
<span style=color:#ae81ff>17</span>       &lt;none&gt;
<span style=color:#ae81ff>18</span>       &lt;none&gt;
<span style=color:#ae81ff>19</span>       &lt;none&gt;
<span style=color:#ae81ff>20</span>       &lt;none&gt;
<span style=color:#ae81ff>21</span>       &lt;none&gt;
<span style=color:#ae81ff>22</span>       &lt;none&gt;
<span style=color:#ae81ff>24</span>       1f17a22a6659ea0714a21fca034645cd191e189b
<span style=color:#ae81ff>27</span>       a84e113d8b7c124178b58e2f40f57b00aae65485 
<span style=color:#ae81ff>28</span>       dcf3552db0668d416ed880f6e896455d7bab194c
</code></pre></div>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0312/>デプロイ改善の残作業</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-12
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て2時に起きて4時ぐらいまでだらだらして寝て6時に起きた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>これまで11時からストレッチを受けていたが、今週から dr.stretch さんの土日の開店時間が10時になったのにあわせる形で時間変更した。朝に予定が入っているとその時間にあわせて起きて身支度して1日が始まるので家で中途半端にだらだらしなくてよい。いつもは11時にあわせて家を出掛けるのが、10時にあわせて出掛けるようになったのでいつもより1時間早く活動できるようになった。私はなんか予定がないとだらだらしてしまって怠惰に過ごしてしまう。そういう怠ける自分の性格もわかっているので適度に予定を入れて怠けないように注意している。</p>
<p>今日の開脚幅は開始前163cmで、ストレッチ後165cmだった。先週とほぼ同じ。今週もお仕事が忙しくて全くできなかったので現状維持といったところ。</p>
<h2 id=デプロイのパイプライン処理>デプロイのパイプライン処理</h2>
<p>github deployment から workflow dispatch に移行したおかげでせっかく deployments ベースで作ったパイプライン処理のツールを workflow dispatch 向けに移行する必要があった。言うても基本的に同じパラメーターを処理するだけなので大半は再利用できる。ツールのちょっとしたリファクタリングをやってパイプライン処理が動くかどうかの検証をして、ドキュメントを wiki にまとめた。あとはロールバックを自動化するための仕組みを作るだけ。基本的には k8s の kubectl を実行するワークフローを作るだけという想定。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0311/>連日の近況報告</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-11
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/business/>business</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;
#<a href=/diary/tags/career/>career</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て6時に起きた。朝ちょっとデバッグをやって午後からは来週のオンライン飲み会の手配をしたり、打ち合わせのメモをまとめたりしていた。</p>
<h2 id=隔週の雑談>隔週の雑談</h2>
<p>顧問のはらさんと隔週の打ち合わせ。直近の2-3週間でやっていた ci/cd の改善や github actions のことについて共有したりした。次の契約更改のタイミングで契約条件の変更を相手と協議しようと考えている。具体的には単価をあげたり事例紹介を許可してもらったりといった類の交渉をする予定。一般論として業務委託は最初の契約条件から条件変更するのが難しいらしく、なかなかタフな交渉になるっぽいというのをはらさんから助言してもらったりしている。私の中では交渉するネタはいくつかあるし、ダメならダメで最悪のケースなら契約終了して、別の会社のお仕事に切り替えてもよいし、いまは開発者は売り手市場なので楽観的に考えていたりする。</p>
<h2 id=近況報告>近況報告</h2>
<p>元同僚と1年ぶりにオンライン飲み会をした。それぞれ近況を話したりしていた。私が見限ったビジネスはその後うまくいったらしくてなにがうまくいくかわからんものだという話しも聞いた。私が在籍していた頃の早期退職制度は50歳以上が対象だったけど、いまは45歳以上に下がっているらしい。また来期から年配の社員を辞めさせるための追い出し部屋ならぬ追い出し会社がグループ企業として設立されるという話しも聞いた。おそらくは戦力外社員をその会社に集めて待遇を下げるみたいな話なんだろうと推測する。日本の労働基準法では、一方的な解雇や減俸はできないが、配置転換は許されていて、別会社に転籍してその会社の待遇が元の会社よりも悪いというのは法律的に問題ないらしい。本体より待遇の悪いグループ企業を作って、そこに転籍することで事実上の減俸や自主退職を促すような慣習となっている。私が起業した理由の1つは早期退職制度ができて自分の未来もそうなると実感したというのがある。少なくとも自分の会社で自分が解雇されることはない。</p>
<p>元同僚の1人も来期は45歳になるので早期退職制度を使って会社を辞めるかもしれないという話されていた。40代からのキャリアってなかなか難しいなとは思えた。私もいまはなんとかなっているけど、このままお仕事がある保証はないし、引き締めていかないといけない。ただあるとき急に追い出し会社に送られるという組織の論理で生きているわけではないという自由だけは謳歌している。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0310/>ばてばての木曜日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-10
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝てたぶん1回ぐらい起きて6時前に起きた。</p>
<h2 id=github-discussions>GitHub Discussions</h2>
<p>やぎさんに <a href=https://docs.github.com/en/discussions>GitHub Discussions</a> というのがあると教えてもらった。軽くチュートリアルやドキュメントに目を通してみた。stackoverflow のような q&a ができるようなサービスなのかな？著名な oss のコミュニティでたまに盛り上がるネタとして issue がサポートセンターになってしまうという問題がある。経験が少ない開発者が自分の環境で動かなかったときに issue 登録して開発者にサポートを依頼するみたいなことになってしまうケースがある。もちろん経験が少ない開発者にとっては環境要因のエラーとそうじゃないのを見分けるのは難しいことかもしれない。一方で oss コミュニティのメンテナーのリソースも有限なことから初心者質問を回答するために多くの労力をさけないという現実もある。その issue と q&a のギャップを埋めるようなサービスになるのかな？と推測している。試しにいま作っているデプロイツールで discussions を有効にしたのでいろいろ触ってみる。</p>
<h2 id=近況報告>近況報告</h2>
<p>約1年ぶりにやすだ先生とオンライン飲み会をした。3月にやっているので今期の経営的なふりかえりも少ししつつ大半は雑談をしていた。昨年、経営コンサルティングで交際費が少な過ぎるという指摘を受けてからオンライン飲み会や雑談会を始めたときの、身近な相談相手の1人と言える。今期は10人以上とオンライン飲み会やオフラインの雑談会をやっているし、こんな感じで知人と定期的に近況を話す仕組みを継続できればいいなとは思う。今期は交際費として30万円/年の予算を確保しているものの、現時点では83,747円しか消化していない。もう決算まで1ヶ月もないのに。なぜなのか。。。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0309/>リーン思考？</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-09
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/issue-tracking-system/>issue tracking system</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時半頃に起きて6時半に起きた。</p>
<h2 id=リーン思考>リーン思考</h2>
<p>スクラムのふりかえりをしていて、スクラムマスターがふとスクラムっぽいものとスクラムとの違いの1つとしてリーン思考の有無をあげた。私がリーン思考というのを知らなかったので軽く調べてみた。</p>
<ul>
<li><a href=https://www.modularmanagement.com/ja/blog/%E3%83%AA%E3%83%BC%E3%83%B3%E6%80%9D%E8%80%83%E3%81%A8%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%A9%E3%83%BC%E5%8C%96%E3%82%92%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE3%E3%82%B9%E3%83%86%E3%83%83%E3%83%97>リーン思考とモジュラー化を実現するための3ステップ</a></li>
</ul>
<blockquote>
<p>リーン思考とは？</p>
<p>リーンという考え方は、ムダを最小限に抑えつつ、顧客価値を最大化することです。そのためには、ムダを削除・削減させるような構造化された「働き方」と、それを継続的に改善し続けることが必要です。つまり、リーンな組織というのは顧客が何に価値を感じているのかを理解しており、継続的な価値向上に繋がるプロセスに注力するものです。繰り返しとなりますが、究極の目標は、ムダゼロな完璧なプロセスを通して、顧客に最大限の価値を提供することです。</p>
</blockquote>
<p>引用しておいてなんだが、「リーン思考とは」と節を書いているのに直接な定義を最初に書かない文章は読みにくい。要約すると、リーンという概念を組織として理解していて実践していく考え方や心の動きをリーン思考と呼ぶのだろうか？スクラムマスターがリーン思考が足りないとか言っていたけど、あまりピンとこない。というのは、スクラムマスターは基本的に言うだけで実践はすべて現場に丸投げ。リーン思考が足りないというだけなら誰でも言えるが、日々の具体的な活動や実践にどう落とし込むのかを示さないので現場のメンバーにはあまり響かない。リーダーシップにもいろんなタイプがあると思うが、実践は実践力をみせつけてフォロワーがついてくる。とくに抽象的なよくわからない概念をビジョナリーが提唱するだけではなにも変わらない。</p>
<p>私自身がリーン思考を意識したことはないが、課題管理に関して開発のワークフローを最適化するというのはある種のリーン思考とも言える。チケットのワークフローが洗練すれば洗練するほど効率がよくなってイテレーションのサイクルが多くまわり、結果として価値が速くユーザーに届いたり、試行錯誤の改善が早くなる。キーワードとして一応は覚えておく。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0308/>デプロイ改善の成果まとめ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-08
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て5時過ぎに起きた。何度か途中で起きたけど、久しぶりによく寝た。前日あまり寝てなかったから19時過ぎには帰ってきてだらだらしてた。</p>
<h2 id=もてなしだけではもう食えない>もてなしだけではもう食えない</h2>
<p>業界研究を兼ねて <a href="https://ec.hoteresonline.com/products/detail.php?product_id=262">もてなしだけではもう食えない -ホテル経営学の本質と実践-</a> を読み始めた。同じ出版社の週刊ホテルレストランという雑誌の連載を書籍化したものらしい。著者は立教大学で社会人向けビジネススクールでホテルマネジメントとホテルインベストメントを教えているらしい。ビジネスの堅い話しを小説調にすれば読みやすいんじゃないかみたいな取り組みなのかな？よくわかてないけど、小説仕立てで業界研究ができるような書籍になっているらしい。第1章プロローグと第2章腐りやすい在庫を読んだ。実際の現場でこんな仕事できない人が改革チームのリーダーなんかになったりしないなと思いながら読んでた。そこは本題じゃない！コンサルティングでありそうな経営の話しが出てくるのでうちの会社の経営の勉強にもなるかもしれない。少しずつ読んでいく。</p>
<h2 id=デプロイ改善の成果>デプロイ改善の成果</h2>
<p>水曜日がすくらむのふりかえりイベントがあるのでそれに間に合わせて簡単にまとめの資料を作った。3スプリント (3週間) もかけて抜本的に開発のワークフローからビルド/デプロイの ci/cd を見直したので開発全般に影響を与えた。</p>
<ul>
<li>本番環境デプロイ: 実行時間を約72%の短縮</li>
<li>テスト環境デプロイ: 実行時間を約51%の短縮</li>
<li>hotfix デプロイ: 実行時間を約64%の短縮
<ul>
<li>そもそも従来のやり方では hotfix を出していないので机上の時間ではあるが</li>
</ul>
</li>
</ul>
<p>単純に github actions の実行時間だけ比較しても速くなっているのだけど、それ以上にブランチ戦略を大きく変えた。従来は3つのブランチで運用していた。</p>
<ul>
<li>develop</li>
<li>test</li>
<li>main</li>
</ul>
<p>これを1つのブランチのみで運用できるように開発のワークフローを刷新した。ブランチが1つしかないので ci/cd の戦略もシンプルになって、変則的な運用 (hotfix を出したいとか) をしても、開発全体に影響を与えない。「誰か勝手にブランチを作ってデプロイして」で終わる。従来のやり方は3つのブランチが開発ワークフローと ci/cd に密接であったために本番環境のリリースするときは開発すべてが止まってしまう状態だった。週1回のリリースだったので本番リリース前の1-2日は PR のレビューやマージを止めているという運用になっていた。それは開発速度に大きな影響を与えていた。ブランチ戦略を見直したことでいつでも本番環境にデプロイできるようになって、継続的デリバリーっぽいことがやりたかったらできるよという話しをした。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0307/>ワークフローの移行説明</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-07
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
</span>
<div class=post-content>
<p>3時に寝て6時半に起きた。朝起きたら github actions のリソース上限に達しているという連絡が slack に書き込まれていて週末に移行作業して1500分ぐらいは浪費しましたと事後報告した。</p>
<h2 id=ワークフロー移行後の説明>ワークフロー移行後の説明</h2>
<p>週末に移行した新しい ci/cd の仕組みを開発者に説明した。開発のワークフローも大きく変わる。いくつか要望をもらいつつ、とくに混乱も誤解もなく受け入れられた。github actions の管理画面からボタンでデプロイ実行できるため、本番環境にデプロイできるユーザーは制限したいと言われて次のようなステップを追加した。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>デプロイユーザーを確認</span>
  <span style=color:#f92672>if</span>: <span style=color:#ae81ff>${{ env.DEPLOYMENT_ENV == &#39;prod&#39; }}</span>
  <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span><span style=color:#e6db74>    [[ &#34;${{ contains(fromJSON(env.DEPLOYABLE_USERS), github.actor) }}&#34; == &#34;true&#34; ]] &amp;&amp; exit 0
</span><span style=color:#e6db74>    echo &#34;デプロイ権限のあるユーザーではありません&#34;
</span><span style=color:#e6db74>    exit 1</span>    
  <span style=color:#f92672>env</span>:
    <span style=color:#f92672>DEPLOYABLE_USERS</span>: <span style=color:#e6db74>&#39;[&#34;user1&#34;, &#34;user2&#34;, &#34;app-bot&#34;]&#39;</span>
</code></pre></div><p>expressions の <a href=https://docs.github.com/en/actions/learn-github-actions/expressions#functions>Functions</a> に組み込みの関数がいくつか紹介されている。それらを組み合わせるとうまくいきそうと思って書いてみた。たしかにちょっと楽に実装はできるけど、github actions の expression とシェルの文字列との境界が、yaml のコード上では曖昧なため、真偽値などはとくにわかりにくい。例えば、次のコード。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>{ contains(fromJSON(env.DEPLOYABLE_USERS), github.actor) <span style=color:#e6db74>}</span><span style=color:#e6db74>}&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#f92672>]]</span>
</code></pre></div><p><code>${{ ... }}</code> で囲まれたところは github の expression なので boolean として評価できるが、それをシェルにもってくると文字列になってしまうので文字列で比較しないといけない。普通にコードを書いていて気づきにくいので実行して振る舞いを検証しないと間違うみたいな話し。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0306/>もっとさいきょうのでぷろい</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-06
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
</span>
<div class=post-content>
<h2 id=ぼくのかんがえたもっとさいきょうのでぷろい>ぼくのかんがえたもっとさいきょうのでぷろい</h2>
<p>昨日 <a href=/diary/posts/2022/0305/#ぼくのかんがえたさいきょうのでぷろい>ぼくのかんがえたさいきょうのでぷろい</a> を実装したんだけど、その後、残っていた残課題に対応しているうちにもっと最強のデプロイ方法があることに気付いた。結論から言って <a href=https://docs.github.com/en/rest/reference/deployments>GitHub Deployments</a> を使う必要がなかった。GitHub Deployments で過去のリビジョンを指定したときは次のような 409 エラーが発生する。</p>
<pre tabindex=0><code>gh: Conflict merging main into f0cff65c94c4a242efebc79c8fb1e31d58d2f592. (HTTP 409)
</code></pre><p>これを回避するためにどんな手段があるかなと <a href=https://docs.github.com/en/rest/reference/actions#create-a-workflow-dispatch-event>workflow dispatch event</a> をみていて <code>inputs</code> というパラメーターがあることに気付いた。あれ？workflow dispatch ってパラメーターを受け取ることができたんだっけ？と調べたら2020年7月ぐらいからできるようになってた。</p>
<ul>
<li><a href=https://github.blog/changelog/2020-07-06-github-actions-manual-triggers-with-workflow_dispatch/>GitHub Actions: Manual triggers with workflow_dispatch</a></li>
<li><a href=https://github.blog/changelog/2021-11-10-github-actions-input-types-for-manual-workflows/>GitHub Actions: Input types for manual workflows</a></li>
</ul>
<p>github actions の web ui とも連動していて画面からもパラメーターを渡せるようになっていた。jenkins で言うところのパラメーター付きビルドと呼ばれる機能。カスタムアクションの <a href=https://docs.github.com/en/actions/creating-actions/metadata-syntax-for-github-actions#inputs>inputs</a> と同じような使い勝手で利用できる。workflow dispatch がパラメーターを受け取れるなら GitHub Deployments を使うメリットって何があるっけ？と思ったら何もなかった。GitHub Deployments を使うことで無駄にリソースを浪費してパイプライン処理を複雑化させるデメリットしかなかった。inputs に渡す型に <a href=https://docs.github.com/en/actions/deployment/targeting-different-environments/using-environments-for-deployment>environment</a> を指定すると、環境の制限や権限、protected branch などにも応用できるらしい。但し、この environment は public リポジトリか、github enterprise でしか高度な設定はできないみたい。GitHub Deployments 経由でリソースの作成自体はできる。</p>
<figure><img src=/diary/img/2022/0306_workflow-dispatch.png>
</figure>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0305/>週末は休出</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-05
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
</span>
<div class=post-content>
<p>2時に寝て8時頃に起きた。前日に深夜まで開発してたせいか、朝起きたら頭痛かった。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>お仕事に集中していて今週は1回しかストレッチができなかった。今日の開脚幅は開始前164cmで、ストレッチ後165cmだった。先週と同じぐらいかな。それでも毎週予定が入っているので必ず週に1回はちゃんとしたストレッチを受けられる。もう1年以上続けているのだけど、以前より体調のよい状態をずっと継続できている。私はなにかに集中すると他のことをしばらく放置してそればっかりやってしまう傾向があるから毎週の予約があることが継続的な体調管理に大きく役立っている。太ももの後ろの筋肉と腰のストレッチの2つを楽しみにしている。デスクワークをする人は基本的にこの2つに疲労が蓄積するので疲労が溜まるのは自然と言える。その度合いがどのぐらいかでその週の疲労感や調子がよくわかる。今日は先週よりもその2つはましになっていた。</p>
<h2 id=ぼくのかんがえたさいきょうのでぷろい>ぼくのかんがえたさいきょうのでぷろい</h2>
<p>ここ2週間ほど、ビルドとデプロイの分離のための作業をしている。具体的には <a href=https://docs.github.com/en/rest/reference/deployments>GitHub Deployments</a> と <a href=https://docs.github.com/en/actions>GitHub Actions</a> を組み合わせて、新たな開発のワークフローを作るといったもの。main, test, develop と3つのブランチで開発/運用しているのを main ブランチ1つに統合し、ビルドもデプロイも最小限に留めて継続的デリバリーを目指すというもの。移行時は開発を止めてしまうのでこの土日で作業する予定だった。準備は十分にやっていたので問題なく移行を完了させた。今日は単体リポジトリのテスト環境へのデプロイができるところまでできた。あとはデプロイツールや github actions の処理を洗練させていくだけ。テンションが上がっているのでこのまま明日も休出してできるだけ品質をあげていく。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0304/>組織系のイベントにはもう参加しない</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-04
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て3時40分に起きてそれからの記憶があまりないけど、6時半には起きてた。昼間は久しぶりにシェルスクリプトに熱中してて夜にイベントがあって、それを聞きながらも日付が変わるぐらいまではずっとシェルスクリプトを書いていた。</p>
<h2 id=よくわからないイベント参加>よくわからないイベント参加</h2>
<p><a href=https://retrospective.connpass.com/event/240185/>【デブサミ再演】10年後もエンジニアが成長し続けるためにできることを、20年続く組織の中から考える</a> に参加した。なにかの機会でたまたまみかけて中堅社員のキャリア論かなと思って参加したけど、なんかいまいちだった。シェルスクリプトを書きながら聞いてたから大事な話しもしていたかもしれないけど、miro でプレゼン資料が作られていて、参加者が付箋などに書いたコメントをみながら主催者が回答したりもしつつ、スライドで説明したりもしつつ、発表と雑談が混ざった進行で私からはコミュニティの内輪感にみえたし、何が言いたいのかよくわからないイベントだった。コミュニティのメンバー数をみるとそこそこ大きいようにもみえるので、単純に私がコミュニティの対象とする参加者ではなかったんだと思う。パワーポイントなどのスライド資料でプレゼンするのではなく、miro でプレゼンするというスタイルが新鮮で私からはそれがもっとも参考になった点だった。</p>
<p>組織論やキャリアの悩みは私の中では決着がついてしまったのかもしれない。変なことは言っていないし、5年前ぐらいの自分なら関心をもって聞いていたかもしれないけど、自分で会社を作ってみて、組織の論理に振り回されることがなくなって、自分のやりたいことに集中できるようになったからかもしれない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0303/>裁判の結審</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-03
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/court/>court</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て3時40分に起きて気付いたら6時半だった。</p>
<h2 id=交通事故の裁判>交通事故の裁判</h2>
<p>父の交通事故の裁判で保険会社と和解が成立した。交通事故の後、症状固定という、医師の視点からは治療は完了したという診断書をもって加害者の保険会社から任意保険の保険金が支払われる。相手の保険会社の審査のようなものが滞っていて症状固定診断から1年以上経っても支払われないので裁判を起こしていた。弁護士さん曰く、保険会社も多忙なので保険金支払いの裁判を起こすのはよくあることだと当時聞いた。基本的に私は弁護士さんとメールでやり取りしているだけだったが、<a href=/diary/posts/2021/1007/#裁判の傍聴>裁判の傍聴</a> も1度だけした。10月にもう少しで終わりそうと見積もっていて、実際に結審したのが3月なので5ヶ月ぐらいかかっている。裁判は1-3ヶ月に1回ぐらいの頻度でしか開かれないのでそういう時系列になる。裁判を始めたのが2021年6月頃なので和解という形で結審するまで1年半ぐらいかかったことになる。父が交通事故にあってから約5年が経過していた。保険金は父の財産であり、成年後見人の弁護士さんが管理するもの。保険金支払いは父も含めて家族の生活に変化をもたらすものではない。私が弁護士さんとやり取りする必要がなくなるので自由時間が増えるというぐらいの変化。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0302/>シェルスクリプトも進化する</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-02
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/shell/>shell</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て2時に起きて6時に起きた。</p>
<h2 id=シェルスクリプト再考>シェルスクリプト再考</h2>
<p>久しぶりにシュルスクリプトを書いていて、ユーティリティ関数をうまいこと実装できないかを調べていたら <strong>nameref</strong> という仕組みが bash 4.3 以降で使えるらしい。私の bash 環境は 5.0.17 なので、bash 5 以上という制約にしてしまってもよいだろうと思う。例えば、こんなことができる。シェルスクリプトで split を実装するの面倒よね。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#66d9ef>function</span> split<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    local -n arr<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
    local values<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$2<span style=color:#e6db74>&#34;</span>
    local sep<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>3<span style=color:#66d9ef>:-</span>,<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
    IFS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>sep<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
    read -a arr <span style=color:#f92672>&lt;&lt;&lt;</span> <span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$values<span style=color:#e6db74>&#34;</span> | tr -d <span style=color:#e6db74>&#39;[:space:]&#39;</span><span style=color:#66d9ef>)</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>function</span> test<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    split mylist <span style=color:#e6db74>&#34;a, b, c&#34;</span>
    echo <span style=color:#e6db74>&#34;&#39;</span><span style=color:#e6db74>${</span>mylist[0]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;&#34;</span>
    echo <span style=color:#e6db74>&#34;&#39;</span><span style=color:#e6db74>${</span>mylist[1]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;&#34;</span>
    echo <span style=color:#e6db74>&#34;&#39;</span><span style=color:#e6db74>${</span>mylist[2]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;&#34;</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>実行結果。ちょっと感動した。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ test
<span style=color:#e6db74>&#39;a&#39;</span>
<span style=color:#e6db74>&#39;b&#39;</span>
<span style=color:#e6db74>&#39;c&#39;</span>
</code></pre></div><ul>
<li><a href=https://stackoverflow.com/questions/10582763/how-to-return-an-array-in-bash-without-using-globals>How to return an array in bash without using globals?</a></li>
<li><a href=https://www.gnu.org/software/bash/manual/html_node/Shell-Parameters.html>3.4 Shell Parameters</a></li>
</ul>
<h2 id=bizpy-勉強会>bizpy 勉強会</h2>
<p><a href=https://bizpy.connpass.com/event/239471/>Python で機械学習の前処理をやってみる勉強会</a> を開催した。今回も講師をわたなべさんにお願いした。私が余裕なくて全くなにもできていない。運営が2人いるとすごく助かる。今回は機械学習の前処理に着目して pandas や scikit-learn を使って実際にどういったプログラミングをするかを解説してもらった。<a href=https://colab.research.google.com/>Colab</a> を使ってデモするのがいまどきのやり方なのかな？私は全く触ったことがないけど、そういうやり方の違いも含めて関心をもてた。Colab 上で普通に git コマンドも使えるのでリポジトリのクローンなんかもできる。次回は私もなにかしら発表をしたいなとは思う。いまのお仕事が一段落ついたら。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0301/>github apps を調べた</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-03-01
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/auth/>auth</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て5時半に起きた。何度か夜中にも起きた。起きてからドラクエタクトやってた。</p>
<h2 id=oauth-apps-と-github-apps>oauth apps と github apps</h2>
<p>いまお仕事で ci/cd の改善をやっていて、その一環としてリポジトリをまたがったパイプライン処理を検討している。
ci/cd で使うような認可の仕組みとして github には oauth apps と github apps の2種類がある。</p>
<ul>
<li><a href=https://docs.github.com/en/developers/apps/building-oauth-apps>Building OAuth Apps</a></li>
<li><a href=https://docs.github.com/en/developers/apps/building-github-apps>Building GitHub Apps</a></li>
</ul>
<p>私はどちらも全く関わったことがなかったので、仕組みがイメージできる oauth apps を使えばよいのだろうと調べ始めた。しかし、一通り調べてみて会社の開発における ci/cd に使うなら github apps の方が適していることがわかった。両者がどう違うのかもドキュメントに記載されている。最初にこのドキュメントを読めば oauth apps を調査する必要はなかった。</p>
<ul>
<li><a href=https://docs.github.com/en/developers/apps/getting-started-with-apps/differences-between-github-apps-and-oauth-apps>Differences between GitHub Apps and OAuth Apps</a></li>
</ul>
<p>具体的には、oauth apps は user の権限を認可する仕組みで、github apps は organization の権限を認可する仕組みと言える。github apps も oauth によるユーザー認証もできる上にアプリ自身の認証もできる。さらにアクセスできるリポジトリも制限できることから github actions などで、特定のリポジトリに対してのみアクセス可能なトークンを取得するには github apps の方が向くというわけだ。oauth でユーザーが認可するときに scope を指定するが、その scope を organization が設定できるといったところが github apps と oauth との違いにみえる。取得できる token の有効期限にもその考え方の違いが出ている。</p>
<ul>
<li>oauth apps
<ul>
<li>ユーザー/デバイス認証
<ul>
<li>認可コード: 15分</li>
<li>アクセストークン: 無期限</li>
</ul>
</li>
</ul>
</li>
<li>github apps
<ul>
<li>installation 認証
<ul>
<li>認可jwt: 10分</li>
<li>installation トークン: 1時間</li>
</ul>
</li>
<li>ユーザー/デバイス認証
<ul>
<li>認可コード: 15分</li>
<li>アクセストークン: 8時間</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0228/>kustomize の動的な設定</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-28
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て2時に起きてそこから断続的に寝たり起きたりを繰り返して6時に半に起きた。ウクライナ情勢のニュースや記事ばかり読んでてあてられた。</p>
<h2 id=kustomize-の動的な設定>kustomize の動的な設定</h2>
<p>kustomize で管理している image のタグをデプロイ処理の中で動的に変更したい。パラメーター渡しなり環境変数なり、なにかしらあるだろうとは予測している。<a href=https://github.com/kubernetes-sigs/kustomize/blob/master/examples/image.md>Demo: change image names and tags</a> のサンプルによると、次のように実行すればよいみたい。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kustomize edit set image busybox<span style=color:#f92672>=</span>alpine:3.6
</code></pre></div><p>次のような <code>kustomization.yaml</code> をセットしてくれるみたい。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>images</span>:
- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>busybox</span>
  <span style=color:#f92672>newName</span>: <span style=color:#ae81ff>alpine</span>
  <span style=color:#f92672>newTag</span>: <span style=color:#ae81ff>3.6</span>
</code></pre></div><p>タグのところをリビジョン指定できればいいだけなのでとくに SECRET を使う必要もない。このやり方で書き換えた <code>newTag</code> が POD のデプロイ対象になってくれればよいはず。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0227/>ウクライナ情勢</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-27
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て7時に起きた。アニメみたりドラクエタクトしたりして11時ぐらいまでだらだらしてた。</p>
<h2 id=保険料率の変更>保険料率の変更</h2>
<p>毎年、社会保険の保険料率が変更されるのでその保険料の計算をして反映しないといけない。多くの会社は3月度の保険料は翌月払いとなるので4月からの反映となるが、うちの会社は当月締めの当月払いなので3月から反映させないといけない。</p>
<ul>
<li>健康保険料率: 10.24% → 10.13%</li>
<li>介護保険料率: 1.80% → 1.64%</li>
</ul>
<p>協会けんぽの来期の保険料率は下がるみたい。毎年少しずつ上がっていく一方だと思っていたのでそういうこともあるんだなという印象。</p>
<h2 id=ウクライナ情勢>ウクライナ情勢</h2>
<p>タイムラインを眺めていると、否応でもウクライナ情勢のニュースやコメントが流れてきてなんとなくみてしまって作業の手がつかなくなってしまった。早めに帰って仕切り直そうとしたけど、精神的に疲れてしまって休んでいた。sns の功罪はいろいろあるけど、ネガティブな情報にたくさん触れるのはなかなかしんどいな。何だったかもう忘れたけど、前にもこんなことがあった気がする。そういうときは sns を見ない方がよいのだろうけど、何もしないでいると気になってついつい見てしまう。情報があり過ぎることも問題なんだなとつくづく実感する。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0226/>github deployments の調査</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-26
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/github/>github</a>&nbsp;
</span>
<div class=post-content>
<p>22時に寝て23時半に起きて1時に寝て6時に起きた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>先週に引き続き、右太もも後ろの張り感が強い。もしかしたらここ2-3週間、長時間机に向かっていることが増えて負担がかかっているのかもしれない。2月は寒いから帰って散歩やジョギングすることもなくて余計に筋肉をほぐすこともできていない。今日の開脚幅は開始前164cmで、ストレッチ後160cmで先週と変わらないぐらいだった。調子がよくなかったのか、ストレッチ後にあまり開脚できなかった。たまにこういうときもある。</p>
<h2 id=github-deployments-の調査>github deployments の調査</h2>
<p>github actions を実行するにはなんらかのトリガーが必要なことから、デプロイのためのトリガーに使えそうなものはないかを <a href=https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows>Events that trigger workflows</a> で調べていたら <code>deployment</code> と <code>deployment_status</code> というイベントがあることに気付いた。</p>
<p>わりと最近できた仕組みで <a href=https://docs.github.com/en/rest/reference/deployments>github deployments</a> という api 群が提供されている。一度ベーダとして出したものの、アルファレベルだったせいか、gh cli でも専用コマンドとして機能追加されていないし、github の slack インテグレーションでも一度提供した deploy サブコマンドを削除するみたいなことが発生している。まだ設計やインタフェースが使いやすいものではないから作り直すみたいな状況にみえる。とはいえ、rest api は提供されているので現状の機能のまま github actions のトリガーとして使う分には問題なさそう。</p>
<ul>
<li><a href=https://github.com/cli/cli/issues/921>https://github.com/cli/cli/issues/921</a></li>
<li><a href=https://github.com/integrations/slack/issues/1150>https://github.com/integrations/slack/issues/1150</a></li>
</ul>
<p>ビルドとデプロイを分離するにあたって、デプロイのためのトリガーが github 上のサービスとしてみつかったのはよかったと言える。github deployments は現状では中途半端なサービスという位置づけにみえる。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>github はどこまでいってもリポジトリ単位というのがボトルネックになるからリポジトリをグルーピングする概念を他のサービスで一貫して扱えるようにならないとサードパーティに頼る場面はまだまだありそうかな。</p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1497458295602544641?ref_src=twsrc%5Etfw">February 26, 2022</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0225/>主作用による副作用</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-25
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/communication/>communication</a>&nbsp;
#<a href=/diary/tags/issue-tracking-system/>issue tracking system</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て4時半に起きた。6時から金朝ツメトギを聞きながら途中で寝てしまって7時過ぎに起きた。</p>
<h2 id=コミュニケーションについての記事を書く>コミュニケーションについての記事を書く</h2>
<p>以前 <a href=/diary/posts/2022/0107/#情報共有とコミュニケーションコスト>コミュニケーションコストに考えたこと</a> をベースに、<a href=/diary/posts/2022/0130/#3ヶ月フィードバック完了>3ヶ月フィードバック</a> の一節としてお手伝い先の社内 wiki に書いた。コミュニケーション一般の話なので私の考えを伝えられるよう、社外秘の部分を削除してブログにまとめておくことにした。ちょっと書き始めたところ、また週末にでも時間があるときに少しずつ推敲したり、洗練させて自身の考えを整理していく。現状でも悪い内容ではないけれど、まだしっくり来ていないところもあって、そのもやもやも見直していきたい。</p>
<h2 id=課題管理の特性>課題管理の特性</h2>
<p>課題管理システムにチケットを作成すると fix しない限り、そのチケットは永遠に残り続ける。未着手の状態でずっと放置することもできるが、それは対応を先送りしているだけで完了するわけでもない。チケットの対応方法として <strong>wontfix</strong> という選択肢が非常に重要になる。問題があることはわかっていたとしても様々な理由で対応しないという判断はありえる。誰がどういう理由でその判断を下したかという背景や意図さえわかれば、仮に将来的にその問題が看過できない状態になったとしても、過去の判断から新たな対応方法を検討したり、その判断の是非をふりかえることができる。これはチケットを作らずに見てみぬふりをして将来同じことが起きるのとは全く異なる知見が積み重なるので非常に重要な意思決定であると私は考えている。</p>
<p>閑話休題。話しがズレた。ここで fix せずにずっと放置するメンバーもいたりする。様々な理由で課題管理に非協力的な姿勢をとるメンバーがいる。少なからずいる。そういう人を放置すると、真面目に課題管理をやっている人たちが腐ってしまうので、課題管理の専門家を自称する私としては看過できない状況と言える。最初のうちは非協力的なメンバーにお願いしてやってもらうわけだけど、やってくれない人はずっとやってくれない。それを言い続けるのも嫌になるので別の対応方法が求められる。私の経験則では若い人に非協力的なメンバーはほぼいない。いまの若い人は優秀なので上司や先輩のやり方をみて勝手にやる人もいるし、ちゃんと教えれば教えた通りにやってくれる。非協力的なメンバーは往々にしてそれなりの経験をもっている中堅以上の社会人に多い。実はお仕事をさぼっていてあまり作業していないとか、課題管理に馴染みがなければ、それまでの自分の仕事のやり方をアンラーニングできないという人もいるかもしれない。理由はともかく、お願いしてもやってくれない人のチケットが課題管理プロセスの中で浮いてみえてくる。他のメンバーが腐る前に対応しないといけない。私の経験則ではこれはすごく難しい問題であるし、非協力的なメンバーそれぞれの理由にあわせて対応する必要があるので工数もかかる。</p>
<p>課題管理をしたくないというメンバーの中には何らかの理由で自律的に働きたくないという人もいる。課題管理というプロセスにおいては、そういった人たちをあぶり出してしまうため、状況によってはとても難しい人間関係の問題へと発展してしまう。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0224/>継続的デリバリーへの第一歩</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-24
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。</p>
<h2 id=docker-object-labels-と-git-リビジョン>docker object labels と git リビジョン</h2>
<p>継続的デリバリーのために snapshot jar のマニフェストから取得した git のリビジョンを docker イメージの <a href=https://docs.docker.com/config/labels-custom-metadata/>labels</a> に追加するサンプルコードを <a href=https://github.com/t2y/jib-sample>jib-sample</a> に実装してみた。jib の gradle プラグインを作って簡略化すれば便利かもしれない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0223/>java アプリケーションの継続的デリバリー</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-23
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て3時に起きて6時ぐらいまでだらだらして寝て7時に起きた。</p>
<h2 id=snapshot-jar-と継続的デリバリー>snapshot jar と継続的デリバリー</h2>
<p>昨日 <a href=/diary/posts/2022/0222/#jar-ファイルと-git-のリビジョン>jar に git のリビジョン番号を含める</a> ことについて書いた。jar から git のリビジョン番号を取得できれば、docker イメージを生成するときに <a href=https://docs.docker.com/config/labels-custom-metadata/>labels</a> に jar の artifact id と git のリビジョン番号のラベルを追加して、docker イメージからもソースコードの追跡ができるようになる。いまデプロイは docker イメージのみで運用しているため、maven のバージョン管理ができなくても docker イメージの追跡可能性さえあれば現実の運用で問題にならないのではないかと考えた。つまり、snapshot jar で開発したものをそのまま本番環境にデプロイするということを意味する。こうすれば特定のバージョン番号を付けるだけのビルドとデプロイが不要になって、テスト環境にデプロイされた docker イメージのテストを完了すれば、そのイメージをいつでも本番環境にデプロイできるようになる。デプロイするタイミングでビルドする必要がなくなるので継続的デリバリーに近づくのではないかと考えた。</p>
<p>今日、開発の偉い人やインフラ担当者も含めて、みんなでわいわい打ち合わせして、現状の開発では、インターフェースや互換性の変更にあわせてバージョン番号を付けていないし、古いバージョンに戻すことも現実にはなく、保守は常に最新のリビジョンを更新していくから maven でバージョン管理できなくなっても snapshot jar の運用でがんがん開発していけばいいんちゃうという合意を得られた。</p>
<p>実際にこのやり方がうまくいくかどうか、私も初めての試みなのでやってみないとわからないが、この運用によるワークフローの効率化のメリットも大きいので、引き続き、イニシアティブをもって取り組んでいきたい。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0222/>jar のマニフェストファイル</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-22
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て3時に起きて5時に起きて6時半に起きた。</p>
<h2 id=jar-ファイルと-git-のリビジョン>jar ファイルと git のリビジョン</h2>
<p>java パッケージのフォーマットとして jar ファイルがある。開発中の jar ファイルは snapshot という特別なバージョンで管理したりするが、この snapshot と git のリビジョンが対応していないので snapshot jar だけではどのリビジョンのソースからビルドされたかがわからない。jar には <a href=https://docs.oracle.com/javase/10/docs/specs/jar/jar.html>JAR File Specification</a> で定義された <code>META-INF/MANIFEST.MF</code> に任意のメタデータを保持できる。maven なら <a href=https://github.com/git-commit-id/git-commit-id-maven-plugin>maven git commit id plugin</a> と <a href=https://github.com/apache/maven-jar-plugin>Apache Maven JAR Plugin</a> を組み合わせれば、ビルド設定だけで git のリポジトリ情報を任意のメタデータとして jar に含めることができる。試しにプラグインの検証も兼ねてやってみた。例えば、次のようなマニフェストを作れる。</p>
<pre tabindex=0><code>Manifest-Version: 1.0
Created-By: Apache Maven 3.6.3
Built-By: t2y
Build-Jdk: 11.0.13
Specification-Title: My Nice Product
Specification-Version: 1.0
Artifact-Id: my-product
Build-Time: 2022-02-21T11:39:07Z
Git-Branch: main
Git-Commit-Id: 81a4642
Git-Commit-Time: 2022-02-21T19:39:30+0900
Git-Commit-User: Tetsuya Morimoto
</code></pre><p>java のコードからマニフェストを取得するサンプルコードはこんな感じ。ググるといくつかやり方があるようなので他の実装もある。但し、このコードだと複数の jar のマニフェストを取得してしまうので、あとで自分がみたい jar のマニフェストをフィルターする処理が必要になる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String MANIFEST_PATH <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;META-INF/MANIFEST.MF&#34;</span><span style=color:#f92672>;</span>

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Manifest<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getManifests</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException<span style=color:#f92672>,</span> URISyntaxException <span style=color:#f92672>{</span>
    var map <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Manifest<span style=color:#f92672>&gt;();</span>
    var resources <span style=color:#f92672>=</span> MyUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getClassLoader</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getResources</span><span style=color:#f92672>(</span>MANIFEST_PATH<span style=color:#f92672>);</span>
    <span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span>resources<span style=color:#f92672>.</span><span style=color:#a6e22e>hasMoreElements</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
        var elem <span style=color:#f92672>=</span> resources<span style=color:#f92672>.</span><span style=color:#a6e22e>nextElement</span><span style=color:#f92672>();</span>
        var part <span style=color:#f92672>=</span> elem<span style=color:#f92672>.</span><span style=color:#a6e22e>toURI</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getSchemeSpecificPart</span><span style=color:#f92672>();</span>
        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>part <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>try</span> <span style=color:#f92672>(</span>var stream <span style=color:#f92672>=</span> elem<span style=color:#f92672>.</span><span style=color:#a6e22e>openStream</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
                map<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>part<span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> Manifest<span style=color:#f92672>(</span>stream<span style=color:#f92672>));</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
    <span style=color:#66d9ef>return</span> map<span style=color:#f92672>;</span>
<span style=color:#f92672>}</span>
</code></pre></div>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0221/>祝日の勤怠</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-21
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/communication/>communication</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て6時半に起きた。昨日は夕方に一旦帰ってきて仮眠したらまた作業しようと思っていたけど、なんかバテてそのままだらだらしてた。</p>
<h2 id=カレンダー共有と祝日>カレンダー共有と祝日</h2>
<p>お手伝い先の社員さんと開発メンバーとのお休みがあわない問題が気になるようになってきた。というのは、お手伝い先は基本的に祝日は営業日として扱われている。おそらくは祝日に働いたら手当がつくのか、代休を別の日にとっているようにみえる。祝日に働かずに休む社員もいる。祝日に休むという表現もおかしいが。業務委託の開発メンバーは原則として祝日は休んで普通の日に働く。ここで社員さんが祝日に働いて普通の日に代休をとると、休みが異なるのでコミュニケーションコストが高くなる。お互いが働いている時間が減ることでその時間に対する価値が高くなってしまうという話し。国が違わない限り、あまりそういう状況は発生しないので、休日をあわせることの重要性を再認識した。</p>
<p>さらに働き始めた頃から気になっている <a href=/diary/posts/2022/0105/#ふりかえり>カレンダー共有の問題</a> がある。休みが異なる可能性が高いのにメンバーのカレンダーはばらばらなので、お休みするという報告をもらっていても日が経つと忘れてしまっていて、slack でメンションをしてしまう場合がある。金曜日に月曜日はお休みすると聞いていたけど、月曜日になったら忘れてたみたいな。お休みしている社員さんに普通にメンションして、普通にやり取りしていて、あとでお休みだったと気付いて申し訳なく思った。カレンダーを確認してお休みだとわかっていれば slack でメンションはしなかった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0220/>2021年度の確定申告</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-20
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/docker/>docker</a>&nbsp;
#<a href=/diary/tags/jib/>jib</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。</p>
<h2 id=確定申告>確定申告</h2>
<p>本当は9時から受け付けなんだけど、昨年早めに行ったら受け付けしてくれたので今年も8時半ぐらいから出掛けていった。家から徒歩5分のところに特設の申告会場があって、行ったらすでに100人ぐらいは並んでいた。整理券を配るために行列を誘導している係員に「書類は作成済みで提出だけです」と伝えると「どうぞ、こちらへ」と行列をショートカットして、書類の作成会場の横にある提出会場へ案内される。朝一なので誰も提出してなくてすぐに応対してくれた。書類チェックして提出完了。会場についてから提出するまでに5分。あわせて10分もあれば確定申告できる。電子申告してもよいのだけど、寄付金の領収書の電子化が面倒なのでまだ紙で申告している。寄付金の領収書が電子化されて添付できるような手軽さになったら電子申告してもよいかもしれない。</p>
<h2 id=github-container-action-の検証>github container action の検証</h2>
<p><a href=https://github.com/GoogleContainerTools/jib>jib</a> という java アプリケーション向けの docker イメージをビルドするためのツールがある。お仕事で使い始めたので雰囲気を理解するために私もサンプルアプリケーションを <a href=https://github.com/t2y/jib-sample>jib-sample</a> として作ってみた。簡単に設定して java アプリケーションを docker 化できるので感触はよさそう。基本的に java アプリケーションと docker は相性が悪くて、たぶん go で開発するような用途と比較するとサイズがめちゃくちゃでかい。それでも jib を使うと作成された docker イメージのサイズも自分でビルドして作るよりは小さくしてくれる。さすが google という感じ。</p>
<p>この jib-sample の docker イメージを使って github actions のカスタム container action を作ってみたのが <a href=https://github.com/t2y/gh-actions-container-sample>gh-actions-container-sample</a> になる。<a href=https://docs.github.com/en/actions/creating-actions/creating-a-docker-container-action>Creating a Docker container action</a> のドキュメントには Dockerfile を使ったサンプルしか紹介されていないけど、docker イメージを直接参照して利用することもできる。</p>
<p>検証作業をしているときに jib-sample リポジトリの github packages が private 設定になっていることに気付かなくて少しはまった。リポジトリの visibility 設定と github packages の visibility 設定は連動していないのでそれぞれで別に管理しないといけない。</p>
<p>また jib で作った docker イメージはデフォルトでは manifest を作ってくれない。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ docker manifest inspect --verbose ghcr.io/t2y/jib-sample:latest
no such manifest: ghcr.io/t2y/jib-sample:latest
</code></pre></div><p><a href=https://github.com/GoogleContainerTools/jib/blob/master/docs/faq.md#how-do-i-specify-a-platform-in-the-manifest-list-or-oci-index-of-a-base-image>How do I specify a platform in the manifest list (or OCI index) of a base image?</a> のドキュメントによると、manifest に platform 情報を追加するのは incubating feature らしくて、なんか条件付きで設定すれば使えそうにもみえたんだけど、私がやってみた感じだとうまくいかなかった。また必要ならもう一度調べてみる。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0219/>docker の勉強</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-19
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/docker/>docker</a>&nbsp;
#<a href=/diary/tags/github/>github</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>ここ1ヶ月ほどお仕事に集中しているのもあるけど、あまりストレッチに意識を割いていない。やるときは集中して注力するのだけど、飽きてくると怠ける性格的なところがある。とはいえ、やめずに続けているといいことがあると経験則からわかっているのでなるべく継続していきたい。今週も特別なことはなにもしていないのだけど、右足の股関節周りに張りがあってあまり調子がよくなかった。今日の開脚幅は開始前163cmで、ストレッチ後167cmで先週よりも数値が悪化している。良くなるときもあれば悪くなるときもある。毎週ストレッチを受けて計測しているとそういう気付きがあること自体、この機会は健康のために役立っているように考えている。</p>
<h2 id=github-packages-で-docker-イメージを公開する>github packages で docker イメージを公開する</h2>
<p>docker が流行りだした頃に勤めていた会社の貸与端末が docker 禁止だったので私は docker に乗り遅れて、これまでも誰かが用意してくれたコンテナを使うだけでよかったため、最低限の docker コマンドや docker-compose の使い方しか知らなかった。ちょうどインフラの運用を見直す過程で docker コンテナの作成方法から見直すお仕事ができたのでこの機にいろいろ勉強する。いまどき当たり前なんだろうけど、docker の <a href=https://matsuand.github.io/docs.docker.jp.onthefly/develop/develop-images/multistage-build/>マルチステージビルド</a> をやってみる。</p>
<p>最初に go のバイナリを選択したのは間違いだったのかもしれない。go のビルド環境を作るベースイメージの選択が難しくて、ビルドはできるけど、作成したバイナリが動かないという状況にはまった。<a href=https://dev.classmethod.jp/articles/how-to-fix-standard-init-linux-error/>ECSのタスク起動時に「standard_init_linux.go」関連のエラーが出た場合の対処方法</a> であるように、いろんな不具合がある。ベースイメージの選択やビルドに必要なライブラリがないとそういうエラーになるんだと気付くまでに時間がかかった。</p>
<p>最終的に次のような <a href=https://github.com/kazamori/go-sql-executor/blob/main/Dockerfile>Dockerfile</a> でマルチステージビルドができた。builder としてのベースイメージの選択によってやり方はいろいろ変わってくるように思える。</p>
<pre tabindex=0><code>FROM golang:alpine as builder
RUN apk add --no-cache git make gcc musl-dev
WORKDIR /work
COPY . .
RUN go mod download
RUN make build

FROM alpine:latest
WORKDIR /
COPY --from=builder /work/bin/sql-executor .
CMD [ &quot;/sql-executor&quot; ]
</code></pre><p>Dockerfile ができたら <a href=https://docs.github.com/en/actions/publishing-packages/publishing-docker-images>Publishing Docker images</a> を読みながら github actions で自動的に docker イメージを github packages に公開する設定をやってみた。リリースを作成したときに docker イメージをビルドして公開する <a href=https://github.com/kazamori/go-sql-executor/blob/main/.github/workflows/publish.yml>workflow yml</a> を作成した。ほとんどドキュメントのまま。</p>
<p>github actions の実行結果。</p>
<ul>
<li><a href="https://github.com/kazamori/go-sql-executor/runs/5258037718?check_suite_focus=true">https://github.com/kazamori/go-sql-executor/runs/5258037718?check_suite_focus=true</a></li>
</ul>
<p>github packages 上で公開された docker イメージ。</p>
<ul>
<li><a href=https://github.com/kazamori/go-sql-executor/pkgs/container/go-sql-executor>https://github.com/kazamori/go-sql-executor/pkgs/container/go-sql-executor</a></li>
</ul>
<p>リリースのタイミングじゃなくてコミットのタイミングでも docker イメージを生成できると思うけど、docker イメージのタグに相当するものをどう付けるかというところは工夫する必要がありそう。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0218/>予算作り</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-18
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て1時半に起きてそのまま断続的に寝て起きての繰り返しで6時に起きた。本当は非稼働日だけど、昨日作った pr の機能を検証するための環境を用意してもらったのでそれを動かしたら要件漏れに気付いてその改修をやってた。</p>
<h2 id=隔週の雑談>隔週の雑談</h2>
<p>顧問のはらさんと隔週の打ち合わせの日。今日の議題は2つ。</p>
<h3 id=見積もりの雑談>見積もりの雑談</h3>
<p>先日、見積もりについての <a href=/diary/posts/2022/0213/#見積もりのまとめ>私の考え</a> を整理した。それについて第3者の意見も聞いてみたいと考えた。</p>
<p>いろいろ雑談したけど、結論としてはバーンダウンチャートもストーリーポイントも運用が形骸化したら役に立たないという当たり前の話しになった。従来の期限や工数を見積もる方法と比較して得られるメリットはそう多くないという私の印象である。ストーリーポイントが優れている唯一の点は、タスクの見積もりについて話し合う場ができるという、その機会そのものがあげられる。その機会を使ってメンバーとの情報共有や教育の場にもできるという点がある。それ以外のところでストーリーポイントのメリットはさしてないと私は感じた。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>ストーリーポイント(以下SP)について雑談していて、あるチームでは事前に見積もったSPをタスク完了後に実績ベースで上書きする運用をしていたという。その理由は見積もったSPに対して進捗や実績が悪いと偉い人からお叱りを受けるため、SPが正しくなかったという解釈で実績から変更しているという。</p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1494511584378769408?ref_src=twsrc%5Etfw">February 18, 2022</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<h3 id=来期の予算策定>来期の予算策定</h3>
<p>ざっくり試算すると来期は少し赤字になる。経営者として赤字にならないようの対策を講じる。私が予め用意した施策は次の3つ。</p>
<ol>
<li>既存顧客のお仕事の単価をあげる</li>
<li>赤字分の売上を別のお仕事で稼ぐ</li>
<li>赤字分の経費を削減する</li>
</ol>
<p>はらさんから役員報酬を下げてはどうか？という提案もあったけど、これは却下しようと思う。もともと役員報酬は高くないし、役員報酬を下げると必然的に健康保険や社会保険の再計算やそれらに関連する事務手続きが発生する。いま私は会計士も税理士も雇わず自分ですべてやっているのだけど、専門家に依頼するにしろ、自分でやるにしろ、経費を下げるために別の経費を発生させてしまう。これは本末転倒な気がしてやりたくない。</p>
<p>したがって、お仕事の単価をあげる交渉からまず始めることにする。私はずっと開発者で働いてきたから交渉ごとはほとんど経験がない。交渉の経験を積むという側面でも自分のキャリアにとって新しい取り組みになってよいと考えている。次の契約更新は3月末になるのでそれまでに交渉のための準備を進めていく。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0217/>Mockito を触ってみた</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-17
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/mock/>mock</a>&nbsp;
#<a href=/diary/tags/testing/>testing</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て4時に起きて6時に起きた。6時過ぎに slack でインフラ担当者から作業の報告があってその対応してた。</p>
<h2 id=mockito-のモック作成>Mockito のモック作成</h2>
<p><a href=https://www.baeldung.com/spring-5-webclient>Spring 5 WebClient</a> のテストコードを書いてみた。<a href=https://site.mockito.org/>Mockito</a> というモックライブラリを使っているのをみかけたのでそれを使うことにした。当初は WebClient そのもののモックを用意して、どんなメソッドを呼び出しても Null オブジェクトのように無視すればいいんじゃないかと思ってたんだけど、Mockito はそういう用途に使うものではなく、それぞれのメソッドごとにモックを返すような設定ができる。次のような WebClient のメソッドチェーンでリクエストするようなモックを考える。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>var response <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>client</span>
        <span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>()</span>
        <span style=color:#f92672>.</span><span style=color:#a6e22e>uri</span><span style=color:#f92672>(</span>uriBuilder <span style=color:#f92672>-&gt;</span> uriBuilder
                <span style=color:#f92672>.</span><span style=color:#a6e22e>path</span><span style=color:#f92672>(</span>path<span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>queryParam</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;param&#34;</span><span style=color:#f92672>,</span> param<span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>())</span>
        <span style=color:#f92672>.</span><span style=color:#a6e22e>retrieve</span><span style=color:#f92672>()</span>
        <span style=color:#f92672>.</span><span style=color:#a6e22e>bodyToMono</span><span style=color:#f92672>(</span>MyResponse<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)</span>
        <span style=color:#f92672>.</span><span style=color:#a6e22e>block</span><span style=color:#f92672>();</span>
</code></pre></div><p>他にもっとよいやり方があるかもしれないけど、私がよくわかってなくてこんなやり方しかできなかった。最終的には <code>block()</code> を呼び出したときに任意のレスポンスを取得できればよいのだけど、メソッド単位にモックを呼び出していかないと型チェックやら実行時エラーやらで意図したようにテストできなかった。これだけをみたらメソッドチェーンのモック作りは面倒にみえる。Mockito がどうやってこれを実現しているのかわからないけど、すごい仕組みだなとは思った。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#a6e22e>@MockBean</span>
    WebClient client<span style=color:#f92672>;</span>
    <span style=color:#a6e22e>@Mock</span>
    WebClient<span style=color:#f92672>.</span><span style=color:#a6e22e>RequestHeadersUriSpec</span> requestHeadersUriSpec<span style=color:#f92672>;</span>
    <span style=color:#a6e22e>@Mock</span>
    WebClient<span style=color:#f92672>.</span><span style=color:#a6e22e>RequestHeadersSpec</span> requestHeadersSpec<span style=color:#f92672>;</span>
    <span style=color:#a6e22e>@Mock</span>
    WebClient<span style=color:#f92672>.</span><span style=color:#a6e22e>ResponseSpec</span> responseSpec<span style=color:#f92672>;</span>
    <span style=color:#a6e22e>@Mock</span>
    Mono<span style=color:#f92672>&lt;</span>MyResponse<span style=color:#f92672>&gt;</span> mono<span style=color:#f92672>;</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>mockWebClientMethodChain</span><span style=color:#f92672>(</span>MyResponse response<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        Mockito<span style=color:#f92672>.</span><span style=color:#a6e22e>when</span><span style=color:#f92672>(</span>client<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>thenReturn</span><span style=color:#f92672>(</span>requestHeadersUriSpec<span style=color:#f92672>);</span>
        Mockito<span style=color:#f92672>.</span><span style=color:#a6e22e>when</span><span style=color:#f92672>(</span>requestHeadersUriSpec<span style=color:#f92672>.</span><span style=color:#a6e22e>uri</span><span style=color:#f92672>((</span>Function<span style=color:#f92672>&lt;</span>UriBuilder<span style=color:#f92672>,</span> URI<span style=color:#f92672>&gt;)</span> Mockito<span style=color:#f92672>.</span><span style=color:#a6e22e>any</span><span style=color:#f92672>())).</span><span style=color:#a6e22e>thenReturn</span><span style=color:#f92672>(</span>requestHeadersSpec<span style=color:#f92672>);</span>
        Mockito<span style=color:#f92672>.</span><span style=color:#a6e22e>when</span><span style=color:#f92672>(</span>requestHeadersSpec<span style=color:#f92672>.</span><span style=color:#a6e22e>retrieve</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>thenReturn</span><span style=color:#f92672>(</span>responseSpec<span style=color:#f92672>);</span>
        Mockito<span style=color:#f92672>.</span><span style=color:#a6e22e>when</span><span style=color:#f92672>(</span>responseSpec<span style=color:#f92672>.</span><span style=color:#a6e22e>bodyToMono</span><span style=color:#f92672>(</span>MyResponse<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)).</span><span style=color:#a6e22e>thenReturn</span><span style=color:#f92672>(</span>mono<span style=color:#f92672>);</span>
        Mockito<span style=color:#f92672>.</span><span style=color:#a6e22e>when</span><span style=color:#f92672>(</span>mono<span style=color:#f92672>.</span><span style=color:#a6e22e>block</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>thenReturn</span><span style=color:#f92672>(</span>response<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
</code></pre></div>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0216/>ふりかえりとプランニング</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-16
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/ssue-tracking-system/>ssue tracking system</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て3時過ぎに起きて6時半に起きた。</p>
<h2 id=ふりかえり>ふりかえり</h2>
<p>今日はスクラムのふりかえりとプランニングの日。1週間が終わり始まる。ふりかえりをしていて、2週連続でスプリントゴールが未達になって、原因を追求する空気になって、最終的にはリーダーを糾弾するみたいな雰囲気になった。昔の私だったら論理的に問題を掘り起こそうとがんばったかもしれないけど、いまはもう歳をとってスラムダンクの安西先生みたいになったのか、もしくは外部パートナーとしてのお手伝いだから真剣ではないのか、その両方かもしれないが、一歩引いたところからできなかったもんしゃーないんちゃう？みたいな心境で見守っていた。うまくできない人や状況に「なぜできなかった？」みたいに迫ると「努力が足りなかった」とか「もっとがんばります」みたいなやり取りしかならないので不毛にみえる。経営者のくせにこんなことを言うと怒られるかもしれないが、仕事なんてやりたい人やできる人が楽しめるように好き勝手やって、そうじゃない人は最低限やるとか、邪魔しないように配慮するとか、もうそれでいいんじゃないとか思ったりもしている。もう人類は会社の半分ぐらいの社員が遊んでても暮らしていけるぐらいの生産性を手に入れたと思うよ。半分は言い過ぎか。いずれにしても私はもう無理なく自分のペースで働きたいと思うようになった感じ。</p>
<h2 id=backlog-の管理者権限>backlog の管理者権限</h2>
<p>お手伝い先で <a href=https://backlog.com/ja/>backlog</a> を課題管理システムに使っている。私は課題管理システムのスペシャリストとして、ああしたい、こうしたいといくつも注文を付けて、チームの開発やワークフローを改善している。これまでは管理者権限がなかったのでもっている人に依頼するしかなかったけど、そろそろ私の相手をするのが面倒くさくなってきたのか、私にも backlog の設定を変更する管理者権限をもらえた。さっそくカスタム属性をいくつか作って実験的な検証をしていた。カスタム属性は backlog のフリープランでは使えない機能なので、お手伝い先の実地で用途や振る舞いを検証するしかない。同じプロジェクトでも種別ごとにカスタム属性の設定有無を切り分けられる機能があって、この機能は他の課題管理システムでみたことがない実用的で珍しい機能だと思った。チケットに PR とコミットのカスタム属性を追加して、github actions でコミットや PR のタイミングでそれらの属性に URL を追加すれば github 連携もできそうな気がしてきたところ。週末に時間があったら作ってみる。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0215/>担々麺がおいしい</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-15
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/food/>food</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て4時に起きて6時半に起きた。今回のスプリントは1つの機能拡張のチケットに専念していてとても疲れた。</p>
<h2 id=担々麺>担々麺</h2>
<p>オフィスの近くに <a href=https://tabelog.com/hyogo/A2801/A280102/28061761/>珠しっぴん</a> という坦々麺専門店ができているのに気付いた。半年ぐらい前にオープンしたらしい。あまり通らない場所だったせいか、全然気付いてなくて試しに入ってみたら私の好みの味でとてもおいしかった。食わず嫌いだったのか何なのか、昨年ぐらいまで担々麺はほとんど食べたことなかったんだけど、近所においしい担々麺のお店がいくつかできて、担々麺そのものも好きになってきた。新しい担々麺のお店をみかけるととりあえず入ってみるようになった。</p>
<h4 id=珠辛担々麺>珠辛担々麺</h4>
<figure><img src=/diary/img/2022/0215_noodle1.jpg>
</figure>
<h4 id=汁なし担々麺>汁なし担々麺</h4>
<figure><img src=/diary/img/2022/0215_noodle2.jpg>
</figure>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0214/>取材商法というビジネス</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-14
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/business/>business</a>&nbsp;
</span>
<div class=post-content>
<p>1時半に寝て5時半に起きた。いよいよ眠れなくなった感じだな。</p>
<h2 id=取材商法の営業>取材商法の営業</h2>
<p>会社の問い合わせのメールアドレスに取材させてほしいといった問い合わせが届いた。うちみたいな無名の零細会社になんの前触れもなく届く問い合わせの大半は営業に関するもの。</p>
<blockquote>
<p>※撮影・インタビュー記事の掲載にあたりまして、費用等は一切発生しませんので、ご安心くださいませ。</p>
<p>WEBにて、お写真と記事でご紹介させていただきたいと考えております。</p>
</blockquote>
<p>こんな感じで取材の費用はいりませんと言っている。<a href=https://marketing.idegene.com/%E8%A8%98%E4%BA%8B%E5%BA%83%E5%91%8A_%E5%8F%96%E6%9D%90%E5%95%86%E6%B3%95_%E9%9B%91%E8%AA%8C%E6%8E%B2%E8%BC%89%E3%81%AF%E5%8A%B9%E6%9E%9C%E7%9A%84>記事広告と取材商法(タレントインタビュー)で雑誌掲載の効果は？</a> によると、取材は無料かもしれないが、メディアや雑誌といった媒体に掲載するのに料金を請求するらしい。まさにこの記事で書かれている会社からのメールだ。取材して記事ができてしまうとサンクコストが気になって掲載料を支払ってしまうような心理を利用しているのだと推測する。</p>
<p>いろんなビジネスがあるなぁと世の中の勉強になった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0213/>java のコードレビューサービス</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-13
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/refactoring/>refactoring</a>&nbsp;
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/issue-tracking-system/>issue tracking system</a>&nbsp;
</span>
<div class=post-content>
<p>22時に寝て0時に起きて5時に起きて7時に起きた。なんか体調が微妙。</p>
<h2 id=リファクタリングのチケット作成>リファクタリングのチケット作成</h2>
<p>これまでは業務に関係しないところの機能拡張をしていたので新規にコードを書くことが多かった。いま業務の開発にも着手し始め、その過程で既存のコードを読むことも多くなった。私からみたらコードの品質が著しく低くて、ただ動いているだけで堅牢でもないし、設計の意図も伝わらないコードが多い。そういうのを自分が変更するときに少しずつ出来る範囲でリファクタリングしたりしている。今日もコードを読んでいて enum の扱いについてチケットを作成した。</p>
<p>前に手伝っていた会社の契約を終了するときに java のコードレビューだけなんらかの契約で依頼できないかという話しはあった。そのときは別件のお仕事が火の車だったので断ってしまった。いまお手伝いしている java のコードをみても、java に慣れていない開発者の書く java のコードはたいていひどい。なぜひどくなるかというと、java は言語仕様が複雑で難しいからだと思う。java の経験が少ないと Effective Java を読んでも理解できないぐらいには java の設計は難しい。その結果として java で開発しているのに設計を練っておらず「動けばいい」コードが散見される。java で開発するなら「これ以外に動かない」コードを書いた方がよいと私は考えている。その意図が伝わるからドキュメントなんか読まなくても「動かすにはこう書けばいい」とわかる。さらにインターフェースが明確であれば、責務や拡張方法も明示的になる。</p>
<p>前から考えてはいたけど、sier や内製始めたばかりの事業会社向けに java のコードレビューのサービスを提供することも考えている。私1人だとたくさん受けられないし、コードレビューサービスのようなものは会社の信頼関係の方が重要なのでビジネスにするのはちょっと難しいかもなぁ。</p>
<h2 id=見積もりのまとめ>見積もりのまとめ</h2>
<p>先日 <a href=/diary/posts/2022/0205/##見積もりとは>見積もりについて考察した</a> 。もともとは社内向けに書こうと書き始めたが、内容の大半は社内に閉じたものではなかったので一般論の記事として書き直した。最終的には1万文字ぐらい書いた。</p>
<ul>
<li><a href=https://t2y.hatenablog.jp/entry/2022/02/13/191235>見積もりをがんばらない</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0212/>mysql のデータ移行</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-12
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/docker/>docker</a>&nbsp;
#<a href=/diary/tags/mysql/>mysql</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て2時前に起きて5時に起きて8時に起きた。あんまり眠れなくなってきた。</p>
<h2 id=もくもく会>もくもく会</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/235747/>【三宮.dev】もくもく会</a> に参加した。もともとオフラインの予定だったけど、オミクロン株の流行でオンラインに変更された。</p>
<p>お仕事である開発環境の構築をしていて docker-compose を使って mysql の環境構築や共有の開発環境にある db2 に接続するために <a href="https://www.ibm.com/docs/en/db2/10.5?topic=commands-command-line-processor-plus-clpplus">clpplus</a> のインストール方法などを wiki にまとめてた。コンテナにある mysqldump や mysql コマンドを使ってこんな風にデータ移行もできた。</p>
<p>共有の開発環境からデータをエクスポート。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ docker-compose exec -T mydb mysqldump -h $DB_HOST -C --set-gtid-purged<span style=color:#f92672>=</span>OFF --skip-triggers $DB &gt; dump.sql
</code></pre></div><p>ローカルの mysql にデータをインポート。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ docker-compose exec -T mydb mysql -h localhost -u root -proot $DB &lt; dump.sql
</code></pre></div><blockquote class=twitter-tweet><p lang=ja dir=ltr>コンテナにある mysqldump と mysql コマンドを使ってデータのインポートするには -T を指定すればいいみたい。そうしないと WARNING とかの文字列が sql ファイルに含まれてしまってインポートできない。<a href=https://t.co/JGeDNsWjhx>https://t.co/JGeDNsWjhx</a></p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1492391598612959234?ref_src=twsrc%5Etfw">February 12, 2022</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<h2 id=ストレッチ>ストレッチ</h2>
<p>いつもは11時からなんやけど、今日は17時40分からだった。カレンダーの予定を変更し忘れてて11時に行って間違えた。今週は2日間ぐらいストレッチしたかな。今日の開脚幅は開始前164cmで、ストレッチ後168cmだった。いつも時間帯が違うので数値も変わる。今日は右太ももの内転筋や内側やらがすごく張ってた。あまり調子はよくない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0211/>docker の勉強</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-11
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/docker/>docker</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て2時過ぎに起きて5時に起きて6時に起きた。珍しく3回ぐらい起きた。</p>
<h2 id=docker-のマルチステージビルド>docker のマルチステージビルド</h2>
<p>これまで docker を使った開発を主導してこなかったので私はあまり docker についての知識をもっていない。いま k8s クラスターで java アプリケーションの運用をしていて、リリース作業の改善には docker イメージのビルドも改善する必要性が迫られてきた。いくつかプラクティスの記事を読んでいると <a href=https://matsuand.github.io/docs.docker.jp.onthefly/develop/develop-images/multistage-build/>マルチステージビルドの利用</a> を推奨している記事が多い。マルチステージビルドをうまく活用することで、docker イメージサイズの削減と日々の ci やビルド時間の短縮の2つを図れるようにみえる。docker の仕組みを学ぶちょうどよい機会なので主導的な立場でこの改善に着手しようと考えている。</p>
<h2 id=オフィス内覧>オフィス内覧</h2>
<p>オフィスの引っ越し調査のために <a href=https://www.erinserve.com/>エリンサーブ</a> に行ってきた。駅近でもなく市街でもなくちょっと辺鄙な海外沿いにあるせいか、他のレンタルオフィスと比べて全体的に広さに対する家賃は安く設定されている。案内をしてくれた代表の方が「狭い部屋で働かせたくない」といった想いを話されていたので、意図的に窮屈なスペースにならないように広めに設計されているらしい。</p>
<p>オープンスペースでそれぞれの席が別会社という作りは斬新な考えとも言えるし、お互いの信頼関係で成り立っているとも言える。例えば、パソコンのモニターや資料とか、近くを通ったらみえてしまうわけだし。そういったセキュリティも考慮して、一見さんのドロップインには対応していないという。利用者はお互いに面識のある一定の信頼関係を築ける人たちで構成されているらしい。なにか審査があるのかどうかわからないが、人間関係が苦手な人には向かないスペースにもみえる。私は1日のうちにテレビ会議を何度もやるのでオープンスペースだと顧客の情報を守る義務があるのと、そうじゃなくても周りにも迷惑がかかるので、1日のうちの何度も場所を変えてテレビ会議できる部屋に移動しないといけない。それがボトルネックだなと思えた。個室もいくつかみせてもらって、2人向けの窓のある個室があってよさそうにみえた。そこはテレビ会議しても問題ないとのこと。家賃も予算にあうものだった。</p>
<p>Dタイプ(3F)</p>
<ul>
<li>月額利用料: 66,000円</li>
</ul>
<p>Eタイプ(3F)</p>
<ul>
<li>デスクは2つ</li>
<li>月額利用料: 76,000円</li>
</ul>
<p>いまは他の会社が借りている状態だけど、空きが出たら教えてもらえるようにお願いして帰ってきた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0210/>スクラムの窮屈さ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-10
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時に起きてちょっとだらだらして7時ぐらいにはオフィスにいた。</p>
<h2 id=スプリントの期間とプランニング>スプリントの期間とプランニング</h2>
<p>いまスクラムのスプリントを1週間で運用している。スクラムのスプリントレビューをやっていて、今回のスプリントはスプリントゴールが未達となったという事実がありつつも、ある開発者が本来のスプリント計画にはなかった課題を少し工数を使ってやってしまってたという話題が出た。それはある機能開発の調査の過程でこういうツールがあると業務メンバーの作業効率が上がりそうだとわかって、それをヒアリングしていた開発者が PoC も兼ねてプロトタイプを作っているうちにすぐ運用で使えそうなベータレベルまで作ってしまったという話し。言うても2日ぐらいで作ったと思うのだけど、5日しかないスプリントで2日は40%という大きな工数を占める。スクラムマスターも否定はしなかったけど「スプリントの計画にないタスクに工数を割くのはよくないと、スクラムマスターの立場からはお小言を言わざるを得ない」と言及した。</p>
<p>先日、私も直接はスプリントの計画達成に直接寄与しない <a href=/diary/posts/2022/0208/#テストコードのリファクタリング>リファクタリングに半日を費やした</a> ので、ツールを作ってしまった開発者の気持ちはわかるなと無言で聞いていた。それと同時にスクラムのスプリントは、運用によっては開発者のモチベーションを削ぐことも実感した。やる気の有無で仕事をするのはよくないと一般論では言うけど、実際のところ、人間のモチベーションは制御が難しいのと、知識労働はモチベーションが生産性に大きな影響を与える。開発者のモチベーションが高いときにそのタスクをやるのは理に叶うという側面もある。非開発者は次のプランニングで承認を得て来週のスプリントでやればいいじゃないかと思うかもしれない。でも、違うのだ。いまやってみたいという気持ちが大きいときにいまやるのと来週やるのではモチベーションが異なる可能性がある。この気持ちは開発者にしかわからないと思う。</p>
<p>その開発者がデイリースクラムでツール開発をやることを相談しなかったかの理由も理解できて、合理的に考えたら相談しても承認を得るのは難しいので、黙ってやってしまったのだろうと思う。そして、今回のスプリントのスプリントゴールが未達になったとしても、なにか業務に影響が出るというわけでもないことをメンバーが知っているというのもある。スプリントは全力でやるものだけど、全力でやらなくてゴールが未達になっても、なんら業務に支障がでない事実がスプリントの目的を減衰させている。</p>
<p>そういう業務と実情があっていない現実、ルールに則るとお小言を言わざるを得ない牽制機構、たった2日すら自由に時間を使えない開発者、なんかスクラムって窮屈だなと直観的に感じた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0209/>リリース作業の改善</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-09
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/refactoring/>refactoring</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て6時前には起きてた。昨日がんばったから今日は早めにお仕事を切り上げた。</p>
<h2 id=リリース作業を柔軟に効率的に>リリース作業を柔軟に、効率的に</h2>
<p>以前から認識していた開発の課題にリリース作業のコストが大きいことがあった。具体的には人間が手動で進捗をみながら処理を実行していて、さらに1つずつの処理に数分かかるので順番に実行していくだけでも確認を含めて30分から1時間ぐらいかかる。リリース後に変更したところの動作確認とかを開発者が集まってやってたらだいたい2-3時間はかかる。だらだら？やっているとリリース作業に開発者全員がハドルに入って半日ぐらいやってたりする。最初のうちは雑談しながらリリース作業のやり方がわかってよかったんだけど、何度か繰り返したらこれを毎週やるのは非効率だわと思うようにはなっていた。</p>
<p>そんな開発側の事情もあったんだけど、スクラムマスターからもいまのリリース作業は柔軟性がないみたいな指摘が入って、その改善のチケットが切られた。開発者も全員それは認識していた。改善するならスプリントを1つ使うぐらいの工数がかかるという背景を説明するために、私が「ぼくのかんがえたさいきょうのりりーすさぎょう」を考えていくつかのタスクをチケットに作った。いま GitHub Actions の無料枠におさまるようにリソース制限を運用で調整しているのもあって予算確保できるなら戦略も変わってくる。それらも含めて然るべき改善の道筋を示したい。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0208/>テストコードのリファクタリング</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-08
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/testing/>testing</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。今日は7時半から23時過ぎまで集中してコードを書いてた。最近は19-20時には帰って、晩ご飯食べて、ドラクエタクトやったり漫画読んだりだらだらしている。そんな暇あったら積ん読の本読めって感じだ。</p>
<h2 id=テストコードのリファクタリング>テストコードのリファクタリング</h2>
<p>業務機能の開発をするにあたって、既存のテストコードをみていて、<code>@BeforeEach</code> というテストメソッド単位に呼ばれるメソッドでテストデータの削除と postgresql の sequence のリセット処理をしていた。こんなの共通処理ですべてのテーブルの truncate と sequence のリセット処理をすればいいやんとか思って、いろいろ調べて2つのリファクタリングの PR を作成した。先日 <a href=/diary/posts/2022/0116/>JUnit5 の拡張</a> を調べたばかりだから、テストの共通化のノウハウが溜まっている。<a href=https://www.testcontainers.org/modules/databases/postgres/>Testcontainers Postgres Module</a> と連携して、postgresql コンテナに接続して sequence のリセット処理を汎用のテスト拡張として実装した。テストを実装する開発者は、次のように <code>@ExtendWith(DatabaseInitializer.class)</code> をアノテーションに付与すれば、自分で sequence のリセット処理を <code>@BeforeEach</code> のメソッドに実装する必要がなくなる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@SpringBootTest</span>
<span style=color:#a6e22e>@Transactional</span>
<span style=color:#a6e22e>@ExtendWith</span><span style=color:#f92672>(</span>SetupDatabaseContainer<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)</span>
<span style=color:#a6e22e>@ExtendWith</span><span style=color:#f92672>(</span>DatabaseInitializer<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyTest</span> <span style=color:#f92672>{</span>
    <span style=color:#f92672>...</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>この作業の過程で spring boot の <a href=https://spring.pleiades.io/spring-framework/docs/current/reference/html/testing.html#testcontext-tx-enabling-transactions>@Transactional</a> はデフォルトでテストメソッドの実行後にロールバックする機能が提供されていて、いままで <code>@BeforeEach</code> のメソッドで明示的にテーブルのデータを削除する必要はなかったんやと気付いた。じゃあ、なぜ削除するコードを書いてたかと言うと、テストの外部で初期データを作成する仕組みがあるから、初期データを削除する目的でそうしていたことが判明した。そして、一部のコードはそこで作った外部の初期データに依存して実装されていた。テストコードの一部が外部のデータに依存しつつ、テストメソッドでは外部のデータに依存しないように削除のコードが書いてある。書いていて何を言っているのかわからないと思うけど、私も調べてて訳がわからんくて、PR に「いまの状況はかなりややこしい」と前置きしつつ、無駄なコードや仕組みを取り除くための修正を行った。本当は機能開発やらないといけないのにテストコードのリファクタリングするのに大きな時間をかけるわけにはいかないだろうという意図で、半日掛けてリファクタリングして23時過ぎまで作業して、既存のテストコードも含めて全部直した。このリファクタリングで数十のテストケースの約300行ぐらいの初期化コードをなくせた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0207/>確定申告書類の印刷</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-07
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/tax/>tax</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て7時に起きた。</p>
<h2 id=確定申告書類の印刷>確定申告書類の印刷</h2>
<p>最近は遅くても8時、速かったら7時過ぎからお仕事している。ちょうど仕事の谷間で手持ちのタスクを終えてしまっていて、今日から別のタスクに着手する予定が、昨日から障害が発生していたらしく、朝忙しそうだったから11時まで確定申告の作業をしていた。昨日、データ入力は終えていたので総勘定元帳をみながら変な数字になっていないかをチェックしたり、源泉徴収税の還付金の計算があうかどうかを検算したりしていた。あとすでに廃棄した固定資産が残っていることに気付いた。耐用年数が過ぎた固定資産の価値は1円として管理される。これを備忘価格と呼ぶらしい。除却の手続きもした。ついでに <a href=https://advisors-freee.jp/article/category/cat-big-03/cat-small-06/12956/>固定資産売却益（損）とは</a> の会計手続きも調べたりしていた。</p>
<p>オフィスのプリンタで一通り書類を印刷した。あとは提出するだけ。昨年から住んでいるところの徒歩圏内に申告できる場所ができて、散歩のついでに確定申告する程度の手間しかかからない。このまま電子申告してもよいのだけど、寄付金控除のための領収書を写真か PDF ファイルなどで取り込む必要があって、それだけ面倒なので放置している。このまま今年も紙で提出してくるかなぁ。</p>
<h2 id=業務システムの開発>業務システムの開発</h2>
<p>twitter のタイムラインで業務システムの開発者は「業務系エンジニア」と呼ぶとか言っている人をみかけた。そっか、私は web エンジニアから業務系エンジニアになったんだー、web アプリケーション開発しているけどな、とか思いながら、今週からいよいよお手伝い先の業務システムの開発に着手する。いままでインフラやサーバーサイドのシステム寄りの保守や機能開発のみをしていた。さっそく DB スキーマの定義やドキュメントの書き方、作業の進め方などを確認していた。ひとまず1週間のスプリントで終えられそうなタスクなのでがんばってやりたい。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0206/>確定申告の準備</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-06
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て8時に起きた。朝から洗濯と掃除をしてた。姪の大学進学で下宿先を探しに来ると姉が言うからなんか手伝う必要あるのかなと午後は時間をあけてたけど、そうでもなかった。</p>
<h2 id=2021年度の個人の確定申告>2021年度の個人の確定申告</h2>
<p>夕方から確定申告の作業を始めた。毎年 freee で1ヶ月だけ契約して確定申告の書類を作っている。データ入力の作業は次の2つだけ。</p>
<ul>
<li>印税の源泉徴収税の明細作成</li>
<li>寄付金の明細作成</li>
</ul>
<p>書籍の印税収入が定期的に振り込まれる。印税収入は源泉徴収済みとなる。銀行 (出版社) からの明細取り込みに対して、印税と源泉徴収税の明細に分割する必要がある。今年は3社から印税があって、それぞれ数件程度の明細を作成した。クレジットカードで寄付金を支払っているものは明細連携できていないので12ヶ月分の明細を手入力することになる。言うても、それは1団体だけなので12個の明細だけ。会社を作る前は技術書の購入や勉強会の参加費や交通費 (新幹線とか) などにかかった経費なども明細登録していたけど、いまは会社の経費ですべて計上しているので個人で計上するものはなくなった。会社の経費はクレジットカード連携できているし、日々のお仕事で会計処理しているから、確定申告のタイミングでまとめて作業する必要はなくなった。</p>
<p>あと2021年度から <a href=https://www.smrj.go.jp/kyosai/skyosai/>小規模企業共済</a> に入った。最小1000円/月から最大7万円/月の掛け金を選択する。いくらぐらいが妥当かわからなかったのでひとまず4万円/月で運用している。もちろん掛け金は変更できるが、基本的に20年とか掛け続けるもので、支払った金額は戻ってこないので、あるとき大きなお金が必要となっても融通できない貯金があるみたいものになってしまう。その分のメリットとして、所得控除の対象となる。<a href=https://www.smrj.go.jp/kyosai/skyosai/entry/simulation/index.html>加入シミュレーション</a> があるので、自分の条件にあわせてやってみるとおもしろい。例えば、納付月数240ヶ月、掛け金7万円/月、課税所得400万円で算出すると24万円/年の節税となる。課税所得が減るので所得税だけでなく住民税も節税となる。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0205/>見積もりの考察</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-05
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/issue-tracking-system/>issue tracking system</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て8時半に起きた。夜中に胃酸が逆流してむせてしんどかった。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>先週の日曜日に自転車でこけて胸を強打してまだ治りきっていない。トレーナーさんに伝えたら主に足のストレッチを重点にしてくれた。今週は2日間ストレッチをやったんだけど、今日の開脚幅は開始前166cmで、ストレッチ後169cmだった。先週と同じなので現状維持といったところ。悪くない数字ではある。今日は左のお尻の後ろの筋肉の張りと右太ももの後ろの筋肉の張りが強かった。</p>
<h2 id=見積もりとは>見積もりとは</h2>
<p>昨日の <a href=/diary/posts/2022/0204/>バーンダウンしないチャート</a> に関連して「見積もりとはなにか」というタイトルでつらつらと書き始めたら6000文字ほど書いてた。当初はお手伝い先の wiki に書こうと思って書き始めたものの、アウトラインと言いたいことをまとめたら、とくに機密情報はほとんどないことに気付いて、自分のブログのどこかにまとめ直そうと思った。社内向けに書こうとすると、実務の具体例をベースにして自分の論理や考察を展開し、最終的には提案の説得力を高めようと構成する。一方で社外向けに書こうとすると、社内の関係者に対してハラスメントにならないように配慮して書くのをやめた内容を一般論という立て付けで構成できる。文章を書くときに誰向けに書くかは、内容が同じでも話の展開や構成に影響を与えるということにふと気付いた。また数日以内にはどこかのブログに書き直す。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0204/>バーンダウンしないチャート</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-04
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て4時に起きてドラクエタクトしたり twtter 眺めたりして金朝ツメトギで <a href=https://www.ipa.go.jp/files/000094497.pdf>DX 実践手引書</a> を読んでた。</p>
<h2 id=スプリントの残チケット>スプリントの残チケット</h2>
<p>スクラム開発でバックログのバーンダウンチャートを表示させるために、スプリントに対して、同じ期間のマイルストーンを設定するように運用が変わった。運用変更に伴い、バーンダウンチャートも表示されるようになり、スプリントの進捗状況の見える化が進められた。そのバーンダウンチャートの運用について SM と話していて、私の過去の開発とスプリントの考え方の大きな違いを発見した。</p>
<p>私がこれまでやってきた開発はマイルストーンの日には残チケットがゼロになるように開発していた。開発が遅延してそのマイルストーンで完了しそうにないチケットはどこかのタイミングで次のマイルストーンに先送りさせることで、いまやっているマイルストーンの開発が計画通りに完了するよう調整していた。作業が期限までに間に合わないチケットは早めに検知して報告して対応を検討する。一般論として、遅延したときは期限を延期するか、次のマイルストーンに先送りするかのどちらかしかない。</p>
<p>スクラムの場合、PO はスプリントを中止する権限をもっているが、基本的にスプリントの計画は変更しない。スプリント内でマイルストーンに間に合わないチケットがわかっていても、マイルストーンは変更せず、次のスプリントプランニングまで放置して、次のスプリントプランニングで遅れたチケットの作業を中止するか、引き続きやるかを検討するという。このやり方だと、スプリント終了日 (マイルストーンの日) に遅延して完了できないとわかっているチケットがすべて残ってしまう。当然バーンダウンチャートはバーンダウンしない。</p>
<p>一方でこれまでマイルストーンこそ設定していなかったものの、様々な理由でスプリントでやる予定だったチケットが遅延することは度々あった。それはデイリースクラムで遅れますとか、予想外のタスクが出てきましたとか、そういう報告をもって実運用では次のスプリントに持ち越ししていた。実運用では持ち越ししているのに、マイルストーンを変えるのは計画の変更だからやってはいけないという話しになって、見える化したのにバーンダウンしないチャートがあって、この運用に何の意味があるのだろう？わからなくなった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0203/>開発の谷間</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-03
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/writing/>writing</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時半に起きた。</p>
<h2 id=ドキュメント作成>ドキュメント作成</h2>
<p>今週はあまり開発せず、バックログの wiki にドキュメントを書いてた。バックログの wiki は慣れると書きやすいし、<a href="https://chrome.google.com/webstore/detail/backlog-power-ups/oknjgkbkglfeeobjojelkbhfpjkgcndb?hl=ja">Backlog Power Ups</a> の chrome 拡張をインストールすると <a href=https://plantuml.com/ja/>PlantUML</a> で UML もレンダリングできる。ドキュメントの階層化はタイトルに <code>/</code> で区切ってグルーピングするというちょっと変なやり方。wiki のタグはフィルター条件として使いやすいように思えた。添付画像のサイズ指定ができないか調べてたら、ヌーラボコミュニティがあることに気付いた。せっかくなので <a href=https://ja.community.nulab.com/u/tetsuyamorimoto-5hx/activity>改善要望</a> を投稿しておいたけど、過疎っててあまり意味がないかもしれない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0202/>情熱の考察</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-02
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/issue-tracking-system/>issue tracking system</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て4時半に起きてドラクエタクトを1時間ほどやって寝て7時半に起きた。</p>
<h2 id=課題管理の情熱>課題管理の情熱</h2>
<p>先日、行った <a href=/diary/posts/2022/0130/#3ヶ月フィードバック完了>3ヶ月フィードバック</a> はスクラムマスターには好評だったらしく、他にも3人ほど読んでくれた人たちがいたようだ。いま課題管理のボードの整理をしたり、wiki のドキュメント階層を整理したり、情報共有や書く文化の重要性を説いたり、チームに私のやり方を見本のように示している。チームにも、私のチケットはコメントの量が大幅に違うということは認識され、それを見様見真似でやり始める開発者も現れ始めている。誰もが最初はお手本を模倣しながら学ぶ。いままで課題管理と情報共有というコンテキストで見本を示せる開発者がいなかっただけという話だ。</p>
<p>ふと、なぜ私はここまで課題管理やドキュメントなどを整理したがるのか、自分で考えてもよくわからない。強いて言うと、自分が働く環境やツールに関心をもっていて、それをいまよりもより良く改善したいという気持ちが他人よりも強いのかもしれない。働くからにはよいものを作りたい、ひいてはよい環境があればよいものを作れる、よい環境を作るための投資は惜しまないという姿勢から、課題管理のワークフローと情報共有の最適化を常に考えながら実践している気がする。もっと端的には言えば、仕事がどうこうというのは全く関係なく、日々の活動に関心をもっていると言えるのかもしれないなと思ったりした。採用における特性をみるときの1つの指標として生きていることに関心をもっているか、どういう行動を取っているかとかをヒアリングしてもおもしろいのかもしれない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0201/>wiki のドキュメント整理</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-02-01
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/datadog/>datadog</a>&nbsp;
#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て4時半に起きた。昨日の帰りに自転車でこけて胸を強打してひたすら痛い。起き上がるのも痛い。安静にしてた。</p>
<h2 id=kubernetes-のログ管理と-datadog-agent-のログ連携不具合>kubernetes のログ管理と datadog-agent のログ連携不具合</h2>
<p>先日、<a href=/diary/posts/2022/0127/#ログ連携の不具合調査>datadog にログ連携されていない不具合</a> が発生していて、その1次調査を終えたことについて書いた。緊急対応としては datadog-agent を再起動することで改善することはわかっていたので、その後、kubernetes のログ管理と datadog-agent がどうやって kubernetes クラスター上で実行されているアプリケーションのログを収集しているかを調査していた。今日は wiki に調査してわかったことなどをまとめていた。</p>
<p>kubernetes クラスターはコンテナランタイムに docker を使っていて、アプリケーションの stdout/stderr を docker の logging driver にリダイレクトし、JSON Lines に設定された logging driver が kubernetes ノード上にログファイルとして出力する。datadog-agent は autodiscovery 機能で pod の情報を常にポーリングしていて、pod が新たにデプロイされたらログファイルを pod 内にマウントして、そのマウントしたログファイルを読み込んでログ収集していると思われる。datadog-agent から pod の情報を取得するには kubernetes のサービスアカウントを使っていて、その credential が projected volume としてマウントされて pod 内から利用できる。その credential を使って kubelet api にリクエストすることで pod の情報を取得している。</p>
<p>文章で書けばたったこれだけのことなんだけど、たったこれだけのことを理解するのに次のドキュメントを読んだ。実際の調査のときはわからなかったのでもっと多くのドキュメントを読んでいる。いま書いたことを理解するならこのドキュメントを読めば理解できるはず。</p>
<ul>
<li><a href=https://kubernetes.io/docs/concepts/overview/components/>https://kubernetes.io/docs/concepts/overview/components/</a></li>
<li><a href=https://kubernetes.io/docs/concepts/architecture/control-plane-node-communication/>https://kubernetes.io/docs/concepts/architecture/control-plane-node-communication/</a></li>
<li><a href=https://kubernetes.io/docs/concepts/cluster-administration/logging/>https://kubernetes.io/docs/concepts/cluster-administration/logging/</a></li>
<li><a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/>https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/</a></li>
<li><a href=https://kubernetes.io/docs/concepts/storage/projected-volumes/>https://kubernetes.io/docs/concepts/storage/projected-volumes/</a></li>
<li><a href="https://docs.datadoghq.com/agent/kubernetes/log/?tab=helm">https://docs.datadoghq.com/agent/kubernetes/log/?tab=helm</a></li>
<li><a href="https://docs.datadoghq.com/getting_started/agent/autodiscovery/?tab=kubernetes">https://docs.datadoghq.com/getting_started/agent/autodiscovery/?tab=kubernetes</a></li>
</ul>
<p>ドキュメントに書いてあることを深く理解するために、kubernetes と datadog-agent のソースコードも読んだ。どちらも go 言語で実装されている。</p>
<ul>
<li><a href=https://github.com/kubernetes/kubernetes>https://github.com/kubernetes/kubernetes</a></li>
<li><a href=https://github.com/DataDog/datadog-agent>https://github.com/DataDog/datadog-agent</a></li>
</ul>
<p><code>kubectl logs</code> の振る舞いを確認するだけでも、ソースコードからは実際のログファイルを open してストリームを返しているところはわからなかった。api 呼び出しが連携されて抽象化されていて、コンポーネントの役割分担があって、何も知らずにコードを読んでいてもわからなかった。Kubernetes の低レイヤーのところは Container Runtime Interface (CRI) という標準化を行い、1.20 から docker は非推奨となり、将来的に CRI を提供する実装に置き換わるらしい。ログファイルを open する役割は CRI の実装が担うんじゃないかと思うけど、そこまでは調べきれなかった。また機会があれば CRI の実装も読んでみる。</p>
<figure><img src=/diary/img/2022/0201_kubectl-logs.png>
</figure>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0131/>ヘルスチェックのレスポンスのステータスコード</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-31
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て6時に起きた。</p>
<h2 id=404-のレスポンスをヘルスチェック>404 のレスポンスをヘルスチェック</h2>
<p>ここ数日はお仕事でインフラ周りの調査をしていた。たまたまログをみていて、ELB のヘルスチェックが 404 になっているのを大量にみつけた。てっきりヘルスチェックを使ってないのだろうと思ってインフラ担当者に問い合わせたら、404 が返ってくることをヘルスチェックしているという。404 をチェックすることになんの意味もなく、ただ急ぎで設定する必要があったからとりあえず動かせるためにそう設定したという。一方でアプリケーション側は spring boot で開発していて、<a href=https://www.baeldung.com/spring-boot-actuators>Spring Boot Actuator</a> も導入されているので <code>/actuator/health</code> にアクセスすれば 200 が返ってくるようになっている。どういう経緯だったかはわからないけど、開発者に一言聞けば 404 のレスポンスをヘルスチェックすることは何もない状態でずっと運用されていたことがわかった。</p>
<p>アプリケーション側の <a href=https://kubernetes.io/docs/concepts/services-networking/ingress/>Kubernetes: Ingress</a> のマニフェストにもそういった設定が入っていて、インフラ側の CDK のコードにもそういったマニフェストがあって、両方の設定変更が必要なのか、アプリケーション側のものだけでいいのか、少し調査が必要ということになった。私も Ingress というのがなにものなのか、よくわかってないので調べて理解する機会としよう。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0130/>3ヶ月フィードバック書いた</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-30
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/writing/>writing</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て7時半に起きた。昨日も半日ぐらいはコードを書いてて pr の草稿を作って帰ってきたら23時ぐらいだった気がする。</p>
<h2 id=3ヶ月フィードバック完了>3ヶ月フィードバック完了</h2>
<p>先日、書き始めた <a href=/diary/posts/2022/0123/>3ヶ月フィードバック</a> を書き終えた。平日少しずつ書こうと思ってたんだけど、平日は疲れて書かなくて、休日にまとめて書いた。最終的には1万文字ほどになった。見出しはこんな感じ。実質2日しか作業していないけど、2週間かけた。</p>
<ul>
<li>開発プロジェクトに参加して気付いた3つの大きな課題</li>
<li>初めてスクラム開発をやってみた所感
<ul>
<li>所感</li>
<li>スクラムのよいところ</li>
<li>スクラムのわるいところ</li>
</ul>
</li>
<li>課題管理システム (チケット駆動開発) と情報共有
<ul>
<li>情報共有とは</li>
<li>課題管理と情報共有</li>
</ul>
</li>
<li>情報共有とコミュニケーションコスト</li>
<li>Pull Request のレビューと開発の生産性</li>
</ul>
<p>明日プロジェクトのメンバーに共有してみる。反響があるのかどうか？もしかしたら誰も読まないかもしれないけど、私自身の思考の整理にもなっている。ここで書いた内容を洗練させてコンテンツとして再利用できるようにもしていきたい。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>本当はこの週末に <a href=/diary/posts/2022/0115/#ワーケーション延期>ワーケーションへ行く予定だったが延期した</a> 。いつもは土曜日の午前中に通っているストレッチを日曜日の夜に変更していた。</p>
<p>最近は日曜日をだらだら過ごす日が多いのだけど、今日は夜にストレッチの予定が入っていたので午前中は自分でストレッチして、午後から3ヶ月フィードバックを書き終えて、夜に Dr.stretch さんでトレーナーさんにストレッチしてもらうといった、平日のような充実した1日となった。休日も予定を作った方がきびきび動ける。いかに自分が怠惰かを思い知る。今日の開脚幅は開始前166cmで、ストレッチ後169cmだった。今週も全然ストレッチしなかった割にはまぁまぁよかった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0129/>不正の調査報告書を読んだ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-29
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/accounting/>accounting</a>&nbsp;
</span>
<div class=post-content>
<h2 id=不正の調査報告書>不正の調査報告書</h2>
<p>少し前にタイムラインでグレイステクノロジーという会社の粉飾決算が話題になっていたので関心をもっていて、調査報告書が公開されていたので読んでみた。100ページ超あるので目を通すだけでも数時間ほどかかった。</p>
<ul>
<li><a href=https://ssl4.eir-parts.net/doc/6541/tdnet/2072811/00.pdf>特別調査委員会の調査報告書受領に関するお知らせ</a></li>
</ul>
<p>うちはマイクロ法人なんでなんのプレッシャーも目標もない、お気楽な会社ではあるけど、失敗事例から経営や会計を学ぶ機会にしている。多くのケースで成功する方法はわからないけど、失敗しない方法はいくつもある。凡人は成功しようとせずに失敗しないように注意するのがよいと私は考えている。これは麻雀で振り込まなかったら勝てるというのに近い考え方だ。</p>
<p>閑話休題。報告書を読んでいて最初は1社員による小さな不正だった。もちろんそれもよくないことだが、経営陣がまともであれば、いくらでも訂正することも立て直すこともできた。しかし、経営陣もおかしかった。すぐに個人の不正が組織ぐるみになり、創業者の虚栄心も拍車をかけて、2-3年後には数億円規模の不正となり、不正を働いた関係者が一蓮托生となった。これは構造的な問題もしくは失敗を学ぶ教材となる。関係者個人の道徳心や正義感などを批判することもできるだろうが、それよりも構造的にそんな状態に陥らないように会社の仕組みを作ることが重要で、一般論ではそれをコーポレートガバナンス (企業統治) と呼ぶのだろう。しかし、経営者がみずから不正をすることに対するガバナンスとはどう在るべきなのか、この問題に対する構造的な対策はなかなか難しいのだと、この調査報告書は語っている。</p>
<p>なんら擁護するものではないが、読み進めていて、関係者みんな辛かっただろうなと不正をしなければいけない状況や心境を察してしまった。目標数値が高過ぎる、過度なパワハラ、コーポレートガバナンスの不備などがその状況を5年も維持し続けてしまった。もっと早く明るみに出ていたら、いまより関係者は苦しまなかっただろうが、歴史に if はないので推測でしかない。不正の中心人物である創業者は急性大動脈解離で急逝しており、それは認知的不協和のストレスによって引き起こされた可能性が高いのではないかと私は考えてしまった。不正に限った話ではないが、なんらかの間違いというのは早期に検出できて、早期に改善のための取り組みをする方が短期的に大きな損害を被ったとしても、中長期的には最大の利益を得るというのを、多くの人は人生の経験の中で学んでいくと思う。たまたまその経験をもっていない人たちがこの会社には集まってしまって、不幸な事件が起きてしまったように私は受け取ってしまった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0128/>不具合調査の翌日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-28
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て4時半に起きた。昨日22時過ぎまで作業して23時頃から晩ご飯食べてから寝たわりに、というかそのせいか、パッと起きて金朝ツメトギみて、そのままオフィス行って、午前中は昨日の続きの不具合調査をしてた。</p>
<h2 id=kindle-本の返品>Kindle 本の返品</h2>
<p>ある kindle 本を購入したときにアカウントを間違えていることに気付いた。amazon のアカウントは法人アカウントと個人アカウントがある。アプリでアカウントの切り替えは面倒なので、業務で購入する kindle 本も個人アカウントで購入して読んでいる。誤って法人アカウントで kindle 本を購入してしまったので返品したい。システム的に kindle 本の返品機能は提供されていないが、<a href="https://www.amazon.co.jp/gp/help/customer/display.html?nodeId=G937D322PWZ6L9BL">Kindle本を返品する</a> を読むとカスタマーサービスから返品できる。次の記事はスクリーンショットで操作も説明しているのでわかりやすい。</p>
<ul>
<li><a href=https://www.kyodotokyo.com/book-movie/kindle-book-return/>【しまった】Kindle本の返品(キャンセル)方法を画像付きで解説！読んだ後に返品はできる？</a></li>
</ul>
<p>カスタマーサービスのチャットを開いて、ボットの質問にいくつか回答して、購入した kindle 本を選択して「その他」からオペーレーターにつながる。6時過ぎだったのにオペレーターがチャットに出てきて、kindle 本を返品したいと書き込んだらすぐに確認して返品処理してくれた。オペレーターは24時間体制なのかな？おそらく購入してすぐだったし、ダウンロードもしていなかったので返品処理がすぐできたのだと推測する。実際の返金処理には2-3日かかるとのこと。チャットで2-3のコメントを書き込めば手続きできたのでシステムはよくできていると思った。そのことを twtter に書き込んだらすぐ Amazon Help にいいねされて、みてるぞって感じでこれはちょっと怖くなった。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>アカウントを間違えて、誤って kindle 本を購入してしまってカスタマーサービスからチャットして返品処理できた。この時間でも担当者がつながったので24時間体制でサポートしているんやな。スムーズに手続きできてよかった <a href="https://twitter.com/hashtag/%E9%87%91%E6%9C%9D%E3%83%84%E3%83%A1%E3%83%88%E3%82%AE?src=hash&ref_src=twsrc%5Etfw">#金朝ツメトギ</a></p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1486815457428787203?ref_src=twsrc%5Etfw">January 27, 2022</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<h2 id=オフィス内覧>オフィス内覧</h2>
<p>オフィスの引っ越し調査のために <a href=https://fabbit.co.jp/facility/kobesannomiya/>fabbit神戸三宮</a> に行ってきた。フリースペースは開放感があって、外の光も入っていて、雰囲気がよさそうにみえた。サービスで1日分のドロップインチケットをもらったので今度使ってみる。個室は2名と4名部屋の2種類。2名部屋はあまり広くないので1名で利用している会員も多いとのこと。</p>
<ul>
<li>月額利用料: 66,000円</li>
<li>郵便受けサービス: 1,100円</li>
<li>法人登記サービス: 11,000円</li>
</ul>
<p>法人のオフィスとして使うときは郵便受けと法人登記サービスに入る必要があるとのこと。個室の設備なども含めて比べると、いまのオフィスより割高な料金設定になっているように感じた。その他デメリットもいくつかわかった。</p>
<ul>
<li>法人登記の場合、入会するときに入会金が44,000円かかる</li>
<li>部屋に備え付けの机や椅子がいらないときは保管場所を自分で用意しないといけない
<ul>
<li>椅子を変えたかったら備え付けの椅子を自宅に置いとくとか</li>
</ul>
</li>
<li>個室の仕切りがガラス張りで外から中がみえるので社外秘などのセキュリティがやや気になる
<ul>
<li>顧客情報が流出する可能性があるのと、マット敷いてお昼寝しているときに外からみられたら恥ずかしい</li>
</ul>
</li>
<li>郵便受けが施設内にあるのでスタッフがいないと郵便が届かない (土日に郵便物を受け取れない)</li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0127/>datadog-agent のログ連携の不具合調査</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-27
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/datadog/>datadog</a>&nbsp;
#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て4時に起きた。朝から1時間ほどドラクエタクトやってた。</p>
<h2 id=ログ連携の不具合調査>ログ連携の不具合調査</h2>
<p>少し前に本番環境で <a href=https://github.com/DataDog/datadog-agent>datadog-agent</a> からログが (クラウドの) datadog に連携されていないことがわかった。kubectl logs のコマンドで確認すると、アプリケーションのログは出力されているので datadog-agent から datadog にログを送信するところの問題であるように推測された。たまたま今日、同じような現象をテスト環境で確認できた。ちょうどスクラムのプランニングでログ調査のための作業をするチケットの承認を得たところだった。満を持して発生したような障害だったので私が調査すると明言して調査してた。半日ぐらい調査して、pod 内の credential 情報が置き換わってしまうことが原因っぽいと特定できたが、なぜ置き換わってしまうのかはまだわからない。もう少し調査して解決したら会社のテックブログにいいなと思ったので、日記に書いてた内容を移行することにした。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0126/>レビュー待ちのストレス</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-26
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/psychology/>psychology</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。6時半頃に動くバッチ処理がエラーになって朝から原因を調べてた。</p>
<h2 id=ユニットバイアスとツァイガルニク効果>ユニットバイアスとツァイガルニク効果</h2>
<p>いまのお仕事は火曜日にリリースして水曜日にプランニングしているため、1週間のうちの火曜日と水曜日がだらけがちになっている。火曜日に作成したリリースしない開発途中の PR が保留され、水曜日もプランニングやその後の調整にだらけていると PR が滞留しやすいからだ。昨日と今日で作成した PR が7つレビュー待ちで溜まっていて、他の作業を並行して進めるやる気をなくしてしまった。ここでなぜ作業を中断していると、自分の中でストレスが溜まったり、他の作業のやる気が削がれるのかを考えてみた。私が知っている認知心理学の知見からだと次の2つになる。</p>
<ul>
<li>ユニットバイアス
<ul>
<li>量や大きさに関係なく、やり終えることに満足を感じる</li>
<li>チケットやタスクを小さく分割することで小さな課題に集中して作業できる</li>
</ul>
</li>
<li>ツァイガルニク効果
<ul>
<li>途中で挫折したり中断してしまったことの方がよく記憶に残る</li>
<li>心理的リアクタンスが高いほどこの効果が発生しやすくなる
<ul>
<li>他人から行動を制限される反発して自分のやりたい欲求が高まる</li>
</ul>
</li>
<li>レビュー待ちが多いと中断している課題のことが気になって集中力を削がれる</li>
</ul>
</li>
</ul>
<p>普通の開発者は1日3-5個ぐらいのチケットを fix するんじゃないかと思うけど、レビューが止まっているせいでそれが阻害されてストレスを感じる。しかも、レビューが有意義であれば待つ価値もあるが、レビューのほとんどがノーコメントで approve されるだけだと待ち時間だけが積み上がる。</p>
<h2 id=普通のプログラマの普通の設計>普通のプログラマの普通の設計</h2>
<p>タイムラインでたまたまみかけて <a href=https://modeling-how-to-learn.connpass.com/event/231669/>普通のプログラマの普通の設計</a> に参加した。設計の話しはコンテキストやコードがないと抽象的過ぎてふわふわして勉強会で扱うには難しいテーマだけど、その懸念通り、ふわふわした内容だったと思う。おもしろくなかったわけではなく、発表者それぞれの考え方や大事にしている価値観などを知ることで多様性を認めるというか、他人のやり方を受け入れることにもつながるのかなとは思えた。</p>
<p>コードのない設計の話しは言葉から連想される概念が広過ぎてあまりよくわからない。現実の設計でも言葉でやり取りして同意していたのにコードは全然違うみたいなことはたまに発生する。だから言葉で設計のやり取りするよりも、2-3日でプロトタイプを実装できるならコードを先にみせてもらった方がよいとすら私は考えているところがある。あと一度設計をやったら終わりと考える開発者も多い。設計とは運用してからのフィードバックを受けてさらに改善していくことも含まれる。だから開発を継続している限り、設計したということはなくてずっと設計しているという考え方が正しい。matz もコードとは設計であると話していたと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0125/>歴史と地政学</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-25
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て6時半に起きた。今日はリリース日でリリースに間に合わなかった PR 群の説明を書いてそれらをまとめたり、チケットの整理をしたりしていて、あんまり他のことの記憶がない。</p>
<h2 id=地政学に関心がある>地政学に関心がある</h2>
<p>プーチン大統領が「地政学的に言えば……」という枕詞をよく使う (印象を私が勝手にもっていて、実際にそういう発言をググっても検索ヒットするわけではないので勝手な私の思い込みかもしれないが) ので地政学という分野に以前から関心をもっている。とくにプーチン大統領のファンだというわけではない。地政学といえばプーチン大統領という連想が働くだけだ。たまたまはてブのエントリーでみつけた記事を読んだらおもしろかった。</p>
<ul>
<li><a href=https://dain.cocolog-nifty.com/myblog/2022/01/post-1d5097.html>面白い世界史の本を3人で2時間お薦めしあった中から厳選した12冊（前編）</a></li>
</ul>
<p>記事に触発されて <a href=http://sakurasha.com/2016/11/%E6%81%90%E6%80%96%E3%81%AE%E5%9C%B0%E6%94%BF%E5%AD%A6/>恐怖の地政学</a> を購入した。いま私が地方都市に住んでいるというのもあって、地方に根付いた産業とか文化とか、いくらかそれは地理的な要因もあるだろうとは思っていて、せっかく地方に住んでいるのだからそういう分野の歴史や背景を調べるのもおもしろそうだと思い始めたところでもある。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0124/>雑談の効果</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-24
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/communication/>communication</a>&nbsp;
</span>
<div class=post-content>
<p>4時に寝て7時半に起きた。休日にだらだら過ごしてたので生活のリズムが狂ってしまった。</p>
<h2 id=開発者同士の雑談>開発者同士の雑談</h2>
<p>リリース作業前の検証のときにそれぞれの開発者が対応した課題の検証をやりながらハドルで雑談するのが定例になってきた。オンラインミーティングをするときに打ち合わせのリソースを作成する必要がないので、ハドルぐらい手軽にオンラインで繋げられれば雑談もしやすいということが少し理解できてきた。slack アプリは常に開いているので打ち合わせのために特定のアプリ(ブラウザで特定のページ)を開くという作業がないだけで心理的な障壁が下がる気がする。チャットツールに音声通話の機能がつくのは大きなメリットがあるなと、zoom や google meet と比較して思うようになってきた。定例会議やイベントなどは zoom や google meet でかまわない。だけど、「いまからリリースやるからみんな集まって」みたいなノリはハドルの方が集めやすいし、参加しやすい。フルリモートワークはオフィスと同じような雑談がやりにくいという課題の、技術的な課題はハドルが少しずつ解決していきそうな未来があるのかもしれない。</p>
<p>いままでのほほんと雑談していただけだったが、こういう機会にどんな会話をしているか、その会話からどういった情報共有が行われているか、会話することで人間関係や心理的安全性に影響を与えるかなど、雑談の意義や効果に注意を向けながらやってみるとなにかしら発見があるような気もしてきた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0123/>フィードバックの書き始め</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-23
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/writing/>writing</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て8時半に起きた。今日は雨降りだったのもあって1日お休みしてた。</p>
<h2 id=3ヶ月フィードバック>3ヶ月フィードバック</h2>
<p>はらさんと <a href=/diary/posts/2022/0121/#隔週の雑談>雑談したこと</a> を整理しながら wiki に書き始めた。勢いで2つの項目を書いた。書き始めにすごく時間を要するけど、書き出すとわりと推敲もしながら進む。</p>
<ul>
<li>開発プロジェクトに参加して気付いた3つの大きな課題</li>
<li>初めてスクラム開発をやってみた所感</li>
</ul>
<p>あと課題管理システムのことや情報共有の考え方やレベル、PR のルールやレビューと開発の生産性について書く。三分の一ぐらい書いたところかな。少しずつ空き時間をみつけて書いていく。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0122/>バーで会食</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-22
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
</span>
<div class=post-content>
<p>4時に寝て10時に起きた。昨日は体調悪くて夕方仮眠して、体調よくなった22時頃から作業を再開したので3時ぐらいまでやってた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今週もあまりストレッチができなかったものの、今日の開脚幅は開始前172cmで、ストレッチ後170cmだった。特別なことは何もしてないのだけど、数値がよくなった。開脚の仕方によって3cmぐらいは変わってきたりするのかな。開始前に測ったときに172cmになった理由もよくわからなかった。太もも後ろの張りは先週よりよくなっていたものの、腰の疲労は溜まっていて毎週毎週コンディションが違うなというのを実感する。</p>
<h2 id=会員制バーでふりかえり>会員制バーでふりかえり</h2>
<p>先日 <a href=/diary/posts/2022/0118/#会員制バー予約>予約した会員制バー</a> へ行ってきた。バーとか連れられてしか行ったことないので慣れる意図もある。<a href=/diary/posts/2022/0119/#bizpy-勉強会>bizpy の機械学習勉強会</a> のふりかえりも兼ねてわたなべさんと行ってきた。ビジネスパーソンという対象者の属性や前提知識などを確認したり、コンテンツの細分化や進め方、次回の予定など幅広くわいわいやってた。</p>
<p>バーについては思ったより店内は広くて10席ほどのカウンターのみだけど、幅広の椅子が置かれているのでパーソナルスペースが広くてゆったり過ごせる空間な気がした。19時に行ったら他のお客さんは誰もいなくて21時までいて誰も他のお客さんは来なかった。貸し切りみたいな感じだった。オミクロン株が流行も関係しているのだろう。うちらにしたら他のお客さんがいないから感染リスクが減ってよかったと思う。コース料理を頼んでいた。一品一品凝った感じの料理で接待にはちょうどよい。普通の晩ご飯に食べるにはお洒落過ぎて私には無用のものだと思う。量がたくさんあるわけでもないけど、1品ずつ出てきて2時間かけて食べるので割とお腹はいっぱいになって満足した。それなりの値段もするので当然おいしかった。</p>
<p><figure><img src=/diary/img/2022/0122_dish1.jpg>
</figure>
<figure><img src=/diary/img/2022/0122_dish2.jpg>
</figure>
</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0121/>第1回オフィス内覧調査</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-21
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/writing/>writing</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。起きたときは普通だったけど、午前中に働き始めてからまた頭痛がしてきた。内覧後は帰ってベッドで仮眠してた。夕方に頭痛のピークがきたものの、21時ぐらいにはおさまって元気になったのでそれからまたオフィスに戻って作業してた。</p>
<h2 id=隔週の雑談>隔週の雑談</h2>
<p>顧問のはらさんと隔週の打ち合わせ。開発のお手伝いを始めて3ヶ月経つので私の気付き事項のレポートを書こうかと考えている。組織や開発の改善やよくないところは、外部から入ってきたときに一番気付く。だんだんとその組織や文化に慣れていって違和感を感じたかどうかがわからなくなっていく。そのため、11月から働いていて気付いたことをずっとメモし続けてそれが3ヶ月分たまったのでそのメモを総括してレポートにまとめようという話し。そのふりかえりみたいな話しをさらに部外者のはらさんとあーだこーだと話してた。雑談レベルなのでそういう話しをすることで書くときの思考整理の前準備にもなる。</p>
<ul>
<li>課題管理システムやチケット駆動開発の実践についての話し</li>
<li><a href=/diary/posts/2022/0107/#情報共有とコミュニケーションコスト>聞かなくてもわかる</a> というコミュニケーションコストの話し</li>
<li>コードの品質と業務形態の話し</li>
<li>PR のルールやレビューと開発の生産性の話し</li>
</ul>
<h2 id=オフィス内覧>オフィス内覧</h2>
<p>オフィス引っ越し調査のために <a href=/diary/posts/2022/0114/#オフィスの引っ越し>神戸国際会館のレンタルオフィスの内覧</a> に申し込みしていたので行ってきた。必須条件は窓があって外がみえること。いま借りているレンタルオフィスもリフォームした後から入っているので新築みたいなもので施設や設備に関しては不満はない。参考までにいま借りているレンタルオフィスの料金はこんな感じ。</p>
<ul>
<li>月額利用料: 35,000</li>
<li>共益費: 5,000</li>
</ul>
<p>神戸国際会館というグレードの高いビルにあるレンタルオフィスは普通に文句の付け所がなくて素晴らしい。1人部屋は窓がないけど、いま借りているところより少しだけ広い。一方で料金は3倍ぐらいになる。</p>
<ul>
<li>月額利用料: 110,000</li>
<li>共益費: 5,000</li>
</ul>
<p>窓がないと引っ越す意味がないので窓がある部屋は2人部屋になって広さも余裕ができるものの料金も高い。ブラインドを上げたらガラス張りで22階だから見晴らしもよくて気持ちよさそう。</p>
<figure><img src=/diary/img/2022/0121_room.jpg>
</figure>
<ul>
<li>月額利用料: 195,000</li>
<li>共益費: 5,000</li>
</ul>
<p>いまの財務とお仕事なら払えないような料金ではないけれど、こんな家賃を払っていると、お仕事辞めてしばらく遊ぶみたいな余裕がなくなってサラリーマンと変わらない生活に戻ってしまいそうで不安になる。今期は3ヶ月ほど働かずに遊んでいたけど、そうやってられたのは家賃の固定費が安かったというのもあったんだなとこの料金を聞いて考えたりしていた。幸いにも神戸三ノ宮はレンタルオフィスがいくつもあるのでまだまだ候補はある。おそらく一番グレードが高いのが神戸国際会館なのでこれから行くところは妥当な料金になってくるとは思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0120/>spring boot の xml 変換の仕組み</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-20
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/spring-boot/>spring boot</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て吐き気がして3時に起きて、断続的に仮眠をとってみたけど、それでも気分悪くて5時から起きてた。昨日の晩ご飯食べて寝てから吐き気が出てきた。なにかの食べ合わせなのだろうか。コロッケとその後にチョコレート食べたのが悪かったのか。普通にオフィスへ行ってお仕事してたら直った。</p>
<h2 id=spring-boot-の-xml-変換>spring boot の xml 変換</h2>
<p>いまお手伝いしているお仕事で spring boot で <a href=https://en.wikipedia.org/wiki/SOAP>SOAP</a> の xml 通信しているサービスがある。任意の文字列を受け取って任意の文字列を返すような仕組みで設計されていて、xml の変換処理を jackson を使ってアプリケーションコードで書いていた。</p>
<p>これをやるならミドルウェアでやるべきだなと思って spring boot のドキュメントを調べてみた。<a href=https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#web.servlet.spring-mvc.error-handling>Error Handling</a> のように例外が発生したときの処理をフックする ResponseEntityExceptionHandler のようなミドルウェアに近い仕組みはあるが、通常のレスポンスに対して行う処理はなかった。代わりに <a href=https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#web.servlet.spring-mvc.message-converters>HttpMessageConverters</a> という、レスポンスを変換する仕組み自体は操作できないが、変換する変換器は置き換えたり拡張したりできるようになっている。レスポンスのデータフォーマットのカスタマイズをしたい場合は HttpMessageConverters で行うというのが spring boot 的なやり方にみえる。</p>
<p>さらに調べていると <a href=https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#howto.spring-mvc.write-xml-rest-service>Write an XML REST Service</a> に <code>jackson-dataformat-xml</code> がクラスパスにあれば jackson の ObjectMapper を使って xml に変換するよと書いてあって、試しにレスポンスのオブジェクトを返したら自動的に xml に変換されるという振る舞いを確認できた。つまり、アプリケーションコードで xml の変換処理を自前で実装しなくてもほぼ同じことを spring boot のデフォルトの仕組みでやってくれるというわけだ。jackson の ObjectMapper のカスタマイズがしたいときもいくつかやり方がある。例えば、 <code>@Configuration</code> をもつ Config オブジェクトで次のような bean を生成すれば任意の設定にカスタマイズした ObjectMapper が使われるようになる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Bean</span>
<span style=color:#66d9ef>public</span> Jackson2ObjectMapperBuilderCustomizer <span style=color:#a6e22e>configureObjectMapper</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>return</span> builder <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
        builder<span style=color:#f92672>.</span><span style=color:#a6e22e>serializationInclusion</span><span style=color:#f92672>(</span>JsonInclude<span style=color:#f92672>.</span><span style=color:#a6e22e>Include</span><span style=color:#f92672>.</span><span style=color:#a6e22e>NON_EMPTY</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>};</span>
<span style=color:#f92672>}</span>
</code></pre></div>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0119/>最初のフォロワー</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-19
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
#<a href=/diary/tags/machine-learning/>machine learning</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て4時に起きた。1時間ほどだらだらして1時間ほどドラクエタクトして6時半にバッチの初動監視をしてた。</p>
<h2 id=bizpy-勉強会>bizpy 勉強会</h2>
<p><a href=https://bizpy.connpass.com/event/234387/>Python で機械学習をやってみる勉強会</a> を開催した。わたなべさんに講師を務めていただいた。スタッフが2人いると、1人は勉強会が円滑にまわるようにサポートに注力できる。1人だと、講師として説明するのに精一杯で質問を拾い上げたり、わかりにくい説明を補足したりするといったことがリソース制約上できない。今回は私がサポート役だったので随時、質問をしたりしていた。</p>
<p>今回の勉強会は質問がたくさん出た。いつもは1-2人が数個といった回数なのに、今回は5-6人から十数個の質問がでて、口頭でもいくつものやり取りが発生した。あとで振り返って考えると、おそらくこれは私が質問をぽんぽんしていたからだと考えられる。</p>
<p>TED に <a href=https://sites.google.com/site/tedjapaneseenglishnote/list/derek_sivers_how_to_start_a_movement>デレク・シヴァーズ 「社会運動はどうやって起こすか」</a> がある。最初のフォロワーが重要という話が出てくる。静かな勉強会で最初に質問するのは勇気がいる。質問して他の人の邪魔にならないか？講師から質問を嫌がられないか？質問が的外れだったら恥をかかないか？など、最初に質問する人が躊躇する理由はたくさんある。私が簡単な質問や的はずれな質問、講義をぽんぽん止めているのをみているうちに、そういうことをやっても大丈夫な勉強会であることが参加者へ自然と伝わる。その結果として参加者から多くの質問が出るような勉強会になったのではないかと考えられる。</p>
<p>質問が多くでる=コミュニケーションが活発だとコミュニティの価値も上がると思う。今後もサポート体制のようなものはうまく仕組み化して勉強会に取り入れていきたい。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0118/>ブロックチェーン考察</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-18
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/blockchain/>blockchain</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て6時半に起きた。昨日はほぼまる一日頭痛でしんどかったけど、寝たら直った。朝から集中してコードを書いてた。</p>
<h2 id=ブロックチェーンは未来なのか>ブロックチェーンは未来なのか</h2>
<p>次の記事を読んだ。</p>
<p><a href=https://shanematsuo.medium.com/%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%83%81%E3%82%A7%E3%83%BC%E3%83%B3-%E8%86%A8%E5%BC%B5%E3%81%99%E3%82%8B%E7%9C%8B%E6%9D%BF%E3%81%AB%E5%81%BD%E3%82%8A%E3%81%AF%E3%81%AA%E3%81%84%E3%81%8B-%E8%AA%A0%E5%AE%9F%E3%81%AA%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AE%E5%BF%85%E8%A6%81%E6%80%A7-fe9f5d38eb37>ブロックチェーン：膨張する看板に偽りはないか - 誠実なプロセスの必要性 -</a></p>
<p>最近、私のタイムラインでも <em>Web 3.0</em> というキーワードをみかけるようになってきて、どうやらこれはブロックチェーン技術をベースにした分散型のなにかを表しているらしい。間違っていたらごめんなさい。暗号資産や NFT といった投機的な目的でビジネスを展開したい人たちも多いようにみえて、真っ当にやっている人たちもいるのだろうけど、儲かればなんでもいいみたいな風潮にみえていて、私の中ではあまり関わりたくないキーワードになってきている。</p>
<p>記事でも書かれている通り、分散と言いながら巨大な台帳になることからインフラを管理できるコンピューティングリソースが大規模化し、運用上は個人がすべてのリソースを保持することは難しいことから、プラットフォーマーや大企業が分散台帳のリソースを管理するような在り方になっていくのではないかと推測する。結局のところ、インフラをすべて大企業が賄うのであれば、そもそも効率の悪いブロックチェーンのような技術を使わなくても既存の中央集権的なシステムで構築する方がはるかに効率的ではないか？という問いに対するアプリケーションの答えは海外送金だけしか私は認識していない。海外送金は中央集権的なシステムが存在してなく、非常にコストが高いため、ブロックチェーン技術で分散台帳を構築しても安価に済む。</p>
<p>いまのところ、グローバルなシステムをブロックチェーン技術をベースにした開発にすることで、各国で独立してシステム開発が進められるメリットがあるという話しでグローバルベンダーはブロックチェーン技術を使ったプラットフォームを開発しているようにはみえる。それはそれで理に適っているようにも聞こえる。一方で個人向けのキラーアプリやキラーコンテンツはまだ私からはみえない。NFT がそれになるのかな？と一瞬思ったけど、ちょっと調べてみただけでは、現時点ではそうなりそうに思えない。研究開発や新しい技術の試行錯誤としてブロックチェーンはまだまだ未知の領域があるのだろうけど、大して便利でも効率がよいわけでもないものを未来であるかのように喧伝しているのは忌避を感じるのでもうしばらくは様子を見守りたい。</p>
<h2 id=会員制バー予約>会員制バー予約</h2>
<p>先日チラシでみかけて <a href=/diary/posts/2022/0113/#会員制バー>会員制バー</a> に申し込みしてみた。おそらく招待会員というサブスクリプションに入ったので試しに行ってみることにした。明日 bizpy の勉強会があるのでそのふりかえりを兼ねて、土曜日に講師のわたなべさんと一緒に行くのを予約した。2018年に神戸に引っ越してきて近くに知り合いがいなくて、その後、地域の勉強会へ行ったり、会社を辞めたりしながら、コロナがあって、なんやらかんやらで近くに一緒に飲みに行ける知り合いができた。初めて行くお店はわくわくする。楽しみだ。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0117/>国民健康保険の保険料</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-17
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て4時に起きて2度寝して7時に起きた。こんなこと滅多にないんやけど、朝からずっと頭痛があってしんどかった。早めにお仕事を終えて帰ったら少しよくなってそのまま寝てた。</p>
<h2 id=国民健康保険の保険料>国民健康保険の保険料</h2>
<p><a href=/diary/posts/2022/0114/#明石市の調査>以前にも書いた明石市長</a> の次のツィートをみかけた。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>国民健康保険の保険料。<br>均等割の金額も、今は自治体ごとの判断。<br>（明石市48830円、神戸市60600円、西宮市53400円など）<br>県からは、増額（56936円への引き上げ）を求められているが、<br>明石市長としては、コロナ禍での増額には反対だ。<br>次年度も増額しないことを、今ここで約束する。<a href="https://twitter.com/hashtag/%E5%9B%BD%E6%B0%91%E5%81%A5%E5%BA%B7%E4%BF%9D%E9%99%BA?src=hash&ref_src=twsrc%5Etfw">#国民健康保険</a> <a href=https://t.co/1SQYbQeXLW>pic.twitter.com/1SQYbQeXLW</a></p>&mdash; 明石市長　泉 房穂（いずみ ふさほ） (@izumi_akashi) <a href="https://twitter.com/izumi_akashi/status/1482904883506212864?ref_src=twsrc%5Etfw">January 17, 2022</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<p>国民健康保険って自治体ごとに保険料が違うんだとか思って、健康保険の仕組みを調べ直した。健康保険制度は大きく分けて2通りある。会社に勤めていない人のための国民健康保険と、会社に勤めている人のための会社の健康保険。うちの会社の健康保険は <a href=https://www.kyoukaikenpo.or.jp/>全国健康保険協会 (協会けんぽ)</a> に加入している。中小企業のデフォルトが協会けんぽなのかな？健康保険の運営者を保険者と呼び、どんな会社でも加入できる保険者として協会けんぽがある。有名な保険者として関東ITソフトウェア健康保険組合があるけど、<a href=https://www.its-kenpo.or.jp/kanyu/kijun.html>関東ITソフトウェア健康保険組合の加入基準</a> を満たさないと加入できない。例えば「被保険者数が20名以上であること」という条件があるので社員数が少ない企業は加入できない。一般論として、健康保険組合の方が協会けんぽよりも保険料が安いという利点があるらしい。そうでなければ、健康保険組合を作ったり、そこに加入する利点も小さくなるし。</p>
<p>会社を辞めたり、定年退職したりすると75歳まで国民健康保険に入る必要があるみたい。住むところにこだわりがなければ、保険料の安い自治体に住んでもよいのかもしれない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0116/>JUnit5 のテスト拡張</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-16
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/testing/>testing</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て5時に起きて2度寝して9時に起きた。前日呑んでたのであまり眠れなくて体調よくない。</p>
<h2 id=junit5-的なロガーのテスト>JUnit5 的なロガーのテスト</h2>
<p>お仕事でログ管理の機能開発をしている。カスタムロガーを使って出力するメッセージを加工している。設計が固まってきて機能も作り込むようになってきたので出力内容が意図した構造化ログになっているかをテストしたい。JUnit5 の機能と log4j の機能を組み合わせてカスタムロガーのテストの仕組みを作ってみた。</p>
<p>まずログ出力した内容を取得するオブジェクトを特定するためのアノテーションを定義する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Documented</span>
<span style=color:#a6e22e>@Target</span><span style=color:#f92672>(</span>ElementType<span style=color:#f92672>.</span><span style=color:#a6e22e>FIELD</span><span style=color:#f92672>)</span>
<span style=color:#a6e22e>@Retention</span><span style=color:#f92672>(</span>RetentionPolicy<span style=color:#f92672>.</span><span style=color:#a6e22e>RUNTIME</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#a6e22e>@interface</span> LoggerTestWriter <span style=color:#f92672>{</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>JUnit5 の <a href=https://junit.org/junit5/docs/current/user-guide/#extensions-registration-declarative>Declarative Extension Registration</a> の仕組みを使って、テストケース非依存な setup/teadown のメソッドを定義する。<a href=https://junit.org/junit5/docs/current/api/org.junit.jupiter.api/org/junit/jupiter/api/extension/ExtensionContext.html>ExtensionContext</a> から拡張するテストケースのインスタンスを取得できる。テストケースインスタンスに定義されている <code>@LoggerTestWriter</code> アノテーションがついたオブジェクトを lgo4j の Appender としてインジェクションするようなコードを setup/teardown (beforeEach/afterEach メソッド) で定義する。Appender のインジェクション周りは <a href=https://qiita.com/kazurof/items/abbd42f11bfc125f3190>Log4j 2でログ出力をテストするサンプルソース</a> の記事を参考にした。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SetupLogAppender</span> <span style=color:#66d9ef>implements</span> BeforeEachCallback<span style=color:#f92672>,</span> AfterEachCallback <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> String APPENDER_NAME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;logger-test-appender&#34;</span><span style=color:#f92672>;</span>

    <span style=color:#66d9ef>private</span> Optional<span style=color:#f92672>&lt;</span>Writer<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getWriter</span><span style=color:#f92672>(</span>ExtensionContext context<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IllegalAccessException <span style=color:#f92672>{</span>
        var testInstance <span style=color:#f92672>=</span> context<span style=color:#f92672>.</span><span style=color:#a6e22e>getRequiredTestInstance</span><span style=color:#f92672>();</span>
        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>var field <span style=color:#f92672>:</span> testInstance<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredFields</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>field<span style=color:#f92672>.</span><span style=color:#a6e22e>isAnnotationPresent</span><span style=color:#f92672>(</span>LoggerTestWriter<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
                <span style=color:#66d9ef>return</span> Optional<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>((</span>Writer<span style=color:#f92672>)</span> field<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>testInstance<span style=color:#f92672>));</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
        <span style=color:#66d9ef>return</span> Optional<span style=color:#f92672>.</span><span style=color:#a6e22e>empty</span><span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>beforeEach</span><span style=color:#f92672>(</span>ExtensionContext context<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
        var writer <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getWriter</span><span style=color:#f92672>(</span>context<span style=color:#f92672>).</span><span style=color:#a6e22e>orElseThrow</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span>
                <span style=color:#66d9ef>new</span> IllegalStateException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;@LoggerTestWriter のアノテーションをもつ Writer を定義してください&#34;</span><span style=color:#f92672>));</span>
        addAppender<span style=color:#f92672>(</span>writer<span style=color:#f92672>,</span> APPENDER_NAME<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>afterEach</span><span style=color:#f92672>(</span>ExtensionContext context<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
        var writer <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getWriter</span><span style=color:#f92672>(</span>context<span style=color:#f92672>).</span><span style=color:#a6e22e>orElseThrow</span><span style=color:#f92672>(</span>IllegalStateException<span style=color:#f92672>::</span><span style=color:#66d9ef>new</span><span style=color:#f92672>);</span>
        removeAppender<span style=color:#f92672>(</span>APPENDER_NAME<span style=color:#f92672>);</span>
        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>writer <span style=color:#66d9ef>instanceof</span> StringWriter<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            var stringWriter <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>StringWriter<span style=color:#f92672>)</span> writer<span style=color:#f92672>;</span>
            stringWriter<span style=color:#f92672>.</span><span style=color:#a6e22e>getBuffer</span><span style=color:#f92672>().</span><span style=color:#a6e22e>delete</span><span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> stringWriter<span style=color:#f92672>.</span><span style=color:#a6e22e>getBuffer</span><span style=color:#f92672>().</span><span style=color:#a6e22e>length</span><span style=color:#f92672>());</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
</code></pre></div><p>実際にテストを書くテストクラスは次のようになる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@ExtendWith</span><span style=color:#f92672>(</span>SetupLogAppender<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyLoggerTest</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> MyLogger logger <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyLogger<span style=color:#f92672>(</span>MyLoggerTest<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>

    <span style=color:#a6e22e>@LoggerTestWriter</span>
    StringWriter writer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> StringWriter<span style=color:#f92672>();</span>

    <span style=color:#a6e22e>@Test</span>
    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testDebugMap</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        logger<span style=color:#f92672>.</span><span style=color:#a6e22e>debug</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;my-message&#34;</span><span style=color:#f92672>)</span>
        assertEquals<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;my-message&#34;</span> writer<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>
    <span style=color:#f92672>}</span>
</code></pre></div><p><code>@ExtendWith</code> で指定した <code>SetupLogAppender</code> クラスの beforeEach や afterEach がそれぞれのテストメソッドごとに呼ばれて、Appender のインジェクションが <code>@LoggerTestWriter</code> のアノテーションをもつ writer を使って行われる。この writer にはログ出力した文字列が記録されるようになる。これで、テストメソッドで logger に対して出力したメッセージを writer から取得できるので意図したメッセージが出力されていることをテストできる。カスタムロガーのテストケースごとに再利用可能な拡張をきれいに実装できた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0115/>ワーケーション延期</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-15
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て8時に起きた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今週も開発に集中していてあまりストレッチができなかった。今日の開脚幅は開始前165cmで、ストレッチ後166.5cmだった。先週と同じぐらい、もしくはちょっとよくなったぐらい。先週から引き続き、ふくらはぎとふとももの後ろが張っている。ここ最近は開発に集中していて1日あたり10-12時間ぐらい椅子に座っているので疲労しているのだと推測する。毎週ストレッチを受けていると疲労改善になってよい。</p>
<h2 id=ワーケーション延期>ワーケーション延期</h2>
<p>これまで <a href=/diary/posts/2021/1225/#ワーケーション準備>準備を進めてきたワーケーション</a> が2週間後になった。もともとこの企画はオミクロン株が発見される前だったので1月末に予定していた。年末年始を挟んでオミクロン株の感染流行を今週みてきて延期することに決定した。<a href=https://web.pref.hyogo.lg.jp/kf16/coronavirus_data.html>兵庫県 新型コロナウイルスの検査・陽性者の状況</a> によると、直近の陽性者数は次のように推移している。2週間後は5,000人ぐらいの陽性者数になるのではないか。諸外国の推移をみていると兵庫県のピークの陽性者数は1日1万人ぐらいまで増える可能性がある。</p>
<ul>
<li>1/10: 167</li>
<li>1/11: 113</li>
<li>1/12: 511</li>
<li>1/13: 903</li>
<li>1/14: 929</li>
<li>1/15: 1191</li>
</ul>
<p>残念だけど、次回の目処は5-6月ぐらいに3回目のワクチン接種を終えてからになるだろう。</p>
<h2 id=呑み>呑み</h2>
<p>21時から勉強会に参加して23時過ぎに終わって晩ご飯食べてなかったので、帰りに仲のよい焼き鳥屋さんのお店に寄って晩ご飯を食べた。26時までやっているので24時頃に言っても普通に食べものを出してくれる。1時間ほど飲み食いして法人決算や消費税、共済のこととかを話してた。マスターも個人事業主から法人成りしたようで、話してみたら私と同じで創業2年だった。業界は違っても行政手続きは共通点も多いだろうから情報共有できそう。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0114/>引越考察</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-14
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/government/>government</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
</span>
<div class=post-content>
<p>0時半に寝て5時半に起きた。昨日からワールドトリガーのエンディング曲で <a href="https://www.youtube.com/watch?v=p0RCsmFAXXY">雲外憧憬</a> を聞いている。歌詞がワールドトリガーの世界観ともあっているし、タイトルの雲外憧憬という言葉に驚いた。四字熟語のように読めるけど、たぶん違う？こんな言葉よく思いつくなと感心してしまった。apple music の英語表記だと Aspiration Beyond The Clouds と訳されている。</p>
<ul>
<li>雲外: 空のはるか遠いところ</li>
<li>憧憬: あこがれること</li>
</ul>
<h2 id=明石市の調査>明石市の調査</h2>
<p>1ヶ月ほど前から <a href=https://twitter.com/izumi_akashi>泉房穂明石市長</a> が twitter を始めた。私のタイムラインでもフォロワーの誰かがいいねしたり、リツィートしたりしてちょくちょくみかける。泉氏の暴言などがニュースで取り上げられたりするので地方都市の市長にしては知名度が高い方だろう。神戸市の隣は明石市なのでご近所の関心はある。明石市は日本の標準時子午線があって、学生の頃に <a href=https://www.am12.jp/>天文科学館</a> にも行ったことがある。いまも成年後見人の弁護士さんの事務所は明石市にあるし、運転免許センターも明石市にあるので年に数回ぐらい行く機会もある。ツィートを眺めていると58歳の市長が初めてやっているにしてはうまく sns を使いこなしていて、始めて1ヶ月ほどしか経っていないのに8万6千人ものフォロワーがいる。ブレーンが優秀なのか、本人がやっているのかはわからないけど、すごいことだと思う。</p>
<p>ツィートは当然、明石市のアピールが主なのでそれを眺めているうちに明石市よいところだなと好感度があがってきた。高齢者向けのサービスを廃止して育児や教育といった子ども向けのサービスを重視していて、それが子育て世帯にうけて、全国でも有数の人口増の中核都市となっている。当然、子育てに関係ない高齢者からは不満の声もあるみたい。私もその方針は支持したいと考えて、年寄りよりも子どもの教育に行政サービスのリソースを集中すればよいと思う。</p>
<p>いま神戸市に住んでいるのは大阪に通勤するためだった。コロナ禍により、フルリモートワークの世の中に移行したので明石市へ引っ越してもよいかもしれないと考え始めた。明石海峡大橋があるところなので実家の淡路島へ帰るのも少し近くなる。軽く検索していくつかみた雰囲気だと、賃貸マンションの家賃も神戸市より割安感がある。比較サイトによると住民税も神戸市より年間2万円安い。ただシェアオフィスの数、起業文化やベンチャー支援みたいなところは神戸市には相当に及ばない。そこは政令指定都市としての面目躍如といったところか。オフィスさえよい場所があったら住居もオフィスも明石市へ引っ越ししてもよいかもしれない。ひとまずアンテナを張っておく。</p>
<h2 id=オフィスの引っ越し>オフィスの引っ越し</h2>
<p>明石市の話とは別に来期のどこかでオフィスを引っ越ししようかとも考えている。いまのオフィスも大きな不満はないので急いではいない。<a href=/diary/posts/2021/0930/#joel-on-software>前に Joel on Software を読んだ</a> ときに窓のないオフィスのストレスについて考えるようになった。気付いたら気付けなかった頃には戻れない。強くはないけど、ストレスの要因はなるべく排除したい。窓以外の不満でいうと働いているうちに備品も増えて部屋が手狭になってきた。引っ越し先候補の1つとして <a href=https://www.regus-office.jp/area-serch/hyogo-kobe-area/kokusai-kaikan/>リージャス神戸国際会館ビジネスセンター</a> がある。問い合わせしたら来週に内覧をさせてくれるらしい。交通アクセスやビルのグレードが高いので賃料もかなり高いだろうけど、他のシェアオフィスとの比較も含めて参考のために内覧してくる。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0113/>師範代としての振る舞い</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-13
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/issue-tracking-system-/>issue tracking system </a>&nbsp;
#<a href=/diary/tags/food/>food</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;
</span>
<img src=/diary/img/2022/0113_mikan.jpg class=post-cover alt=師範代としての振る舞い>
<div class=post-content>
<p>0時半に寝て6時半に起きた。</p>
<h2 id=課題管理システムの使い方指南>課題管理システムの使い方指南</h2>
<p>いまお手伝いしているお仕事はスクラム開発をしている。課題管理システムに <a href=https://backlog.com/ja/>backlog</a> を使っている。アリエルを退職後、この10年、私より課題管理システムを使いこなす開発者をみたことがない。0-9段階で言うと、師範代として私のレベルが8だとすると、他のメンバーは0から2ぐらいのレベルしかない。このぐらいの差がある。0というのはほとんど使っていないという意味。情報共有とは、メンバー全員がいつでもどこでも同じ情報を取得できる仕組みを確立した上で、情報の提供側ではなく、その情報を必要とする受け手が常に最新の情報を取得し続ける運用ができて初めて成り立つ。情報共有を成功させるには受け手の意識の問題が大きい。まずメンバー全員がやっていない時点で情報共有の価値が大きく毀損する上に、受け手が自律的に検索して最新の情報を取得するようにならなけば実務において生産性を向上させることにもつながらない。</p>
<p>役に立つ情報がないから検索しない、検索しないから役に立つ情報を書かないは表裏一体だ。まず役に立つ情報を溜め、受け手が検索して情報収集するようになり、検索の精度をあげるためにカテゴリやタグでラベリングし、業務に活かすために最新情報を更新するようになる。これをチーム全員でやるようになるのは一朝一夕ではできない。</p>
<p>そのため、私は課題管理システムの運用に関して特異な開発者である (言うてもアリエルなら普通) という前置きをした上で、チームの開発者も非開発者も課題管理システムをうまく使えていない。私が課題管理システムをどう使っているのかをみて、開発者が真似して同じように使い始める。そして、非開発者向けにはどう使えばよいかというプラクティスを機をみて提案したり啓蒙したりしている。これは半年から1年かかる作業だと見積もっている。というのは、私が半年ぐらい働いて実践的な課題管理システムの使い方をみせないと多くの人は学べない。半年ぐらい経って、普段私がやっている価値はどういうものかを実際の実務で理解した後、模倣者がやり始めて慣れてくるのに半年ぐらいはかかる。お手本をみせるのに半年、模倣するのに半年で1年かかる。いろんなチームを指導してきたのでチームがどのような学習曲線を辿るかは概ね推測がつく。これをコンテンツにしてビジネスしようといまは考えているので、こういう実践的な機会にコンテンツとしてのノウハウも溜めていこうと考えている。</p>
<h2 id=みかん>みかん</h2>
<p>実家からみかんが送られてきた。実家で作っているみかんなのかな？なんか微妙に腐り始めようとしている雰囲気もある。お正月に帰ったときから実家に置いてあったやつだろうと思う。段ボール箱の空きスペースを埋めるために入ってた <a href=http://www.takosato.shop/shopdetail/000000000067/>「りんちょこ」</a> というお菓子を初めてみた。冬季限定らしい。軽く食べてみると思いの外おいしい。えびせんべいをチョコレートでコーティングしていてチョコフレークの食感に近い。チョコフレークが好きな人にはうけると思う。お土産にもよさそう。</p>
<h2 id=会員制バー>会員制バー</h2>
<p>オフィスの郵便受けに <a href=https://kobe-salon-s.localinfo.jp/>KOBE SALON S</a> という会員制バーのチラシが入っていた。新規会員を募集しているらしい。個人だったら全く興味はないけど、経営していると接待する機会がたまにある。前に顧問さんに経営コンサルティングを受けたときに交際費が少な過ぎるという指摘を受けた。交際費は5年後10年後のお仕事をとるための先行投資もしくは調査費用のようなものだという。そこで今期は交際費の予算に30万円を見積もっているが、現時点で46,971円しか使っていない。4月までにあと2-3件は飲みに行くあてはあるけど、このままいくと30万円は消化できない。コロナ禍というのもあるけど、何もしないと私は交際費を使わないので積極的に使っていく仕組みを作らないといけない。その一環として会員制バーは接待にいいかもしれない。すぐ退会するかもしれないけど、チラシをみた縁で入会してみる。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0112/>BizSTATION Light の初期設定</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-12
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/founding/>founding</a>&nbsp;
</span>
<div class=post-content>
<p>4時半に寝て7時半に起きた。なんか眠れなくてゲームしたり映画みたり記事を読んだりしてた。</p>
<h2 id=bizstation-light-の契約移行>BizSTATION Light の契約移行</h2>
<p><a href=/diary/posts/2021/1230/#bizstation-light>年末に銀行支店で申し込みした</a> Light の新規契約分の書類が届いた。早速 Windows マシンでログインするための初期設定を行った。セキュリティ設定を変更したり、電子証明書を取得したりとけっこう面倒くさい。流れ的にはこんな感じだけど、なんで Web サービスにログインするために OS の設定変更をしないといけないのかみたいなところの抵抗感がある。セキュリティ意識の高い Web アプリケーションの仕組みを垣間みる。</p>
<ol>
<li>OS の事前設定</li>
<li>電子証明書の設定</li>
<li>ワンタイムパスワードのデバイス登録</li>
<li>ログイン用パスワードと取引用パスワードの設定</li>
</ol>
<p>年末年始を挟んだので少し時間がかかるかもしれないと窓口の担当者は言っていたが、そういうこともなく2週間程度で書類が送られてきた。しばらくは有償プランにはせず、無償プランのまま運用する。現時点では、明細が月1-2件ほどしかないので、有償プランが提供する API サービスによる会計システムとの連携をしなくても事務手続きの工数的にもまったく困らない。いずれ明細が増えたときのための準備として契約を移行しておいたという話し。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0111/>log4j2 の yml 設定</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-11
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
</span>
<div class=post-content>
<p>0時半に寝て6時半に起きた。だいぶ開発に集中してきて朝も起きれるようになってきた。</p>
<h2 id=log4j2yml-を読み込む>log4j2.yml を読み込む</h2>
<p>log4j2 のログ設定を整理していて設定ファイルを読み込む順番は次のようにドキュメントに記載されている。java ライブラリのこういった手厚いルールはややうんざりするところもあるけど、是非はともかく、ファイルフォーマットの違い、ファイル名の違いで読み込む優先順位がある。歴史のあるライブラリだから要求を聞いているうちにこんな感じになったんだろうと推測する。</p>
<blockquote>
<ol>
<li>Log4j will inspect the &ldquo;log4j2.configurationFile&rdquo; system property and, if set, will attempt to load the configuration using the ConfigurationFactory that matches the file extension. Note that this is not restricted to a location on the local file system and may contain a URL.</li>
<li>If no system property is set the properties ConfigurationFactory will look for log4j2-test.properties in the classpath.</li>
<li>If no such file is found the YAML ConfigurationFactory will look for log4j2-test.yaml or log4j2-test.yml in the classpath.</li>
<li>If no such file is found the JSON ConfigurationFactory will look for log4j2-test.json or log4j2-test.jsn in the classpath.</li>
<li>If no such file is found the XML ConfigurationFactory will look for log4j2-test.xml in the classpath.</li>
<li>If a test file cannot be located the properties ConfigurationFactory will look for log4j2.properties on the classpath.</li>
<li>If a properties file cannot be located the YAML ConfigurationFactory will look for log4j2.yaml or log4j2.yml on the classpath.</li>
<li>If a YAML file cannot be located the JSON ConfigurationFactory will look for log4j2.json or log4j2.jsn on the classpath.</li>
<li>If a JSON file cannot be located the XML ConfigurationFactory will try to locate log4j2.xml on the classpath.</li>
<li>If no configuration file could be located the DefaultConfiguration will be used. This will cause logging output to go to the console.</li>
</ol>
<p><a href=https://logging.apache.org/log4j/2.x/manual/configuration.html#AutomaticConfiguration>log4j2 Automatic Configuration</a></p>
</blockquote>
<p>普通 java は xml で設定を書くけど、この設定ファイルの読み込みルールをみたら yml にも対応しているならその方がよさそうとか思うやん。log4j2.xml から log4j2.yml に書き換えて試してみると、ログ設定が有効にならない。どうも log4j2.yml を読み込んでいないようにみえる。ググっていると <code>jackson-dataformat-yaml</code> を依存関係に追加しろといった内容をみつかるけど、どういう理屈でそういう仕様になっているのか、まったく理解できない。なによりも読み飛ばしたというログが出力されないから設定ファイルを読んでいるのかどうかすら気付けない。これは知ってないとはまるポイントの1つ。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;dependency&gt;</span>
    <span style=color:#f92672>&lt;groupId&gt;</span>com.fasterxml.jackson.dataformat<span style=color:#f92672>&lt;/groupId&gt;</span>
    <span style=color:#f92672>&lt;artifactId&gt;</span>jackson-dataformat-yaml<span style=color:#f92672>&lt;/artifactId&gt;</span>
<span style=color:#f92672>&lt;/dependency&gt;</span>
</code></pre></div>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0110/>自己肯定感の考察</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-10
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/psychology/>psychology</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て8時に起きた。</p>
<h2 id=自己肯定感高いか低いか>自己肯定感、高いか低いか</h2>
<p>前になにかの記事で読んだことに、自己肯定感が高い人は困難な状況にあってもうまく折り合いをつけてやっていけるという。例えば、パワハラ気質の上司がいても、それは上司がおかしいのだと解釈して、なにを言われても全く自己否定やネガティブな感情にならないという。あるとき、別のイベントで起業家を養成するために幼児の頃から徹底的に自己肯定感を高めるためのカリキュラムを実践しているという話を聞いたことがある。田舎でのほほんと生きてきた人間とは幼児の頃から育ちが違う。</p>
<p>ふと自分の自己肯定感はどうだろう？とか考えるときもある。もうこの歳になって自己肯定感がどうこうで悩んだりすることはないけど、なにか事象が発生したときにまずは自分が悪かったんじゃないかと疑ってかかるところから思考が始まる。ネガティブな事象が起こると、自分が気付けば防げたとか、もっと機転を利かせばうまく対処できたんじゃないかと考えたりする。自己評価は5段階なら、自分で振り返って不満がなかったら3で、なにかあったら2をつける。そのため、多くのケースで360度評価が乖離する。たまたま野球部だったせいもあるかもしれないけど、基本的に監督に叱られるのが普通のような感覚をもっている。もっと言うと、他人から褒められた経験があまりないから褒められてもどう反応していいかもわからない。嬉しくないわけではないけど、相手に気を遣わせてしまって申し訳ないなとか思うこともある。</p>
<p>良くも悪くも私は他人に関心がないし、他人からの評価にはもっと関心がない。自分が取り組んでいる課題を自身の基準でうまくできたかどうかにしか興味がない。わりと他人に素っ気ない態度をとってしまうときもある。一方で他人から咎められると一通り自身の基準に当てはめて理が通っていればへこむときがある。褒められてもそれほど嬉しくないのに咎められたらへこむというのは、自己肯定感の高低によって変わったりするのかな？とか考えたりしていた。言うても、もうこの歳になると褒められることも咎められることもないのであまり気にする機会すらないのだけど。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0109/>進撃の巨人をみてた</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-09
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/commic/>commic</a>&nbsp;
#<a href=/diary/tags/animation/>animation</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て8時に起きた。</p>
<h2 id=進撃の巨人>進撃の巨人</h2>
<p><a href=https://shingeki.tv/final/>進撃の巨人</a> の最終章の第2クールが始まるみたい。去年、マガジンの連載であと数話で終わりと発表があって、その後、最終話がマガジンに掲載されたときに漫画喫茶で完結したのを読んだので結末がどうなるかはもう知っている。懐かしかったので過去の話しをいくつかみていたらついつい見続けてしまった。アニメは話の展開がスムーズなせいか、視聴者を飽きさせずに次の展開へ引き込める気がする。進撃の巨人は不思議な作品で、初期のときは世界観にすごく衝撃を受けて楽しみにして漫画を読んでいたが、途中から組織のどろどろした内部抗争になって興味が失せてしまった。そして、その後、外の世界のもっとどろどろした国家間抗争になってしまってさらに興味が失せてしまった。何よりも漫画で読んでいると文章が多くて読むのに疲れる漫画になってしまった印象を受けていた。複雑な設定を追加したことで必然的に説明が増えてしまった。アニメをみていてそこまで説明調の台詞が気にならなかったのは制作スタッフがうまく作っているのだろうなとは思えた。完結して振り返ってみると、(私の好みではなくなったけど) 話の展開も伏線の回収もうまくて見事な物語になったなぁと思う。単行本の一気読みやアニメをまとめて見るとすごくおもしろいようにも感じる。こんな複雑なややこしい物語をちゃんと完結させたというところだけでも素晴らしい作品だとは思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0108/>初詣</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-08
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て3時に起きて、2度寝して9時ぐらいに起きた。前日はあまり寝てなくてバテてたんでよく寝てた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>年末年始を挟んでやや忙しかったのとだらけてたの2重奏であまりストレッチができなかった。今日の開脚幅は開始前164cmで、ストレッチ後167cmと12月よりもかなり数値が悪くなってしまった。気温が下がって寒くなってほとんど外に出掛けなくなってそれも悪影響を及ぼしているのかもしれない。また右足の内転筋まわりの張りが大きくなっているのを実感している。新年になって心機一転して日常生活を改善していかないといけない。</p>
<h2 id=初詣>初詣</h2>
<p>気分転換に <a href=https://www.minatogawajinja.or.jp/>湊川神社</a> に初詣してきた。JR 神戸駅のすぐ近くにある。歴史が好きな人なら南北朝時代の武将、楠木正成公を祀っている神社として有名みたい。足利尊氏と戦って敗れた最後の地として <a href=https://ja.wikipedia.org/wiki/%E6%B9%8A%E5%B7%9D%E3%81%AE%E6%88%A6%E3%81%84>湊川の戦い</a> の「湊川」がこの辺りになるらしい。なので楠木正成の墓所も境内に含まれている。立派な門構えでよく前を通る度にみかけてはいたけど、実際に参拝するのは初めてだった。境内も普通の神社の2-3倍ぐらいは広くて立派な装いをしている。江戸時代に徳川光圀公により立派なお墓が建立され、幕末には維新志士から崇敬の対象となって明治維新の尊王思想にも影響を与えたといったことが掲示されていた。時の権力争いの戦に敗れた武将がいろいろあって主祭神として立派な神社を構えているのも時代の流れを感じた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0107/>「聞かなくてもわかる」という価値観</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-07
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/information-exchange/>information exchange</a>&nbsp;
#<a href=/diary/tags/communication/>communication</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て3時に起きた。4時までドラクエタクトしたりもしてたけど、夕方に PoC のデモ打ち合わせがあるのになにも準備できてなくて不安で起きて5時からお仕事してた。久しぶりに早起きしたせいか、打ち合わせ終えたら眠いからすぐに帰って、夜はオンライン飲み会しつつくつろいでいた。</p>
<h2 id=情報共有とコミュニケーションコスト>情報共有とコミュニケーションコスト</h2>
<p>課題管理システムのことを考えていてふと思いついたことを書き出す。私からみると、多くの人たちは「聞かなくてもわかる」という価値を過小評価しがちである。というのは、その価値を定量化するのは難しいので評価されにくい。そうすると、評価されないことはやらないといった合理的な働き方をすればそうなるのは理解できる。しかし、私はその価値を理解しているので軽く考察してみる。</p>
<ol>
<li>聞けない</li>
<li>聞けばわかる</li>
<li>聞いてもわからない</li>
<li>聞かないとわからない</li>
<li>聞かなくてもわかる</li>
</ol>
<p>情報共有の過程でパッと思いつくことを段階ごとに書いてみた。1に近い方が容易で5に近い方が難しいという難易度を表しているとも言えるし、組織の情報共有のレベルを表しているとも言える。少し言葉を補うと次のように解釈してもよいだろう。</p>
<ol>
<li>(メンターが気難しくて/メンターに無能だと思われたくなくて) 聞けない</li>
<li>(メンターに余裕があって) 聞けばわかる</li>
<li>(メンターのスキル不足で/担当者が退職してて) 聞いてもわからない</li>
<li>(背景が文書化されていなくて) 聞かないとわからない</li>
<li>(課題管理システムを検索すれば) 聞かなくてもわかる</li>
</ol>
<p>昔は1のような状況を発生させる人もちょくちょく職場にいた気がするけど、いまは淘汰されてあまりみかけない。多くの組織は3か4ぐらいのレベルだろう。5まで達している組織は少ない。課題管理システムについて議論していると、たまに「知っている人に聞けばいいじゃない？」という意見があがる。この質問をしている時点で目指している働き方のレベルや生産性が大きく異なっていることがわかる。というのは、他人に聞くというのはコミュニケーションコストが非常に高い。これは他人に聞くなと言っているわけではない。他人に聞かないといけないことを減らすことで生産性を上げるという話しをしているだけだ。他者へ同じ情報を伝えるのに1時間の打ち合わせが済むのか、3時間の打ち合わせを要するのかという比較をしている。当然、打ち合わせ時間を減らしても伝えられる情報量が同じであれば打ち合わせ時間は少ない方が望ましい。そういう話しをしている。</p>
<p>5のレベルに達していれば、例えば、いまのシステムの仕様はなぜこのようになっているのか？変更するとしたら影響範囲はどのぐらいか？どういったモジュールに注意して改修すればいいか。もちろん前任者やリーダーに聞けばわかるだろう。聞くために打ち合わせの予定を調整するかもしれない。するとリーダーは忙しくて時間を調整できるのは来週になるという。もし課題管理システムにそういった情報が残っていれば、来週まで待つ必要がなくなる。理想的にはリーダーとの打ち合わせも必要なくなる。リーダーは他に重要な業務に時間を割ける。これが「聞かなくてもわかる」という価値である。</p>
<p>昔はなんらかの理由で1の状態にあった組織において、職場の風通しがよくなると、コミュニケーションコストを軽視しがちになる。職場の風通しがよいことは重要だが、打ち合わせや会議ばかりするようになると、キーパーソンの時間を湯水のように使う。キーパーソンはすぐに会議だらけになって物理的に実務ができなくなって、結果的に生産性や品質が下がる。ここで重要なのは権限委譲だが、この話しは長くなるのでここで筆をおく。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0106/>朋あり遠方より来る</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-06
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/marketing/>marketing</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。起きてはいるんだけど、寒いから布団にくるまってネットで記事を読んだりして7時ぐらいまでだらだらしてしまったりしている。結果として始業時間が遅くなって生産性が下がる。</p>
<h2 id=近況報告>近況報告</h2>
<p>ありえる時代の元同僚のかわのさんから連絡があった。<a href=https://www.littlehelp.co.jp/>Little Help Agency LLC</a> というマイクロ法人を経営している。1人でやってて、自社サービスで、起業後1年ですでにお客さんが100社を超えているらしい。手放しですごいと言っていいと思う。たまたまお客さんからこんなシステムを開発してほしいという依頼案件があって、うちで受託開発を受けられないかというお話しだった。残念ながら、私も新しいお仕事を始めたばかりなのと、自社プロダクトの開発にも時間を割いていきたい背景もあるので、お手伝いをするお仕事は慎重に検討してからにしている。軽く打ち合わせして物理的な制約と業務のマッチングを考慮すると、今回はお手伝いできませんという結論になった。とはいえ、またいつか一緒にお仕事する機会もあるかもしれない。自分の知っている人たちが活躍しているのを聞くのは嬉しいし励みにもなるな。</p>
<p>かわのさんは、まったくリアクションしないけど、私の facebook の投稿を読んでいると話していた。承認欲求のために facebook やっているのに「いいね」しろよとか思いつつも、そうやってなにかしら書いていると読んでくれている人がいるんだなとわかった。前に何かの記事でブログなどを読んでいると読者が著者に親近感を抱きやすいと書いてあった。もしかしたら、かわのさんが私に連絡してくれたのもそういう効果があったのかもしれない。ここに日記を書くのも自分のためではあるけれど、いつか起点となって縁がつながるのかもしれない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0105/>datadog のログ管理</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-05
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/datadog/>datadog</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時に起きた。昨日は早く寝たので早く起きた。</p>
<h2 id=ふりかえり>ふりかえり</h2>
<p>お仕事でのスクラムのふりかえり。<a href=/diary/posts/2021/1222/#課題管理システムを一本化する>課題管理システムの一本化</a> や <a href=/diary/posts/2021/1224/#slack-のマルチチャンネルゲスト>slack のマルチチャンネルゲスト移行</a> について、メンバーのよかったコメントがいくつか出た。私は経験者なので、これらの結果がどうなるかは最初からわかっていて、移行中に運用面からもあれこれプラクティスを提案しながら結果が出やすいようにサポートしていた。まだまだもっとうまく運用できるけれど、経験則では、他のメンバーの運用がついてくるには半年ぐらいかかるだろう。仕組みを取り入れただけではまだ効果が半分で、適切な運用を継続することでさらにその効果を実感できるようになる。これからも注力していく。</p>
<p>ともあれ、私がお手伝い始めた初日から非効率だと考えていた3大課題のうちの2つは2ヶ月経って対応された。ついでに書いておくと、最後の1つはカレンダー共有の課題がある。お手伝い先の社内で使っているカレンダーを協力会社のメンバーはみることができない。その逆も然り。したがって、正社員と協力会社でカレンダーを共有できない。これがスケジュール調整コストやコミュニケーションコストを高くしている。カレンダーを共有していると、例えば、slack でメンションして予定が入っていないならすぐに返信がくることを期待するけど、会議中だったらその会議が終わってからかな？といった予測が働く。仮に会議が3つ連続していれば、PR のレビューはすぐできないだろうと推測される。プロジェクトメンバーでカレンダーを共有できないと、相手の行動予測の精度が下がり、結果としてコミュニケーションコストが高くつく。</p>
<p>生産性をあげるには特別なことをやらなくても、当たり前のことを当たり前にしていくだけでも効果がある。同じ職場でずっと働いていると、当たり前じゃないことがわからなくなってしまって非効率になってしまうことも多々ある。そういうところは外部の人間が指摘することで改善できる余地となる。</p>
<h2 id=datadog-のログ管理>datadog のログ管理</h2>
<p>お仕事で datadog の <a href=https://docs.datadoghq.com/ja/logs/>ログ管理</a> 機能を調べている。メトリクスしか使ったことがなかったけど、ログ管理も一通りの機能は揃っていていろいろできる。なぜか私が手伝う会社は datadog を使っていて、他のサービスも試してみたいという気持ちもあるんだけど、やっぱり datadog は優れたサービスということなのだろうか。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0104/>仕事始め</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-04
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/tax/>tax</a>&nbsp;
</span>
<div class=post-content>
<p>3時に寝て6時半に起きて2度寝して7時半に起きた。お正月にだらけたのですぐ起きれなかった。</p>
<h2 id=仕事始め>仕事始め</h2>
<p>今日から仕事始め。お昼におにぎりを買いに外を歩いたけど、あまり人気がなかった。14時過ぎに散歩がてら <a href=https://ikutajinja.or.jp/>生田神社</a> へ初詣に向かったが、なかなかの混雑ぶりで断念した。初詣失敗。普通の休日の3倍ぐらいはいたんじゃないかと思う。神社は学生さんも多いとは思うけど、まだ休み中の人も多いのかもしれない。</p>
<h2 id=償却資産の申告>償却資産の申告</h2>
<p>固定資産税を支払う根拠となる固定資産台帳の内容を申告した。毎年1月1日時点の償却資産を1月31日までに申告する。去年は紙の書類で行った手続きを、今年は <a href=https://www.eltax.lta.go.jp/>eLTAX</a> (ダウンロード版) でオンライン手続きした。神戸市は事前にプレ申告データとして去年の申告データを送ってくれるので、それを再利用して手続きをすると去年時点のデータ入力の手間を省ける。実際に手続きしてみたら紙の書類そのままの画面が表示されて、空き項目を埋めていくだけだった。ほんの10分で入力を完了した。あとはマイナンバーカードを使って電子署名して送信するだけ。送信後、受付のメッセージが返ってくる。なにか不備があれば、データチェックをしているオペレーターから数日以内に電話がかかってくる。かかってこなければ問題ないということ。</p>
<p>関連する話題として、<a href=https://www.nta.go.jp/taxes/shiraberu/taxanswer/hojin/5408.htm>No.5408 中小企業者等の少額減価償却資産の取得価額の損金算入の特例</a> という制度がある。通常、減価償却対象となる固定資産の基準額は単品で10万円になるが、この中小企業向けの特例を用いると30万円を基準額にできる (合計で300万円まで) 。パソコンなどのデバイスは10万円を超えることも多い。そういった固定資産を複数年で減価償却しなくても取得年度で即時償却できる。具体的にはその事業年度で利益がある場合は経費が増えることになるので法人税や地方法人税 (名前に「地方」という文言が入っているがこれは国税) といった国税の節税となる。</p>
<p>他方で、償却資産に対して固定資産税という地方税がある。償却資産として毎年1月に申告する。これは特例で即時償却した固定資産に対しても適用される。例えば、神戸市では次の FAQ に特例とは関係ないという注意書きがある。償却資産の合計金額が150万円未満のときは免税となる。小さい規模の企業なら免税になりやすい制度にみえる。</p>
<blockquote>
<p>※租税特別措置法の規定により中小企業者等の少額資産特例を適用して損金算入した資産については申告の対象となります。</p>
<p><a href=https://www.city.kobe.lg.jp/a03858/kurashi/tax/kotei/shokyakushisan/syokyaku_faq.html#midashi93387>Q.申告の対象にならない資産は、どのようなものがありますか。</a></p>
</blockquote>
<p>国税と地方税の違いを理解していないと調べ方を誤る懸念がある。国税庁のサイトには国税のことしか書いていないし、地方税のことは地方自治体のサイトにしか書いていない。というか、私は国税だけを調べて地方税の扱いを誤解していた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0103/>帰省のUターン</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-03
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/agriculture/>agriculture</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/animation/>animation</a>&nbsp;
</span>
<div class=post-content>
<p>3時に寝て7時に起きた。新撰組の時代劇をみてたら遅くなった。お正月っぽい感じ。午前中に <a href=https://www.asahi.co.jp/potsunto/>ポツンと一軒家</a> の再放送を少しみた。この番組はもはや家族紹介の番組になっていてほのぼのするコンテンツになっているなと思えた。</p>
<h2 id=田んぼ作業>田んぼ作業</h2>
<p>草場になる前の田んぼをトラクターで耕した。スケジュールの都合上、3日しか空きがなかったけど、昨晩ふらっと雨が降って土地が湿り、今朝は天気もよく寒さも和らいでちょうどよかった。日頃の行いがよいみたいな話し。野菜を植えていない空きスペースなので耕す面積は少ない。8時半ぐらいから作業を始めて10時半には完了した。今回は草刈り代わりに耕しているだけなので手間がかからない。アルミブリッジを使って少し段差のある隣の田んぼも耕したいという意図もあるのだけど、事前に軽油を購入しておくのを忘れててあまり燃料がなかったので断念した。冬はあまり草が生えることもない。また春にやり直すのでいいだろう。</p>
<p>作業前</p>
<figure><img src=/diary/img/2022/0103_field_before.jpg>
</figure>
<p>作業後</p>
<figure><img src=/diary/img/2022/0103_field_after.jpg>
</figure>
<h2 id=uターン>Uターン</h2>
<p>午後から高速バスで三ノ宮に戻る。バスの停留所で待っていたら列が並び始めて40人ぐらいと見積もっていた。バスに乗車すると、乗車人数は39人と運転手さんが無線でやり取りしているのが聞こえた。前の停留所から乗ってきた人たちが7人なので、私と同じ停留所で乗った人は32人になる。見送りで一緒に並んでいた人たち (家族の付き添いとか) が数人というのは理屈にあうので、私の目算の40人ぐらいというのはそこそこ信用できる数字だったなと胸を張ってみた。その後も運転手さんが業務連絡で、どこそこの停留所で何人ぐらい待っているかをやり取りしていた。私が載っているバスで43人までは乗せたが、それ以降は臨時バスを出したようで、その後の停留所では別の臨時バスが乗客を乗せていた。高速バスは乗れないとお客さんからのクレームが厳しいと推測する。乗客が1台のバスから溢れそうなら臨時バスを出している。それはバス会社のスタッフが事前に停留所で数えたりして無線でやり取りしながら判断しているみたい。バスの停留所にチェックインする仕組みがあればリアルタイムに乗車人数をカウントして人間が人数を数えるみたいなことはしなくていいんじゃないかとか考えたりしてた。</p>
<p>お手伝い先は今日から働いている人もいたので、バスの中でコードレビューしたり、レビューの指摘事項を修正したりしながら軽く仕事始めのリハビリみたいなこともしてた。</p>
<h2 id=86エイティシックス>86―エイティシックス―</h2>
<p>以前 <a href=/diary/posts/2021/1010/>86―エイティシックス―</a> の第2クールが始まることについて書いた。戻ってきてから、その第21話をみた。dアニメストアでみているので1週間遅れてみている。ここ最近は隔週放送になっていたから、なんとなく制作が難航しているのだろうとは伺えた。<a href="https://anime-86.com/news/?id=59533">22話・23話の放送日時に関してのお知らせ</a> で最終2話が3月以降に延期された。盛り上がってきたところ、残念だけど、職業がら人手不足な現場に感情移入するところもあるので、制作スタッフの方には無理のない形でがんばってもらえればと思う。最初のうちはあまりおもしろいとは感じていなかったけど、音楽と世界観が好きで見続けているうちに思い入れもできてきて、全体としてはよいアニメだと思う。あまりネタバレにならないよう、第2クールの本編とは直接関係ないところの話しをする。第2クールで登場するエルンストという暫定大統領がかっこいい。国家の命運を左右する作戦が失敗しそうになったときに次の台詞がある。</p>
<blockquote>
<p>僕なんかを大統領に据え続けた、それが君たちの責任だ。</p>
</blockquote>
<p>エルンストは (おそらく) 政治能力に長けていて、且つ人格者なんだけど、ちょっと狂気な思考をもつ人物として描かれている。しかし、だからこそ、自分よりも有能な為政者が統治すべきだと自覚していて、他に適任者がいないから仕方なく自分が長期間責任者をやっているといった設定？になっている。そういう多くの人の期待に応えているうちに精神がすり減っていく、関わる人が増えれば増えるほど、しがらみが大きくなっていく世の中の常みたいなものを伺えて、最後の最後は自分の精神を守るために何がなんでも期待に応えるという考え方よりも、自分なんかを責任者にした人たちが悪いという考え方で自分の精神を守ることに共感できた。現実として、すべての期待には応えられないし、すべての人の利害調整なんかもできない。責任のあるポジションでお仕事するとぶつかる課題だと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0102/>電源アダプター入手</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-02
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/device/>device</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<img src=/diary/img/2022/0102_adapter.jpg class=post-cover alt=電源アダプター入手>
<div class=post-content>
<p>3時ぐらいまで本を読んでて、それから寝て8時に起きた。</p>
<h2 id=usb-c-の電源アダプター>USB-C の電源アダプター</h2>
<p>大晦日、高速バスの乗車待ちの列に並んでいるときにふと気付いた。macbook の電源アダプターを持ってくるのを忘れた。その後の予定も詰まっていたので今更取りに帰るわけにもいかない。これまで10数年帰省してきて1度も忘れたことはなかったが、人間の注意力に頼っていると、いつかは失敗するというよい事例だ。完璧に自分の不注意で電源アダプターをバッグに入れ忘れた。反省はあとでやるとして、列に並びながら amazon のサイトをスマホで開いていた。検索すると、手ごろな価格帯で類似品がいくつか出てくる。調査する時間の余裕がなかったのであまり迷わず互換性があると書かれたものを選択した。3,588円。12月31日の15時過ぎに注文して1月2日の9時半に実家で受け取った。見た目は macbook の電源アダプターとほぼ同じ。この日記は購入した電源アダプターにより充電開始した macbook で書くことができた。お正月にも関わらず届けてくれた物流センターや宅急便の関係者に感謝。</p>
<p><a href="https://www.amazon.co.jp/gp/product/B095JGC2J1?&linkCode=li2&tag=t2y-diary-22&linkId=f17f72b5b69b4ead4247a593fd04e931&language=ja_JP&ref_=as_li_ss_il" target=_blank><img border=0 src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B095JGC2J1&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=t2y-diary-22&language=ja_JP"></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=t2y-diary-22&language=ja_JP&l=li2&o=9&a=B095JGC2J1" width=1 height=1 border=0 alt style=border:none!important;margin:0!important></p>
<h2 id=バッタを倒しにアフリカへ>バッタを倒しにアフリカへ</h2>
<p>時間があるのと中盤を過ぎたのもあって一気に「第7章彷徨える博士」「第8章「神の罰」に挑む」「第9章我、サハラに死せず」「あとがき」と読み終えた。本書を読み終えてから著者のブログ記事である <a href=https://otokomaeno.hatenablog.com/entry/2021/10/30/170343>『バッタを倒しにアフリカへ』行き、必殺技を見つけてきました</a> を読むとまた違った印象を受ける。本書は著者の研究成果として論文を書くための、下積みの期間の物語と言える。アフリカへ行き、フィールドワークを通じてバッタのデータを収集し、研究資金が底をつきながらも著者の熱意や活動により、研究資金を得て、研究に専念するための環境を、文字通り、自ら作り上げていったという、言わば、著者がこれから評価を得るであろう研究の序章のような位置付けになる。あとがきでも研究内容の詳細は意図的に書いていないと書かれており、それは論文として提出できていれば詳細を書けるが、執筆時点では論文を完成させていなかったので詳細を伏せたとある。</p>
<p>著者は研究資金を得る活動の一環として広報活動やネット上の露出もあったため、そういう活動は時間を取られるため、研究に集中できない期間もあったことが伺える。2018年からSNS断ちして3年間、研究に没頭して論文を仕上げたというのも理解できる。また SNS でファンが増えるにつれ、誹謗中傷も増え、多くの励ましよりも数少ない誹謗中傷で傷つくといった話題も出てくる。私も SNS は時間の無駄だと考え、なるべく利用を減らそうとしているが、暇なときや時間つぶしにはよいサービスであることも確かでなかなか SNS と縁切りするところまではいけていない。</p>
<p>閑話休題。後半は著者の熱意に感情移入して研究がうまくいくといいなと応援しながら読み進めていた。研究がうまくいきそうな雰囲気のところで本書が終わってしまう。おそらく論文発表を一通り終えたら詳細も含めて続編を書いてくれるようだが、それはもう数年、もしかしたら10年以上先のことになるのかもしれない。著者は1980年生まれと私と1つしか違わない。40歳を過ぎて、私も周りもミドルエイジクライシスに悩む人たちをみかけるようになった。本当に価値のあることや世の中の役に立つことを研究できるのは著者にとっても幸せなことだろうというのがひしひしと伝わってくる。誰でもできるお仕事は基本的に受けるつもりはなく、自分の目指すキャリアにつながるお仕事、もしくはやる価値があると自ら判断したお仕事しかしないようにこの1年で方針を調整してきた。なにか新しいことに挑戦してみようという人にとって本書は勇気をもらえる内容だったと思う。</p>
<h2 id=お風呂>お風呂</h2>
<p>実家の近くで <a href=http://awajiinfo.com/uzusio-onsen/>うずしお温泉</a> という温泉が湧いていて、実家に帰ると銭湯へ行く感覚で温泉に入っていたりする。昔からあまり温泉を特別なものに感じていないのは地元にあって珍しくなかったからかもしれない。夜に入りに行って出てから少しストレッチをしてた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2022/0101/>寝正月</a>
</h1>
<div class=post-meta>
<span class=post-date>
2022-01-01
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時に起きて2度寝して7時半に起きた。マンションより実家の方が部屋の中は寒い。</p>
<h2 id=古札の返納>古札の返納</h2>
<p>うちは厄年を気にする家で親が厄払いにいかないとうるさいので前厄・本厄・後厄の3年間、毎年厄払いのお札を授かっていた。近所に <a href=https://ykoj.jp/>薬王寺</a> という厄除で有名なお寺がある。今年は後厄のお札を返納するだけなので時間もかからずすぐに終えることができた。その後、ついでに初詣も行こうかと <a href=http://www.freedom.ne.jp/onokoro/>おのころ島神社</a> に行ってみた。参拝するのに100-200人ぐらい並んでいた。そんなに列も進むようにはみえなかったのでたこ焼きだけ買って離脱した。初詣はまた神戸に戻ってからにしよう。</p>
<h2 id=バッタを倒しにアフリカへ>バッタを倒しにアフリカへ</h2>
<p>家に戻ってきてとくにやることもないのでテレビを眺めながら本を読む。「第4章裏切りの大干ばつ」「第5章聖地でのあがき」「第6章地雷の海を越えて」を読んだ。macbook の電源アダプターを持ち帰るのを忘れてきたのでスマホで kindle 本を読んでいる。これまで読んだことなかったけど、他に利用できるデバイスがなかったら読めるもんだなと小さい画面に少ない文字ながら読み進めた。</p>
<p>印象に残った内容を書いていく。干ばつで国中が大変な状況でもモーリタニアは隣国の難民を受け入れていたというエピソードが出てくる。イスラム教の宗教的背景などもあるんだろうなと思いながら読んでいた。日本はいま自己責任が強くなってしまって若ものが困窮していても助けを求めないというニュースを見かけたりもする。一面だけをみてどうこう言うのも適切ではないけど、豊かさとはなにかを考えさせられた。フランスの研究機関へ行った時にファーブル昆虫記のファーブルさんの生家を尋ねたエピソードも出てくる。私はファーブルさんのファンでもないのでとくに感銘を受けることはないけど、著者の思い入れが伝わってくるのでよかったなぁと思いながら読んでた。その後、バッタの群れをみつけて追跡するところとか、1-2年かけて調査してとうとうみつけたのかなと感慨深かった。現地の人から言うと大した群れではないとか、地雷原の先へ逃げられてしまって途中で追跡を断念したり、不完全燃焼ではあったけど、最初はそんなもんで地道にやっていくしかないというところも現実に即した内容でよかったと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1231/>大晦日の帰省</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-31
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。朝活やってからまたちょっと寝てた。午後から高速バスで実家に帰った。</p>
<h2 id=朝活-バッタを倒しにアフリカへ>朝活: バッタを倒しにアフリカへ</h2>
<p><a href="https://www.youtube.com/watch?v=WRW2MIbe3uc">金朝ツメトギ 2021-12-31 AM 6 金曜朝6時開催のもくもく会</a> に参加した。厳密には朝活のときは、はらさんの振り返りを聞いてた感じで、終わってから「第2章アフリカに染まる」「第3章旅立ちを前に」を読んだ。アフリカでの生活のあれこれが書いてあって、日本に住んでいる自分からは斬新でおもしろい。なにかの記事でアフリカが経済発展しない理由の1つに賄賂や汚職が横行していて云々みたいな記事を読んだことがある気がするけど、本書の中でもちょくちょく賄賂を要求されたり、不正に給料をもらおうとぼったくりされたこととかが書いてある。日本人からみると賄賂やぼったくりの金額もそんなに高くないので払ってしまったりしてそれが返って社会に歪みを与えてたりするのかな？とも思えた。</p>
<p>モーリタニアの公用語がフランス語で著者は英語しか話せなくて、言葉の通じない国で現地の人たちと仲良くなるのは相当の苦労が忍ばれる。著者は文章を読んでいてもおもしろい感じだけど、言葉のスキルとは別にコミュニケーション能力が高い人なんだろうということも伺える。言葉が通じなくても仲良くなれる雰囲気の人はいると思う。あとは日本と比べると生活環境がよくなくて、いまの自分は外国で暮らすとかできないだろうなと読んでて思うこともあった。</p>
<h2 id=高校の同級生と飲む>高校の同級生と飲む</h2>
<p>毎年、大晦日に集まって近況報告をしたりしてた。コロナ禍があって自粛していたので3年ぶりに集まった。とくに変わりなくみんな元気でいた。18時頃から飲みながらだらだらしてた。私は前に焼き鳥屋さんのマスターのおすすめで飲んだ <a href=/diary/posts/2021/1109/#呑み>だいやめ</a> を持っていった。そのとき飲んだお湯割もおいしかったけど、今回はソーダ割りを試してみて、それもおいしかった。友だちも初めてだいやめを飲んで、これ芋焼酎なの？と驚いていた。初めて飲んだら驚くという意味でもこの焼酎はお土産に向いている。</p>
<p>友だちの1人はゴルフにはまっているという話。調子がよかったら80台でまわれるぐらいで、私にはわからないけど中級者と言えるだけのレベルに達しているらしい。ゴルフは接待や出世のためのツールみたいなイメージが私にはある。したがって私とは無縁でやることはないような気がする。かなり歩くから健康のためにもよいという話もあるのでゴルフ自体を忌避しているわけでもない。スポーツとして楽しんでやっているのはよいと思う。</p>
<p>夜はテレビで RIZIN をみていた。出場している選手は全然わからないけど、大晦日っぽいなと思いながらみていた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1230/>銀行での手続き</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-30
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/founding/>founding</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。10時に銀行へ行く予定があったから普通に起きて8時にはオフィスにいた。予定があればちゃんと起きれるのに休日はだらけてしまう。午後から気分転換に漫画喫茶へ行ったら満室で入れなくて、そのまま帰ってだらだらしてた。</p>
<h2 id=bizstation-light>BizSTATION Light</h2>
<p><a href=https://bizstation.bk.mufg.jp/bizlight/index.html>BizSTATION Light</a> (以下light) という無償サービスを使っているが、このサービスは契約時に OS 縛りがあって macOS と Windows のどちらかでしか使えないサービスとなっている。誤った意識の高さでセキュリティを考えたような制約にみえる。しかし、現状そうなっているので仕方ない。これまで macOS でサービスを利用してきたが、Windows マシンを購入したのでこのサービスも Windows に切り替えることにした。なぜ macOS だとダメかというと、<a href=https://bizstation.bk.mufg.jp/bizstation/index.html>BizSTATION</a> という有償サービスがある。月々1,760円を支払うと light よりも高機能なサービスを受けられる。macOS でも利用できるのだけど、macOS の場合、有償でも API サービスを利用できない。Web サービスでありながら OS で認証方式を変えているため、その仕様制限で API サービスは利用できないという理屈になるらしい。API サービスを利用できなければ会計システムと連携できないため、これまで light しか使ってこなかった。Windows マシンを購入したのでこの機会に macOS から Windows へ契約を変更することに決めた。</p>
<p>ここで macOS から Windows への変更は既存契約を解約して新規契約を結ぶという手順になるらしい。同じ会社・口座なのに OS の変更すらできないというのは不便で、新規契約なので登録手続きに3週間ぐらいはサービスを利用できない期間ができる。いま API サービスを使っていないから全く問題ないけど、こういう利便性の悪さからも有償サービスに切り替えるモチベーションをなくしてしまった。というのは、API サービスなしで1年以上やり繰りしてきて、いまお金を払えば API サービスを利用できると言っても現時点では別に困らないから不要だと考えている。いずれ必要になる可能性もあるので、いまのうちに Windows マシンに契約を切り替えておこうと考えた次第。</p>
<p>昨日、準備した <a href=/diary/posts/2021/1229/#経営セーフティ共済の前納>経営セーフティ共済</a> の前納付の書類もついでに確認してもらって問題なしということでそのまま提出してきた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1229/>年末の事務手続き</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-29
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時に起きて2度寝して8時に起きた。昨日と全く同じような起き方でだらけてきた。一昨日に作成しておいた PR が approve されたので、お昼にマージしてその続きのコードもちょっと書いたりしてた。</p>
<h2 id=経営セーフティ共済の前納>経営セーフティ共済の前納</h2>
<p>昨年度から経営セーフティ共済に加入している。3月に前納 (一括納付) しているので、今年度も同様に <a href=https://www.smrj.go.jp/kyosai/tkyosai/customer/procedure/installment/02.html>掛金の前納</a> を行う。前納は明示的に申請しない限り、期間が過ぎると月々の支払いに変更されてしまう。決算月で前納するかどうかで経費の損金算入のタイミングが変わってきて、法人税の税金の支払いに影響がある。ある記事によると、2ヶ月前から手続きできると書いてあった。それが正しいなら1月からとなってしまうけど、中小機構のサイトの説明にはいつから手続き可能とは書いていない。ひとまず書類をダウンロードして必要事項を記入した。明日、別件で銀行に行く機会があるので、ついでに前納手続き可能なら書類を提出してくる。</p>
<h2 id=oculus-link-のセットアップ>Oculus Link のセットアップ</h2>
<p><a href=/diary/posts/2021/1103/#asus-rog-zephyrus-g15-ga503qr>Windows マシンを購入した理由</a> の1つに Oculus Link を使うことがあった。市販の USB 3.0 ケーブルは購入していたので Oculus Link アプリをインストールしたり、設定したりしていた。久しぶりにヘッドマウントを起動したので OS のアップデートなどもしていた。<a href=https://hello.vrchat.com/>VRChat</a> もやったことないのでこの機に試してみる。時間に余裕ができたら VR でもなにか活動していきたい。</p>
<ul>
<li><a href=https://www.moguravr.com/oculus-link-setup-explanation/>「Oculus Link」のセットアップを徹底解説 注意点やケーブル選びも</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1228/>目標はもうない</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-28
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/thought/>thought</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時に起きて2度寝して8時に起きた。前日やや飲み過ぎて軽い2日酔い。</p>
<h2 id=目標考察>目標考察</h2>
<p>この前ストレッチを受けているときにトレーナーさんから「来年の目標はなんですか？」とふと聞かれた。目標という単語に私は忌避感をもっているなと感じた。というのは、普通の規模の会社でサラリーマンやっていれば、期首に目標設定やって期末に評価して昇格やボーナスの金額が変わるといった制度になっていることが多いと思う。私は昔から目標とか意識して働くよりも、働いている過程や状況の変化の中でそのときに大事だと自分が思ったことに注力するような方だった。なので、期首に立てた目標とは全然異なる業績をあげたりすると、目標とか無関係に評価が決まることが多かった。この評価には高い評価を受けたこともあるし、低い評価を受けたこともある。そして、評価は上長やより上位の人たちのさじ加減で決まることも多かった。目標とか組織の論理よりもプロジェクトの状況にとって大事かどうかを自分で判断して行動するから目標が有名無実化しやすい方だった。そういう働き方をしていると、目標とか評価とか無駄な労力よなと思ってしまう。いまマイクロ法人として独立して、目標と評価という無駄な労力を費やさなくて済むので、そういったストレスからは解放された生活を送れるようになった。</p>
<p>閑話休題。トレーナーさんにはこう回答した。目標とかとくにないです。日々、健康で過ごすぐらいのことしか考えてませんと意識の低い回答をした。一方で私はやりたいと思ったことはすでにやっているところはある。サラリーマン時代の刷り込みからか、目標とは計画を指していて、すでにやっていることは目標に含めないように考えてしまうところがある。進行中であってもやり終えるまでを目標と設定して喧伝してもよいとは思うけど、私がすでにやっていることを目標とみなさないのは、上述したように、やっている過程や状況の変化にあわせて変えていくため、予め事前に立てておいた目標とは異なる結果になることが経験的に多かったことに起因する。もうこの歳になると目標を立てるというよりも、目標となることをやっているかどうかの方が重要になってきたという思いもある。</p>
<p>いずれにしても目標や評価のような行動を私は2度とやることはないだろうという話し。</p>
<h2 id=実践知本の読み直し>実践知本の読み直し</h2>
<p>課題管理における背景の理論考察を始めたとき、早い段階で読んだ本に <a href=https://b.kobe-u.ac.jp/books/b007/>実践知 — エキスパートの知性</a> がある。8月頃に読んだ。当時は知識にもいろんな分野や研究成果があるとわかった程度だった。その後、認知心理学やスクラム開発の背景を学ぶうちに実践知とも関連があるように思えてきた。背景知識が増えた状態で、いまこの本を読み返せばまた違った理解があるのではないかと考えてまた読み直すことにした。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1227/>仕事納め</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-27
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/commic/>commic</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。今日は仕事納めだー。</p>
<h2 id=ミステリと言う勿れ-10巻>ミステリと言う勿れ 10巻</h2>
<p>読んだのは昨日の夜なんだけど、<a href=https://www.shogakukan.co.jp/books/09871497>ミステリと言う勿れの10巻</a> の電子版があることにたまたま気付いて購入した。そして、読みふけった。第9巻から発生した事件の続きで第10巻で進展して犯人が判明して解決した。もうね。ちょっとこの巻はすごかった。この漫画に出てくる犯人は普通の人間の常識や感覚からちょっとズレた変な人が犯人みたいなところはあった。今回はさらにそれが斜め上にズレて何一つ犯人が語る理屈や動機を理解できなくて、犯人が分かってから解決編をやっている途中でこの漫画の著者はまともな精神状態でこの漫画を描いているの？と著者の健康を心配をしてしまうぐらい、犯人の人間像に私は理解ができなかった。もちろん娯楽作品としては十分におもしろいのだけど、私にとっては理屈がわからんというのは苦痛でもあるのでわかるために読み直そうと思ってしまうので何回か読み直すことになると思う。</p>
<h2 id=仕事納め>仕事納め</h2>
<p>対外的には今日が仕事納め。内部的には28-29日は自社のお仕事をして30日に実家に帰るかどうか、まだ決めてない。天気次第でもいいかな。去年はうまくいかなくて31日までお仕事していたことを思うと今年は27日で締められて余裕があるように感じる。ちょうど帰省したおかださんがうちのオフィスまで訪ねて来てくれた。去年はコロナ禍で帰省されなかったので2年ぶり。オフィスの会議室を使ったことなくて、お試しも含めて軽く課題管理のビジネスアイディアについて共有した。とくに反応はなかったけれど、ちゃんと準備もしていないので気軽に雑談した。その後、近くの焼き鳥屋さんとワインバーで飲んでた。ある意味、納会の代わりにもなった。近況、昔話、技術動向、最近読んだ本などの話しをした。1人だったらほぼ100%納会はやらないので最終日に飲み会があって納会のような気分にはなった。今後は仕事納めの日に飲み会を入れるようにしていこうと思った。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1226/>メンタルモデルの参考</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-26
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/psychology/>psychology</a>&nbsp;
</span>
<div class=post-content>
<p>0時過ぎに寝て6時に起きてだらだらしてて8時に起き上がった。</p>
<h2 id=会議室予約>会議室予約</h2>
<p>明日おかださんと話すのでシェアオフィスの <a href=https://booking.wooc.co.jp/wooc/>会議室予約サイト</a> で会議室を予約した。この予約サイト、リリースされて1年近く経つけど、本当に使いにくい。技術の無駄遣いって言葉がしっくり来る。会議室はオフィスを借りている人には5時間/月まで無料で使える。元町オフィスの会議室を予約するのは初めてかな。どんな使い勝手かを試してみるよい機会でもある。明日に備えて設備やモニターチェックをしていた。</p>
<h2 id=ソフトウェアエンジニアと技術力>ソフトウェアエンジニアと技術力</h2>
<p>そねさんの1ヶ月以上前に公開されたスライドを、あとで読みこじらせて、今日読み直した。課題管理のためのメンタルモデルを確立しないといけないと考えるようになってきた。そのためのヒントになるかな？とちゃんとメモを取りながら精読しようと思って1ヶ月放置していた。他のことに注力していると別のことができなくなる。ソフトウェアエンジニアという定義をあまりみたことがなくて斬新だったり、書いてある内容そのものは共感できるものではあった。一方で精神論や思想的な話しが多くて、もう少し理論的な裏付けや技術的な背景があった方が私の好みだったなと1ヶ月も置いておいたから期待値が上がってしまっていた。</p>
<blockquote>
<p>ソフトウェアエンジニアとは、科学 (ソフトウェア) を活用して問題を解決する力をもつ人であり、ソフトウェアを使いこなして最小の労力で問題を解決することを技術力が高いと言う。</p>
</blockquote>
<iframe class=speakerdeck-iframe frameborder=0 src=https://speakerdeck.com/player/fb6aa6332db84aceafc121588984b95f title="ソフトウェアエンジニアと技術力 / developer-lifework" allowfullscreen mozallowfullscreen=true webkitallowfullscreen=true style="border:0;background:padding-box padding-box rgba(0,0,0,.1);margin:0;padding:0;border-radius:6px;box-shadow:rgba(0,0,0,.2)0 5px 40px;width:560px;height:314px" data-ratio=1.78343949044586></iframe>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1225/>ワーケーションの情報共有</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-25
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て2時前に起きてまた寝て6時に起きてまた寝て8時に起きた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今週もお仕事がいっぱいいっぱいで全然ストレッチできなかった。今日の開脚幅は開始前167cmで、ストレッチ後169.5cmと前回よりも数値が悪くなった。さぼっていたから仕方ない。一方で右股関節の不可動領域が週ごとによくなっていて、可動していなかった領域が稼働することによって、内転筋に張りが出るようになっているとのこと。システムで例えると、ある地点のパフォーマンスが改善することで別の地点にニーポイントが移動するような話しだと思う。日常生活でもなんか違和感があると思ってはいたので改善していきたい。</p>
<h2 id=ワーケーション準備>ワーケーション準備</h2>
<p><a href=/diary/posts/2021/1217/#ワーケーション準備>これまで準備してきた</a> 内容を旅のしおりにまとめている。その内容を参加者4人で共有するための打ち合わせをした。これまで私が更新してきた旅のしおりの内容を一通り確認して、みんなで付近の観光案内などをみたりしていた。城崎温泉は720年開湯というくだりを話すと、歴史好きの人たちは反応して平安京やら平城京やらの年号で盛り上がった。私はもともと学校の書架に置いてある「日本の歴史」というタイトルの漫画を3回ぐらい読み込んでいた児童だったので観光地は歴史から入る癖がある。そんな人じゃなくても、人間、歳をとると歴史の重みみたいなのを感じるようになって、歴史に敬意を払うようになるんじゃないかと勝手に思っている。1泊目の宿は予約済みだけど、2泊目どうする？という話しをしていたら、たまたま宿泊予約サイトで <a href=https://www.bookstoreichi.com/guesthouse>Book store iChi ゲストハウス</a> をみつけた。1部屋4人で宿泊できるし、料金も安いし、ゲストハウスとか泊まったことないという参加者もいるし、おもしろそうみたいなノリになって、ノリのまま予約した。<a href=https://www.hyogo-tourism.jp/furusato-ouen/>ふるさと応援！ひょうごを旅しようキャンペーン</a> も適用できるという話しなので兵庫在住なら2000円/人の割り引きを受けられる。なにかしら情報共有で他人と話すと新しい行動や調査のヒントがあったりしてモノゴトが進むきっかけになると実感した打ち合わせだった。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>たまたま話していて「794 鳴くよウグイス平安京」は共通認識だけど、私は「710 なんと都を移す平城京」で覚えてたんだけど、平城京の語呂合わせはバリエーションがあるみたい。しかもヤフー知恵袋みたら「南都」という名詞バージョンもあるとのこと。へー。<a href=https://t.co/IvBLJ30inP>https://t.co/IvBLJ30inP</a></p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1474655368387371008?ref_src=twsrc%5Etfw">December 25, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1224/>冒険をするチームにはコックが必要</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-24
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て4時に起きて、なんとなくドラクエタクトしてたら6時になってそのまま朝活に出てた。sns のタイムラインを眺めていると今日で仕事納めにしている人をちらほらみかけた。私は外向けには月曜日が仕事納めで、内向けには水曜日までは働くかな。30日は実家に帰るか、ゆっくり休むか、まだ決めてない。</p>
<h2 id=朝活-バッタを倒しにアフリカへ>朝活: バッタを倒しにアフリカへ</h2>
<p><a href=/diary/posts/2021/1030/#サバクトビバッタの研究>先日たまたまみかけた記事から購入した</a> ことを書いた。積ん読状態だったけど、技術書ばかりも疲れるので気分転換に読み進めることにした。</p>
<p>第1章サハラに青春を賭けるを読んだ。著者はおもしろい人だというのは文章から伝わってくるので何を書いてても驚きはしないが、それでもアフリカ(モーリタニア)の生活や状況などは全く知らないことばかりなので何を読んでも斬新には感じる。<a href=https://www.mofa.go.jp/mofaj/area/mauritania/index.html>モーリタニア・イスラム共和国</a> という国すら私は知らなかった。</p>
<p>第1章は渡航してフィールワークに出掛けた内容が書いてあった。砂漠へ行くチームにコックが必要というのは、ドラクエ脳の自分には出てこない発想で現実は旅をしながらおいしいものも食べたいという欲求は強いのだなぁという学び？があった。</p>
<h2 id=slack-のマルチチャンネルゲスト>slack のマルチチャンネルゲスト</h2>
<p>これまでお手伝い先では slack のシングルチャンネルゲストで参加していた。必然的に1つのチャンネルにすべてのプロジェクトメンバー20人がいる。技術的な話題を気軽に投稿しにくいし、システム通知などもかなり制限されていた。</p>
<blockquote>
<p>人間が会話するチャンネルとシステムが通知するチャンネルは分けた方がよい</p>
</blockquote>
<p>と、私はプラクティスとして常々言っている。きっと誰もが言っている。システム通知が認知負荷となるという声は業務側のメンバーからも届いていた。これは外部メンバーをマルチチャンネルゲストにすることのコストだけの問題なので、その価値をどう測るかという視点から、中の人がその予算を確保して外部メンバーがマルチチャンネルゲスト化された。その判断を支持する意図でも、slack のチャンネルが複数扱えることでどういった情報共有やシステム間連携の価値があるかというのを、私の経験からも提示していきたいと考えている。情報を監視するという概念、ならびに情報の一元管理にも関わってくるので、課題管理と並ぶ情報共有という文脈で私の強みが活きる分野でもある。いろいろやっていきたい。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1223/>maven のバージョンチェック処理の振る舞い</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-23
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/maven/>maven</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て1時に起きてまた寝て6時半に起きた。変なライフサイクルになってきた。</p>
<h2 id=maven-のアップデートポリシー>maven のアップデートポリシー</h2>
<p>maven が依存解決するとき、例えばバージョンの範囲を指定して最新バージョンを取得するといった設定ができる。実行していると、新しいバージョンをチェックしにいくときとそうじゃないときがあって、どういう仕組みで動いているのかよくわからなかったのでデバッグした。言うても DEBUG ログを出力させて、ログの内容をソースで grep しながら関連するところを読んだだけ。</p>
<p><a href=https://github.com/apache/maven/blob/maven-3.6.3/maven-compat/src/main/java/org/apache/maven/repository/legacy/DefaultUpdateCheckManager.java#L110>DefaultUpdateCheckManager.isUpdateRequired</a> の中でポリシーが最終チェック日付を確認していいる。ここから辿っていくと <a href=https://github.com/apache/maven/blob/maven-3.6.3/maven-artifact/src/main/java/org/apache/maven/artifact/repository/ArtifactRepositoryPolicy.java#L115>ArtifactRepositoryPolicy</a> という仕組みがある。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span> lastCheckDate <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>)</span> <span style=color:#f92672>||</span> policy<span style=color:#f92672>.</span><span style=color:#a6e22e>checkOutOfDate</span><span style=color:#f92672>(</span> lastCheckDate <span style=color:#f92672>);</span>
</code></pre></div><p>ドキュメントでそれっぽい内容を調べると <code>updatePolicy</code> を設定できるようになっている。デフォルトは <code>daily</code> なので日次でチェックしにいくような振る舞いをする。バージョンチェックするときとしないときの何が違うのか、よくわかっていなかった振る舞いを理解できた。これはビルドキャッシュの有無に関係ないのでキャッシュがあるからバージョンチェック処理をスキップできるわけではない。もちろん、更新をチェックさせたくないのであれば <code>never</code> に設定してもいいのかもしれない。</p>
<blockquote>
<p>updatePolicy</p>
<p>The frequency for downloading updates - can be &ldquo;always&rdquo;, &ldquo;daily&rdquo; (default), &ldquo;interval:XXX&rdquo; (in minutes) or &ldquo;never&rdquo; (only if it doesn&rsquo;t exist locally).</p>
<p><a href=https://maven.apache.org/ref/3.6.3/maven-settings/settings.html>https://maven.apache.org/ref/3.6.3/maven-settings/settings.html</a></p>
</blockquote>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1222/>課題管理システムの一本化</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-22
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て4時過ぎに起きて2度寝して6時前に起きた。</p>
<h2 id=朝活-バッタを倒しにアフリカへ>朝活: バッタを倒しにアフリカへ</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/234405/>【三宮.dev オンライン】今年最後のリモート朝活もくもく会</a> に参加した。スクラム本を読み終えたので気分転換に <a href=https://www.kobunsha.com/shelf/book/isbn/9784334039899>バッタを倒しにアフリカへ</a> を読むことにした。主に雑談してたら序文しか読めなかった。</p>
<h2 id=課題管理システムを一本化する>課題管理システムを一本化する</h2>
<p>お仕事でスクラム開発を実践している。プロダクトバックログを <a href=https://backlog.com/ja/>backlog</a> で管理し、スプリントバックログを <a href=https://docs.github.com/ja/issues>GitHub Issues</a> で管理している。課題を複数のプラットフォームで管理することは情報の一元管理という側面からよくないといったことをお手伝いを始めたときから機をみて指摘していた。そういう状態が2ヶ月ほど続いて、GitHub Issues は機能的に厳しいという共通認識が開発者にはあるため、backlog へ一本化されることに決定した。スクラムと課題管理との関係を追究したい私にとっては朗報で、今後は PO も含めて課題管理システムの用途をメンバーにアドバイスしながら課題管理の高みを目指していきたい。但し、backlog は標準で github 連携機能を提供していないため、チケット駆動開発をするには自前で連携機能を作らないといけないらしい。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1221/>誕生石が増えた</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-21
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/stone/>stone</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に半に起きた。今日は普通に眠れた。お仕事で本番リリース作業のトラブルシューティングのお手伝いをしていてバタバタしてた。</p>
<h2 id=誕生石を63年ぶりに改訂>誕生石を63年ぶりに改訂？</h2>
<p>先日コーポレートストーンを <a href=/diary/posts/2021/1213/#ターコイズ>ターコイズ</a> に決めたとか、訳のわからないことを書いた。たまたまはてブで <a href=https://maidonanews.jp/article/14368447>日本の誕生石、63年ぶりに改訂　新たに宝石10石追加、全29石に</a> というニュースをみかけた。誕生石のことをよく知らなくて勝手に月に1つの石があるんだと思い込んでいたら全然そんなことはなくて、今回の追加で多い月は4つの石が設定されたらしい。</p>
<blockquote>
<p>全国宝石卸商協同組合（東京都千代田区）は12月20日、63年ぶりに日本の誕生石を見直し、新しい宝石10石を追加したことを発表しました。今回の追加により、日本の誕生石は全29石になりました。</p>
<p>(中略)</p>
<p>日本の誕生石は1958年、アメリカの宝石商組合（現在のジュエラーズ・オブ・アメリカ）が定めたものをベースに全国宝石卸商協同組合が初めて制定しました。</p>
</blockquote>
<p>記事によると、業界団体が決めているだけで、最終的な目的は宝石を売りたいだけなのかな。<em>「資本主義ってやつか」</em> って一言つぶやいたら満足するような記事だった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1220/>新型コロナワクチン接種証明書アプリを使ってみた</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-20
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/device/>device</a>&nbsp;
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て1時過ぎに起きて4時半に起きて6時半に起きた。寝てないわけじゃないけど、うまく眠れなくなった。</p>
<h2 id=スマホのマイナンバーカードの読み取りは位置がシビア>スマホのマイナンバーカードの読み取りは位置がシビア</h2>
<p>ワーケーションで <a href=https://www.hyogo-tourism.jp/furusato-ouen/>ふるさと応援！ひょうごを旅しようキャンペーン</a> を利用する条件の1つにワクチンの接種証明を提示する必要がある。ちょうどデジタル庁から <a href=https://www.digital.go.jp/policies/posts/vaccinecert>新型コロナワクチン接種証明書アプリ</a> がリリースされた。このアプリを使えば接種の原本の書類を持っていかなくて済む。</p>
<p>朝からアプリをインストールしてマイナンバーカードを使って接種証明書を発行しようとしたのだけど、マイナンバーカードの読み取りができない。エラーも表示されなくてうんともすんとも動かない。パスワードがロックされていたらエラーが表示されるように思えるのでなんかおかしい状況だった。そのことをツィートしたら、とのきさんがマイナンバーカードの読み取りはシビアで位置があっていないと読み取りできないとアドバイスしてくれた。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>スマホ機種によってNFCの搭載位置やカードの当て方などで読み取りが非常にシビアみたいです<br>NFCチップの位置をスマホとカードで正確に一致させてギリギリ読みとれた、など聞いたことがあります</p>&mdash; tonoki(demobird) (@tonoki) <a href="https://twitter.com/tonoki/status/1472760754332127235?ref_src=twsrc%5Etfw">December 20, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<p>午後から <a href=https://www.jpki.go.jp/download/howto_iphone/certificate_p02.html>JPKIMobile を用いた有効性の確認方法</a> を確認しながら再挑戦した。ここに書いてあるようにちょっと離したり、カードの位置を少しずつずらして調整したりしてたら読み取りできた。この時点でパスワードロックではないことを確認できた。</p>
<blockquote>
<p>iPhone端末にICカードをセットします。画面が変わらないようであれば、一度ICカードを離してから再度セットしてください。</p>
</blockquote>
<p>JPKIMobile で読み取りできたので同じ要領で接種証明書アプリでもやってみたら今度はすんなりと読み取りできて発行できた。位置さえあえば読み取りはすぐできた。今朝はたぶん机に置いて位置を調整せず、読み取りには時間がかかるのかな？とずっと動かさず待っていたのがよくなかったみたい。とのきさんのおかげで区役所に行く無駄な時間を削減できた。感謝。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1219/>スクラム開発の所感</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-19
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て2時過ぎに起きてだらだらして7時に起きてだらだらして8時に起き上がった。休日は自然とだらだらしがち。</p>
<h2 id=log4j2-の脆弱性対応>log4j2 の脆弱性対応</h2>
<p>たまたま sns で新たに脆弱性が発見され 2.17.0 がリリースされたことをみかけた。<a href=https://logging.apache.org/log4j/2.x/security.html>Apache Log4j Security Vulnerabilities</a> をみて、午前中に対応して pr を作成して dos 攻撃の脆弱性と書いた後に次のツィートをみかけた。私は詳細を理解できていないのでこの内容が 2.17.0 で fix されているのかどうかまでは調査できていない。いずれにしても rce 攻撃はこわいから緊急度が跳ね上がるなとみていた。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>【悲報】log4jのRCE脆弱性、2.15で緩和策としてlocalhostにしかlookupできなくしたはずが、127.0.0[.]1#example[.]comのように#を挟むことにより回避可能ということが判明。これにより任意ドメインへのリクエストが可能になり再びリモート実行可能に。みなさん最新版の2.17にアップデートしましょう。 <a href=https://t.co/uQhJSnjv7m>https://t.co/uQhJSnjv7m</a></p>&mdash; たいしょー (@miettal) <a href="https://twitter.com/miettal/status/1472372715281858563?ref_src=twsrc%5Etfw">December 19, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<h2 id=アジャイル開発とスクラム-第2版>アジャイル開発とスクラム 第2版</h2>
<p>昨日の続き。素晴らしい本だったので所感をまとめた。スクラム開発の理解がより進んだ。</p>
<ul>
<li><a href=https://t2y.hatenablog.jp/entry/2021/12/19/183339>アジャイル開発とスクラム 第2版 顧客・技術・経営をつなぐ協調的ソフトウェア開発マネジメント</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1218/>スクラム本を読了</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-18
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きてだらだらしてて8時に起き上がった。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今週もお仕事に注力してた。ストレッチは2-3日/週かな。普通ぐらいの頻度。夜は寒くなって外に出掛けるのが億劫で1日ウォーキングしたかなぐらい。今日の開脚幅は開始前169cmで、ストレッチ後170cmで、久しぶりに170cm台に戻した。いい感じ。右股関節の不可動領域がよくなっているのが実感できるようになってきているので調子はよさそう。今日は全体的に右半身 (太もも後ろ、腰、大胸筋) と張りがあって疲労もやや溜まってそうに思えた。基本的に週末もなにかしら作業していて疲労が蓄積していないのは毎週のストレッチの効果も大きいと考えている。</p>
<h2 id=次の-bizpy-勉強会>次の bizpy 勉強会</h2>
<p>1月の bizpy 勉強会のイベント、<a href=https://bizpy.connpass.com/event/234387/>Python で機械学習をやってみる勉強会</a> を公開した。次回はわたなべさんに講師をやってもらう。このイベントページも作っていただいた。運営が2人になったのでお互いの忙しいときは分担しながらコミュニティを運営していける。本当にありがたい。わたなべさんが担当している間に私も次のネタの下調べや仕込みをする余裕がもてる。メタバースの勉強会やってもいいなとは考えているけど、私だけではコンテンツが弱くて、よそから詳しい人を招いてこないといけない。どうしたものか。</p>
<h2 id=アジャイル開発とスクラム-第2版>アジャイル開発とスクラム 第2版</h2>
<p>読了した。全12章の後にもコラムと対談があって、この内容も読み応えがあっていくつも示唆を与えられるものだった。</p>
<ul>
<li>コラム 野中理論とスクラム</li>
<li>スペシャルトーク 野中氏と平鍋氏の対談
<ul>
<li>イノベーションに必要なのは、対話を通じて共振・共感・共鳴する実践知リーダーシップであり、それがスクラムの心だ</li>
</ul>
</li>
<li>おわりに</li>
</ul>
<p>12章で出てきた実践知について、実践知とは何か、実践知リーダーシップとはどういうことかというのが対談の中でも繰り返し出てきてその理解が深まった。私の中では暗黙知と実践知の境界が曖昧だったが、暗黙知と形式知を行ったり来たりすること、そして身体性を伴っているというのが実践知であること。そこには「もの」や「こと」の目に見えない関係性を洞察しながら判断し、本質を考え抜く知力が必要であると述べられていた。昔は <a href=https://ja.wikipedia.org/wiki/%E7%9F%A5%E8%A1%8C%E5%90%88%E4%B8%80>知行合一</a> と言ったらしいが、90年代以降の日本は分析過多、計画過多、コンプライアンス過多になってしまったという。また時間のあるときに所感をまとめようと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1217/>知識創造と実践知の考察</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-17
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。ここ最近は晩ご飯作って食べてアイスクリーム食べてドラクエタクトやって寝るみたいな業後の過ごし方が多い。</p>
<h2 id=朝活-アジャイル開発とスクラム-第2版>朝活: アジャイル開発とスクラム 第2版</h2>
<p><a href=https://t.co/0erAzQpDzk>金朝ツメトギ 2021-12-17 AM 6 金曜朝6時開催のもくもく会</a> で第11章スクラムと知識創造と第12章スクラムと実践知リーダーを読んだ。</p>
<p>第11章では知識想像モデルとして SECI モデルが紹介されている。ふと読んでいて、私が課題管理システムでやっていたのはこの「表出化」の活動で、多くのスクラムをやっているチームは「共同化」を主にやっているように思えた。ソフトウェア開発方法論の歴史的に、チケット駆動開発 → イテレーション開発 → アジャイル開発/スクラムの時系列に発展してきた経緯から、私のようなチケット駆動開発をがっつりやってきた開発者が言う対話が重要だと言うことと、最初からスクラム開発で「共同化」しかやらず「表出化」していない開発者が言う対話が重要だと言うことは、背景事情からして根本的に指している内容が違うのではないか？という仮説を思いついた。対話が重要だと言う開発者がドキュメントや文章を書くことをなおざりにするのを見かけて違和感を感じていた。チケット駆動開発をがっつりやってきた開発者は文章を書いた上でそれだけでは解決できなかった問題を解決するために対話が必要だと言っているわけであり、文章すら書けない開発者は対話だけで開発を進められるわけではないと考えると、これまでスクラム開発に抱いていた私の違和感の正体に近づいたように思えた。</p>
<figure><img src=/diary/img/2021/1217_seci-model.png>
</figure>
<p>第12章では実践知という概念とそのリーダーシップが紹介されている。以前 <a href=https://b.kobe-u.ac.jp/books/b007/>実践知 — エキスパートの知性</a> という本を読んで、メタ認知も含めた認知心理学の知見を踏まえた知識創造や実践知を獲得するに至る背景や教育と課題管理との間にある関係性を考えていたことがあった。スクラムにおいても実践知という概念を扱っているのを読んで、ここにはなにかしらの関係性を見出したり体系化を行う余地があるように考えている。やや哲学的な話題も出てくるので人によって賛否がわかれるかもしれないが、私は自分の考えている中長期的な思考や教育への考え方の価値観が合致していて、これが日本的な経営スタイルの鍵だという意見には一定の同意ができる。自分自身も中長期的な展望を大事にしながら課題解決していきたいという想いもあるからだ。</p>
<h2 id=ワーケーション準備>ワーケーション準備</h2>
<p><a href=/diary/posts/2021/1212/#ワーケーション予約>ワーケーション準備</a> の残タスクを少しずつやっていく。宿泊先の <a href=https://kinosaki-kinoie.com/>きのいえ</a> に電話してチェックイン前に駐車場にレンタカーをとめさせてもらえないかを問い合わせた。当日に宿泊客がいれば13時以降、いなければそれよりも早めにとめてもよいとのこと。スタッフがいれば声をかけていなくても勝手にとめてよいと教えてもらった。先方からも <a href=https://www.hyogo-tourism.jp/furusato-ouen/>ふるさと応援！ひょうごを旅しようキャンペーン</a> が本来は12月末で終了だったのが2月28日まで延長されたため、宿泊者が兵庫県在住であればその手続きをしたいとのこと。一旦、オンラインで決済済みの予約をキャンセルして、現地決済で兵庫県の割り引きの手続きをしてくれるという。メンバーは4人中3人が兵庫県在住なので4,000円/人の割り引きで合計12,000円の割り引きになった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1216/>traceparent の生成</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-16
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/dapr/>dapr</a>&nbsp;
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<div class=post-content>
<p>1時半に寝て7時半に起きた。ちょっと疲れてて寝坊した。</p>
<h2 id=w3c-trace-context-の-traceparent-ヘッダーの生成>W3C Trace Context の traceparent ヘッダーの生成</h2>
<p>前にお仕事で <a href=/diary/posts/2021/1209/#dapr-の分散トレーシングと-w3c-trace-context>dapr の分散トレーシングを検証している</a> ことについて書いた。</p>
<p>dapr の分散トレーシングは <a href=https://www.w3.org/TR/trace-context/>W3C Trace Context</a> に準拠していて、dapr 経由のリクエストは自動的にこの情報が付与されるが、そうじゃないリクエストもトレーシングできるようにするためには http ヘッダーの <code>traceparent</code> をセットしないといけない。試しにサーバー側に <code>traceparent</code> を生成するのはどうやるのかを調べてみた。<a href=https://github.com/w3c/trace-context/blob/main/implementations.md>Implementations of Trace Context</a> にある java ライブラリを調べていて、Jaeger クライアントは OpenTelemetry に移行したと書いてあって、OpenTracing と OpenCensus は OpenTelemetry に統合されたと書いてあって、どうやら OpenTelemetry を使うのがよさそうだとわかった。</p>
<p>やりたいことは <code>traceparent</code> を生成したいだけだが、OpenTelemetry の <a href=https://opentelemetry.io/docs/instrumentation/java/manual_instrumentation/>Manual Instrumentation</a> を読んでも直接的なやり方は書いてなくて、<a href=https://github.com/open-telemetry/opentelemetry-java>open-telemetry/opentelemetry-java</a> のテストコードなどもみながら実装した。細かいところの仕様をまだ理解できていないけど、ひとまずこれで生成できたので検証はできると思う。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>W3cContextUtil</span> <span style=color:#f92672>{</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String TRACE_PARENT_VERSION <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;00&#34;</span><span style=color:#f92672>;</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> OpenTelemetrySdk openTelemetry <span style=color:#f92672>=</span> OpenTelemetrySdk<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>()</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>setTracerProvider</span><span style=color:#f92672>(</span>SdkTracerProvider<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>build</span><span style=color:#f92672>())</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>setPropagators</span><span style=color:#f92672>(</span>ContextPropagators<span style=color:#f92672>.</span><span style=color:#a6e22e>create</span><span style=color:#f92672>(</span>W3CTraceContextPropagator<span style=color:#f92672>.</span><span style=color:#a6e22e>getInstance</span><span style=color:#f92672>()))</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>buildAndRegisterGlobal</span><span style=color:#f92672>();</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> Tracer tracer <span style=color:#f92672>=</span> openTelemetry<span style=color:#f92672>.</span><span style=color:#a6e22e>getTracer</span><span style=color:#f92672>(</span>
            <span style=color:#e6db74>&#34;my-tracer&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;1.0.0&#34;</span><span style=color:#f92672>);</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>generateTraceParent</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        Span span <span style=color:#f92672>=</span> tracer<span style=color:#f92672>.</span><span style=color:#a6e22e>spanBuilder</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;parent&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>startSpan</span><span style=color:#f92672>();</span>
        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
            SpanContext sc <span style=color:#f92672>=</span> span<span style=color:#f92672>.</span><span style=color:#a6e22e>getSpanContext</span><span style=color:#f92672>();</span>
            <span style=color:#66d9ef>return</span> String<span style=color:#f92672>.</span><span style=color:#a6e22e>format</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;%s-%s-%s-%s&#34;</span><span style=color:#f92672>,</span>
                    TRACE_PARENT_VERSION<span style=color:#f92672>,</span>
                    sc<span style=color:#f92672>.</span><span style=color:#a6e22e>getTraceId</span><span style=color:#f92672>(),</span>
                    sc<span style=color:#f92672>.</span><span style=color:#a6e22e>getSpanId</span><span style=color:#f92672>(),</span>
                    sc<span style=color:#f92672>.</span><span style=color:#a6e22e>getTraceFlags</span><span style=color:#f92672>().</span><span style=color:#a6e22e>asHex</span><span style=color:#f92672>());</span>
        <span style=color:#f92672>}</span> <span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
            span<span style=color:#f92672>.</span><span style=color:#a6e22e>end</span><span style=color:#f92672>();</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><h2 id=大阪python-もくもく会>大阪Python もくもく会</h2>
<p><a href=https://osakapython.connpass.com/event/233460/>大阪Python もくもく会 #66</a> にオンライン参加した。コロナ禍前に大阪へ通勤していた頃はオフライン勉強会に何回か参加したことがある。主催者のやぎさんは一度 bizpy に参加してくれたこともある。11月からオフライン勉強会を再開したとのこと。久しぶりに参加してやぎさんと話していたら <a href=https://neos.com/>neosvr</a> にも関心をもっているとのこと。私も少し前に oculus quest 2 を購入して触ってみた程度なのでメタバース関連で一緒に勉強会をしてもよいかもしれない。もくもく会では「アジャイル開発とスクラム 第2版」を読んでいて昨日の日記の記事がまさにその成果物。せっかくなので成果発表でこの本の紹介などをした。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1215/>データと業務の変遷</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-15
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/data/>data</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝てこわい夢をみて1時半に起きて、そのまま寝たのか寝てないのかよくわからない仮眠状態で5時半に起きた。</p>
<h2 id=朝活-アジャイル開発とスクラム-第2版>朝活: アジャイル開発とスクラム 第2版</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/233922/>【三宮.dev オンライン】リモート朝活もくもく会</a> で第10章 竹内・野中のスクラム論文再考を読んだ。1986年に竹内氏と野中氏によって書かれた <a href=https://hbr.org/1986/01/the-new-new-product-development-game>The New New Product Development Game</a> から得た概念や理論的背景をスクラム創設者のジェフ・サザーランド氏がソフトウェア開発の方法論として体系化したものがスクラムになる。そのため、原点はこの論文にある。第10章ではオリジナルに書かれている内容とスクラム開発を比較している。オリジナルの論文にある TypeC (キヤノンやホンダの新製品開発) のようなチームの特徴として次の6つをあげている。</p>
<ol>
<li>
<p>不安定な状態を保つ</p>
<p>最初に綿密な計画や指示があるわけではない、チームは自由な裁量と同時に困難なゴールを目指す</p>
</li>
<li>
<p>プロジェクトチームは自ら組織化する</p>
<p>チームは不安定な状態から自己組織化し、対話の中で自律状態を作り出す</p>
</li>
<li>
<p>開発フェーズを重複させる</p>
<p>開発フェーズを重複させることで、メンバーは専門分野を超えてプロジェクト全体で責任をもつようになる</p>
</li>
<li>
<p>「マルチ学習」</p>
<p>メンバーはグループ全体として学習し、専門を超えて学習する</p>
</li>
<li>
<p>柔らかなマネジメント</p>
<p>無管理でも強い管理でもない自主性を尊重した柔らかなマネジメントが重要である</p>
</li>
<li>
<p>学びを組織で共有する</p>
<p>過去の成功を組織に伝える、もしくは意識的に捨て去る</p>
</li>
</ol>
<p>オリジナルの論文の解説を読んでいると、古きよき日本の家族ぐるみの職場やチームの働き方のように思えてくる。時代が違うのでいまからこういった働き方に戻るのは現実的ではないだろうが、その中で重要だった概念や要素を、いまソフトウェア開発方法論としてのスクラムで実践できるのはいろいろと私の中でも思うことがある。私の考える課題管理の方法論にも竹内・野中氏のオリジナルの論文の概念は影響を受けるように思えた。章末にコラムとしてジェフ・サザーランド氏のインタビュー記事もあった。マイクロファイナンスのプロジェクトを通して、小さなグループに小さくお金を貸し出すことが、貧困から抜けすための小さなきっかけ (ブートストラップ) になるという体験からスクラム開発の動機づけになったという話しは哲学として印象に残った。なにかを成すには哲学が大事だと思う。</p>
<h2 id=データがあると同期したくなる>データがあると同期したくなる</h2>
<p>お仕事でスクラムのふりかえりをやっていて <a href=https://miro.com/>miro</a> と <a href=https://backlog.com/ja/>backlog</a> のデータ同期という話題が出た。業務チームはブレインストーミングで要件を洗い出したりする作業のときに miro を使っていて、miro ベースでメモを記述した後でバックログアイテムとして backlog に登録する。このとき backlog に登録した後で miro を捨てるならいいが、残したまま次の展望や要件の洗い出しにも再利用したりしていると、miro と backlog のバックログアイテムの内容が乖離したり不整合が発生したりする。チームとしてはバックログアイテムに書いてある内容が正という運用をしているため、miro のみに最新の情報がある状態が続くと課題になる。私の知る限り、miro と課題管理システムのデータ連携のツールはないと思う。</p>
<p>私からみたら最初からすべてバックログアイテムに文章で書けばいいやんで話が終わってしまうが、人によって使い慣れたツールは異なるため、そんな単純な話しでもない。一方で昔は miro や backlog がなかった時代もあって、そのときは物理的な付箋紙をホワイトボードに張りながら作業をしていたから、本来は同期したいという概念もなかったはずという意見も出た。たしかにツールがデジタルになって電子データとなった瞬間からデータの再利用を考えるようになるんだなと私も思えた。あと付箋紙をホワイトボードに貼り付けていた時代は何週間もその状態のまま放置するといったこともなかったのではないか？という気もした。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1214/>github actions のワークフローカスタマイズ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-14
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/github/>github</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時半に起きた。</p>
<h2 id=github-actions-の並行ビルド>github actions の並行ビルド</h2>
<p>1-2日でできると思ったら想定したよりややこしくて3日かかった。既存処理でかかっている時間を40-50%ほど短縮できた。1つの job で複数モジュールのビルドや docker イメージの生成、aws ecr への登録、eks の pod 更新などをしている処理を複数の job に分割する。job を分割すると、ビルド成果物を共有できなかったり、env のスコープも変わってくる。独立した job 環境で効率よく処理できるよう、ビルドキャッシュを導入したり、カスタムの composite アクションで処理を共通化したりと、あれやこれやを変更する量が増えていった。変更すること自体は問題ないけど、動作検証は github actions 上で動かさないと分からないところがあって、その検証に時間がかかる。複雑なワークフローを実装していると、github actions のかゆいところに手が届かないのにも気付けた。まだまだ circleci は企業向けに使われるのかもしれないなと思えた。</p>
<ul>
<li><a href=https://github.com/actions/cache/issues/2>ビルドキャッシュを削除できない</a></li>
<li><a href=https://github.com/actions/runner/issues/480>workflow レベルの env は参照できないフィールドがあったり</a> job の steps で動的に更新できない</li>
<li>workflow の再実行で途中の job から再実行できない</li>
<li><a href=https://tech.guitarrapc.com/entry/2021/08/01/194007#2-runif-%E3%81%AF%E4%BD%BF%E3%81%88%E3%81%AA%E3%81%84-%E5%88%B6%E7%B4%84>カスタム action で run.if は使えない</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1213/>log4j2 セキュリティ対応</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-13
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/security/>security</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/stone/>stone</a>&nbsp;
</span>
<img src=/diary/img/2021/1213-turquoise.jpg class=post-cover alt="log4j2 セキュリティ対応">
<div class=post-content>
<p>23時に寝て5時に起きたが、だらだらしているうちに2度寝して6時半に起きた。</p>
<h2 id=log4j2-セキュリティ対応>log4j2 セキュリティ対応</h2>
<p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228">CVE-2021-44228</a> が金曜日のお昼から私のタイムラインを賑わしている。私がお手伝いしているお仕事はイントラのシステムなのでやや余裕をもって情報を眺めていた。<a href=https://github.com/apache/logging-log4j2/pull/608#issuecomment-990494126>issue のコメント</a> をみても log4j 1.x にも影響があると書かれて、その後に実際には影響ないと書かれて、さらにその後に条件付きだけど影響はあると二転三転してた。自分で実際に試してなくて世の中の開発者の情報をみているだけ。そのため、公式の情報を信頼するといったポジションでしかない。関係者の方々には敬意を払いたい。私は spring の公式ブログで公開されている <a href=https://spring.io/blog/2021/12/10/log4j2-vulnerability-and-spring-boot>Log4J2 Vulnerability and Spring Boot</a> を読みながら対応した。</p>
<h2 id=ターコイズ>ターコイズ</h2>
<p>ふとしたきっかけで <a href=https://www.fu-stone.com/blog/turquoise/>ターコイズ</a> の記事を読んだ。12月の誕生石らしく、それでいまの時期に紹介されることも多いのだと推測する。別の記事でターコイズは喉によいと書かれていて、以前 <a href=/diary/posts/2021/1114/#傾斜枕>喉に違和感がある</a> ことを書いた。日常生活に困るほどではないけど、もうこの歳だから体調が良くなることはなく悪くなる一方だろうという見通しも含めて験担ぎのような感覚で喉というキーワードでつながったから購入してみた。</p>
<p>近所の原石屋さんに行って尋ねてみたら1-2cmぐらいのサイズ1個240円ほどで売っていたので3個買って、近所のダイソーで入れものを買って、それっぽくオフィスに置いておくことにした。うちのコーポレートカラーはグリーンとブルーなんだけど、ターコイズも <a href=https://www.colordic.org/colorscheme/4115>ターコイズグリーン</a> と <a href=https://www.colordic.org/colorscheme/4129>ターコイズブルー</a> の2種類の色がある。創業も12月なので誕生石としても合致する。共通点があって相性がよさそうなのでうちのコーポレートストーン (そんな言葉ない) はターコイズでいいや。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1212/>ワーケーション準備</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-12
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
#<a href=/diary/tags/drink/>drink</a>&nbsp;
</span>
<div class=post-content>
<p>2時半に寝て7時に起きた。なんか眠れなくてだらだらしてた。</p>
<h2 id=ワーケーション予約>ワーケーション予約</h2>
<p>参加予定者に最終確認をとって3人参加してくれることになった。感謝。私を含めて4人で行ってくる。レンタカーと <a href=https://kinosaki-kinoie.com/>きのいえ</a> の予約を確定させた。1月28-30日で <a href=https://kinosaki-spa.gr.jp/>城崎温泉</a> でワーケーションしてくる。宿泊は金曜日の夜しか予約があいてなくて4月まで土曜日の夜はすでに予約が埋まっていた。もし金土と連泊で予約するときは3ヶ月以上前に予約をとらないといけないということがわかった。宿泊人数によって料金が変わってくるため、多少の人数変更に対応できる条件で予約できるのが望ましい。今回泊まることでオーナーの人とやり取りできればそういったことも聞いてみようと思う。その後、旅のしおりを作り始めた。まだ1ヶ月あるので調べながらゆっくり準備を進めていく。移動や作業のための時間、食事、親睦会などタイムラインを作りながらやり方を検討していく。</p>
<h2 id=ショコラシュバルツ>ショコラ・シュバルツ</h2>
<p><a href="https://www.satofull.jp/products/detail.php?product_id=1256650">山梨県北杜市のふるさと納税</a> の返礼品として <a href="https://www.yatsugatake-beer.com/?mode=grp&gid=1059669">ショコラ・シュバルツ（Chocolat Schwartz）</a> が届いた。試しに1本飲んでみた。香りがよくて黒ビールなんだけど、普通の黒ビールとは異なる風味でそれがショコラなのかどうか、私にはよくわかってないけど、あまり味わったことのない黒ビールという点からはおいしかった。毎日飲むようなビールではないと思うが、イベントや記念日など普通のビールとは異なるビールを試したいときには向きそう。お土産などにもよさそう。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1211/>ワーケーションのシミュレーション</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-11
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て7時に起きた。久しぶりに遅くまで飲んでたのでやや気分が悪い。全体としてあまり大したことしてなかったんだけど、日記のふりかえりしたり、スクラム談義したり、log4j の脆弱性のその後の状況を静観したりしてた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今週もお仕事に注力してたらストレッチは2日/週とあまりできなかった。夜も外に出掛けるのが億劫になったり、勉強会に参加してたりしてウォーキングもやってない。今日の開脚幅は開始前167cmで、ストレッチ後169.5cmだった。さぼってたわりにはまぁまぁだった。特別なことはなにもしてなかったけど、右太もも後ろの筋がやや張っていて右足はあまりよくない。一方で右股関節の不可動領域がよくなっていることが自分でストレッチしててもわかるようになってきて半年以上やってきた甲斐があったと言える。</p>
<h2 id=ワーケーション計画>ワーケーション計画</h2>
<p>参加者の目処がついてきたので城崎温泉に出掛けるワーケーションの計画をシミュレーションしていた。たとえば電車とレンタカーでどのぐらい料金の差になるかというと、三ノ宮発でレンタカーを借りて移動 (2泊3日) するときの料金 (高速道路/ガソリン代含む) は 35,648 円、電車は往復11,000円/人になる。3人いればレンタカーと同じぐらいの料金で、4人いればレンタカーで移動した方が安くなる。3人だったとしても移動の勝手の良さを考慮するとレンタカーの方がよさそうに思えた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1210/>ワーケーションの思いつき</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-10
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。</p>
<h2 id=朝活-アジャイル開発とスクラム-第2版>朝活: アジャイル開発とスクラム 第2版</h2>
<p><a href="https://www.youtube.com/watch?v=MbpX1LF1fto">金朝ツメトギ 2021-12-10 AM 6 金曜朝6時開催のもくもく会</a> に参加した。今回はてらださんも来られていた。第9章を読んだ。KDDI さんの事例紹介で2013年から取り組みしているらしい。<a href=/diary/posts/2021/1029/#フラクタルスプリント>フラクタルスプリント</a> を実際の業務で実践している稀な事例としておもしろかった。1週間のスプリントの中に1日のスプリントが4回あるといったフラクタル構造のスプリント。また金曜日は「仕事をしない日」としてレトロスペクティブと OST (オープンスペーステクノロジー、自由な発表と議論の時間) に割当てている。20%ルールに近いものと言えるかもしれないが、自己研鑽のための時間をスプリントの中に組み込むという、組織の理解があってこそできる取り組みを実践していてすごいなと感心した。</p>
<figure><img src=/diary/img/2021/1210-weekly-sprint.png>
</figure>
<h2 id=隔週の雑談>隔週の雑談</h2>
<p>顧問のはらさんと隔週の打ち合わせ。スクラムの話題として <a href=https://chatwork.connpass.com/event/231183/>だいくしーのスクラム Bar #1</a> や <a href=https://smn.connpass.com/event/226002/>Scrum Masters Night! Online 〜第10夜〜</a> に参加してやり取りした内容や考察したことなどをいろいろ話してた。そのうちの話題の1つに、スクラムマスターの役割とは何だろうかがある。スクラムマスターはプロダクトをよくすることに責任をもち、メンバーが働きやすいように支えるような役割である。ここまでは共通認識として、その範囲がどこまでかは人によって意見が異なるように思えた。あくまでプロダクトやチームの範囲内で行動するスクラムマスターと、スクラムを組織全体に広めたり、人事・評価制度や経営にも参加していくスクラムマスターがある。スクラムマスターは社外の人間でもできるという考え方があるが、必然的に後者の役割も担うなら社内の人間に限定される。後者の役割は越権行為ではないか、いやいや、チームのために働いたメンバーの評価が下がってしまえば現場でよりよいプロダクト開発はできないから大事ではないかという意見も出た。便宜上、前者を (普通の) スクラムマスター、後者を「意識の高い」スクラムマスターと呼ぶ。私の考えでは、意識の高いスクラムマスターの言わんとしていることはわかるが、それをやりたいなら部長や役員などになってから職責とともに改善すべきであり、スクラムマスターという組織におけるラインではない人が経営に口出ししたりすることによる、組織の歪みはまた別の問題を引き起こすのではないかとも思えた。私も経営をやっていて経営側の視点でみるとやはりおかしい。</p>
<p>その後にワーケーションについて相談した。城崎温泉にある <a href=https://kinosaki-kinoie.com/>きのいえ</a> でワーケーションをやってみようかと考えている。参加のお誘いややり方についていくつか相談しながら前向きに検討しようということになった。</p>
<h2 id=忘年会>忘年会</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/231602/>【初参加大歓迎】三宮.dev＆bizpy 合同忘年会</a> に参加してきた。忘年会の前に運営に入ってもらった、わたなべさんと軽く bizpy の運営について話してきた。1月はわたなべさんに機械学習の勉強会をやってもらう。私は昨年も三宮.devの忘年会に出てた。昨年は3人だったのが今年は4人になった。名物の大きなポークカツレツ。4人とも勉強会の常連みたいな人たちなのでお酒を飲みながらわいわいやって、コロナ禍になる前のコミュニティの勉強会の飲み会を思い出したりしてた。ワーケーションの話をしたら2人は興味を示してくれて、メンバーが4人集まったので開発合宿の企画をしてみることに決めた。</p>
<figure><img src=/diary/img/2021/1210-katsu.jpg>
</figure>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1209/>2年目の創立記念日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-09
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/dapr/>dapr</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
</span>
<div class=post-content>
<p>0時半に寝て6時半に起きた。久しぶりに22時までお仕事やって区切りもよかったからそれからお惣菜を買って23時頃から晩ご飯を食べてた。生活が乱れるなぁ。</p>
<h2 id=dapr-の分散トレーシングと-w3c-trace-context>dapr の分散トレーシングと W3C trace context</h2>
<p>お仕事で dapr の分散トレーシングを検証してた。知らない人は <a href=https://cero-t.hatenadiary.jp/entry/2021/12/08/071742>Dapr Advent Calendar 8日目 - DaprとZipkinで分散トレーシング</a> のチュートリアルをお勧めする。dapr は <a href=https://www.w3.org/TR/trace-context/>W3C Trace Context</a> を使って分散トレーシングを扱う。rest api では、具体的には <code>traceparent</code> と <code>tracestore</code> という http ヘッダーにトレース用途の情報を付けて転送する。すごいところは pubsub のメッセージングを経由してもそれらの情報を転送できる。pubsub 間でこれらの情報は <a href=https://github.com/cloudevents/spec>CloudEvents</a> という標準化されたデータのフォーマットでやり取りされる。実際には CloudEvents の中に <code>traceparent</code> と <code>tracestore</code> の値を含めて通信するけれど、外部からみたら http ヘッダーを転送できているようにみえる。しかし、http ヘッダーの任意の値を転送したい場合、それができない。<code>tracestore</code> はトレースのためのベンダー独自情報を付与できるとあったので、ここに任意の値をセットして送ってみたけど、http ヘッダーの付け替えは行われなかった。あとで dapr のソースを読んだら publish するときはそのまま送っているけど、subscribe するときに <code>tracestore</code> の仕様を満たしているか検証しながらパースしていて、任意の値を送っても仕様に沿っていなければ捨てられてしまうことがわかった。dapr の issue でも要望として登録されてた。誰もやってないならコントリビュートするチャンスかもしれない。</p>
<ul>
<li><a href=https://github.com/dapr/dapr/issues/3642>Propagate arbitrary/configurable http headers from publisher to subscribers #3642</a></li>
</ul>
<h2 id=創立記念日>創立記念日</h2>
<p>今日が会社の創立記念日。無事に2周年を迎えた。創立記念日をお休みにするしないを考えたのだけど、いま休日も普通に働いている状況で、且つ役員は勤怠管理をする必要はないので平日になんの意味もなく休むメリットが何もないということに行き着いた。創立記念日だから休むのではなく、いつでも必要なときに休めばいい。もっと言うと、休む理由がなければ働くという逆転現象が生じていて、休む理由は私用か疲労ぐらいしかなくて、基本的に疲れてない限りはずっと働くみたいな理屈になってしまっている。社員が増えて会社に余裕が出てから創立記念日は休みみたいな制度を作ればいい。それまではたぶん来年もそれ以降も普通に働いていると思う。</p>
<p>1年目は訳分からず働いていたから経営的なことは全くわからなかったけど、2年目は経営上の諸問題が出てきて、経営的な意思決定や考察も増えてきて、行政手続きも熟れて、会社の実績も増えていっていて、会社を育てるという意識もかなり出てきた。率直に言えば、いまの経営状態は可もなく不可もなくといったものなので何もアピールすることはない。しかし、経営したことない人間が経営というキャリアを積み重ねていることには大きな意義があって、自身のキャリアアップには確かな手応えも感じつつある。これからもがんばっていこう。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1208/>整理・整頓・清掃・清潔・躾</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-08
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時に起きた。今日はがんばって起きた！久しぶりに7時半から始業してた。</p>
<h2 id=トヨタの5s>トヨタの5S</h2>
<p>スクラムイベントのふりかえりをしていて <a href=https://circu.co.jp/pro-sharing/mag/article/2964/>トヨタの5S</a> の話題が出た。聞いたことがあるようないような、スクラムを勉強しているいま見返すとじわじわ聞いてくる。玄人ぶって「そうそう、こういうのが大事なんだよ」とか言いたくなりそうな雰囲気がある。普通にやっていたら当たり前のことなのに、忙しかったり複雑な問題に対応してたりすると、普通の状態を維持できなくなって混沌がもたらされる気がする。そういう状況のときに初心に戻るにはこういった原則や標榜を使って啓蒙することに意義があるんだと、いまは思うようになってきた。これ自体をよいとかわるいとか言うのは適切ではなくて、うまくいっていない状態からより戻すときに活用するといった考え方の方が正しいのかもしれない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1207/>クロスデフォルト</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-07
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/economy/>economy</a>&nbsp;
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/logging/>logging</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時半に起きた。5時台には起きているんだけど、起き上がるところまではなかなかいけない。</p>
<h2 id=恒大集団のデフォルト>恒大集団のデフォルト</h2>
<p>11月から利払の期日の日はチェックしていて、支払うときは2-3日前には支払いを完了したというニュースが出ていたように思う。今日の支払いは前日に支払いしたというニュースが出ないからダメなんだろうなと様子をみていた。</p>
<ul>
<li><a href=https://jp.reuters.com/article/evergrande-idJPKBN2IM0F0>中国恒大、猶予期間終了までにオフショア債利払いできず＝関係筋</a></li>
</ul>
<p>1つの債務がデフォルトした場合、残りの債務も一括返済しないといけないことを <a href=https://www.ifinance.ne.jp/glossary/loan/loa259.html>クロスデフォルト</a> と呼ぶらしい。契約書にクロスデフォルト条項として書いてあるらしい。記事によると、クロスデフォルトによって約190億ドル (約2.1兆円) のオフショア債の返済を一括でしないといけないらしい。リーマンショックのようなことは起きないという見通しだけど、うちみたいな零細企業は世の中の影響を諸に受けるのでお仕事に影響がでなければいいなぁといったところ。</p>
<h2 id=アプリケーションログの調査>アプリケーションログの調査</h2>
<p>昨日の続き。ecs-logging-java で JSON Lines でログを制御するところで spring-boot の設定で tomcat のアクセスログの設定ができる。tomcat のアクセスログを log4j のレイアウトの仕組みを使って ecs-logging-java が提供する EcsLayout に変更できないかを3時間ほど調査して、どうもできないようだというのを教えてもらった。tomcat は apache のログを出力するという目的で実装されているから log4j の柔軟なログに対応していないという理屈。</p>
<p>じゃあ、どうやって apache のアクセスログを JSON Lines にするかというと、PatternLayout のパターンに json のフォーマットを直書きしてしまうというやり方がある。なんかプログラミングでスマートに解決したいところだけど、その仕組みがないなら仕方ないかって感じでこれでやろうと思う。</p>
<ul>
<li><a href=https://ogugu.hateblo.jp/entry/2018/08/03/153930>apacheのaccess_logをjson化しtd-agentで集約サーバへ収集する</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1206/>アプリケーションログの調査</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-06
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/logging/>logging</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て7時に起きた。</p>
<h2 id=アプリケーションログの調査>アプリケーションログの調査</h2>
<p>お仕事でログの整理をやろうとしていて、そのためのライブラリとして ecs-logging-java を調べてた。</p>
<ul>
<li><a href=https://www.elastic.co/guide/en/ecs-logging/java/current/setup.html>ECS Logging Java Reference 1.x » Get started</a></li>
<li><a href=https://speakerdeck.com/shibadog/ecs-logging-javatukatutemita>ecs-logging-javaつかってみた</a></li>
</ul>
<p>一番のモチベーションは <a href=https://jsonlines.org/>JSON Lines</a> でログを管理したいというところ。この手の実装や読み込んでログ分析したりとかはあちこちでやってきたので親近感はある。既存のログからの移行も含めていろいろ設計していかないといけない。私の感覚だとアプリケーションの開発初期にログの設計や出力周りを作り込むものだけど、そうじゃない文化の開発もあるんだなという印象。あとからログ設計するとか、移行や既存のコードに手を入れたり、開発初期に作り込むより手間暇かかる気がするんだけど、そんな時間もなく開発してたってことなのかなぁ。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1205/>頭文字Dを読了</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-05
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/commic/>commic</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/dapr/>dapr</a>&nbsp;
#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て7時に起きてだらだらやってて午前中は <a href=https://ja.wikipedia.org/wiki/%E9%A0%AD%E6%96%87%E5%AD%97D>頭文字D</a> のアニメをみてた。漫画 (アニメも？) はすでに完結しているのでいつか読もうと思いつつ最後まで読んでいない。ゴッドフットやゴッドアームが出てくるぐらいまでは読んだ気がする。その後どうなったのかを知らない。イニシャルDをみていると、ストーリーも絵も演出もまったく派手さはなくて普通なんだけど、なぜかおもしろくて続きをみてしまうという人間の娯楽の本質をついている気がしてくる。なんでなんだろうなぁ。</p>
<h2 id=頭文字d>頭文字D</h2>
<p>たまたま思い出したので夜に漫画喫茶行って頭文字Dを最後まで読んできた。全48巻で、31巻ぐらいから読み始めて3-4時間ぐらいで読み終えた。漫画なので仕方ないけど、対戦相手がどんどん強くなっていって勝ち方が玄人好みというのか、単純に抜いた・抜かれたの話しではなく、タイヤマネージメントがどうこうとか、恐怖に対する心理がどうこうとか、ドライバーと車のセッティングも含めた駆け引きが強くなっていって、どちらが速いかというよりは戦略通りの展開にもっていって最後はそれがうまくはまるみたいな、これまでもずっとそうだったんだけど、ここからはよりトップレベルのほんの僅かな差が勝敗を分けるといった描き方になっていったように思う。それはそれで現実に近い気はするけど、漫画的には派手な演出にならないので玄人好みなストーリーになっていった気がする。但し、そこまでやってきて最後の対戦相手だけは、個人的には納得感がなくて、ここまで緻密に作り上げてきた理論や個々のドライバーの修練の積み重ねが圧倒的天才の前にひれ伏すみたいな切り口が急展開していて、頭の切り替えができなかった感じがした。とはいえ、最後まで読み終えられてよかったし、作品としてはすごくおもしろかった。作者はモータースポーツが本当に好きなんだろうなというのが伝わってくる漫画だと思う。</p>
<h2 id=ふるさと納税>ふるさと納税</h2>
<p>あまり欲しいものもないし、ふるさと納税の行政手続きも一通り理解したから今年はやらなくてもいいかとも思っていた。しかし、<a href=https://www.satofull.jp/static/campaign/202112_pcp.php>paypayボーナスキャンペーン</a> をみてやってみるかという気になった。paypay はいろんなものと連携していて見かけるたびにすごいなと思う。お得だからと必要もないものを買うことはないけど、ふるさと納税はやらなかったとしても、どのみち納税は必要なものなので還元があるということは節税につながるのかな？理屈はよくわからないけど、言いたいことは paypay はすごいという話でした。</p>
<h2 id=dapr-の-api-トークンを使った認証>dapr の api トークンを使った認証</h2>
<p><a href=https://docs.dapr.io/operations/security/api-token/>Enable API token authentication in Dapr</a> を一通り読んだ。内容はとくに難しくなく、こんな風に dapr の manifest を書けば <a href=https://jwt.io/>JWT</a> トークンを設定できますということを書いてある。私はずっとサーバーサイドばっかりやってきたからフロントエンドで使われる技術や仕組みに弱い。JWT トークンもその1つで、自分でちゃんと実装したことがないからちゃんとよく分かってない。これが OAuth2 なら provider を実装したこともあるからその仕組みも意図も理解できる。一度どこかで自分で JWT も実装してみないといけないのだろうな。</p>
<p>少し前にお仕事で kubernetes の secret の移行作業をやった。既存の secret にキーバリューを追加するときは patch を使う。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl patch secret mydata -p<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{&#34;stringData&#34;:{&#34;mykey&#34;: &#34;myvalue&#34;}}&#39;</span>
</code></pre></div><p>secret の内容を確認するときも2つのやり方がある。キーだけを確認するならこれでよい。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl describe secrets mydata
</code></pre></div><p>キーに対応する値もデコードして確認するならこうする。但し、閲覧注意。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get secret mydata -o json | jq <span style=color:#e6db74>&#39;.data | map_values(@base64d)&#39;</span>
</code></pre></div>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1204/>github actions のビルドキャッシュ運用</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-04
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/github/>github</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て5時に起きてちょっと作業してまた寝て7時に起きた。お仕事も働き始めて1ヶ月が経過して、だいぶチームの雰囲気や業務に慣れてきたところ。稼働日の18日間で作成した pr が16件。入ったときに割当てられた3つの課題から10数件の issue を派生させてちょうどすべて fix した。来週から新しい課題に取り組む。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今週もお仕事に注力してたらストレッチは2日/週とあまりできなかった。ウォーキングもやってない。今日の開脚幅は開始前165cmで、ストレッチ後167cmだった。さぼってたせいか、数値が悪くなってしまった。右股関節の関節の可動域がよくないところは少しずつまがるようになってきてよくなってきている実感がある。一方で右太ももの後ろの筋が張りが大きいことに気付いた。トレーナーさんに聞くと、この筋は椅子に座っていると張りやすいという話しなので、最近はお仕事に注力して椅子に座っている時間が以前より伸びているせいだと思う。あと会議に出席している時間も増えているため、その時間は椅子に座っておかないといけないという制約も増えている。</p>
<h2 id=actionscache-の-exclude-設定>actions/cache の exclude 設定</h2>
<p>github actions でビルドキャッシュを扱う方法は <a href=https://docs.github.com/ja/actions/advanced-guides/caching-dependencies-to-speed-up-workflows>Caching dependencies to speed up workflows</a> に書いてあって、それは <a href=https://github.com/actions/cache>actions/cache</a> という github actions がキャッシュ機能を提供している。ここでドキュメントにはキャッシュの除外設定については何も書かれていないが、リポジトリに含まれる <code>examples.md</code> には次のような説明と設定例が出てくる。</p>
<blockquote>
<p>Depending on the environment, huge packages might be pre-installed in the global cache folder. With actions/cache@v2 you can now exclude unwanted packages with <a href=https://github.com/actions/toolkit/tree/main/packages/glob#exclude-patterns>exclude pattern</a></p>
<p><a href=https://github.com/actions/cache/blob/main/examples.md#c---nuget>https://github.com/actions/cache/blob/main/examples.md#c---nuget</a></p>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml>- <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/cache@v2</span>
  <span style=color:#f92672>with</span>:
    <span style=color:#f92672>path</span>: |<span style=color:#e6db74>
</span><span style=color:#e6db74>      ~/.nuget/packages
</span><span style=color:#e6db74>      !~/.nuget/packages/unwanted</span>      
    <span style=color:#f92672>key</span>: <span style=color:#ae81ff>${{ runner.os }}-nuget-${{ hashFiles(&#39;**/packages.lock.json&#39;) }}</span>
    <span style=color:#f92672>restore-keys</span>: |<span style=color:#e6db74>
</span><span style=color:#e6db74>      </span>      <span style=color:#ae81ff>${{ runner.os }}-nuget-</span>
</code></pre></div><p><code>!</code> を入れるだけかと思って検証してみたらどうも意図した振る舞いにならない。実はこの設定はバグっていて実際には動かない。なぜ動かないかを追いかけてないけど、issue にも登録されている。<code>path</code> の記述方法によって動いたり動かなかったりするというのが現状の振る舞いになるらしい。</p>
<ul>
<li><a href=https://github.com/actions/cache/issues/494>Excluded sub directory not working #494</a></li>
<li><a href=https://github.com/actions/toolkit/issues/713>Cache - excluding files or folders with ! not working #713</a></li>
</ul>
<p>ちなみに正しい動く設定は次になる。ワイルドカードを使わないといけないらしい。ドキュメントに除外設定について書いていないのはバグってて中途半端な振る舞いをしているからかもしれない。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml>- <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/cache@v2</span>
  <span style=color:#f92672>with</span>:
    <span style=color:#f92672>path</span>: |<span style=color:#e6db74>
</span><span style=color:#e6db74>      ~/.nuget/packages/*
</span><span style=color:#e6db74>      !~/.nuget/packages/unwanted</span>      
    <span style=color:#f92672>key</span>: <span style=color:#ae81ff>${{ runner.os }}-nuget-${{ hashFiles(&#39;**/packages.lock.json&#39;) }}</span>
    <span style=color:#f92672>restore-keys</span>: |<span style=color:#e6db74>
</span><span style=color:#e6db74>      </span>      <span style=color:#ae81ff>${{ runner.os }}-nuget-</span>
</code></pre></div><p>あとビルドキャッシュのキーにパッケージ管理のファイルのハッシュ値を取るようになっている。この背景も github actions がキャッシュをクリアする機能を提供していないからであろう。<a href=https://github.com/actions/cache/issues/2>Clear cache #2</a> でも議論されているが、キャッシュをクリアできないため、同じキーにパッケージが溜まり続けるような運用は開発者にとっても github 社にとってもリソースを浪費するので好ましくない。いまは7日以上アクセスされていないキャッシュを削除する運用になっているため、なるべくフレッシュなキャッシュが生成されるような運用となるよう、ハッシュ値を取得するようなキーの運用が行われているように推測される。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1203/>チームごっこ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-03
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。</p>
<h2 id=朝活-アジャイル開発とスクラム-第2版>朝活: アジャイル開発とスクラム 第2版</h2>
<p>第7章の残りと第8章を読んだ。事例紹介なので軽く読み流した感じ。インタビュー記事のタイトルが気になった。</p>
<blockquote>
<p>「合宿で、「仕事での同僚」から「チームの仲間」になれました</p>
</blockquote>
<p>このタイトルと内容に私は違和感があるので反論としてそれを書いていく。</p>
<p><a href=https://pub.jmam.co.jp/book/b517388.html>心理的安全性のつくりかた</a> に書いてあったが、MIT のオスターマン教授によると、チームという概念は比較的新しいものらしい。</p>
<blockquote>
<p>職場における、チームという概念は1980年以降、最も広まったイノベーションのひとつだ。</p>
</blockquote>
<p>「心理的安全性のつくりかた」ではチームとグループの違いは次になる。</p>
<ul>
<li>チームは共通の目標に向かってともに問題解決やアイディアを出す集団</li>
<li>グループはそうなっていない、ただの寄せ集めの集団</li>
</ul>
<p>共通の目標に対して互いに対話や協働することでチームになっていく。この考え方は私の経験則とも合致するし支持している。実際の業務や作業を通してチームは築かれていくと私は考える。しかし、コミュニケーションの活性化や親睦を深めればチームになると誤解している人もいるように思う。</p>
<p>件のインタビュー記事では、次の内容があった。</p>
<blockquote>
<p><strong>合宿の最大の成果は、何だったのでしょう？</strong></p>
<p>「仕事での同僚」から「チームの仲間」になれたことだと思います。昨今、ハラスメントやプライバシーの観点からなかなか個人の深い話ができないことが多いと思いますが、お互いを信頼した上で自分の生い立ちや経験から「私がなぜここにいるのか」を深掘りできたことが大きいと思います。</p>
<p>具体的には、誰とも話さず、自分を見つめる時間として三浦海岸の浜辺に全員を１時間放置しました（笑）。その時間で自分の今までをふりかえり、再集合したときに１人ずつ語り、お互いのことを尊重し受け入れることで心理的安全性が一気に高まったと思います。</p>
</blockquote>
<p>私だったら転職を考えますね。浜辺に放置されて再集合して生い立ちとか語れとか言われて、そんな上司だと懸念を抱くと思う。その場で抗議はしなかったとしても。仕事を通して結果的に信頼関係が深くなって、同じ行動をするなら理解できるが、そうじゃない状態で職位の高い人がメンバーに合宿を半強制参加させてプライベートの内容を話させるのはハラスメントと紙一重かもしれない。おそらくこれはたまたまうまくいったケースだというだけで再現性のあるプラクティスにはまったく思えない。厳しい言い方をすると、偉い人の自己満足によるチームごっこではないかと思う。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>「仕事での同僚」から「チームの仲間」になれたというインタビューが書かれていた。私の感覚ではやや違和感がある。グループではなくチームという概念が認識されるようになったのはわりと最近の話だというのはたしか心理的安全性のつくりかたに書いてあった気がする。 <a href="https://twitter.com/hashtag/%E9%87%91%E6%9C%9D%E3%83%84%E3%83%A1%E3%83%88%E3%82%AE?src=hash&ref_src=twsrc%5Etfw">#金朝ツメトギ</a></p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1466528241661874179?ref_src=twsrc%5Etfw">December 2, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<h2 id=本番リリース作業>本番リリース作業</h2>
<p>今日は非稼働日なんだけど、インフラ周りの修正をしていたので本番リリースの作業を見守っていた。ハドルで画面共有しながらみんなでわいわいできるので、これはこれでリリース作業の雰囲気を学ぶ機会にもなる。私が本番リリースすることはないだろうけど、担当者がどういった作業でリリースしているかを知っておく方が運用に役に立つ仕組みも導入できるかもしれない。音声通話と画面共有さえあればフルリモートワークでもなにも困ることはない。よい世の中になったと思う。RabbitMQ と Dapr 周りで私が懸念に思っていたことを本番リリースを通して検証したり振る舞いを観察できたので新たな知見を得た。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1202/>スクラムイベントにもの思い</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-02
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て6時半に起きた。昨日は疲労困憊だったのでなんもせずすぐ寝た。</p>
<h2 id=スクラムイベント>スクラムイベント</h2>
<p>お仕事のスクラム開発で木曜日はスプリントレビューとプロダクトバックログリファインメントを行う。主にステークホルダーとプロジェクトオーナーがプロダクトバックログアイテムの優先度を議論したり、タスクに細分化されていない課題をタスクにしていくための作業に当てたりしている。本当はタスク化されたイシューをさらにリファイメントするイベントなのだろうだけど、まだそこまで業務やチームの体制が成熟していないため、タスクの細分化のための時間になっていたりしている。</p>
<p>これらのイベントで開発者がイニシアティブをとることはないけど、プロダクトオーナーやその業務チームにいるメンバーたちがどうやって業務をタスク化しているかのやり取りもみえたりする。開発者にとってそのやり取りをみていることに意味があるかどうかはまだ私にはわからないが、業務チームのメンバーがどういった働き方をしているかを知るきっかけにはなる。業務チームは <a href=https://miro.com/>miro</a> を使ってメンバーみんなで同時編集しながら課題を付箋代わりのメモに落としていく。その個々のメモがタスクに近いものになるのだろうけど、私からみたら業務すべてを知っている人がまとめて細分化してドキュメントに書き記して2-3回みんなでレビューすれば終わるようなものを、みんなで付箋紙に書いていって整合性が取れているのかどうかわからないメモの固まりを作っているようにみえる。この作業はみんなでやらないと進捗しないので1週間に1回とかになる。</p>
<ul>
<li>チームが扱うすべての業務を知っているメンバーはいない</li>
<li>業務に必要な機能の優先順位や優先度を決める権限をもっていない</li>
<li>情報が足りないと思ったときにメンバーが自律的に動いて補う体制が整っていない</li>
</ul>
<p>あとステークホルダーが話す要件や仕様に関わってくる話の大半が口頭で行われていてドキュメントや課題管理に文章として書き記されていない。だから同じ話しを何度も繰り返し聞くようなケースも発生する。わからないことを聞くことも、繰り返し聞くことも問題ではないが、議事録以外にそこで話す内容がドキュメント化されないのはどうしてだろう？という気もした。もっともっと文章を書かないと情報共有やノウハウをためることにはつながっていかないだろうということも垣間みえる。</p>
<p>総括すれば、どんな開発方法論を使っても、リーダーやマネージャークラスが圧倒的に文章を書けないと、その配下のメンバーは自律的に行動できないというだけの話しでしかないが、どうやったら解消できるか？はまだまだこれからの私の課題でもある。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1201/>師走入り</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-01
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/dapr/>dapr</a>&nbsp;
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
</span>
<div class=post-content>
<p>1時から1時間ほど仮眠をとって2時から4時過ぎまで作業して帰ってお風呂に入ってそのまま6時から <a href=https://kobe-sannomiya-dev.connpass.com/event/232426/>【三宮.dev オンライン】リモート朝活もくもく会</a> の朝活に参加した。30分ほど雑談して眠くなって7時過ぎから9時前まで寝てた。</p>
<h2 id=dapr-の-pubsub-の-dead-letter-サポート>dapr の pubsub の dead letter サポート</h2>
<p>お仕事で dapr を触っている。pubsub で dead letter queue の仕組みを導入しようとしているが、<a href=https://github.com/dapr/dapr/issues/2217>PubSub&rsquo;s DeadLetter Topic #2217</a> によると v1.6 (2022年1月20日リリース予定) のマイルストーンになっている。本当にその予定ならそろそろベータ版が実装されていて、開発ブランチあったらテストしようかと考えていた。調べてたら rabbitmq はすでに v1.5 で dead letter のサポートがマージされているのを発見した。</p>
<ul>
<li><a href=https://github.com/dapr/docs/pull/1844>Add dead letter support for RabbitMQ pubsub #1844</a></li>
</ul>
<p>たまたま、いま使っている pubsub も rabbitmq だった。ドキュメントをみたら確かにその設定が追加されている。</p>
<blockquote>
<p><a href=https://docs.dapr.io/reference/components-reference/supported-pubsub/setup-rabbitmq/>dapr RabbitMQ</a></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Required</th>
<th>Details</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>enableDeadLetter</td>
<td>N</td>
<td>Enable forwarding Messages that cannot be handled to a dead-letter topic. Defaults to &ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo;, &ldquo;false&rdquo;</td>
</tr>
<tr>
<td>maxLen</td>
<td>N</td>
<td>The maximum number of messages of a queue and its dead letter queue (if dead letter enabled). If both maxLen and maxLenBytes are set then both will apply; whichever limit is hit first will be enforced. Defaults to no limit.</td>
<td>&ldquo;1000&rdquo;</td>
</tr>
<tr>
<td>maxLenBytes</td>
<td>N</td>
<td>Maximum length in bytes of a queue and its dead letter queue (if dead letter enabled). If both maxLen and maxLenBytes are set then both will apply; whichever limit is hit first will be enforced. Defaults to no limit.</td>
<td>&ldquo;1048576&rdquo;</td>
</tr>
</tbody>
</table>
</blockquote>
<p>enableDeadLetter=true に設定して、適当にエラーが発生しそうなリクエストを作って dead letter にメッセージが入るかどうかを検証してた。ひとまず dead letter にメッセージが入ること自体は確認できた。</p>
<h2 id=bizpy-勉強会>bizpy 勉強会</h2>
<p><a href=https://bizpy.connpass.com/event/229239/>Python で Slack のインテグレーションをやってみる勉強会 #3</a> を開催した。月曜日から2時間もあればできる資料作成をだらだら先送りしていて夜中に作った。なんか体調を崩しているのかもしれない。たまたま勉強会の前にせらさんから激励のコメントをいただいて嬉しかった。</p>
<blockquote>
<p>今日の分も含めコンテンツ拝見しましたが、素晴らしいですね</p>
</blockquote>
<p>私見だけど、slack インテグレーションで調べものをしているとせらさんの記事や issue のやり取りをみかけることが多い。twitter で slack インテグレーションに関してつぶやくと100%せらさんからレスポンスがある (個人の経験談) 。過去に私は外資の ISV で働きたいと思って活動したこともあったけど、せらさんをみていて自分のレベルでは無理だったなと得心がいった。なにがすごいって、bizpy の勉強会のようなところにもわざわざやってきて、講師にコメントしたりアドバイスしてくれるんだからね。</p>
<p>2ヶ月に渡り、slack インテグレーションのチュートリアルレベルの記事を実際に設定してみて、サンプルコード書いてみて、動かしてみて、slack でどんなことができそうかの理解を深めることができた。今回の内容はビジネスパーソン向けではなかったのでちょっと敷居が高かったかもしれないが、全3回でやり切ることができてよかった。終わってから運営に新たにわたなべさんが加わったことを参加者に紹介しつつ、次回の企画について雑談していた。次回はわたなべさんから機械学習入門のような勉強会をしてもらうことに決まった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1130/>66日目</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-30
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/writing/>writing</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て3時過ぎに起きて作業しようと思ったものの、やっぱりそのまま寝てしまって7時に起きた。前々日にあまり寝てなかったせいか、睡眠不足を解消したとポジティブに考えとく。</p>
<h2 id=習慣化のための平均66日>習慣化のための平均66日</h2>
<p>前に <a href=https://note.com/t2y1979/n/nb6e36f94b198>GIG MINDSET ギグ・マインドセット</a> を読んだときにロンドン大学が行った研究で習慣になるには平均して66日かかるというのをみかけた。「平均して」というのが曖昧なところで、直観的に理解できるけど、対象の難易度によって習慣化に要する日数が異なる。簡単なことはすぐ習慣化できるし、難しいことには時間がかかる。それらをいくつも試してみて平均したら66日だったという話し。<a href=http://ishiirikie.jpn.org/article/182619784.html>66日仮説</a> でも言及されているようにこの手の研究はあまり鵜呑みにするのもよくない。とはいえ、何らかの基準や目安があること自体は悪いことではないので一般論として参考にするのはよいと私は考えている。日記を書くというのは比較的簡単なことだと私は捉えるが、66日続いたので習慣と化したとみなしていいだろう。</p>
<figure><img src=/diary/img/2021/1130_diary-dates.png>
</figure>
<h2 id=書くこと>書くこと</h2>
<p>日記に関連して「書くこと」そのものを研究対象としている。自分でも日記を書き続けて何が起こるのかを理解するために実践しているという意図もある。</p>
<p>日記だけではなく、私は業務の過程で普通の開発者より、平均的な文章量よりも大量に書く。課題管理システムに私以上にコメントを書く開発者を、この10年で1人もみたことがない。私以上に課題管理システムを使いこなす開発者もこの10年みたことがない。課題管理システムの使い方や応用をメンバーにアドバイスするし、メンバーも私の使い方をみて真似してくれることもあった。これまでそういった行動は無意識にやっていたことだけど、それを意識化して形式知として体系化したいという狙いもある。</p>
<p>書くことは <a href=https://note.com/t2y1979/n/n4713058f48ce>メタ認知を活用して学びのスキルを磨く</a> 手法の1つとして優れていると私は考えている。これを開発者にとって日常的な課題管理 (システム) に取り入れられないかというのが、私の持論であり今後の研究課題である。たまたま、はらさんとそういった話題で話す機会があり、共感してもらえて嬉しかった。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr><a href="https://twitter.com/t2y?ref_src=twsrc%5Etfw">@t2y</a> 先ほどはありがとうございました！色々と参考になることがあり、また久しぶりにお話しできて楽しかったです！また、お願いします。<br>下記の「書くこと」とか、すごい良いと思い、ライトに始めてめて見ようと思います！<a href=https://t.co/WnnQ1JeSG4>https://t.co/WnnQ1JeSG4</a></p>&mdash; Hiroshi Hara (@hir_hara) <a href="https://twitter.com/hir_hara/status/1465631183752949761?ref_src=twsrc%5Etfw">November 30, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1129/>辞めるときの余裕</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-29
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/career/>career</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<div class=post-content>
<p>2時半に寝て6時半に起きた。なぜか眠れなくて鬼滅の刃をみてた。本当は夜に bizpy の資料作りをしようと思っていたけど、前日にあまり寝てなかったせいかバテてそのまま寝てしまった。</p>
<h2 id=お仕事の辞め方>お仕事の辞め方</h2>
<p>たまたまお手伝いしているところである開発メンバーが今月いっぱいで辞めますという連絡があった。その方は今日お休みだったので明日で辞めますみたいな急な連絡となった。もちろん上司や関係者には前々から話しは伝わっていて、引き止めや調整をしていたのだろうけど、チームとして働くにおいてメンバーはショックを受けるというか驚くというのが普通の感覚だろう。私も少なからず組織を退職してきた。私の場合、有給休暇が余っていたので辞めると言い出すのは実際に辞める3ヶ月ぐらい前で、有給消化が1ヶ月、引き継ぎに1ヶ月、引き止めや調整に2週間、2週間ぐらいはバッファみたいな感じで辞めてきた気がする。組織の規模によるけど、大きい組織は順番に引き止めの打ち合わせがくるので時間がかかる。組織にもよるけど、私の場合は3-4ぐらい、上長、課長、部長、その上の偉い人みたいな感じか。少なくともメンバーが退職を知ってから1ヶ月以内に辞めるということはない。私は過程の記録が課題管理システムに残っているし、ドキュメントも普段からそこそこ書く方なので辞めるときにドタバタすることはほぼない。ドキュメントなくても課題管理システムにやったことはすべて残ってますからと説明できる。上長からも引き継ぎに困るという心配をされたこともない。</p>
<p>辞め方というのはその人の信義を表すように私は思っていて、どういう背景や事情があるにしろ、ひどい辞め方をするのは本人にとって百害あって一利なしだと思う。余裕のない辞め方というのはあまり推奨しない。</p>
<h2 id=忘年会>忘年会</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/231602/>【初参加大歓迎】三宮.dev＆bizpy 合同忘年会</a> の日程を12月10日に決定した。オミクロン株の不安などが出てきたところだけど、水際対策をがんばっているのでまだ大丈夫かなといましかできない飲み会をこのまま行うことにする。言うても参加してくれるメンバーは限定的なのでいつも人たちで労をねぎらうみたいな飲み会になりそう。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1128/>slack ペイロードの response_url にはまった</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-28
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て8時に起きた。昨日は喋り倒して疲れてよく眠れた。午前中は溜まった日記を書き殴って、お仕事でやっているカスタム github actions で気になったコードを修正して、午後から bizpy の勉強会の準備を始めた。なんか気乗りせずにだらだらやって最終的には出来上がった。たいていだらだらやるときは頭の中ではもう出来上がってて集中したら2-3時間でできるのを脳が把握していて、まだ時間に余裕があるから怠けるみたいなときがある。そういうときは作業やめて散歩に出掛けるようにしている。</p>
<h2 id=bizpy-勉強会の資料作り>bizpy 勉強会の資料作り</h2>
<p>次の <a href=https://bizpy.connpass.com/event/229239/>Python で Slack のインテグレーションをやってみる勉強会 #3</a> のサンプルコードの実装をしていた。内容はだいたい次の通り。あとは資料をまとめるだけ。</p>
<ul>
<li>slash command の設定と実装</li>
<li>ephemeral メッセージ (本人だけみえるメッセージ) の実装</li>
<li>block kit でモーダルダイアログに入力した情報を使ってチャットに書き込む
<ul>
<li><a href=https://openweathermap.org/>OpenWeather API</a> を使って天気の情報を連携する</li>
</ul>
</li>
</ul>
<p>たまたまモーダルダイアログを取り上げただけなんだけど、モーダルダイアログを submit したときにチャットに書き込むのは、そのままではできなくて、なんらかの特別な処理が必要になって、そこにはまってた。response_url の扱いはわりとややこしいみたい。</p>
<ul>
<li><a href=https://qiita.com/seratch/items/ed29acd565af36e65072>Slack ペイロードに含まれる response_url を完全に理解する</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1127/>まる一日喋り続けた日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-27
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/writing/>writing</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時半に起きた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>先週に引き続き、今週もお仕事でバテてストレッチは2日/週とあまりできなかった。ウォーキングもほとんどできなかった。とはいえ、先週の土日に観光案内でいつもよりかなり歩いたのでその休息と考えればそれほど悲観的にならなくてもよいかもしれない。ウォーキングしなかった背景は寒くなってきて21時頃に帰ってきて、また外に出掛けるのが億劫になってしまった。お仕事を早めに切り上げて早めに帰って来た方がよいかもしれない。</p>
<p>今日の開脚幅は開始前168cmで、ストレッチ後170.5cmだった。また170cmを超えるようになったのでよいサイクルに入ってきた。2週間に渡った中殿筋の張りはおさまった気がする。代わりに腰の筋肉に張りがあって、トレーナーさんも念入りにそこをストレッチしてくれた。生活していると、そのときどきで調子の悪い箇所は移動していて、ストレッチするとそのことに気付くので体調管理を意識する意図でもストレッチは役に立っている。</p>
<h2 id=もくもく会>もくもく会</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/229761/>【三宮.dev】もくもく会</a> に参加した。今回はオフラインのもくもく会だった。私は bizpy の勉強会の資料作成の準備をしていた。ここ数回は主催者と私の2人だけしかオフラインに来ないといったことが多かったのだけど、今回は8人も参加していて、その8人中5人が勉強会コミュニティに主催者だったりしてちょっとおもしろかった。</p>
<p>コミュニティの主催者は、コミュニティ運営の苦労がわかるから他のコミュニティのよき参加者になり得る。私は 三宮.dev の運営には関わっていないが、コミュニティを盛り上げることに寄与する振る舞いはしていて、それは自分のコミュニティでもこういったやり取りが増えるといいなという願望を他のコミュニティで参加者としてやっていたりする。今回のオフラインの参加者が多かったのも、他の勉強会コミュニティでもオフラインでやりたいよねと思う人たちが集ったのではないかとか考えたりしていた。</p>
<h2 id=ぷち飲み会>ぷち飲み会</h2>
<p>終わってからわたなべさんと立ち飲みに行ってきた。最近あまり行ってない <a href=https://hannari-python.connpass.com/>はんなりPythonの会</a> の勉強会で (オンラインで) なんどか話したことがある方で、ずっと京都に住んでいると思っていた方がめっちゃご近所さんだった。わたなべさんは私より1つ学年が上で、世代における価値観に共感するところは多く、自身もマイクロ法人を営んでいた。研究者としてキャリアを積み重ねてこられて昨年、独立したようだ。はんなりPythonの会の運営にも最近入ったそうで、ついでというわけではないが、話していて気が合うなと思ったので bizpy の運営に入ってくれません？と尋ねたら快く了承してくれた。</p>
<p>bizpy の最大の懸念は運営が私1人で、私がお仕事で忙しくなったら休業してしまうという問題があった。なかなか勉強会のコミュニティの運営をできそうなメンバー (スキル、価値観、時間的余裕) をみつけるのは難しいので了承してくれてとても嬉しかった。わたなべさんは博士で研究者のキャリアをもっていて、いまは機械学習などに取り組んでいるのかな？私のキャリアとは全く重なりがないのでお互いに学ぶところがあってよい関係を築けるのではないかと思う。ビジネスパーソン向け機械学習入門みたいな勉強会をしてもよいと思う。</p>
<h2 id=リーンキャンバスレビュー-後半>リーンキャンバスレビュー (後半)</h2>
<p><a href=/diary/posts/2021/1122/#リーンキャンバスレビュー-前半>前回</a> の続き。残りの半分を進めるのかなと考えていたけど、前回のおさらいから始めて、私の意図するプロダクトの価値やサービスの特徴の話しをしていたら、このサービスはすぐに顧客に価値が伝わるものでもなければ、急成長するようなビジネスでもないということが伝わって、リーンキャンバスをやる意味はあまりないねという話しで後半戦をやらずに終わったw。どうも新規事業=急成長やスケールするビジネスという考えでリーンキャンバスを持ち出したところがあって、私は最初からそんなことは一言も言ってないし、私が作った資料にもそういった懸念や展望は書いてあったんだけど、リーンキャンバスを通して話しているうちにその意図を理解してもらえたといった様子だった。</p>
<p>そういう意味でリーンキャンバスは急成長やスケールするビジネスを取り扱うときに投資家や顧客にわかりやすく訴求するためのフレームワークと言えるのかもしれない。仮にビジネスがうまくいったとしても、合同会社は投資を受けるのが難しいのでそのときは株式会社を別途作ってやるのかなぁみたいな、取らぬ狸の皮算用みたいな話も知った。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1126/>朝から晩まで多忙な一日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-26
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/github/>github</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時に起きた。昨日 slack で質問していた内容に5時頃に返信があるのをたまたまみかけた。この時間に起きているんだと思って返信にコメントしてたら別のメンバーからもコメントが書き込まれて、早起きは三文の得みたいな感じで朝5時から slack でやり取りしてた。いま私はだいたい8時から始業している。開発チームの半分ぐらいのメンバーはそのぐらいから始業しているのが課題管理システムや git のコミットログからわかる。このチームは朝早い人たちが多いなと感心した。</p>
<h2 id=朝活-アジャイル開発とスクラム-第2版>朝活: アジャイル開発とスクラム 第2版</h2>
<p><a href="https://www.youtube.com/watch?v=3T8CTKDFd9g">2021-11-26 AM 6 金曜朝6時開催のもくもく会</a> で第6章と第7章を読んだ。第2部は企業において実際にスクラムを導入していったときの四方山話が出てくる。私はあまり他社の事例に興味はないが、対談の過程で本質的に大事なことや難しいことなどがあぶり出されることもあるので、実務を通しての話題も参考になる場合があることは理解できる。大半の事例は実業務で使われているという結論がわかるだけでも十分だと思う。とくに大企業は様々な厳しい制約や要件の中で採用していると推測されるので、それだけで大きなメッセージをもつ。斜め読みでざっと読み進めながら興味のある話題があれば精読するといった程度で読んでた。</p>
<p>大企業あるあるな話しでスクラムイベントを通してお互いの距離感が縮まってうまくいったといった内容があった。開発者からすると距離感の遠近に関係なく、必要なら適切な相手を探し出してコミュニケーションを取るのが普通だけど、みんながみんなそうではないだろうし、(同じ会社の社員でも)よく知らない人とは話さないといった考え方をもつ人もいるだろう。ある人はこれを単純接触効果で説明していたけど、業務ではなく人間の側面からみてスクラムイベントが多いことにも意義があるのかもしれない。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>ある事例でスクラムにおいてイベントがたくさんあってそれに参加することでお互いの距離感を縮めたという効果が書かれている。開発者は気になったことは何でも確認するという姿勢をとりがちだけど、関係者のみんながそうではないというのも理解できる <a href="https://twitter.com/hashtag/%E9%87%91%E6%9C%9D%E3%83%84%E3%83%A1%E3%83%88%E3%82%AE?src=hash&ref_src=twsrc%5Etfw">#金朝ツメトギ</a></p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1463982173212459019?ref_src=twsrc%5Etfw">November 25, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<h2 id=顧問さんと雑談>顧問さんと雑談</h2>
<p>隔週で打ち合わせをしている。最近はお手伝いのお仕事が忙しいので今回は雑談になってしまったが、近況としてリーンキャンバス、スクラム実践の話題などを話していた。わりと盛り上がって1時間で切り上げるつもりが1時間半に伸びてしまって、別のお仕事の時間を圧迫したけど、それはそれで意義のある雑談になったので収穫はあった。</p>
<p>ある組織で新規事業を行う上で <a href=https://www.innovation.co.jp/urumo/aarrr/>AARRR (あー) モデル</a> をすごく重視しているといった話題が出た。バケツみたいなイメージがあって、そこに現実の数字を当てはめていってプロジェクト/プロダクトの改善やふりかえりなどに活かしているという。サービスのグロースに責任をもつ人には重要な概念だという。うちのプロダクトはグロースしなくてもよいけど、なんらかのフレームワークに当てはめて抜け・漏れがないかをチェックすることにも使えるかもしれない。世の中でよく使われているフレームワークを調査しておいて損はないと思う。私はビジネスに全く疎いのでリーンキャンバスを通じて、AARRR モデルの話題になって、それがどういった用途で使われているかというお話しは興味深かった。</p>
<p>具体的には AARRR モデルの他に、スクラムの話題からは野中郁次郎氏のオリジナルの論文、大規模アジャイルの方法論などが盛り上がっていくつかキーワードが出た。そういった雑談の中で感性に従って気になったことを深堀りしていくとおもしろい調査や知見になったりすることを経験的に実感しつつある。今後もそういう機会や内容を大事にしていきたい。</p>
<h2 id=カスタム-github-actions-の開発>カスタム GitHub Actions の開発</h2>
<p><a href=/diary/posts/2021/1116/#カスタム-github-actions-作成>先日</a> 調査していたものをベースに、普通にやる方法と カスタム GitHub Actions の compoiste action で実装する場合の検討資料などを作って、カスタム GitHub Actions を実装してよいといった許可をもらった。企業における唯一の懸念は (原則) public リポジトリで運用するところで、CI のような処理に社外秘は含まれないが、public そのものに審査や承認を必要とするような組織では腰が重くなるようなこともあるかもしれない。ロードマップにも private リポジトリでカスタム GitHub Actoins を動かせるようにしようという課題は作成されている。</p>
<ul>
<li><a href=https://github.com/github/roadmap/issues/74>Actions: Use actions from internal repositories #74</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1125/>コーディングスタイルの共通化</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-25
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/ide/>ide</a>&nbsp;
</span>
<div class=post-content>
<p>1時半に寝て6時に起きた</p>
<h2 id=ソースコードのフォーマッター>ソースコードのフォーマッター</h2>
<p>go 言語の <a href=https://pkg.go.dev/cmd/gofmt>gofmt</a> が成功をおさめたことからどんなプログラミング言語でもコーディングスタイルはツールで自動整形するのがよいという雰囲気が醸成され、とくに業務の開発においては統一すべしというルールを設けている組織が多いと思う。java はこの領域では後塵を拝していると言ってよいと思う。歴史的に java の言語仕様と ide は相性がよかったため、ide がコーディングスタイルを自動整形していた結果、ide ごとに互換性のない異なるコーディングスタイルが使われるようになってしまった。私がアリエルで開発していた頃、開発者はみんな eclipse しか使ってなかったので問題にならなかった。しかし、いまや私が知っている ide だけでも次のものがある。</p>
<ul>
<li><a href=https://www.eclipse.org/>eclipse</a></li>
<li><a href=https://www.jetbrains.com/idea/>intellij idea</a></li>
<li><a href=https://netbeans.apache.org/>netbeans</a></li>
<li><a href=https://code.visualstudio.com/>vscode</a></li>
</ul>
<p>この問題を解決するツールとして最もメジャーなのは <a href=https://github.com/google/google-java-format>google-java-format</a> で、当初はこのツールを導入しようと考えていた。しかし、開発チームのテックリードから google-java-format のコーディングスタイルはひどい、一番優れているのは intellij idea だというお気持ちを表明された。導入を止めろと言われたわけではないが、チームに入ったばかりの私はテックリードのお気持ちに忖度して google-java-format の導入を断念した。代わりに intellij idea のデフォルトフォーマットをどうやって他の ide を共有するかを調べたところ、<a href=https://www.jetbrains.com/help/idea/configuring-code-style.html#editorconfig>Manage code style on a directory level with EditorConfig</a> で <a href=https://editorconfig.org/>EditorConfig</a> の設定 (<code>.editorconfig</code>) を intellij idea で再利用できることがわかった。</p>
<p>うちの開発チームのメンバーは intellij idea と vscode しか使っていないため、現状はこれで解決できるように思えた。intellij idea にはデフォルトで EditorConfig プラグインがバンドルされていて有効になっている。リポジトリのルートディレクトリに <code>.editorconfig</code> があれば自動的にそれを読み込んでくれる。そこで intellij idea のデフォルト設定を <code>.editorconfig</code> 形式でエクスポートして、それをリポジトリのルートディレクトリに配置することでコーディングスタイルのフォーマッターを共通化できた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1124/>eLTAX 触ってみた</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-24
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
</span>
<div class=post-content>
<p>0時半に寝て6時半に起きた。水曜日は朝活の日だったけど、申し込み忘れてカレンダーに入ってなかったから忘れてた。カレンダーの予定に従って生活していることがわかる。</p>
<h2 id=ふりかえり>ふりかえり</h2>
<p>今日はお仕事でスクラムイベントのレトロスペクティブがあった。最近は日本語でそのまま「ふりかえり」と呼ぶみたいやね。他の用語が英語なのであわせて英語で読んでたけど、ふりかえりの方が日本人的にはしっくりくるのでそれでいいと思う。</p>
<p>開発の情報共有のやり取りが活発になったという意見が出た。私は11月から働き始めてまだ3週間ほどなので以前がどうだったのかわからない。2週間前に本格的にスクラム開発に移行して、POや開発者のリーダーが新任したり、開発者に新規メンバー (私のこと) が追加したりと、いろんな状況が変わっている。なにか特別なことをしたというわけではないけど、自然にコミュニケーションがよい方に改善されているなら全体としてよい傾向に思える。私はまだ業務のことが全くわからないのでインフラやテストなどの非機能要件のタスクをやっているだけ。開発者からみて負債というほど大きなものではないが、やった方がよい技術的な残タスクのようなものを私がどんどん fix しているので開発環境がよくなっている気がするといったコメントを名指しでいただいた。スクラムマスターによると、ふりかえりでは、個人名で問題を指摘するのはよくないが、個人名で感謝を伝えるのはよいという。なので、よいことには個人名が前面に出る。褒められて悪い気がする人はそうそういないので、このプラクティスはチームの雰囲気をよくすることに寄与するのだろうと思えた。</p>
<h2 id=続-年末調整と住民税の納付>続: 年末調整と住民税の納付</h2>
<p><a href=/diary/posts/2021/1123/#年末調整と住民税の納付>昨日</a> の続き。eLTAX のソフト版をダウンロードして年末調整の給与支払報告書の申請、住民税の特別徴収の納付も行った。アプリケーションの操作方法と手続きのドキュメントは懇切丁寧な内容なので、アプリケーションそのものの使い勝手はいまいちだけど、とくに手続きに迷うこともなく、順番に操作していけば問題なく申請や納付を完了できた。この2つの手続きは、昨年は紙で申請したり納付したりしていたのが、今年は電子申告になったのでちょっとクラスチェンジしたような感覚で気分がよかった。定期的な行政手続きを毎年やりながら少しずつやり方を洗練させていったり、異なる手続きに挑戦してみたり、制度の仕組みを理解したり、そういう少しずつ改善して学びを深めていくことそのものに幸せ感がある。人に依るんだろうけど、わりと私はマイクロ法人の行政手続きを楽しんでいる。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1123/>スクラムの起源</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-23
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>5時に寝て7時半に起きた。前週末は遊んでたので夜はいろいろ作業してた。朝起きる習慣がついてきたので何時に寝ても起きれる感じになってきた。うまく体調管理もできている。</p>
<h2 id=年末調整と住民税の納付>年末調整と住民税の納付</h2>
<p>年末調整は1月末まで、住民税の特別徴収は納付の特例を使うと6-11月の6ヶ月分を12月10日までに納める。年末調整も11月の給与を確定したら調整額を算出して12月の給与に反映する。必要な情報を入力したら会計システム (freee) で自動算出してくれて書類も一通り作ってくれるので難しくない。ここで出力される給与支払報告書を市役所と税務署のそれぞれに申請する。市役所向けの手続きは <a href=https://www.eltax.lta.go.jp/>eLTAX</a> で行い、税務署向けの手続きは <a href=https://www.e-tax.nta.go.jp/>e-Tax</a> で行う。先日 <a href=/diary/posts/2021/1103/#asus-rog-zephyrus-g15-ga503qr>Windows マシンを購入</a> したので、今回は eLTAX の DL 版で完全な手続きができるはず。ただし、e-Tax も eLTAX も祝日・日曜日は利用できないのでやろうと思ったものの、今日は祝日だからできなかった。</p>
<p>住民税の特別徴収の納付も今回が初めての試み。企業が社員に代わり住民税を納付するのが原則であり、これを特別徴収と呼ぶ。昨年は特別徴収への切り替え申請をしないといけないのを私が知らなくて手続きが遅れた結果、個人宛に届いた納付書でそのまま支払いした。納付自体はそれでも問題はない。おそらく徴税側からみたら源泉徴収して企業の担当者が納付した方が誤りがなく確実でサポートコストを削減できるという狙いなんだろうと推測する。住民税の納付も eLTAX でできるようなので後日挑戦してみる。</p>
<h2 id=アジャイル開発とスクラム-第2版-顧客技術経営をつなぐ協調的ソフトウェア開発マネジメント>アジャイル開発とスクラム 第2版 顧客・技術・経営をつなぐ協調的ソフトウェア開発マネジメント</h2>
<p>4日前から読み進めていて、第1部アジャイル開発とは何か、スクラムとは何か (第1章から第5章) を読み終えた。</p>
<p>冒頭の序論を読んでいて、スクラムは 1980 年代の日本の製造業の (革新的な) 製品開発スタイルの論文がオリジナルだというのを知った。ソフトウェア開発の文脈だと、米国から輸入した方法論のようにみえるが、もとは日本で編み出された方法論だったという。1986年に書かれたハーバード・ビジネス・レビューに投稿された論文がオリジナルらしい。</p>
<ul>
<li><a href=https://hbr.org/1986/01/the-new-new-product-development-game>The New New Product Development Game by Hirotaka Takeuchi and Ikujiro Nonaka</a></li>
</ul>
<p>前に <a href=https://scrumguides.org/docs/scrumguide/v2020/2020-Scrum-Guide-Japanese.pdf>スクラムガイド2020</a> を一通り読んでいたので、スクラムについての内容はだいたい理解できた。補足でよかったのは、スクラムガイド 2017 から 2020 で改訂された内容やその背景や意図などがコラムで紹介されていた。それらを知ることで、よりスクラムで陥りやすい失敗や誤解されがちなところを理解できた。たとえば「開発チーム」という用語から「開発者」に改められた。スクラムチームの中に別のチームがあるようにみえ、プロダクトオーナー vs 開発チームのような対立構造にならないよう、チームはスクラムチームという1つしかないという意図だという。そして、開発チームの自己組織化 (Self-organized) というキーワードが、スクラムチームの自己管理型 (Self-managed) へといったように、主体である開発チームだけ自律的且つ協働するように読めたのを、スクラムチームという1つのチームしかないと強調されている。</p>
<blockquote>
<h5 id=コラム-2020-スクラムガイド改訂とスクラムの3つの罠>コラム: 2020 スクラムガイド改訂とスクラムの3つの罠</h5>
<ul>
<li>スクラムが形式的、儀式的になってしまっている
<ul>
<li>目的を理解せずにハウツーをなぞるだけのチームが増えたので抽象的な表現に変更した</li>
<li>例) デイリースクラムがただの報告するだけになっている
<ul>
<li>デイリースクラムの目的は状況にあわせた再計画であるため、形式的な報告ではいけない</li>
</ul>
</li>
</ul>
</li>
<li>プロダクトオーナー vs 開発チームの構図に陥ってしまっている
<ul>
<li>チーム内の分断をなくし、ワンチームになることが強調されている</li>
<li>開発チームから開発者へ、チームはスクラムチームが唯一</li>
<li>プロダクトオーナー vs 開発者が対立構図になることが多かった
<ul>
<li>「開発チームの自己組織化」から「スクラムチームの自己管理」へ</li>
<li>スクラムは役割を超えて協力していくことが欠かせない
<ul>
<li>問題 vs 私たち (スクラムチーム) という構図を引き出すことが重要</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>スクラムマスターがスクラム警察もしくは雑用係になってしまっている
<ul>
<li>スクラムマスターが「サーバントリーダー」とされていたが、単にサーバントになってしまうことがあった</li>
<li>スクラムマスターはプロダクトの成果や組織の目標にコミットメントしないといけない
<ul>
<li>ただスクラムルールを守らせたり、会議の司会役をするだけではない</li>
</ul>
</li>
<li>「真のリーダー」としての資質とプロダクトの成果や組織の目標にコミットメントしていくための熱量を重視して専任していく必要がある</li>
</ul>
</li>
</ul>
</blockquote>
<p>これらのコラムを読むと、私が傍からみていたスクラムは本来の意図したスクラムの開発方法論ではなく、正しく運用されていなかったスクラムなのかもしれないとも思えてきた。本書の第1部を読み進めてみて、スクラムの意図している目的や価値には私が共感できるところが多々あった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1122/>kustomize のパッチ適用の違い</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-22
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;
#<a href=/diary/tags/writing/>writing</a>&nbsp;
</span>
<div class=post-content>
<p>22時ぐらいには寝て6時半に起きた。昨日はお出かけしてきてバテたんで19時頃からうたた寝を繰り返してずっと寝てた。実家に帰っていた期間を除いて、土日のどちらかを休むのはここ3ヶ月はなかったと思うし、土日の2日間ほとんど仕事をしなかったのは半年ぐらいはなかったと思う。久しぶりに土日に仕事しなかったなという印象で、その理由は業務委託のお仕事の契約が決まって余裕があるからだと思う。</p>
<h2 id=kustomize-の-inline-patch>kustomize の Inline Patch</h2>
<p><a href=https://kubectl.docs.kubernetes.io/guides/example/inline_patch/>Inline Patch</a> に次の3つのやり方が説明されている。</p>
<blockquote>
<ul>
<li>patchesStrategicMerge: Strategic Merge Patch として解析されるパッチファイルのリスト</li>
<li>patchesJSON6902: 1つのターゲットリソースのみに適用可能な JSON Patch として解析されるパッチと関連付けされるターゲットのリスト</li>
<li>patches: 関連付けされるターゲットとパッチのリスト。このパッチは複数のオブジェクトに適用でき、パッチが Strategic Merge Patch なのか JSON Patch かは自動的に検出</li>
</ul>
</blockquote>
<p>patches は patchesStrategicMerge と patchesJSON6902 の両方を記述できる。運用上は patchesStrategicMerge か patchesJSON6902 を適用したいパッチの内容によって使い分けることになる。おそらく前者は base にない要素を追加したり、base の要素をすべて置き換えたりするときに使う。後者は base にある map や list の一部の要素のみを限定して置き換えたり、削除したりするときに使う。ちなみに patchesJSON6902 の 6902 というのは <a href=https://datatracker.ietf.org/doc/html/rfc6902>RFC 6902 JavaScript Object Notation (JSON) Patch</a> に由来する。</p>
<p>patchesJson6902 の例として次のような設定にパッチを適用する。base から読まれた metadata の要素から namespace のみを削除したり、spec.metadata の1番目のリストの secretKeyRef が参照する Secret を my-secret で置き換えたりできる。こういったパッチを patchesStrategicMerge で実現することはできないのではないかと思う (詳しくないので私が間違っているかもしれない) 。</p>
<h5 id=baseyml>base.yml</h5>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Component</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-component</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>metadata</span>:
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>username</span>
    <span style=color:#f92672>value</span>: <span style=color:#ae81ff>user</span>
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>password</span>
    <span style=color:#f92672>secretKeyRef</span>:
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>base-secret</span>
      <span style=color:#f92672>key</span>: <span style=color:#ae81ff>password</span>
</code></pre></div><h5 id=kustomizationyml>kustomization.yml</h5>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>...
<span style=color:#f92672>patchesJson6902</span>:
  - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>my-patch.yaml</span>
    <span style=color:#f92672>target</span>:
      <span style=color:#f92672>group</span>: <span style=color:#ae81ff>apps</span>
      <span style=color:#f92672>version</span>: <span style=color:#ae81ff>v1</span>
      <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Component</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-component</span>
...
</code></pre></div><h5 id=my-patchyaml>my-patch.yaml</h5>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>op</span>: <span style=color:#ae81ff>remove</span>
  <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/metadata/namespace</span>
- <span style=color:#f92672>op</span>: <span style=color:#ae81ff>replace</span>
  <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/spec/metadata/1/secretKeyRef/name</span>
  <span style=color:#f92672>value</span>: <span style=color:#ae81ff>my-secret</span>
</code></pre></div><h2 id=リーンキャンバスレビュー-前半>リーンキャンバスレビュー (前半)</h2>
<p><a href=/diary/posts/2021/1114/#リーンキャンバス>前に作ったリーンキャンバス</a> を使って友だちにプロダクトの設計をレビューしてもらった。私がリーンキャンバスを作ったことがなかったので、この項目にはどういった内容を書くか、それぞれの項目がどういった関連付けや粒度で整理するかといった、リーンキャンバスの書き方そのものも含めて教えてもらった。</p>
<p>私が設計のために作った40枚のスライドを話すと2時間必要とするが、リーンキャンバスを使えば要点のみ15分で話せるようになるのが狙いになるみたい。とはいえ、リーンキャンバスの書いてある内容の半分を確認するだけで今日は2時間弱かかってしまった。議事録を取りながらだったので話すだけならもっと短くなったかもしれないし、その背景や根拠を細かくツッコミしていくとそれなりの時間はかかるのかもしれない。リーンキャンバス上は数枚の付箋で簡潔に書いてあるが、これどういうこと？みたいな問いになると詳細を説明しないといけないので時間がかかったように思う。リーンキャンバスの精度や品質が上がれば、読み手が詳細を確認しなくても意図を理解しやすくて詳細のツッコミが不要になるのかもしれない。これまで使ったことがないツールでおもしろいので週末に後半を行う。課題管理の背景には実践知、認知心理学、情報共有、組織論といった様々な分野にまたがるのでそのコンテキストを共有するのはなかなか難しいのではないかという思いもある。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1121/>六甲山と灘五郷</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-21
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/kobe/>kobe</a>&nbsp;
</span>
<img src=/diary/img/2021/1121_ball.jpg class=post-cover alt=六甲山と灘五郷>
<div class=post-content>
<p>1時ぐらいに寝て6時に起きた。</p>
<h2 id=オリックスレンタカー>オリックスレンタカー</h2>
<p>昨日、9:00 - 17:00 で予約したものの、8時には出掛けられる状態になったので電話で確認したら早くてもよいと言う話だったので 8:15 から車を借りる。車種は <a href=https://ja.wikipedia.org/wiki/%E3%83%88%E3%83%A8%E3%82%BF%E3%83%BB%E3%83%B4%E3%82%A3%E3%83%83%E3%83%84>トヨタ・ヴィッツ</a> 1.3l だった。wikipedia によると、2020年3月31日で販売終了になっているみたい。六甲山のような山登りを普通に走る分にはコンパクトな車体で快適に走行できた。私は車に全くこだわりがないのでこのぐらいのサイズの車で十分だと感じた。保険やWeb割引を含めて8時間レンタルして7,700円だった。</p>
<h2 id=神戸市立森林植物園>神戸市立森林植物園</h2>
<p>三ノ宮市内から約30分ほどで <a href=https://www.kobe-park.or.jp/shinrin/>神戸市立森林植物園</a> に着いた。8時15分ぐらいに出発したので比較的車が少なくて渋滞にあわずに行けたのもある。六甲山の山道は2車線しかなく、森林植物園の少し手前で渋滞になった。なぜ渋滞しているかというと、駐車場に入るところで料金の支払いが手作業だから。私が行った9時前の時間帯では駐車場のキャパシティは十分にあったが、駐車場の料金支払いで渋滞を引き起こしていたようにみえた。ネットワーク回線がどのような状態かわからないけど、ETC のような機器があれば渋滞を緩和できるのだろうと推測する。六甲山行くならなるべく朝早く出発した方がよいとわかった。</p>
<p>森林植物園全体の1/3ぐらいしかまわれなかったけど、写真とかでみる想像通りの場所でとてもよかった。11月は紅葉シーズンでライトアップもしているらしい。朝みても紅葉がすごくきれいだったのでライトアップも期待して見に行ってよさそうに思えた。時間があれば3時間ぐらいハイキングしても楽しめると思う。</p>
<p><figure><img src=/diary/img/2021/1121_forest1.jpg>
</figure>
<figure><img src=/diary/img/2021/1121_forest2.jpg>
</figure>
<figure><img src=/diary/img/2021/1121_forest3.jpg>
</figure>
</p>
<h2 id=六甲山牧場>六甲山牧場</h2>
<p>森林植物園から10分ちょっとぐらいで <a href=https://rokkosan.jp/>六甲山牧場</a> に着いた。ここも北エリアしかまわれなかったけど、山羊と羊と馬と牛に触れながらのほほんできるような場所。小さい子ども連れの家族が多かったので、子どもが動物と遊んでいるところの邪魔をしないように配慮しながら楽しむ感じ。</p>
<figure><img src=/diary/img/2021/1121_goat.jpg>
</figure>
<p>ちょっと前に山羊は草を食べてくれるという榛葉賀津也氏のツィートをみかけた。実家に草刈りのために定期的に帰るのが面倒だと常々思っていたので山羊を飼えばいいんじゃないかと考えている。そのためには山羊が生活する場所を作ってあげないといけない。田んぼの余っているスペースに柵を設け、一緒に山羊小屋も作ってあげればよさそう。六甲山牧場でも山羊はずっと草を食べていた。その辺に生えている雑草を食べるのかどうかわからないけど、確かに草を食べてくれそうな雰囲気はした。すぐに出来ることではないけど、段階的に実家で山羊を飼うための調査をしていこうと思う。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>【スタッフ】注目！！4月15日読売新聞夕刊に「ヤギのおじさん！」として紹介されました！ <a href=https://t.co/3lIObrub4X>pic.twitter.com/3lIObrub4X</a></p>&mdash; 参議院議員 榛葉賀津也 (@SHIMBA_OFFICE) <a href="https://twitter.com/SHIMBA_OFFICE/status/1382868429384806401?ref_src=twsrc%5Etfw">April 16, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<h2 id=六甲山天覧台>六甲山天覧台</h2>
<p><a href=https://www.rokkosan.com/tenrandai/>六甲山天覧台</a> も行こうと予定していたが、道を間違えて辿り着けなかった。次回の機会があれば挑戦する。</p>
<h2 id=菊正宗酒造記念館と櫻正宗記念館>菊正宗酒造記念館と櫻正宗記念館</h2>
<p>お昼ごろに六甲山を降ってきたので <a href=https://www.kikumasamune.co.jp/kinenkan/>菊正宗酒造記念館</a> に行ってみた。お酒造りの道具や作業方法などの展示があって、お土産コーナーで無料試飲と有料試飲があって、無料でも2種類のきき酒ができる。お金を払うと4種類+つまみやアイスなどが付いてくるみたい。私は運転しないといけないのできき酒は飲めなかったけど、お酒が好きな人はいろんなお酒を試せておもしろそうに思う。</p>
<p>ついでにすぐ近くにある <a href=https://www.sakuramasamune.co.jp/sakuraen/sakuraen_index.html>櫻正宗記念館“櫻宴”</a> にも寄ってみた。ここは菊正宗記念館に比べると展示類などは少ないが、お土産コーナーは充実していたのとカフェと食事処は充実していた。また無料試飲はなく有料試飲のみだった。</p>
<p>灘五郷にはこういった記念館がたくさんあるので <a href=https://www.hyogo-tourism.jp/course/result/35>灘五郷酒蔵めぐり</a> をしても楽しそうに思えた。</p>
<h2 id=人と防災未来センター>人と防災未来センター</h2>
<p>レンタカーのレンタル時間がまだ少しあったので <a href=https://www.dri.ne.jp/>人と防災未来センター</a> に行ってみた。西館と東館に分かれていて、西館は阪神・淡路大震災の映像や展示など、東館は地震や津波一般の展示が行われているらしい。西館だけみてきた。10分ぐらいの阪神・淡路大震災の再現映像をみたけど、これはかなり迫力があって、震度7という地震の恐ろしさが伝わってきた。私は南あわじ市で15歳のときに震災を経験したけど、南あわじ市は震度4で大した被害がなかったと思う。震度7とか死んでてもおかしくないというのが再現映像から受け取れた。この映像をみて防災意識を高めるだけでも価値があったように思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1120/>レンタカーを予約した</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-20
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/food/>food</a>&nbsp;
</span>
<div class=post-content>
<p>1時前後に寝て6時に起きた。前日から母が泊まっていて、母は5時ぐらい起きて作業し始めるので必然的に朝起こされる。部屋を掃除してくれたのできれいになった。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今週もお仕事に忙しくてあまりストレッチもウォーキングはできなかったものの、前週から中殿筋 (ちゅうでんきん) の張りはずっと残っていて、今日もトレーナーさんによく伸ばしてもらったものの張りが強いなと言う印象がある。今日の開脚幅は開始前168cmで、ストレッチ後169.5cmだった。前週とほぼ同じで現状維持ちょっとよくなったぐらいかな。ボールを使った中殿筋のストレッチが気持ちよくて疲れたときによくやっているけど、やっぱり1人でやるストレッチには限界があって、誰かに押してもらったり伸ばしてもらったりする方がよく効く。</p>
<h2 id=三ノ宮元町観光>三ノ宮・元町観光</h2>
<p>親族が来ているので観光案内してきた。うちの会社のオフィスなども紹介した。三ノ宮・元町でショッピングして、南京町で豚まんや小籠包を買い食いしてきた。お昼は <a href=https://www.udonnoshikoku.com/>饂飩の四國</a> という老舗のうどん屋さんに入った。前からお店は知っていて、いつか入りたいなと思いつつ、やや価格帯も高いのでうどんだとちょっと高いかな？とも思っていたけど、今日初めて入ってみて食べたらおいしかったので価格は妥当と言える。私はおろし醤油焼きなすうどんを食べた。コシがあって長い麺はそれだけでもおいしかった。天ぷらが豪華だったので、接待などで天ざるや天丼をお勧めするのもよさそう。</p>
<figure><img src=/diary/img/2021/1120_udon.jpg>
</figure>
<h2 id=オリックスレンタカー>オリックスレンタカー</h2>
<p>住んでいるところに一番近いレンタカーに <a href=https://car.orix.co.jp/>オリックスレンタカー</a> がある。前に一度借りたことがあって、そのときは普通にお店に行って明日借りたいと言えば予約できた。今日も同じノリで明日借りたいと言ったら予約が埋まってますと返された。仕方ないと思って次に近いトヨタレンタカーで尋ねてみたけど、同様に予約が埋まっていますと返された。ネットで探すかなぁと思って、試しにオリックスレンタカーのアカウント作成して、予約検索してみたらちょうど探していたコンパクトサイズで予約できた。ほんの1時間前は予約で埋まっていると店員さんが言っていたのに、、、と思い返しながらいくつかのケースを考察した。</p>
<ul>
<li>私が質問して帰った後にたまたまキャンセルが出た</li>
<li>店舗予約とネット予約の在庫を別で管理していて、店舗予約在庫はなくなっていたが、ネット予約在庫だけ残っていた</li>
<li>店員さんが在庫を勘違いしていて実は1車だけ残っていた</li>
<li>Web の予約システムがバグっていて実は在庫がないのにネットから予約できてしまった</li>
<li>ネット予約すると近くの他の支店で余っている車両を再配置するワークフローがあるために予約できた</li>
</ul>
<p>昨日のメタ認知が暴走するではないけど、メタ認知を働かせるといろんなケースが出てくる。明日お店に行ってちゃんと配車されることを期待する。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1119/>メタ認知にもの思い</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-19
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/metacognition/>metacognition</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。昨日も疲れててウォーキングには出掛けられなくて寝て、3時や4時に起きつつも気付いたら5時半に起きてて、そう言えばと思い出したときに6時だったというふわふわした寝起きだった。</p>
<h2 id=朝活-ミクロ経済学入門の入門>朝活: ミクロ経済学入門の入門</h2>
<p><a href="https://www.youtube.com/watch?v=g9-KQ76QmtI">［金朝ツメトギ］ 2021-11-19 AM 6</a> で第10章の再分配を読んだ。この本はほとんど朝活で読み終えた。</p>
<p>市場は社会的余剰が最大化されるので社会全体の富を増やす働きの強い制度だという。その増える富の方向性をタテとヨコで表現しているが、タテ方向に増やす働き (資本家が莫大な富をもつ) はあっても、ヨコ方向に拡げていく (みんなが裕福になる) 機能はないという。本章では所得の再分配と、再分配が適正かどうかを測るための指標として <strong>ジニ係数</strong> について説明されている。ジニ係数を使うと、所得分布から不平等の状態を客観的に把握することに優れているという。富める者から貧しい者へ所得を移転することでジニ係数が下がる。ただし、両者の貧富を逆転させないものを <strong>ピグー・ドールトン移転</strong> と呼ぶ。このピグー・ドールトン移転を実行し続けると、最終的に所得分布は全員が同じである <strong>完全平等分布</strong> になる。このときのジニ係数はゼロになる。その逆に、1人がこの世すべての所得を独り占めすると <strong>完全不平等分布</strong> となり、そのジニ係数は 1 (に近い値) となる。</p>
<figure><img src=/diary/img/2021/1119_gini-coefficient.png>
</figure>
<ul>
<li>絶対的貧困: 世界銀行は生命の維持に必要な基準として1日の所得1.25ドルと定めている、絶対的貧困の指標の1つと考えられる</li>
<li>相対的貧困: 所得分布の真ん中の50%と OECD が定めている
<ul>
<li>相対的貧困の基準に満たない人口の占める割合を <strong>相対的貧困率</strong> と呼ぶ</li>
<li><a href=https://www.mhlw.go.jp/toukei/saikin/hw/k-tyosa/k-tyosa19/dl/03.pdf>2019年 国民生活基礎調査の概況</a> によると、2019年の値は 15.7% になるらしい。6-7人に1人ぐらいの割合になる</li>
</ul>
</li>
</ul>
<h2 id=メタ認知が暴走>メタ認知が暴走</h2>
<p><a href=https://kentarokuribayashi.com/journal/2021/11/18/2021%e5%b9%b411%e6%9c%8818%e6%97%a5>あんちぽさんの日記</a> に次の動画が紹介されてた。<a href=https://note.com/t2y1979/n/n4713058f48ce>メタ認知で〈学ぶ力〉を高める：認知心理学が解き明かす効果的学習法</a> を読んでから、学びや書くことについてメタ認知というキーワードを意識して考えるようになっている。この動画ではメタ認知を「相対化」と説明していた。自己を相対化して、様々な文脈や状況、相手の意図なども考慮して結論が出せなくなったり、思考がまとまらなくなってしまうという。そういうメタ認知が暴走する人間を <em>メタモン</em> と名付けていた。ここでいう「モン」はモンスターの短縮なのかな？なかなかおもしろい。こんな極端ではないけど、私も相手の意図や状況を深読みしてしまって静観の姿勢を取るものの、なにも考えてない人だったりすると無駄に時間を浪費してしまうこともある。他にも <a href=https://ja.wikipedia.org/wiki/%E9%8A%83%E3%83%BB%E7%97%85%E5%8E%9F%E8%8F%8C%E3%83%BB%E9%89%84>銃・病原菌・鉄</a> の話題が気になって wikipedia を軽く読んだりした。</p>
<div class=video-container>
<iframe src=https://www.youtube.com/embed/sj7eer2tArs allowfullscreen title=意図せずメタ認知が暴走する悲しき怪物【ミーム提案委員会2】＃71></iframe>
</div>
<h2 id=会食>会食</h2>
<p>姪が大学に進学するそうでその面接に来たので一緒に晩ご飯することに。姉の勤め先の関係会社で <a href=https://kobe-plaisir.jp/>神戸プレジール</a> という神戸牛ステーキのややたっかい系のレストランで食べてきた。コース料理で1万円/人で飲みものやデザートなどは別途6千円ほどだった。但馬牛や神戸牛のステーキはもちろんとてもおいしかったんだけど、もう自分はこういう料理を求めてないなというのも感じた。個室で食べてたんやけど、姉の仕事の関係者が5-6人ぐらい、入れ代わり立ち代わりにやってきて、姉は直売所のパートだったのが、いつの間にか社員になって、いつの間にかナンバー2になっているらしい。おまけでフォークリフト免許まで取っている。なんやかんやも含めて、この場所を晩ご飯に選んでいるのもあるんだろうけど、職場の周りの人にしか言っていない今日の予定を、どこかで聞きつけて挨拶にくる関係者の人たち。私が学生の頃「田舎の噂は isdn より速い」と言ったものだけど、いまは「光回線よりも速い」と言うらしい。姉がいろんな関係者に挨拶しているのをみながら、もう自分はこういう仕事もたぶんできないなと実感した。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1118/>今年は忘年会やる</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-18
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/git/>git</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て3時に起きて2度寝して6時に起きた。起き上がれなくて6時半までだらだらしてから起きた。</p>
<h2 id=リポジトリの改行コード指定>リポジトリの改行コード指定</h2>
<p>git のリポジトリ設定で <a href=https://git-scm.com/docs/gitattributes>.gitattributes</a> という設定方法がある。ざっくり理解するには <a href=https://kiririmode.hatenablog.jp/entry/20170416/1492300735>.gitattributesによる改行コードの変換設定</a> を読むのが早い。とりあえずこんな設定にしてみた。すでに crlf の改行コードでコミットされたファイルがあるため、それらを lf に変換しないといけない。<code>eol=lf</code> にすると crlf でコミットされている既存ファイルも変換してくれるみたい。おそらくチェックアウトしたときにそうなるのかな？</p>
<pre tabindex=0><code>*       text=auto eol=lf
*.jar   binary
</code></pre><p>ここ数年は Windows マシンを開発に使っている開発者と一緒に働いたことがなかったけど、OS 混在環境だとリポジトリ設定が必要だということに気付いた。多様性は大事。</p>
<h2 id=忘年会>忘年会</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/231602/>三宮.dev＆bizpy 合同忘年会</a> に参加登録した。bizpy だけだと、忘年会の参加者を集めるのは厳しそうなので三ノ宮.devと共同でやる。これなら最低でも2人は確定しているのでイベントがなくなることはない。日程は参加者の希望を聞きながら水曜か金曜でやるみたい。いましか飲み会できないだろうからいいと思う。</p>
<h2 id=ミクロ経済学入門の入門>ミクロ経済学入門の入門</h2>
<p>第9章の公共財を読んだ。市場を考察するときに扱う財は一般論として <strong>私的財</strong> を想定している。私的財は次の2つの性質を満たす。</p>
<ul>
<li>競合的: 複数の人々が同時に利用できない</li>
<li>排除的: 拠出に貢献した特定のメンバーしか利用できない</li>
</ul>
<p>一方で私的財と対偶の関係にある競合的でも排除的でもない財を <strong>公共財</strong> と呼ぶ。例えば、国防サービスや一般道路などが相当する。侵攻してくる敵国から自国を防衛するときにすべての国民、納税していない人であっても国防の利益にあずかれる。非競合的だが、排除的である財を <strong>クラブ財</strong> と呼ぶ。高速道路などが相当する。みんなが利用できるが、利用料金を収めないと利用できない。競合的だが非排除的な財を <strong>コモンプール財</strong> と呼ぶ。漁場などが相当する。どの漁師が魚を獲るかは競合しているが、漁業権をもっている限り漁そのものは制限されない。</p>
<p>これをまとめると、財は次の4つの分類になる。</p>
<table>
<thead>
<tr>
<th style=text-align:center></th>
<th style=text-align:center>競合的</th>
<th style=text-align:center>非競合的</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>排除的</td>
<td style=text-align:center>私的財</td>
<td style=text-align:center>クラブ財</td>
</tr>
<tr>
<td style=text-align:center>非排除的</td>
<td style=text-align:center>コモンプール財</td>
<td style=text-align:center>公共財</td>
</tr>
</tbody>
</table>
<p>公共財の自発的供給の問いとして、排除的でも競合的でもない公共財が人々の自発的な行動で十分に供給できるかを考える。自分のお金を寄付する・寄付しないの2択でマトリクスを作成する。自分は寄付せず、他人の寄付から利益を得ることを <strong>フリーライド</strong> と呼ぶ。みんながフリーライドをしようとすると公共財はまったく供給されない。A と B の2者間における利得表を表すと次のようになる。相手が寄付して、自分が寄付しないときに最大の利益となり、どちらも寄付しないよりは両者が寄付した方が利益が大きくなる。</p>
<table>
<thead>
<tr>
<th style=text-align:center>A \ B</th>
<th style=text-align:center>寄付する</th>
<th style=text-align:center>寄付しない</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>寄付する</td>
<td style=text-align:center>4, 4</td>
<td style=text-align:center>2, 5</td>
</tr>
<tr>
<td style=text-align:center>寄付しない</td>
<td style=text-align:center>5, 2</td>
<td style=text-align:center>3, 3</td>
</tr>
</tbody>
</table>
<p>A が寄付するか・しないかの選択は、B の寄付の有無に関係なく、A は寄付しない方が寄付したよりもトクすることになる。相手がどういった選択をしても自分にとって一番トクな選択肢が同じときにその選択肢を <strong>支配戦略</strong> という。この話は B からみても同じになる。A も B も寄付しないがトクする状態のことを <strong>支配戦略均衡</strong> という。この状態が最善かと言えば、そうではなく、両者が寄付した方が両者が寄付しないよりもトクする状態になる。このように公共財の供給を個々のプレイヤーに任せていては <strong>パレート劣位</strong> な結果となってしまう。この状態からどうやって両者が寄付する <strong>パレート優位</strong> な状態に移行できるかを考えるのが、政府の徴税の方策と言える。</p>
<p>政府が誰にいくらの税を課して、どの程度の量の公共財を適切と決めるのかは難しい問題である。放っておいて上手くいかないものの、政府に任せて上手くいくことも保証されない。このようなゲーム理論を制度設計に活用する <strong>メカニズムデザイン</strong> という専門分野がある。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1117/>Testcontainers を触ってみた</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-17
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/java/>java</a>&nbsp;
</span>
<div class=post-content>
<p>23時頃に寝て3時に起きて、そこから寝たり起きたりしながら6時に半に起きた。怖い夢をみて眠れなくなって中途半端に寝てた。</p>
<h2 id=朝活-雑談>朝活: 雑談</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/231078/>【三宮.dev オンライン】リモート朝活もくもく会</a> に参加した。寝坊、、、というよりは起きてたけど、イベントを忘れていて6時45分ぐらいから参加して主催者しかいなかったのでそのまま7時半まで雑談してた。始めが悪いとだらだらしてしまう。気をつけねば。</p>
<p>三宮.dev の主催者や参加者の常連さんたちとはだいぶ身近に話すにようになってきた。コミュニティって人間関係だと思っていて、話したり顔をあわせたりする回数が増えるに従って身近な知人になっていって、それ自体が価値の1つだったりすると思う。いま忘年会の企画を三宮.dev でも行っているが、bizpy と合同でやっていいんじゃないかと考えている。</p>
<h2 id=testcontainers>Testcontainers</h2>
<p>DB を使ったユニットテストのために <a href=https://www.testcontainers.org/modules/databases/postgres/>Testcontainers Postgres Module</a> を使ってみた。docker hub からイメージを取得して JUnit のテストプロセスの中からアクセスできるようにするためのライブラリになる。コンテナの扱いをテストコードから管理したいときなどに便利。ちょっと調べて簡単に設定できたのでまた時間のあるときに会社のブログに記事を書こうと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1116/>カスタム GitHub Actions のサンプルを作ってみた</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-16
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/github/>github</a>&nbsp;
</span>
<div class=post-content>
<p>23時半に寝て5時半に起きた。昨夜は夜にウォーキングに出掛けようと思いつつ、22時頃に1時間ほど寝てしまった。それで出掛けるのが面倒になってそのまま寝てた。早く寝た分、早く起きた。せっかく早起きしたのでドラクエタクトのデイリーミッションやって、それから起きて7時ぐらいにはオフィスに着いてたと思う。</p>
<h2 id=カスタム-github-actions-作成>カスタム GitHub Actions 作成</h2>
<p>GitHub Docs の <a href=https://docs.github.com/ja/actions/creating-actions>アクションの作成</a> をみながらサンプルを作ってみた。カスタムアクションは3つの作成方法がある。</p>
<ul>
<li>docker コンテナを使ったアクション</li>
<li>javascript を使ったアクション</li>
<li>シェルスクリプトなどを使ったアクション (composite アクション)</li>
</ul>
<p>たぶんランタイムに何を使うかでアクションの作り方が異なるようにみえる。最後の composite アクションは呼び出される環境で動くことを想定しているのかな？サンプルには bash 上で動くものを紹介していた。ほとんどチュートリアルの内容そのままんだけど、動かして雰囲気を掴むために自分で composite アクションを作ってみた。単一のリポジトリに閉じたものなら通常のワークフローの設定に書けばいいけど、複数のリポジトリで同じ処理をしたい場合は composite アクションとして再利用できるようにするとよさそう。</p>
<ul>
<li><a href=https://github.com/t2y/gh-actions-sample>https://github.com/t2y/gh-actions-sample</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1115/>お仕事しかしなかった一日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-15
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;
</span>
<div class=post-content>
<p>2時に寝て6時半に起きた。寝る前にウォーキングしてくるとよく眠れる気がする。お仕事で簡単に終わると思ってた作業にちょっとはまってトラブルシューティングしてたら疲れた。原因はわかって自己解決できたのはよかったけど、消耗して早くお仕事を終えて帰ってくつろいでた。</p>
<h2 id=ローカル開発環境の整備>ローカル開発環境の整備</h2>
<p>お仕事でローカルの k8s 環境の保守の作業をしている。<a href=https://minikube.sigs.k8s.io/docs/>minikube</a> でローカルの k8s クラスターを作成して <a href=https://kubernetes.io/docs/reference/kubectl/overview/>kubectl</a> コマンドで制御する。k8s の yaml の設定ファイルのことをマニフェストと呼ぶのかな？そのテンプレート？ジェネレーター的なツールに <a href=https://kustomize.io/>kustomize</a> を使っている。先週から1週間触っていたので cli の操作にはだいぶ慣れてきた。</p>
<p>まだ基本的な delete & apply みたいなことしかやってないけど、また余裕のあるときに細かいコマンドやロールバックのやり方なども学習しようと思う。デプロイで一番重要なのはロールバック、次にローリングアップデート、ローリングアップデートができればカナリアリリースもできるかな？その2つがあれば運用は大幅にコスト削減できるし、開発のアジリティも上げられる。たぶん k8s を使えば簡単にできるんだろうなというのは delete & apply だけみてもそう受け取れる。k8s クラスターさえマネージドならよく出来た仕組みだなと感心した。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1114/>リーンキャンバスやってみた</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-14
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/writing/>writing</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/xr/>xr</a>&nbsp;
#<a href=/diary/tags/disease/>disease</a>&nbsp;
</span>
<img src=/diary/img/2021/1114_lean-canvas.png class=post-cover alt=リーンキャンバスやってみた>
<div class=post-content>
<p>2時に寝て8時に起きた。起きてからドラクエタクトのダイの大冒険コラボイベントをお昼前までやってた。午前中遊んでた割には今日はいろいろ作業した。ゆっくり寝たせいか、個々の作業は集中してできた。</p>
<h2 id=リーンキャンバス>リーンキャンバス</h2>
<p>友だちにプロダクトの設計についてレビューしてもらう機会を調整してたらリーンキャンバス作るとよいとアドバイスをもらった。全然やったことがないので試しに自分でもやってみることにした。<a href=https://monstar-lab.com/dx/solution/lean-canvas/>リーンキャンバス（Lean Canvas）を活用した企画書の書き方【テンプレート付】</a> を読みながら <a href=https://canvanizer.com/>Canvanizer</a> というツールで作成してみた。リーンキャンバスの利点の1つとしてA4サイズ1枚程度におさめるので短時間で作成できるというのがある。プロダクトの要件定義と設計はすでにできているので、リーンキャンバスは1時間も経たないうちにたたき台を作成できた。また友だちにレビューしてもらうときにフィードバックをもらいながら精度をあげていく。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>昨日から 9.4 分散トランザクションと合意の後半の3つの節を読んだ。第Ⅱ部、400ページを超えたので2/3ほど読み終えた。</p>
<ul>
<li>9.4.3 耐障害性を持つ合意</li>
<li>9.4.4 メンバーシップと協調サービス</li>
<li>まとめ</li>
</ul>
<p>合意の問題は、次のように形式化される。1つ以上のノードが値を <strong>提案（propose）</strong> し、合意アルゴリズムはそれらの値の中から1つを <strong>決定（deside）</strong> する。この形式化においては、合意アルゴリズムは次の性質を満たさなければならない。</p>
<ul>
<li>一様同意（uniform agreement） : 2 つのノードが異なる決定をしていないこと</li>
<li>整合性（integrity） : 2 回決定をしているノードがないこと</li>
<li>妥当性（validity） : ノードが値 v を決定したら、 v を提案しているノードがあること</li>
<li>終了性（termination） : クラッシュしていないすべてのノードは、最終的に何らかの値を決定すること</li>
</ul>
<p>耐障害性を持つ合意アルゴリズムで最も広く知られているのは、Viewstamped Replication（ VSR ）、Paxos、Raft、Zab であり、こういった合意のアルゴリズムは全順序ブロードキャストを実装しており、複数回にわたって合意が行われる。全順序ブロードキャストによって耐障害性を保ちながら線形化可能でアトミックな操作を実装できる。ZooKeeper のようなツールが、アプリケーションから利用できる合意、障害検出、メンバーシップの「アウトソーシング」サービスを提供する上で、重要な役割を果たしている。分散システムにおける様々な問題に耐えうるようなアルゴリズムを独自に開発するよりははるかによいといえる。合意へと落とし込めるような問題の処理が必要で、さらに耐障害性が求められるなら ZooKeeper のようなサービスを使うとよい。</p>
<h2 id=神戸駆動開発イベント>神戸駆動開発イベント</h2>
<p><a href=https://osaka-driven-dev.connpass.com/>大阪駆動開発</a> という xr (vr/ar/mr) のコミュニティがあって、いろんな地域に拡張しているようで、その支部？の1つに神戸駆動開発ができて、そのイベントとして <a href=https://kobe-driven-dev.connpass.com/event/230296/>【神戸】XR体験&交流会</a> に参加してきた。会場が <a href=https://www.kobedenshi.ac.jp/>神戸電子専門学校</a> だったのでどんなところかを見に行く意図でも出かけてきた。三宮.dev の主催者も神戸電子専門学校の中の人とつながりがあるらしく、今度オフラインの勉強会をそこでしようか検討しているといった話しもあった。bizpy もコロナが落ち着いたらオフラインの勉強会をやってもいいかなとは考えているので接点を作っておいてもいいかもしれない。神戸なんて狭い地域なのでコミュニティ関係者はすぐにつながるけど、神戸でオフラインの勉強会を開くに当たって適当な場所がないというのはあちこちで聞く話しでもあるので、神戸電子専門学校がそういったコミュニティをつなぐハブ的な場になるならそれはそれでいいのかもしれない。</p>
<p><a href=https://www.microsoft.com/en-us/hololens>HoloLens 2</a> と <a href=https://www.nreal.ai/light/>Nreal Light</a> と iphone や apple watch とレンズやミラーを組み合わせて作った手作りのデバイスなども体験させてもらった。HoloLens が思ったよりも映像がみえにくくて、ロボットを操作してロケットを発射させるコンテンツをやってみたんだけど、操作よりもコンテンツが明確にみえなくて難しかった。もしかしたら装着の仕方が悪かったのかもしれない。それに比べて Nreal Light はアイドルのライブみたいなコンテンツをみたんだけど、映像も音声もはっきりしていたので印象はよかった。</p>
<p>適当にスタッフの人と話していて、センサーを使って現実のモノや事象を vr 空間に持ち込むと vr コンテンツを作るのは簡単かも？という話しをした。なんかセンサーを探してもいいかもしれない。そのスタッフの人はピアノを弾くのでピアノ音を取り込んで加工したりしていると話していた。</p>
<h2 id=傾斜枕>傾斜枕</h2>
<blockquote>
<p>胃食道逆流症（英語表記Gastro Esophageal Reflux DiseaseからGERD（ガード）とも呼ばれています）は、主に胃の中の酸が食道へ逆流することにより、胸やけ（みぞおちの上の焼けるようなジリジリする感じ、しみる感じなど）や呑酸（酸っぱい液体が上がってくる感じ）などの不快な自覚症状を感じたり、食道の粘膜がただれたり（食道炎）する病気です。胸が詰まるような痛みを感じたり、のどの違和感や慢性的に咳が持続する患者さんもいます。胃酸の逆流は食後2～3時間までに起こることが多いため、食後にこれらの症状を感じたときは胃酸の逆流が起きている可能性を考える必要があります。</p>
<p>(&mldr;)</p>
<p>現在では成人の10～20％がこの病気にかかっていると推測されています。</p>
<p><a href=https://www.jsge.or.jp/guideline/disease/gerd.html>胃食道逆流症(GERD)</a></p>
</blockquote>
<p>ここ1-2年、睡眠がうまくとれなくなったことと関連して、寝ていて胃酸が逆流してむせるといったことも2-3ヶ月に1回ぐらいと稀ではあるけれど、起きるということに気付いた。2年ほど前、健康診断で胃カメラを受診したときに医師から胃の入り口の弁が、普通の人は逆流しないように閉じているものが私のは開いているという話があった。そのときは特に日常生活に困ってないからいいんじゃないで流してたんだけど、加齢とともに胃食道逆流症が起こっているのかもしれないと、いくつかの事象を認識して思うようになってきた。喉の違和感も気になるようになっていた。その症状の軽減に逆流しにくいように傾斜を付けて寝るとよさそうというのをみつけて、傾斜枕を買ってみた。しばらく試してみて寝心地や胃食道逆流症がどうなるかを観察してみる。</p>
<p><a href="https://www.amazon.co.jp/dp/B07VNDPD8Y?&linkCode=li2&tag=t2y-diary-22&linkId=f2a28286ce04219213b577e23c7d45c4&language=ja_JP&ref_=as_li_ss_il" target=_blank><img border=0 src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B07VNDPD8Y&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=t2y-diary-22&language=ja_JP"></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=t2y-diary-22&language=ja_JP&l=li2&o=9&a=B07VNDPD8Y" width=1 height=1 border=0 alt style=border:none!important;margin:0!important></p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1113/>寝てた</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-13
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て8時に起きた。もっと早く目覚めてはいたけど、休日なんでゆっくりするかとのんびりしてた。本を読んで眠くなってきたので夕方から帰って寝てた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今週は勉強会の発表や週の真ん中で飲みにいってバテてしまってウォーキングは4日ぐらいしかできてなかった。前の週よりはあまり運動ができていない。前週からの右足太もも後ろの筋が張りはまだ少し残っているものの、ちょっとよくなった気がする。今日の開脚幅は開始前168cmで、ストレッチ後169cmだった。前週よりは数値がよくなって、また170cmの大台にのりそうな雰囲気になってきた。</p>
<p>中殿筋 (ちゅうでんきん) という、お尻の横の筋肉があまりよくなくて、ここが悪いと腰痛の原因になるらしい。歩いたり走ったりするときにも使う筋肉だという。<a href=https://kaiseihp.jp/news/id_14953>中殿筋のストレッチとトレーニング</a> のようなストレッチはいまもやっているけど、トレーニングはやってなかったのでまたやってみようと思う。</p>
<h2 id=勉強会兼もくもく会>勉強会兼もくもく会</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/227757/>【三宮.dev オンライン】ついに出たぜNuxt3！Nuxt.js LT大会</a> に参加した。LT 発表する人が少なかったのでもくもく会になって本を読んでた。70歳の参加者の方がいて web 開発をするのに vue.js と react.js のどちらを選べばいいか？といった話題で盛り上がりつつ、その方の背景などを聞いていた。技術の話しは通じたのである程度、開発の素養もあってちゃんと勉強している人にみえた。私と同じマイクロ法人をやっているようで、自分のビジネスのアプリケーションを自分で開発するといったスタンスで取り組まれていて、70歳になってもやっている姿勢に敬意をもてた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1112/>打ち合わせでズタズタ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-12
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て5時半に起きた。体調はよいが、新しい環境で働き始めたのと勉強会が続いたのでややバテた。今日は軽めの活動で休むことにした。今日は打ち合わせが3つ入って、作業が途中でズタズタになって集中力を書いた。打ち合わせするなら固めて連続的にやらないとなかなか難しいな。今週は新しい環境での仕事もあって疲れてたので17時にお仕事を終えて、夕方にお昼寝して、夜にオンライン飲み会でだべってた。</p>
<h2 id=朝活-ミクロ経済学入門の入門>朝活: ミクロ経済学入門の入門</h2>
<p><a href="https://www.youtube.com/watch?v=ddTgbwdpRzg">[金朝ツメトギ] 2021-11-12 AM 6 金曜朝6時開催のもくもく会</a> で第8章のリスクと保険を読んだ。用語を次にまとめる。</p>
<ul>
<li>条件付き財: 将来に特定の条件が成立したときのみ特定の行為を可能とする財
<ul>
<li>例) 保険、賭けごと、宝くじ、投資など</li>
</ul>
</li>
<li>確実性等価: 不確実な対価と、それと無差別になる確実な金額における経済価値
<ul>
<li>例) 50%の確率で1万円もらえるくじを、千円払って購入するときのくじの価格を確実性等価という</li>
<li>人々のリスクへの態度を分類する上で便利な概念になる</li>
</ul>
</li>
</ul>
<p>ある人は、それぞれの金額 <em>m</em> について、満足度の指標 <em>U(m)</em> をもっているとする。このとき <em>U(m)</em> を効用、<em>U</em> を効用関数と呼ぶ。</p>
<p><em>m</em> が増えると <em>U(m)</em> 、つまり効用も高まるが、それには限界がある。増える量は <strong>限界効用逓減</strong> の形になる。次の図では <em>U(5)</em> から <em>U(10)</em> になると <em>m</em> は2倍になるが、効用は2倍にはならない。ここで <strong>期待効用理論</strong> では「人は条件付き財を、効用を発生確率で加重和した <strong>期待効用</strong> で評価する」と考える。この <strong>期待値</strong> は 0.5 * 1万円 + 0.5 * 0円 = 5千円となる。効用は 0.5 x U(10) + 0.5 * U(0) となる。</p>
<figure><img src=/diary/img/2021/1112_Um.png>
</figure>
<p>確実性等価が期待値より高いか低いかは個人によって異なり、少額でも確実にもらえるお金を好むと確実性等価が期待値より低くなる。これを <strong>リスク回避的</strong> と呼び、多くの人々がリスク回避的だからこそ保険という商品が成立する。その逆で確実性等価が期待値より高くなることを <strong>リウス愛好的</strong> と呼ぶ。また確実性等価が期待値が等しいときは <strong>リスク中立的</strong> と呼ぶ。そして確実性等価と期待値の差額を <strong>リスクプレミアム</strong> と呼ぶ。</p>
<p>保険会社がある疾病の保険を提供し、顧客が加入する。顧客は自分がその疾病にかかりやすいかどうかを知っているが保険会社からはわからない。そのため一律の価格で保険を販売する。これを <strong>情報の非対称性</strong> と呼ぶ。この状態で疾病のリスクが高い人たちが増えていくと、保険会社はさらに保険料を引き上げる。それによってリスクの低い人たちが加入しなくなり、さらにリスクの高い人たちの割合を高めてしまう。これを <strong>逆選抜</strong> と呼ぶ。逆選抜の解消方法は、個々人のリスクとは無関係に強制的に保険に加入させてしまう。これが日本の国民皆保険制度と言える。さまざまな人のリスクを社会全体でヘッジ (低減) する仕組みであり、リスクの社会化と言える。</p>
<p>民間の保険会社が遺伝子検査などにより、利潤の追求のため、ハイリスクな顧客を除外しようとすることは不当なのかどうか、保険倫理に関わる難問である。この難問の存在が公的保険制度の意義が高めている。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1111/>PMBOK セミナー</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-11
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/subcontract/>subcontract</a>&nbsp;
#<a href=/diary/tags/pmbok/>pmbok</a>&nbsp;
</span>
<div class=post-content>
<p>22時に寝て4時半に起きた。昨日は勉強会を連日でやって疲れ果ててからバテてすぐに寝た。久しぶりによく眠れた。起きてから1時間ほどドラクエタクトやって、ストレッチやって、7時半にはオフィスに行って8時からお仕事してた。</p>
<h2 id=スクラム談義>スクラム談義</h2>
<p>お仕事で本格的なスクラム開発に参加することになった。スクラムマスターのかわのさんと少しスクラムで雑談した。アジャイル、スクラム、チケット駆動、課題管理などの話題であれこれ話してた。かわのさんはスクラムやアジャイルのアーリーアダプターのようで、かなり昔からやっているから経験や実績が多そうなので私の疑問や懸念に的確に返答をくれた。実際の現場でどう応用するかは別の話題としても、スクラムはそもそも「良い結果」を出すためのものではく「現状をありのままに見る」ものらしい。うまくやろうと思ったらスクラムにプラクティスや開発方法論を組み合わせないといけないし、そのための軽量フレームワークになっているのに、スクラムだけ実践すればうまくいくと誤解している人たちもいるといった話題もあった。私がスクラムうまくいってなさそうなチームをみていて微妙だと感じたのは、自分たちの課題に向き合ったプラクティスや改善に取り組んでなくて、スクラムの方法論を守ることに注力しているようにみえたからかもしれない。</p>
<h2 id=紙の契約書に挑戦>紙の契約書に挑戦</h2>
<p>新しいお仕事の契約は紙の契約で結ぶ。実はこれまで <a href=https://www.cloudsign.jp/>クラウドサイン</a> で電子契約しかしたことなくて、紙の契約書は初めてでどきどきした。言うても印鑑を押すだけなんやけどな。でも、印鑑押すのってきれいに押したいという気持ちが出てちょっと緊張するからあまり好きではない。</p>
<h2 id=pmbok-セミナー>PMBOK セミナー</h2>
<p><a href=https://aitrainingcenter.axis-ing.com/pmbok-quick>PMBOK®ガイド第7版 Quick Review</a> に参加した。</p>
<p>参加者は60人で、すでに PMBOK ガイド第7版を購入またはダウンロードした人が十数人だったらしい。
PMBOK ガイドは4-5年ごとに更新されるものらしい。
本セミナーでは第6版と第7版の違いがどういったものかの概要を説明していた。第7版は第6版の拡張であり、実務で PMBOK ガイドが必要な人は依然として第6版も購入した方がよいと話されていた。</p>
<p>というのは、第7版は過去のガイドを更新したものではなく、PMP 試験は第6版の時点でアジャイルな要素も取り入れているため、第7版のために変更を加えるといった予定は現時点ではない。
つまり、少なくとも PMP 試験やプロジェクトマネジメントの国際規格である ISO 21500 は第6版をベースにした内容があるため、それらが急になくなったりすることはないらしい。第6版と第7版の違いとして次のような話しをされていた。</p>
<ul>
<li>プロジェクトマネジメントの節目の切り口が変わった？
<ul>
<li>第6版: プロセスベース</li>
<li>第7版: 原理原則</li>
</ul>
</li>
<li>第7版でガイドに <strong>チーム</strong> が登場するようになった
<ul>
<li>主語がチームとなり、チームが○○するための原理原則はこうであるといった内容に変わった
<ul>
<li>主役はプロセスではなくチーム</li>
</ul>
</li>
<li>プロジェクトにチームが寄り添うようになった</li>
</ul>
</li>
</ul>
<p>これらの違いは、第6版と第7版をテキストマイニングして、共起ネットワークを構築して比較してみるとよくわかると分析されていた。あとおもしろかったのが、第6版と第7版ではページ数は半減したものの、文字数は3割減程度となっており、箇条書きが多かった内容が説明ベースの文章に変わったためだろうといった話しもあった。</p>
<figure><img src=/diary/img/2021/1111_pmbok-text-mining.png>
</figure>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1110/>低空飛行</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-10
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
</span>
<div class=post-content>
<p>3時に寝て7時半に起きた。昨日2時まで呑んだくれてたので水曜日の朝活はお休み。完全に忘れてたし寝坊した。やや2日酔いでしんどかったけど、朝にはちゃんと起きれたので体調はよい。お仕事では会議体の見直しがあって、私が必要な会議に invite されてなくてバタバタしてた。</p>
<h2 id=bizpy-勉強会>bizpy 勉強会</h2>
<p><a href=https://bizpy.connpass.com/event/229091/>Python で Slack のインテグレーションをやってみる勉強会 #2</a> を開催した。10人ほど参加してくれた。資料は作ってあったし、内容も難しくないものだったので管理画面の設定とコードをみながら1時間ほどで説明して、30分ほど質疑応答や雑談をしながら8時半には勉強会を終えた。前日の睡眠不足でしんどかったので早く終えて帰りたかったのもある。あと一回 Block Kit の開発をやって slack インテグレーションの勉強会は終えようと思う。次は12月1日なので年内はそれで終わりでいいかな。いまのうちに忘年会やりたい気持ちがあるけど、神戸だと人が集まらんやろなぁ。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1109/>呑んだくれ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-09
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;
</span>
<div class=post-content>
<p>1時半に寝て6時に起きた。夜にウォーキングに出かけようとしたらたまたま雨が降ってきて諦めた。そしたら寝付けなかった。やっぱり歩いて疲弊すると寝付けやすいのかもしれない。ストレッチしたりしてたら寝るの遅くなった。</p>
<h2 id=中間申告の納付>中間申告の納付</h2>
<p>法人税・地方法人税の申告用紙が届いていたので内容を確認しながら e-tax で申請して pay-easy で税金の支払いを完了した。国税は一番最後に書類が届く。今年の書類が届いた日はこんな感じ。毎年記録しているから届く時期に準備していて慌てなくて済む。</p>
<ul>
<li>法人市民税: 10月16日</li>
<li>法人県民税: 10月20日</li>
<li>法人税・地方法人税: 11月8日</li>
</ul>
<p>国税の納付をもって中間申告をすべて終えた。中間申告は税金の先払いだからキャッシュフローが悪いと払えないみたいなことが起きる可能性がある。そうすると仮決算して支払い金額を抑えるみたいなことが必要になるんだろうな。まさに貧乏暇無し。</p>
<h2 id=github--slack-integration>GitHub + Slack Integration</h2>
<p><a href=https://github.com/integrations/slack>integrations/slack</a> の内容をみて subscribe する内容を確認した。4月頃にアップグレードしてそれまでの設定の互換性をなくして、その影響でうまく動かなかったりしてた。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>github の slack 連携のときの commits:all が commits:* に変更されたみたい。4月中旬のバージョンアップ以降に作ったリポジトリか設定だと commits:all だと連携されないみたい。<a href=https://t.co/mGVUyEbgGQ>https://t.co/mGVUyEbgGQ</a></p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1387999605959188481?ref_src=twsrc%5Etfw">April 30, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<p>その後、追いかけてなかったけど、いま README をみたら次の5つのイベントはデフォルトで有効になるみたい。</p>
<ul>
<li>issues</li>
<li>pulls</li>
<li>commits</li>
<li>releases</li>
<li>deployments</li>
</ul>
<p>必要に応じて他のイベントも追加するとよいみたい。私は次の3つかな。</p>
<ul>
<li>reviews</li>
<li>comments</li>
<li>commits:*</li>
</ul>
<p>デフォルトのイベントは指定しなくてもよいけど、コピペですべて明示的に設定するならこんな感じ。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>/github subscribe owner/repo issues,pulls,commits:*,releases,deployments,reviews,comments
</code></pre></div><h2 id=みんなの-python-勉強会>みんなの Python 勉強会</h2>
<p><a href=https://startpython.connpass.com/event/228136/>みんなのPython勉強会#75</a> で発表した。参加者は190人となっているけど、実際に zoom に参加していた人の最高値は110人ぐらいだったかな。190 * 0.6 = 114 なので無料イベントの参加者数は6割前後の法則に合致する。人数が増えるほどこの法則は精度が高いように思う。発表者は3人いて、私は2番目に発表して、持ち時間は30分だった。録画していたので後でアーカイブをみれるようにするみたい。私は録画否定派で録画すると参加者がオンタイムで見なくなるのと、いつでも見れるものは見ないということもあるので勉強会のレベルは録画しなくてもいいんじゃないかと考えている。もちろん大きなカンファレンスは録画があった方が参加できない人も後から興味のある発表を見返せていいとは思う。25分発表で質疑応答5分で発表の時間配分はうまくいった。あまり準備できなかった割には伝えたいことはだいたい話せたと思う。なんか質疑応答で「カザモリ社は python のお仕事を受けてくれますか？」といった質問があってちょっと驚いた。ここ数年 python をメインにしたお仕事してなくて、仕事は java, go が多いと言っているせいか、python の仕事はやってないようにみえてしまうのかもしれない。python, java, go の3つの言語のお仕事は受けますよと回答した。発表終わってから1時間ほど懇親会をした。ほとんどコミュニティの主催者と発表者で雑談してた。久しぶりに外部の勉強会でいろんな人とお話することができて楽しかった。たまには外に出かけていくことに重要性も認識できた。またネタがあったら発表したいなとは思う。</p>
<h2 id=呑み>呑み</h2>
<p>懇親会が終わったのが22時で、疲れと空腹から仲のよい焼き鳥屋さんのお店に寄って晩ご飯を食べることにした。時短が終わっているので22時からでも飲みに行ける。お店は翌2時まで営業している。22時過ぎに行ったらお客さんは誰もいなくて、野菜サラダと焼き鳥を注文してマスターと雑談してた。</p>
<p>時短が終わってから景気はどうかを聞いてみると、まだまだお客さんの戻りはコロナ前とくらべてまだまだだという。0時まわってから他の飲食店で働いている人たちが店内を埋まるぐらいは来てくれていたそうだけど、まだまだ余裕がないのか全然戻ってきてないと話されていた。0時半頃に2人組で「○○さんの紹介で来ました」みたいな既に酔っ払っているお客さんが来たりして、終電終わってからこういうお客さんが来たりしていたんだなと雰囲気は理解できた。マスターも2時に閉店して5時まで開いている他の飲食店に飲みに行くと話してた。そうやってお互いにお店に飲みに行って付き合いのようなものができているんだというのが理解できた。どこかのスナック行って3万円ほど使っても、必ずそのスナックの人がお店に来てくれて3万円以上使ってくれるという。お金をまわすってそういうことなんやなとマスターの話しを聞いていて理解できた。自分のお店を2時に閉店して、5時まで飲み歩いて、それから寝てまた次の日に仕事というのは体力的にすごくしんどそうで、マスター自身もコロナ明けは体調をみながら飲み歩いているとも話されてた。結局、2時前までマスターと雑談してて、私も22時から4時間弱ほど居座ってた。久しぶりに外で飲んでハイになっていたかもしれない。</p>
<p>マスターのお勧めで <a href=https://www.hamadasyuzou.co.jp/daiyame_brand>だいやめ</a> という芋焼酎をお湯割りで飲んだ。香熟芋という珍し？芋を使っていて、ライチのような香りのする芋焼酎でおいしかった。お土産によさそうなので覚えておこうと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1108/>Kubernetes 使い始めの雑感</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-08
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て7時に起きた。夜にウォーキングし始めてからよく眠れるようになった気がする。</p>
<h2 id=udemy-kubernetes入門>udemy: Kubernetes入門</h2>
<p><a href=/diary/posts/2021/1107/#udemy-kubernetes入門>昨日</a> の続き。今日はセクション6から最後まで。CI/CD のセクションだけスキップして、他は一通り目を通した。</p>
<h3 id=セクション6-kubernetes実践>セクション6 Kubernetes実践</h3>
<p>1つずつ書くのは大変だけど、数をこなして徐々に覚えていけばよい。手で書くのもよいが、別のやり方としてクライアント側で dry run すると、設定のひな型を作ってくれるのでそれに必要な設定を足すのもよい。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl create deploy mysql --image<span style=color:#f92672>=</span>mysql:5.7 --dry-run<span style=color:#f92672>=</span>client -o yaml
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl exec -n database -it mysql-787f86d65c-nflxx -- mysql -uroot -ppassword
</code></pre></div><p>データベースとアプリケーションを異なる namespace にデプロイして、それらが通信できるような設定を行う。基本的には <code>--dry-run=client</code> でひな型を作りつつ、必要な設定を追加していくやり方が簡単そうにみえた。とはいえ、実際に設定していくときはどういう設定を追加するとどういう振る舞いになるかを調べながら作業すると思うのでこんな簡単にはできないとは思う。次のようなアプリケーションをデプロイする一覧の流れを理解できた。</p>
<ol>
<li>namespace 作成</li>
<li>Deployment 作成</li>
<li>ConfigMap 作成</li>
<li>Secret 作成</li>
<li>Deployment, ConfigMap, Secret 適用</li>
<li>Service 適用</li>
<li>port-forward でローカルからアクセス</li>
<li>(作成したリソースをすべて削除)</li>
</ol>
<h3 id=セクション7-kubernetesのdebug>セクション7 KubernetesのDebug</h3>
<p>基本は pod のステータスを確認しながら問題があれば、その箇所を追いかけていって原因を調査する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get pod -A
$ kubectl get pod -A --selector run<span style=color:#f92672>=</span>nginx
</code></pre></div><p>k8s 上で実行しているアプリケーションの依存先へ接続できない場合は Service の確認が必要となる。kubectl の get, describe, logs などのサブコマンドをあれこれみながらエラーの原因を把握して、yaml の設定を変更していく。k8s のアーキテクチャとコマンドを覚えていないとなかなか難しそう。</p>
<p>とりあえず動かした後にまとめて全部削除できるのがテストやデバッグに便利そう。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl delete -f .
</code></pre></div><p>もしくは開発用に独自の namespace を作成して、あとで丸ごと namespace を削除するのでもよさそう。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl delete ns mynamespace
</code></pre></div><h2 id=k8s-の調査>k8s の調査</h2>
<p>業務のアプリケーションを minikube で作ったローカル k8s クラスターで動かしてみた。ローカルの開発環境の構築方法をメンテナンスして、自分でも一通り k8s の yaml を書いて、デプロイして、振る舞いを確認したりしていた。最初なのでおもしろい。自分で一通りやってみて、k8s が難しいとみんなが言っているのは k8s クラスターを自前で構築するのが難しいのだとようやく理解できた。k8s クラスターがすでにある状態なら kubectl の使い方を覚えるだけで全く難しくない。GKE や EKS を使って運用するなら k8s の運用コストは大したことがないと理解できた。k8s クラスター向けの yaml はたくさん書かないといけないけど、どうせ ECS や EC2 でやっていても CDK や Terraform などのインフラ設定を書くのは同じなのでそこはあまり差がない。k8s はコンテナオーケストレーションをやってくれるメリットが大きいので minikube と EKS の環境の差異があまり問題にならないようなアプリケーション開発であれば、普通に使っていって問題ないように思えた。ローカルで環境作るのが大変なんじゃないかという先入観があったけど、全然そんなことはなかった。コンテナのイメージをビルドしないといけないのが追加のコストかな。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1107/>普通の休日の翌日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-07
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;
</span>
<div class=post-content>
<p>5時に寝て10時に起きた。昨日は夕方に2-3時間寝てたのでその分、夜に調べものをしていた。休みたい気持ちもあるけど、調べるものが多過ぎて全然時間が足りない。</p>
<h2 id=bizpy-勉強会の資料作り>bizpy 勉強会の資料作り</h2>
<p><a href=/diary/posts/2021/1106/#slack-apps-の調査>昨日</a> の続き。昨日サンプルコードを実装したので、その設定や要点を <a href=https://github.com/t2y/python-study/tree/master/BizPy/slack/20211027>資料</a> に作成した。現時点で <a href=https://bizpy.connpass.com/event/229091/>Python で Slack のインテグレーションをやってみる勉強会 #2</a> の参加者は10人。連続シリーズは回を重ねるごとに減っていくものなのでこんなもんかな。あともう1回やったら終わりにする。</p>
<h2 id=udemy-kubernetes入門>udemy: Kubernetes入門</h2>
<p>友だちから udemy の k8s のコースがよいと聞いたんだけど、そのコースはいまは提供されていなくて、せっかくなので適当に検索してヒットした <a href=https://www.udemy.com/course/kubernetes-basics-2021/>Kubernetes入門</a> を受講することに決めた。本当は英語の本格的なコースを受講した方がよいのだろうけど、余裕のあるときはそれでいいけど、いま数日で概要を把握して使えるようにしたいので日本語のコースにしてみた。</p>
<ul>
<li><a href=https://blog.ayakumo.net/entry/2018/01/27/010000>Udemy の Learning Docker and Kubernetes by Lab がとてもよい</a></li>
<li><a href=https://blog.ayakumo.net/entry/2018/02/15/232918>Docker, Kubernetes 学習とツールとコンピュータサイエンス</a></li>
</ul>
<p>昨日インストールした minikube のクラスターを使って「Kubernetes入門」のセクション1からセクション5までやった。だいたい半分ぐらい。所感としては、全く何も知らない人には要点をかいつまんで教えてくれるのと、最初に覚えるとよい基本的な CLI のコマンドとその振る舞いや設定を紹介してくれるのでよかった。初めて k8s に挑戦する自分にとってはちょうどよいレベル感だった。全体像の概念を捉えてコンテキストに沿って順番にハンズオン形式で学習していくスタイル。<a href=https://github.com/nakamasato/kubernetes-basics>nakamasato/kubernetes-basics</a> を使って自分でも CLI でコマンドを打ちながら進めてみた。yaml ファイルを定義するのもこれはこれで面倒だけど、この辺は慣れの問題かな？とも思う。いくつか学んだことを整理しておく。</p>
<h3 id=セクション1-introduction>セクション1 Introduction</h3>
<p>k8s には2つのコンポーネントがあり、これを k8s クラスターと呼んでいる。</p>
<ul>
<li>Control Plane (API サーバー)</li>
<li>複数の Worker (Kubelet)</li>
</ul>
<p>yaml で設定する Desired State (理想状態) と呼ばれる設定が登録されると、Control Plane の API サーバーと Worker の kubelet が通信してそれを実現しようとする。pod とは k8s のデプロイの最小単位となる。コンテナ、ポート、レプリカ数などを設定する。pod をそれぞれの Worker にデプロイしたり、Worker がダウンしたときに別の Worker で起動させたりする。</p>
<h3 id=セクション2-kubernets-概要>セクション2 Kubernets 概要</h3>
<p>k8s はコンテナ化したアプリケーションのデプロイ、スケーリング、管理を行うためのオープンソースのコンテナオーケストレーションシステムである。</p>
<ul>
<li>コンテナ
<ul>
<li>独立した環境でアプリケーションを実行する仕組み</li>
<li>コンテナの実態はプロセス</li>
<li>Kernel Namespaces を利用し、プロセスID、ネットワークインターフェース、リソースなどを分離してコンテナ間で干渉しない</li>
<li>ホストマシンへの依存度を最小化してアプリケーションをどこでも実行可能にする
<ul>
<li>従来のやり方の最大の違いはライブラリがホストマシンにインストールされるのではなく、コンテナの内部にインストールされる</li>
</ul>
</li>
</ul>
</li>
<li>オーケストレーション
<ul>
<li>デプロイ、スケーリング、管理などの仕組み</li>
</ul>
</li>
</ul>
<p>1つのアプリケーションは複数のマシン上で動かすことで可用性を高めたいが、コンテナを動かすために考えることが増えていくと管理コストも増えていく。コンテナオーケストレーション機能により次のようなシステム管理者が行っていたことが自動化される。</p>
<ul>
<li>デプロイメント</li>
<li>スケジューリング</li>
<li>オートスケーリング
<ul>
<li>負荷に応じてコンテナ数やマシン数を増減させる</li>
</ul>
</li>
<li>ネットワーク</li>
<li>リソースマネジメント</li>
<li>セキュリティ
<ul>
<li>ネットワークポリシーやリソースの権限定義</li>
</ul>
</li>
</ul>
<p>k8s クラスターの構造は次になる。</p>
<ul>
<li>Control Plane
<ul>
<li>api: kubelet と通信するサーバー</li>
<li>etcd: 設定などを格納するキーバリューストア</li>
<li>shed: kube スケジューラー</li>
<li>c-m: コントロールマネージャー</li>
<li>c-c-m: クラウドプロバイダと api 連携する
<ul>
<li>ローカルで使うときは必要ない</li>
</ul>
</li>
</ul>
</li>
<li>Worker ノードはコンテナランタイムをいインストールしておく必要がある
<ul>
<li>kubelet は Control Plane と通信するためのエージェントとして動作する</li>
</ul>
</li>
</ul>
<p>一番需要なこととして、k8s は理想状態と現実状態を比較して、理想状態に近づけようとする。app.yaml の理想状態を kubectl を用いて api サーバーを介して etcd に格納する。現実状態は kubelet から api サーバーを介して etcd に格納される。c-m は理想状態と現実状態のチェックを行い、異なっていれば理想状態に近づけることをしていく。</p>
<h3 id=セクション4-kubectl>セクション4 kubectl</h3>
<p>minikube で最初に起動しているのは Control Plane を起動していることが理解できた。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ minikube start
$ kubectl config current-context
minikube
</code></pre></div><p>同時に ~/.kube/config に kubectl の設定も追加される。<code>minikube</code> という名前でクラスター、ユーザー、コンテキストが設定される。</p>
<p>リソース一覧の確認。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl api-resources
</code></pre></div><p>出力フォーマットも様々。例えば、デフォルトの表示は次になる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get node
NAME       STATUS   ROLES                  AGE     VERSION
minikube   Ready    control-plane,master   7m21s   v1.22.2

$ kubectl get node -o wide
NAME       STATUS   ROLES                  AGE     VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME
minikube   Ready    control-plane,master   8m38s   v1.22.2   192.168.49.2   &lt;none&gt;        Ubuntu 20.04.2 LTS   5.11.0-38-generic   docker://20.10.8
</code></pre></div><p>より詳細な情報をそれぞれのフォーマットで表示する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get node -o json
$ kubectl get node -o yaml
</code></pre></div><p>namespace を確認する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get namespace
NAME              STATUS   AGE
default           Active   10m
kube-node-lease   Active   10m
kube-public       Active   10m
kube-system       Active   10m
</code></pre></div><p>namespace を指定して pod 一覧を取得する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get pod --namespace kube-system
NAME                               READY   STATUS    RESTARTS      AGE
coredns-78fcd69978-qxqbn           1/1     Running   <span style=color:#ae81ff>0</span>             11m
etcd-minikube                      1/1     Running   <span style=color:#ae81ff>0</span>             11m
kube-apiserver-minikube            1/1     Running   <span style=color:#ae81ff>0</span>             11m
kube-controller-manager-minikube   1/1     Running   <span style=color:#ae81ff>0</span>             11m
kube-proxy-g55hg                   1/1     Running   <span style=color:#ae81ff>0</span>             11m
kube-scheduler-minikube            1/1     Running   <span style=color:#ae81ff>0</span>             11m
storage-provisioner                1/1     Running   <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>10m ago<span style=color:#f92672>)</span>   11m
</code></pre></div><p>グローバルな CLI のオプションを確認する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl options
</code></pre></div><p>ノードの詳細を表示する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl describe node
</code></pre></div><p>describe は名前の接頭辞を指定できるので namespace ならこんな感じに実行できる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl describe namespace kube-
</code></pre></div><h3 id=セクション5-kubernetes-リソース>セクション5 Kubernetes リソース</h3>
<p>pod とは k8s 上のデプロイの最小単位である。</p>
<ul>
<li>1つまたは複数のコンテナをもつ</li>
<li>ネットワークやストレージを共有リソースとしてもつ</li>
<li>コンテナの実行方法に関する仕様をもつ</li>
</ul>
<p>pod が使えなくなった場合に他のノードにデプロイされることもある。1つのアプリケーションを複数の pod でデプロイすることが多い。なるべく複数のアプリケーションを1つの pod に入れない。個別の pod を直接操作しない。</p>
<p>共有コンテキスト</p>
<ul>
<li>同一 pod 内のコンテナは同じストレージにアクセスできる</li>
<li>同一 pod 内のコンテナは ip アドレスとポートを含むネットワーク名前空間を共有する</li>
</ul>
<p>k8s オブジェクト</p>
<ul>
<li>クラスタの状態を表現する</li>
<li>2つのフィールドをもつ
<ul>
<li>spec: 理想状態 (desired status)</li>
<li>status: 現実状態 (current status)</li>
</ul>
</li>
</ul>
<p>pod の作成は k8s オブジェクトを作成している。オブジェクト作成時の必須フィールドが4つある。</p>
<ul>
<li>apiVersion</li>
<li>kind</li>
<li>metadata</li>
<li>spec</li>
</ul>
<p>namespace は同一クラスター上で複数の仮想クラスターの動作をサポートする。</p>
<ul>
<li>仮想クラスターとは、物理的には同じマシンで動いているかもしれないが、仮想的に環境を分離している
<ul>
<li>1つのクラスターを論理的にわける</li>
<li>チームや部署ごとにわけて使い分けたりすることも多い</li>
</ul>
</li>
</ul>
<p>namespace を使うメリットは次になる。</p>
<ul>
<li>pod やコンテナのリソースの範囲設定</li>
<li>namespace 全体の総リソース制限</li>
<li>権限管理</li>
</ul>
<p>初期の namespace として4つあるが、初心者は最初の2つだけをまず覚えておく。</p>
<ul>
<li>default:</li>
<li>kube-system:</li>
<li>kube-public:</li>
<li>kube-node-lease</li>
</ul>
<p>namespace と cluster の違い。</p>
<ul>
<li>Namespace-scoped リソース
<ul>
<li>namespace に属しているリソース</li>
</ul>
</li>
<li>Cluster-scoped リソース
<ul>
<li>クラスター全体で使われるもの</li>
</ul>
</li>
</ul>
<p>次のコマンドで確認できる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl api-resources --namespaced<span style=color:#f92672>=</span>true 
</code></pre></div><p>namespace の作成</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl create namespace my-namespace
</code></pre></div><p>ワークロードリソースとは複数の pod を作成・管理するためのリソース。ワークロードリソースは pod テンプレートを使って pod を作成する。</p>
<ul>
<li>ReplicaSet
<ul>
<li>常に指定したレプリカ数の pod を保つ</li>
</ul>
</li>
<li>Deployment
<ul>
<li>ローリングアップデートやロールバックなどのアップデート機能を提供</li>
<li>ReplicaSet のロールアウト</li>
<li>不安定な場合の前のバージョンへロールバック</li>
<li>使用頻度が高い
<ul>
<li>ほとんどのアプリケーションは Deployment で管理</li>
</ul>
</li>
</ul>
</li>
<li>Secret
<ul>
<li>機密情報を保存・管理し、Pod から参照可能</li>
<li>主な使用方法としてコンテナの環境変数の設定
<ul>
<li>アプリケーションの DB のパスワードなどに使う</li>
</ul>
</li>
</ul>
</li>
<li>Service
<ul>
<li>pod の集合を抽象化して公開する
<ul>
<li>pod の集合に対する DNS 名</li>
<li>pod の集合に対する負荷分散</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1106/>普通の休日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-06
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/saying/>saying</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時半に起きたが、休日だからゆっくりするかと思って二度寝して8時に起きた。知人のタイムラインで紹介されていていい言葉だなと思ったので書いておく。日記があるとこういう流れていくちょっとしたことを書く場所にもなるな。コミュニティ活動の本質はこれなんじゃないかという気もする。</p>
<blockquote>
<p>自分にまったく利益をもたらさない人間を、どう扱うかでその人がどんな人間かがはっきりわかる</p>
<p><a href=https://ja.wikipedia.org/wiki/%E3%82%B5%E3%83%9F%E3%83%A5%E3%82%A8%E3%83%AB%E3%83%BB%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%BD%E3%83%B3>サミュエル・ジョンソン</a></p>
</blockquote>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今週もジョギングの代わりにウォーキングをしてた。ジョギングやると筋肉痛や疲労から他の日を休みがちになるけど、ウォーキングならジョギングよりは継続しやすい。今週は4-5日ほど歩いた。ただストレッチはさぼってて2日しかできなかった。ウォーキングのせいかわからないけど、右足太もも後ろの筋が張るようになった。ストレッチを始めてから日々の運動や生活の変化と関節や筋肉の張りが変化するのも意識するようにもなってきた。今日の開脚幅は開始前167.5cmで、ストレッチ後168cmだった。前週よりは数値がよくなっているのでこんなもんかもしれない。</p>
<h2 id=神戸のコワーキングスペースの半歩先の未来を考える>神戸のコワーキングスペースの半歩先の未来を考える</h2>
<p>たまたまタイムラインでみかけたので <a href=https://2021.078kobe.jp/events/16089/>神戸のコワーキングスペースの半歩先の未来を考える</a> を視聴していた。私はシェアオフィスとコワーキングスペースが併設された場所で働いているのでテーマには関心がある。途中からだけど、13時半から15時までみていた。</p>
<p>第一部はコワーキングスペースの運営者が登壇して、どちらかというそれぞれの運営者がやっていることの、宣伝的な要素が強かったように思う。ある運営者が起業家を育てるのは大学生からでは遅くて、保育園から起業家教育をしているという話題があった。そこで何を教えているかというと、子どもの頃から徹底的に自己肯定感を高めるための教育をしているらしい。たまたま <a href=https://studyhacker.net/self-esteem-high>自己肯定感が高い人の4大特徴が明らかに！</a> の記事をみたら、自己肯定感が高い人は他人も肯定するという内容がある。たしかに日本/日本人の同調圧力は異質なものを拒む傾向があると考えると、自己肯定感の高低がそういった文化の背景にも現れているのかもしれないと思えた。</p>
<p>第二部はコワーキングスペースの利用者として、二地域居住シェアハウスプロジェクトの研究/実践をしている佐藤さんと、メディアアートをされている <a href=https://www.nobumichiasai.com/>浅井宣通</a> さんが登壇していた。佐藤さんが冒頭でコワーキングスペースにはびっくりするほどすごい人がいるみたいな話しをした後で、浅井さんが登場するといった流れが偶然できてて、ほんとだ、これはすごいとなったw 浅井さんはメディアアートを言葉で説明しても伝わりにくいので動画でみてもらうようにしていると話されていた。私もみてこれはすごい人だとすぐに理解できた。私が興味をもつ作品だと <a href=http://www.sign.site/koukaku_vr/>攻殻機動隊 新劇場版Virtual Reality Diver</a> の Creative Director も務められたらしい。企業やイベントの PR のための映像で浅井さんが手伝っている作品はいくつもあるそうだ。</p>
<p>浅井さんは東京を脱出したいという想いがずっとあって、コロナでリモートワークが普通になり、奥さんの実家の須磨に引っ越してきたらしい。ただ自身は神戸にはほとんど知り合いがいない状態でコワーキングスペースを利用しているうちに、人を紹介してもらって人脈を形成することができたという。東京は大半が地方から出てきた人たちの集まりなので必然として孤立しており、競争関係になってしまうという。神戸の人たちは地元で育ってそのつながりが強いという違いを感じているらしい。地元の人なので協力の関係を築きやすい。コワーキングスペースがその触媒になっていると話されていた。人がつながるには、場所や触媒が必要でコミュニティマネージャーもそういった役割を担っていて大事だという。</p>
<p>多様性は大事だが、多様性だけでも人のつながりができない。同じ分野だとライバル関係になってしまったりする。そこで対話の深さが重要だと話されていた。同じ分野であってもお互いが対話を通して理解を深めると、共通項があったり、細かい得意分野が違ったりもする。デザイナー同士がかぶってしまうと、よく競争の関係になってしまうし、全然違う人と話しても話が噛みあわなくて仕事で苦労することもあったという話があった。それで対話の深さが大事ということに気付いたといった話だった。もう1点、おもしろかった話が地元の人は土地への感情として、この場所・土地が好きだという共通項があるので協力の関係を築きやすいのではないかと。東京は多くの人が生まれ育った土地ではないのでそういった感情は抱きにくいが、神戸っ子という言葉があるように神戸の人たちにはそういった土地に根ざした愛着があり、それを媒介につながるのも美しいといったことを話されていた。</p>
<p>第三部はコワーキングスペースを支える人たちとして、<a href=http://cahootz.jp/>カフーツ</a> の伊藤さん、<a href=https://jocr.jp/sunday/repo/1656/>ANCHOR KOBE の立ち上げ</a> に関わった神戸市のイノベーション専門官の松山さん、<a href=https://fixu.jp/>fixU</a> というサービスを提供している山岡さんが登壇していた。</p>
<p>私がもっとも興味深かったのは伊藤さんの話しだったのでそれをまとめておく。コワーキングスペースはただ作業する場所ではなく、課題を解決したい人がいて、それを手伝いたいという人がつながることで価値が生まれるという。長い間、コワーキングスペースに関わってきたことから経験が積み重なってわかってきたことがあると話されていた。「コミュニティはどうやって作るんですか？」という質問に答えるのは難しいものの、その取っ掛かりとして、まず課題をみえる化するのが大事だという話しをされていた。イベントなどで課題を表明して、多くの人たちに知ってもらうことで、その課題の解決に興味をもつ人たちが集まってきて、それが協調となり、コミュニティへとつながっていくという。Facebook 社が Meta 社に社名変更して、Microsoft もそれに追従し、メタバースの話題が盛り上がっている。ビッグワードに流されるつもりはないが、コロナによりオンラインでできることの幅が広いことを、仕事はオンラインでよいと多くの人たちは気付いた。じゃあ人と人との関わりがどんな価値をもつのか、コロナが落ち着いてくる時期 (この先1-2年) でそういう方法論も新たに出てくるんじゃないかとも話されていた。</p>
<h2 id=slack-apps-の調査>Slack apps の調査</h2>
<p>次回の bizpy 勉強会向けに <a href=https://api.slack.com/lang/ja-jp/app-home-with-modal>新機能、アプリのホーム・ヴューを活用しよう🏡</a> を読んで実際に <a href=https://github.com/slackapi/bolt-python>bolt-python</a> やってみた。UI の設定は JSON で記述できるようになっていて、<a href=https://app.slack.com/block-kit-builder/>Block Kit Builder</a> でぽちぽちやるとどんな JSON を書けばよいかのサンプルのペイロードを確認できる。これらの UI に対して操作すると、プログラミングの用語で言えば、すべてイベントが発生してリクエストが届くような仕組みになっている。bolt のコード上ではそれぞれ <code>event</code> と <code>action</code> と <code>view</code> という名前が付いたイベントを扱うことで任意のモーダル画面を表示したり、そのフォームのユーザー入力を取得したりできる。一通りサンプルコードはできた。あとは簡単に資料をまとめるだけ。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1105/>調べものだらけ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-05
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/rabbitmq/>rabbitmq</a>&nbsp;
#<a href=/diary/tags/dapr/>dapr</a>&nbsp;
</span>
<div class=post-content>
<p>1時半に寝て6時に起きた。昨日の夜はウォーキングして (朝活あるから) すぐに寝たんで早く起きた分、朝からストレッチをしてた。今週はバタバタしていてあまりストレッチできてない。</p>
<h2 id=朝活-ミクロ経済学入門の入門>朝活: ミクロ経済学入門の入門</h2>
<p><a href="https://www.youtube.com/watch?v=33vXvmnAHq0">[金朝ツメトギ] 2021-11-05 AM 6 金曜朝6時開催のもくもく会</a> で第7章の独占と寡占を読んだ。用語を次にまとめる。</p>
<ul>
<li>プライステイカー: 生産量を増やしたり減らしたりしても価格に影響を与えられない会社</li>
<li>完全市場: すべての会社がプライステイカーである市場</li>
<li>不完全市場: 完全市場ではない市場、プライステイカーではない会社がいる</li>
<li>独占市場: 1つの独占企業だけが存在する市場</li>
<li>クルーノー寡占市場: 同じ財を生産する少数の会社の総生産量から市場の価格が決まる市場
<ul>
<li>寡占: 少数の企業がいる市場
<ul>
<li>複占: 企業が2つだけの市場</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>前に出てきた市場均衡の話から、供給量を下げると価格が上昇する。生産者余剰がが大きくなり、生産者は得をする。実際にあった事例として、2016年に石油輸出機構 (OPEC) が石油の減産に合意して価格が上昇した。2012年に豊作だった歳に値崩れが起きるのをおそれて、全国農業組合連合会は価格を上げるために農家に野菜の廃棄処分を要請した。</p>
<p>独占市場にいる会社は高い価格で高い利潤を得ることはできるが、やがて価格競争を仕掛けてくる新規参入者を招き、長期的な利益を低めてしまう懸念がある。一方で高品質な財を低い利潤で販売していると、新規参入者が現れずに長期的な利益を得られる可能性がある。一概にどちらが正しいとは言えない。こうした状況を端的に描く <strong>展開型ゲーム</strong> を考えると、財を高値にするか安値にするかの思考実験ができるう。 <strong>ゲームツリー</strong> という図でこのゲームを表している。</p>
<figure><img src=/diary/img/2021/1105_game-tree.png>
</figure>
<p>A は安値を選び、B が参入しないという選択の組み合わせは、「自分がこう選択したら相手はこう選択してくる」とプレイヤーが予想して、そのうえで自分にとって最も利潤が高まる選択をする状況を表している。これを <strong>サブゲーム完全均衡</strong> の結果と呼ぶ。また、このような推論のやり方を <strong>逆向き帰納法 (バックワード・インダクション)</strong> と呼ぶ。サブゲーム完全均衡の結果は逆向き帰納法により求められる。</p>
<h2 id=rabbitmq-の-dead-letter-exchange-の調査>RabbitMQ の dead letter exchange の調査</h2>
<p>昨日の続き。RabbitMQ には exchange という概念がある。私が過去に使ったメッセージキュー (Kafka, AWS SQS) にはない概念でトピックをグルーピングしたり、メッセージのルーティングを制御する仕組みになる。普通のメッセージキューではデッドレターキューと呼ばれるものが RabbitMQ だと <a href=https://www.rabbitmq.com/dlx.html>Dead Letter Exchanges</a> になる。ドキュメントの概要はこんな感じ。</p>
<blockquote>
<p>次のイベントが発生したときに &ldquo;デッドレター&rdquo; とみなす。</p>
<ul>
<li>consumer が basic.reject または requeue=false の basic.nack を ack で返したとき</li>
<li>メッセージの TTL の期限切れになったとき</li>
<li>queue の最大長さを超えてメッセージが drop されたとき</li>
</ul>
<p>注意事項として queue の有効期限が切れても queue 内のメッセージはデッドレターとならない。</p>
<h4 id=設定方法>設定方法</h4>
<p>デッドレター exchange (DLXs) は普通の exchange であり、普通に宣言して通常の種別をセットする。任意の queue に対して2通りの設定方法がある。</p>
<ul>
<li>クライアント: queue の引数を使って定義する</li>
<li>サーバー: ポリシーを使って定義する</li>
</ul>
<p>詳細は割愛。</p>
<h4 id=ルーティング>ルーティング</h4>
<p>デッドレターメッセージのルーティングは、次のどちらかで行われる。</p>
<ul>
<li>デッドレターの queue に routingKey が設定されていればそれを使う</li>
<li>デッドレターの queue に routingKey が設定されていなければ、オリジナルのメッセージが publish されたときの routingKey を使う</li>
</ul>
<p>例えば、foo という routingKey をもつ exchange にメッセージを publish して、そのメッセージがデッドレターになった場合、foo という routingKey をもつデッドレターの exchange に publish される。もしそのメッセージが x-dead-letter-routing-key を bar にセットした queue に届いた場合は、そのメッセージは bar という routingKey をもつデッドレター exchange に publish される。</p>
<p>queue に特定の routingKey が設定されていなかった場合、その queue のメッセージは、すべてオリジナルの routingKey でデッドレター化されることに注意してください。これには CC および BCC ヘッダによって追加された routingKey も含む (詳細は割愛) 。</p>
<p>デッドレターメッセージが循環する可能性がある。例えば、queue がデッドレター用のルーティングキーを指定せずに、デフォルトの exchange にメッセージをデッドレターした場合などに起こる。このとき同じ queue に2回届いたメッセージは no rejections in the entire cycle だった場合にドロップされる。</p>
<h4 id=安全性>安全性</h4>
<p>デッドレターメッセージは内部的に publisher confirm を行わずに re-publish される。クラスタ環境の rabbitmq でデッドレターキューを使ったとしても安全性は保証されない。メッセージはデッドレターキューの対象の queue に publish された後でオリジナルの queue からは削除される。このときに対象の queue が受け取れなければメッセージがなくなってしまう可能性がある。</p>
<h4 id=デッドレターメッセージの副作用>デッドレターメッセージの副作用</h4>
<p>デッドレターメッセージはヘッダーを変更する。</p>
<ul>
<li>exchange の名前がデッドレター exchange の名前に置き換わる</li>
<li>routingKey がデッドレターキューの routingKey に置き換わる可能性がある</li>
<li>↑ が起きると、CC ヘッダーが削除される</li>
<li>Sender-selected Distribution ごとに BCC ヘッダーは削除される</li>
</ul>
<p>デッドレターの処理では x-death という名前の配列を、それぞれのデッドレタリングされたメッセージのヘッダに追加する。この配列には {queue, reason} のペアで識別される各デッドレタリングイベントのエントリが含まれる。詳細は割愛。</p>
</blockquote>
<h2 id=dapr-の調査>dapr の調査</h2>
<p><a href=https://docs.dapr.io/>dapr</a> について調べた。dapr は分散システム (アプリケーション) の複雑さを解決することを目的としている。様々なミドルウェア (分散システム) とのやり取りを http/grpc の api 呼び出し経由にして、その詳細を隠蔽する。ミドルウェアの上位に抽象化レイヤーを設けて統合的なインターフェースを提供したり、それぞれのミドルウェアにおける設定や運用の面倒なことなどを簡略化してくれる。サイドカーパターンを採用しているので言語に依らず、アプリケーションに dapr のコードを書く必要もない。dapr cli をインストールして dapr init すると docker で dapr プロセスが動いて、それだけで dapr にリクエストできるようになる。使い始めの学習コストは低いし、デプロイも簡単だし、意図している目的もわかりやすい。マイクロソフト社がスポンサーしていてプロジェクトの運営も安定してそうだし、おもしろいツールだと思う。</p>
<h2 id=k8s-の調査>k8s の調査</h2>
<p>せっかくの機会なのでちゃんと勉強することにした。今日は <a href=https://github.com/kubernetes/minikube>minikube</a> の <a href=https://minikube.sigs.k8s.io/docs/start/>Get Started!</a> やっただけ。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1104/>新しい職場で働き始め</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-04
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/subcontract/>subcontract</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時半に起きた。朝活の日以外に6時に起きるのは難しいけど、だいたい6-7時の間には起きているような気がする。とはいえ、休日は8時に起きたりもしてたけど。<a href=/diary/posts/2021/1025/>10月25日</a> から生活リズムの移行を促してちょっとずつ近づいている気はする。</p>
<h2 id=働き始め>働き始め</h2>
<p>今日から新しい職場で働き始め。3ヶ月ほど自社のお仕事をしていたが、ずっとやっていると会社が倒産するので出稼ぎに行くことに決めた。まずは開発の定例会議に出てみた。最初なんで話していることがなんもわからん。3ヶ月ぐらいは業務のキャッチアップに集中する。intellij idea のコードフォーマッターで開発しているそうなので intellij idea を使うことにした。eclipse をやめて vscode に移行したいとは思っていたが、コードフォーマッターの問題は厄介なので仕方ない。コミュニティエディションを使う。</p>
<p><a href=https://www.rabbitmq.com/tutorials/tutorial-one-java.html>RabbitMQ のチュートリアル</a> を1から5までやった。チュートリアルのサンプルコードはそのままだけど maven でビルドできるようにして <a href=https://github.com/t2y/rabbitmq-sample>https://github.com/t2y/rabbitmq-sample</a> に置いた。今日のところはチュートリアルに書いてあることの振る舞いなどを確認していた。なんか調査や検証するときにまた使うと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1103/>ASUS ROG Zephyrus G15 GA503QR</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-03
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;
</span>
<img src=/diary/img/2021/1103_rog-zephyrus-g15.jpg class=post-cover alt="ASUS ROG Zephyrus G15 GA503QR">
<div class=post-content>
<p>1時に寝て6時に起きた。朝活があると起きれるな。</p>
<h2 id=朝活-ミクロ経済学入門の入門>朝活: ミクロ経済学入門の入門</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/229642/>【三宮.dev オンライン】リモート朝活もくもく会</a> で第5章の市場均衡と第6章の外部性を読んだ。</p>
<p>まず第5章から。用語を次にまとめる。</p>
<ul>
<li>完全市場: 誰もがプライステイカー (自分の生産量が価格に影響を与えられない) である市場</li>
<li>社会的余剰: 消費者余剰 (価格より多めに払ってよいと考える金額の和) と生産者余剰 (利潤の和) を足し合わせたもの</li>
<li>従量税: 販売する量に応じて一定の金額を納める税
<ul>
<li>例) たばこ税、酒税、揮発油税 (ガソリン)</li>
</ul>
</li>
</ul>
<p>これまでの章で学んだ内容から価格は需要曲線Dと供給曲線Sが交差する点p*になる。この価格を <strong>市場均衡価格</strong> と呼ぶ。市場全体のよさを測るモノサシとして <strong>社会的余剰</strong> を使う。市場均衡価格に対して価格を上げたり下げたりしたときにできる社会的余剰の差額を <strong>死荷重</strong> と呼ぶ。次の図の C の面積に相当する。</p>
<figure><img src=/diary/img/2021/1103_market-equilibrium.png>
</figure>
<p>図から市場均衡価格は社会的余剰を最大化させた価格だとわかる。</p>
<p>生産者や消費者に従量税を課すと市場にどのようなことが起きるかを考察する。納税方法として、生産者が納税する方式 (価格に税を含める) と消費者が納税する方式 (価格と税は別) があるが、どちらも社会的余剰が C の分だけ減少するグラフとなり、社会的損失が発生していると言える。余剰の視点からはどちらの方式も全く同じだが、政府が徴税するしやすさの視点だと、相対的に数の少ない生産者から納税する方が管理しやすい。</p>
<figure><img src=/diary/img/2021/1103_specific-duty.png>
</figure>
<p>狙い撃ち課税のダメな点として酒税を例にあげている。ビールの酒税を逃れるために、メーカーは1990年代に発泡酒、2003年に第3のビールを開発した。2016年時点での350ml (1缶) あたりの酒税は、ビール77円、発泡酒47円、第3のビール28円となった。同年、政府はすべて55円へ統一していく方針を発表した。ビールへの従量税が与えた社会的損失として死荷重だけでなく、発泡酒や第3のビールのような劣化ビールの技術開発のコストがあげられる。特定の品目を狙い撃つ従量税は社会的損失を生みやすいと述べられてる。</p>
<p>次に第6章から。用語を次にまとめる。</p>
<ul>
<li>負の外部性: ある生産活動が他者へマイナスの影響を与える
<ul>
<li>例) 公害や花粉症など</li>
</ul>
</li>
<li>正の外部生: ある生産活動が市場取引を経ずにプラスの影響を与える
<ul>
<li>例) 電鉄会社が駅や路線を開通させるとその地域に経済効果をもたらすなど</li>
</ul>
</li>
<li>限界被害: 企業の生産活動が住民に与える被害の生産量に対する総和の金額</li>
<li>ピグー税: 住民に補償を与える環境税</li>
<li>ネットワーク外部性: SNS など、サービスの価値がユーザー数に大きく既存する性質</li>
<li>調整ゲーム: 何を選ぶかよりも、他人と同じものを選ぶことが重要な状況</li>
<li>ナッシュ均衡: 自分の行動を変えると損になるので誰も行動を変えない状況</li>
</ul>
<p>企業の生産活動が住民に被害をもたらせていた場合、その被害をピグー税を通じて企業が支払う。これを <strong>外部性の内部化</strong> と呼ぶ。負の外部性は社会問題となるが、対して正の外部性は社会問題とならない。</p>
<p>調整ゲームにおいて、一方がもう一方よりも好ましい状態を <strong>パレート優位</strong>、またその逆の状態を <strong>パレート劣位</strong> と呼ぶ。ネットワーク外部性においては優勝劣敗が必ずしも正しいとは限らない。先行者としてユーザー数を獲得し、ナッシュ均衡の座をつかむことが勝ちにつながる。</p>
<h2 id=asus-rog-zephyrus-g15-ga503qr>ASUS ROG Zephyrus G15 GA503QR</h2>
<p>今日届いたのでセットアップだけ終えた。Windows アップデートすると次々に更新が出てくる仕組みは昔と変わってなかった。4回再起動した。</p>
<p>前々から Windows マシンがほしいと思っていて、次のお仕事が決まったので思い切って購入することにした。買おうかどうしようかを迷っている心の中の動きのコストというか、検討事項としてずっと残り続けるのもあまり生産的ではないなと最近は思うようになっていた。私が Widnows マシンが必要になった背景はこれら。</p>
<ul>
<li>行政の電子申請・手続きはまだまだ Windows アプリが主流</li>
</ul>
<p>最近は Windows アプリ版とは別に、Web 版というブラウザベースのアプリケーションが提供されつつあるが、まだまだ黎明期で一部の機能しか対応してなかったり、不具合で macos だと動きませんと障害情報が出てたり、ひどい場合だとブラウザベースなのに Linux はサポートしてませんとか言われたりする。毎年この申請は Web 版で対応したやろか？と調べて、やっぱりまだできんかったと紙ベースの申請に切り替えるときの、調べるコスト (とがっかりするコスト) がしんどくなった。</p>
<ul>
<li>VR 系アプリケーションのプラットフォームは Windows</li>
</ul>
<p>Facebook 社が Meta 社になって、ややメタバースが盛り上がりをみせつつある。<a href=https://www.oculus.com/quest-2/>Oculus Quest 2</a> を買ったものの、VR 系アプリケーションは Windows がメインターゲットらしく macos や linux は、現時点ではサポートしていないことが多い。<a href=https://www.oculus.com/accessories/oculus-link/>Oclus Link</a> も Windows しかサポートしていない。せっかくヘッドマウントディスプレイを購入したので、そのデバイスをもっと活用するためにも Windows マシンがあった方がよいと考えた。</p>
<ul>
<li>Microsoft Teams を使いたい</li>
</ul>
<p>私の周りでも <a href=https://www.microsoft.com/ja-jp/microsoft-teams/group-chat-software>Microsoft Teams</a> を使うことが増えてきた。ゲストアカウントでも会議できるのでエージェントと打ち合わせするときは Teams を使ったりしていた。社内システムを MS 系のプロダクトで固めている企業は普通に Teams を使っているし、顧問さんから聞く話しでも Teams (と MS 製品とのインテグレーション) の評判はよい。チャットツールを対象としたプロダクトを作っていくにあたり、今後は Slack だけではなく Teams 対応も必須になっていく気がする。実際に私も Slack/Teams 両対応のプロダクトもみかけるようになりつつある。Microsoft Teams を Linux で使えるかどうかは調べてないのでわからないけど、Windows マシンが1台あった方が手っ取り早いと考えた。</p>
<ul>
<li>オフィスと自宅にパソコンを据え置きたい</li>
</ul>
<p>オフィスでは普段デスクトップマシンを使いつつ、macbook をサブマシンとして使っている。自宅で作業するときは macbook を持ち帰ったりしていた。人間はどんどん怠惰になるのでこの持ち運びが面倒になってきたり、持ち帰ってないときにパソコンで作業したくなったりしたときは、オフィスに出かけるといったことをするようになってストレスにもなってた。徒歩でも15分あれば行ける場所にオフィスがあるので、タブレットやスマホでの作業効率を考えたらオフィスに行ってしまう。ラップトップを自宅とオフィスに置いておけるといいなぁとは薄々思っていた。これを機にオフィスには asus マシンを、自宅には macbook を据え置くようにしたい。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>9.4 分散トランザクションと合意の前半の2つの節を読んだ。</p>
<ul>
<li>9.4.1 アトミックなコミットと2相コミット（2PC）</li>
<li>9.4.2 分散トランザクションの実際</li>
</ul>
<p>分散トランザクションという扱っているテーマが難しいけど、書いてある内容は1つずつ追っていけば理解できるのでそこまで難しくはない。一言で分散トランザクションと言っても次の2つに大別される。</p>
<ul>
<li>データベース内部の分散トランザクション</li>
<li>ヘテロジニアスな分散トランザクション</li>
</ul>
<p>前者は特定のデータベースシステムだけで動くので相対的に最適化ができたり、うまく運用できるケースもある。後者は複数のシステムを介した汎用の仕組みになるので2相コミットのような プロトコル を使って <strong>アトミックなコミット</strong> を保証しなければならない。2PC はコーディネータの障害が運用上の大きな問題となることがわかっている。ヘテロジニアスな技術間での2相コミットの標準を <strong>X/Open XA（eXtended Architecture の省略）</strong> と呼ぶ。多くの RDB やメッセージブローカーでもサポートされているらしい。Java EE アプリケーションの世界だと Java Transaction API （ JTA ）で実装されているらしい。全く聞いたことがなくて、私はいままでこの技術に関わることがなかった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1102/>ワイヤレス REALFORCE</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-02
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;
#<a href=/diary/tags/subcontract/>subcontract</a>&nbsp;
</span>
<img src=/diary/img/2021/1102_realforce.jpg class=post-cover alt="ワイヤレス REALFORCE">
<div class=post-content>
<p>3時に寝て7時に起きた。ウォーキングから帰ってきて0時にベッドに入ったものの、選挙結果の総括記事を読んだり、<a href=http://yorimoi.com/story/>宇宙よりも遠い場所</a> をみたりしていたら3時になってしまった。全13話すべてみた。どちらかと言えばおもしろかったけど、ツィートみて期待値が高かった分、そこまで私の中に響くものはなかったかな。南極へ行く道中や南極の生活がわりと遊んでいるようにみえてあまり大変そうにみえなかった。とはいえ、実際の船上や南極でもやることなくて娯楽ないと持て余すのかなとも思えた。<a href=https://www.nipr.ac.jp/antarctic/>南極地域観測隊</a> って現実にあるんだなとみてた。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>僕はだいたいプログラミングしてるときは既に内容を知ってるアニメを常に流してるんですが今週はまた「宇宙よりも遠い場所」を観ていました。これほどまでに13話すべて足すところも引くところもない完璧な作品は他に早々思いつかないです。</p>&mdash; 父 (@fushiroyama) <a href="https://twitter.com/fushiroyama/status/1453610090632663048?ref_src=twsrc%5Etfw">October 28, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>9.3 順序の保証を読んだ。</p>
<blockquote>
<p>データベースや分散システムにおいて順序付けは重要な基本的概念である。順序と線形化可能性、合意との間には深い関係がある。順序付けが重要なのは <strong>因果関係</strong> を保つのに役立つことがあげられる。</p>
<p><strong>全順序</strong> があれば任意の2つの数を比較して大小関係を必ず判断できる。たとえば自然数には全順序があると言える。線形化可能なシステムは操作に全順序がある。一方で因果律には並行という概念があり、どちらが先に行われたかが重要ではない場合に操作が並行に行われたとみなせる。したがって、因果律は全順序ではなく、 <strong>半順序</strong> を定義すると言える。半順序とは、大小関係を比較できる場合もあるしできない場合もあることを指す。</p>
<p>因果律に基づく順序と線形化可能性との関係は、線形化可能性は因果関係を <strong>暗に含む</strong> といえる。線形化可能性を持つシステムは、因果律を正しく保持する。しかし、システムを線形化可能にすればパフォーマンスや可用性が損なわれる可能性がある。特にネットワークの遅延が大きい（たとえば地理的に分散している）システムで問題になる。そのため、分散データシステムの中には線形化可能性をあきらめることでパフォーマンスを向上させたものの、扱いが難しいものもある。因果律を保持する方法は、線形化可能性が唯一というわけではなく他の方法もある。多くの場合、システムに本当に必要なのは線形化可能性ではなく因果律における一貫性だけであり、これは線形化可能性よりも効率の良い実装が可能となる。</p>
<p>因果律における一貫性を保持する方法として次のものがあげられている。</p>
<ul>
<li>シーケンス番号またはタイムスタンプ</li>
<li>ランポートタイムスタンプ（Lamport timestamp）</li>
</ul>
<p>しかし、分散システムではネットワークを介して他のノードの状態を確認しないと因果律の一貫性を確定できない。たとえシングルリーダーアプリケーションであっても、リーダーに障害が発生したときにリーダーのフェイルオーバーが必要となる。この問題は <strong>全順序のブロードキャスト</strong> と呼ばれる。ZooKeeper や etcd のような合意サービスが全順序ブロードキャストを実装している。</p>
<p>詳細は省くが、ネットワークを介した分散システムで線形化可能な compare-and-set （あるいは increment-and-get ）を実装しようとすると、必然的に合意アルゴリズムに行き着く。これらと全順序ブロードキャストは等価であることが証明できる。したがって、これらの問題のいずれかを解決できれば、他方の問題の解決策に変換できるという点は重大な知見である。</p>
</blockquote>
<h2 id=realforce-のワイヤレスモデル>REALFORCE のワイヤレスモデル</h2>
<p>ユーザーから待望されていた REALFORCE のワイヤレスモデルがとうとう発売された。</p>
<ul>
<li><a href=https://weekly.ascii.jp/elem/000/004/073/4073042/>高級キーボードREALFORCEから待望のワイヤレス機「R3」が登場、見どころは？</a></li>
</ul>
<p>先週から amazon で予約販売を受け付けていたので <a href=https://amzn.to/3EJivAF>REALFORCE 東プレ R3 キーボード 静音 ハイブリッドモデル 日本語配列 91キー ブラック R3HC12</a> を予約して、本日届いた。私はとくに必要ないけど、bluetooth のマルチペアリングに対応していて最大4つまで接続できる。オフィスの机はそこそこ広いけれど、本とラップトップとモニター2台置いたらスペースが埋まってしまっている。ご飯を食べるときや書類を作成するときにキーボードを立てかけたりしてスペースを確保していて不便に感じていた。</p>
<p>ubuntu 環境での bluetooth の設定に少し手こずった。GUI の設定マネージャー (blueman) でペアリングしようとしても失敗する。キーボードの情報は取得できるけど、ペアリングは失敗する。試しに macos でペアリングしてみたらパスキーの入力画面が表示されて、6桁の数字を入力して ENTER した後に接続するとペアリングできた。blueman だとパスキーが表示されないなと気付いてググってたら <a href="https://bbs.archlinux.org/viewtopic.php?id=174239">[SOLVED] Bluetooth keyboard: Unable to pair (authentication timeout)</a> を見かけて、bluetoothctl でも設定できそうなのでやってみた。</p>
<pre tabindex=0><code>キーボードの情報を表示
[REALFORCE_3]# info F6:9D:A5:80:B7:1F
Device F6:9D:A5:80:B7:1F (random)
	Name: REALFORCE_3
	Alias: REALFORCE_3
	Appearance: 0x03c1
	Icon: input-keyboard
	Paired: no
	Trusted: yes
	Blocked: no
	Connected: yes
	LegacyPairing: no
	UUID: Generic Access Profile    (00001800-0000-1000-8000-00805f9b34fb)
	UUID: Generic Attribute Profile (00001801-0000-1000-8000-00805f9b34fb)
	UUID: Device Information        (0000180a-0000-1000-8000-00805f9b34fb)
	UUID: Battery Service           (0000180f-0000-1000-8000-00805f9b34fb)
	UUID: Human Interface Device    (00001812-0000-1000-8000-00805f9b34fb)
	RSSI: -45
</code></pre><pre tabindex=0><code>ペアリングを実行
* エージェントからパスキーが表示されて、キーボードで入力して ENTER したらペアリングに成功した
[bluetooth]# pair F6:9D:A5:80:B7:1F
Attempting to pair with F6:9D:A5:80:B7:1F
[CHG] Device F6:9D:A5:80:B7:1F Connected: yes
[agent] Passkey: 323759
[CHG] Device F6:9D:A5:80:B7:1F Paired: yes
Pairing successful
[CHG] Device F6:9D:A5:80:B7:1F Modalias: usb:v08ACp0302d0001
[CHG] Device F6:9D:A5:80:B7:1F ServicesResolved: yes
</code></pre><pre tabindex=0><code>キーボードを信頼する
[REALFORCE_3]# trust F6:9D:A5:80:B7:1F
Changing F6:9D:A5:80:B7:1F trust succeeded
</code></pre><h2 id=契約書の確認>契約書の確認</h2>
<p><a href=/diary/posts/2021/1026/#選考面談>先日</a> の業務委託案件の契約書が届いたので内容を確認した。</p>
<p>これまで <a href=https://www.cloudsign.jp/>クラウドサイン</a> でしか契約したことがなくて、紙の契約書で契約を締結するのは初めての挑戦でもある。<a href=https://www.post.japanpost.jp/service/letterpack/>レターパック</a> を使って郵送するのがお作法？といったところから調べてた。明後日から働き始める。フルリモートなので物理的な職場は変わらないけど、新しい職場は緊張するな。うまく入っていけるやろか。フルリモートの経験もだいぶたまってきたし、体調も万全だし、憂うことは何もないはず。いまの状況は純粋に私ががんばるだけだ。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1101/>資料作り完了</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-01
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/government/>government</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<img src=/diary/img/2021/1101_learning.png class=post-cover alt=資料作り完了>
<div class=post-content>
<p>4時に寝て8時に起きた。夜に資料作りに集中していたので家に帰ってきたのが3時頃で、くつろいだりアニメみたりしてから寝た。遅くに帰ってきてもすぐに寝るわけじゃなくて、だらだらして実際に寝るまで1-2時間はかかる。こういうところ、生活が堕落していて改善していくべきなのかもしれない。良かったこととして、ウォーキングのせいか、夜はよく眠れた。</p>
<h2 id=みんなの-python-勉強会の資料作り>みんなの Python 勉強会の資料作り</h2>
<p>昨日の続き。一晩寝てから最後の仕上げをした。時間を置く、とくに一度寝てから資料を洗練させると改善点があちこち出てきてより良いものになっていく気がする。午前中に主催者に連絡したものの、午後になってから思い付いたことをちょくちょく修正したりもした。オンラインの資料だと、先方に連絡した後でも微修正できるところがよい。業務の資料だとさらに2-3日かけて洗練させていくけど、勉強会の資料だからこれでいいかな。タイトルはすごく気に入っているというわけではないけど「本と学びの段階」とした。ひとまず完成したので自分のやりたいことに取り組める。</p>
<h2 id=神戸市長選>神戸市長選</h2>
<p>神戸市は衆議院選挙とは別に市長選挙も一緒にあった。<a href=https://www.nhk.or.jp/senkyo2/kobe/17581/skh50331.html>神戸市長選</a> によると、投票率は53.79％で439,749 (67.7%)の得票を得た現職の市長が完勝した。3回目の当選になるらしい。私が神戸に戻ってきてから初めての市長選挙だった。起業してから手続きなどで行政が身近になったことから関心をもつようになってきた。自分ごとで考えるというのか、どんなものでも身近なことは関心をもつのかもしれない。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>9.2 線形化可能性を読んだ。</p>
<blockquote>
<p><strong>線形化可能性</strong> とは、データのコピーが1つしかなく、そのデータに対する操作がすべてアトミックであるかのようにシステムにみせることを指す。古くなったキャッシュやレプリカからの値ではないことを保証する、<strong>最新性の保証（recency guarantee）</strong> と言える。トランザクションの章に出てきた <strong>直列化可能性</strong> とはまったく異なる。直列化可能性が保証するのは、複数のトランザクションが何らかの順序で実行された場合に同じ結果になることを保証するもの。</p>
<p>あと「役に立たない CAP 定理」というコラムもおもしろい。CAP 定理とは次の3つはすべて成り立たず、2つを選択することを強いる。</p>
<ul>
<li>一貫性（Consistency）</li>
<li>可用性（Availability）</li>
<li>分断耐性（Partition tolerance）</li>
</ul>
<p>CAP 定理は歴史的にデータベースのトランザクションのトレードオフについての議論の出発点として引用され、有名な定理ではあるが、分散データベースの研究者の中では1970年代から知られていたことであったらしい。そして、ネットワークを介した分散システムは、分断耐性が必須 (ネットワークが切断しないことはないから) であることから一貫性か可用性のどちらかを選択するしかない。ここで一貫性とは線形化可能なシステムを実装することだが、これはパフォーマンスのデメリットが大きい。そのため、現代の多くの分散データベースは線形化可能性を提供しないことを選択しており、結果として可用性と分断耐性を選択することになっている。したがって、CAP 定理から議論を始めることは無意味であると言う。</p>
</blockquote>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1031/>ほぼ一日資料作り</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-31
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<div class=post-content>
<p>昨日はいつ寝たんだろう？たぶん0時ぐらいに寝て7時に起きたものの二度寝して9時に起きて、それでも眠くてそのままお昼前まで寝てた。今週はなるべく6時に起きる生活リズムの移行をやっていたのでそろそろ疲れたのかもしれない。お昼から起き上がって活動を開始した。昨日に期日前投票を済ませておいたから今日はゆっくり過ごせた。本当は夜に選挙の総括をみたかった気持ちもあったけど、また明日でもいいか。</p>
<h2 id=みんなの-python-勉強会の資料作り>みんなの Python 勉強会の資料作り</h2>
<p>昨日の続き。午後からオフィスで資料を作り始めた。夕方に晩ご飯食べに帰ってくつろいでからまた夜にウォーキングの途中でオフィスに戻ってきて資料を作っていた。気付いたら3時間ほどやってて9割ほどできた。本と読者と学びの段階みたいな、何が言いたいのか自分でもまだ明確ではない、学びの視点を考慮したプログラミングの話しを組み立ててみた。まだふわふわしているのでもう少し洗練させて詰めようと思う。資料の中に3つの話題があるのでなんかうまくまとまっていないような気がしている。タイトルも決まらない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1030/>勉強会のコンテンツ思案</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-30
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<div class=post-content>
<p>0時からウォーキングに出て1時に帰ってきて軽くストレッチして <a href=http://yorimoi.com/story/>宇宙よりも遠い場所</a> を3話までみた。たまたまタイムラインでツィートをみかけて気になってみたら確かにおもしろい。3時ぐらいから寝て6時半に一度起きたものの、2度寝して8時ぐらいまで寝てた。夕方に期日前投票やって、初めて出口調査に声を掛けられたのでそれもやってみた。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>僕はだいたいプログラミングしてるときは既に内容を知ってるアニメを常に流してるんですが今週はまた「宇宙よりも遠い場所」を観ていました。これほどまでに13話すべて足すところも引くところもない完璧な作品は他に早々思いつかないです。</p>&mdash; 父 (@fushiroyama) <a href="https://twitter.com/fushiroyama/status/1453610090632663048?ref_src=twsrc%5Etfw">October 28, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<h2 id=消防設備点検>消防設備点検</h2>
<p>点検があるとのことだったので軽く部屋を掃除した。朝ゴミ捨てに行ったらたまたま管理人さんがいて、点検の時間帯でもしいなかったら勝手に部屋に入ってやってもらってよいですと連絡してたら、点検員さんに掛け合ってくれてすぐに設備点検してもらえた。部屋とキッチンにある火災探知機がちゃんと作動するかどうかをテストしてた。2分ぐらいで完了した。おかげで今日の家を出る予定を前倒しできた。感謝。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今週はジョギングしてない代わりにウォーキングをして筋肉痛を軽減しつつ臨んだ。平日のストレッチも3回ぐらいやっているので現状維持ぐらいかな？と思ったけど、開始前166cmで、ストレッチ後167cmで前回よりも数値は悪くなってた。物理的な体調はよいつもりだったけど、数値が悪化したのでなにか不足があるのか、平日のストレッチの時間が足りないのかもしれない。もしくは、ストレッチを受けていると、まだ右股関節の違和感とお尻の筋肉の張りは根強い。今週は5日ぐらいウォーキングしているのでその疲労もあるのかもしれない。トレーナーさんに夜にウォーキングするとよく眠れるという話しをしたら、ジョギングよりもウォーキングの方がリラックスできて、ジョギングや筋トレ (激しい運動) は交感神経を刺激して睡眠にはよくないといった話だった。ググったら <a href=https://kenja-club.com/column/201605kobayashi/>ジョギングよりもウォーキングがお勧め</a> という記事も出てきた。</p>
<h2 id=みんなの-python-勉強会の資料作り>みんなの Python 勉強会の資料作り</h2>
<p>昨日の続き。発表の内容の構成を考えながら、過去に書いた本や資料、サンプルコードなどを見返していた。コンテンツはだいたい頭の中で固まってきた。あとは構成を練りながら実際にスライドとして仕上げていくだけ。いつもそうなんだけど、スライドの作り始めが一番難しい。何から書くか、どこから作り始めるのかに最も時間を割く。もう少し悩みながら考えておく。</p>
<h2 id=サバクトビバッタの研究>サバクトビバッタの研究</h2>
<p>たまたまタイムラインでみかけて <a href=https://otokomaeno.hatenablog.com/entry/2021/10/30/170343>『バッタを倒しにアフリカへ』行き、必殺技を見つけてきました</a> を読んでみたらすごくおもしろかった。国連にはバッタ予報官という専門職？があるのを記事などでみかけていた。日本だとイナゴになるんだろうけど、世界的にはバッタなんよね。そんなバッタの研究に、全然関係ない日本の若手研究者が、過去40年間誰もアフリカで腰を据えて研究しておらず、バッタ研究の歴史が止まったままであることに気付いて、何年もかけてシンプルな観察をメインにしたフィールドワークで成果をあげたという、ミドルエイジクライシスな自分にとっては痛快で元気がでる記事だった。著者のノリもおもしろいので、おそらく陽気な人なんだろうと思う。応援する意図でも <a href=https://www.amazon.co.jp/exec/obidos/ASIN/B072FGTM65/hatena-blog-22/>バッタを倒しにアフリカへ</a> を購入した。</p>
<div class=video-container>
<iframe src=https://www.youtube.com/embed/Eq1RP7t1ZOw allowfullscreen title=国連食糧農業機関（FAO）の上級バッタ予報官キース・クレスマンさんインタビュー></iframe>
</div>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1029/>フラクタルスプリントの調査</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-29
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
</span>
<div class=post-content>
<p>2時から <a href=https://www.facebookconnect.com/ja-jp/>Connect 2021</a> のイベントをみてた。3時過ぎぐらいには眠くて耐えられなくなってそのまま寝落ちしたら7時に起きた。本当は6時から金朝ツメトギの朝活の日だったのに寝坊して参加できなかった。なんか疲れて家に帰って13時から17時まで寝てた。生活のリズムを崩すと大きく集中力がなくなる。その後、またオフィスに行って作業してた。</p>
<h2 id=connect-2021>Connect 2021</h2>
<p>マーク・ザッカーバーグの基調講演を聞いていると、機械学習の次のテックの波はメタバースなのかなぁとか思ったりもしたけど、あとで <a href=https://nianticlabs.com/blog/real-world-metaverse/>メタバースはディストピアの悪夢です。より良い現実の構築に焦点を当てましょう。</a> を読んでいて、やっぱり違うよなぁとも思った。自分がメタバースの世界で活動したり、アプリケーション開発をやってないから他人の意見に引っ張らられる。いずれにしても自分でちょっとやってみて、メタバースとの今後の付き合い方を考えないといけないということだけは理解した。今日の時点ではこのツィートがおもしろかった。</p>
<blockquote class=twitter-tweet><p lang=und dir=ltr><a href=https://t.co/4UHSycJ9HR>pic.twitter.com/4UHSycJ9HR</a></p>&mdash; seya (@sekikazu01) <a href="https://twitter.com/sekikazu01/status/1453963389420531714?ref_src=twsrc%5Etfw">October 29, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<h2 id=みんなの-python-勉強会>みんなの Python 勉強会</h2>
<p>あべさんから依頼がきて <a href=https://startpython.connpass.com/event/228136/>みんなのPython勉強会#75</a> で発表することになった。いつだったか忘れたけど、コロナ禍になる前だったと思うけど、いつか発表してほしいみたいな話しをしたりしながら機会がなくていまに至るというのもあって、内容があうならいっかという感じで引き受けた。20-30分程度でできるPyとエキPy第3版の話しを半々ずつみたいな内容でやるつもり。週末に内容を詰めて資料を作るつもり。Python は普段使いのツールとして使っているものの、お仕事で Go や Java で開発するようになってからあまり深く関わらないようになってしまった。ずっと Python コミュニティの勉強会に行ってたから、いまでも Python の人とみられるのは仕方ないかなとも思う。</p>
<h2 id=フラクタルスプリント>フラクタルスプリント</h2>
<p>ある記事で <strong>フラクタルスプリント</strong> というキーワードをみかけて、なんのことか分からなかったので調べてみた。47機関というチームが実践しているスクラムをベースにした開発方法論と言えるのかな？次の発表動画をみて雰囲気は理解できた。</p>
<ul>
<li><a href=https://kyon-mm.hatenablog.com/entry/2020/10/18/171650>15分スプリントの具体的な進め方について動画で話した #15min_sprint</a></li>
</ul>
<p>フラクタルスプリントのやり方はこんな感じ。</p>
<ul>
<li>基本はスクラムのイベントをそれぞれのスプリントで行う</li>
<li>スプリントの中にスプリントを含めるという入れ子構造をとる
<ul>
<li>1ヶ月 → 1週間 → 1日 → 1時間 → 15分の入れ子</li>
</ul>
</li>
<li>それぞれのスプリントの20%程度の時間は自由時間にしてバッファをとる
<ul>
<li>例えば、1時間のスプリントに含むのは 15分 x 3 のスプリントと残り時間は自由なスプリントの時間にする</li>
</ul>
</li>
<li>15分スプリントは10分タスクを1つだけやるスプリントと言える
<ul>
<li>残りの5分をスクラムイベントにあてる</li>
</ul>
</li>
</ul>
<p>極端にイテレーション期間の短いスプリントをすることで、通常のスクラムの開発方法論になかったイノベーションが起きるのではないか？といったところを狙いに47機関さんが業務で実践的にやっているプラクティスと言えるみたい。実際にやってみてうまくいったことなどを話しているので、ある種の学習コストを要求するものの、よいところもあるようには思える。おそらくは意図的に悪いところを話してなかったようには思える。例えば、それぞれのスプリントのイベントにおけるオーバーヘッドは大きくなるので作業時間が減るとか、10分タスクですべてチケット化すると、チケット数が増えるので必然的に過程の記録はチケットに残ってないはず。スプリントバックログを付箋の代わりに使うだけというのはスクラム開発一般の話ではあるけど、このやり方では開発者が何をやっているかを書く場所としてチケットは適切な場所ではなくなる。代わりに wiki にまとめるとは話してた。wiki だとフロー情報を監視するのが難しくなるが、その分、短いスプリントでのイベント (プランニング、レビュー、レトロスペクティブ) が頻繁にあるのでそれをフロー情報の監視の代替として機能するようにみえる。いわば強制で。</p>
<p>15分スプリントと聞いて先入観でイメージするよりも、合理的なところも理解できたのでチームの学習コストとスプリントイベントのオーバーヘッドを受け入れるなら悪くない開発方法論かもしれない。良い・悪いといった是非ではなく、47機関さんが大事にしているチームの価値観や文化、そしてチームをよくするための実践的な方法論と一緒に理解することでこの開発方法論は活きてくる。開発方法論だけをみてあれこれ言うのは適切ではないとも思えた。自分たちの業務や働き方にあった開発方法論を開発チームはずっと考え続けていくべきだと私は考えていて、47機関というチームはフラクタルスプリントという手法を編み出して、それ自体が素晴らしいなと思えた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1028/>変哲もない日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-28
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/subcontract/>subcontract</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時半に起きた。久しぶりに勉強会でたくさん話したせいか、疲れて抜け殻になってた。昨日もよく眠れた。今日は調整作業が多かったので集中力を欠いてチケットの業務は進められなかった。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>第Ⅱ部の最後の章である9章の一貫性と合意を読み始めた。この章も内容は難しそう。9.1 まで読み終えた。時間をかけて1節ずつ読んでいく。</p>
<blockquote>
<p>間違っているかもしれなくても動き続ける方が良いのか、それとも正しくあるべく停止してしまう方が良いのか？</p>
<p>―― <a href=https://blog.empathybox.com/post/62279088548/a-few-notes-on-kafka-and-jepsen>Jay Kreps, “A Few Notes on Kafka and Jepsen” （ 2013 ）</a></p>
</blockquote>
<p>冒頭の格言で kafka というキーワードが気になったので原文を探して (deepl で翻訳して) 読んでみた。一般論で考えたらこの問いの答えは停止してしまう方を選択するように私は考えてしまったが、原文の記事によると、この答えはアプリケーションに依るという。ダウンタイム=データの損失という特性のアプリケーションであれば、間違っている可能性があってもすぐに復旧して動かした方がよいという場合もあると言っている。kafka はどちらかと言えば、間違っていても動き続ける方のシステムに分類されると思う。メッセージの到達保証も At Least Once だし。</p>
<p>もう1点、意識しておかないといけないのはレプリケーションを行うデータベースの大半は <strong>結果整合性（eventual consistency）</strong> であること。私は本書を読むまで、結果整合性をスケーラビリティやスループットの高い分散システムのキーバリューストアの特性だと考えていたが、RDB であってもレプリケーションはリアルタイムに行われるわけではなく、ネットワークという遅延の上限が保証されないインフラの上に構築されたものである以上、結果整合性で同期される。レプリケーションをしないデータベースシステム以外はすべて結果整合性の特性があると考えて設計や開発をする必要がある。</p>
<h2 id=pmbok-ガイド第7版>PMBOK ガイド第7版</h2>
<p><a href=https://www.pmi-japan.shop/shopdetail/000000000028/>プロジェクトマネジメント知識体系ガイド（PMBOKガイド）第7版＋プロジェクトマネジメント標準</a> を購入して届いた。たぶんいつか電子版も出ると思うけど、現時点では紙の本しかなさそう。ぱらぱらとめくりながら中身を眺めているとそんなに文字がびっしり書いてあるような本ではないので読むのはそんなに大変ではなさそうな印象を受けた。索引で知りたいキーワードを探しながらその箇所を拾い読みしたりしてた。またがっつり読み込んでまとめていきたい。</p>
<h2 id=選考面談の最終決定>選考面談の最終決定</h2>
<p>先日受けた <a href=/diary/posts/2021/1026/#選考面談>選考面談</a> で2社ともオファーをいただいた。感謝。自分の中では決まっていたが、顧問さんにも双方の案件の概要を話してアドバイスをもらった。その結果、私の意思と顧問さんのアドバイスも一致した。何の憂いもなく Java の開発案件の方を選択した。11月上旬から働き始める予定。3ヶ月ほど課題管理の調査・研究みたいなことをやっていたけど、いつまでもやれるほど財務に余裕がないので普通に働きながら自社のプロダクト開発も並行してやっていく。以前は2社のお仕事を引き受けて他のことをやる余裕がなくなってしまっていただけど、その失敗を教訓に今回は1社の仕事だけを専念しつつ、自社の仕事も少しずつ進めていきたい。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1027/>bizpy 再開</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-27
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/recipe/>recipe</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
</span>
<div class=post-content>
<p>2時に寝て6時に起きた。前日の夜にウォーキングしたせいか、よく眠れた。朝活を終えてから朝ご飯を作って食べてそのままオフィスに出社した。6時起きを日課にした方が生活のリズムがよい。夕方に眠くなって1時間ほど昼寝した。</p>
<h2 id=朝活-ミクロ経済学入門の入門>朝活: ミクロ経済学入門の入門</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/228969/>【三宮.dev オンライン】リモート朝活もくもく会</a> で第4章の供給曲線を読んだ。需要曲線の逆からの視点なので考え方は同じで図の形が異なる。用語がいくつか出てきたのでまとめる。</p>
<ul>
<li>収穫逓減 (しゅうかくていげん): 製品をより多く生産するのにかかる経費が増大していくこと
<ul>
<li>生産活動において2倍の生産量を生み出すには2倍以上の経費がかかる</li>
</ul>
</li>
<li>費用関数: 生産量と費用との関係をあらわす</li>
<li>限界費用: 追加的に1単位生産する費用
<ul>
<li>3個を生産する費用は、1個目の限界費用 + 2個目の限界費用 + 3個目の限界費用
<ul>
<li>個数が増えるごとに費用は高くなっていく</li>
</ul>
</li>
<li>費用を図示するときは限界費用に分解した方が視覚的にわかりやすい</li>
</ul>
</li>
<li>限界費用逓増: 生産するごとに限界費用が高まっていくこと</li>
</ul>
<p>「<a href=https://dictionary.goo.ne.jp/word/kanji/%E9%80%93/>逓</a>」という漢字は「つぎつぎ」や「だんだん」という意味をもつ。</p>
<ul>
<li>プライステイカー: 自分の生産量が価格に影響を与えられない
<ul>
<li>減産により希少価値を高め価格を吊り上げる市場操作ができない</li>
</ul>
</li>
<li>独占企業: プライステイカーの反対。</li>
<li>利潤: 売上 - 経費</li>
<li>最適解: 利潤を最大化する生産量
<ul>
<li>あと1個追加して生産すると利益がマイナスになるところ</li>
</ul>
</li>
<li>生産者余剰: すべての企業の利潤の和</li>
<li>供給曲線: すべての企業の限界費用をヨコに足し合わせた曲線</li>
</ul>
<figure><img src=/diary/img/2021/1027_supply-curve.png>
</figure>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>昨日の続き。8.4 を読んで8章分散システムの問題を読み終えた。全体としても学びになったけれど、とくに 8.3 信頼性の低いクロックの節が全く開発・運用で意識したことがなかったので私にとっては学びになった。</p>
<blockquote>
<p>分散システムにおいて発生する厄介な問題がある。</p>
<ul>
<li>
<p>ネットワーク経由でパケットを送信しようとした場合、そのパケットはロストしたり、どれほど遅延するか分からない。同様に、レスポンスもロストしたり遅延したりするので、レスポンスを受け取れなかった場合には元々のメッセージが到達したかどうかも分からない</p>
</li>
<li>
<p>ノードのクロックは他のノードと大きくずれているかもしれない（できる限りの努力をして NTP をセットアップしたとしても）。クロックは急に進んだり戻ったりするかもしれず、たいていはクロックの誤差をうまく計る方法がないので、クロックに依存するのは危険</p>
</li>
<li>
<p>プロセスは処理中にいつどれほどの長さ一時停止するかもしれず（おそらくはstop-the-worldガベージコレクタのため）、他のノードから落ちていると見なされた後に自身に一時停止があったことを理解しないままに復活するかもしれない。</p>
</li>
</ul>
<p>こういった <strong>部分障害</strong> が生じうるのが分散システムの特徴と言える。ソフトウェアが他のノードが関わる何かをしようとした場合、それは時おり失敗したり、ランダムに速度が落ちたり、まったくレスポンスが返されない（そして最終的にはタイムアウトする）といった可能性がある。分散システムでは、部分障害への耐性をソフトウェアに組み込み、システムの構成要素が一部破損していてもシステム全体としては機能し続けられるようにする。</p>
<p>フォールトに耐えるための最初のステップはフォールトを <strong>検出</strong> することだが、それさえも難しい。多くのシステムは、ノードに障害が生じていることを検出する正確な仕組みを持たないので、ほとんどの分散アルゴリズムはリモートノードが生きているかどうかを判断するのにタイムアウトに頼る。しかし、タイムアウトはネットワークの障害とノードの障害を区別できず、ネットワークの遅延変動のために間違ってノードがクラッシュしていると誤検知することもある。弱っているものの落ちてはいないノードは、きれいに落ちているノードよりもさらに扱いが難しくなる可能性がある。</p>
<p>フォールトが検出されたとして、システムがそれに耐えられるようにすることも簡単ではない。マシン間にはグローバルな変数も、共有メモリも、共通の情報やその他何らかの共有された状態もない。ノードは現在の時刻についてさえ合意できず、ましてやもっと重大なことに合意することなどできない。あるノードから他のノードへ情報を流せる唯一の方法は、その情報を信頼できないネットワークを通じて送ることだけである。重要な判断は単一のノードだけで安全に下すことができないので、他のノードの助けを得てクオラムが合意に至るようにするためのプロトコルが必要となる。</p>
<p>同じ操作をすれば決まって同じ結果を返してくれるような、単一コンピュータにおける理想化された数学的な完全さの中でソフトウェアを書くのに慣れていると、分散システムの雑然とした物理的な現実への移行はちょっとしたショックを伴う。一方、分散システムのエンジニアは、しばしば単一のコンピュータ上で解決できる問題を簡単なものだと見なすが、実際のところ今日では単一のコンピュータがこなせる仕事量はかなりのものになっている。単一のマシンでシンプルにことを済ませられるなら、概してそうする価値はある。</p>
<p>分散システムを利用する理由はスケーラビリティだけではない。耐障害性や低レイテンシ（地理的にユーザーの近くにデータを置けることによる）も同様に重要な目標であり、こういったことは単一ノードでは実現できない。本章ではネットワーク、クロック、プロセスの信頼性の低さが避けがたい自然の法則なのかも調べた。安全ではなく、クリティカルではないシステムの多くでは、高価な高信頼性よりも安価な低信頼性が選択される。また、信頼性の高いコンポーネントを前提としているスーパーコンピュータも取り上げました。スーパーコンピュータはその前提が故に、コンポーネントに障害が生じてしまった場合には完全に停止させて再起動することになる。これに対し、分散システムはサービスレベルでは中断することなくいつまでも動作し続けられる。これは、少なくとも理論上はすべてのフォールトやメンテナンスはノードレベルで処理できるためである。</p>
</blockquote>
<h2 id=お昼ご飯>お昼ご飯</h2>
<p>気分でスーパー寄って買いものして家に帰り、お昼ご飯を作って食べた。前に適当に作った <a href=/diary/posts/2021/1025/#お昼寝>かぼちゃの煮物</a> がおいしかったので再挑戦してみた。今度は圧力鍋を使っていろいろ具材を入れてみた。過去に作っておいしかった料理のレシピを evernote に書いたりしていたけど、もういまは書いてないので気が向いたら日記に書くようにする。</p>
<p>材料</p>
<ul>
<li>A
<ul>
<li>水 900cc</li>
<li>めんつゆ 100c</li>
<li>醤油 適量</li>
</ul>
</li>
<li>B
<ul>
<li>かぼちゃ 1/4切れ</li>
<li>なす 3個</li>
<li>にんじん 2本</li>
<li>玉ねぎ 1個</li>
<li>しめじ 1パック</li>
</ul>
</li>
<li>C
<ul>
<li>卵 2個</li>
<li>豆苗</li>
<li>せみ餃子</li>
</ul>
</li>
</ul>
<p>作り方</p>
<ol>
<li>圧力鍋に A を入れて火にかける</li>
<li>B の野菜を切りながら圧力鍋に入れていく</li>
<li>圧力鍋に B をすべて入れたら圧をかける (高圧30秒)</li>
<li>圧が下がったら蓋をあけて C を入れる</li>
<li>C に火が通るまで2分ほど煮込む</li>
</ol>
<p>所感</p>
<p>圧力が強過ぎたのか、かぼちゃが煮汁に溶け出してしまって原形がなくなってしまった。スープとして飲んでもおいしいけれども、水を入れ過ぎたのかもしれない。肉の代わりに餃子を使ってみた。水餃子っぽくなるので焼き餃子で油使うよりヘルシーな気持ちになっておいしい。</p>
<figure><img src=/diary/img/2021/1027_pumpkin.jpg>
</figure>
<h2 id=bizpy-勉強会>bizpy 勉強会</h2>
<p><a href=https://bizpy.connpass.com/event/198717/>Python で Slack のインテグレーションをやってみる勉強会 #1</a> を開催した。半年以上開催してなかったので億劫になってしまっていたけど、再開できてよかった。10名ほどが参加してくれた。用意したコンテンツを話し終えたら8時半ぐらいで時間もちょうどよかった。初参加者も数人いた。slack インテグレーションの調査も兼ねてあと2-3回は集中的にやっていきたい。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1026/>韃靼そば茶</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-26
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/subcontract/>subcontract</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<img src=/diary/img/2021/1026_soba-tea.jpg class=post-cover alt=韃靼そば茶>
<div class=post-content>
<p>4時に寝て7時に起きた。やや寝坊したけど、夜中に作業してよく眠れたのでまぁいっかとしておく。昨日のかぼちゃの煮物が残っていたので19時に帰って晩ご飯食べて、ちょっと休んでからウォーキングに出た。ウォーキングの途中でオフィスに寄って一作業してからまたウォーキングして帰るという、運動と作業の一石二鳥になることを思いついた。ちょっと天才。ウォーキングの合計時間は1時間強ぐらい。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>8章分散システムの問題のうち、8.1, 8.2, 8.3を読んだ。</p>
<p>とくに 8.3 信頼性の低いクロックは私がこれまでアプリケーションを開発していて全く意識したことがなかった問題を扱っていてすごく勉強になった。おそらくミリ秒レベルでの障害調査をほとんどやったことがなかったので気にしてなかったのかもしれない。Cassandra が採用している LWW (last write wins、最後の書き込みを勝たせる) だと、短時間に連続して行われた書き込みと、本当に並行して行われた書き込みとの区別がつかないのでクロックの同期の状況によって因果律違反が発生する懸念がある。</p>
<p>NTP を使っていてもクロックの同期はミリ秒から秒レベルで正確ではない可能性があり、そこにプロセスの一時停止なんかも加わると容易に数秒の時間がズレてしまい、トランザクションにおける因果律違反が発生する可能性があるという話が丁寧に説明されている。実際に同じリソースに対してミリ秒レベルでトランザクションを発行するというのはあまりない状況だろうし、状態がよければあっても正常に動作する。但し、正常にトランザクションが実行されない懸念があるという理屈を知っておくのは大事なことに思えた。Google の Spanner が原子時計を導入して精度の高い時刻同期をしているというのは記事を見聞きして知っていたが、それがないとどんな問題が発生するのかが 8.3 節を読むと理解できる。</p>
<h2 id=選考面談>選考面談</h2>
<p>そろそろお仕事をしないと会社の財務がやばいので選考を受けている。今日は2社の選考を受けた。1つは Go の開発案件、もう1つは Java の開発案件。どちらも業務内容はマッチングしていて勤務形態もフルリモートなのでいまの生活のまま、お仕事ができる。1社は正式にオファーが届いて、もう1社もおそらくオファーがくる想定。どちらかを選択する。転職だと面接を何回もして選考を受ける必要があるけど、業務委託だと大半が1回で決まる。昔フリーランスやってたときもそうだったかな？調整の管理コストが下がって望ましいことではある。もう私の中では承諾する方の案件は決まっているけど、念のため、1日寝かして顧問さんとも相談した後、最終決定しようと思う。</p>
<h2 id=韃靼そば茶>韃靼そば茶</h2>
<p>少し前から家では <a href=https://www.murataen.com/item/1110/>大阿蘇万能茶</a> を煮出して冷やして飲んでいる。村田園のサイトにはないので商品名が変わった？のかもしれない。この万能茶は、よく言えば後味すっきり、わるく言えば刺激がないと言える。おいしくないわけではない。近所のドラッグストアでノンカフェインのお茶を求めて購入した。もう少しお茶の主張がほしいなと思って、にっこくの <a href=https://www.nikkoku.co.jp/products/homeuse/dattan/>韃靼そば茶</a> を購入した。そば茶もノンカフェイン。これは水出しもできる。試しに水筒にティーパックを入れて、オフィスのウォーターサーバーで水を入れて作ってみた。時間が経つごとにそば茶の味が濃くなっていくけど、これはこれで私は好みなので問題なさそう。なるべく1日で飲みきって水筒を洗えばよさそう。</p>
<p>夜にうまく眠れなくなってから、夜にカフェインの入った飲みものを避けるようになった。ノンカフェインだとわかっているお茶なら安心して飲める。しばらく試してみる。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1025/>新しい生活リズムへの移行</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-25
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
</span>
<img src=/diary/img/2021/1025_pumpkin.jpg class=post-cover alt=新しい生活リズムへの移行>
<div class=post-content>
<p>3時に寝て6時に起きた。今日はちゃんと起き上がって朝からお茶を煮出して粗熱とって冷やしたりしてた。その後、準備してオフィスに着いたのが7時20分。いつもより1時間早く起きているのでオフィスに着くのも1時間早くなる。<a href=/diary/posts/2021/1022/>先週</a> の水曜日と金曜日だけ朝活やってみて逆に生活のリズムが乱れてよくない感じがした。今週は毎日6時に起きて朝活に参加してみるのを試す。</p>
<h2 id=ミクロ経済学入門の入門>ミクロ経済学入門の入門</h2>
<p>早起きしたので打ち合わせ前の隙間時間に第3章の需要曲線を読んだ。まずは用語の整理から。</p>
<ul>
<li>上級財: 所得が増えたときに消費が増える財</li>
<li>下級財: 所得が増えたときに消費が減る財</li>
</ul>
<blockquote>
<p>一般的な傾向として、ものは消費するほど有り難みが減る。たとえば僕はコーヒー1杯目に最大4ドルまでなら払ってよいけれど、2杯目には最大2ドルまでしか払いたくない、そして3杯目には最大1ドルまでしか払いたくない、というように。</p>
</blockquote>
<p>食べものとか実際にボリュームディスカウントされることが多いので食べものだとイメージしやすい。スーパーで半額になった豚カツを2枚買うときの私の気持ちはこんな感じ。定価なら1枚しか買わないのに半額なら2枚買ってもいいかと思ったりする。たまに2枚を一度に食べて気分悪くなって後悔する。たいていは晩ご飯に1枚、翌日のお昼ゴハンに1枚を分けて食べる。</p>
<ul>
<li>余剰: 価格と消費者がお金を払ってもよい金額との差額
<ul>
<li>コーヒー1杯に400円払ってよいと考えていて、100円のコーヒーを買うなら300円が余剰といえる
<ul>
<li>さらにコーヒー2杯目を50円で買ってよいと考えるなら350円が余剰と言える</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>すべての消費者の余剰を計算したものを消費者余剰という。需要曲線からある価格 p を取るときの次のグラフにおける面積を消費者余剰と呼ぶ。グラフにすると直観的にわかりやすい。</p>
<figure><img src=/diary/img/2021/1025_consumer-surplus.png>
</figure>
<p>消費者余剰に対して、売る側の利潤の合計を生産者余剰と呼ぶ。消費者余剰と生産者余剰との和を社会的余剰と呼ぶ。社会的余剰を「市場のよさ」のモノサシとして使うと談合は禁止すべしということになる。</p>
<ul>
<li>ベルトラン価格競争
<ul>
<li>同品質で同費用の業者が価格競争をした場合、顧客は価格が安い方から商品を購入する。こうした市場をベルトラン寡占市場と呼ぶ</li>
<li>このとき業者間の価格競争は最終的に「底辺への競争」が起こり、経費と同じ価格に近づく
<ul>
<li>この状態をベルトラン均衡と呼ぶ</li>
</ul>
</li>
<li>業者間で談合して価格を据え置けばよいが、業者の数が多くなるとこれは難しい
<ul>
<li>裏切りが発生したり、信頼関係を維持するのが難しかったりして、長期的な利益や全体の利益を追求するのが難しい
<ul>
<li>ゲーム理論の話しのように読めた</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>価格弾力性
<ul>
<li>価格の変化によって需要がどのぐらい弾んで動くかをあらわす</li>
<li>弾力性が低いというと、価格が動いても需要はあまり変わらない状態をいう</li>
<li>弾力性が高い財は値上げすると需要が大幅に下がる
<ul>
<li>必需品は値上げしても需要が下がりにくい
<ul>
<li>課税で考えると、必需品への課税は貧しい人の生活に与えるダメージが大きい</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>ギッフェン財
<ul>
<li>需要曲線は右下がりのカーブになるのが通常だが、経験的事実に即している
<ul>
<li>そうした財を正常財と呼ぶ</li>
</ul>
</li>
<li>ごく稀に価格が上がるにつれ売れ行きが増すものがある、それをギッフェン財と呼ぶ</li>
</ul>
</li>
<li>代替効果: ある商品が値上げしたときに別の商品に置き換えたくなる</li>
<li>所得効果: 生活にゆとりがなくなると、高いものは買えなくなり、安いものを買おうとする</li>
</ul>
<p>内容はそう難しくないが、急にたくさんの用語が出てきて読み解くのに時間がかかった。</p>
<h2 id=設計ドキュメントレビュー>設計ドキュメントレビュー</h2>
<p>先週から作っていた設計ドキュメントを顧問さんと一緒にレビューした。スライド40枚を2時間がっつり話してめっちゃ疲れた。話し終えて20-30分抜け殻になって軽く散歩してきた。ここ3ヶ月、調べものをしてきた内容の集大成でもあり、頭の中にしかなかった課題管理の実践知を明文化するといった取り組みの (途中) 結果でもある。品質の良し悪しで言えば、たった3ヶ月で出来たものなので大したことはない。あくまで途上における段階でしかないのだけど、私の中でも納得感は出てきたし、レビューしてもらって厳しい指摘もなかったので方向性は出てきた感じがある。このまま時間のあるときに進めていく。</p>
<h2 id=slack-apps-の調査>Slack apps の調査</h2>
<p>この水曜日にある勉強会の <a href=https://github.com/t2y/python-study/tree/master/BizPy/slack/20211027>資料作成</a> が完了した。Slack apps の調査を勢いよくやりたいので2週間ごとに開催することにする。ドキュメントを眺めていて次回は <a href=https://api.slack.com/lang/ja-jp/app-home-with-modal>新機能、アプリのホーム・ヴューを活用しよう:house_with_garden:</a> のチュートリアルをやってみることに決めた。</p>
<h2 id=お昼寝>お昼寝</h2>
<p>睡眠時間が短かったせいか、朝早かったせいか、夕方に集中力がなくなったので17時に切り上げて帰って寝てた。今日は雨だったので徒歩通勤だったのもありウォーキングにもなった。途中でスーパーに寄って買いものして帰った。運動目的だと1時間ぐらい歩いても平気なのに通勤だと15分歩くだけで疲れる。同じ行動をしていても目的意識で変わってくる。18時ぐらいには家に着いてそのまま4時間ほど寝てた。その後、また起きて夜の作業に入った。起きてからお腹すいて即席でめんつゆと醤油とかぼちゃとささみと卵で煮物を作ってみたら意外とおいしかった。お腹すいているとちょっとしたものでもおいしい。気に入ったのでカバー画像にしてみた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1024/>bolt アプリ開発</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-24
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/slack/>slack</a>&nbsp;
</span>
<img src=/diary/img/2021/1024_bolt-app.png class=post-cover alt="bolt アプリ開発">
<div class=post-content>
<p>2時に寝て9時に起きた。寝る前に1時間ほどウォーキングしてきたせいか、よく眠れた。田んぼをしたり運動をしたり体を動かして疲れた方がよく眠れるような気がしてきた。しばらく続けてみようと思う。お昼は調べものをしていて夕方に眠くなって2時間ほど寝てまた夜も調べものをしていた。</p>
<h2 id=slack-apps-の調査>Slack apps の調査</h2>
<p>この水曜日に勉強会があるので調査と <a href=https://github.com/t2y/python-study/blob/master/BizPy/slack/20211027/README.md#slack-apps>資料作成</a> をしていた。いつの間にか slack app 作成のためのドキュメントもいくつか <a href=https://api.slack.com/lang/ja-jp>日本語化</a> されていることに気付いた。<a href=https://api.slack.com/lang/ja-jp/hello-world-bolt>Bolt フレームワークを使って Slack Bot を作ろう</a> のドキュメントをみながら <a href=https://github.com/slackapi/bolt-python>bolt-python</a> を使って簡単な bot アプリを作成した。アプリの設定・開発の流れはだいたいこんな感じ。</p>
<ol>
<li>slack app 作成</li>
<li>bot ユーザー作成</li>
<li>oauth スコープの設定</li>
<li>bolt アプリケーションの実装</li>
<li>イベントサブスクリプションの設定</li>
</ol>
<p>bolt とは別に <a href=https://github.com/slackapi/python-slack-sdk>python-slack-sdk</a> というライブラリが提供されていて、このライブラリを使って bolt というフレームワークが実装されている。bolt でやりにくいことがあったら直接 sdk を触ることもあるのかもしれない。</p>
<p>現時点で勉強会の参加者は17人もいる。半年以上さぼっていたけど、けっこうな人数が参加してくれている。slack app の調査も兼ねて3-4回ぐらいは勉強会を開く予定。初回はアプリを作成するときの雰囲気を学んでもらえればと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1023/>普通の休日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-23
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<img src=/diary/img/2021/1023_issue-tracking.png class=post-cover alt=普通の休日>
<div class=post-content>
<p>3時に寝て9時に起きた。前日の夕方お昼寝して21時から2時ぐらいまで作業してから寝たので生活のリズムが狂ってしまったかもしれない。それでもよく眠れたので体調は良いように感じた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p><a href=/diary/posts/2021/1016/#ストレッチ>先週は木・金と連日にジョギングして筋肉痛になってた</a> ので、今週は木曜日だけジョギングして金曜日はお休みしてストレッチを受けた。それでもまだ右股関節の違和感と若干の筋肉の張りは残っている。終わってから少し体が楽になったので疲れが溜まっていたのかもしれない。今日の開脚幅は開始前168cmで、ストレッチ後170cmだった。先週とほぼ変わらないので股関節の可動域は現状維持。トレーナーさんに自分でストレッチしていて感じた左右の違いや右股関節の違和感を相談してみてもらったりした。物理的な身体の変化や状態を相談できるというのもこのサービスの価値の1つでもあると思う。相談してこういうストレッチするとよいですよというアドバイスをもらうだけでも安心した気持ちになるように感じた。</p>
<h2 id=設計ドキュメント修正>設計ドキュメント修正</h2>
<p><a href=/diary/posts/2021/1021/#設計ドキュメント作成>先日たたき台として作成したもの</a> を見直しながら手直したしたりしてた。資料を作ってから2-3日寝かせてから見返すと粗がみえたり不足している内容を思いついたりする。事前に資料を作って余裕があるときはよくそうやって洗練させている。リファクタリングをやるような感覚。カバー画像にあるスライドを追加した。自分の頭の中にあるイメージを図として具現化できると、それ自体を楽しい・嬉しいといったポジティブな感情に捉えられる。資料を作成していて頭の中にある情報をうまく整理できないときに苦痛やしんどさを感じる。言いたいことがあり過ぎたり曖昧だったりしてまとめられないことがある。その反対だから快ちよく感じるのかもしれない。</p>
<h2 id=ウォーキング>ウォーキング</h2>
<p>ジョギングしない日でもなるべく運動した方がいいかと思い始め、23時をまわってから歩くために出かけた。いまオフィスに着いてこれを書いている。19時頃に家に帰れば近所の公園へ行ってジョギングをする。21時をまわると晩ご飯を食べるのが遅くなってしまうから先に食べてしまって、くつろぐと面倒くさくなって外に出なくなる。あと夜遅くに公園で一人走るのも周りに人がいたらこわがられるんじゃないかと思ったりする。前に深夜2時に走りに行ったことがあるんだけど、最初は私1人しか走ってなかったのに途中でもう1人いるようになった。誰もいないと思って走ってて人がいるとなんかこわくなったので夜遅くに走るのはやめようと思った。ジョギングしなくても1時間ほど歩くだけでも健康にはよさそうだし、なるべく続けられるよう努めてみよう。</p>
<p>たまたま繁華街の付近を歩いてみたら、飲食店の営業時間制限が解除されていて、昔のように飲み歩くお客さんで賑わっていた。お店の中を覗くと繁盛しているお店もあれば、全然お客さんが入っていないお店もあった。完全にお客さんが戻ってくるのはちょっと時間がかかるのかな。いまは一時の休息のようなものなんだろうけど、コロナ禍で寂しかった街並みに活気が戻ったようでなんか気分がよかった。でも、狭い店舗でマスクせずに飲食しててまた感染者増えるんじゃないかと不安に思ったりもする。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1022/>睡眠不良</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-22
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/jira/>jira</a>&nbsp;
</span>
<div class=post-content>
<p>4時に寝て6時に起きた。朝活があると何時に寝ても6時に起きれる。終わってからやっぱり眠くなって1時間ほど寝てた。お昼の外出から戻ってきて雑務やってから、なんか集中できなくて15時から帰ってお昼ご飯食べて2-3時間寝てた。寝る時間帯がずれると生活のリズムが狂ってしまい、全体でみると生産性が落ちるように思えてきた。水と金だけ6時に起きるのをやめて毎日6時に起きるべきだと強く思うようになった。</p>
<h2 id=朝活>朝活</h2>
<p><a href=https://www.youtube.com/channel/UC1rVx0vAg66su1WvH3X-RJg>Webデザイントレンドのよりみち</a> の金朝ツメトギに参加した。今回から「つめとぎ」から「ツメトギ」のカタカナに名前変更してパワーアップ？したみたい。本を読んでもよかったんだけど、チャット欄でコメントしながら live をみてみようと思って普通に聴いていた。<a href="https://twitter.com/hashtag/%E9%87%91%E6%9C%9D%E3%83%84%E3%83%A1%E3%83%88%E3%82%AE?src=hashtag_click&f=live">#金朝ツメトギ</a> というハッシュタグは私がコメントして生まれた。コミュニティ的に盛り上げるならタイムラインを共有した方がよいとは思う。youtube live のチャットにコメントした方がいいか、twitter で気軽にコメントした方がいいか、まだよくわかってない。youtube のチャット欄のコメントの一覧性とか、普段使いのツールになっていないせいか、なんとなく抵抗感がある。いま参加者が少ないせいか、コメントするとスピーカーがコメントに反応して返答したりするので、あまりカジュアルに書き過ぎるとスピーカーの作業の邪魔にならないかな？とか思ったりもした。youtube live という勉強会の人間関係の距離感が難しい。</p>
<p>あと <a href=https://www.facebookconnect.com/ja-jp/>Facebook Connect 2021</a> というイベントがあることを教えてもらった。友だちに共有したら会社を休んで参加するとか言っているので私も参加してみることにした。どうしようか迷ってたけど、身近な人たちが参加するとつられるのかもしれない。</p>
<h2 id=法人県民税と法人市民税の中間申告と納付>法人県民税と法人市民税の中間申告と納付</h2>
<p>前日(というか今日)に4時まで起きてたのは申告書の内容確認や記入をしてたから。せっかく申告書を作成したのですぐ納付したくなった。それで新長田の合同庁舎まで申告に行ってきた。<a href=https://www.eltax.lta.go.jp/>eltax</a> は相変わらず windows 向けの DL 版でないと申告できそうにない。WEB 版もあって一部対応しているようだけど、よくよく調べていくと DL 版でしかできないようにみえる。毎年 WEB 版でできるようになっているかどうかを調べている。この互換性を調べるような作業を都度やるのが面倒になってきた。vr 用途 (oculus link を使いたい) にも使えるので windows マシンを購入してもいいかもしれないと考えるようになってきた。申告書を郵送してもよいけど、1時間もあれば往復できる距離なので気分転換も兼ねて合同庁舎に出向いてきた。</p>
<p>帰りに新長田駅の近くの三菱UFJ銀行の支店で納付する。前回は窓口納付をしたが、今回は STM (Store Teller Machine) での納付に初挑戦した。<a href=https://life-is-miracle-wind.blog.jp/archives/22922687.html>STM(Store Teller Machine)の存在意義とは</a> のブログ記事にも書かれている通り、納付書を OCR でスキャンすることでどんな納付書でも対応できるという汎用性はすごいと思うものの、その裏で人間がチェックしているんじゃないかと思えるメッセージや引き落とす合計金額はユーザーが手入力で決定する (OCR で合計がどの金額かわからなかった場合のみ？) といったオペレーションになっていて、なんか全く自動化されてない感があって残念に思った。見た目上、機械化されているけど、運用には人手がかかっているようにみえた。まぁでも、初めて使ってみて経験としてはおもしろかった。</p>
<h2 id=jira-のフィルターとリマインダー>Jira のフィルターとリマインダー</h2>
<p>所得税や住民税の納付は原則毎月納付する必要があるけど、小さい企業は納付の特例という制度があって6ヶ月単位にまとめて納付できる。小さい企業の事務手続きの工数削減を狙いとしてある制度だと思う。うちもその特例制度を利用して6ヶ月ごとに納付している。カレンダーに繰り返し予定として登録してあるのでカレンダーをみていれば見落とすことはないのだけど、そのときに都度チケットを作ってやるのも面倒なので納付の親チケットを作っておいて、子タスクとして毎回作業するようにしている。それをみていて、納付期限を設定しておいてリマインダーしたら課題管理システムっぽくていいなと思って Jira でのやり方を調べてみた。<a href=https://community.atlassian.com/t5/Jira-articles/Jira%E3%81%AB%E3%81%A6%E6%9C%9F%E9%99%90%E3%81%AE%E8%BF%91%E3%81%84%E8%AA%B2%E9%A1%8C%E3%81%AE%E9%80%9A%E7%9F%A5%E3%82%92%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8A%E3%81%9F%E3%81%84/ba-p/770716>Jiraにて期限の近い課題の通知を受け取りたい</a> というのがあって、任意の JQL で期限を調べるフィルターを書いて、そのフィルターに対してサブスクリプションというメール配信設定を行う仕組みになっている。これはこれでよくできたうまい仕組みだと思う。しかし、いまチケットのイベントに対してメールを送る設定は無効にしていて、Slack インテグレーションを使ってすべて Slack の通知チャンネルにイベントを流すようにしている。できれば、Slack インテグレーションで期限のリマインダーを通知できるのが望ましいた。公式の <a href=https://www.atlassian.com/partnerships/slack>Jira Slack app</a> だと、JQL でフィルターはできるけど、イベント発生時に通知する仕組みなので毎週フィルター実行するような用途には使えない。</p>
<p>たまたまそんな話しをツィートしてたら Jira API と Slack API を使ってスクリプトを書いているというのを教えてもらった。これはこれで便利そう。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>こんな感じのスクリプトでJIRAからslackに通知してます <a href=https://t.co/UzeIZ9Nbol>https://t.co/UzeIZ9Nbol</a></p>&mdash; Takanori Suzuki (@takanory) <a href="https://twitter.com/takanory/status/1451572269768003589?ref_src=twsrc%5Etfw">October 22, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1021/>読書はお休み2日目</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-21
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/slack/>slack</a>&nbsp;
#<a href=/diary/tags/writing/>writing</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て7時に起きた。昨日は寝不足だったせいかぐっすり眠れた。</p>
<h2 id=設計ドキュメント作成>設計ドキュメント作成</h2>
<p>昨日の続き。着手すると徐々に興が乗ってくる。朝からずっとやり続けて17時ぐらいに一通りたたき台ができた。なぜか朝ご飯もお昼ご飯も食べずに資料を作り続けてた。お腹もあまりすかなかった。経緯や背景、設計の意図やシステム構成、展望やビジネス戦略など、スライドで39枚になった。顧問さんに情報共有するための資料なんだけど、自分一人の会社で自分一人で開発するのに2日もかけて資料作る必要あるのだろうかと考える人も多いと思う。この資料に書いた内容はすべて課題管理システム上のチケットのどこかに書いてあることなので、私の視点からは全部知っている内容ではある。ちょうど100を超えたばかりのチケット上のどこかに書いてあることを、39枚のスライドにまとめて今日の時点でのスナップショットを作るというのは思考の整理に役立っている。去年はそういうことをやらなかったので何かうまくいかなくなったのを <a href=https://note.com/t2y1979/n/n84deed5fd934>リモートワークと相談相手</a> に書いた。今年はうまくいってないという感覚がないので気持ちに余裕がある。気持ちに余裕があるから新しい施策やアイディアに集中できているように考えている。</p>
<h2 id=ジョギング>ジョギング</h2>
<p>資料できたのが嬉しくて気分がよかったのでそのまま帰ってジョギングしてきた。今週初めて。19時までに帰ってくると行く気するんだけど、それよりも遅く帰ってくるとお腹空いて晩ご飯を先に食べてしまい、晩ご飯を食べると走りに行く気力がなくなってしまう。前に軽く調べたら健康的には食べる前に走った方がよいみたい。<a href=/diary/posts/2021/1014/#ジョギング>先週とだいたい同じ時間帯に行った</a> んやけど、陸上部の人たちが減ってて走りやすかった。曜日じゃなくて何か別のサイクルがあるのかな。ちょっと寒いぐらいだから走っててもあまり汗も書かないし、走った後にストレッチするのも汗だくにはならない。</p>
<h2 id=slack-community>Slack Community</h2>
<p><a href=https://qiita.com/seratch/items/d67f36d0ff7dfaadcc3b#slack-community-%E6%97%A7-slack-platform-community>Slack Community</a> というのがあるのをみかけたので参加してみた。これからしばらく Slack apps についてがっつり調べていく予定。困ったときに相談できるように。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1020/>読書はお休み</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-20
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/slack/>slack</a>&nbsp;
#<a href=/diary/tags/xr/>xr</a>&nbsp;
</span>
<div class=post-content>
<p>4-5時に6時に起きた。寝られなかったというよりは寝る気がなくて3時頃にお茶を沸かして冷ましたりしてた。6時から <a href=https://kobe-sannomiya-dev.connpass.com/event/228152/>【三宮.dev オンライン】リモート朝活もくもく会</a> に参加してメンバーと雑談してた。もはや朝活というよりは雑談会になっているw 普通に起きたら7時まわってから起きるのが、イベントがあると6時に起きれるのでそれはそれで早起きするモチベーションになっていいかとは思っている。とはいえ、お昼やっぱり眠くなって1時間ほど昼寝した。昨日あまり寝てなかったら夜も集中力なくなってバテた。</p>
<h2 id=slack-apps-の調査>Slack apps の調査</h2>
<p>日記に書くの忘れてた。さらに3つのアプリを試してみた。</p>
<p><a href=https://www.thetodobot.com/>ToDoBot</a></p>
<blockquote>
<p>Task Management App for Slack</p>
</blockquote>
<p>これは基本的には個人向けのタスク管理ツール。タスクをグルーピングする機能をもっているのでそれを共有することでチーム単位でも使えるとは思うけど、あまりチーム向けに機能が用意されているようにはみえない。</p>
<p><a href=https://www.getsidequest.app/>Sidequest</a></p>
<blockquote>
<p>Meet the Missing Task Manager for Slack.</p>
</blockquote>
<p>個人/グループのタスク管理とチームでタスクを共有する用途にも機能が提供されている。タスクを作る際にチャンネルに作成すると、そのチャンネルにいるユーザーが確認して適切な人を担当者として割り当てるといった運用になる。タスク作成からの導線と担当者を割り当てる UI が自然な流れになっていてよさそうに思えた。課題管理システムの代わりにはならないけど、ヘルプデスクの用途にはちょうどよさそうにみえる。</p>
<p><a href=https://happybara.io/apps/streamly/>Streamly</a></p>
<blockquote>
<p>A complete task management suite in Slack</p>
</blockquote>
<p>目指しているものは課題管理システムではあるけど、Stream (プロジェクト)、Request (チケット) といった新しい名前 (概念) を導入しているので、まず用語からして学習コストが上がる。プロジェクトはチャンネルごとに設定して、Request の接頭辞やカスタムフィールドも設定できるようになっていて、課題管理システムを目指しているんだなという雰囲気はする。UI は Slack のフォームを使っているので1つ1つの操作が API 呼び出しになって操作量やフォーム入力が増えてあまり使いやすくは感じなかった。同じような操作を何度もさせられるといった印象を受ける。</p>
<p>一旦、これで Slack apps で適当に検索した課題管理システムに近いツールの調査を終える。1-2時間さらっと表面的なところしか触ってないけど、どれもプロダクション品質になっているのだから、内部はよく作り込まれているんだと推測する。</p>
<h2 id=設計ドキュメント着手>設計ドキュメント着手</h2>
<p>課題管理システムの設計を資料にまとめ始めた。先週ぐらいからチケットに設計の要素を書き始めてだいたいのイメージは頭の中では固まっている。これまで3ヶ月調べた内容もあるのでそれなりの背景をもった設計資料にはなる。頭の中のイメージはできているけど、それを言語化する作業を今日・明日ぐらいでやりたい。書くことの難しいところはいざ言語化しようとするとやっぱり時間がかかる。たぶんわかった気になって本当のところはちゃんと分かってないことの裏返しだと思う。</p>
<h2 id=vr-イベント参加>VR イベント参加</h2>
<p><a href=https://osaka-driven-dev.connpass.com/event/226481/>【大阪オンライン】XRミーティング 2021/10/20【AR/CR/MR/SR/VR】</a> に参加した。zoom を複数地域と接続して youtube live で配信していたせいか、始まるまで時間がかかった。参加者のアバターがそれぞれ独自のものでかっこいいなと思って眺めてた。登壇者が5名いて全員が HoloLens を使っていた。電話してたり調べものしてたりしたので断片的にみていた。長めの発表と LT のような短い発表とバラバラ。適当に所感を書いていく。HoloLens の Moving Platform Mode の紹介はあまり見た目は派手ではなかったけど、どういう仕組みかを説明して動画で実際の振る舞いを説明してた。へーって感じで聞いていた。次に HoloLens 触ってはまって20年働いた会社をやめて VR 系の会社に転職した人。前職が大企業だったので給料もだいぶ下がったけど、家族を説得したらしい。給与以上に HoloLens の将来性を感じたとのこと。HoloLens で OpenCV や Azure Face API を使って顔認識するアプリケーションの紹介してた。おもしろそうだった。最後は HoloLens のアプリ開発の発表だった。Microsoft が Mixed Reality Tool Kit というライブラリを提供していて、クラウスプラットフォームで開発できる。ライブラリの Plane Finding という機能を紹介してた。空間の平面だしをする部品。水平面や垂直面を抽出したりできる。この機能を使ってアプリケーション開発のサンプルなどの話をしてた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1019/>改正法人税法等の説明会</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-19
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
</span>
<img src=/diary/img/2021/1019_water-spout.jpg class=post-cover alt=改正法人税法等の説明会>
<div class=post-content>
<p>0-1時ぐらいに寝て7時半に起きた。よく眠れたか眠れてないかもわからないような目覚め方をして少しぼおっとしてた。朝ゆっくりしてもいいかと思いつつ準備して移動したら9時前にはオフィスにいたので普通の日とそう変わらない一日の始めだった。夜にジョギング行こうかと思ってたけど、ちょうど通り雨が降ったりやんだりしててやめた。代わりに雨やんでからオフィス行って調べてものしてた。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>7.3を読んで7章トランザクションを読み終えた。トランザクションの章は言葉も知らないし、あまりクリティカルなアプリケーションの開発に関わってこなかったのでそこまで意識したことがなかった。トランザクションで問題が発生する分離レベルと典型的なパターンが体系的に整理されていてすごく勉強になった。結果的にトランザクションを使わないとしても、トランザクションの要否や起きうる整合性の問題を理解しておくとデータ定義やアプリケーションの設計にも活かせる気がする。7章まで読んだ中でもっとも知らないことが多かった。約300ページなのでだいたい半分読み終えた。まだまだ先は長い。</p>
<p>トランザクションの開始時点でロックをかけるべきオブジェクトが存在せず、あるトランザクションでの書き込みが他のトランザクションの検索クエリの結果を変化させてしまう問題を <strong>ファントム</strong> と呼ぶ。ファントムの対策の1つとして、あらかじめそのデータを作っておき <code>SELECT FOR UPDATE</code> でロックを取得するやり方を <strong>衝突の実体化 (materializing conflicts)</strong> と呼ぶらしい。グループウェアの開発をしていた頃、1つのスレッドしかトランザクションを実行できないことを保証するための切り札として、ロック用途のテーブルを設けておき、そのロックを獲得したスレッドだけ処理できるようにしていた。当時はわからなかったけど、あれは衝突の実体化という手法だったんだといま気付いた。</p>
<blockquote>
<p>データベースのクラッシュや整合性に関する問題に対する信頼性を保つために、それらの問題を単純化するために、この数十年にわたって選択されてきた仕組みが <strong>トランザクション</strong> である。トランザクションは、アプリケーションが複数の読み書きを論理的な単位としてまとめる方法である。概念的には、トランザクション中のすべての読み書きは1つの操作として実行される。トランザクションは抽象化のレイヤーであり、アプリケーションはある種の並行性の問題や、ある種のハードウェアやソフトウェアの問題が存在しないかのように振る舞えるようになる。</p>
<p>トランザクションは全体として成功（ <strong>コミット（commit）</strong> ）もしくは失敗（ <strong>中断（abort）</strong> 、 <strong>ロールバック（rollback）</strong> ）する。トランザクションが失敗した場合には、アプリケーションは安全にリトライできる。トランザクションは自然法則ではなく、データベースにアクセスするアプリケーションのためのプログラミングモデルをシンプルにするという目的を持って生み出された。トランザクションを利用すれば、ある種の潜在的なエラーの状況や並行性の問題はデータベースが面倒を見てくれるので、アプリケーションはそれらを気にしなくてよくなる（このことは <strong>安全性の保証</strong> と呼ばれる）。</p>
<p>トランザクションが提供する安全性の保証は <strong>ACID</strong> で示される。</p>
<h5 id=原子性-atomicity>原子性 (Atomicity)</h5>
<ul>
<li><strong>原子（アトミック）</strong> はそれ以上小さな部分に分割できないものを指して使われる言葉</li>
<li>マルチスレッドのプログラミングにおいては、あるスレッドがアトミックな処理を実行しているというなら、それは他のスレッドからはその処理の半分だけ完了した途中の状態を見る方法が存在しないことを意味する。システムが取りえる状態は、その処理が始まる前と終わった後の状態だけであり、その中間の状態になることはない
<ul>
<li>前にメモリモデルの文脈で、あるプロセスが書き込み完了したデータが、他のプロセスからも確実に読めることをアトミックな操作と習ったことがある</li>
</ul>
</li>
<li>原子性と並行性は関係がない</li>
<li>エラーの際にトランザクションを中断し、そのトランザクションのすべての書き込みを破棄できることが、 ACID の原子性を決定づける特徴と言える
<ul>
<li>アプリケーションがリトライしても安全であることを保証する</li>
<li><strong>中断可能性（abortability）</strong> の方が原子性よりも良い言葉だったと思われる</li>
</ul>
</li>
</ul>
<h4 id=一貫性-consistency>一貫性 (Consistency)</h4>
<ul>
<li>一貫性は多くの意味で使われる
<ul>
<li>とくに日本語では整合性とも訳される</li>
</ul>
</li>
<li>非同期のレプリケーションシステムでは結果整合性の問題が発生する (5章)</li>
<li>コンシステントハッシュ法は、リバランシングのためにいくつかのシステムで利用されているパーティショニングのアプローチ</li>
<li>CAP 定理では、一貫性という言葉は線形化可能性の意味で使われる (9章)</li>
<li>ACID の文脈における一貫性は、データベースが「良い状態」にあることを示すアプリケーション固有の概念を指す</li>
</ul>
<p>同じ言葉を少なくとも4つの異なる意味で使われている。ACID における一貫性という概念は、データについて常に真でなければならない何らかの言明（ <strong>不変性</strong> ）があることを指す。たとえば、会計システムの場合、すべてのアカウントでまとめれば常に貸方と借方は等しくならなければならない。この一貫性の概念はアプリケーション固有の不変性の概念に依存しており、一貫性を保つようにトランザクションを適切に定義することはアプリケーションの責任となる。原子性、分離性、永続性はデータベースの特性だが、一貫性は（ ACID という考え方においては）アプリケーションの特性である。したがって、 C は実際には ACID に属していない。</p>
<h4 id=分離性-isolation>分離性 (Isolation)</h4>
<p>多くのデータベースは、同時に複数のクライアントからアクセスされる。データベース中の同じレコードにアクセスするときに並行性の問題（レース条件［ race condition ］）が生じる可能性がある。データベース中に保存されているカウンタを、2つのクライアントが同時にインクリメントすると仮定する。それぞれのクライアントは現在の値を読み取り、1を加え、新しい値を書き戻す。ACID における分離性とは、並行して実行されたトランザクションがお互いから分離されており、お互いのつま先を踏みつけあうようなことがないという意味である。実際の運用では、パフォーマンスの制約から分離レベルによって保証される分離性が変わってくる。</p>
<h4 id=永続性-durability>永続性 (Durability)</h4>
<p>データベースシステムが目的とするのは、データを失う恐れなく保存できる安全な場所を提供すること。永続性は、トランザクションのコミットが成功したら、仮にハードウェアの障害やデータベースのクラッシュがあったとしても、そのトランザクションで書き込まれたすべてのデータは失われないことを約束する。</p>
<h4 id=用語の整理>用語の整理</h4>
<p>トランザクションはデータモデルがどういったものであるかにかかわらず、価値あるデータベースの機能と言える。並行に実行されたトランザクションがお互いに影響しあわない分離性における保証を <strong>分離レベル</strong> と呼ぶ。</p>
<ul>
<li>read committed</li>
<li>スナップショット分離（repeatable read とも呼ばれる）</li>
<li>直列化可能</li>
</ul>
<p>これらの分離レベルに対してトランザクションで発生する様々なレース条件がある。</p>
<ul>
<li>ダーティリード
<ul>
<li>あるクライアントが他のクライアントのまだコミットされていない書き込みを読める</li>
<li>read committed 分離レベル及びそれ以上に強い分離レベルはダーティリードは生じない</li>
</ul>
</li>
<li>ダーティライト
<ul>
<li>あるクライアントが他のクライアントによるまだコミットされていない書き込みの内容を上書きしてしまう</li>
<li>ほぼすべてのトランザクションの実装は、ダーティライトを生じない</li>
</ul>
</li>
<li>読み取りスキュー（nonrepeatable read）
<ul>
<li>クライアントが異なる時刻にデータベースの異なる部分を見ること</li>
<li>この問題の最も一般的な回避策はスナップショット分離によるもので、これはトランザクションがある時点での一貫したスナップショットから読み取りを行えるようにする</li>
<li>通常、MVCC（multi-version concurrency control）を利用して実装される</li>
</ul>
</li>
<li>更新のロスト
<ul>
<li>2つのクライアントが並行して read-modify-write サイクルを実行するとき、片方が他方の書き込みをその変更内容を考慮せずに上書きしてしまい、データが失われること</li>
<li>スナップショット分離レベルの実装にはこの異常を自動的に回避してくれるものもあるが、明示的なロック（ SELECT FOR UPDATE ）をしなければならない実装もある</li>
</ul>
</li>
<li>書き込みスキュー
<ul>
<li>トランザクションが何かを読み取り、その値に基づいて判断を下し、その結果をデータベースに書き込む</li>
<li>この状況で、書き込みが行われた時点で判断の根拠となったプレミスが真ではなくなっている場合を指す</li>
<li>直列化可能分離レベルのみがこの異常を回避できる</li>
</ul>
</li>
<li>ファントムリード
<ul>
<li>トランザクションが何らかの検索条件にマッチするオブジェクトを読み取り、他のクライアントはその検索結果に影響する書き込みを行う</li>
<li>スナップショット分離レベルは単純なファントムリードを回避してくれるが、書き込みスキューを伴うファントムに対してはインデックス範囲ロックのような特別な対応が必要となる</li>
</ul>
</li>
</ul>
<p>弱い分離レベルは、これらの異常のいくつかを防いでくれるが、それ以外はアプリケーション開発者に対処する必要がある（たとえば明示的なロックなど）。すべての問題に対する保護を提供してくれるのは直列化可能分離レベルのみ。直列化可能なトランザクションの実装方法は、3 種類ある。</p>
<ul>
<li>トランザクションを順次実行する
<ul>
<li>それぞれのトランザクションをきわめて高速に実行でき、加えて単一の CPU コアで十分処理できる程度にトランザクションのスループットが低いのであれば、これはシンプルで効果的な選択肢となる</li>
</ul>
</li>
<li>ツーフェーズロック
<ul>
<li>数十年にわたって直列化可能分離レベルの実装において標準的な方法であった</li>
<li>パフォーマンス上の特性から多くのアプリケーションがツーフェーズロックの利用は避けている</li>
</ul>
</li>
<li>直列化可能スナップショット分離（SSI、serializable snapshot isolation）
<ul>
<li>新しいアルゴリズムであり、これまでのアプローチが持つ欠点のほとんどを回避している</li>
<li>SSI は楽観的アプローチを取っており、トランザクションはブロックされることなく処理を進められる</li>
<li>トランザクションはコミットの時点でチェックされ、その実行が直列化可能になっていなければ中断される</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id=改正法人税法等の説明会>改正法人税法等の説明会</h2>
<p><a href=https://www.nk-net.co.jp/kobe/assets/files/schedule/2021/211019.pdf>改正法人税法等の説明会</a> に参加してきた。所感からまとめるとこんな感じ。</p>
<ul>
<li>神戸文化ホールについて
<ul>
<li>電源がない</li>
<li>FREESPOT が提供されていてフリー wifi として利用できるが、通信品質は不安定
<ul>
<li>スマホでテザリングもやってみたが、電波状態がよくなくてもっと不安定</li>
</ul>
</li>
<li>ラップトップ向きの場所ではない</li>
</ul>
</li>
<li>税制を身近にするイベントとしては参加してもよい</li>
<li>もらった資料をたんたんと説明するだけなのでイベントに参加することで得られる付加価値はとくにない</li>
<li>気分転換や時間があれば参加すればいい、忙しかったら参加しなくてもよさそう</li>
</ul>
<p><a href=https://www.nk-net.co.jp/kobe/index.html>公益社団法人 神戸納税協会</a> という組織がある。年会費 (うちの会社だと7,800円) がいるのでいまは入らないけど、無料税務相談があるので余裕ができたら困ったときの相談相手になってもらう意図で入会してもよいかもしれない。冒頭の神戸税務署長の挨拶で法人税の申告における e-tax の利用率は 88.4% だと話してた。うちは紙で申請しているので意外とみんな e-tax 使っているんだなと自社を恥じた。だって Windows マシンないとできへんねんもん。参加したことによる学びとして書いていくとこれらかな。</p>
<ul>
<li>「研究開発費」は会計上の用語、「試験研究費」は税法上の用語</li>
<li>DX 投資促進税制の創設</li>
</ul>
<p>内容は基本知らないことなので、知らないことに触れるイベントという点では斬新ではあった。ほうほうと聞いてただけなんだけど。直接うちの会社に影響を与える税法の改正はインボイス制度ぐらいかな。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1018/>とくに何もない一日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-18
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/gig/>gig</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>いつ寝たのか覚えてないけど、スマホをみたら1時過ぎに寝て6時に起きたことになっている。だいたいいつも5-6時には一度目が覚める。そのまま起きるときもあれば起きないときもある。今日はちゃんと起き上がったのは7-8時ぐらいだった気がする。夜にジョギング行こうかとも考えていただけど、帰って先に晩ご飯食べたら疲れてそのままだらだらしてた。</p>
<h2 id=エージェント面談>エージェント面談</h2>
<p>そろそろ次のお仕事を探す準備のために <a href=https://www.engineer-factory.com/>エンジニアファクトリー</a> というサービスに登録してみた。<a href=https://www.city.kobe.lg.jp/life/livelihood/kobejobport/index.html>KOBE JOB PORT</a> で紹介されていたのをみつけた。<a href=/diary/posts/2021/0930/#カジュアル面談準備>前に Remogu さんで探していた</a> ように、プロジェクトマネージャー案件か、リモートワークの開発者案件を探している。マネージャーだと常駐系の方が多かったり、実務経験必須だったりすることが多いため、神戸から通える範囲の案件も探してみようという意図になる。だいたいこんな内容を話してた。</p>
<ul>
<li>職務経歴の内容から個人を特定できないよう、エージェントがブラインド化した資料を企業に公開する</li>
<li>単価が高い案件は東京の会社のリモートワークに多い</li>
<li>契約は準委任契約がほとんどである</li>
<li>法人として契約もできる</li>
<li>6ヶ月や1年といった短期開発案件も多い</li>
</ul>
<p>求職者の情報を匿名化する背景は、企業が直接交渉するのを避けるためなのかな？求人プラットフォームごとに情報入力しないといけないのが面倒なところ。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>7章トランザクションのうち、7.1と7.2を読んだ。トランザクションの章は内容も難しく量も多いので2日にかけて読むことにする。昔、業務アプリケーションやグループウェアを開発していたときはトランザクションを意識してコードを書いていたけど、Web アプリケーションを開発していると、あまりクリティカルな処理を実装することが少ないせいか、トランザクションをそんな意識しなくなったなと漠然と思えた。Cassandra だとトランザクションもないし。非同期 + 結果整合性で運用できるアプリケーションであればトランザクションいらないというのはそうなのかもしれない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1017/>豆苗再生</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-17
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/food/>food</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>3時に寝て8時半に起きた。夜眠れなくて、野菜サラダに目玉焼きをのせて食べたり、お茶をわかしてボトルに入れ替えたりしてた。休日だと時間に余裕があるせいか、空き時間に自炊してなにか作ることが多い。</p>
<h2 id=豆苗の再生栽培>豆苗の再生栽培</h2>
<p>朝ご飯は野菜サラダと納豆を、お昼ご飯は豚肉としめじと2回目の豆苗を炒めたものを目玉焼きでとじたものを食べた。豆苗のパッケージに食べた後の根を水に浸しておけばまた生えてくるとあったので試しにやってみた。キッチンという日当たりのよくない場所で育てたせいか、薄い緑色の苗が生えてきた。</p>
<p><figure><img src=/diary/img/2021/1017_pea-sprout1.jpg alt=水に浸して2日目><figcaption>
<p>水に浸して2日目</p>
</figcaption>
</figure>
<figure><img src=/diary/img/2021/1017_pea-sprout2.jpg alt=水に浸して6日目><figcaption>
<p>水に浸して6日目</p>
</figcaption>
</figure>
</p>
<p>今回は適当に育てた。<a href=https://www.murakamifarm.com/myouken/grow/technique/#where>再生栽培のコツ</a> を読んで次はもうちょっとちゃんと育ててみよう。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>6章パーティショニングを読んだ。昔からパーティショニングとシャーディングの違いはなんだろう？と漠然と思っていた。<a href=https://docs.microsoft.com/ja-jp/azure/architecture/best-practices/data-partitioning#designing-partitions>パーティションの設計</a> を読むと、3つのパーティション分割があげられている。</p>
<ul>
<li>水平的パーティション分割 (シャーディング)</li>
<li>列方向のパーティション分割</li>
<li>機能的パーティション分割</li>
</ul>
<p>パーティショニングは大規模なデータセットをデータ分割するための手法または概念として広い意味をもって使われるように読める。一方でシャーディングと呼ばれるものは水平パーティショニングのことを指している。いま分散データベースで一般的に使われている仕組みがそうなのかもしれない。本書では水平・垂直のパーティショニングの定義は行われていないが、次の説明が出てくる。おそらく主に水平パーティショニングを意図しているのではないかと思う。まとめはこんな感じ。</p>
<blockquote>
<p>用語の混乱</p>
<p>ここで パーティション と呼んでいるものは、 MongoDB 、 Elasticsearch 、 SolrCloud では <strong>シャード</strong> と呼ばれています。これは HBase では <strong>リージョン</strong> 、 Bigtable では <strong>タブレット</strong> 、Cassandra や Riak では <strong>vnode</strong> 、 Couchbase では <strong>vBucket</strong> と呼ばれています。とはいえ最も確立されている用語は <strong>パーティショニング</strong> なので、本書ではこの呼び方を使っていきます。</p>
</blockquote>
<p>パーティショニングも普通に開発をしていたらデータベースの設計で必要になるので身近な概念と言える。だいたいは知っている内容ではあったけど、パーティショニングとセカンダリインデックスの仕組みとか考えたことがなかった。Cassandra ではセカンダリインデックスをうまく設計しないとパフォーマンスに影響を与えることからあまり使われない傾向にあると思う。</p>
<blockquote>
<p>大規模なデータセットを小さな部分集合にデータ分割することをパーティショニングと呼ぶ。パーティショニングが必要になるのは、単一のマシンで保存や処理をするのが現実的ではないほどのデータがある場合になる。パーティショニングが目標とするのは、データやクエリの負荷を複数のマシン間で均等に分配し、<strong>ホットスポット</strong>（不均衡に高い負荷がかかるノード）が生じないようにすること。パーティショニングが均等になっておらず、一部のパーティションが他に比べて多くのデータやクエリを受け持っているような状態は <strong>スキュー（skew）</strong> と呼ばれる。そのためには、データに適したパーティショニングのスキームを選択し、クラスタへのノードの追加やクラスタからのノードの削除が生じたときにパーティション群をリバランシングする。</p>
<p>パーティショニングのアプローチとして主に2つがある。</p>
<ul>
<li><strong>キーの範囲によるパーティショニング</strong>
<ul>
<li>キーはソートされ、1つのパーティションには何らかの最小値と最大値の間にあるすべてのキーが保存される</li>
<li>キーをソートすることで、範囲に対するクエリが効率的に処理できるというメリットがある</li>
<li>アプリケーションが頻繁にアクセスするキーがソート順の中で近接していると、ホットスポットが生じるリスクがある</li>
<li>通常このアプローチでは、パーティションのリバランシングはパーティションが大きくなりすぎたときにその範囲を2つに分割することによって動的に行われる</li>
</ul>
</li>
<li><strong>ハッシュパーティショニング</strong>
<ul>
<li>ハッシュ関数がそれぞれのキーに対して適用され、1つのパーティションにはハッシュの一定の範囲を保存される</li>
<li>この方法ではキーの順序が失われるので範囲に対するクエリは非効率になるが、負荷分散より均等にしやすい</li>
<li>ハッシュによってパーティショニングを行う場合は、事前に固定数のパーティションを作成し、各ノードに複数のパーティションを割り当てておき、ノードの追加や削除が行われた場合にはパーティションをそのままあるノードから他のノードに移動させるのが一般的となる。また、動的パーティショニングも利用できる</li>
</ul>
</li>
</ul>
<p>ハイブリッドなアプローチを取ることもできる。たとえば複合キーを使い、キーの一部でパーティションを決め、他の部分でソート順を決めるといったやり方がある。Cassandra のプライマリーキーはこのアプローチを採用している。また、セカンダリインデックスもパーティショニングする方法が2つある。</p>
<ul>
<li><strong>ドキュメントによってパーティショニングされたインデックス（ローカルインデックス）</strong>
<ul>
<li>セカンダリインデックスをプライマリキー及び値と同じパーティションに保存する</li>
<li>書き込みの際に更新しなければならないパーティションが1つですむ</li>
<li>セカンダリインデックスの読み取りにはすべてのパーティションに対する <strong>スキャッタ/ギャザー</strong> が必要となる</li>
</ul>
</li>
<li><strong>語によってパーティショニングされたインデックス（グローバルインデックス）</strong>
<ul>
<li>セカンダリインデックスはインデックスが張られた値を使って独立にパーティショニングされる</li>
<li>セカンダリインデックスのエントリには、プライマリキーのあらゆるパーティションのレコード群が含まれる</li>
<li>ドキュメントが書き込まれる際には、セカンダリインデックスの複数のパーティションを更新しなければならない</li>
<li>読み取りは単一のパーティションだけで処理できる</li>
</ul>
</li>
</ul>
<p>クエリを適切なパーティションにルーティングする手法は、データベースに限った話題ではなく、<strong>サービスディスカバリ</strong> と呼ばれる一般的な問題である。有名な OSS として <a href=https://zookeeper.apache.org/>ZooKeeper</a> がある。これにはシンプルなパーティションを認識するロードバランシングから、洗練された並列クエリ実行エンジンまで様々である。すべてのパーティションは、ほぼ独立に動作できるように設計されている。パーティショニングされたデータベースが複数のマシンにまでスケールできるのはそのおかげである。</p>
</blockquote>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1016/>閃光のハサウェイ見直し</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-16
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/xr/>xr</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
</span>
<div class=post-content>
<p>2時に寝て6時半に起きた。連日ジョギングして体を動かしたせいか、よく眠れて体調がよい気がした。<a href="http://gundam-hathaway.net/news.php?id=19157">機動戦士ガンダム 閃光のハサウェイ</a> が今日からオンライン配信を開始した。私は載っているどの動画配信プラットフォームも使ってないが、iTunes Store で普通に購入できるようになっているのに気付いた。昨日の夜は閃光のハサウェイをみながら寝落ちしたので朝起きてから途中から見直した。映画館でみてたけど、戦闘のシーンは暗くてよくわからなかったので何回かみた方が発見もあるかもしれない。市街地の降ってくる炎を避けて逃げるシーンが好き。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>一昨日、昨日と連日でジョギングしたせいか、右股関節からお尻と右ももにかけて筋肉痛で張りがあった。そのせいかもしれないけど、今日の開脚幅は開始前168cmで、ストレッチ後170cmだった。先週とほぼ変わらないので股関節の可動域は現状維持だった。それでもトレーナーさんに筋肉痛だったところをストレッチしてもらってかなり楽になった。ジョギングして痛くなる内容が、最近は関節の痛みから筋肉の張りになっている気がしてこれはよい傾向かもしれない。前は腰にも負担がきていたけど、それも少しましになった。今日は可もなく不可もなくといったところか。</p>
<h2 id=vr-イベント参加>VR イベント参加</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/225590/>【三宮.dev オンライン】３周年記念交流会</a> に参加した。<a href=https://cluster.mu/>cluster</a> のイベントを開いた。Oculus Quest で VR 参加できるのは Windows 向けのアプリだけっぽく macOS では VR 参加できなかった。</p>
<p>オープンなイベントとして開催したので誰でも参加することができて、途中で子どもが入ってきて参加者に無邪気に質問して微笑ましいカオスをもたらしていた。大人はよく知らないイベントに入って、なんの前提知識もなく参加者に話しかけたりしないだろう。そういうやり取りをみていて、子どものときから VR 空間でいろんな人と接すると子どもたちはどんな大人になるんだろう？私では想像もつかないイノベーションを起こすんだろうな。</p>
<p>1.5年前に1度だけ macOS のアプリで cluster イベント参加したことがあった。アプリは3回ぐらい落ちて不安定なので途中で Web でみたりしてた。そのときに比べたら今日は1度も落ちなかったので安定していた。参加者数の違いによるものかもしれないけど。前回から1.5年も経っているのに機能的なものは何も変わってないようにみえてあんまり流行ってないのかな？とも思えた。</p>
<p>参加者にたぬきのアバターがいて「たぬきさん、いますね」みたいな感じで和んでた。動物のアバターいいなと思って、カスタムアバターに興味がでた。<a href=https://vroid.com/en/studio>VRoidStudio</a> を使えば作れるらしい。また <a href=https://reality.app/>REALITY</a> で作ったアバターを cluster で <a href=https://clusterhelp.zendesk.com/hc/ja/articles/360044037491-REALITY-%E9%80%A3%E6%90%BA%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6>REALITY 連携</a> して使うこともできるらしい。<a href=https://www.oculus.com/blog/new-day-new-you-avatars-are-more-expressive-and-customizable-starting-today/>Oculus ブログの記事</a> をみてたら Oculus は Oculus で独自のアバターの仕組みになるのかな。外部のツールで作ったカスタムアバターを持ち込めるようにはみえない。</p>
<h2 id=slack-apps-の調査>Slack apps の調査</h2>
<p><a href=https://www.wrangle.io/>Wrangle</a> を試してみた。</p>
<blockquote>
<p>Approval and Ticketing Workflows in Slack</p>
</blockquote>
<p>3つの機能をもっている。</p>
<ul>
<li>ちょっとした ToDo リスト管理</li>
<li>承認依頼を管理</li>
<li>ステップと承認のワークフローを管理</li>
</ul>
<p>とくに SaaS 型の Web アプリケーションもなく Slack app 単体で完結するアプリケーションにみえる。組織として承認履歴を残したいといったときにチャットツール上でワークフローを定義してちゃちゃっとできるといったところが売りなのではないかと推測する。課題管理として使うアプリケーションではなかった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1015/>日本酒いただきもの</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-15
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
</span>
<img src=/diary/img/2021/1015_sake.jpg class=post-cover alt=日本酒いただきもの>
<div class=post-content>
<p>0時に寝て6時に起きた。だいたい夜中に2-3回は起きるのが普通になりつつあって、前日ジョギングしてたせいか腰やお尻の筋肉に張りがあったので3時頃起きてストレッチして張りの箇所を伸ばしたりしながら寝てた。午前中、いけさんから上等なお酒をいただいた。造り酒屋の一族らしい。感謝。</p>
<h2 id=朝活>朝活</h2>
<p>朝起きる目的にいいかも？と思って <a href=https://www.youtube.com/channel/UC1rVx0vAg66su1WvH3X-RJg>Webデザイントレンドのよりみち</a> の金朝つめとぎに参加してみた。やっぱり目的があれば6時に起きれる。でも、終わってから1時間ほど寝てたので今日はプラスマイナスゼロ。<a href=/diary/posts/2021/1013/#朝活>前回の朝活</a> と同様、ミクロ経済学の入門書を読んでた。第2章の予算線と最適化を読んだ。経済学とはこういうものだという説明が腑におちた。当たるかどうかよりも考え方を理解しておく方が大事なように思えた。</p>
<blockquote>
<p>ときどき経済学に対して「経済学が想定するほど実際の消費者は懸命に選択しているとは限らない」といった批判がなされることがある。でもこれまでの説明から明らかなように、その批判は勘違いにもとづくものだ。批判したいなら「経済学は、消費者がはたから見て確実に愚かな選択をしても、それを非難しない傾向が強い」というほうが適切だろう。</p>
</blockquote>
<p>もう1つおもしろかったのがこの一節。</p>
<blockquote>
<p>予算線と選好を用いたミクロ経済学的分析は、現金給付のよさを指摘する。ただし、制度の悪用、人々の支持、必要原理といったことを考えると、現物給付のほうが好ましいとなる。現金給付と現物給付のどちらが総合的によいのか、これらの話だけで結論づけることはできない。とはいえここで、ミクロ経済学が有用な政策分析ツールたりえること、またミクロ経済学だけで政策を論じるのは不十分ということが分かったのは十分な収穫である。</p>
</blockquote>
<p>人間の活動を予測するような学問の便宜上、前提条件や制約を課している。経済という人間にとって重要な社会システムを扱う経済学への期待値が大き過ぎるがために経済学の言うことが当たった・当たってないといった議論になりがちなのかもしれないと思えた。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>5章レプリケーションを読んだ。200ページ超えたことで1/3を読み終えた。まだまだ先は長い。</p>
<p>シングルリーダーレプリケーションは一般的なものだし、Cassandra の運用をしていたのでリーダーレスレプリケーションもだいたいは知っていた。並行書き込みの問題は意識したことがなかった。そういう状況が発生するアプリケーションにおいてはとても難しい問題なことが理解できた。Cassandra で採用されている衝突解決アルゴリズムは <strong>最後の書き込みを勝たせる（last write wins、LWW）</strong> というものであり、これで十分なように考えていたけど、不十分なケースもあることがわかった。</p>
<blockquote>
<p>レプリケーションとは、ネットワークで接続された複数のマシンに同じデータのコピーを保持しておくこと。</p>
<ul>
<li>データを地理的にユーザーの近くで保持しておく => レイテンシを下げる</li>
<li>一部に障害があってもシステムが動作し続けられる => 可用性を高める</li>
<li>読み取りクエリを処理するマシンをスケールアウトする => スループットを高める</li>
</ul>
<p>レプリケーションはいくつかの目的で使われる。</p>
<ul>
<li>高可用性/耐障害性</li>
<li>レイテンシ</li>
<li>スケーラビリティ</li>
</ul>
<p>対象のデータが時間が経っても変化しないのであれば、レプリケーションは容易。単にデータのコピーを各ノードに一度だけコピーすれば完了するから。レプリケーションの難しさは、すべてレプリケーションされたデータへの変更の扱いから生じる。変更をノード間でレプリケーションするのに広く使われているアルゴリズムは次の3つになる。</p>
<ul>
<li>シングルリーダーレプリケーション
<ul>
<li>クライアントはすべての書き込みを1つのノード（リーダー）に送り、リーダーはデータ変更イベントのストリームを他のレプリカ（フォロワー）に送る</li>
<li>読み取りは任意のレプリカから行えるが、フォロワーから読み取るデータは古い可能性がある</li>
</ul>
</li>
<li>マルチリーダーレプリケーション
<ul>
<li>クライアント群は、それぞれの書き込みを複数あるリーダーノードのいずれかに送信する</li>
<li>これらのリーダーノードはどれも書き込みを受け付ける</li>
<li>リーダー群は、データ変更イベントのストリームをお互いに、そしてすべてのフォロワーノードに送信する</li>
</ul>
</li>
<li>リーダーレスレプリケーション
<ul>
<li>クライアントは、それぞれの書き込みを複数のノードに送信し、古いデータを持つノードを修正するために読み取りを複数のノードから並列に行う</li>
</ul>
</li>
</ul>
<p>データベースのレプリケーションの原理は1970年代から研究されていてそれほど変わっていない。とはいえ、分散データベースがメインストリームで利用されるようになったのは最近のこと。アプリケーション開発者の経験不足により <strong>結果整合性</strong> のような問題に関しては多くの誤解が生じた。いずれのレプリケーションのアプローチにもメリットとデメリットがある。シングルリーダーレプリケーションは理解しやすく、衝突解決を気にする必要がないことから、広く使われている。マルチリーダーとリーダーレスのレプリケーションは、ノードの障害、ネットワークの障害、レイテンシのスパイクがあっても頑健になる。しかし障害の理由を説明するのが難しく、一貫性についても弱い保証しか示せない。</p>
<p>レプリケーションは、 <strong>同期</strong> で行うことも <strong>非同期</strong> で行うこともできる。どちらにするのかは、障害があったときのシステムの振る舞いに大きく影響する。非同期のレプリケーションは、システムがスムーズに動作しているときには高速に動作するが、重要なのはレプリケーションのラグが大きくなったり、サーバーに障害が生じたりしたときに何が起こるのかを理解しておくことになる。リーダーに障害が発生し、非同期に更新されていたフォロワーを新しいリーダーに昇格させたら、直前にコミットされたデータは失われてしまう可能性がある。</p>
<p>レプリケーションラグが生じている状況下でアプリケーションがどのように振る舞うべきなのかを決める際に役立つ一貫性モデル。</p>
<ul>
<li><strong>書き込み後読み取り (read-your-writes)</strong>
<ul>
<li>ユーザーは、自分自身が投入したデータを常に見れる</li>
</ul>
</li>
<li><strong>モノトニック読み取り (monotonic reads)</strong>
<ul>
<li>ある時点のデータをユーザーが一度見たら、それ以前の時点のデータは見れない</li>
</ul>
</li>
<li><strong>一貫性のあるプレフィックス読み取り</strong>
<ul>
<li>ユーザーは、たとえば質問とその質問への回答を適切な順序でといったように、適切な因果関係を保持した状態でデータを見れる</li>
</ul>
</li>
</ul>
<p>マルチリーダーとリーダーレスのアプローチは本質的に並行性の問題を抱えている。複数の書き込みが並列に行われることがあるので、衝突が生じる場合がある。ある操作が他の操作よりも先に行われたのか、あるいはそれらが並行して行われたかを判断するためのアルゴリズムについて説明されている。</p>
</blockquote>
<h2 id=slack-apps-の調査>Slack apps の調査</h2>
<p><a href=https://www.instagram.com/workstreams.ai/>Workstreams.ai</a> を試してみた。</p>
<blockquote>
<p>Results-driven task management for Slack, Microsoft Teams and Google</p>
</blockquote>
<p>結果駆動タスクマネジメントという聞いたことない用語が書いてある。SaaS 型の Web アプリケーションとしての課題管理システムとチャットツールとの連携が密になったプロダクトにみえる。UI もよく作り込まれている。Workstreams.ai のアカウント管理は <a href=https://api.slack.com/authentication/sign-in-with-slack>Sign in with Slack</a> を使っている。ドキュメントによると openid connect と oauth 2.0 の仕組みを組み合わせているのかな。認証よくわかってないので背景も勉強しないといけない。簡単にタスク作成やコメント、更新などを Slack クライアントと Web アプリケーション上で触ってみた。</p>
<p>もう1つ <a href=https://slack.com/app-pages/google-sheets>Google Sheets for Workflow Builder</a> というのも試してみた。ワークフロービルダーのステップに簡単に Google Sheet との連携を実装できるのでめっちゃ簡単。ワークフロービルダーは本当によくできているな。</p>
<h2 id=ジョギング>ジョギング</h2>
<p>今日は調子はよかったけど、お仕事の区切りがよかったので19時に終えて近所の公園にジョギングしてきた。昨日も走ってたのでやや筋肉痛が残りつつ、走り始めは筋肉がきしむ感じだったけど、走っているうちに体があたたまってきて気にならなくなった。時間帯は同じだけど、昨日より陸上部の人たちが半分ぐらい少なかった。曜日によって違うのかなぁ。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1014/>霖</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-14
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/naming/>naming</a>&nbsp;
</span>
<div class=post-content>
<p>0時過ぎに寝て7時に起きた。けれど、なんかしんどくて起き上がれなくてそのまま2度寝した。1時間ほど寝たらすぐに起きれた。あのしんどさは何だったのか。とはいえ、気付いたら8時半にはオフィスにいたので普段の仕事始めと変わらない見た目になった。お昼に体温を測っていたら37.1℃になってたので熱っぽい雰囲気。日中は特にしんどくはないんだけど。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>4章エンコーディングと進化を読んだ。だんだん内容が難しくなってきて読むのに時間がかかる。これで第一部のデータシステムの基礎を読了した。4章のまとめ。</p>
<blockquote>
<p>データシステムの変更のしやすさ、アジリティのことを本書では <strong>進化性</strong> を呼んでいる。</p>
<p>進化性を高めるには、システムのバージョンアップが容易にできなくてはならない。このとき、サーバーサイドアプリケーションは、大抵の場合、一度にすべてのノードをのバージョンアップができないことから、 <strong>ローリングアップグレード</strong> という手法を用いる。ローリングアップグレードを可能にするには、データフォーマットやスキーマの変更に対して、新旧どちらのフォーマットも、新旧どちらのコードからも扱えないといけない。データフォーマットやスキーマの <strong>前方/後方互換性</strong> を維持することが進化性を高めることに大きく影響する。</p>
<p>メモリを共有していないプロセス間でデータを渡すとき、そのデータをバイト列へエンコードしないといけない。通常プログラムはデータを (少なくとも) 2つの異なる表現で扱う。</p>
<ol>
<li>CPU によるアクセスや操作が効率的になるよう最適化されてメモリ内で表現される</li>
<li>ファイルやネットワーク経由でデータをやり取りするにはバイト列にエンコードしないといけない<br>
この表現はメモリ内のデータ構造とはまったく異なる</li>
</ol>
<p>この2つの表現の間で何らかの変換が必要になる。インメモリの表現からバイトの並びへの変換は <strong>エンコーディング</strong> (シリアライゼーション、マーシャリングとも呼ぶ) 、その逆は <strong>デコーディング</strong> (パース、デシリアライぜーション、アンマーシャリングとも呼ぶ) と呼ぶ。</p>
<p>データエンコーディングフォーマットと、それらの互換性に関する特性。</p>
<ul>
<li>プログラミング言語固有のエンコーディングは1つのプログラミング言語に限定され、しばしば前方及び後方互換性を欠く</li>
<li>JSON, XML, CSV といったテキストフォーマットは広く利用されており、その互換性は利用の方法に依存する
<ul>
<li>オプションのスキーマ言語はあるが、それらは助けになることもあればむしろ障害になることもある</li>
<li>これらのフォーマットはデータ型について多少の曖昧さがあるので、数値やバイナリ文字列などについては注意が必要</li>
</ul>
</li>
<li>thrift, protocol buﬀers, aro といったスキーマを持つバイナリフォーマットではコンパクトで効率的なエンコーディングが可能であり、前方及び後方互換性のセマンティクスも明確に定義されている
<ul>
<li>これらのスキーマは、ドキュメンテーションと静的型付き言語でのコード生成に役立つ</li>
<li>ただし、バイナリフォーマットにはデコードしなければ人にはデータが読めないという欠点もある</li>
</ul>
</li>
</ul>
<p>データフローの形態とエンコーディング。</p>
<ul>
<li>データベースでは、データベースへの書き込みを行うプロセスがデータをエンコードし、データベースからの読み取りを行うプロセスがそのデータをデコードする</li>
<li>RPC と REST API では、クライアントがリクエストをエンコードし、サーバーはそのリクエストをデコードしてレスポンスをエンコードする。そして最後にクライアントがレスポンスをデコードする</li>
<li>非同期のメッセージパッシング（メッセージブローカーあるいはアクター）では、ノードはお互いにメッセージを送信することによって通信し、送信側がメッセージをエンコードし、受信側がそのメッセージをデコードする
<ul>
<li>kafka などを使ったイベント駆動アーキテクチャはこの形態になる</li>
</ul>
</li>
</ul>
<p>多少の注意を払うことで前方/後方互換性やローリングアップグレードは十分に実現可能となる。</p>
</blockquote>
<h2 id=霖-ながめ>霖 (ながめ)</h2>
<p>プロダクトの名前を考えるために万葉集を眺めてた。ふとみつけた <strong>霖</strong> ということばを気に入った。一文字だと「ながめ」または「ながあめ」と読む。霖雨と書くと「りんう」と読むらしい。万葉集では次の和歌で詠まれている。和歌では「長雨」と「眺め」をかけて使うのが常套句らしい。また古文でいうところの眺めはぼんやり見ながら物思いに耽るという意味になるそうだ。</p>
<blockquote>
<p>4217 卯(う)の花を　腐(くた)す霖雨(ながめ)の　始水(みずはな)に　寄るこつみなす　寄らむ児(こ)もがも　大伴家持</p>
<p>(現代語訳) 卯の花を腐らせるほどに痛めつける長雨、この雨のせいで流れ出す大水の鼻先に寄りつく木っ端のように、私に寄り添ってくれる娘でもいてくれたらなあ</p>
<p><a href=https://www.kadokawa.co.jp/product/200803000453/>新版　万葉集　四　現代語訳付き</a></p>
</blockquote>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>この季節の長雨には「卯の花腐し」という別名があります。画像は改元でも話題となった『万葉集』より「卯の花を腐す霖雨の…」という大伴家持の和歌。初夏の卯の花が枯れてしまうような長雨の表現です。詳しくは7月から始まる企画展「雨に詠えば―空模様の古典文学―」にて！ <a href=https://t.co/ZyU1h8TyNv>https://t.co/ZyU1h8TyNv</a> <a href=https://t.co/VaXKX0FGEI>pic.twitter.com/VaXKX0FGEI</a></p>&mdash; 国立公文書館 (@JPNatArchives) <a href="https://twitter.com/JPNatArchives/status/1130805663444213760?ref_src=twsrc%5Etfw">May 21, 2019</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<h2 id=ジョギング>ジョギング</h2>
<p>あまり調子がよくなかったので19時にお仕事を終えて近所の公園にジョギングに行ってきた。ワクチンを接種してから運動を控えていたのでジョギングしたのは初めてかな。2-3日に1回ぐらいの頻度でジョギングしている。ワクチン接種した週はウォーキングに留め、次の週は実家で田んぼ仕事でバテてて、今週は初めて行ってきた。ちょっと早い時間帯だったせいか、2つの陸上部が練習していてやや人が多かった。400m級のトラックがあって陸上部の人たちが練習している。練習の邪魔にならないよう、トラックの内側を20-30分とぼとぼジョギングしている。疲れたら歩きながらなのでそんなに距離は走ってない。ジョギング終えてから30分ぐらいストレッチをした。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1013/>vimgrep 検索の嬉しさ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-13
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<img src=/diary/img/2021/1013_vimgrep.png class=post-cover alt="vimgrep 検索の嬉しさ">
<div class=post-content>
<p>2時頃に寝て6時に起きる。普段、日記は vim で書いている。ちょっとした過去の日記の検索に <code>vimgrep</code> でこと足りるのが嬉しい。テキストで日記を書いていることの利点かな。夜に <a href=https://fin-py.connpass.com/event/226933/>fin-pyコードリーディング会#4</a> に参加した。事前に <a href=https://hackmd.io/bFBFaPbYS1Kqfc97HMlp7Q?view>hackmd</a> に発表内容のメモを書いてた。いろんな発表者の視点があってコードリーディングのイベントはおもしろかった。</p>
<h2 id=朝活>朝活</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/227678/>【三宮.dev オンライン】リモート朝活もくもく会</a> に参加してみた。何もなかったらだいたい7時頃に起きるのがなにか目的があると6時に起きれる。人体の不思議。せっかく起きたので <a href=/diary/posts/2021/0929/#joel-on-software>前に More Joel on Software を読んだとき</a> に学生向けのアドバイスにあったミクロ経済学の勉強のためにその入門書を読み始めた。参加者が勉強会の常連ばかりだったので朝からわりと雑談してた。2人転職するという話で2人とも東京の会社でフルリモートワークで働くらしい。働き方が変わったなと感じる。その後、第1章の無差別曲線を読んだ。</p>
<h2 id=youtube-配信と集中力>YouTube 配信と集中力</h2>
<p>あんちぽさんの <a href=https://kentarokuribayashi.com/journal/2021/10/09/2021%e5%b9%b410%e6%9c%889%e6%97%a5>2021年10月9日</a> の日記でスライド作成の興がのらないので YouTube 配信しながらやったら集中できてよかったと書いてあったのでちょっと眺めてみた。なんかスライドの作成のやり方とか、自分と違うのかな？とか思いながらみたけど、やり方自体は普通だった。ただ集中できてよかったとあるので普段のやり方とは異なることをすることに意義があるのかな？とも思えた。試しに YouTube Live やってみようとしたら初期設定？に24時間かかるとのこと。代わりに <a href=https://launchpad.net/kazam>kazam</a> というスクリーンリコーダーの使い方を調べてた。勉強会で作業したログとかを録画しておいてなにかに使えたりするかもしれない。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>半日ほどかかって3章ストレージと抽出を読んだ。読みながら書いているので時間がかかる。今日はこれだけ。まとめはこんな感じ。</p>
<blockquote>
<p>データベースのシステムには2つの用途があり、その特性やパフォーマンスを最適化するためにストレージエンジンやデータ構造が異なるもので運用されるようになってきた。</p>
<ul>
<li>オンライントランザクション処理 (OLTP)
<ul>
<li>行指向、トランザクション処理</li>
</ul>
</li>
<li>オンライン分析処理 (OLAP)
<ul>
<li>列指向、分析クエリ</li>
</ul>
</li>
</ul>
<p>OLTP には2つの主要なストレージエンジンがある。</p>
<ul>
<li>B ツリー
<ul>
<li>1970年代からあり、成熟していて且つ効率的なインデックスのデータ構造</li>
</ul>
</li>
<li>LSM ツリー
<ul>
<li>比較的最近開発された、ディスク上でのランダムアクセスをシステム的にシーケンシャルアクセスに変換して、書き込みのスループットを高める手法。もとは Google の BigTable の論文？</li>
</ul>
</li>
</ul>
<p>OLAP の典型的なデータウェアハウスの高レベルでのアーキテクチャでは、大量の行をシーケンシャルにスキャンしなければならないクエリの場合、インデックスはあまり関係なく、データを非常にコンパクトにエンコードし、クエリがディスクから読まなければならないデータの量を最小限にとどめることが重要となる。この目標を達成するのに列指向のストレージが役立つ。</p>
</blockquote>
<p>過去に Cassandra を使ったプロダクトの開発に関わっていたから B ツリーと LSM ツリーの概要は知っていて3章で書いてあることはだいたい理解できた。データウェアハウスに関しては、前にお手伝いしていた会社で普通のログを Amazon Athena で処理すると1時間とかかかって分析クエリが Parquet に変換すると数分で完了したりするのを目の当たりにしてた。分析処理で読み込むデータ量を削減する列指向の考え方は理解しておく必要がある。行指向のデータを列指向フォーマットである <a href=https://parquet.apache.org/>Parquet</a> に変換する <a href=https://github.com/reproio/columnify>columnify</a> のコードも読んだことがあったので内容のイメージはできるけど、実務経験が少ないと全体像がわかっておらず、本書を読みながら学び直ししてた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1012/>やや疲れ気味</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-12
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
</span>
<div class=post-content>
<p>昨日は1時半に寝て7時半に起きた。なんか疲れが溜まっているのか寝不足なのか、しゃきっとしなくて15時頃にお昼ご飯食べてきて、戻ってきて2時間ほど寝てた。夕方に寝ると夜の睡眠が悪くなるかもしれない。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p><a href=https://www.oreilly.co.jp/books/9784873118703/>データ指向アプリケーションデザイン -信頼性、拡張性、保守性の高い分散システム設計の原理</a></p>
<p>先週末から読み始めようと思いつつ、ダラダラしていて今日から読み始めた。600ページ超と分量が多いので少しずつ読んでいく。買ったのは2019年7月なので2年越しの積ん読。前職で書籍購入の補助制度があったのでその予算消化のために買ったみたいなもの。でも買っておくといつか読むので買っておいてよかった。今日は2章まで読んだ。</p>
<p>「データ指向」という用語は、cpu のデータ処理がボトルネックとなり、且つそのデータ量や複雑さなどが主な課題となるアプリケーションのことをデータ指向と定義している。ソフトウェアシステムにおける3つの課題。これはすべて非機能要件になる。</p>
<ul>
<li>信頼性</li>
<li>スケーラビリティ</li>
<li>メンテンナンス性</li>
</ul>
<p>リレーショナルデータベースと NoSQL の台頭から始まり、ドキュメントデータベースやグラフデータベースの概要やリレーショナルデータベースとの比較などが書いてある。また NoSQL 系のデータベースのクエリ言語とか、よく知らないので勉強になった。12章あるので1日1-2章ぐらいのペースで今月中に読めたらいいや。</p>
<h2 id=slack-のワークフロービルダーの調査>Slack のワークフロービルダーの調査</h2>
<p>今度、勉強会をするので調べ始めた。ワークフロービルダーは簡単に定型的な処理を作成できるけど、有料プランでしか使えないのでコミュニティなどでは使いにくい。試しにいくつかワークフローを作ってみて感触を理解した。おそらくワークフロービルダーは Slack app を作成するためのフレームワークにみえる。作成したワークフローの1つ1つが Slack app になるのではないか。</p>
<ul>
<li><a href=https://github.com/t2y/python-study/tree/master/BizPy/slack/20211027>https://github.com/t2y/python-study/tree/master/BizPy/slack/20211027</a></li>
</ul>
<p>Slack native? first? な課題管理システムもいくつかみつけた。非開発者に課題管理システムを使ってもらうのはかなり難しいので Slack と課題管理システムが連携すれば課題管理の方法論に新しい価値が出てくるのではないかと考え始めた。この機会に Slack app で構築されば課題管理システムも調べてみようと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1011/>BizPy 再始動</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-11
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/python/>python</a>&nbsp;
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
#<a href=/diary/tags/harassment/>harassment</a>&nbsp;
</span>
<img src=/diary/img/2021/1011_hot-entory.png class=post-cover alt="BizPy 再始動">
<div class=post-content>
<p>昨日は晩ご飯食べてからのんびりしていた。寝て起きての繰り返しだったので何時に寝たのかよくわからない。夜、本を読もうと思っていたのにダラダラ過ごしてしまった。朝は7時半に起きた。朝起きたら <a href=https://t2y.hatenablog.jp/entry/2019/06/29/150125>Python で Unicode 正規化 NFC/NFD の文字列を扱う</a> がはてブでホットエントリ化してた。昨日、書評を書いたからその記事かと期待したけど、なぜか2年ほど前に書いた古い記事だった。なんかがっかり。そして、その理由は全くわからない。1日経って夜の時点ではてブが82個ついている。昔は10個もついたら嬉しかったものだけど、いまは100個ぐらいついてもなんとも思わない。</p>
<h2 id=fin-pyコードリーディング会に発表準備>fin-pyコードリーディング会に発表準備</h2>
<p><a href=https://fin-py.connpass.com/event/226933/>fin-pyコードリーディング会#4</a> に参加することにした。過去にオブジェクトストレージの開発に関わっていたからデータストアやストレージに関することは興味がある。たまたまツールの <code>store.py</code> を題材にしていたので読んでしまった。簡単にコードを読んで気になったところをイベントの hackmd に記載した。やっていることの詳細をよくわかっていないので、コードレビューみたいになってしまった。</p>
<ul>
<li><a href=https://hackmd.io/bFBFaPbYS1Kqfc97HMlp7Q?view>https://hackmd.io/bFBFaPbYS1Kqfc97HMlp7Q?view</a></li>
</ul>
<h2 id=bizpy-のコミュニティ活動を再開>BizPy のコミュニティ活動を再開</h2>
<p>前にやってたお仕事がうまくいかなくて他のことに時間を費やす余裕がなくてお休みしてた。本当はもっと早く再開してもよかったんだけど、新しいことに挑戦しているときにあまり他のことに注意を取られたくないという考えもあって少し保留していた。新しいことへの活動も一段落して方向性や展望もみえてきたので BizPy も再開することにした。ちょうど Slack のインテグレーションを調べようと思ったところだったので弾みを付ける意図でも都合がよい。複数の意味でタイミングがよかった。また参加者が戻ってきてくれると嬉しい。</p>
<ul>
<li><a href=https://bizpy.connpass.com/event/198717/>Python で Slack のインテグレーションをやってみる勉強会 #1</a></li>
</ul>
<h2 id=プロコンの続き>プロコンの続き</h2>
<p>ネットで話題になったせいか、当事者同士で話し合う場が設けられたという公式発表が行われた。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>第32回高専プロコン秋田大会自由部門プレゼン審査発表順番号５の質疑応答について、発表者・質問者双方の相互理解の場を設けさせて頂きました。<a href="https://twitter.com/hashtag/procon32?src=hash&ref_src=twsrc%5Etfw">#procon32</a> <a href=https://t.co/nlzujvJ7Hv>pic.twitter.com/nlzujvJ7Hv</a></p>&mdash; KosenProcon (@KosenProcon) <a href="https://twitter.com/KosenProcon/status/1447192976946384901?ref_src=twsrc%5Etfw">October 10, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<p>これ以上、外野がとやかく言う必要はないと思うけど、一方で立場の強い人が有利になってしまうため、運営はハラスメント行為を行った審査員へ然るべき措置をすべきといった意見もみられた。一理あるかもしれないが、そこまでするほどの問題かというのは個人的に思う。タイムラインを眺めていると、ハラスメントを問題視する人は、その背景や経緯や意図はすべて横に置いておいてハラスメント的言動や態度を糾弾する。この人たちと背景も考慮して整理しようとする人たちとは全く議論が噛み合わない。ハラスメントは絶対許すまじという社会の変化や誤った人への行き過ぎたキャンセルカルチャーに私はやや圧倒される。</p>
<p>そう思っていると、私のタイムラインでは「まさかりを投げる」という表現そのものや行為のハラスメントの是非の議論も巻き起こっていた。あまり最近はまさかりを投げるという表現は見かけないんだけど、「マウント禁止」というのをちょくちょくみかける。ハラスメントと根っこは同じで悪気の有無に関係なく発信側が責めを負うようになったんだなと感じる。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>まさかりの議論とは別に、最近勉強会で「マウント禁止」というルールもよくみかける。これもマウントされたと感じる人と、知っていることを教えようとする人との関係の難しさを感じる。多少の間違いやもっとこうした方がいいよといったアドバイスをしなくなる人も多いのでは？という気はする。</p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1447429693959860236?ref_src=twsrc%5Etfw">October 11, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1010/>86―エイティシックス―</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-10
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/hugo/>hugo</a>&nbsp;
</span>
<div class=post-content>
<p>2時に寝て7時に起きる。昨日 <a href=https://anime-86.com/>86―エイティシックス―</a> の第2クールの初回をみた。起きてから第1クールの後半の内容を見返したりしてた。内容がすごくおもしろいというわけではないんだけど、作品の世界観と音楽がよい。というか、<a href=https://www.sawanohiroyuki.com/>澤野弘之</a> 氏のファンなので彼が音楽を手がける作品はみてしまう。第1クールの音楽も素晴らしかった。音楽がよいと映画やアニメのシーンが盛り上がるし、音楽だけを聞いているときにもそのシーンのイメージが想起されて音楽そのものにも深みが出るような気がする。</p>
<h2 id=terminal-のカスタマイズ>Terminal のカスタマイズ</h2>
<p>月別一覧のページを作成した。Hugo には <a href=https://gohugo.io/content-management/taxonomies/>Taxonomies</a> という仕組みがあって、任意のラベルでカテゴライズできる。デフォルトでは <code>categories</code> と <code>tags</code> が提供されている。設定ファイルに <code>dates</code> というカスタム Taxonomies を定義する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml>[<span style=color:#a6e22e>taxonomies</span>]
  <span style=color:#a6e22e>date</span> = <span style=color:#e6db74>&#34;dates&#34;</span>
  <span style=color:#a6e22e>tag</span> = <span style=color:#e6db74>&#34;tags&#34;</span>
</code></pre></div><p>コンテンツのメタデータには次のように年月のラベルを付与する。</p>
<pre tabindex=0><code>dates: [2021/10]
</code></pre><p>これは <code>hugo new</code> したときに自動生成されるので自分で明示的に設定する必要はない。</p>
<pre tabindex=0><code>dates: [{{ dateFormat &quot;2006/01&quot; .Date }}]
</code></pre><p>ラベル名に <code>/</code> を含めると自動的に月ごとのサブディレクトリになってくれるので月別のアーカイブを生成するのに都合がよい。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ tree -L <span style=color:#ae81ff>3</span> public/dates/
public/dates/
├── <span style=color:#ae81ff>2021</span>
│   ├── <span style=color:#ae81ff>09</span>
│   │   ├── index.html
│   │   ├── index.xml
│   │   └── page
│   └── <span style=color:#ae81ff>10</span>
│       ├── index.html
│       ├── index.xml
│       └── page
</code></pre></div><p>タグ一覧とは異なり、年単位・月単位にまとめて一覧表示するためにテンプレートをカスタマイズする。<a href=https://gohugo.io/templates/taxonomy-templates/>Taxonomy Templates</a> は <code>terms.html</code> によって提供されている。Terminal が提供しているこのテンプレートをカスタマイズすることで月別一覧を次のような表示になるようカスタマイズした。</p>
<figure><img src=/diary/img/2021/1010_dates.png>
</figure>
<p>実際の修正内容は次になる。</p>
<ul>
<li><a href=https://github.com/t2y/diary/commit/783d9685ae3698b85e428bce178bdd9ebe2c3dca>https://github.com/t2y/diary/commit/783d9685ae3698b85e428bce178bdd9ebe2c3dca</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1009/>職質された</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-09
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/hugo/>hugo</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きる。昨日も田んぼ仕事の疲れが残っていたのでよく眠れた。1週間で6時頃に起きる癖がついたのですぐに起きれた。</p>
<h2 id=terminal-のカスタマイズ>Terminal のカスタマイズ</h2>
<p>昨日からいくつか修正をしていた。</p>
<ul>
<li>画像のパス問題の修正</li>
<li>favicon の追加</li>
<li>タグ一覧リンクの追加</li>
<li>atom フィードに icon 要素の追加 (feedly では読み取れない)</li>
</ul>
<p>atom フィードに favicon を指す要素を埋め込んでみたんだけど、feedly ではダメっぽい。たまたまヒットした GitHub issue でもそういったコメントをみかけた。</p>
<ul>
<li><a href=https://github.com/huginn/huginn/issues/1628#issuecomment-882103625>https://github.com/huginn/huginn/issues/1628#issuecomment-882103625</a></li>
</ul>
<h2 id=ストレッチ>ストレッチ</h2>
<p>毎週土曜日はストレッチの日。田んぼ仕事のおかげで全身軽い筋肉痛になっている。ストレッチを受けると、いつものときとの違いから、股関節から右ももと腕の筋肉がすごく張っているのに気付く。田んぼのような突発的に体を動かして疲労が溜まったときにもストレッチでほぐせるのがよい。今日の開脚幅は開始前169cmで、ストレッチ後170cmかな。前より少し落ちたのは田んぼ仕事に疲れて平日にあまりストレッチが出来なかったのと筋肉痛のせいかもしれない。</p>
<h2 id=joel-on-software>Joel on Software</h2>
<p>本当は実家に帰っているときに書き上げようと考えていたものの、田んぼ作業での疲れと実家のパソコンを使って作業する環境の悪さから書くことに集中できなくなって断念していた。集中できる環境なら3時間ほどで書けた。動機づけよりも価値観、価値観がブレないならその次は集中できる環境作りにこだわっていきたい。</p>
<ul>
<li><a href=https://t2y.hatenablog.jp/entry/2021/10/09/162618>https://t2y.hatenablog.jp/entry/2021/10/09/162618</a></li>
</ul>
<h2 id=職務質問>職務質問</h2>
<p>買いものして帰ろうとしてたら警察官に止められて職務質問をうけた。自転車の盗難が多いので防犯登録を調べたいとのこと。はいはいって感じで免許証を提示する。自転車は東京で購入したもので10年以上乗っている。防犯登録は警視庁になっているらしく、兵庫県警の警察官では調べられないみたい。次に車体番号も読み取って調べていたけど、よくわからなかったみたい。結局、私が本物の持ち主とその場で調べることができなくて、警察官もたぶん本物だと思いますみたいな歯切れの悪い結果で職務質問を終えた。仮にその自転車が盗難にあってもその防犯登録から私を辿ることはできないので近所の自転車屋さんで防犯登録入り直してくださいと言われた。あー、またこの件か。都道府県の防犯登録のシステムが全国で統合されていればいい話しなのに、なんで引っ越したら防犯登録をやり直さないとあかんねんと。現場の警察官に言っても仕方ないので何も言わないことにした。</p>
<h2 id=プロコン>プロコン</h2>
<p>たまたまタイムラインでみかけてちょっと眺めてた。動画で同じ内容をみて、ハラスメントを問題視する人と、プロダクトの新規性について言及する人がいて、感じ方は人それぞれだなぁと思いながら <a href="https://twitter.com/search?q=%23procon32&src=typed_query&f=top">ハッシュタグ</a> を眺めてた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1008/>畝作り</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-08
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/agriculture/>agriculture</a>&nbsp;
</span>
<img src=/diary/img/2021/1008_field.jpg class=post-cover alt=畝作り>
<div class=post-content>
<p>23時頃に寝て6時頃に起きた。田んぼは朝の方が涼しくて作業しやすいので朝起きるインセンティブになる。電車乗らなくなって早起きできなくなってたけど、やっぱり朝起きるインセンティブがあると起きれる。徐々に暑くなるせいか10時が感覚的に暑さのピークでそれ以降はあまり変わらない気がする。</p>
<h2 id=畑の水やり>畑の水やり</h2>
<p>7時半から8時まで水やり。昨日、amazon で購入した13リットル入るじょうろが届いたので初めて使ってみた。とくに問題なくて大きいので畑に水をやるときに往復する回数が減る。私が調べた限りだと、一番大きいジョウロが13リットルだった。よさそう。</p>
<h2 id=田んぼの肥料撒きと畝作り>田んぼの肥料撒きと畝作り</h2>
<p>8時から15時までお昼休憩を挟みつつ田んぼの作業。畝作りする前に堆肥を土に撒かないといけないらしい。鶏糞と苦土石灰 (くどせっかい) を撒いた。本当は一反あたり鶏糞を2-3t撒くとあったけど、しんどいので100kgぐらいにしといた。苦土石灰は50kg撒いた。撒き終わったのがお昼前で少し雑用もやって、お昼からトラクターで畝作りを12時半から15時ぐらいまでやってた。この後、母が菜の花を植えるらしい。菜の花は9-10月頃に植えて4-5月頃に収穫を迎える。なんか菜種油を淡路島の特産にしたい運動？をやっていて、菜の花の種を無料で配っているらしい。試しにやってみるとのこと。</p>
<p>耕し終えたら、再度アルミブリッジを使って田んぼから畔を跨いで出る。ブリッジの配置がよくなかったのか、ウィリー状態になってひっくり返りそうになった。危なかった。</p>
<figure><img src=/diary/img/2021/1008_tractor-bridge.jpg>
</figure>
<h2 id=三ノ宮へ>三ノ宮へ</h2>
<p>17時の高速バスに乗って三ノ宮へ戻る。一旦、家に戻って荷物を置いて、キングダムのアニメをみて、20時からオフィスで今週の仕事始め。隔週で顧問さんと打ち合わせしている。次の月曜日は打ち合わせの日なのでそれまでに打ち合わせの議題の準備をしておく。いつもは水曜か木曜には打ち合わせする内容を連絡している。今週は全然仕事できなくて金曜日に話したいチケットを連絡した。そのチケットの仕上げをいまから片付ける。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1007/>傍聴</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-07
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/agriculture/>agriculture</a>&nbsp;
#<a href=/diary/tags/court/>court</a>&nbsp;
</span>
<div class=post-content>
<p>1時頃に寝て6時に起きる。実家なんで久しぶりにテレビみてて、新潟ロシア村の廃墟に潜入するのをやっててちょっとおもしろかった。バブル末期のテーマパークが休業状態になって廃墟と化したらしい。</p>
<ul>
<li><a href=https://travel-noted.jp/posts/21044>新潟ロシア村は心霊スポットに！廃墟と化したテーマパークの現在は？</a></li>
</ul>
<h2 id=畑の水やり>畑の水やり</h2>
<p>7時から8時まで水やり。軽トラに水を入れた雨水タンクとバケツを畑まで運び、じょうろに水を入れて何往復かして水をやる。手間隙がかかるだけでそんな大変ではない。この作業は慣れた。</p>
<h2 id=田んぼの草焼きと耕起>田んぼの草焼きと耕起</h2>
<p>昨日の続き。朝は露が降りて湿っていて草に火がつきにくい。昨日、焼いた半分の田んぼをトラクターで耕すことから始める。半分終えてから残りの半分の草も順次焼いていった。火のコントロールの慣れたのと、燃え拡がるほどの領域はないので安心して火を放つことができた。終えてから残りの半分もトラクターで耕した。だいたい8時から13時まで草焼きと田んぼを耕していた。</p>
<figure><img src=/diary/img/2021/1007_field.jpg>
</figure>
<h2 id=裁判の傍聴>裁判の傍聴</h2>
<p>15時から父の交通事故に関する裁判に行く。裁判所行くのも初めて。裁判官から母に意見を聞きたいという機会で、たまたま私も帰っているので一緒に傍聴させてもらうことにした。普段の裁判は事前に質疑応答のやり取りが弁護士間で行われており、実際の裁判は5-10分で内容だけ確認したら次回の予定を決めているだけだという。</p>
<p>待合室で父の成年後見人の弁護士さんと話していたら、裁判も徐々にリモート化の流れになってきていて、実際のこの裁判では相手の弁護士さんはテレビ会議で参加している。関係者もリモート会議でも構わないけれど、裁判は関係者しか参加してはいけないという制限があって、リモートだと周りに関係ない人がいないことを証明するのが難しいと仰っていた。裁判のときに裁判所のスタッフが相手の弁護士に電話を繋いだとき「周りに誰もいませんか？」と確認していた。</p>
<p>裁判官と書記のようなスタッフと母と父の成年後見人の弁護士さん、私の5人で裁判が始まった。言うても普通の会議室のような場所で、裁判官が進行を進めながら、普通に会議をやるような感じだった。出席者は誰もノートPCをもっておらず、紙の分厚い資料が2-3束置いてあって、書記さんも手書きで紙のノートにメモをとっていた。私がスマホでメモをとってたらスマホは使うなと怒られた。あとで弁護士さんに確認したら、通常の裁判だったらメモをとってもいいけど、傍聴人は電子機器を使うのはダメみたい。弁護士だったらノートPCでメモをとる人もいるらしい。成年後見人の弁護士さんは、裁判のときに紙の資料の方がぱらぱらめくって見つけるのが速いのでノートPCを使わないと話してた。そんなもんかな。</p>
<p>裁判官の進行や説明がぐだぐだ過ぎてちょっと驚いた。見た目30代ぐらいの裁判官。裁判官って司法試験をパスした優秀な人がなっているであろうになんか拍子抜けした。あとで弁護士さんと雑談していたときに「和解案は支部のそこそこ優秀な人たちが作るのであまり変なものは出てこない。本当に優秀な人たちは東京や大阪で働いているけど、、、」みたいなことをさらっと話してた。</p>
<p>地方裁判所の裁判官とかは、相対的に優秀な人は少ないという話なのかな？裁判官がぐだぐだ過ぎるので弁護士さんがちょくちょくツッコミを入れながら進行をサポートしていた。もしくは多くの案件を抱え過ぎていて、個々の裁判の経緯や内容をいちいち覚えてないのかもしれない。当初、こちらは被害者側なので言葉に配慮して柔らかく話すように努めているのかな？と思って聞いてたけど、進行もぐだぐだなんで、どうも違うのかな？と思うようになった。話すときに、順接、逆説、指示語が多くて何が言いたいのかさっぱりわからなくて1つのことを伝えるのに無駄に言葉数が多いように感じたけど、それは端的に要点のみを話すのに慣れた、私の職業病なんやろかとかも思いながら聞いてた。</p>
<p>交通事故の裁判の場合、よほど変なのが出てこない限り、和解案で決めておいた方がよいと弁護士さんは仰っていた。それは裁判所が被害者側に寄り添って作るものなのでそれを拒否して判決まで行ってもそれよりもよい内容にはならず、悪くなる可能性が高いという。次回かその次ぐらいで和解案が出てくるみたい。もう少しでこの裁判は終わりそう。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1006/>草焼き</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-06
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/agriculture/>agriculture</a>&nbsp;
</span>
<div class=post-content>
<p>23時頃に寝て7時に起きる。蚊取り線香のおかげでよく眠れるようになった。やや筋肉痛。</p>
<h2 id=畑の水やり>畑の水やり</h2>
<p>昨日と同様に雨水タンクからポリタンクへの水の移し替えをした。入れ物からホースが外れないように釣りの重りを買ってきてつけてみた。ダイソーで25号の重りとキーホルダーの輪っかとタイラップを購入した。もう少し重い方がよかったけど、ないよりはましかな。</p>
<figure><img src=/diary/img/2021/1006_hose-weight.jpg>
</figure>
<h2 id=田んぼの草集めと草焼き>田んぼの草集めと草焼き</h2>
<p>昨日、草刈りが完了したので乾かした草を焼いていく。草が乾いていないとなかなか火がつかなかったり、ついても火力がないと消えてしまう。また逆に草がよく乾いていると火の回りが早く一気に燃え拡がるので火のコントロールができない。隣の田んぼや周りに燃え広がらないように注意してやらないと家事になりそうで危ない。</p>
<p>田んぼの周囲の草を内側に集めて、周囲を先にトラクターで耕すことにした。草がなければ燃え拡がることはないので結界のようなものを作る。まずトラクターを田んぼに入れる。あらかじめ3mのアルミブリッジを用意してあったので畔の谷をまたいで橋を渡る。</p>
<figure><img src=/diary/img/2021/1006_tractor-bridge.jpg>
</figure>
<p>先に周囲だけぐるりと耕す。</p>
<figure><img src=/diary/img/2021/1006_turn-over.jpg>
</figure>
<p>慣れてきて草の帯を作って風上から風下へ燃やしていく。</p>
<figure><img src=/diary/img/2021/1006_burn-grass.jpg>
</figure>
<p>煙に巻かれないようにしながら半分ぐらいの草を焼けた。都会で暮らしていると火をつけるという作業をすることはあまりない気がするけど、火を育てながら燃やしていくのが割とおもしろかった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1005/>草刈り完了</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-05
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/agriculture/>agriculture</a>&nbsp;
</span>
<img src=/diary/img/2021/1005_grasscutter.jpg class=post-cover alt=草刈り完了>
<div class=post-content>
<p>22時頃に寝て6時に起きる。昨日は蚊取り線香をセットしたのでよく眠れた。田んぼ作業して疲れ果てたせいか、早く寝て途中で起きることもなかった。最近はたいてい夜中に1-2度は起きるけれど、昨日は疲れていたので起きなかった。やっぱり体力を使うとよく眠れるみたい。平日ももっと運動して疲れた方がいいのかもしれない。</p>
<h2 id=畑の水やり>畑の水やり</h2>
<p>昨日より遅く起きたので7時半から。午後から一緒に畑の面倒をみてくれている人が手伝ってくれるらしい。その人が水やりできるよう雨水タンクから畑に置いてあるポリタンクへの水の移し替えを自動化してみた。</p>
<figure><img src=/diary/img/2021/1005_watertank.jpg>
</figure>
<p>あとは軽く水やりして細々した作業をしてた。じょうろで水をやっていると、ゴミのせいか目が詰まってあまり水が出なくなる。こし網つきのじょうろがないか探したら2-3候補が出てきた。レビューをみながら次のものを購入した。</p>
<ul>
<li><a href=https://www.amazon.co.jp/gp/product/B00762ACJE/>トンボじょうろ13型</a></li>
</ul>
<p>選定理由はこれら。レビューみてたらサイズの大きいじょうろは使っているとすぐヒビが入るとか壊れるとかのコメントもみかけた。</p>
<ul>
<li>水をたくさん入れられる</li>
<li>こし網がついている</li>
<li>普通に使ってて壊れない</li>
</ul>
<h2 id=田んぼの草刈り>田んぼの草刈り</h2>
<p>昨日の続き。8時ぐらいから始めて11時過ぎまでひたすら草刈機で草刈りしてた。10時ぐらいが暑さのピークでバテて残りを夕方にしようかと考えていたけど、その後、涼しくなったんで草刈りは全部終えた。草刈機やったことなかったんでまだあまりうまく使いこなせない。身長と機械の竿の長さがあってなくて微妙にやりにくい。あと草の倒れている方向と草刈機の刃の入れ方を調整したりしながら試行錯誤してた。なかなか難しい。草を刈らずに放置していると、草を刈って燃やすという余分な手間隙がかかる。システムで例えると、メジャーバージョンを2つぐらいまとめてあげるみたいなもん。草が伸びてしまう前に田んぼ耕しておくべきだったと反省した。今後は気をつけよう。</p>
<h2 id=お見舞い>お見舞い</h2>
<p>15時から父のお見舞い。病院はまだ直接の面会を再会していないので会議室のようなところでタブレットでリモート面会する。父は喉を気管切開してて話せないのでリモート面会しても会話はできない。定期的に顔を出しにいくみたいなもの。帰りにあちこち寄って細々したことをやってたら18時ぐらいになって田んぼできなかった。最近は18時まわると暗くなるな。気付いてなかった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1004/>草刈り</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-04
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/agriculture/>agriculture</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<img src=/diary/img/2021/1004_field.jpg class=post-cover alt=草刈り>
<div class=post-content>
<p>3時に寝て4時半に起きる。ほとんど寝てない。蚊がいて飛んでいるのが気になったり刺されてかゆかったりして寝るの諦めた。もう涼しくなって大丈夫かと思ってたけど、まだ蚊取り線香が必要だった。</p>
<h2 id=畑の水やり>畑の水やり</h2>
<p>6時半から7時半まで。玉ねぎ、茄子、大根、ミニトマトなど、いろいろ野菜が植えてある。玉ねぎはいま芽が出てきたところで水をたくさんやらないといけないらしい。</p>
<h2 id=joel-on-software>Joel on Software</h2>
<p>書評の続き。空き時間に少し書いた。実家だとオフィスより環境がよくないので集中力が下がり、その結果として効率が落ちる。本書の中でもオフィスのこだわりの章があったけど、環境が大事ということが実感できた。</p>
<h2 id=田んぼの草刈り>田んぼの草刈り</h2>
<p>午後から草場となった田んぼの草刈り。ある程度草を刈っておかないとトラクターの爪に巻き込むので耕すことができない。草刈機で刈り取りつつ、それを集めてきて、乾かして焼く。焼畑農業みたいなことをしないといけない。刈ったばかりの草は水分を含むのですぐには焼けない。一方で乾いた草はよく燃えるので燃え拡がってしまう。下手すると周りに燃え拡がって火事になってしまう。刈り取った草の集約や配置を調整しないといけない。日中、暑かったし、あまり寝てなかったから夕方は眠くてバテてた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1003/>帰省</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-03
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<img src=/diary/img/2021/1003_temperature.png class=post-cover alt=帰省>
<div class=post-content>
<p>0時に寝て9時頃に起きる。今朝は寝起きが悪くてベッドでぐだぐだしてた。ダイの大冒険をみて家事をした。数日、家を空けるので冷蔵庫の中を空にして、洗いものやゴミの始末をする。11時半頃にオフィスに着く。</p>
<h2 id=omron-connect>OMRON connect</h2>
<p>グラフは今週の平均体温の推移を示したもの。ワクチン摂取後の体温は36.5-37.0℃の間を行ったり来たりしているものの、体調はまったくしんどくないのであまり気にしてない。そもそも摂取後に体温を測り始めたので自分の平熱がどのぐらいなのかすら把握してないことに気付いた。<a href=https://www.healthcare.omron.co.jp/product/mc/mc-6800b.html>音波通信体温計 MC-6800B　けんおんくん</a> を使っていて OMRON connect というスマホアプリで計測した体温を記録できる。</p>
<h2 id=joel-on-software>Joel on Software</h2>
<p>書評を書き始めた。自分が学んだところや関心をひいたところは、読みながらメモ書きで課題管理システムのチケットに書いてある。それらを見返しながら、一般向けの書評にまとめる。自分にしかわからない内容を補足したり、見返すと言及するほどではないことを取り除いたり。あとは書く根気と時間次第になるわけだが、いまは時間がたっぷりあるので比較的、時間がかかっても学びの質をあげるためになるべく書くようにしている。5時間ほどかけて1/3ぐらい書けた。まだ途中。</p>
<h2 id=実家へ>実家へ</h2>
<p>16時30分の高速バスで実家へ帰る。18時前ぐらいに実家の最寄りのバス停につく。そこから車で10分ほど。片道が2,090円で、往復券だと割引で3,760円になり、420円お得になる。この距離だと大した金額ではない。東京にいたら新幹線が往復で3万円ほどで、乗り継ぎの時間を入れると移動時間も6-7時間になってしまう。東京から神戸に戻ってきた理由として実家に気軽に帰りやすいというメリットがある。</p>
<p>今回の帰省の目的は田んぼの一部が草場になっているので耕さないといけない。本当は9月中にやりたかったが、天候とワクチン摂取などを調整してたら10月になってしまった。自分の会社でよいのは、(他社の仕事を受けてなければ) 自分の都合で休日・平日関係なく業務の調整ができること。来週は実家の雑務: 田んぼや裁判の傍聴などをやりながら隙間に会社の仕事をする。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1002/>テーマスタイルのカスタマイズ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-02
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/hugo/>hugo</a>&nbsp;
</span>
<div class=post-content>
<p>昨日の夜は早めに仕事を終えて <a href=https://opt.connpass.com/event/222709/>第一回関数型プログラミング（仮）の会</a> の、やましたさんとみずしまさんの発表の2つだけ聞いて、疲れてそのまま帰ってゆっくりしてた。ドラクエタクトの新しいイベントやってたかな。あと今秋初めて買った梨を食べてた。たぶん0時ぐらいには寝て8時ぐらいに起きた。</p>
<p><a href=https://www.ytv.co.jp/asapara/>あさパラS</a> は総裁選の振り返りや役員人事の解説やっててほむほむと見てた。河野さんが官僚に嫌われる要因の1つとしてちょっと前にパワハラ音声が流出してたけど、言葉遣いがきついのに加え、正論をきつく言うから官僚の逃げ道をなくして追い詰めてしまうといったことが話されてた。心理的安全性の文脈で、お互いに信頼関係が築けた上で厳しいことを指摘するのは構わない (言い方は配慮すべき) が、そうじゃないと相手を追い詰めてしまう。過去に私も不誠実な相手に対して正論を言って追い詰めがちだったのでいまは反省している。目的は課題を解決することであって、相手を追い詰めても目的を果たせないということがようやく経験から理解できるようになってきた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>毎週土曜日は <a href=https://doctorstretch.com/>Dr.stretch</a> さんでストレッチしてる。開脚の幅が目標 (メトリクス) になっていて毎週測っている。目標は自分の身長と同じぐらいということで178cm。ストレッチの開始前に測って、ストレッチを受けてから再計測する。今日は開始前169cm、ストレッチ後171cmと初めて170cmの大台に到達した。このままうまくいけば、あと3-6ヶ月ぐらいあれば目標の身長と同じぐらいの開脚幅になるかもしれない。家でも毎日ではないけど、2日に1回ぐらいのペースでストレッチをするのが習慣になりつつある。いまジョギングをすると腰に負担がくるんやけど、トレーナーさんが言うには、開脚幅が広がると股関節の可動域があがって腰の負担も減るという。本来、腰の筋肉は動かない方の筋肉だが、股関節の可動域が小さいとそれを補うために腰の筋肉が動いてしまい、その結果として腰に負担がかかる。なので、股関節が本来の意図した動きをしていれば、自然に腰の負担も下がるという理屈らしい。</p>
<h2 id=価値観を育てる>価値観を育てる</h2>
<p>あんちぽさんのスライドを眺めて共感してた。日記を書き始めたのも <a href=https://kentarokuribayashi.com/>あんちぽさんの日記</a> を読んでて、毎日やっていることを「書くこと」は何かしら意味や意義があるんじゃないかと思うようになったから。</p>
<iframe class=speakerdeck-iframe frameborder=0 src=https://speakerdeck.com/player/422f05833bc64c1a978c1ba92020a249 title="自分の人生を生きる - 遊びで生きて価値観を育てよう / Live Your Own Life - Live for Fun and Develop Your Values" allowfullscreen mozallowfullscreen=true webkitallowfullscreen=true style="border:0;background:padding-box padding-box rgba(0,0,0,.1);margin:0;padding:0;border-radius:6px;box-shadow:rgba(0,0,0,.2)0 5px 40px;width:560px;height:314px"></iframe>
<p>歳を経て難しく感じるようになったことの1つに <strong>動機づけ (モチベーションコントロール)</strong> がある。</p>
<p>私は基本的に忙しいという言葉を使わない。やらないといけないことの何かが進捗していないとき、それは「やる気がない」と受け止めている。もちろん相手がいるときにやる気がないとそのまま表現すると横柄だったり失礼だったりすることもあるので余裕がないと答える場合もある。しかし、本質的にはやる気がないが正しい。もう少し補足すると、いまやっていることの方が自分にとって優先度が高く (やる気があり)、それ以外の別のことを先送りしているだけだと捉えている。もし別のことにやる気があるならば、いまやっていることを後回しにすればいいだけだからだ。</p>
<p>ここで、何をやってもいいとしたら、何をやりたいかという課題が出てくる。適当にあれこれやってみても、実際にやってみるとうまくいかなくて、やる気が持続しなかったりすることがある。多くのケースで、若い頃ほどなにかに夢中になってやっていた経験が誰しもあると思うが、あのときはなぜそんなに夢中になってできたのか。いま思い返しながら、自分にとっての動機づけの源泉を探るようなことをしていかないとわからないのだ。まったく自分のことなのに。2021年に入ってからそういったことを考え続けていたところ、このスライドを眺めてたら動機よりも価値観なんだよと書いてあって、私がこの9ヶ月間、掘り返し続けてた動機づけの源泉=価値観という考え方はしっくりきて、価値観がブレると動機づけもうまくいかないなと思えた。</p>
<h2 id=hugoterminalのカスタマイズ>Hugo/Terminalのカスタマイズ</h2>
<p>Speaker Deck のスライドの埋め込みができなくて調べた。<a href=https://chizuchizu.com/blog/tag_hugo/>HUGOで埋め込みができない時の対処法</a> によると、<code>config.toml</code> に次の設定を追加すると表示された。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml>[<span style=color:#a6e22e>markup</span>]
  [<span style=color:#a6e22e>markup</span>.<span style=color:#a6e22e>goldmark</span>]
    [<span style=color:#a6e22e>markup</span>.<span style=color:#a6e22e>goldmark</span>.<span style=color:#a6e22e>renderer</span>]
      <span style=color:#a6e22e>unsafe</span> = <span style=color:#66d9ef>true</span>
</code></pre></div><p>Terminal のテーマだと本文と引用の違いわかりにくかったのでスタイルを変えてみた。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=color:#f92672>blockquote</span> {
  <span style=color:#66d9ef>background</span>: <span style=color:#ae81ff>#eafff4</span>;
  <span style=color:#66d9ef>color</span>: <span style=color:#ae81ff>#2d3330</span>;
  <span style=color:#66d9ef>font-style</span>: <span style=color:#66d9ef>italic</span>;
}
</code></pre></div><ul>
<li>
<p>変更前</p>
<figure><img src=/diary/img/2021/1002_blockquote-before.png>
</figure>
</li>
<li>
<p>変更後</p>
<figure><img src=/diary/img/2021/1002_blockquote-after.png>
</figure>
</li>
</ul>
<p>日付の表記を少し大きくして目立つようにした。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css>.<span style=color:#a6e22e>post-date</span> {
  <span style=color:#66d9ef>font-weight</span>: <span style=color:#66d9ef>bold</span>;
  <span style=color:#66d9ef>font-size</span>: <span style=color:#ae81ff>1.3</span><span style=color:#66d9ef>rem</span>;
}
</code></pre></div>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1001/>インボイス制度への準備</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-01
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/hugo/>hugo</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/gig/>gig</a>&nbsp;
</span>
<div class=post-content>
<p>夜はドラクエタクトやってて2時過ぎに寝て7時に起きた。気のせいか、日記を書くようになってから早く寝付けるようになった。まつのさんが twitter で久しぶりに Python 書いたとツィートしていて、何気なくふと <a href=https://github.com/line/line-bot-sdk-python/pull/340>Implement experimental asyncio support #101 #340</a> をみて、そのツールの関係者でもないのに勝手にクソリプ的なレビューコメントをした。気付いてしまったらみなかった振りするのも気持ち悪いので。</p>
<h2 id=インボイス制度の準備>インボイス制度の準備</h2>
<p>2023年10月1日から <a href=https://www.nta.go.jp/taxes/shiraberu/zeimokubetsu/shohi/keigenzeiritsu/index.htm>消費税の軽減税率制度・適格請求書等保存方式（いわゆるインボイス制度）</a> が開始される。開始される前に適格請求書発行事業者に登録しておく必要があり、その登録受付が今日から開始された。前に知人が教えてもらった解説動画を見返した。</p>
<div class=video-container>
<iframe src=https://www.youtube.com/embed/E0lOsLfj1T0 allowfullscreen title=消費税インボイス方式対策として今からやっておくべき３つのことをお話します。【簡易課税で税負担1/2に！？】></iframe>
</div>
<p>ちなみにうちの会社は今期から課税事業者になるのでインボイス制度開始による益税の影響は受けない。前期の決算で消費税を算出したとき、本則課税と簡易課税なら後者の方が46%の納税金額が少なくなることがわかった。IT 業界は経費に占める人件費の割合が大きい (人件費は消費税がかからない) ので簡易課税の方が節税になるのではないかという気がする。そのため、簡易課税で申請している。一度、申請すると2年間適用され、不適用届出を出さない限りはずっと簡易課税で継続される。</p>
<p>国税庁の <a href=https://www.nta.go.jp/taxes/shiraberu/zeimokubetsu/shohi/keigenzeiritsu/invoice_shinei.htm>申請手続</a> をみながら￼e-Tax (WEB 版) で申請した。</p>
<p>個人で副業を受けることを想定すると、個人でも適格請求書発行事業者に登録した方がよいのだけど、私の場合、自分の会社なので法人で仕事を受けるのと個人で仕事を受けることの違いって何だろう？とわからなくなった。法人税と個人の所得税の税率の違いの話しは一旦置いておいて、最も大きな違いは会社で仕事を受けても(直近の)給与は増えないのでその報酬を自由には使えない。個人で仕事を受けたらその報酬を自由に使えるぐらいかな？もうちょっとその違いを調べ直してから考えよう。先の youtube 動画の中で税理士さんが「免税事業者という制度をやめたらいいのに。。。」と言ってたけど、個人はどうしよう？と悩んでしまう本質は免税事業者という概念があるからというのは正しいと思う。</p>
<h2 id=terminal-のカスタマイズ>Terminal のカスタマイズ</h2>
<p>hugo の Shortcodes で <code>class</code> で任意の CSS クラスを指定できる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>{{&lt; <span style=color:#f92672>youtube</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;E0lOsLfj1T0&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;video-container&#34;</span> &gt;}}
</code></pre></div><p><code>static/style.css</code> をカスタムの CSS として読み込んでくれる。youtube のビデオサイズをよしなに調整するために次のスタイルを定義した。なかなか難しい。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css>.<span style=color:#a6e22e>video-container</span> <span style=color:#f92672>iframe</span> {
    <span style=color:#66d9ef>border</span>:<span style=color:#ae81ff>0</span>;
    <span style=color:#66d9ef>max-width</span>: <span style=color:#ae81ff>600</span><span style=color:#66d9ef>px</span>;
    <span style=color:#66d9ef>max-height</span>: <span style=color:#ae81ff>338</span><span style=color:#66d9ef>px</span>;
    <span style=color:#66d9ef>width</span>: <span style=color:#ae81ff>100</span><span style=color:#66d9ef>%</span>;
    <span style=color:#66d9ef>height</span>: <span style=color:#ae81ff>50</span><span style=color:#66d9ef>vh</span>;
}
</code></pre></div><h2 id=joel-on-software>Joel on Software</h2>
<p>読み終えた。ソフトウェアの本で test of time (時の試練？) に耐えるのは相当に難しい。本書だとマネジメントや教育、ビジネスや経営に関する内容はいまでも有効でおもしろかった。また後日ブログに書評を書く。いまとなっては手放しでお勧めできる本ではないため、どういう切り口で書くかが難しい。自分にとって学びとして身につけたいと思った本はなるべく書評を書いて自分の言葉で説明できるようになっていきたい。</p>
<h2 id=カジュアル面談>カジュアル面談</h2>
<p>プロジェクトマネージャーを募集している会社の CTO と面談。先方の時間が15分しかないという話しだったので事前に質問は連絡しつつ、バックエンドは Go 言語を使っているという話しだったので私が過去に書いたブログ記事やちょっと前に作った <a href=https://github.com/kazamori/go-sql-executor>go-sql-executor</a> を連絡して、技術選考の参考にしてほしいと伝えた。募集要項からスクラムを採用するように読めたのでその背景を聞いたところ、外部の技術顧問が推奨しただけでとくにこだわりはないという。いまもメンバーは8人いて1週間のスプリントでスクラムっぽい運用はしているとのこと。私の言う、課題管理とイテレーション開発の概要を軽く説明しつつ、それを実践するためにプロジェクトマネージャーをやりたくて、その実践の場を探しているといった話しをした。外部の技術顧問が欠席したせいか、Go 言語の開発に関する質問はとくになかった。メンバーはすべて業務委託という話しなので寄せ集めグループのドタバタプロジェクトなんだろうなという印象を受けた。心理的安全性や一体化マネジメント法とか勉強したんで <em>グループ</em> じゃなくて <em>チーム</em> 開発できるマネジメントがやりたいなぁ。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/0930/>窓のある部屋</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-09-30
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/gig/>gig</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>夜は自民党総裁選の総括の記事を読んでた。政治に関心があるわけではないが、選挙後の総括にはとても関心がある。とくに負けた人がどんなことを言うのか、敗因をどう分析するのか。シンゴジラで矢口の発した <em>「政界は敵か味方しかいない。シンプルだ。性に合ってる」</em> という言葉が好き。選挙というわかりやすい勝ち負けが明確に出る仕組みは確かにシンプルだ。その後、3時まで本を読んで寝て7時ぐらいに起きた。</p>
<h2 id=カジュアル面談準備>カジュアル面談準備</h2>
<p>課題管理と開発方法論の体系化のため、プロジェクトマネージャーの案件を探している。<a href=https://remogu.jp/>Remogu</a> というリモートワークxエンジニア専門のサイトでギグワークできないかを検討中。ある会社を提案されたのでその会社のサイトとサービス内容を調べてた。飲食業界向けに提供しているサービスを、これまではアウトソースで開発していたシステムを内製化するために開発者を募集しているようだった。いま風に言えば、DX の1つと言えるだろう。これから内製の開発チームを作っていくとのこと。言うても CTO (PMO) 以外はすべて業務委託で集めるとのこと。デメリットはチームにならず、寄せ集めの集団になってしまう懸念がある一方、メリットとして採用したものの、マッチングしなかったメンバーの契約更新しないことで入れ替えることができる。明日、その会社の人たちとカジュアル面談をして双方のマッチングをみてみる。</p>
<h2 id=joel-on-software>Joel on Software</h2>
<p>昨日の続き。夜に読み切ろうと思っていたけど、ドラクエタクトの新しいイベントがリリースされて、それやってたら疲れて寝てしまった。あともうちょと。特定の技術に言及している内容は2000年代半ばの話しなのでいまとなっては有効ではないものや歴史書のように読めたりもする。中盤からソフトウェアビジネスやソフトウェア会社の運営などが書いてあって、マイクロ法人を始めたばかりの私にとっては興味深い。例えば、オフィスの要件は次の内容をあげている。</p>
<ol>
<li>1人1人にちゃんとドアの付いた個室があること、絶対条件</li>
<li>コンセントがたくさん必要、新しいおもちゃを机の上でつなげられる</li>
<li>データケーブルを簡単につなぎ直せる</li>
<li>ペアプログラミングが可能であること (L字型の大きい机を用意する)</li>
<li>遠くのものを眺めて目を休められるよう窓を設け、ディスプレイを壁に向かって置いてはいけない</li>
<li>オフィスはそこで時を過ごすのが快適なたまり場のような場所であるべき</li>
</ol>
<p>その上で、会社の成功は、ある部分までプログラマーが実質オフィスに暮らすようになるかどうかにかかっているので、オフィスが平均的なプログラマーの家よりも素敵な場所である必要があると述べている。実際、私は過去に働いた6社すべてで泊まり込みで働いたこともあるのでまさに暮らすように働いていた時期もあったかもしれない。机に伏して寝たり椅子を並べて寝るよりは、ソファやくつろぎスペースで寝る方が快適だった。あと、いまのオフィスの唯一の欠点は窓がないことだと1年ほど働いて、ちょうど私も実感していた。窓がないと1日の天候の移り変わりや季節の移り変わりがみえなくて気分転換ができないのだ。次にオフィスを引っ越すときは窓がある部屋を条件に加えようとまさに考えていた。</p>
<p>あと自分にとっての課題管理の原点をみつけた。過去に働いていた会社で、課題管理システムに顧客からの問い合わせや開発者のTODOやシステム管理のメモなど、すべての情報を入れられていた。こういった課題管理システムの使い方は次の記事に影響を受けて実践されたものだったと当時の上司に確認した。たったこれだけの話なんだけど、私にとっては原点なので宝ものを発見したかのような嬉しい気持ちになった。</p>
<ul>
<li><a href=https://www.joelonsoftware.com/2006/12/20/half-a-million-bugs/>Half a million bugs!</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/0929/>読書とイベント参加</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-09-29
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/java/>java</a>&nbsp;
</span>
<img src=/diary/img/2021/0929_temperature.jpg class=post-cover alt=読書とイベント参加>
<div class=post-content>
<p>0時頃に寝て8時ぐらいに起きる。やや発熱して疲れてたせいか、久しぶりに早く寝付けた。一日を通して体温は平均36.7℃なのでもう副反応は過ぎたみたい。体調もまったく悪くない。</p>
<h2 id=joel-on-software>Joel on Software</h2>
<p>過去に働いていた会社での課題管理のやり方や開発方法論について、当時の上司と雑談したところ <a href=https://en.wikipedia.org/wiki/Joel_Spolsky>Joel Spolsky</a> に由来するということを聞いた。そこで今更ながらに <a href=https://www.shoeisha.co.jp/book/detail/9784798118925>More Joel on Software</a> を読むことにした。2000年代に書かれた記事の内容なのでいまとなっては古典に分類される本かもしれない。だいたい半分ぐらい読んだ。技術の詳細に言及した内容は古くなっていてあまり有用ではないものも多いけど、マネジメントや優秀なプログラマーの特性などはいまでも通用する内容に思えた。あとで私が関心をもった内容をブログでまとめることにする。</p>
<p>第10章コンピュータサイエンスの学生へのアドバイスで「卒業するまでにミクロ経済学を学ぶこと」という節がある。著者がミクロ経済学を推奨する理由を引用するとこれら。</p>
<blockquote>
<p>ミクロ経済学はビジネスで重要な理論すべての基礎となっている。需要と供給とか、競争優位とか、NPV とか割り引きとか限界効能について知らなければ、ビジネスの仕組みが全然理解できないからだ。</p>
<p>マクロ経済学は、当たっているよりもはずれていることの方が多い。スキップしてよい。それ以降はただ悪くなっていく一方。</p>
<p>ビジネスの基礎を理解しているプログラマは、理解していないプログラマよりもビジネスにおいてずっと価値が高いからだ。</p>
</blockquote>
<p>学んだことがなかったので簡単そうな <a href=https://www.iwanami.co.jp/book/b285381.html>ミクロ経済学入門の入門</a> を購入した。</p>
<p>読んでて気づきを得てふとツィートした。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>なので、システムのコンポーネントに関しての意思決定をするとき、必ずしも上位の意思決定者の判断が正しいわけではなく、現場のメンバーに判断を委ねる状況が最適な場合もある。一方向じゃなく、双方向の情報の非対称性を解消する取り組みが大事。</p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1443024587944464388?ref_src=twsrc%5Etfw">September 29, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<h2 id=java-17-リリースイベント>Java 17 リリースイベント</h2>
<p><a href=https://jjug.doorkeeper.jp/events/127204>【オンライン】 JJUGナイトセミナー「Java 17 リリース記念イベント with Foojay」9/29(水) 開催</a> に参加した。Java の LTS はいま過渡期でややこしいことになって、8, 11, 17 になる。リリースされたばかりの Java 17 は LTS で重要なバージョンになる。<a href=https://www.oracle.com/jp/java/technologies/java-se-support-roadmap.html>Oracle Java SE Supportロードマップ</a> から Premier Support 期限が次になる。</p>
<ul>
<li>8: 2022年3月</li>
<li>11: 2023年9月</li>
<li>17: 2026年9月</li>
</ul>
<p>いま 11 を使っている組織はいいが、8 を使っている組織もまだまだ多いと推測する。8 と 11 の Premier Support 期限が近いことから 8 を使っている組織は 17 に一気にバージョンアップすることが想定される。どこかのタイミングで Java 17 を前提した開発に切り替わっていくだろうと思われる。</p>
<p>最初の発表は Pattern Matching & Sealed Classes に特化した内容。これまでは instanceof と共に使う機能だった。switch 構文とパターンマッチングを組み合わせると、コードが簡潔になって <a href=https://en.wikipedia.org/wiki/Cognitive_complexity>Cognitive complexity</a> を下げるという。発表者が Type Guard という呼び方をしていた。Type Guard をググると TypeScript の記事がヒットする。<a href=https://openjdk.java.net/jeps/406>JEP 406: Pattern Matching for switch (Preview)</a> ではこれを <em>guarded pattern</em> と呼んでいる。まだあまり一般的な用語ではないのかもしれない。あとは Sealed クラスと組み合わせた switch 構文のコード例では、すべてのパターンが網羅されていることをコンパイラが検出して <em>default</em> 句が不要になるコード例も紹介されててよさそうにみえた。但し、switch 構文のパターンマッチングは preview なので実際には 17 ではまだ使われないのかもしれない。今後もさらに switch 構文とパターンマッチングの機能拡張が行われる展望らしい。</p>
<p>2番目の発表は Java 17 の全体的な話し。fix した issues のツリーマップで contributor の分布を紹介していた。oracle, redhat, independent の順番に多い。oracle が過半数以上。日本だと ntt data が一番貢献してた。spring フレームワークの次期バージョンは Java 17 がベースラインになる。java のアップグレードを促す要因の1つにはなるはず。lts なのになぜ preview や incubator があるのか？openjdk 開発側は6ヶ月というリリースサイクルを守っている。lts にするか否かは開発者が決めているらしい。graalvm のリリースサイクルは java とは異なる。こちらは年3回のリリースなので次のリリースで出てくるはず？いくつか jep の内容を紹介してた。jep の概要は <a href=https://qiita.com/ReiTsukikazu/items/407d61cb66fa4f562bf9>Java17の新機能をざっくり紹介</a> にまとまっている。さくらばさんがパッケージの api レベルでの変更を <a href=http://www.javainthebox.com/2021/09/jepjava-17.html>JEPでは語れないJava 17</a> にまとめている。ざっと目を通して興味があるものがあればみとくぐらい。8 から 17 への移行の記事やドキュメントなども紹介されてた。移行について基本は <a href=https://docs.oracle.com/en/java/javase/17/migrate/getting-started.html>Oracle JDK Migration Guide</a> を読めとのこと。8 から 17 の移行せずにその次の 23 を待つと作り直しになってしまいますよと 17 への移行を推奨してた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/0928/>副反応はいずこ？</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-09-28
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/hugo/>hugo</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/halp/>halp</a>&nbsp;
</span>
<img src=/diary/img/2021/0928_pocarisweat-s.jpg class=post-cover alt=副反応はいずこ？>
<div class=post-content>
<p>2時過ぎぐらいに寝て5時前ぐらいに起きる。やや熱っぽいかなぁぐらいの印象でもう一度寝る。8時前に起きるともう平気になってた。昨日、書籍や macbook を持って帰ってきて引きこもり対策してたけど、体調が悪くないのでオフィスへ行くことにした。お昼から1時間おきに熱を測ってみたら37℃前後なので少し熱は出ていたみたい。とくにしんどくなかったので普通にお仕事してた。</p>
<h2 id=水分補給>水分補給</h2>
<p>副反応対策として、ポカリスエットイオンウォーターの粉末をウォーターサーバーの水に混ぜて飲んでみる。イオンウォーターと普通の <a href=https://www.otsuka.co.jp/faq/ionwater/01.html>ポカリスエットとの違いは何ですか？</a> によると、基本的な成分は同じで低カロリーという違いがあるらしい。</p>
<h2 id=日記サイト構築>日記サイト構築</h2>
<p><a href=https://github.com/t2y/diary>diary</a> リポジトリに push すると GitHub Actions で静的サイトをビルドして GitHub Pages で扱うための gh-pages ブランチに push される。<a href=https://qiita.com/peaceiris/items/d401f2e5724fdcb0759d>GitHub Actions による GitHub Pages への自動デプロイ</a> を参考にした。gh-pages ブランチにあるものが次の URL で参照される。リポジトリ名の <code>diary</code> がパスになるらしい。</p>
<ul>
<li><a href=https://t2y.github.io/diary/>https://t2y.github.io/diary/</a></li>
</ul>
<p>まだ設定は不完全だけど、運用しながらおいおい設定を詰めていく。<a href=https://gohugo.io/>Hugo</a> は会社のホームページにも使っているので慣れているのと、使い心地も気に入っているのでこのまま使い続ける。会社のサイトはたまにしか更新しないので日記を書く方が更新頻度があがって Hugo を触るインセンティブになるかもしれない。</p>
<h2 id=ジャーナリングとは>ジャーナリングとは</h2>
<p>読みかけで放置していた <a href=https://bunkyosha.com/books/9784866510149>「手で書くこと」が知性を引き出す 心を整え、思考を解き放つ新習慣「ジャーナリング」入門</a> を読み終えた。この日記も簡易的なジャーナリングになればよいと願っていたりする。「書くこと」への期待値を高くもって読み進めたせいか、内容が薄かったように思えた。ジャーナリングを行うテーマのワークシートが24個ついていて、ページ数を稼いでいるように感じた。日常生活であまり書いていない人には関心をそそるかもしれないけど、プログラマーは日常生活で平均以上の文字数を書いていると推測する。私にとってはあまり目新しいことはなかった。</p>
<p>マインドフルネス (気づき) を得るための方法論の1つとして書く瞑想=<strong>ジャーナリング</strong>を推奨している。手書きとキーボードのタイピングでは効果が異なるという研究成果はおもしろかった。手書きの方が記憶力や理解力を高める、脳波はアルファ波が出るといった研究があるという。従って、より創造的な仕事に向くかもしれない。ジャーナリングの研究によって、わかってきたことの1つは、自己や他者、社会への適応力を高めると示唆されている。ここでいう「適応力が高まる」というのは、課題や問題をどうとらえ、これからどう行動すればよいかのヒントにつながる可能性があるという意図らしい。ジャーナリングは心身の健全性にもプラスの影響をもたらされる可能性が高いといった研究も紹介されている。私の感覚的にも、書くことで課題や問題を明確化することはストレスを軽減して健康になるような気がする。</p>
<blockquote>
<p>ジャーナリングをする際に大事なことは「考えない」 ということです。</p>
</blockquote>
<p>書く瞑想とも言われる所以にも思える。そのままの状態を観察して気づきとするような、そういう姿勢を説いている。この内容は業務の取り組みへの応用からは離れてしまう。</p>
<p>前に <a href=https://note.com/t2y1979/n/n4713058f48ce>メタ認知で〈学ぶ力〉を高める：認知心理学が解き明かす効果的学習法</a> の著者が <a href=https://www.jstage.jst.go.jp/article/jjet/37/Suppl./37_KJ00009957528/_article/-char/ja>タイピング思考法の開発とその有効性の検討</a> という研究発表をしていた。この研究は、思考過程を推測する手法として、発話思考法における問題を解決するタイピング思考法を提案し、既知の問題を解決しつつ、発想の促進効果もみられてそこそこよい結果が出たというものであった。思考過程を発話とタイピングの2つで比較している。比較項目に手書きがあると少し結果に差異が出たりしたのかなぁとか思った。</p>
<h2 id=atlassian-community-online-meetup-の参加>Atlassian Community Online MeetUp の参加</h2>
<p>課題管理システムとチャットツールを連携する <a href=https://halp.com/>Halp</a> というツールがあるらしい。うちは課題管理システムにクラウド jira を使っていて、Atlassian 社から届くメールで本イベントのことを知った。Atlassian Community Event の頭文字をとって ACE と呼ぶらしい。</p>
<ul>
<li><a href=https://ace.atlassian.com/events/details/atlassian-tokyo-presents-48-tokyo-atlassian-community-online-meetup-dian-pu-bizinesudenohuo-yong-shi-li-halphuo-yong-tipsxin-aceridafa-biao/>#48 Tokyo Atlassian Community Online MeetUp - 店舗ビジネスでの活用事例＆Halp活用Tips＆新ACEリーダー発表</a></li>
</ul>
<p>初めて ACE イベントに参加した。コミュニティ (ユーザー) 主体のイベントになるらしい。運営メンバーの中に前職での jira チームのリーダーが出ていてちょっとびっくりした。何度かやり取りしてお世話になった方だったのでこういうところでも活動しているんだと思ってさらに尊敬の念が深くなった。halp については、想像通り、非開発者向けに slack の操作だけで jira の課題管理システムと連携するためのサービスとしてよさそうだった。slack (halp) と jira は双方向にデータの同期ができる。いまのところ、halp の無料プランがないので試せてないけど、なにかの機会で一通り触ってみたいと思うサービスだった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/0927/>コロナワクチン2回目</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-09-27
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/xr/>xr</a>&nbsp;
#<a href=/diary/tags/hugo/>hugo</a>&nbsp;
</span>
<div class=post-content>
<p>土曜日は昼寝してたくさん寝たせいか、昨日はうまく寝れなかった。4時頃に <a href=https://bunkyosha.com/books/9784866510149>「手で書くこと」が知性を引き出す 心を整え、思考を解き放つ新習慣「ジャーナリング」入門</a> の序章と1章を読んだ。手で書くのとキーボードをタイピングするのでは前者の方が脳が活性化されるらしい。指先の細かい制御が脳に効果的なようだ。5時ぐらいから寝て8時前に起きる。</p>
<h2 id=horizon-workrooms>Horizon Workrooms</h2>
<p>Oculus Quest 2 を使って顧問の知人と workrooms を使って仕事の打ち合わせをやってみた。</p>
<ul>
<li><a href=https://www.oculus.com/workrooms/>https://www.oculus.com/workrooms/</a></li>
</ul>
<p>9時から1時間強ほど打ち合わせ。</p>
<p>macbook を Oculus リモートデスクトップで接続して、ホワイトボード (スクリーン) で共有しながらの会話をやってみた。所感としてはこんなところ。</p>
<ul>
<li>リモートデスクトップと画面共有
<ul>
<li>目の前の画面を大きくできるのでホワイトボード (スクリーン) よりみやすい</li>
<li>眼の前の画面をみて説明すると、相手の顔が見えないので vr のメリットが半減する</li>
<li>半仮想モードで話しながらメモをとるのは可能ではあるが、現実でやるよりも難しいので効率が悪化する</li>
<li>パソコンの操作が現実よりも難しいので、操作しないインセンティブになりがち</li>
<li>リモートデスクトップで画面共有をしていたせいか、<br>
フル充電した状態から1.5 時間ぐらいでバッテリーが少ない警告が出た</li>
</ul>
</li>
<li>ヘッドセットの位置調整がうまくいかないと画面の文字がぼやけたりする</li>
<li>ヘッドセットの固定がうまくいかないと、会議に集中できず、ストレスになる</li>
<li>1時間程度の会議であれば、とくに vr による疲れなどは気にならない</li>
</ul>
<p>打ち合わせ終わってから NeosVR をするために Linux マシンと Oculus Quest 2 を接続する方法を検討。</p>
<ul>
<li><a href=https://neosvrjp.memo.wiki/>https://neosvrjp.memo.wiki/</a></li>
</ul>
<p>Oculus Link アプリを PC にインストールする必要があるが、Windows 向けにしか提供されていない。wine で動かない、一通りツール類をインストールして試してみたつもりだけど、このエラーを解決できなかった。諦める。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ wine --version
wine-5.0 <span style=color:#f92672>(</span>Ubuntu 5.0-3ubuntu1<span style=color:#f92672>)</span>

$ wine ~/Downloads/OculusSetup.exe
002a:err:mscoree:CLRRuntimeInfo_GetRuntimeHost Wine Mono is not installed
</code></pre></div><p>Windows マシンを買うにしても PCVR をするにはそこそこのスペックが必要になり、ざっと調べると10-20万円ぐらい。ノートPCでも15-16インチぐらいのを購入すればスペック的には大丈夫そうといった記事がいくつかみつかった。</p>
<ul>
<li><a href=https://vr-game.pw/blog/how-to-chooes-vr-pc/>https://vr-game.pw/blog/how-to-chooes-vr-pc/</a></li>
<li><a href=https://kimono-oyaji.com/laptoppc-for-hmd-01/>https://kimono-oyaji.com/laptoppc-for-hmd-01/</a></li>
</ul>
<p>このために Windows マシンを買ってまでやるほどのことでもないので PCVR は断念して普通に Linux マシンで NeosVR に挑戦することに決めた。</p>
<h2 id=お昼>お昼</h2>
<p>14時前ぐらいにお昼ご飯に出かけた。近所の居酒屋さんが緊急事態宣言の期間だけお弁当を販売している。いつもは13時頃には売り切れているのに、今日はたまたま14時なのに3個も残ってた。500円でおかずがいろいろ入っててコスパがいい。そのままお弁当を買ってオフィスで食べることにした。</p>
<h2 id=日記を書く環境を決める>日記を書く環境を決める</h2>
<p>この後、コロナワクチン2回目摂取があるので、副反応の発熱でいつ作業が中断してもよいように日記を書くための環境を構築することにした。</p>
<p>ざっくり条件はこんな感じ。</p>
<ul>
<li>目的は「書くこと」そのもの</li>
<li>シンプルに自分が読むためだけの文章を書ければよい</li>
<li>エディターやビューアをロックインされたくない</li>
<li>コンテンツをテキスト (markdown) で扱いたい</li>
<li>コンテンツをサービスにロックインされたくない</li>
</ul>
<p>それぞれのツールを検討してたときのメモ。</p>
<ul>
<li>ブログプラットフォームは使いたくない
<ul>
<li>hatena, medium, note はすでに使っているので除外</li>
<li>広告やガジェットや管理ツールとかいらない</li>
<li>シンプルさがなくなってしまう</li>
</ul>
</li>
<li>メモツールに書く
<ul>
<li><a href=https://obsidian.md/>obsidian</a> や <a href=https://hackmd.io/>hackmd</a> など</li>
<li>メモツールなので日記を書く用途とはちょっとズレる</li>
<li>シンプルさがなくなってしまう</li>
</ul>
</li>
<li>wiki に書く
<ul>
<li><a href=https://www.notion.so/>notion</a> や <a href=https://github.com/weseek/growi>growi</a> など</li>
<li>シンプルさがなくなってしまう</li>
</ul>
</li>
<li>ジャーナルアプリに書く
<ul>
<li>まさに日記そのものだけど、有償のプロダクトが多い</li>
<li>エディターは専用アプリになりそう</li>
</ul>
</li>
<li>自分で日記ツールを作る
<ul>
<li>headless CMS とフロントエンドを実装する</li>
<li>いま日記を書き始めたいのにいつ書き始められるかわからない</li>
</ul>
</li>
</ul>
<p>最終的に残ったのは <a href=https://docs.github.com/ja/pages>GitHub Pages</a> だった。</p>
<ul>
<li>静的サイトジェネレーターに <a href=https://gohugo.io/>Hugo</a> を使う</li>
<li>Hugo のテーマをカスタマイズすればシンプルにできそう？</li>
<li>自分の好きなエディターで書ける</li>
<li>自分の好きなビューア (ブラウザ) で読める</li>
<li>Git リポジトリなのでサービスにロックインされない</li>
</ul>
<h2 id=コロナワクチン2回目摂取>コロナワクチン2回目摂取</h2>
<p>1回目の後、最速の日程から1週間ほど遅れてネット予約が取れた。摂取会場のクリニックでは、午前中は1回目、午後は診療やって、夕方に2回目摂取の時間帯になっているみたい。したがって17時という遅い時間帯に摂取した。私を含め、6人しか患者がいなかったので混雑も待ち時間もなくすぐに摂取して、15分ほど様子をみて帰ることができた。</p>
<p>ワクチン打った後、facebook にコメントを残したり、家族へ LINE でメッセージを送った。</p>
<p>それで何が変わるかわかってないけど、一人暮らしなので万が一、体調が悪くなって誰も気づかないままそのまま死んだとしても、ワクチンで運が悪くてしんだんやなと周りの人が気付けるようにという意図がある。一体、誰に気を使っているのか、自分でもよくわからないけど、自分が不慮の事故で死んでしまったとして、身近な人には多少なりとも背景が伝わることでお別れの挨拶変わりにはなるかな？という、変な気遣いをしている。</p>
<h2 id=terminal-のカスタマイズ>Terminal のカスタマイズ</h2>
<p>副反応の発熱でいつ作業が中断してもよいように日記を書くための Hugo の Terminal というテーマの設定を始めた。</p>
<ul>
<li><a href=https://github.com/panr/hugo-theme-terminal>https://github.com/panr/hugo-theme-terminal</a></li>
</ul>
<p>18時から20時ぐらいまでオフィスで作業して、買い物して帰ってきて晩ご飯食べて、その後も環境構築の作業をした。翌2時の時点で全くしんどくない。<code>config.toml</code> の設定項目に対するドキュメントがないけど、直接 grep で html のソースをみた方が早いことに気づいた。</p>
<p>とりあえずコンテンツを書いてみて、そこそこの見た目で表示できるようになった。まだ完全ではないので随時、後日、ソースを読みながら設定していく。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/0926/>iostat-tool メンテ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-09-26
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/pypi/>pypi</a>&nbsp;
#<a href=/diary/tags/iostat/>iostat</a>&nbsp;
</span>
<img src=https://pypi.org/static/images/logo-large.6bdbb439.svg class=post-cover alt="iostat-tool メンテ">
<div class=post-content>
<h2 id=再現調査>再現調査</h2>
<p>お昼ぐらいオフィスに行って事前に下調べしてあった iostat-tool の不具合修正をする。</p>
<ul>
<li><a href=https://github.com/t2y/iostat-tool/issues/3>https://github.com/t2y/iostat-tool/issues/3</a></li>
</ul>
<p>前職でディスクI/Oの振る舞いを調査していたときに iostat のアウトプットを直接みてもわからないので視覚化するツールを作った。例えば、<code>iostat -ymxt 1</code> のアウトプットは次のようなログになる。</p>
<pre tabindex=0><code>06/13/2018 02:10:50 PM
avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.47    0.00    0.24    0.18    0.00   99.11

Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
sdd               0.07    45.88    1.57    0.59     0.08     0.18   246.55     0.26  121.04    1.28  436.94   2.07   0.45
sdh               0.07    45.78    1.59    0.60     0.08     0.18   245.64     0.22  101.97    1.17  367.51   1.89   0.41
sdb               0.25    74.42    5.70    0.87     0.57     0.29   268.00     0.32   49.24   38.06  123.00   1.83   1.20
sdg               0.07    45.84    1.57    0.60     0.08     0.18   246.12     0.26  118.32    1.24  426.10   2.05   0.44
sdc               0.10    46.79    1.62    0.63     0.09     0.19   246.47     0.16   72.62   11.13  232.29   1.39   0.31
sde               0.07    45.79    1.56    0.60     0.08     0.18   246.16     0.21   98.68    1.10  351.50   1.83   0.39
sdj               0.07    45.88    1.56    0.60     0.08     0.18   245.68     0.21   95.91    1.07  341.03   1.80   0.39
sdf               0.07    45.76    1.58    0.60     0.08     0.18   245.70     0.19   85.95    1.03  308.11   1.79   0.39
sdk               0.07    46.68    1.56    0.61     0.08     0.18   247.68     0.28  128.43    1.25  455.92   2.17   0.47
sdi               0.07    45.67    1.57    0.60     0.08     0.18   244.58     0.21   96.74    1.11  344.99   1.84   0.40
sda               0.16    15.06    0.15    1.95     0.01     0.07    72.69     0.13   61.45    3.77   65.84   8.24   1.73
</code></pre><p>当時 rhel6 相当のディストリビューションで検証していた。そのため、その iostat のバージョンしかテストしてなかった。その後、時間が経って新しい項目が増えたり、同じ項目でも名前が変わったりしたみたい。vagrant で <a href=https://app.vagrantup.com/bento/boxes/centos-8>bento/centos-8</a> の環境を構築して <code>man iostat</code> や iostat のアウトプットを出力しながら確認した。</p>
<p>CentOS 8.3 の systat 11.7.3 のバージョンのアウトプットはこんな感じ。</p>
<pre tabindex=0><code>09/26/21 03:35:19
avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.00    0.00    0.00    0.00    0.00    1.00

Device            r/s     w/s     rMB/s     wMB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util
sda              1.00    0.00      0.01      0.00     0.00     0.00   0.00   0.00    1.00    0.00   0.00     8.00     0.00   2.00   0.20
</code></pre><h2 id=時刻のフォーマットが違う>時刻のフォーマットが違う</h2>
<p>これは sysstat のバージョンによるものではないけど、ロケールの <code>LC_TIME</code> のエンコーディング指定を変えると時刻のフォーマットが変わることに気づいた。これも en 環境しかチェックしてなかったから今回 ja でも正しく時刻をパースできるように修正した。</p>
<pre tabindex=0><code>old: 06/13/2018 02:10:50 PM  # LC_TIME=&quot;en_US.UTF-8&quot;
new: 09/26/21 03:35:19       # LC_TIME=&quot;ja_JP.UTF-8&quot;
</code></pre><h2 id=device-の軽微な変更と項目の変更>Device の軽微な変更と項目の変更</h2>
<p>新しいフォーマットだと <code>Device:</code> のコロン文字がなくなってたりしてパースできなくなっていた。あと次の項目が名前変更、または新規追加されてた。</p>
<ul>
<li>aqu-sz</li>
<li>rareq-sz</li>
<li>wareq-sz</li>
<li>%rrqm</li>
<li>%wrqm</li>
</ul>
<p>基本的にパーサーをいじる必要はなくて項目の追加などで対応できた。当時、検証していたとき、作業がうまくいってなくて2-3日で突貫で作ったツールなのでパーサーはあまりきれいに実装はされていない。作った本人がみても1-2時間デバッグしながら直す必要があった。今後も iostat のアウトプットに大きな変更があるとは思えないからまぁいいかな。</p>
<h2 id=generator-based-coroutines-の-deprecated>generator-based coroutines の deprecated</h2>
<p>このツールを作った当時、python 3.4 以上をサポートする必要があったの generator-based coroutines で実装した気がする。それが 3.8 以降は deprecated になっているみたい。今回保守するときにサポート対象を 3.6 以上に変更したのですべて <code>async def</code> で書き直せるようになった。そう急ぐ必要もないのでまた今後、気が向いたら async 周りの実装も見直しながらやってみる。覚えていたら。</p>
<blockquote>
<p>Deprecated since version 3.8, will be removed in version 3.10: Use async def instead.</p>
<p><a href=https://docs.python.org/ja/3/library/asyncio-task.html#asyncio.coroutine>https://docs.python.org/ja/3/library/asyncio-task.html#asyncio.coroutine</a></p>
</blockquote>
<h2 id=iostat-tool-030-リリース>iostat-tool 0.3.0 リリース</h2>
<p>2018年から約3年ぶりに保守した。ついでに GitHub Actions で lint check と doctest の CI を実行するように変更した。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>新しい iostat のログフォーマットにも対応して 0.3.0 をリリースした。<a href=https://t.co/zwFuomvStO>https://t.co/zwFuomvStO</a></p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1442023934195421185?ref_src=twsrc%5Etfw">September 26, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
</div>
</div>
<div class=pagination>
<div class=pagination__buttons>
<span class="button previous">
<a href=/diary/posts/page/14/>
<span class=button__icon>←</span>
<span class=button__text>最近の日記</span>
</a>
</span>
<span class="button next">
<a href=/diary/posts/page/16/>
<span class=button__text>過去の日記</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class="copyright copyright--user">
<span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span>
</div>
</div>
</footer>
<script src=/diary/assets/main.js></script>
<script src=/diary/assets/prism.js></script>
</div>
</body>
</html>