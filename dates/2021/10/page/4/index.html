<!doctype html><html lang=en>
<head>
<title>2021/10 :: forest nook</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=keywords content>
<meta name=robots content="noodp">
<link rel=canonical href=/diary/dates/2021/10/>
<link rel=stylesheet href=/diary/assets/style.css>
<link rel=stylesheet href=/diary/assets/green.css>
<link rel=stylesheet href=/diary/style.css>
<link rel=apple-touch-icon href=/diary/img/apple-touch-icon-192x192.png>
<link rel="shortcut icon" href=/diary/favicon.ico>
<meta name=twitter:card content="summary">
<meta name=twitter:site content="t2y">
<meta name=twitter:creator content>
<meta property="og:locale" content="en">
<meta property="og:type" content="website">
<meta property="og:title" content="2021/10">
<meta property="og:description" content>
<meta property="og:url" content="/diary/dates/2021/10/">
<meta property="og:site_name" content="forest nook">
<meta property="og:image" content="/diary/favicon.ico">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<link href=/diary/dates/2021/10/index.xml rel=alternate type=application/rss+xml title="forest nook">
</head>
<body class=green>
<div class="container full headings--one-size">
<header class=header>
<div class=header__inner>
<div class=header__logo>
<a href=/diary>
<div class=logo>
forest nook
</div>
</a>
</div>
<div class=menu-trigger>menu</div>
</div>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/diary/about>自己紹介</a></li>
<li><a href=/diary/dates>月別一覧</a></li>
<li><a href=/diary/tags>タグ一覧</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/diary/about>自己紹介</a></li>
<li><a href=/diary/dates>月別一覧</a></li>
<li><a href=/diary/tags>タグ一覧</a></li>
</ul>
</nav>
</header>
<div class=content>
<div class=posts>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1027/>bizpy 再開</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-27
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/recipe/>recipe</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
</span>
<div class=post-content>
<p>2時に寝て6時に起きた。前日の夜にウォーキングしたせいか、よく眠れた。朝活を終えてから朝ご飯を作って食べてそのままオフィスに出社した。6時起きを日課にした方が生活のリズムがよい。夕方に眠くなって1時間ほど昼寝した。</p>
<h2 id=朝活-ミクロ経済学入門の入門>朝活: ミクロ経済学入門の入門</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/228969/>【三宮.dev オンライン】リモート朝活もくもく会</a> で第4章の供給曲線を読んだ。需要曲線の逆からの視点なので考え方は同じで図の形が異なる。用語がいくつか出てきたのでまとめる。</p>
<ul>
<li>収穫逓減 (しゅうかくていげん): 製品をより多く生産するのにかかる経費が増大していくこと
<ul>
<li>生産活動において2倍の生産量を生み出すには2倍以上の経費がかかる</li>
</ul>
</li>
<li>費用関数: 生産量と費用との関係をあらわす</li>
<li>限界費用: 追加的に1単位生産する費用
<ul>
<li>3個を生産する費用は、1個目の限界費用 + 2個目の限界費用 + 3個目の限界費用
<ul>
<li>個数が増えるごとに費用は高くなっていく</li>
</ul>
</li>
<li>費用を図示するときは限界費用に分解した方が視覚的にわかりやすい</li>
</ul>
</li>
<li>限界費用逓増: 生産するごとに限界費用が高まっていくこと</li>
</ul>
<p>「<a href=https://dictionary.goo.ne.jp/word/kanji/%E9%80%93/>逓</a>」という漢字は「つぎつぎ」や「だんだん」という意味をもつ。</p>
<ul>
<li>プライステイカー: 自分の生産量が価格に影響を与えられない
<ul>
<li>減産んいより希少価値を高め価格を吊り上げる市場操作ができない</li>
</ul>
</li>
<li>独占企業: プライステイカーの反対。</li>
<li>利潤: 売上 - 経費</li>
<li>最適解: 利潤を最大化する生産量
<ul>
<li>あと1個追加して生産すると利益がマイナスになるところ</li>
</ul>
</li>
<li>生産者余剰: すべての企業の利潤の和</li>
<li>供給曲線: すべての企業の限界費用をヨコに足し合わせた曲線</li>
</ul>
<figure><img src=/diary/img/2021/1027_supply-curve.png>
</figure>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>昨日の続き。8.4 を読んで8章分散システムの問題を読み終えた。全体としても学びになったけれど、とくに 8.3 信頼性の低いクロックの節が全く開発・運用で意識したことがなかったので私にとっては学びになった。</p>
<blockquote>
<p>分散システムにおいて発生する厄介な問題がある。</p>
<ul>
<li>
<p>ネットワーク経由でパケットを送信しようとした場合、そのパケットはロストしたり、どれほど遅延するか分からない。同様に、レスポンスもロストしたり遅延したりするので、レスポンスを受け取れなかった場合には元々のメッセージが到達したかどうかも分からない</p>
</li>
<li>
<p>ノードのクロックは他のノードと大きくずれているかもしれない（できる限りの努力をして NTP をセットアップしたとしても）。クロックは急に進んだり戻ったりするかもしれず、たいていはクロックの誤差をうまく計る方法がないので、クロックに依存するのは危険</p>
</li>
<li>
<p>プロセスは処理中にいつどれほどの長さ一時停止するかもしれず（おそらくはstop-the-worldガベージコレクタのため）、他のノードから落ちていると見なされた後に自身に一時停止があったことを理解しないままに復活するかもしれない。</p>
</li>
</ul>
<p>こういった <strong>部分障害</strong> が生じうるのが分散システムの特徴と言える。ソフトウェアが他のノードが関わる何かをしようとした場合、それは時おり失敗したり、ランダムに速度が落ちたり、まったくレスポンスが返されない（そして最終的にはタイムアウトする）といった可能性がある。分散システムでは、部分障害への耐性をソフトウェアに組み込み、システムの構成要素が一部破損していてもシステム全体としては機能し続けられるようにする。</p>
<p>フォールトに耐えるための最初のステップはフォールトを <strong>検出</strong> することだが、それさえも難しい。多くのシステムは、ノードに障害が生じていることを検出する正確な仕組みを持たないので、ほとんどの分散アルゴリズムはリモートノードが生きているかどうかを判断するのにタイムアウトに頼る。しかし、タイムアウトはネットワークの障害とノードの障害を区別できず、ネットワークの遅延変動のために間違ってノードがクラッシュしていると誤検知することもある。弱っているものの落ちてはいないノードは、きれいに落ちているノードよりもさらに扱いが難しくなる可能性がある。</p>
<p>フォールトが検出されたとして、システムがそれに耐えられるようにすることも簡単ではない。マシン間にはグローバルな変数も、共有メモリも、共通の情報やその他何らかの共有された状態もない。ノードは現在の時刻についてさえ合意できず、ましてやもっと重大なことに合意することなどできない。あるノードから他のノードへ情報を流せる唯一の方法は、その情報を信頼できないネットワークを通じて送ることだけである。重要な判断は単一のノードだけで安全に下すことができないので、他のノードの助けを得てクオラムが合意に至るようにするためのプロトコルが必要となる。</p>
<p>同じ操作をすれば決まって同じ結果を返してくれるような、単一コンピュータにおける理想化された数学的な完全さの中でソフトウェアを書くのに慣れていると、分散システムの雑然とした物理的な現実への移行はちょっとしたショックを伴う。一方、分散システムのエンジニアは、しばしば単一のコンピュータ上で解決できる問題を簡単なものだと見なすが、実際のところ今日では単一のコンピュータがこなせる仕事量はかなりのものになっている。単一のマシンでシンプルにことを済ませられるなら、概してそうする価値はある。</p>
<p>分散システムを利用する理由はスケーラビリティだけではない。耐障害性や低レイテンシ（地理的にユーザーの近くにデータを置けることによる）も同様に重要な目標であり、こういったことは単一ノードでは実現できない。本章ではネットワーク、クロック、プロセスの信頼性の低さが避けがたい自然の法則なのかも調べた。安全ではなく、クリティカルではないシステムの多くでは、高価な高信頼性よりも安価な低信頼性が選択される。また、信頼性の高いコンポーネントを前提としているスーパーコンピュータも取り上げました。スーパーコンピュータはその前提が故に、コンポーネントに障害が生じてしまった場合には完全に停止させて再起動することになる。これに対し、分散システムはサービスレベルでは中断することなくいつまでも動作し続けられる。これは、少なくとも理論上はすべてのフォールトやメンテナンスはノードレベルで処理できるためである。</p>
</blockquote>
<h2 id=お昼ご飯>お昼ご飯</h2>
<p>気分でスーパー寄って買いものして家に帰り、お昼ご飯を作って食べた。前に適当に作った <a href=/diary/posts/2021/1025/#お昼寝>かぼちゃの煮物</a> がおいしかったので再挑戦してみた。今度は圧力鍋を使っていろいろ具材を入れてみた。過去に作っておいしかった料理のレシピを evernote に書いたりしていたけど、もういまは書いてないので気が向いたら日記に書くようにする。</p>
<p>材料</p>
<ul>
<li>A
<ul>
<li>水 900cc</li>
<li>めんつゆ 100c</li>
<li>醤油 適量</li>
</ul>
</li>
<li>B
<ul>
<li>かぼちゃ 1/4切れ</li>
<li>なす 3個</li>
<li>にんじん 2本</li>
<li>玉ねぎ 1個</li>
<li>しめじ 1パック</li>
</ul>
</li>
<li>C
<ul>
<li>卵 2個</li>
<li>豆苗</li>
<li>せみ餃子</li>
</ul>
</li>
</ul>
<p>作り方</p>
<ol>
<li>圧力鍋に A を入れて火にかける</li>
<li>B の野菜を切りながら圧力鍋に入れていく</li>
<li>圧力鍋に B をすべて入れたら圧をかける (高圧30秒)</li>
<li>圧が下がったら蓋をあけて C を入れる</li>
<li>C に火が通るまで2分ほど煮込む</li>
</ol>
<p>所感</p>
<p>圧力が強過ぎたのか、かぼちゃが煮汁に溶け出してしまって原形がなくなってしまった。スープとして飲んでもおいしいけれども、水を入れ過ぎたのかもしれない。肉の代わりに餃子を使ってみた。水餃子っぽくなるので焼き餃子で油使うよりヘルシーな気持ちになっておいしい。</p>
<figure><img src=/diary/img/2021/1027_pumpkin.jpg>
</figure>
<h2 id=bizpy-勉強会>bizpy 勉強会</h2>
<p><a href=https://bizpy.connpass.com/event/198717/>Python で Slack のインテグレーションをやってみる勉強会 #1</a> を開催した。半年以上開催してなかったので億劫になってしまっていたけど、再開できてよかった。10名ほどが参加してくれた。用意したコンテンツを話し終えたら8時半ぐらいで時間もちょうどよかった。初参加者も数人いた。slack インテグレーションの調査も兼ねてあと2-3回は集中的にやっていきたい。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1026/>韃靼そば茶</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-26
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/subcontract/>subcontract</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<img src=/diary/img/2021/1026_soba-tea.jpg class=post-cover alt=韃靼そば茶>
<div class=post-content>
<p>4時に寝て7時に起きた。やや寝坊したけど、夜中に作業してよく眠れたのでまぁいっかとしておく。昨日のかぼちゃの煮物が残っていたので19時に帰って晩ご飯食べて、ちょっと休んでからウォーキングに出た。ウォーキングの途中でオフィスに寄って一作業してからまたウォーキングして帰るという、運動と作業の一石二鳥になることを思いついた。ちょっと天才。ウォーキングの合計時間は1時間強ぐらい。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>8章分散システムの問題のうち、8.1, 8.2, 8.3を読んだ。</p>
<p>とくに 8.3 信頼性の低いクロックは私がこれまでアプリケーションを開発していて全く意識したことがなかった問題を扱っていてすごく勉強になった。おそらくミリ秒レベルでの障害調査をほとんどやったことがなかったので気にしてなかったのかもしれない。Cassandra が採用している LWW (last write wins、最後の書き込みを勝たせる) だと、短時間に連続して行われた書き込みと、本当に並行して行われた書き込みとの区別がつかないのでクロックの同期の状況によって因果律違反が発生する懸念がある。</p>
<p>NTP を使っていてもクロックの同期はミリ秒から秒レベルで正確ではない可能性があり、そこにプロセスの一時停止なんかも加わると容易に数秒の時間がズレてしまい、トランザクションにおける因果律違反が発生する可能性があるという話が丁寧に説明されている。実際に同じリソースに対してミリ秒レベルでトランザクションを発行するというのはあまりない状況だろうし、状態がよければあっても正常に動作する。但し、正常にトランザクションが実行されない懸念があるという理屈を知っておくのは大事なことに思えた。Google の Spanner が原子時計を導入して精度の高い時刻同期をしているというのは記事を見聞きして知っていたが、それがないとどんな問題が発生するのかが 8.3 節を読むと理解できる。</p>
<h2 id=選考面談>選考面談</h2>
<p>そろそろお仕事をしないと会社の財務がやばいので選考を受けている。今日は2社の選考を受けた。1つは Go の開発案件、もう1つは Java の開発案件。どちらも業務内容はマッチングしていて勤務形態もフルリモートなのでいまの生活のまま、お仕事ができる。1社は正式にオファーが届いて、もう1社もおそらくオファーがくる想定。どちらかを選択する。転職だと面接を何回もして選考を受ける必要があるけど、業務委託だと大半が1回で決まる。昔フリーランスやってたときもそうだったかな？調整の管理コストが下がって望ましいことではある。もう私の中では承諾する方の案件は決まっているけど、念のため、1日寝かして顧問さんとも相談した後、最終決定しようと思う。</p>
<h2 id=韃靼そば茶>韃靼そば茶</h2>
<p>少し前から家では <a href=https://www.murataen.com/item/1110/>大阿蘇万能茶</a> を煮出して冷やして飲んでいる。村田園のサイトにはないので商品名が変わった？のかもしれない。この万能茶は、よく言えば後味すっきり、わるく言えば刺激がないと言える。おいしくないわけではない。近所のドラッグストアでノンカフェインのお茶を求めて購入した。もう少しお茶の主張がほしいなと思って、にっこくの <a href=https://www.nikkoku.co.jp/products/homeuse/dattan/>韃靼そば茶</a> を購入した。そば茶もノンカフェイン。これは水出しもできる。試しに水筒にティーパックを入れて、オフィスのウォーターサーバーで水を入れて作ってみた。時間が経つごとにそば茶の味が濃くなっていくけど、これはこれで私は好みなので問題なさそう。なるべく1日で飲みきって水筒を洗えばよさそう。</p>
<p>夜にうまく眠れなくなってから、夜にカフェインの入った飲みものを避けるようになった。ノンカフェインだとわかっているお茶なら安心して飲める。しばらく試してみる。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1025/>新しい生活リズムへの移行</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-25
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
</span>
<img src=/diary/img/2021/1025_pumpkin.jpg class=post-cover alt=新しい生活リズムへの移行>
<div class=post-content>
<p>3時に寝て6時に起きた。今日はちゃんと起き上がって朝からお茶を煮出して粗熱とって冷やしたりしてた。その後、準備してオフィスに着いたのが7時20分。いつもより1時間早く起きているのでオフィスに着くのも1時間早くなる。<a href=/diary/posts/2021/1022/>先週</a> の水曜日と金曜日だけ朝活やってみて逆に生活のリズムが乱れてよくない感じがした。今週は毎日6時に起きて朝活に参加してみるのを試す。</p>
<h2 id=ミクロ経済学入門の入門>ミクロ経済学入門の入門</h2>
<p>早起きしたので打ち合わせ前の隙間時間に第3章の需要曲線を読んだ。まずは用語の整理から。</p>
<ul>
<li>上級財: 所得が増えたときに消費が増える財</li>
<li>下級財: 所得が増えたときに消費が減る財</li>
</ul>
<blockquote>
<p>一般的な傾向として、ものは消費するほど有り難みが減る。たとえば僕はコーヒー1杯目に最大4ドルまでなら払ってよいけれど、2杯目には最大2ドルまでしか払いたくない、そして3杯目には最大1ドルまでしか払いたくない、というように。</p>
</blockquote>
<p>食べものとか実際にボリュームディスカウントされることが多いので食べものだとイメージしやすい。スーパーで半額になった豚カツを2枚買うときの私の気持ちはこんな感じ。定価なら1枚しか買わないのに半額なら2枚買ってもいいかと思ったりする。たまに2枚を一度に食べて気分悪くなって後悔する。たいていは晩ご飯に1枚、翌日のお昼ゴハンに1枚を分けて食べる。</p>
<ul>
<li>余剰: 価格と消費者がお金を払ってもよい金額との差額
<ul>
<li>コーヒー1杯に400円払ってよいと考えていて、100円のコーヒーを買うなら300円が余剰といえる
<ul>
<li>さらにコーヒー2杯目を50円で買ってよいと考えるなら350円が余剰と言える</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>すべての消費者の余剰を計算したものを消費者余剰という。需要曲線からある価格 p を取るときの次のグラフにおける面積を消費者余剰と呼ぶ。グラフにすると直観的にわかりやすい。</p>
<figure><img src=/diary/img/2021/1025_consumer-surplus.png>
</figure>
<p>消費者余剰に対して、売る側の利潤の合計を生産者余剰と呼ぶ。消費者余剰と生産者余剰との和を社会的余剰と呼ぶ。社会的余剰を「市場のよさ」のモノサシとして使うと談合は禁止すべしということになる。</p>
<ul>
<li>ベルトラン価格競争
<ul>
<li>同品質で同費用の業者が価格競争をした場合、顧客は価格が安い方から商品を購入する。こうした市場をベルトラン寡占市場と呼ぶ</li>
<li>このとき業者間の価格競争は最終的に「底辺への競争」が起こり、経費と同じ価格に近づく
<ul>
<li>この状態をベルトラン均衡と呼ぶ</li>
</ul>
</li>
<li>業者間で談合して価格を据え置けばよいが、業者の数が多くなるとこれは難しい
<ul>
<li>裏切りが発生したり、信頼関係を維持するのが難しかったりして、長期的な利益や全体の利益を追求するのが難しい
<ul>
<li>ゲーム理論の話しのように読めた</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>価格弾力性
<ul>
<li>価格の変化によって需要がどのぐらい弾んで動くかをあらわす</li>
<li>弾力性が低いというと、価格が動いても需要はあまり変わらない状態をいう</li>
<li>弾力性が高い財は値上げすると需要が大幅に下がる
<ul>
<li>必需品は値上げしても需要が下がりにくい
<ul>
<li>課税で考えると、必需品への課税は貧しい人の生活に与えるダメージが大きい</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>ギッフェン財
<ul>
<li>需要曲線は右下がりのカーブになるのが通常だが、経験的事実に即している
<ul>
<li>そうした財を正常財と呼ぶ</li>
</ul>
</li>
<li>ごく稀に価格が上がるにつれ売れ行きが増すものがある、それをギッフェン財と呼ぶ</li>
</ul>
</li>
<li>代替効果: ある商品が値上げしたときに別の商品に置き換えたくなる</li>
<li>所得効果: 生活にゆとりがなくなると、高いものは買えなくなり、安いものを買おうとする</li>
</ul>
<p>内容はそう難しくないが、急にたくさんの用語が出てきて読み解くのに時間がかかった。</p>
<h2 id=設計ドキュメントレビュー>設計ドキュメントレビュー</h2>
<p>先週から作っていた設計ドキュメントを顧問さんと一緒にレビューした。スライド40枚を2時間がっつり話してめっちゃ疲れた。話し終えて20-30分抜け殻になって軽く散歩してきた。ここ3ヶ月、調べものをしてきた内容の集大成でもあり、頭の中にしかなかった課題管理の実践知を明文化するといった取り組みの (途中) 結果でもある。品質の良し悪しで言えば、たった3ヶ月で出来たものなので大したことはない。あくまで途上における段階でしかないのだけど、私の中でも納得感は出てきたし、レビューしてもらって厳しい指摘もなかったので方向性は出てきた感じがある。このまま時間のあるときに進めていく。</p>
<h2 id=slack-apps-の調査>Slack apps の調査</h2>
<p>この水曜日にある勉強会の <a href=https://github.com/t2y/python-study/tree/master/BizPy/slack/20211027>資料作成</a> が完了した。Slack apps の調査を勢いよくやりたいので2週間ごとに開催することにする。ドキュメントを眺めていて次回は <a href=https://api.slack.com/lang/ja-jp/app-home-with-modal>新機能、アプリのホーム・ヴューを活用しよう:house_with_garden:</a> のチュートリアルをやってみることに決めた。</p>
<h2 id=お昼寝>お昼寝</h2>
<p>睡眠時間が短かったせいか、朝早かったせいか、夕方に集中力がなくなったので17時に切り上げて帰って寝てた。今日は雨だったので徒歩通勤だったのもありウォーキングにもなった。途中でスーパーに寄って買いものして帰った。運動目的だと1時間ぐらい歩いても平気なのに通勤だと15分歩くだけで疲れる。同じ行動をしていても目的意識で変わってくる。18時ぐらいには家に着いてそのまま4時間ほど寝てた。その後、また起きて夜の作業に入った。起きてからお腹すいて即席でめんつゆと醤油とかぼちゃとささみと卵で煮物を作ってみたら意外とおいしかった。お腹すいているとちょっとしたものでもおいしい。気に入ったのでカバー画像にしてみた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1024/>bolt アプリ開発</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-24
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/slack/>slack</a>&nbsp;
</span>
<img src=/diary/img/2021/1024_bolt-app.png class=post-cover alt="bolt アプリ開発">
<div class=post-content>
<p>2時に寝て9時に起きた。寝る前に1時間ほどウォーキングしてきたせいか、よく眠れた。田んぼをしたり運動をしたり体を動かして疲れた方がよく眠れるような気がしてきた。しばらく続けてみようと思う。お昼は調べものをしていて夕方に眠くなって2時間ほど寝てまた夜も調べものをしていた。</p>
<h2 id=slack-apps-の調査>Slack apps の調査</h2>
<p>この水曜日に勉強会があるので調査と <a href=https://github.com/t2y/python-study/blob/master/BizPy/slack/20211027/README.md#slack-apps>資料作成</a> をしていた。いつの間にか slack app 作成のためのドキュメントもいくつか <a href=https://api.slack.com/lang/ja-jp>日本語化</a> されていることに気付いた。<a href=https://api.slack.com/lang/ja-jp/hello-world-bolt>Bolt フレームワークを使って Slack Bot を作ろう</a> のドキュメントをみながら <a href=https://github.com/slackapi/bolt-python>bolt-python</a> を使って簡単な bot アプリを作成した。アプリの設定・開発の流れはだいたいこんな感じ。</p>
<ol>
<li>slack app 作成</li>
<li>bot ユーザー作成</li>
<li>oauth スコープの設定</li>
<li>bolt アプリケーションの実装</li>
<li>イベントサブスクリプションの設定</li>
</ol>
<p>bolt とは別に <a href=https://github.com/slackapi/python-slack-sdk>python-slack-sdk</a> というライブラリが提供されていて、このライブラリを使って bolt というフレームワークが実装されている。bolt でやりにくいことがあったら直接 sdk を触ることもあるのかもしれない。</p>
<p>現時点で勉強会の参加者は17人もいる。半年以上さぼっていたけど、けっこうな人数が参加してくれている。slack app の調査も兼ねて3-4回ぐらいは勉強会を開く予定。初回はアプリを作成するときの雰囲気を学んでもらえればと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1023/>普通の休日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-23
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<img src=/diary/img/2021/1023_issue-tracking.png class=post-cover alt=普通の休日>
<div class=post-content>
<p>3時に寝て9時に起きた。前日の夕方お昼寝して21時から2時ぐらいまで作業してから寝たので生活のリズムが狂ってしまったかもしれない。それでもよく眠れたので体調は良いように感じた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p><a href=/diary/posts/2021/1016/#ストレッチ>先週は木・金と連日にジョギングして筋肉痛になってた</a> ので、今週は木曜日だけジョギングして金曜日はお休みしてストレッチを受けた。それでもまだ右股関節の違和感と若干の筋肉の張りは残っている。終わってから少し体が楽になったので疲れが溜まっていたのかもしれない。今日の開脚幅は開始前168cmで、ストレッチ後170cmだった。先週とほぼ変わらないので股関節の可動域は現状維持。トレーナーさんに自分でストレッチしていて感じた左右の違いや右股関節の違和感を相談してみてもらったりした。物理的な身体の変化や状態を相談できるというのもこのサービスの価値の1つでもあると思う。相談してこういうストレッチするとよいですよというアドバイスをもらうだけでも安心した気持ちになるように感じた。</p>
<h2 id=設計ドキュメント修正>設計ドキュメント修正</h2>
<p><a href=/diary/posts/2021/1021/#設計ドキュメント作成>先日たたき台として作成したもの</a> を見直しながら手直したしたりしてた。資料を作ってから2-3日寝かせてから見返すと粗がみえたり不足している内容を思いついたりする。事前に資料を作って余裕があるときはよくそうやって洗練させている。リファクタリングをやるような感覚。カバー画像にあるスライドを追加した。自分の頭の中にあるイメージを図として具現化できると、それ自体を楽しい・嬉しいといったポジティブな感情に捉えられる。資料を作成していて頭の中にある情報をうまく整理できないときに苦痛やしんどさを感じる。言いたいことがあり過ぎたり曖昧だったりしてまとめられないことがある。その反対だから快ちよく感じるのかもしれない。</p>
<h2 id=ウォーキング>ウォーキング</h2>
<p>ジョギングしない日でもなるべく運動した方がいいかと思い始め、23時をまわってから歩くために出かけた。いまオフィスに着いてこれを書いている。19時頃に家に帰れば近所の公園へ行ってジョギングをする。21時をまわると晩ご飯を食べるのが遅くなってしまうから先に食べてしまって、くつろぐと面倒くさくなって外に出なくなる。あと夜遅くに公園で一人走るのも周りに人がいたらこわがられるんじゃないかと思ったりする。前に深夜2時に走りに行ったことがあるんだけど、最初は私1人しか走ってなかったのに途中でもう1人いるようになった。誰もいないと思って走ってて人がいるとなんかこわくなったので夜遅くに走るのはやめようと思った。ジョギングしなくても1時間ほど歩くだけでも健康にはよさそうだし、なるべく続けられるよう努めてみよう。</p>
<p>たまたま繁華街の付近を歩いてみたら、飲食店の営業時間制限が解除されていて、昔のように飲み歩くお客さんで賑わっていた。お店の中を覗くと繁盛しているお店もあれば、全然お客さんが入っていないお店もあった。完全にお客さんが戻ってくるのはちょっと時間がかかるのかな。いまは一時の休息のようなものなんだろうけど、コロナ禍で寂しかった街並みに活気が戻ったようでなんか気分がよかった。でも、狭い店舗でマスクせずに飲食しててまた感染者増えるんじゃないかと不安に思ったりもする。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1022/>睡眠不良</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-22
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/jira/>jira</a>&nbsp;
</span>
<div class=post-content>
<p>4時に寝て6時に起きた。朝活があると何時に寝ても6時に起きれる。終わってからやっぱり眠くなって1時間ほど寝てた。お昼の外出から戻ってきて雑務やってから、なんか集中できなくて15時から帰ってお昼ご飯食べて2-3時間寝てた。寝る時間帯がずれると生活のリズムが狂ってしまい、全体でみると生産性が落ちるように思えてきた。水と金だけ6時に起きるのをやめて毎日6時に起きるべきだと強く思うようになった。</p>
<h2 id=朝活>朝活</h2>
<p><a href=https://www.youtube.com/channel/UC1rVx0vAg66su1WvH3X-RJg>Webデザイントレンドのよりみち</a> の金朝ツメトギに参加した。今回から「つめとぎ」から「ツメトギ」のカタカナに名前変更してパワーアップ？したみたい。本を読んでもよかったんだけど、チャット欄でコメントしながら live をみてみようと思って普通に聴いていた。<a href="https://twitter.com/hashtag/%E9%87%91%E6%9C%9D%E3%83%84%E3%83%A1%E3%83%88%E3%82%AE?src=hashtag_click&f=live">#金朝ツメトギ</a> というハッシュタグは私がコメントして生まれた。コミュニティ的に盛り上げるならタイムラインを共有した方がよいとは思う。youtube live のチャットにコメントした方がいいか、twitter で気軽にコメントした方がいいか、まだよくわかってない。youtube のチャット欄のコメントの一覧性とか、普段使いのツールになっていないせいか、なんとなく抵抗感がある。いま参加者が少ないせいか、コメントするとスピーカーがコメントに反応して返答したりするので、あまりカジュアルに書き過ぎるとスピーカーの作業の邪魔にならないかな？とか思ったりもした。youtube live という勉強会の人間関係の距離感が難しい。</p>
<p>あと <a href=https://www.facebookconnect.com/ja-jp/>Facebook Connect 2021</a> というイベントがあることを教えてもらった。友だちに共有したら会社を休んで参加するとか言っているので私も参加してみることにした。どうしようか迷ってたけど、身近な人たちが参加するとつられるのかもしれない。</p>
<h2 id=法人県民税と法人市民税の中間申告と納付>法人県民税と法人市民税の中間申告と納付</h2>
<p>前日(というか今日)に4時まで起きてたのは申告書の内容確認や記入をしてたから。せっかく申告書を作成したのですぐ納付したくなった。それで新長田の合同庁舎まで申告に行ってきた。<a href=https://www.eltax.lta.go.jp/>eltax</a> は相変わらず windows 向けの DL 版でないと申告できそうにない。WEB 版もあって一部対応しているようだけど、よくよく調べていくと DL 版でしかできないようにみえる。毎年 WEB 版でできるようになっているかどうかを調べている。この互換性を調べるような作業を都度やるのが面倒になってきた。vr 用途 (oculus link を使いたい) にも使えるので windows マシンを購入してもいいかもしれないと考えるようになってきた。申告書を郵送してもよいけど、1時間もあれば往復できる距離なので気分転換も兼ねて合同庁舎に出向いてきた。</p>
<p>帰りに新長田駅の近くの三菱UFJ銀行の支店で納付する。前回は窓口納付をしたが、今回は STM (Store Teller Machine) での納付に初挑戦した。<a href=https://life-is-miracle-wind.blog.jp/archives/22922687.html>STM(Store Teller Machine)の存在意義とは</a> のブログ記事にも書かれている通り、納付書を OCR でスキャンすることでどんな納付書でも対応できるという汎用性はすごいと思うものの、その裏で人間がチェックしているんじゃないかと思えるメッセージや引き落とす合計金額はユーザーが手入力で決定する (OCR で合計がどの金額かわからなかった場合のみ？) といったオペレーションになっていて、なんか全く自動化されてない感があって残念に思った。見た目上、機械化されているけど、運用には人手がかかっているようにみえた。まぁでも、初めて使ってみて経験としてはおもしろかった。</p>
<h2 id=jira-のフィルターとリマインダー>Jira のフィルターとリマインダー</h2>
<p>所得税や住民税の納付は原則毎月納付する必要があるけど、小さい企業は納付の特例という制度があって6ヶ月単位にまとめて納付できる。小さい企業の事務手続きの工数削減を狙いとしてある制度だと思う。うちもその特例制度を利用して6ヶ月ごとに納付している。カレンダーに繰り返し予定として登録してあるのでカレンダーをみていれば見落とすことはないのだけど、そのときに都度チケットを作ってやるのも面倒なので納付の親チケットを作っておいて、子タスクとして毎回作業するようにしている。それをみていて、納付期限を設定しておいてリマインダーしたら課題管理システムっぽくていいなと思って Jira でのやり方を調べてみた。<a href=https://community.atlassian.com/t5/Jira-articles/Jira%E3%81%AB%E3%81%A6%E6%9C%9F%E9%99%90%E3%81%AE%E8%BF%91%E3%81%84%E8%AA%B2%E9%A1%8C%E3%81%AE%E9%80%9A%E7%9F%A5%E3%82%92%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8A%E3%81%9F%E3%81%84/ba-p/770716>Jiraにて期限の近い課題の通知を受け取りたい</a> というのがあって、任意の JQL で期限を調べるフィルターを書いて、そのフィルターに対してサブスクリプションというメール配信設定を行う仕組みになっている。これはこれでよくできたうまい仕組みだと思う。しかし、いまチケットのイベントに対してメールを送る設定は無効にしていて、Slack インテグレーションを使ってすべて Slack の通知チャンネルにイベントを流すようにしている。できれば、Slack インテグレーションで期限のリマインダーを通知できるのが望ましいた。公式の <a href=https://www.atlassian.com/partnerships/slack>Jira Slack app</a> だと、JQL でフィルターはできるけど、イベント発生時に通知する仕組みなので毎週フィルター実行するような用途には使えない。</p>
<p>たまたまそんな話しをツィートしてたら Jira API と Slack API を使ってスクリプトを書いているというのを教えてもらった。これはこれで便利そう。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>こんな感じのスクリプトでJIRAからslackに通知してます <a href=https://t.co/UzeIZ9Nbol>https://t.co/UzeIZ9Nbol</a></p>&mdash; Takanori Suzuki (@takanory) <a href="https://twitter.com/takanory/status/1451572269768003589?ref_src=twsrc%5Etfw">October 22, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1021/>読書はお休み2日目</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-21
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/slack/>slack</a>&nbsp;
#<a href=/diary/tags/writing/>writing</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て7時に起きた。昨日は寝不足だったせいかぐっすり眠れた。</p>
<h2 id=設計ドキュメント作成>設計ドキュメント作成</h2>
<p>昨日の続き。着手すると徐々に興が乗ってくる。朝からずっとやり続けて17時ぐらいに一通りたたき台ができた。なぜか朝ご飯もお昼ご飯も食べずに資料を作り続けてた。お腹もあまりすかなかった。経緯や背景、設計の意図やシステム構成、展望やビジネス戦略など、スライドで39枚になった。顧問さんに情報共有するための資料なんだけど、自分一人の会社で自分一人で開発するのに2日もかけて資料作る必要あるのだろうかと考える人も多いと思う。この資料に書いた内容はすべて課題管理システム上のチケットのどこかに書いてあることなので、私の視点からは全部知っている内容ではある。ちょうど100を超えたばかりのチケット上のどこかに書いてあることを、39枚のスライドにまとめて今日の時点でのスナップショットを作るというのは思考の整理に役立っている。去年はそういうことをやらなかったので何かうまくいかなくなったのを <a href=https://note.com/t2y1979/n/n84deed5fd934>リモートワークと相談相手</a> に書いた。今年はうまくいってないという感覚がないので気持ちに余裕がある。気持ちに余裕があるから新しい施策やアイディアに集中できているように考えている。</p>
<h2 id=ジョギング>ジョギング</h2>
<p>資料できたのが嬉しくて気分がよかったのでそのまま帰ってジョギングしてきた。今週初めて。19時までに帰ってくると行く気するんだけど、それよりも遅く帰ってくるとお腹空いて晩ご飯を先に食べてしまい、晩ご飯を食べると走りに行く気力がなくなってしまう。前に軽く調べたら健康的には食べる前に走った方がよいみたい。<a href=/diary/posts/2021/1014/#ジョギング>先週とだいたい同じ時間帯に行った</a> んやけど、陸上部の人たちが減ってて走りやすかった。曜日じゃなくて何か別のサイクルがあるのかな。ちょっと寒いぐらいだから走っててもあまり汗も書かないし、走った後にストレッチするのも汗だくにはならない。</p>
<h2 id=slack-community>Slack Community</h2>
<p><a href=https://qiita.com/seratch/items/d67f36d0ff7dfaadcc3b#slack-community-%E6%97%A7-slack-platform-community>Slack Community</a> というのがあるのをみかけたので参加してみた。これからしばらく Slack apps についてがっつり調べていく予定。困ったときに相談できるように。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1020/>読書はお休み</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-20
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/slack/>slack</a>&nbsp;
#<a href=/diary/tags/xr/>xr</a>&nbsp;
</span>
<div class=post-content>
<p>4-5時に6時に起きた。寝られなかったというよりは寝る気がなくて3時頃にお茶を沸かして冷ましたりしてた。6時から <a href=https://kobe-sannomiya-dev.connpass.com/event/228152/>【三宮.dev オンライン】リモート朝活もくもく会</a> に参加してメンバーと雑談してた。もはや朝活というよりは雑談会になっているw 普通に起きたら7時まわってから起きるのが、イベントがあると6時に起きれるのでそれはそれで早起きするモチベーションになっていいかとは思っている。とはいえ、お昼やっぱり眠くなって1時間ほど昼寝した。昨日あまり寝てなかったら夜も集中力なくなってバテた。</p>
<h2 id=slack-apps-の調査>Slack apps の調査</h2>
<p>日記に書くの忘れてた。さらに3つのアプリを試してみた。</p>
<p><a href=https://www.thetodobot.com/>ToDoBot</a></p>
<blockquote>
<p>Task Management App for Slack</p>
</blockquote>
<p>これは基本的には個人向けのタスク管理ツール。タスクをグルーピングする機能をもっているのでそれを共有することでチーム単位でも使えるとは思うけど、あまりチーム向けに機能が用意されているようにはみえない。</p>
<p><a href=https://www.getsidequest.app/>Sidequest</a></p>
<blockquote>
<p>Meet the Missing Task Manager for Slack.</p>
</blockquote>
<p>個人/グループのタスク管理とチームでタスクを共有する用途にも機能が提供されている。タスクを作る際にチャンネルに作成すると、そのチャンネルにいるユーザーが確認して適切な人を担当者として割り当てるといった運用になる。タスク作成からの導線と担当者を割り当てる UI が自然な流れになっていてよさそうに思えた。課題管理システムの代わりにはならないけど、ヘルプデスクの用途にはちょうどよさそうにみえる。</p>
<p><a href=https://happybara.io/apps/streamly/>Streamly</a></p>
<blockquote>
<p>A complete task management suite in Slack</p>
</blockquote>
<p>目指しているものは課題管理システムではあるけど、Stream (プロジェクト)、Request (チケット) といった新しい名前 (概念) を導入しているので、まず用語からして学習コストが上がる。プロジェクトはチャンネルごとに設定して、Request の接頭辞やカスタムフィールドも設定できるようになっていて、課題管理システムを目指しているんだなという雰囲気はする。UI は Slack のフォームを使っているので1つ1つの操作が API 呼び出しになって操作量やフォーム入力が増えてあまり使いやすくは感じなかった。同じような操作を何度もさせられるといった印象を受ける。</p>
<p>一旦、これで Slack apps で適当に検索した課題管理システムに近いツールの調査を終える。1-2時間さらっと表面的なところしか触ってないけど、どれもプロダクション品質になっているのだから、内部はよく作り込まれているんだと推測する。</p>
<h2 id=設計ドキュメント着手>設計ドキュメント着手</h2>
<p>課題管理システムの設計を資料にまとめ始めた。先週ぐらいからチケットに設計の要素を書き始めてだいたいのイメージは頭の中では固まっている。これまで3ヶ月調べた内容もあるのでそれなりの背景をもった設計資料にはなる。頭の中のイメージはできているけど、それを言語化する作業を今日・明日ぐらいでやりたい。書くことの難しいところはいざ言語化しようとするとやっぱり時間がかかる。たぶんわかった気になって本当のところはちゃんと分かってないことの裏返しだと思う。</p>
<h2 id=vr-イベント参加>VR イベント参加</h2>
<p><a href=https://osaka-driven-dev.connpass.com/event/226481/>【大阪オンライン】XRミーティング 2021/10/20【AR/CR/MR/SR/VR】</a> に参加した。zoom を複数地域と接続して youtube live で配信していたせいか、始まるまで時間がかかった。参加者のアバターがそれぞれ独自のものでかっこいいなと思って眺めてた。登壇者が5名いて全員が HoloLens を使っていた。電話してたり調べものしてたりしたので断片的にみていた。長めの発表と LT のような短い発表とバラバラ。適当に所感を書いていく。HoloLens の Moving Platform Mode の紹介はあまり見た目は派手ではなかったけど、どういう仕組みかを説明して動画で実際の振る舞いを説明してた。へーって感じで聞いていた。次に HoloLens 触ってはまって20年働いた会社をやめて VR 系の会社に転職した人。前職が大企業だったので給料もだいぶ下がったけど、家族を説得したらしい。給与以上に HoloLens の将来性を感じたとのこと。HoloLens で OpenCV や Azure Face API を使って顔認識するアプリケーションの紹介してた。おもしろそうだった。最後は HoloLens のアプリ開発の発表だった。Microsoft が Mixed Reality Tool Kit というライブラリを提供していて、クラウスプラットフォームで開発できる。ライブラリの Plane Finding という機能を紹介してた。空間の平面だしをする部品。水平面や垂直面を抽出したりできる。この機能を使ってアプリケーション開発のサンプルなどの話をしてた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1019/>改正法人税法等の説明会</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-19
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
</span>
<img src=/diary/img/2021/1019_water-spout.jpg class=post-cover alt=改正法人税法等の説明会>
<div class=post-content>
<p>0-1時ぐらいに寝て7時半に起きた。よく眠れたか眠れてないかもわからないような目覚め方をして少しぼおっとしてた。朝ゆっくりしてもいいかと思いつつ準備して移動したら9時前にはオフィスにいたので普通の日とそう変わらない一日の始めだった。夜にジョギング行こうかと思ってたけど、ちょうど通り雨が降ったりやんだりしててやめた。代わりに雨やんでからオフィス行って調べてものしてた。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>7.3を読んで7章トランザクションを読み終えた。トランザクションの章は言葉も知らないし、あまりクリティカルなアプリケーションの開発に関わってこなかったのでそこまで意識したことがなかった。トランザクションで問題が発生する分離レベルと典型的なパターンが体系的に整理されていてすごく勉強になった。結果的にトランザクションを使わないとしても、トランザクションの要否や起きうる整合性の問題を理解しておくとデータ定義やアプリケーションの設計にも活かせる気がする。7章まで読んだ中でもっとも知らないことが多かった。約300ページなのでだいたい半分読み終えた。まだまだ先は長い。</p>
<p>トランザクションの開始時点でロックをかけるべきオブジェクトが存在せず、あるトランザクションでの書き込みが他のトランザクションの検索クエリの結果を変化させてしまう問題を <strong>ファントム</strong> と呼ぶ。ファントムの対策の1つとして、あらかじめそのデータを作っておき <code>SELECT FOR UPDATE</code> でロックを取得するやり方を <strong>衝突の実体化 (materializing conflicts)</strong> と呼ぶらしい。グループウェアの開発をしていた頃、1つのスレッドしかトランザクションを実行できないことを保証するための切り札として、ロック用途のテーブルを設けておき、そのロックを獲得したスレッドだけ処理できるようにしていた。当時はわからなかったけど、あれは衝突の実体化という手法だったんだといま気付いた。</p>
<blockquote>
<p>データベースのクラッシュや整合性に関する問題に対する信頼性を保つために、それらの問題を単純化するために、この数十年にわたって選択されてきた仕組みが <strong>トランザクション</strong> である。トランザクションは、アプリケーションが複数の読み書きを論理的な単位としてまとめる方法である。概念的には、トランザクション中のすべての読み書きは1つの操作として実行される。トランザクションは抽象化のレイヤーであり、アプリケーションはある種の並行性の問題や、ある種のハードウェアやソフトウェアの問題が存在しないかのように振る舞えるようになる。</p>
<p>トランザクションは全体として成功（ <strong>コミット（commit）</strong> ）もしくは失敗（ <strong>中断（abort）</strong> 、 <strong>ロールバック（rollback）</strong> ）する。トランザクションが失敗した場合には、アプリケーションは安全にリトライできる。トランザクションは自然法則ではなく、データベースにアクセスするアプリケーションのためのプログラミングモデルをシンプルにするという目的を持って生み出された。トランザクションを利用すれば、ある種の潜在的なエラーの状況や並行性の問題はデータベースが面倒を見てくれるので、アプリケーションはそれらを気にしなくてよくなる（このことは <strong>安全性の保証</strong> と呼ばれる）。</p>
<p>トランザクションが提供する安全性の保証は <strong>ACID</strong> で示される。</p>
<h5 id=原子性-atomicity>原子性 (Atomicity)</h5>
<ul>
<li><strong>原子（アトミック）</strong> はそれ以上小さな部分に分割できないものを指して使われる言葉</li>
<li>マルチスレッドのプログラミングにおいては、あるスレッドがアトミックな処理を実行しているというなら、それは他のスレッドからはその処理の半分だけ完了した途中の状態を見る方法が存在しないことを意味する。システムが取りえる状態は、その処理が始まる前と終わった後の状態だけであり、その中間の状態になることはない
<ul>
<li>前にメモリモデルの文脈で、あるプロセスが書き込み完了したデータが、他のプロセスからも確実に読めることをアトミックな操作と習ったことがある</li>
</ul>
</li>
<li>原子性と並行性は関係がない</li>
<li>エラーの際にトランザクションを中断し、そのトランザクションのすべての書き込みを破棄できることが、 ACID の原子性を決定づける特徴と言える
<ul>
<li>アプリケーションがリトライしても安全であることを保証する</li>
<li><strong>中断可能性（abortability）</strong> の方が原子性よりも良い言葉だったと思われる</li>
</ul>
</li>
</ul>
<h4 id=一貫性-consistency>一貫性 (Consistency)</h4>
<ul>
<li>一貫性は多くの意味で使われる
<ul>
<li>とくに日本語では整合性とも訳される</li>
</ul>
</li>
<li>非同期のレプリケーションシステムでは結果整合性の問題が発生する (5章)</li>
<li>コンシステントハッシュ法は、リバランシングのためにいくつかのシステムで利用されているパーティショニングのアプローチ</li>
<li>CAP 定理では、一貫性という言葉は線形化可能性の意味で使われる (9章)</li>
<li>ACID の文脈における一貫性は、データベースが「良い状態」にあることを示すアプリケーション固有の概念を指す</li>
</ul>
<p>同じ言葉を少なくとも4つの異なる意味で使われている。ACID における一貫性という概念は、データについて常に真でなければならない何らかの言明（ <strong>不変性</strong> ）があることを指す。たとえば、会計システムの場合、すべてのアカウントでまとめれば常に貸方と借方は等しくならなければならない。この一貫性の概念はアプリケーション固有の不変性の概念に依存しており、一貫性を保つようにトランザクションを適切に定義することはアプリケーションの責任となる。原子性、分離性、永続性はデータベースの特性だが、一貫性は（ ACID という考え方においては）アプリケーションの特性である。したがって、 C は実際には ACID に属していない。</p>
<h4 id=分離性-isolation>分離性 (Isolation)</h4>
<p>多くのデータベースは、同時に複数のクライアントからアクセスされる。データベース中の同じレコードにアクセスするときに並行性の問題（レース条件［ race condition ］）が生じる可能性がある。データベース中に保存されているカウンタを、2つのクライアントが同時にインクリメントすると仮定する。それぞれのクライアントは現在の値を読み取り、1を加え、新しい値を書き戻す。ACID における分離性とは、並行して実行されたトランザクションがお互いから分離されており、お互いのつま先を踏みつけあうようなことがないという意味である。実際の運用では、パフォーマンスの制約から分離レベルによって保証される分離性が変わってくる。</p>
<h4 id=永続性-durability>永続性 (Durability)</h4>
<p>データベースシステムが目的とするのは、データを失う恐れなく保存できる安全な場所を提供すること。永続性は、トランザクションのコミットが成功したら、仮にハードウェアの障害やデータベースのクラッシュがあったとしても、そのトランザクションで書き込まれたすべてのデータは失われないことを約束する。</p>
<h4 id=用語の整理>用語の整理</h4>
<p>トランザクションはデータモデルがどういったものであるかにかかわらず、価値あるデータベースの機能と言える。並行に実行されたトランザクションがお互いに影響しあわない分離性における保証を <strong>分離レベル</strong> と呼ぶ。</p>
<ul>
<li>read committed</li>
<li>スナップショット分離（repeatable read とも呼ばれる）</li>
<li>直列化可能</li>
</ul>
<p>これらの分離レベルに対してトランザクションで発生する様々なレース条件がある。</p>
<ul>
<li>ダーティリード
<ul>
<li>あるクライアントが他のクライアントのまだコミットされていない書き込みを読める</li>
<li>read committed 分離レベル及びそれ以上に強い分離レベルはダーティリードは生じない</li>
</ul>
</li>
<li>ダーティライト
<ul>
<li>あるクライアントが他のクライアントによるまだコミットされていない書き込みの内容を上書きしてしまう</li>
<li>ほぼすべてのトランザクションの実装は、ダーティライトを生じない</li>
</ul>
</li>
<li>読み取りスキュー（nonrepeatable read）
<ul>
<li>クライアントが異なる時刻にデータベースの異なる部分を見ること</li>
<li>この問題の最も一般的な回避策はスナップショット分離によるもので、これはトランザクションがある時点での一貫したスナップショットから読み取りを行えるようにする</li>
<li>通常、MVCC（multi-version concurrency control）を利用して実装される</li>
</ul>
</li>
<li>更新のロスト
<ul>
<li>2つのクライアントが並行して read-modify-write サイクルを実行するとき、片方が他方の書き込みをその変更内容を考慮せずに上書きしてしまい、データが失われること</li>
<li>スナップショット分離レベルの実装にはこの異常を自動的に回避してくれるものもあるが、明示的なロック（ SELECT FOR UPDATE ）をしなければならない実装もある</li>
</ul>
</li>
<li>書き込みスキュー
<ul>
<li>トランザクションが何かを読み取り、その値に基づいて判断を下し、その結果をデータベースに書き込む</li>
<li>この状況で、書き込みが行われた時点で判断の根拠となったプレミスが真ではなくなっている場合を指す</li>
<li>直列化可能分離レベルのみがこの異常を回避できる</li>
</ul>
</li>
<li>ファントムリード
<ul>
<li>トランザクションが何らかの検索条件にマッチするオブジェクトを読み取り、他のクライアントはその検索結果に影響する書き込みを行う</li>
<li>スナップショット分離レベルは単純なファントムリードを回避してくれるが、書き込みスキューを伴うファントムに対してはインデックス範囲ロックのような特別な対応が必要となる</li>
</ul>
</li>
</ul>
<p>弱い分離レベルは、これらの異常のいくつかを防いでくれるが、それ以外はアプリケーション開発者に対処する必要がある（たとえば明示的なロックなど）。すべての問題に対する保護を提供してくれるのは直列化可能分離レベルのみ。直列化可能なトランザクションの実装方法は、3 種類ある。</p>
<ul>
<li>トランザクションを順次実行する
<ul>
<li>それぞれのトランザクションをきわめて高速に実行でき、加えて単一の CPU コアで十分処理できる程度にトランザクションのスループットが低いのであれば、これはシンプルで効果的な選択肢となる</li>
</ul>
</li>
<li>ツーフェーズロック
<ul>
<li>数十年にわたって直列化可能分離レベルの実装において標準的な方法であった</li>
<li>パフォーマンス上の特性から多くのアプリケーションがツーフェーズロックの利用は避けている</li>
</ul>
</li>
<li>直列化可能スナップショット分離（SSI、serializable snapshot isolation）
<ul>
<li>新しいアルゴリズムであり、これまでのアプローチが持つ欠点のほとんどを回避している</li>
<li>SSI は楽観的アプローチを取っており、トランザクションはブロックされることなく処理を進められる</li>
<li>トランザクションはコミットの時点でチェックされ、その実行が直列化可能になっていなければ中断される</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id=改正法人税法等の説明会>改正法人税法等の説明会</h2>
<p><a href=https://www.nk-net.co.jp/kobe/assets/files/schedule/2021/211019.pdf>改正法人税法等の説明会</a> に参加してきた。所感からまとめるとこんな感じ。</p>
<ul>
<li>神戸文化ホールについて
<ul>
<li>電源がない</li>
<li>FREESPOT が提供されていてフリー wifi として利用できるが、通信品質は不安定
<ul>
<li>スマホでテザリングもやってみたが、電波状態がよくなくてもっと不安定</li>
</ul>
</li>
<li>ラップトップ向きの場所ではない</li>
</ul>
</li>
<li>税制を身近にするイベントとしては参加してもよい</li>
<li>もらった資料をたんたんと説明するだけなのでイベントに参加することで得られる付加価値はとくにない</li>
<li>気分転換や時間があれば参加すればいい、忙しかったら参加しなくてもよさそう</li>
</ul>
<p><a href=https://www.nk-net.co.jp/kobe/index.html>公益社団法人 神戸納税協会</a> という組織がある。年会費 (うちの会社だと7,800円) がいるのでいまは入らないけど、無料税務相談があるので余裕ができたら困ったときの相談相手になってもらう意図で入会してもよいかもしれない。冒頭の神戸税務署長の挨拶で法人税の申告における e-tax の利用率は 88.4% だと話してた。うちは紙で申請しているので意外とみんな e-tax 使っているんだなと自社を恥じた。だって Windows マシンないとできへんねんもん。参加したことによる学びとして書いていくとこれらかな。</p>
<ul>
<li>「研究開発費」は会計上の用語、「試験研究費」は税法上の用語</li>
<li>DX 投資促進税制の創設</li>
</ul>
<p>内容は基本知らないことなので、知らないことに触れるイベントという点では斬新ではあった。ほうほうと聞いてただけなんだけど。直接うちの会社に影響を与える税法の改正はインボイス制度ぐらいかな。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1018/>とくに何もない一日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-18
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/gig/>gig</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>いつ寝たのか覚えてないけど、スマホをみたら1時過ぎに寝て6時に起きたことになっている。だいたいいつも5-6時には一度目が覚める。そのまま起きるときもあれば起きないときもある。今日はちゃんと起き上がったのは7-8時ぐらいだった気がする。夜にジョギング行こうかとも考えていただけど、帰って先に晩ご飯食べたら疲れてそのままだらだらしてた。</p>
<h2 id=エージェント面談>エージェント面談</h2>
<p>そろそろ次のお仕事を探す準備のために <a href=https://www.engineer-factory.com/>エンジニアファクトリー</a> というサービスに登録してみた。<a href=https://www.city.kobe.lg.jp/life/livelihood/kobejobport/index.html>KOBE JOB PORT</a> で紹介されていたのをみつけた。<a href=/diary/posts/2021/0930/#カジュアル面談準備>前に Remogu さんで探していた</a> ように、プロジェクトマネージャー案件か、リモートワークの開発者案件を探している。マネージャーだと常駐系の方が多かったり、実務経験必須だったりすることが多いため、神戸から通える範囲の案件も探してみようという意図になる。だいたいこんな内容を話してた。</p>
<ul>
<li>職務経歴の内容から個人を特定できないよう、エージェントがブラインド化した資料を企業に公開する</li>
<li>単価が高い案件は東京の会社のリモートワークに多い</li>
<li>契約は準委任契約がほとんどである</li>
<li>法人として契約もできる</li>
<li>6ヶ月や1年といった短期開発案件も多い</li>
</ul>
<p>求職者の情報を匿名化する背景は、企業が直接交渉するのを避けるためなのかな？求人プラットフォームごとに情報入力しないといけないのが面倒なところ。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>7章トランザクションのうち、7.1と7.2を読んだ。トランザクションの章は内容も難しく量も多いので2日にかけて読むことにする。昔、業務アプリケーションやグループウェアを開発していたときはトランザクションを意識してコードを書いていたけど、Web アプリケーションを開発していると、あまりクリティカルな処理を実装することが少ないせいか、トランザクションをそんな意識しなくなったなと漠然と思えた。Cassandra だとトランザクションもないし。非同期 + 結果整合性で運用できるアプリケーションであればトランザクションいらないというのはそうなのかもしれない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1017/>豆苗再生</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-17
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/food/>food</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>3時に寝て8時半に起きた。夜眠れなくて、野菜サラダに目玉焼きをのせて食べたり、お茶をわかしてボトルに入れ替えたりしてた。休日だと時間に余裕があるせいか、空き時間に自炊してなにか作ることが多い。</p>
<h2 id=豆苗の再生栽培>豆苗の再生栽培</h2>
<p>朝ご飯は野菜サラダと納豆を、お昼ご飯は豚肉としめじと2回目の豆苗を炒めたものを目玉焼きでとじたものを食べた。豆苗のパッケージに食べた後の根を水に浸しておけばまた生えてくるとあったので試しにやってみた。キッチンという日当たりのよくない場所で育てたせいか、薄い緑色の苗が生えてきた。</p>
<p><figure><img src=/diary/img/2021/1017_pea-sprout1.jpg alt=水に浸して2日目><figcaption>
<p>水に浸して2日目</p>
</figcaption>
</figure>
<figure><img src=/diary/img/2021/1017_pea-sprout2.jpg alt=水に浸して6日目><figcaption>
<p>水に浸して6日目</p>
</figcaption>
</figure>
</p>
<p>今回は適当に育てた。<a href=https://www.murakamifarm.com/myouken/grow/technique/#where>再生栽培のコツ</a> を読んで次はもうちょっとちゃんと育ててみよう。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>6章パーティショニングを読んだ。昔からパーティショニングとシャーディングの違いはなんだろう？と漠然と思っていた。<a href=https://docs.microsoft.com/ja-jp/azure/architecture/best-practices/data-partitioning#designing-partitions>パーティションの設計</a> を読むと、3つのパーティション分割があげられている。</p>
<ul>
<li>水平的パーティション分割 (シャーディング)</li>
<li>列方向のパーティション分割</li>
<li>機能的パーティション分割</li>
</ul>
<p>パーティショニングは大規模なデータセットをデータ分割するための手法または概念として広い意味をもって使われるように読める。一方でシャーディングと呼ばれるものは水平パーティショニングのことを指している。いま分散データベースで一般的に使われている仕組みがそうなのかもしれない。本書では水平・垂直のパーティショニングの定義は行われていないが、次の説明が出てくる。おそらく主に水平パーティショニングを意図しているのではないかと思う。まとめはこんな感じ。</p>
<blockquote>
<p>用語の混乱</p>
<p>ここで パーティション と呼んでいるものは、 MongoDB 、 Elasticsearch 、 SolrCloud では <strong>シャード</strong> と呼ばれています。これは HBase では <strong>リージョン</strong> 、 Bigtable では <strong>タブレット</strong> 、Cassandra や Riak では <strong>vnode</strong> 、 Couchbase では <strong>vBucket</strong> と呼ばれています。とはいえ最も確立されている用語は <strong>パーティショニング</strong> なので、本書ではこの呼び方を使っていきます。</p>
</blockquote>
<p>パーティショニングも普通に開発をしていたらデータベースの設計で必要になるので身近な概念と言える。だいたいは知っている内容ではあったけど、パーティショニングとセカンダリインデックスの仕組みとか考えたことがなかった。Cassandra ではセカンダリインデックスをうまく設計しないとパフォーマンスに影響を与えることからあまり使われない傾向にあると思う。</p>
<blockquote>
<p>大規模なデータセットを小さな部分集合にデータ分割することをパーティショニングと呼ぶ。パーティショニングが必要になるのは、単一のマシンで保存や処理をするのが現実的ではないほどのデータがある場合になる。パーティショニングが目標とするのは、データやクエリの負荷を複数のマシン間で均等に分配し、<strong>ホットスポット</strong>（不均衡に高い負荷がかかるノード）が生じないようにすること。パーティショニングが均等になっておらず、一部のパーティションが他に比べて多くのデータやクエリを受け持っているような状態は <strong>スキュー（skew）</strong> と呼ばれる。そのためには、データに適したパーティショニングのスキームを選択し、クラスタへのノードの追加やクラスタからのノードの削除が生じたときにパーティション群をリバランシングする。</p>
<p>パーティショニングのアプローチとして主に2つがある。</p>
<ul>
<li><strong>キーの範囲によるパーティショニング</strong>
<ul>
<li>キーはソートされ、1つのパーティションには何らかの最小値と最大値の間にあるすべてのキーが保存される</li>
<li>キーをソートすることで、範囲に対するクエリが効率的に処理できるというメリットがある</li>
<li>アプリケーションが頻繁にアクセスするキーがソート順の中で近接していると、ホットスポットが生じるリスクがある</li>
<li>通常このアプローチでは、パーティションのリバランシングはパーティションが大きくなりすぎたときにその範囲を2つに分割することによって動的に行われる</li>
</ul>
</li>
<li><strong>ハッシュパーティショニング</strong>
<ul>
<li>ハッシュ関数がそれぞれのキーに対して適用され、1つのパーティションにはハッシュの一定の範囲を保存される</li>
<li>この方法ではキーの順序が失われるので範囲に対するクエリは非効率になるが、負荷分散より均等にしやすい</li>
<li>ハッシュによってパーティショニングを行う場合は、事前に固定数のパーティションを作成し、各ノードに複数のパーティションを割り当てておき、ノードの追加や削除が行われた場合にはパーティションをそのままあるノードから他のノードに移動させるのが一般的となる。また、動的パーティショニングも利用できる</li>
</ul>
</li>
</ul>
<p>ハイブリッドなアプローチを取ることもできる。たとえば複合キーを使い、キーの一部でパーティションを決め、他の部分でソート順を決めるといったやり方がある。Cassandra のプライマリーキーはこのアプローチを採用している。また、セカンダリインデックスもパーティショニングする方法が2つある。</p>
<ul>
<li><strong>ドキュメントによってパーティショニングされたインデックス（ローカルインデックス）</strong>
<ul>
<li>セカンダリインデックスをプライマリキー及び値と同じパーティションに保存する</li>
<li>書き込みの際に更新しなければならないパーティションが1つですむ</li>
<li>セカンダリインデックスの読み取りにはすべてのパーティションに対する <strong>スキャッタ/ギャザー</strong> が必要となる</li>
</ul>
</li>
<li><strong>語によってパーティショニングされたインデックス（グローバルインデックス）</strong>
<ul>
<li>セカンダリインデックスはインデックスが張られた値を使って独立にパーティショニングされる</li>
<li>セカンダリインデックスのエントリには、プライマリキーのあらゆるパーティションのレコード群が含まれる</li>
<li>ドキュメントが書き込まれる際には、セカンダリインデックスの複数のパーティションを更新しなければならない</li>
<li>読み取りは単一のパーティションだけで処理できる</li>
</ul>
</li>
</ul>
<p>クエリを適切なパーティションにルーティングする手法は、データベースに限った話題ではなく、<strong>サービスディスカバリ</strong> と呼ばれる一般的な問題である。有名な OSS として <a href=https://zookeeper.apache.org/>ZooKeeper</a> がある。これにはシンプルなパーティションを認識するロードバランシングから、洗練された並列クエリ実行エンジンまで様々である。すべてのパーティションは、ほぼ独立に動作できるように設計されている。パーティショニングされたデータベースが複数のマシンにまでスケールできるのはそのおかげである。</p>
</blockquote>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1016/>閃光のハサウェイ見直し</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-16
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/xr/>xr</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
</span>
<div class=post-content>
<p>2時に寝て6時半に起きた。連日ジョギングして体を動かしたせいか、よく眠れて体調がよい気がした。<a href="http://gundam-hathaway.net/news.php?id=19157">機動戦士ガンダム 閃光のハサウェイ</a> が今日からオンライン配信を開始した。私は載っているどの動画配信プラットフォームも使ってないが、iTunes Store で普通に購入できるようになっているのに気付いた。昨日の夜は閃光のハサウェイをみながら寝落ちしたので朝起きてから途中から見直した。映画館でみてたけど、戦闘のシーンは暗くてよくわからなかったので何回かみた方が発見もあるかもしれない。市街地の降ってくる炎を避けて逃げるシーンが好き。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>一昨日、昨日と連日でジョギングしたせいか、右股関節からお尻と右ももにかけて筋肉痛で張りがあった。そのせいかもしれないけど、今日の開脚幅は開始前168cmで、ストレッチ後170cmだった。先週とほぼ変わらないので股関節の可動域は現状維持だった。それでもトレーナーさんに筋肉痛だったところをストレッチしてもらってかなり楽になった。ジョギングして痛くなる内容が、最近は関節の痛みから筋肉の張りになっている気がしてこれはよい傾向かもしれない。前は腰にも負担がきていたけど、それも少しましになった。今日は可もなく不可もなくといったところか。</p>
<h2 id=vr-イベント参加>VR イベント参加</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/225590/>【三宮.dev オンライン】３周年記念交流会</a> に参加した。<a href=https://cluster.mu/>cluster</a> のイベントを開いた。Oculus Quest で VR 参加できるのは Windows 向けのアプリだけっぽく macOS では VR 参加できなかった。</p>
<p>オープンなイベントとして開催したので誰でも参加することができて、途中で子どもが入ってきて参加者に無邪気に質問して微笑ましいカオスをもたらしていた。大人はよく知らないイベントに入って、なんの前提知識もなく参加者に話しかけたりしないだろう。そういうやり取りをみていて、子どものときから VR 空間でいろんな人と接すると子どもたちはどんな大人になるんだろう？私では想像もつかないイノベーションを起こすんだろうな。</p>
<p>1.5年前に1度だけ macOS のアプリで cluster イベント参加したことがあった。アプリは3回ぐらい落ちて不安定なので途中で Web でみたりしてた。そのときに比べたら今日は1度も落ちなかったので安定していた。参加者数の違いによるものかもしれないけど。前回から1.5年も経っているのに機能的なものは何も変わってないようにみえてあんまり流行ってないのかな？とも思えた。</p>
<p>参加者にたぬきのアバターがいて「たぬきさん、いますね」みたいな感じで和んでた。動物のアバターいいなと思って、カスタムアバターに興味がでた。<a href=https://vroid.com/en/studio>VRoidStudio</a> を使えば作れるらしい。また <a href=https://reality.app/>REALITY</a> で作ったアバターを cluster で <a href=https://clusterhelp.zendesk.com/hc/ja/articles/360044037491-REALITY-%E9%80%A3%E6%90%BA%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6>REALITY 連携</a> して使うこともできるらしい。<a href=https://www.oculus.com/blog/new-day-new-you-avatars-are-more-expressive-and-customizable-starting-today/>Oculus ブログの記事</a> をみてたら Oculus は Oculus で独自のアバターの仕組みになるのかな。外部のツールで作ったカスタムアバターを持ち込めるようにはみえない。</p>
<h2 id=slack-apps-の調査>Slack apps の調査</h2>
<p><a href=https://www.wrangle.io/>Wrangle</a> を試してみた。</p>
<blockquote>
<p>Approval and Ticketing Workflows in Slack</p>
</blockquote>
<p>3つの機能をもっている。</p>
<ul>
<li>ちょっとした ToDo リスト管理</li>
<li>承認依頼を管理</li>
<li>ステップと承認のワークフローを管理</li>
</ul>
<p>とくに SaaS 型の Web アプリケーションもなく Slack app 単体で完結するアプリケーションにみえる。組織として承認履歴を残したいといったときにチャットツール上でワークフローを定義してちゃちゃっとできるといったところが売りなのではないかと推測する。課題管理として使うアプリケーションではなかった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1015/>日本酒いただきもの</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-15
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
</span>
<img src=/diary/img/2021/1015_sake.jpg class=post-cover alt=日本酒いただきもの>
<div class=post-content>
<p>0時に寝て6時に起きた。だいたい夜中に2-3回は起きるのが普通になりつつあって、前日ジョギングしてたせいか腰やお尻の筋肉に張りがあったので3時頃起きてストレッチして張りの箇所を伸ばしたりしながら寝てた。午前中、いけさんから上等なお酒をいただいた。造り酒屋の一族らしい。感謝。</p>
<h2 id=朝活>朝活</h2>
<p>朝起きる目的にいいかも？と思って <a href=https://www.youtube.com/channel/UC1rVx0vAg66su1WvH3X-RJg>Webデザイントレンドのよりみち</a> の金朝つめとぎに参加してみた。やっぱり目的があれば6時に起きれる。でも、終わってから1時間ほど寝てたので今日はプラスマイナスゼロ。<a href=/diary/posts/2021/1013/#朝活>前回の朝活</a> と同様、ミクロ経済学の入門書を読んでた。第2章の予算線と最適化を読んだ。経済学とはこういうものだという説明が腑におちた。当たるかどうかよりも考え方を理解しておく方が大事なように思えた。</p>
<blockquote>
<p>ときどき経済学に対して「経済学が想定するほど実際の消費者は懸命に選択しているとは限らない」といった批判がなされることがある。でもこれまでの説明から明らかなように、その批判は勘違いにもとづくものだ。批判したいなら「経済学は、消費者がはたから見て確実に愚かな選択をしても、それを非難しない傾向が強い」というほうが適切だろう。</p>
</blockquote>
<p>もう1つおもしろかったのがこの一節。</p>
<blockquote>
<p>予算線と選好を用いたミクロ経済学的分析は、現金給付のよさを指摘する。ただし、制度の悪用、人々の支持、必要原理といったことを考えると、現物給付のほうが好ましいとなる。現金給付と現物給付のどちらが総合的によいのか、これらの話だけで結論づけることはできない。とはいえここで、ミクロ経済学が有用な政策分析ツールたりえること、またミクロ経済学だけで政策を論じるのは不十分ということが分かったのは十分な収穫である。</p>
</blockquote>
<p>人間の活動を予測するような学問の便宜上、前提条件や制約を課している。経済という人間にとって重要な社会システムを扱う経済学への期待値が大き過ぎるがために経済学の言うことが当たった・当たってないといった議論になりがちなのかもしれないと思えた。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>5章レプリケーションを読んだ。200ページ超えたことで1/3を読み終えた。まだまだ先は長い。</p>
<p>シングルリーダーレプリケーションは一般的なものだし、Cassandra の運用をしていたのでリーダーレスレプリケーションもだいたいは知っていた。並行書き込みの問題は意識したことがなかった。そういう状況が発生するアプリケーションにおいてはとても難しい問題なことが理解できた。Cassandra で採用されている衝突解決アルゴリズムは <strong>最後の書き込みを勝たせる（last write wins、LWW）</strong> というものであり、これで十分なように考えていたけど、不十分なケースもあることがわかった。</p>
<blockquote>
<p>レプリケーションとは、ネットワークで接続された複数のマシンに同じデータのコピーを保持しておくこと。</p>
<ul>
<li>データを地理的にユーザーの近くで保持しておく => レイテンシを下げる</li>
<li>一部に障害があってもシステムが動作し続けられる => 可用性を高める</li>
<li>読み取りクエリを処理するマシンをスケールアウトする => スループットを高める</li>
</ul>
<p>レプリケーションはいくつかの目的で使われる。</p>
<ul>
<li>高可用性/耐障害性</li>
<li>レイテンシ</li>
<li>スケーラビリティ</li>
</ul>
<p>対象のデータが時間が経っても変化しないのであれば、レプリケーションは容易。単にデータのコピーを各ノードに一度だけコピーすれば完了するから。レプリケーションの難しさは、すべてレプリケーションされたデータへの変更の扱いから生じる。変更をノード間でレプリケーションするのに広く使われているアルゴリズムは次の3つになる。</p>
<ul>
<li>シングルリーダーレプリケーション
<ul>
<li>クライアントはすべての書き込みを1つのノード（リーダー）に送り、リーダーはデータ変更イベントのストリームを他のレプリカ（フォロワー）に送る</li>
<li>読み取りは任意のレプリカから行えるが、フォロワーから読み取るデータは古い可能性がある</li>
</ul>
</li>
<li>マルチリーダーレプリケーション
<ul>
<li>クライアント群は、それぞれの書き込みを複数あるリーダーノードのいずれかに送信する</li>
<li>これらのリーダーノードはどれも書き込みを受け付ける</li>
<li>リーダー群は、データ変更イベントのストリームをお互いに、そしてすべてのフォロワーノードに送信する</li>
</ul>
</li>
<li>リーダーレスレプリケーション
<ul>
<li>クライアントは、それぞれの書き込みを複数のノードに送信し、古いデータを持つノードを修正するために読み取りを複数のノードから並列に行う</li>
</ul>
</li>
</ul>
<p>データベースのレプリケーションの原理は1970年代から研究されていてそれほど変わっていない。とはいえ、分散データベースがメインストリームで利用されるようになったのは最近のこと。アプリケーション開発者の経験不足により <strong>結果整合性</strong> のような問題に関しては多くの誤解が生じた。いずれのレプリケーションのアプローチにもメリットとデメリットがある。シングルリーダーレプリケーションは理解しやすく、衝突解決を気にする必要がないことから、広く使われている。マルチリーダーとリーダーレスのレプリケーションは、ノードの障害、ネットワークの障害、レイテンシのスパイクがあっても頑健になる。しかし障害の理由を説明するのが難しく、一貫性についても弱い保証しか示せない。</p>
<p>レプリケーションは、 <strong>同期</strong> で行うことも <strong>非同期</strong> で行うこともできる。どちらにするのかは、障害があったときのシステムの振る舞いに大きく影響する。非同期のレプリケーションは、システムがスムーズに動作しているときには高速に動作するが、重要なのはレプリケーションのラグが大きくなったり、サーバーに障害が生じたりしたときに何が起こるのかを理解しておくことになる。リーダーに障害が発生し、非同期に更新されていたフォロワーを新しいリーダーに昇格させたら、直前にコミットされたデータは失われてしまう可能性がある。</p>
<p>レプリケーションラグが生じている状況下でアプリケーションがどのように振る舞うべきなのかを決める際に役立つ一貫性モデル。</p>
<ul>
<li><strong>書き込み後読み取り (read-your-writes)</strong>
<ul>
<li>ユーザーは、自分自身が投入したデータを常に見れる</li>
</ul>
</li>
<li><strong>モノトニック読み取り (monotonic reads)</strong>
<ul>
<li>ある時点のデータをユーザーが一度見たら、それ以前の時点のデータは見れない</li>
</ul>
</li>
<li><strong>一貫性のあるプレフィックス読み取り</strong>
<ul>
<li>ユーザーは、たとえば質問とその質問への回答を適切な順序でといったように、適切な因果関係を保持した状態でデータを見れる</li>
</ul>
</li>
</ul>
<p>マルチリーダーとリーダーレスのアプローチは本質的に並行性の問題を抱えている。複数の書き込みが並列に行われることがあるので、衝突が生じる場合がある。ある操作が他の操作よりも先に行われたのか、あるいはそれらが並行して行われたかを判断するためのアルゴリズムについて説明されている。</p>
</blockquote>
<h2 id=slack-apps-の調査>Slack apps の調査</h2>
<p><a href=https://www.instagram.com/workstreams.ai/>Workstreams.ai</a> を試してみた。</p>
<blockquote>
<p>Results-driven task management for Slack, Microsoft Teams and Google</p>
</blockquote>
<p>結果駆動タスクマネジメントという聞いたことない用語が書いてある。SaaS 型の Web アプリケーションとしての課題管理システムとチャットツールとの連携が密になったプロダクトにみえる。UI もよく作り込まれている。Workstreams.ai のアカウント管理は <a href=https://api.slack.com/authentication/sign-in-with-slack>Sign in with Slack</a> を使っている。ドキュメントによると openid connect と oauth 2.0 の仕組みを組み合わせているのかな。認証よくわかってないので背景も勉強しないといけない。簡単にタスク作成やコメント、更新などを Slack クライアントと Web アプリケーション上で触ってみた。</p>
<p>もう1つ <a href=https://slack.com/app-pages/google-sheets>Google Sheets for Workflow Builder</a> というのも試してみた。ワークフロービルダーのステップに簡単に Google Sheet との連携を実装できるのでめっちゃ簡単。ワークフロービルダーは本当によくできているな。</p>
<h2 id=ジョギング>ジョギング</h2>
<p>今日は調子はよかったけど、お仕事の区切りがよかったので19時に終えて近所の公園にジョギングしてきた。昨日も走ってたのでやや筋肉痛が残りつつ、走り始めは筋肉がきしむ感じだったけど、走っているうちに体があたたまってきて気にならなくなった。時間帯は同じだけど、昨日より陸上部の人たちが半分ぐらい少なかった。曜日によって違うのかなぁ。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1014/>霖</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-14
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/naming/>naming</a>&nbsp;
</span>
<div class=post-content>
<p>0時過ぎに寝て7時に起きた。けれど、なんかしんどくて起き上がれなくてそのまま2度寝した。1時間ほど寝たらすぐに起きれた。あのしんどさは何だったのか。とはいえ、気付いたら8時半にはオフィスにいたので普段の仕事始めと変わらない見た目になった。お昼に体温を測っていたら37.1℃になってたので熱っぽい雰囲気。日中は特にしんどくはないんだけど。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>4章エンコーディングと進化を読んだ。だんだん内容が難しくなってきて読むのに時間がかかる。これで第一部のデータシステムの基礎を読了した。4章のまとめ。</p>
<blockquote>
<p>データシステムの変更のしやすさ、アジリティのことを本書では <strong>進化性</strong> を呼んでいる。</p>
<p>進化性を高めるには、システムのバージョンアップが容易にできなくてはならない。このとき、サーバーサイドアプリケーションは、大抵の場合、一度にすべてのノードをのバージョンアップができないことから、 <strong>ローリングアップグレード</strong> という手法を用いる。ローリングアップグレードを可能にするには、データフォーマットやスキーマの変更に対して、新旧どちらのフォーマットも、新旧どちらのコードからも扱えないといけない。データフォーマットやスキーマの <strong>前方/後方互換性</strong> を維持することが進化性を高めることに大きく影響する。</p>
<p>メモリを共有していないプロセス間でデータを渡すとき、そのデータをバイト列へエンコードしないといけない。通常プログラムはデータを (少なくとも) 2つの異なる表現で扱う。</p>
<ol>
<li>CPU によるアクセスや操作が効率的になるよう最適化されてメモリ内で表現される</li>
<li>ファイルやネットワーク経由でデータをやり取りするにはバイト列にエンコードしないといけない<br>
この表現はメモリ内のデータ構造とはまったく異なる</li>
</ol>
<p>この2つの表現の間で何らかの変換が必要になる。インメモリの表現からバイトの並びへの変換は <strong>エンコーディング</strong> (シリアライゼーション、マーシャリングとも呼ぶ) 、その逆は <strong>デコーディング</strong> (パース、デシリアライぜーション、アンマーシャリングとも呼ぶ) と呼ぶ。</p>
<p>データエンコーディングフォーマットと、それらの互換性に関する特性。</p>
<ul>
<li>プログラミング言語固有のエンコーディングは1つのプログラミング言語に限定され、しばしば前方及び後方互換性を欠く</li>
<li>JSON, XML, CSV といったテキストフォーマットは広く利用されており、その互換性は利用の方法に依存する
<ul>
<li>オプションのスキーマ言語はあるが、それらは助けになることもあればむしろ障害になることもある</li>
<li>これらのフォーマットはデータ型について多少の曖昧さがあるので、数値やバイナリ文字列などについては注意が必要</li>
</ul>
</li>
<li>thrift, protocol buﬀers, aro といったスキーマを持つバイナリフォーマットではコンパクトで効率的なエンコーディングが可能であり、前方及び後方互換性のセマンティクスも明確に定義されている
<ul>
<li>これらのスキーマは、ドキュメンテーションと静的型付き言語でのコード生成に役立つ</li>
<li>ただし、バイナリフォーマットにはデコードしなければ人にはデータが読めないという欠点もある</li>
</ul>
</li>
</ul>
<p>データフローの形態とエンコーディング。</p>
<ul>
<li>データベースでは、データベースへの書き込みを行うプロセスがデータをエンコードし、データベースからの読み取りを行うプロセスがそのデータをデコードする</li>
<li>RPC と REST API では、クライアントがリクエストをエンコードし、サーバーはそのリクエストをデコードしてレスポンスをエンコードする。そして最後にクライアントがレスポンスをデコードする</li>
<li>非同期のメッセージパッシング（メッセージブローカーあるいはアクター）では、ノードはお互いにメッセージを送信することによって通信し、送信側がメッセージをエンコードし、受信側がそのメッセージをデコードする
<ul>
<li>kafka などを使ったイベント駆動アーキテクチャはこの形態になる</li>
</ul>
</li>
</ul>
<p>多少の注意を払うことで前方/後方互換性やローリングアップグレードは十分に実現可能となる。</p>
</blockquote>
<h2 id=霖-ながめ>霖 (ながめ)</h2>
<p>プロダクトの名前を考えるために万葉集を眺めてた。ふとみつけた <strong>霖</strong> ということばを気に入った。一文字だと「ながめ」または「ながあめ」と読む。霖雨と書くと「りんう」と読むらしい。万葉集では次の和歌で詠まれている。和歌では「長雨」と「眺め」をかけて使うのが常套句らしい。また古文でいうところの眺めはぼんやり見ながら物思いに耽るという意味になるそうだ。</p>
<blockquote>
<p>4217 卯(う)の花を　腐(くた)す霖雨(ながめ)の　始水(みずはな)に　寄るこつみなす　寄らむ児(こ)もがも　大伴家持</p>
<p>(現代語訳) 卯の花を腐らせるほどに痛めつける長雨、この雨のせいで流れ出す大水の鼻先に寄りつく木っ端のように、私に寄り添ってくれる娘でもいてくれたらなあ</p>
<p><a href=https://www.kadokawa.co.jp/product/200803000453/>新版　万葉集　四　現代語訳付き</a></p>
</blockquote>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>この季節の長雨には「卯の花腐し」という別名があります。画像は改元でも話題となった『万葉集』より「卯の花を腐す霖雨の…」という大伴家持の和歌。初夏の卯の花が枯れてしまうような長雨の表現です。詳しくは7月から始まる企画展「雨に詠えば―空模様の古典文学―」にて！ <a href=https://t.co/ZyU1h8TyNv>https://t.co/ZyU1h8TyNv</a> <a href=https://t.co/VaXKX0FGEI>pic.twitter.com/VaXKX0FGEI</a></p>&mdash; 国立公文書館 (@JPNatArchives) <a href="https://twitter.com/JPNatArchives/status/1130805663444213760?ref_src=twsrc%5Etfw">May 21, 2019</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<h2 id=ジョギング>ジョギング</h2>
<p>あまり調子がよくなかったので19時にお仕事を終えて近所の公園にジョギングに行ってきた。ワクチンを接種してから運動を控えていたのでジョギングしたのは初めてかな。2-3日に1回ぐらいの頻度でジョギングしている。ワクチン接種した週はウォーキングに留め、次の週は実家で田んぼ仕事でバテてて、今週は初めて行ってきた。ちょっと早い時間帯だったせいか、2つの陸上部が練習していてやや人が多かった。400m級のトラックがあって陸上部の人たちが練習している。練習の邪魔にならないよう、トラックの内側を20-30分とぼとぼジョギングしている。疲れたら歩きながらなのでそんなに距離は走ってない。ジョギング終えてから30分ぐらいストレッチをした。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1013/>vimgrep 検索の嬉しさ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-13
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<img src=/diary/img/2021/1013_vimgrep.png class=post-cover alt="vimgrep 検索の嬉しさ">
<div class=post-content>
<p>2時頃に寝て6時に起きる。普段、日記は vim で書いている。ちょっとした過去の日記の検索に <code>vimgrep</code> でこと足りるのが嬉しい。テキストで日記を書いていることの利点かな。夜に <a href=https://fin-py.connpass.com/event/226933/>fin-pyコードリーディング会#4</a> に参加した。事前に <a href=https://hackmd.io/bFBFaPbYS1Kqfc97HMlp7Q?view>hackmd</a> に発表内容のメモを書いてた。いろんな発表者の視点があってコードリーディングのイベントはおもしろかった。</p>
<h2 id=朝活>朝活</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/227678/>【三宮.dev オンライン】リモート朝活もくもく会</a> に参加してみた。何もなかったらだいたい7時頃に起きるのがなにか目的があると6時に起きれる。人体の不思議。せっかく起きたので <a href=/diary/posts/2021/0929/#joel-on-software>前に More Joel on Software を読んだとき</a> に学生向けのアドバイスにあったミクロ経済学の勉強のためにその入門書を読み始めた。参加者が勉強会の常連ばかりだったので朝からわりと雑談してた。2人転職するという話で2人とも東京の会社でフルリモートワークで働くらしい。働き方が変わったなと感じる。その後、第1章の無差別曲線を読んだ。</p>
<h2 id=youtube-配信と集中力>YouTube 配信と集中力</h2>
<p>あんちぽさんの <a href=https://kentarokuribayashi.com/journal/2021/10/09/2021%e5%b9%b410%e6%9c%889%e6%97%a5>2021年10月9日</a> の日記でスライド作成の興がのらないので YouTube 配信しながらやったら集中できてよかったと書いてあったのでちょっと眺めてみた。なんかスライドの作成のやり方とか、自分と違うのかな？とか思いながらみたけど、やり方自体は普通だった。ただ集中できてよかったとあるので普段のやり方とは異なることをすることに意義があるのかな？とも思えた。試しに YouTube Live やってみようとしたら初期設定？に24時間かかるとのこと。代わりに <a href=https://launchpad.net/kazam>kazam</a> というスクリーンリコーダーの使い方を調べてた。勉強会で作業したログとかを録画しておいてなにかに使えたりするかもしれない。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>半日ほどかかって3章ストレージと抽出を読んだ。読みながら書いているので時間がかかる。今日はこれだけ。まとめはこんな感じ。</p>
<blockquote>
<p>データベースのシステムには2つの用途があり、その特性やパフォーマンスを最適化するためにストレージエンジンやデータ構造が異なるもので運用されるようになってきた。</p>
<ul>
<li>オンライントランザクション処理 (OLTP)
<ul>
<li>行指向、トランザクション処理</li>
</ul>
</li>
<li>オンライン分析処理 (OLAP)
<ul>
<li>列指向、分析クエリ</li>
</ul>
</li>
</ul>
<p>OLTP には2つの主要なストレージエンジンがある。</p>
<ul>
<li>B ツリー
<ul>
<li>1970年代からあり、成熟していて且つ効率的なインデックスのデータ構造</li>
</ul>
</li>
<li>LSM ツリー
<ul>
<li>比較的最近開発された、ディスク上でのランダムアクセスをシステム的にシーケンシャルアクセスに変換して、書き込みのスループットを高める手法。もとは Google の BigTable の論文？</li>
</ul>
</li>
</ul>
<p>OLAP の典型的なデータウェアハウスの高レベルでのアーキテクチャでは、大量の行をシーケンシャルにスキャンしなければならないクエリの場合、インデックスはあまり関係なく、データを非常にコンパクトにエンコードし、クエリがディスクから読まなければならないデータの量を最小限にとどめることが重要となる。この目標を達成するのに列指向のストレージが役立つ。</p>
</blockquote>
<p>過去に Cassandra を使ったプロダクトの開発に関わっていたから B ツリーと LSM ツリーの概要は知っていて3章で書いてあることはだいたい理解できた。データウェアハウスに関しては、前にお手伝いしていた会社で普通のログを Amazon Athena で処理すると1時間とかかかって分析クエリが Parquet に変換すると数分で完了したりするのを目の当たりにしてた。分析処理で読み込むデータ量を削減する列指向の考え方は理解しておく必要がある。行指向のデータを列指向フォーマットである <a href=https://parquet.apache.org/>Parquet</a> に変換する <a href=https://github.com/reproio/columnify>columnify</a> のコードも読んだことがあったので内容のイメージはできるけど、実務経験が少ないと全体像がわかっておらず、本書を読みながら学び直ししてた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1012/>やや疲れ気味</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-12
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
</span>
<div class=post-content>
<p>昨日は1時半に寝て7時半に起きた。なんか疲れが溜まっているのか寝不足なのか、しゃきっとしなくて15時頃にお昼ご飯食べてきて、戻ってきて2時間ほど寝てた。夕方に寝ると夜の睡眠が悪くなるかもしれない。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p><a href=https://www.oreilly.co.jp/books/9784873118703/>データ指向アプリケーションデザイン -信頼性、拡張性、保守性の高い分散システム設計の原理</a></p>
<p>先週末から読み始めようと思いつつ、ダラダラしていて今日から読み始めた。600ページ超と分量が多いので少しずつ読んでいく。買ったのは2019年7月なので2年越しの積ん読。前職で書籍購入の補助制度があったのでその予算消化のために買ったみたいなもの。でも買っておくといつか読むので買っておいてよかった。今日は2章まで読んだ。</p>
<p>「データ指向」という用語は、cpu のデータ処理がボトルネックとなり、且つそのデータ量や複雑さなどが主な課題となるアプリケーションのことをデータ指向と定義している。ソフトウェアシステムにおける3つの課題。これはすべて非機能要件になる。</p>
<ul>
<li>信頼性</li>
<li>スケーラビリティ</li>
<li>メンテンナンス性</li>
</ul>
<p>リレーショナルデータベースと NoSQL の台頭から始まり、ドキュメントデータベースやグラフデータベースの概要やリレーショナルデータベースとの比較などが書いてある。また NoSQL 系のデータベースのクエリ言語とか、よく知らないので勉強になった。12章あるので1日1-2章ぐらいのペースで今月中に読めたらいいや。</p>
<h2 id=slack-のワークフロービルダーの調査>Slack のワークフロービルダーの調査</h2>
<p>今度、勉強会をするので調べ始めた。ワークフロービルダーは簡単に定型的な処理を作成できるけど、有料プランでしか使えないのでコミュニティなどでは使いにくい。試しにいくつかワークフローを作ってみて感触を理解した。おそらくワークフロービルダーは Slack app を作成するためのフレームワークにみえる。作成したワークフローの1つ1つが Slack app になるのではないか。</p>
<ul>
<li><a href=https://github.com/t2y/python-study/tree/master/BizPy/slack/20211027>https://github.com/t2y/python-study/tree/master/BizPy/slack/20211027</a></li>
</ul>
<p>Slack native? first? な課題管理システムもいくつかみつけた。非開発者に課題管理システムを使ってもらうのはかなり難しいので Slack と課題管理システムが連携すれば課題管理の方法論に新しい価値が出てくるのではないかと考え始めた。この機会に Slack app で構築されば課題管理システムも調べてみようと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1011/>BizPy 再始動</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-11
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/python/>python</a>&nbsp;
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
#<a href=/diary/tags/harassment/>harassment</a>&nbsp;
</span>
<img src=/diary/img/2021/1011_hot-entory.png class=post-cover alt="BizPy 再始動">
<div class=post-content>
<p>昨日は晩ご飯食べてからのんびりしていた。寝て起きての繰り返しだったので何時に寝たのかよくわからない。夜、本を読もうと思っていたのにダラダラ過ごしてしまった。朝は7時半に起きた。朝起きたら <a href=https://t2y.hatenablog.jp/entry/2019/06/29/150125>Python で Unicode 正規化 NFC/NFD の文字列を扱う</a> がはてブでホットエントリ化してた。昨日、書評を書いたからその記事かと期待したけど、なぜか2年ほど前に書いた古い記事だった。なんかがっかり。そして、その理由は全くわからない。1日経って夜の時点ではてブが82個ついている。昔は10個もついたら嬉しかったものだけど、いまは100個ぐらいついてもなんとも思わない。</p>
<h2 id=fin-pyコードリーディング会に発表準備>fin-pyコードリーディング会に発表準備</h2>
<p><a href=https://fin-py.connpass.com/event/226933/>fin-pyコードリーディング会#4</a> に参加することにした。過去にオブジェクトストレージの開発に関わっていたからデータストアやストレージに関することは興味がある。たまたまツールの <code>store.py</code> を題材にしていたので読んでしまった。簡単にコードを読んで気になったところをイベントの hackmd に記載した。やっていることの詳細をよくわかっていないので、コードレビューみたいになってしまった。</p>
<ul>
<li><a href=https://hackmd.io/bFBFaPbYS1Kqfc97HMlp7Q?view>https://hackmd.io/bFBFaPbYS1Kqfc97HMlp7Q?view</a></li>
</ul>
<h2 id=bizpy-のコミュニティ活動を再開>BizPy のコミュニティ活動を再開</h2>
<p>前にやってたお仕事がうまくいかなくて他のことに時間を費やす余裕がなくてお休みしてた。本当はもっと早く再開してもよかったんだけど、新しいことに挑戦しているときにあまり他のことに注意を取られたくないという考えもあって少し保留していた。新しいことへの活動も一段落して方向性や展望もみえてきたので BizPy も再開することにした。ちょうど Slack のインテグレーションを調べようと思ったところだったので弾みを付ける意図でも都合がよい。複数の意味でタイミングがよかった。また参加者が戻ってきてくれると嬉しい。</p>
<ul>
<li><a href=https://bizpy.connpass.com/event/198717/>Python で Slack のインテグレーションをやってみる勉強会 #1</a></li>
</ul>
<h2 id=プロコンの続き>プロコンの続き</h2>
<p>ネットで話題になったせいか、当事者同士で話し合う場が設けられたという公式発表が行われた。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>第32回高専プロコン秋田大会自由部門プレゼン審査発表順番号５の質疑応答について、発表者・質問者双方の相互理解の場を設けさせて頂きました。<a href="https://twitter.com/hashtag/procon32?src=hash&ref_src=twsrc%5Etfw">#procon32</a> <a href=https://t.co/nlzujvJ7Hv>pic.twitter.com/nlzujvJ7Hv</a></p>&mdash; KosenProcon (@KosenProcon) <a href="https://twitter.com/KosenProcon/status/1447192976946384901?ref_src=twsrc%5Etfw">October 10, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<p>これ以上、外野がとやかく言う必要はないと思うけど、一方で立場の強い人が有利になってしまうため、運営はハラスメント行為を行った審査員へ然るべき措置をすべきといった意見もみられた。一理あるかもしれないが、そこまでするほどの問題かというのは個人的に思う。タイムラインを眺めていると、ハラスメントを問題視する人は、その背景や経緯や意図はすべて横に置いておいてハラスメント的言動や態度を糾弾する。この人たちと背景も考慮して整理しようとする人たちとは全く議論が噛み合わない。ハラスメントは絶対許すまじという社会の変化や誤った人への行き過ぎたキャンセルカルチャーに私はやや圧倒される。</p>
<p>そう思っていると、私のタイムラインでは「まさかりを投げる」という表現そのものや行為のハラスメントの是非の議論も巻き起こっていた。あまり最近はまさかりを投げるという表現は見かけないんだけど、「マウント禁止」というのをちょくちょくみかける。ハラスメントと根っこは同じで悪気の有無に関係なく発信側が責めを負うようになったんだなと感じる。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>まさかりの議論とは別に、最近勉強会で「マウント禁止」というルールもよくみかける。これもマウントされたと感じる人と、知っていることを教えようとする人との関係の難しさを感じる。多少の間違いやもっとこうした方がいいよといったアドバイスをしなくなる人も多いのでは？という気はする。</p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1447429693959860236?ref_src=twsrc%5Etfw">October 11, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1010/>86―エイティシックス―</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-10
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/hugo/>hugo</a>&nbsp;
</span>
<div class=post-content>
<p>2時に寝て7時に起きる。昨日 <a href=https://anime-86.com/>86―エイティシックス―</a> の第2クールの初回をみた。起きてから第1クールの後半の内容を見返したりしてた。内容がすごくおもしろいというわけではないんだけど、作品の世界観と音楽がよい。というか、<a href=https://www.sawanohiroyuki.com/>澤野弘之</a> 氏のファンなので彼が音楽を手がける作品はみてしまう。第1クールの音楽も素晴らしかった。音楽がよいと映画やアニメのシーンが盛り上がるし、音楽だけを聞いているときにもそのシーンのイメージが想起されて音楽そのものにも深みが出るような気がする。</p>
<h2 id=terminal-のカスタマイズ>Terminal のカスタマイズ</h2>
<p>月別一覧のページを作成した。Hugo には <a href=https://gohugo.io/content-management/taxonomies/>Taxonomies</a> という仕組みがあって、任意のラベルでカテゴライズできる。デフォルトでは <code>categories</code> と <code>tags</code> が提供されている。設定ファイルに <code>dates</code> というカスタム Taxonomies を定義する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml>[<span style=color:#a6e22e>taxonomies</span>]
  <span style=color:#a6e22e>date</span> = <span style=color:#e6db74>&#34;dates&#34;</span>
  <span style=color:#a6e22e>tag</span> = <span style=color:#e6db74>&#34;tags&#34;</span>
</code></pre></div><p>コンテンツのメタデータには次のように年月のラベルを付与する。</p>
<pre tabindex=0><code>dates: [2021/10]
</code></pre><p>これは <code>hugo new</code> したときに自動生成されるので自分で明示的に設定する必要はない。</p>
<pre tabindex=0><code>dates: [{{ dateFormat &quot;2006/01&quot; .Date }}]
</code></pre><p>ラベル名に <code>/</code> を含めると自動的に月ごとのサブディレクトリになってくれるので月別のアーカイブを生成するのに都合がよい。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ tree -L <span style=color:#ae81ff>3</span> public/dates/
public/dates/
├── <span style=color:#ae81ff>2021</span>
│   ├── <span style=color:#ae81ff>09</span>
│   │   ├── index.html
│   │   ├── index.xml
│   │   └── page
│   └── <span style=color:#ae81ff>10</span>
│       ├── index.html
│       ├── index.xml
│       └── page
</code></pre></div><p>タグ一覧とは異なり、年単位・月単位にまとめて一覧表示するためにテンプレートをカスタマイズする。<a href=https://gohugo.io/templates/taxonomy-templates/>Taxonomy Templates</a> は <code>terms.html</code> によって提供されている。Terminal が提供しているこのテンプレートをカスタマイズすることで月別一覧を次のような表示になるようカスタマイズした。</p>
<figure><img src=/diary/img/2021/1010_dates.png>
</figure>
<p>実際の修正内容は次になる。</p>
<ul>
<li><a href=https://github.com/t2y/diary/commit/783d9685ae3698b85e428bce178bdd9ebe2c3dca>https://github.com/t2y/diary/commit/783d9685ae3698b85e428bce178bdd9ebe2c3dca</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1009/>職質された</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-09
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/hugo/>hugo</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きる。昨日も田んぼ仕事の疲れが残っていたのでよく眠れた。1週間で6時頃に起きる癖がついたのですぐに起きれた。</p>
<h2 id=terminal-のカスタマイズ>Terminal のカスタマイズ</h2>
<p>昨日からいくつか修正をしていた。</p>
<ul>
<li>画像のパス問題の修正</li>
<li>favicon の追加</li>
<li>タグ一覧リンクの追加</li>
<li>atom フィードに icon 要素の追加 (feedly では読み取れない)</li>
</ul>
<p>atom フィードに favicon を指す要素を埋め込んでみたんだけど、feedly ではダメっぽい。たまたまヒットした GitHub issue でもそういったコメントをみかけた。</p>
<ul>
<li><a href=https://github.com/huginn/huginn/issues/1628#issuecomment-882103625>https://github.com/huginn/huginn/issues/1628#issuecomment-882103625</a></li>
</ul>
<h2 id=ストレッチ>ストレッチ</h2>
<p>毎週土曜日はストレッチの日。田んぼ仕事のおかげで全身軽い筋肉痛になっている。ストレッチを受けると、いつものときとの違いから、股関節から右ももと腕の筋肉がすごく張っているのに気付く。田んぼのような突発的に体を動かして疲労が溜まったときにもストレッチでほぐせるのがよい。今日の開脚幅は開始前169cmで、ストレッチ後170cmかな。前より少し落ちたのは田んぼ仕事に疲れて平日にあまりストレッチが出来なかったのと筋肉痛のせいかもしれない。</p>
<h2 id=joel-on-software>Joel on Software</h2>
<p>本当は実家に帰っているときに書き上げようと考えていたものの、田んぼ作業での疲れと実家のパソコンを使って作業する環境の悪さから書くことに集中できなくなって断念していた。集中できる環境なら3時間ほどで書けた。動機づけよりも価値観、価値観がブレないならその次は集中できる環境作りにこだわっていきたい。</p>
<ul>
<li><a href=https://t2y.hatenablog.jp/entry/2021/10/09/162618>https://t2y.hatenablog.jp/entry/2021/10/09/162618</a></li>
</ul>
<h2 id=職務質問>職務質問</h2>
<p>買いものして帰ろうとしてたら警察官に止められて職務質問をうけた。自転車の盗難が多いので防犯登録を調べたいとのこと。はいはいって感じで免許証を提示する。自転車は東京で購入したもので10年以上乗っている。防犯登録は警視庁になっているらしく、兵庫県警の警察官では調べられないみたい。次に車体番号も読み取って調べていたけど、よくわからなかったみたい。結局、私が本物の持ち主とその場で調べることができなくて、警察官もたぶん本物だと思いますみたいな歯切れの悪い結果で職務質問を終えた。仮にその自転車が盗難にあってもその防犯登録から私を辿ることはできないので近所の自転車屋さんで防犯登録入り直してくださいと言われた。あー、またこの件か。都道府県の防犯登録のシステムが全国で統合されていればいい話しなのに、なんで引っ越したら防犯登録をやり直さないとあかんねんと。現場の警察官に言っても仕方ないので何も言わないことにした。</p>
<h2 id=プロコン>プロコン</h2>
<p>たまたまタイムラインでみかけてちょっと眺めてた。動画で同じ内容をみて、ハラスメントを問題視する人と、プロダクトの新規性について言及する人がいて、感じ方は人それぞれだなぁと思いながら <a href="https://twitter.com/search?q=%23procon32&src=typed_query&f=top">ハッシュタグ</a> を眺めてた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1008/>畝作り</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-08
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/agriculture/>agriculture</a>&nbsp;
</span>
<img src=/diary/img/2021/1008_field.jpg class=post-cover alt=畝作り>
<div class=post-content>
<p>23時頃に寝て6時頃に起きた。田んぼは朝の方が涼しくて作業しやすいので朝起きるインセンティブになる。電車乗らなくなって早起きできなくなってたけど、やっぱり朝起きるインセンティブがあると起きれる。徐々に暑くなるせいか10時が感覚的に暑さのピークでそれ以降はあまり変わらない気がする。</p>
<h2 id=畑の水やり>畑の水やり</h2>
<p>7時半から8時まで水やり。昨日、amazon で購入した13リットル入るじょうろが届いたので初めて使ってみた。とくに問題なくて大きいので畑に水をやるときに往復する回数が減る。私が調べた限りだと、一番大きいジョウロが13リットルだった。よさそう。</p>
<h2 id=田んぼの肥料撒きと畝作り>田んぼの肥料撒きと畝作り</h2>
<p>8時から15時までお昼休憩を挟みつつ田んぼの作業。畝作りする前に堆肥を土に撒かないといけないらしい。鶏糞と苦土石灰 (くどせっかい) を撒いた。本当は一反あたり鶏糞を2-3t撒くとあったけど、しんどいので100kgぐらいにしといた。苦土石灰は50kg撒いた。撒き終わったのがお昼前で少し雑用もやって、お昼からトラクターで畝作りを12時半から15時ぐらいまでやってた。この後、母が菜の花を植えるらしい。菜の花は9-10月頃に植えて4-5月頃に収穫を迎える。なんか菜種油を淡路島の特産にしたい運動？をやっていて、菜の花の種を無料で配っているらしい。試しにやってみるとのこと。</p>
<p>耕し終えたら、再度アルミブリッジを使って田んぼから畔を跨いで出る。ブリッジの配置がよくなかったのか、ウィリー状態になってひっくり返りそうになった。危なかった。</p>
<figure><img src=/diary/img/2021/1008_tractor-bridge.jpg>
</figure>
<h2 id=三ノ宮へ>三ノ宮へ</h2>
<p>17時の高速バスに乗って三ノ宮へ戻る。一旦、家に戻って荷物を置いて、キングダムのアニメをみて、20時からオフィスで今週の仕事始め。隔週で顧問さんと打ち合わせしている。次の月曜日は打ち合わせの日なのでそれまでに打ち合わせの議題の準備をしておく。いつもは水曜か木曜には打ち合わせする内容を連絡している。今週は全然仕事できなくて金曜日に話したいチケットを連絡した。そのチケットの仕上げをいまから片付ける。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1007/>傍聴</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-07
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/agriculture/>agriculture</a>&nbsp;
#<a href=/diary/tags/court/>court</a>&nbsp;
</span>
<div class=post-content>
<p>1時頃に寝て6時に起きる。実家なんで久しぶりにテレビみてて、新潟ロシア村の廃墟に潜入するのをやっててちょっとおもしろかった。バブル末期のテーマパークが休業状態になって廃墟と化したらしい。</p>
<ul>
<li><a href=https://travel-noted.jp/posts/21044>新潟ロシア村は心霊スポットに！廃墟と化したテーマパークの現在は？</a></li>
</ul>
<h2 id=畑の水やり>畑の水やり</h2>
<p>7時から8時まで水やり。軽トラに水を入れた雨水タンクとバケツを畑まで運び、じょうろに水を入れて何往復かして水をやる。手間隙がかかるだけでそんな大変ではない。この作業は慣れた。</p>
<h2 id=田んぼの草焼きと耕起>田んぼの草焼きと耕起</h2>
<p>昨日の続き。朝は露が降りて湿っていて草に火がつきにくい。昨日、焼いた半分の田んぼをトラクターで耕すことから始める。半分終えてから残りの半分の草も順次焼いていった。火のコントロールの慣れたのと、燃え拡がるほどの領域はないので安心して火を放つことができた。終えてから残りの半分もトラクターで耕した。だいたい8時から13時まで草焼きと田んぼを耕していた。</p>
<figure><img src=/diary/img/2021/1007_field.jpg>
</figure>
<h2 id=裁判の傍聴>裁判の傍聴</h2>
<p>15時から父の交通事故に関する裁判に行く。裁判所行くのも初めて。裁判官から母に意見を聞きたいという機会で、たまたま私も帰っているので一緒に傍聴させてもらうことにした。普段の裁判は事前に質疑応答のやり取りが弁護士間で行われており、実際の裁判は5-10分で内容だけ確認したら次回の予定を決めているだけだという。</p>
<p>待合室で父の成年後見人の弁護士さんと話していたら、裁判も徐々にリモート化の流れになってきていて、実際のこの裁判では相手の弁護士さんはテレビ会議で参加している。関係者もリモート会議でも構わないけれど、裁判は関係者しか参加してはいけないという制限があって、リモートだと周りに関係ない人がいないことを証明するのが難しいと仰っていた。裁判のときに裁判所のスタッフが相手の弁護士に電話を繋いだとき「周りに誰もいませんか？」と確認していた。</p>
<p>裁判官と書記のようなスタッフと母と父の成年後見人の弁護士さん、私の5人で裁判が始まった。言うても普通の会議室のような場所で、裁判官が進行を進めながら、普通に会議をやるような感じだった。出席者は誰もノートPCをもっておらず、紙の分厚い資料が2-3束置いてあって、書記さんも手書きで紙のノートにメモをとっていた。私がスマホでメモをとってたらスマホは使うなと怒られた。あとで弁護士さんに確認したら、通常の裁判だったらメモをとってもいいけど、傍聴人は電子機器を使うのはダメみたい。弁護士だったらノートPCでメモをとる人もいるらしい。成年後見人の弁護士さんは、裁判のときに紙の資料の方がぱらぱらめくって見つけるのが速いのでノートPCを使わないと話してた。そんなもんかな。</p>
<p>裁判官の進行や説明がぐだぐだ過ぎてちょっと驚いた。見た目30代ぐらいの裁判官。裁判官って司法試験をパスした優秀な人がなっているであろうになんか拍子抜けした。あとで弁護士さんと雑談していたときに「和解案は支部のそこそこ優秀な人たちが作るのであまり変なものは出てこない。本当に優秀な人たちは東京や大阪で働いているけど、、、」みたいなことをさらっと話してた。</p>
<p>地方裁判所の裁判官とかは、相対的に優秀な人は少ないという話なのかな？裁判官がぐだぐだ過ぎるので弁護士さんがちょくちょくツッコミを入れながら進行をサポートしていた。もしくは多くの案件を抱え過ぎていて、個々の裁判の経緯や内容をいちいち覚えてないのかもしれない。当初、こちらは被害者側なので言葉に配慮して柔らかく話すように努めているのかな？と思って聞いてたけど、進行もぐだぐだなんで、どうも違うのかな？と思うようになった。話すときに、順接、逆説、指示語が多くて何が言いたいのかさっぱりわからなくて1つのことを伝えるのに無駄に言葉数が多いように感じたけど、それは端的に要点のみを話すのに慣れた、私の職業病なんやろかとかも思いながら聞いてた。</p>
<p>交通事故の裁判の場合、よほど変なのが出てこない限り、和解案で決めておいた方がよいと弁護士さんは仰っていた。それは裁判所が被害者側に寄り添って作るものなのでそれを拒否して判決まで行ってもそれよりもよい内容にはならず、悪くなる可能性が高いという。次回かその次ぐらいで和解案が出てくるみたい。もう少しでこの裁判は終わりそう。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1006/>草焼き</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-06
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/agriculture/>agriculture</a>&nbsp;
</span>
<div class=post-content>
<p>23時頃に寝て7時に起きる。蚊取り線香のおかげでよく眠れるようになった。やや筋肉痛。</p>
<h2 id=畑の水やり>畑の水やり</h2>
<p>昨日と同様に雨水タンクからポリタンクへの水の移し替えをした。入れ物からホースが外れないように釣りの重りを買ってきてつけてみた。ダイソーで25号の重りとキーホルダーの輪っかとタイラップを購入した。もう少し重い方がよかったけど、ないよりはましかな。</p>
<figure><img src=/diary/img/2021/1006_hose-weight.jpg>
</figure>
<h2 id=田んぼの草集めと草焼き>田んぼの草集めと草焼き</h2>
<p>昨日、草刈りが完了したので乾かした草を焼いていく。草が乾いていないとなかなか火がつかなかったり、ついても火力がないと消えてしまう。また逆に草がよく乾いていると火の回りが早く一気に燃え拡がるので火のコントロールができない。隣の田んぼや周りに燃え広がらないように注意してやらないと家事になりそうで危ない。</p>
<p>田んぼの周囲の草を内側に集めて、周囲を先にトラクターで耕すことにした。草がなければ燃え拡がることはないので結界のようなものを作る。まずトラクターを田んぼに入れる。あらかじめ3mのアルミブリッジを用意してあったので畔の谷をまたいで橋を渡る。</p>
<figure><img src=/diary/img/2021/1006_tractor-bridge.jpg>
</figure>
<p>先に周囲だけぐるりと耕す。</p>
<figure><img src=/diary/img/2021/1006_turn-over.jpg>
</figure>
<p>慣れてきて草の帯を作って風上から風下へ燃やしていく。</p>
<figure><img src=/diary/img/2021/1006_burn-grass.jpg>
</figure>
<p>煙に巻かれないようにしながら半分ぐらいの草を焼けた。都会で暮らしていると火をつけるという作業をすることはあまりない気がするけど、火を育てながら燃やしていくのが割とおもしろかった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1005/>草刈り完了</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-05
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/agriculture/>agriculture</a>&nbsp;
</span>
<img src=/diary/img/2021/1005_grasscutter.jpg class=post-cover alt=草刈り完了>
<div class=post-content>
<p>22時頃に寝て6時に起きる。昨日は蚊取り線香をセットしたのでよく眠れた。田んぼ作業して疲れ果てたせいか、早く寝て途中で起きることもなかった。最近はたいてい夜中に1-2度は起きるけれど、昨日は疲れていたので起きなかった。やっぱり体力を使うとよく眠れるみたい。平日ももっと運動して疲れた方がいいのかもしれない。</p>
<h2 id=畑の水やり>畑の水やり</h2>
<p>昨日より遅く起きたので7時半から。午後から一緒に畑の面倒をみてくれている人が手伝ってくれるらしい。その人が水やりできるよう雨水タンクから畑に置いてあるポリタンクへの水の移し替えを自動化してみた。</p>
<figure><img src=/diary/img/2021/1005_watertank.jpg>
</figure>
<p>あとは軽く水やりして細々した作業をしてた。じょうろで水をやっていると、ゴミのせいか目が詰まってあまり水が出なくなる。こし網つきのじょうろがないか探したら2-3候補が出てきた。レビューをみながら次のものを購入した。</p>
<ul>
<li><a href=https://www.amazon.co.jp/gp/product/B00762ACJE/>トンボじょうろ13型</a></li>
</ul>
<p>選定理由はこれら。レビューみてたらサイズの大きいじょうろは使っているとすぐヒビが入るとか壊れるとかのコメントもみかけた。</p>
<ul>
<li>水をたくさん入れられる</li>
<li>こし網がついている</li>
<li>普通に使ってて壊れない</li>
</ul>
<h2 id=田んぼの草刈り>田んぼの草刈り</h2>
<p>昨日の続き。8時ぐらいから始めて11時過ぎまでひたすら草刈機で草刈りしてた。10時ぐらいが暑さのピークでバテて残りを夕方にしようかと考えていたけど、その後、涼しくなったんで草刈りは全部終えた。草刈機やったことなかったんでまだあまりうまく使いこなせない。身長と機械の竿の長さがあってなくて微妙にやりにくい。あと草の倒れている方向と草刈機の刃の入れ方を調整したりしながら試行錯誤してた。なかなか難しい。草を刈らずに放置していると、草を刈って燃やすという余分な手間隙がかかる。システムで例えると、メジャーバージョンを2つぐらいまとめてあげるみたいなもん。草が伸びてしまう前に田んぼ耕しておくべきだったと反省した。今後は気をつけよう。</p>
<h2 id=お見舞い>お見舞い</h2>
<p>15時から父のお見舞い。病院はまだ直接の面会を再会していないので会議室のようなところでタブレットでリモート面会する。父は喉を気管切開してて話せないのでリモート面会しても会話はできない。定期的に顔を出しにいくみたいなもの。帰りにあちこち寄って細々したことをやってたら18時ぐらいになって田んぼできなかった。最近は18時まわると暗くなるな。気付いてなかった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1004/>草刈り</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-04
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/agriculture/>agriculture</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<img src=/diary/img/2021/1004_field.jpg class=post-cover alt=草刈り>
<div class=post-content>
<p>3時に寝て4時半に起きる。ほとんど寝てない。蚊がいて飛んでいるのが気になったり刺されてかゆかったりして寝るの諦めた。もう涼しくなって大丈夫かと思ってたけど、まだ蚊取り線香が必要だった。</p>
<h2 id=畑の水やり>畑の水やり</h2>
<p>6時半から7時半まで。玉ねぎ、茄子、大根、ミニトマトなど、いろいろ野菜が植えてある。玉ねぎはいま芽が出てきたところで水をたくさんやらないといけないらしい。</p>
<h2 id=joel-on-software>Joel on Software</h2>
<p>書評の続き。空き時間に少し書いた。実家だとオフィスより環境がよくないので集中力が下がり、その結果として効率が落ちる。本書の中でもオフィスのこだわりの章があったけど、環境が大事ということが実感できた。</p>
<h2 id=田んぼの草刈り>田んぼの草刈り</h2>
<p>午後から草場となった田んぼの草刈り。ある程度草を刈っておかないとトラクターの爪に巻き込むので耕すことができない。草刈機で刈り取りつつ、それを集めてきて、乾かして焼く。焼畑農業みたいなことをしないといけない。刈ったばかりの草は水分を含むのですぐには焼けない。一方で乾いた草はよく燃えるので燃え拡がってしまう。下手すると周りに燃え拡がって火事になってしまう。刈り取った草の集約や配置を調整しないといけない。日中、暑かったし、あまり寝てなかったから夕方は眠くてバテてた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1003/>帰省</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-03
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<img src=/diary/img/2021/1003_temperature.png class=post-cover alt=帰省>
<div class=post-content>
<p>0時に寝て9時頃に起きる。今朝は寝起きが悪くてベッドでぐだぐだしてた。ダイの大冒険をみて家事をした。数日、家を空けるので冷蔵庫の中を空にして、洗いものやゴミの始末をする。11時半頃にオフィスに着く。</p>
<h2 id=omron-connect>OMRON connect</h2>
<p>グラフは今週の平均体温の推移を示したもの。ワクチン摂取後の体温は36.5-37.0℃の間を行ったり来たりしているものの、体調はまったくしんどくないのであまり気にしてない。そもそも摂取後に体温を測り始めたので自分の平熱がどのぐらいなのかすら把握してないことに気付いた。<a href=https://www.healthcare.omron.co.jp/product/mc/mc-6800b.html>音波通信体温計 MC-6800B　けんおんくん</a> を使っていて OMRON connect というスマホアプリで計測した体温を記録できる。</p>
<h2 id=joel-on-software>Joel on Software</h2>
<p>書評を書き始めた。自分が学んだところや関心をひいたところは、読みながらメモ書きで課題管理システムのチケットに書いてある。それらを見返しながら、一般向けの書評にまとめる。自分にしかわからない内容を補足したり、見返すと言及するほどではないことを取り除いたり。あとは書く根気と時間次第になるわけだが、いまは時間がたっぷりあるので比較的、時間がかかっても学びの質をあげるためになるべく書くようにしている。5時間ほどかけて1/3ぐらい書けた。まだ途中。</p>
<h2 id=実家へ>実家へ</h2>
<p>16時30分の高速バスで実家へ帰る。18時前ぐらいに実家の最寄りのバス停につく。そこから車で10分ほど。片道が2,090円で、往復券だと割引で3,760円になり、420円お得になる。この距離だと大した金額ではない。東京にいたら新幹線が往復で3万円ほどで、乗り継ぎの時間を入れると移動時間も6-7時間になってしまう。東京から神戸に戻ってきた理由として実家に気軽に帰りやすいというメリットがある。</p>
<p>今回の帰省の目的は田んぼの一部が草場になっているので耕さないといけない。本当は9月中にやりたかったが、天候とワクチン摂取などを調整してたら10月になってしまった。自分の会社でよいのは、(他社の仕事を受けてなければ) 自分の都合で休日・平日関係なく業務の調整ができること。来週は実家の雑務: 田んぼや裁判の傍聴などをやりながら隙間に会社の仕事をする。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1002/>テーマスタイルのカスタマイズ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-02
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/hugo/>hugo</a>&nbsp;
</span>
<div class=post-content>
<p>昨日の夜は早めに仕事を終えて <a href=https://opt.connpass.com/event/222709/>第一回関数型プログラミング（仮）の会</a> の、やましたさんとみずしまさんの発表の2つだけ聞いて、疲れてそのまま帰ってゆっくりしてた。ドラクエタクトの新しいイベントやってたかな。あと今秋初めて買った梨を食べてた。たぶん0時ぐらいには寝て8時ぐらいに起きた。</p>
<p><a href=https://www.ytv.co.jp/asapara/>あさパラS</a> は総裁選の振り返りや役員人事の解説やっててほむほむと見てた。河野さんが官僚に嫌われる要因の1つとしてちょっと前にパワハラ音声が流出してたけど、言葉遣いがきついのに加え、正論をきつく言うから官僚の逃げ道をなくして追い詰めてしまうといったことが話されてた。心理的安全性の文脈で、お互いに信頼関係が築けた上で厳しいことを指摘するのは構わない (言い方は配慮すべき) が、そうじゃないと相手を追い詰めてしまう。過去に私も不誠実な相手に対して正論を言って追い詰めがちだったのでいまは反省している。目的は課題を解決することであって、相手を追い詰めても目的を果たせないということがようやく経験から理解できるようになってきた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>毎週土曜日は <a href=https://doctorstretch.com/>Dr.stretch</a> さんでストレッチしてる。開脚の幅が目標 (メトリクス) になっていて毎週測っている。目標は自分の身長と同じぐらいということで178cm。ストレッチの開始前に測って、ストレッチを受けてから再計測する。今日は開始前169cm、ストレッチ後171cmと初めて170cmの大台に到達した。このままうまくいけば、あと3-6ヶ月ぐらいあれば目標の身長と同じぐらいの開脚幅になるかもしれない。家でも毎日ではないけど、2日に1回ぐらいのペースでストレッチをするのが習慣になりつつある。いまジョギングをすると腰に負担がくるんやけど、トレーナーさんが言うには、開脚幅が広がると股関節の可動域があがって腰の負担も減るという。本来、腰の筋肉は動かない方の筋肉だが、股関節の可動域が小さいとそれを補うために腰の筋肉が動いてしまい、その結果として腰に負担がかかる。なので、股関節が本来の意図した動きをしていれば、自然に腰の負担も下がるという理屈らしい。</p>
<h2 id=価値観を育てる>価値観を育てる</h2>
<p>あんちぽさんのスライドを眺めて共感してた。日記を書き始めたのも <a href=https://kentarokuribayashi.com/>あんちぽさんの日記</a> を読んでて、毎日やっていることを「書くこと」は何かしら意味や意義があるんじゃないかと思うようになったから。</p>
<iframe class=speakerdeck-iframe frameborder=0 src=https://speakerdeck.com/player/422f05833bc64c1a978c1ba92020a249 title="自分の人生を生きる - 遊びで生きて価値観を育てよう / Live Your Own Life - Live for Fun and Develop Your Values" allowfullscreen mozallowfullscreen=true webkitallowfullscreen=true style="border:0;background:padding-box padding-box rgba(0,0,0,.1);margin:0;padding:0;border-radius:6px;box-shadow:rgba(0,0,0,.2)0 5px 40px;width:560px;height:314px"></iframe>
<p>歳を経て難しく感じるようになったことの1つに <strong>動機づけ (モチベーションコントロール)</strong> がある。</p>
<p>私は基本的に忙しいという言葉を使わない。やらないといけないことの何かが進捗していないとき、それは「やる気がない」と受け止めている。もちろん相手がいるときにやる気がないとそのまま表現すると横柄だったり失礼だったりすることもあるので余裕がないと答える場合もある。しかし、本質的にはやる気がないが正しい。もう少し補足すると、いまやっていることの方が自分にとって優先度が高く (やる気があり)、それ以外の別のことを先送りしているだけだと捉えている。もし別のことにやる気があるならば、いまやっていることを後回しにすればいいだけだからだ。</p>
<p>ここで、何をやってもいいとしたら、何をやりたいかという課題が出てくる。適当にあれこれやってみても、実際にやってみるとうまくいかなくて、やる気が持続しなかったりすることがある。多くのケースで、若い頃ほどなにかに夢中になってやっていた経験が誰しもあると思うが、あのときはなぜそんなに夢中になってできたのか。いま思い返しながら、自分にとっての動機づけの源泉を探るようなことをしていかないとわからないのだ。まったく自分のことなのに。2021年に入ってからそういったことを考え続けていたところ、このスライドを眺めてたら動機よりも価値観なんだよと書いてあって、私がこの9ヶ月間、掘り返し続けてた動機づけの源泉=価値観という考え方はしっくりきて、価値観がブレると動機づけもうまくいかないなと思えた。</p>
<h2 id=hugoterminalのカスタマイズ>Hugo/Terminalのカスタマイズ</h2>
<p>Speaker Deck のスライドの埋め込みができなくて調べた。<a href=https://chizuchizu.com/blog/tag_hugo/>HUGOで埋め込みができない時の対処法</a> によると、<code>config.toml</code> に次の設定を追加すると表示された。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml>[<span style=color:#a6e22e>markup</span>]
  [<span style=color:#a6e22e>markup</span>.<span style=color:#a6e22e>goldmark</span>]
    [<span style=color:#a6e22e>markup</span>.<span style=color:#a6e22e>goldmark</span>.<span style=color:#a6e22e>renderer</span>]
      <span style=color:#a6e22e>unsafe</span> = <span style=color:#66d9ef>true</span>
</code></pre></div><p>Terminal のテーマだと本文と引用の違いわかりにくかったのでスタイルを変えてみた。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=color:#f92672>blockquote</span> {
  <span style=color:#66d9ef>background</span>: <span style=color:#ae81ff>#eafff4</span>;
  <span style=color:#66d9ef>color</span>: <span style=color:#ae81ff>#2d3330</span>;
  <span style=color:#66d9ef>font-style</span>: <span style=color:#66d9ef>italic</span>;
}
</code></pre></div><ul>
<li>
<p>変更前</p>
<figure><img src=/diary/img/2021/1002_blockquote-before.png>
</figure>
</li>
<li>
<p>変更後</p>
<figure><img src=/diary/img/2021/1002_blockquote-after.png>
</figure>
</li>
</ul>
<p>日付の表記を少し大きくして目立つようにした。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css>.<span style=color:#a6e22e>post-date</span> {
  <span style=color:#66d9ef>font-weight</span>: <span style=color:#66d9ef>bold</span>;
  <span style=color:#66d9ef>font-size</span>: <span style=color:#ae81ff>1.3</span><span style=color:#66d9ef>rem</span>;
}
</code></pre></div>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1001/>インボイス制度への準備</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-01
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/hugo/>hugo</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/gig/>gig</a>&nbsp;
</span>
<div class=post-content>
<p>夜はドラクエタクトやってて2時過ぎに寝て7時に起きた。気のせいか、日記を書くようになってから早く寝付けるようになった。まつのさんが twitter で久しぶりに Python 書いたとツィートしていて、何気なくふと <a href=https://github.com/line/line-bot-sdk-python/pull/340>Implement experimental asyncio support #101 #340</a> をみて、そのツールの関係者でもないのに勝手にクソリプ的なレビューコメントをした。気付いてしまったらみなかった振りするのも気持ち悪いので。</p>
<h2 id=インボイス制度の準備>インボイス制度の準備</h2>
<p>2023年10月1日から <a href=https://www.nta.go.jp/taxes/shiraberu/zeimokubetsu/shohi/keigenzeiritsu/index.htm>消費税の軽減税率制度・適格請求書等保存方式（いわゆるインボイス制度）</a> が開始される。開始される前に適格請求書発行事業者に登録しておく必要があり、その登録受付が今日から開始された。前に知人が教えてもらった解説動画を見返した。</p>
<div class=video-container>
<iframe src=https://www.youtube.com/embed/E0lOsLfj1T0 allowfullscreen title=消費税インボイス方式対策として今からやっておくべき３つのことをお話します。【簡易課税で税負担1/2に！？】></iframe>
</div>
<p>ちなみにうちの会社は今期から課税事業者になるのでインボイス制度開始による益税の影響は受けない。前期の決算で消費税を算出したとき、本則課税と簡易課税なら後者の方が46%の納税金額が少なくなることがわかった。IT 業界は経費に占める人件費の割合が大きい (人件費は消費税がかからない) ので簡易課税の方が節税になるのではないかという気がする。そのため、簡易課税で申請している。一度、申請すると2年間適用され、不適用届出を出さない限りはずっと簡易課税で継続される。</p>
<p>国税庁の <a href=https://www.nta.go.jp/taxes/shiraberu/zeimokubetsu/shohi/keigenzeiritsu/invoice_shinei.htm>申請手続</a> をみながら￼e-Tax (WEB 版) で申請した。</p>
<p>個人で副業を受けることを想定すると、個人でも適格請求書発行事業者に登録した方がよいのだけど、私の場合、自分の会社なので法人で仕事を受けるのと個人で仕事を受けることの違いって何だろう？とわからなくなった。法人税と個人の所得税の税率の違いの話しは一旦置いておいて、最も大きな違いは会社で仕事を受けても(直近の)給与は増えないのでその報酬を自由には使えない。個人で仕事を受けたらその報酬を自由に使えるぐらいかな？もうちょっとその違いを調べ直してから考えよう。先の youtube 動画の中で税理士さんが「免税事業者という制度をやめたらいいのに。。。」と言ってたけど、個人はどうしよう？と悩んでしまう本質は免税事業者という概念があるからというのは正しいと思う。</p>
<h2 id=terminal-のカスタマイズ>Terminal のカスタマイズ</h2>
<p>hugo の Shortcodes で <code>class</code> で任意の CSS クラスを指定できる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>{{&lt; <span style=color:#f92672>youtube</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;E0lOsLfj1T0&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;video-container&#34;</span> &gt;}}
</code></pre></div><p><code>static/style.css</code> をカスタムの CSS として読み込んでくれる。youtube のビデオサイズをよしなに調整するために次のスタイルを定義した。なかなか難しい。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css>.<span style=color:#a6e22e>video-container</span> <span style=color:#f92672>iframe</span> {
    <span style=color:#66d9ef>border</span>:<span style=color:#ae81ff>0</span>;
    <span style=color:#66d9ef>max-width</span>: <span style=color:#ae81ff>600</span><span style=color:#66d9ef>px</span>;
    <span style=color:#66d9ef>max-height</span>: <span style=color:#ae81ff>338</span><span style=color:#66d9ef>px</span>;
    <span style=color:#66d9ef>width</span>: <span style=color:#ae81ff>100</span><span style=color:#66d9ef>%</span>;
    <span style=color:#66d9ef>height</span>: <span style=color:#ae81ff>50</span><span style=color:#66d9ef>vh</span>;
}
</code></pre></div><h2 id=joel-on-software>Joel on Software</h2>
<p>読み終えた。ソフトウェアの本で test of time (時の試練？) に耐えるのは相当に難しい。本書だとマネジメントや教育、ビジネスや経営に関する内容はいまでも有効でおもしろかった。また後日ブログに書評を書く。いまとなっては手放しでお勧めできる本ではないため、どういう切り口で書くかが難しい。自分にとって学びとして身につけたいと思った本はなるべく書評を書いて自分の言葉で説明できるようになっていきたい。</p>
<h2 id=カジュアル面談>カジュアル面談</h2>
<p>プロジェクトマネージャーを募集している会社の CTO と面談。先方の時間が15分しかないという話しだったので事前に質問は連絡しつつ、バックエンドは Go 言語を使っているという話しだったので私が過去に書いたブログ記事やちょっと前に作った <a href=https://github.com/kazamori/go-sql-executor>go-sql-executor</a> を連絡して、技術選考の参考にしてほしいと伝えた。募集要項からスクラムを採用するように読めたのでその背景を聞いたところ、外部の技術顧問が推奨しただけでとくにこだわりはないという。いまもメンバーは8人いて1週間のスプリントでスクラムっぽい運用はしているとのこと。私の言う、課題管理とイテレーション開発の概要を軽く説明しつつ、それを実践するためにプロジェクトマネージャーをやりたくて、その実践の場を探しているといった話しをした。外部の技術顧問が欠席したせいか、Go 言語の開発に関する質問はとくになかった。メンバーはすべて業務委託という話しなので寄せ集めグループのドタバタプロジェクトなんだろうなという印象を受けた。心理的安全性や一体化マネジメント法とか勉強したんで <em>グループ</em> じゃなくて <em>チーム</em> 開発できるマネジメントがやりたいなぁ。</p>
</div>
</div>
<div class=pagination>
<div class=pagination__buttons>
<span class="button previous">
<a href=/diary/dates/2021/10/page/3/>
<span class=button__icon>←</span>
<span class=button__text>最近の日記</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class="copyright copyright--user">
<span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span>
</div>
</div>
</footer>
<script src=/diary/assets/main.js></script>
<script src=/diary/assets/prism.js></script>
</div>
</body>
</html>