<!doctype html><html lang=en>
<head>
<title>2021/12 :: forest nook</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=keywords content>
<meta name=robots content="noodp">
<link rel=canonical href=/diary/dates/2021/12/>
<link rel=stylesheet href=/diary/assets/style.css>
<link rel=stylesheet href=/diary/assets/green.css>
<link rel=stylesheet href=/diary/style.css>
<link rel=apple-touch-icon href=/diary/img/apple-touch-icon-192x192.png>
<link rel="shortcut icon" href=/diary/favicon.ico>
<meta name=twitter:card content="summary">
<meta name=twitter:site content="t2y">
<meta name=twitter:creator content>
<meta property="og:locale" content="en">
<meta property="og:type" content="website">
<meta property="og:title" content="2021/12">
<meta property="og:description" content>
<meta property="og:url" content="/diary/dates/2021/12/">
<meta property="og:site_name" content="forest nook">
<meta property="og:image" content="/diary/favicon.ico">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<link href=/diary/dates/2021/12/index.xml rel=alternate type=application/rss+xml title="forest nook">
</head>
<body class=green>
<div class="container full headings--one-size">
<header class=header>
<div class=header__inner>
<div class=header__logo>
<a href=/diary>
<div class=logo>
forest nook
</div>
</a>
</div>
<div class=menu-trigger>menu</div>
</div>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/diary/about>自己紹介</a></li>
<li><a href=/diary/dates>月別一覧</a></li>
<li><a href=/diary/tags>タグ一覧</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/diary/about>自己紹介</a></li>
<li><a href=/diary/dates>月別一覧</a></li>
<li><a href=/diary/tags>タグ一覧</a></li>
</ul>
</nav>
</header>
<div class=content>
<div class=posts>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1217/>知識創造と実践知の考察</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-17
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。ここ最近は晩ご飯作って食べてアイスクリーム食べてドラクエタクトやって寝るみたいな業後の過ごし方が多い。</p>
<h2 id=朝活-アジャイル開発とスクラム-第2版>朝活: アジャイル開発とスクラム 第2版</h2>
<p><a href=https://t.co/0erAzQpDzk>金朝ツメトギ 2021-12-17 AM 6 金曜朝6時開催のもくもく会</a> で第11章スクラムと知識創造と第12章スクラムと実践知リーダーを読んだ。</p>
<p>第11章では知識想像モデルとして SECI モデルが紹介されている。ふと読んでいて、私が課題管理システムでやっていたのはこの「表出化」の活動で、多くのスクラムをやっているチームは「共同化」を主にやっているように思えた。ソフトウェア開発方法論の歴史的に、チケット駆動開発 → イテレーション開発 → アジャイル開発/スクラムの時系列に発展してきた経緯から、私のようなチケット駆動開発をがっつりやってきた開発者が言う対話が重要だと言うことと、最初からスクラム開発で「共同化」しかやらず「表出化」していない開発者が言う対話が重要だと言うことは、背景事情からして根本的に指している内容が違うのではないか？という仮説を思いついた。対話が重要だと言う開発者がドキュメントや文章を書くことをなおざりにするのを見かけて違和感を感じていた。チケット駆動開発をがっつりやってきた開発者は文章を書いた上でそれだけでは解決できなかった問題を解決するために対話が必要だと言っているわけであり、文章すら書けない開発者は対話だけで開発を進められるわけではないと考えると、これまでスクラム開発に抱いていた私の違和感の正体に近づいたように思えた。</p>
<figure><img src=/diary/img/2021/1217_seci-model.png>
</figure>
<p>第12章では実践知という概念とそのリーダーシップが紹介されている。以前 <a href=https://b.kobe-u.ac.jp/books/b007/>実践知 — エキスパートの知性</a> という本を読んで、メタ認知も含めた認知心理学の知見を踏まえた知識創造や実践知を獲得するに至る背景や教育と課題管理との間にある関係性を考えていたことがあった。スクラムにおいても実践知という概念を扱っているのを読んで、ここにはなにかしらの関係性を見出したり体系化を行う余地があるように考えている。やや哲学的な話題も出てくるので人によって賛否がわかれるかもしれないが、私は自分の考えている中長期的な思考や教育への考え方の価値観が合致していて、これが日本的な経営スタイルの鍵だという意見には一定の同意ができる。自分自身も中長期的な展望を大事にしながら課題解決していきたいという想いもあるからだ。</p>
<h2 id=ワーケーション準備>ワーケーション準備</h2>
<p><a href=/diary/posts/2021/1212/#ワーケーション予約>ワーケーション準備</a> の残タスクを少しずつやっていく。宿泊先の <a href=https://kinosaki-kinoie.com/>きのいえ</a> に電話してチェックイン前に駐車場にレンタカーをとめさせてもらえないかを問い合わせた。当日に宿泊客がいれば13時以降、いなければそれよりも早めにとめてもよいとのこと。スタッフがいれば声をかけていなくても勝手にとめてよいと教えてもらった。先方からも <a href=https://www.hyogo-tourism.jp/furusato-ouen/>ふるさと応援！ひょうごを旅しようキャンペーン</a> が本来は12月末で終了だったのが2月28日まで延長されたため、宿泊者が兵庫県在住であればその手続きをしたいとのこと。一旦、オンラインで決済済みの予約をキャンセルして、現地決済で兵庫県の割り引きの手続きをしてくれるという。メンバーは4人中3人が兵庫県在住なので4,000円/人の割り引きで合計12,000円の割り引きになった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1216/>traceparent の生成</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-16
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/dapr/>dapr</a>&nbsp;
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<div class=post-content>
<p>1時半に寝て7時半に起きた。ちょっと疲れてて寝坊した。</p>
<h2 id=w3c-trace-context-の-traceparent-ヘッダーの生成>W3C Trace Context の traceparent ヘッダーの生成</h2>
<p>前にお仕事で <a href=/diary/posts/2021/1209/#dapr-の分散トレーシングと-w3c-trace-context>dapr の分散トレーシングを検証している</a> ことについて書いた。</p>
<p>dapr の分散トレーシングは <a href=https://www.w3.org/TR/trace-context/>W3C Trace Context</a> に準拠していて、dapr 経由のリクエストは自動的にこの情報が付与されるが、そうじゃないリクエストもトレーシングできるようにするためには http ヘッダーの <code>traceparent</code> をセットしないといけない。試しにサーバー側に <code>traceparent</code> を生成するのはどうやるのかを調べてみた。<a href=https://github.com/w3c/trace-context/blob/main/implementations.md>Implementations of Trace Context</a> にある java ライブラリを調べていて、Jaeger クライアントは OpenTelemetry に移行したと書いてあって、OpenTracing と OpenCensus は OpenTelemetry に統合されたと書いてあって、どうやら OpenTelemetry を使うのがよさそうだとわかった。</p>
<p>やりたいことは <code>traceparent</code> を生成したいだけだが、OpenTelemetry の <a href=https://opentelemetry.io/docs/instrumentation/java/manual_instrumentation/>Manual Instrumentation</a> を読んでも直接的なやり方は書いてなくて、<a href=https://github.com/open-telemetry/opentelemetry-java>open-telemetry/opentelemetry-java</a> のテストコードなどもみながら実装した。細かいところの仕様をまだ理解できていないけど、ひとまずこれで生成できたので検証はできると思う。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>W3cContextUtil</span> <span style=color:#f92672>{</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String TRACE_PARENT_VERSION <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;00&#34;</span><span style=color:#f92672>;</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> OpenTelemetrySdk openTelemetry <span style=color:#f92672>=</span> OpenTelemetrySdk<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>()</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>setTracerProvider</span><span style=color:#f92672>(</span>SdkTracerProvider<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>build</span><span style=color:#f92672>())</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>setPropagators</span><span style=color:#f92672>(</span>ContextPropagators<span style=color:#f92672>.</span><span style=color:#a6e22e>create</span><span style=color:#f92672>(</span>W3CTraceContextPropagator<span style=color:#f92672>.</span><span style=color:#a6e22e>getInstance</span><span style=color:#f92672>()))</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>buildAndRegisterGlobal</span><span style=color:#f92672>();</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> Tracer tracer <span style=color:#f92672>=</span> openTelemetry<span style=color:#f92672>.</span><span style=color:#a6e22e>getTracer</span><span style=color:#f92672>(</span>
            <span style=color:#e6db74>&#34;my-tracer&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;1.0.0&#34;</span><span style=color:#f92672>);</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>generateTraceParent</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        Span span <span style=color:#f92672>=</span> tracer<span style=color:#f92672>.</span><span style=color:#a6e22e>spanBuilder</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;parent&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>startSpan</span><span style=color:#f92672>();</span>
        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
            SpanContext sc <span style=color:#f92672>=</span> span<span style=color:#f92672>.</span><span style=color:#a6e22e>getSpanContext</span><span style=color:#f92672>();</span>
            <span style=color:#66d9ef>return</span> String<span style=color:#f92672>.</span><span style=color:#a6e22e>format</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;%s-%s-%s-%s&#34;</span><span style=color:#f92672>,</span>
                    TRACE_PARENT_VERSION<span style=color:#f92672>,</span>
                    sc<span style=color:#f92672>.</span><span style=color:#a6e22e>getTraceId</span><span style=color:#f92672>(),</span>
                    sc<span style=color:#f92672>.</span><span style=color:#a6e22e>getSpanId</span><span style=color:#f92672>(),</span>
                    sc<span style=color:#f92672>.</span><span style=color:#a6e22e>getTraceFlags</span><span style=color:#f92672>().</span><span style=color:#a6e22e>asHex</span><span style=color:#f92672>());</span>
        <span style=color:#f92672>}</span> <span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
            span<span style=color:#f92672>.</span><span style=color:#a6e22e>end</span><span style=color:#f92672>();</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><h2 id=大阪python-もくもく会>大阪Python もくもく会</h2>
<p><a href=https://osakapython.connpass.com/event/233460/>大阪Python もくもく会 #66</a> にオンライン参加した。コロナ禍前に大阪へ通勤していた頃はオフライン勉強会に何回か参加したことがある。主催者のやぎさんは一度 bizpy に参加してくれたこともある。11月からオフライン勉強会を再開したとのこと。久しぶりに参加してやぎさんと話していたら <a href=https://neos.com/>neosvr</a> にも関心をもっているとのこと。私も少し前に oculus quest 2 を購入して触ってみた程度なのでメタバース関連で一緒に勉強会をしてもよいかもしれない。もくもく会では「アジャイル開発とスクラム 第2版」を読んでいて昨日の日記の記事がまさにその成果物。せっかくなので成果発表でこの本の紹介などをした。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1215/>データと業務の変遷</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-15
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/data/>data</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝てこわい夢をみて1時半に起きて、そのまま寝たのか寝てないのかよくわからない仮眠状態で5時半に起きた。</p>
<h2 id=朝活-アジャイル開発とスクラム-第2版>朝活: アジャイル開発とスクラム 第2版</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/233922/>【三宮.dev オンライン】リモート朝活もくもく会</a> で第10章 竹内・野中のスクラム論文再考を読んだ。1986年に竹内氏と野中氏によって書かれた <a href=https://hbr.org/1986/01/the-new-new-product-development-game>The New New Product Development Game</a> から得た概念や理論的背景をスクラム創設者のジェフ・サザーランド氏がソフトウェア開発の方法論として体系化したものがスクラムになる。そのため、原点はこの論文にある。第10章ではオリジナルに書かれている内容とスクラム開発を比較している。オリジナルの論文にある TypeC (キヤノンやホンダの新製品開発) のようなチームの特徴として次の6つをあげている。</p>
<ol>
<li>
<p>不安定な状態を保つ</p>
<p>最初に綿密な計画や指示があるわけではない、チームは自由な裁量と同時に困難なゴールを目指す</p>
</li>
<li>
<p>プロジェクトチームは自ら組織化する</p>
<p>チームは不安定な状態から自己組織化し、対話の中で自律状態を作り出す</p>
</li>
<li>
<p>開発フェーズを重複させる</p>
<p>開発フェーズを重複させることで、メンバーは専門分野を超えてプロジェクト全体で責任をもつようになる</p>
</li>
<li>
<p>「マルチ学習」</p>
<p>メンバーはグループ全体として学習し、専門を超えて学習する</p>
</li>
<li>
<p>柔らかなマネジメント</p>
<p>無管理でも強い管理でもない自主性を尊重した柔らかなマネジメントが重要である</p>
</li>
<li>
<p>学びを組織で共有する</p>
<p>過去の成功を組織に伝える、もしくは意識的に捨て去る</p>
</li>
</ol>
<p>オリジナルの論文の解説を読んでいると、古きよき日本の家族ぐるみの職場やチームの働き方のように思えてくる。時代が違うのでいまからこういった働き方に戻るのは現実的ではないだろうが、その中で重要だった概念や要素を、いまソフトウェア開発方法論としてのスクラムで実践できるのはいろいろと私の中でも思うことがある。私の考える課題管理の方法論にも竹内・野中氏のオリジナルの論文の概念は影響を受けるように思えた。章末にコラムとしてジェフ・サザーランド氏のインタビュー記事もあった。マイクロファイナンスのプロジェクトを通して、小さなグループに小さくお金を貸し出すことが、貧困から抜けすための小さなきっかけ (ブートストラップ) になるという体験からスクラム開発の動機づけになったという話しは哲学として印象に残った。なにかを成すには哲学が大事だと思う。</p>
<h2 id=データがあると同期したくなる>データがあると同期したくなる</h2>
<p>お仕事でスクラムのふりかえりをやっていて <a href=https://miro.com/>miro</a> と <a href=https://backlog.com/ja/>backlog</a> のデータ同期という話題が出た。業務チームはブレインストーミングで要件を洗い出したりする作業のときに miro を使っていて、miro ベースでメモを記述した後でバックログアイテムとして backlog に登録する。このとき backlog に登録した後で miro を捨てるならいいが、残したまま次の展望や要件の洗い出しにも再利用したりしていると、miro と backlog のバックログアイテムの内容が乖離したり不整合が発生したりする。チームとしてはバックログアイテムに書いてある内容が正という運用をしているため、miro のみに最新の情報がある状態が続くと課題になる。私の知る限り、miro と課題管理システムのデータ連携のツールはないと思う。</p>
<p>私からみたら最初からすべてバックログアイテムに文章で書けばいいやんで話が終わってしまうが、人によって使い慣れたツールは異なるため、そんな単純な話しでもない。一方で昔は miro や backlog がなかった時代もあって、そのときは物理的な付箋紙をホワイトボードに張りながら作業をしていたから、本来は同期したいという概念もなかったはずという意見も出た。たしかにツールがデジタルになって電子データとなった瞬間からデータの再利用を考えるようになるんだなと私も思えた。あと付箋紙をホワイトボードに貼り付けていた時代は何週間もその状態のまま放置するといったこともなかったのではないか？という気もした。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1214/>github actions のワークフローカスタマイズ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-14
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/github/>github</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時半に起きた。</p>
<h2 id=github-actions-の並行ビルド>github actions の並行ビルド</h2>
<p>1-2日でできると思ったら想定したよりややこしくて3日かかった。既存処理でかかっている時間を40-50%ほど短縮できた。1つの job で複数モジュールのビルドや docker イメージの生成、aws ecr への登録、eks の pod 更新などをしている処理を複数の job に分割する。job を分割すると、ビルド成果物を共有できなかったり、env のスコープも変わってくる。独立した job 環境で効率よく処理できるよう、ビルドキャッシュを導入したり、カスタムの composite アクションで処理を共通化したりと、あれやこれやを変更する量が増えていった。変更すること自体は問題ないけど、動作検証は github actions 上で動かさないと分からないところがあって、その検証に時間がかかる。複雑なワークフローを実装していると、github actions のかゆいところに手が届かないのにも気付けた。まだまだ circleci は企業向けに使われるのかもしれないなと思えた。</p>
<ul>
<li><a href=https://github.com/actions/cache/issues/2>ビルドキャッシュを削除できない</a></li>
<li><a href=https://github.com/actions/runner/issues/480>workflow レベルの env は参照できないフィールドがあったり</a> job の steps で動的に更新できない</li>
<li>workflow の再実行で途中の job から再実行できない</li>
<li><a href=https://tech.guitarrapc.com/entry/2021/08/01/194007#2-runif-%E3%81%AF%E4%BD%BF%E3%81%88%E3%81%AA%E3%81%84-%E5%88%B6%E7%B4%84>カスタム action で run.if は使えない</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1213/>log4j2 セキュリティ対応</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-13
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/security/>security</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/stone/>stone</a>&nbsp;
</span>
<img src=/diary/img/2021/1213-turquoise.jpg class=post-cover alt="log4j2 セキュリティ対応">
<div class=post-content>
<p>23時に寝て5時に起きたが、だらだらしているうちに2度寝して6時半に起きた。</p>
<h2 id=log4j2-セキュリティ対応>log4j2 セキュリティ対応</h2>
<p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228">CVE-2021-44228</a> が金曜日のお昼から私のタイムラインを賑わしている。私がお手伝いしているお仕事はイントラのシステムなのでやや余裕をもって情報を眺めていた。<a href=https://github.com/apache/logging-log4j2/pull/608#issuecomment-990494126>issue のコメント</a> をみても log4j 1.x にも影響があると書かれて、その後に実際には影響ないと書かれて、さらにその後に条件付きだけど影響はあると二転三転してた。自分で実際に試してなくて世の中の開発者の情報をみているだけ。そのため、公式の情報を信頼するといったポジションでしかない。関係者の方々には敬意を払いたい。私は spring の公式ブログで公開されている <a href=https://spring.io/blog/2021/12/10/log4j2-vulnerability-and-spring-boot>Log4J2 Vulnerability and Spring Boot</a> を読みながら対応した。</p>
<h2 id=ターコイズ>ターコイズ</h2>
<p>ふとしたきっかけで <a href=https://www.fu-stone.com/blog/turquoise/>ターコイズ</a> の記事を読んだ。12月の誕生石らしく、それでいまの時期に紹介されることも多いのだと推測する。別の記事でターコイズは喉によいと書かれていて、以前 <a href=/diary/posts/2021/1114/#傾斜枕>喉に違和感がある</a> ことを書いた。日常生活に困るほどではないけど、もうこの歳だから体調が良くなることはなく悪くなる一方だろうという見通しも含めて験担ぎのような感覚で喉というキーワードでつながったから購入してみた。</p>
<p>近所の原石屋さんに行って尋ねてみたら1-2cmぐらいのサイズ1個240円ほどで売っていたので3個買って、近所のダイソーで入れものを買って、それっぽくオフィスに置いておくことにした。うちのコーポレートカラーはグリーンとブルーなんだけど、ターコイズも <a href=https://www.colordic.org/colorscheme/4115>ターコイズグリーン</a> と <a href=https://www.colordic.org/colorscheme/4129>ターコイズブルー</a> の2種類の色がある。創業も12月なので誕生石としても合致する。共通点があって相性がよさそうなのでうちのコーポレートストーン (そんな言葉ない) はターコイズでいいや。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1212/>ワーケーション準備</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-12
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
#<a href=/diary/tags/drink/>drink</a>&nbsp;
</span>
<div class=post-content>
<p>2時半に寝て7時に起きた。なんか眠れなくてだらだらしてた。</p>
<h2 id=ワーケーション予約>ワーケーション予約</h2>
<p>参加予定者に最終確認をとって3人参加してくれることになった。感謝。私を含めて4人で行ってくる。レンタカーと <a href=https://kinosaki-kinoie.com/>きのいえ</a> の予約を確定させた。1月28-30日で <a href=https://kinosaki-spa.gr.jp/>城崎温泉</a> でワーケーションしてくる。宿泊は金曜日の夜しか予約があいてなくて4月まで土曜日の夜はすでに予約が埋まっていた。もし金土と連泊で予約するときは3ヶ月以上前に予約をとらないといけないということがわかった。宿泊人数によって料金が変わってくるため、多少の人数変更に対応できる条件で予約できるのが望ましい。今回泊まることでオーナーの人とやり取りできればそういったことも聞いてみようと思う。その後、旅のしおりを作り始めた。まだ1ヶ月あるので調べながらゆっくり準備を進めていく。移動や作業のための時間、食事、親睦会などタイムラインを作りながらやり方を検討していく。</p>
<h2 id=ショコラシュバルツ>ショコラ・シュバルツ</h2>
<p><a href="https://www.satofull.jp/products/detail.php?product_id=1256650">山梨県北杜市のふるさと納税</a> の返礼品として <a href="https://www.yatsugatake-beer.com/?mode=grp&gid=1059669">ショコラ・シュバルツ（Chocolat Schwartz）</a> が届いた。試しに1本飲んでみた。香りがよくて黒ビールなんだけど、普通の黒ビールとは異なる風味でそれがショコラなのかどうか、私にはよくわかってないけど、あまり味わったことのない黒ビールという点からはおいしかった。毎日飲むようなビールではないと思うが、イベントや記念日など普通のビールとは異なるビールを試したいときには向きそう。お土産などにもよさそう。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1211/>ワーケーションのシミュレーション</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-11
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て7時に起きた。久しぶりに遅くまで飲んでたのでやや気分が悪い。全体としてあまり大したことしてなかったんだけど、日記のふりかえりしたり、スクラム談義したり、log4j の脆弱性のその後の状況を静観したりしてた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今週もお仕事に注力してたらストレッチは2日/週とあまりできなかった。夜も外に出掛けるのが億劫になったり、勉強会に参加してたりしてウォーキングもやってない。今日の開脚幅は開始前167cmで、ストレッチ後169.5cmだった。さぼってたわりにはまぁまぁだった。特別なことはなにもしてなかったけど、右太もも後ろの筋がやや張っていて右足はあまりよくない。一方で右股関節の不可動領域がよくなっていることが自分でストレッチしててもわかるようになってきて半年以上やってきた甲斐があったと言える。</p>
<h2 id=ワーケーション計画>ワーケーション計画</h2>
<p>参加者の目処がついてきたので城崎温泉に出掛けるワーケーションの計画をシミュレーションしていた。たとえば電車とレンタカーでどのぐらい料金の差になるかというと、三ノ宮発でレンタカーを借りて移動 (2泊3日) するときの料金 (高速道路/ガソリン代含む) は 35,648 円、電車は往復11,000円/人になる。3人いればレンタカーと同じぐらいの料金で、4人いればレンタカーで移動した方が安くなる。3人だったとしても移動の勝手の良さを考慮するとレンタカーの方がよさそうに思えた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1210/>ワーケーションの思いつき</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-10
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。</p>
<h2 id=朝活-アジャイル開発とスクラム-第2版>朝活: アジャイル開発とスクラム 第2版</h2>
<p><a href="https://www.youtube.com/watch?v=MbpX1LF1fto">金朝ツメトギ 2021-12-10 AM 6 金曜朝6時開催のもくもく会</a> に参加した。今回はてらださんも来られていた。第9章を読んだ。KDDI さんの事例紹介で2013年から取り組みしているらしい。<a href=/diary/posts/2021/1029/#フラクタルスプリント>フラクタルスプリント</a> を実際の業務で実践している稀な事例としておもしろかった。1週間のスプリントの中に1日のスプリントが4回あるといったフラクタル構造のスプリント。また金曜日は「仕事をしない日」としてレトロスペクティブと OST (オープンスペーステクノロジー、自由な発表と議論の時間) に割当てている。20%ルールに近いものと言えるかもしれないが、自己研鑽のための時間をスプリントの中に組み込むという、組織の理解があってこそできる取り組みを実践していてすごいなと感心した。</p>
<figure><img src=/diary/img/2021/1210-weekly-sprint.png>
</figure>
<h2 id=隔週の雑談>隔週の雑談</h2>
<p>顧問のはらさんと隔週の打ち合わせ。スクラムの話題として <a href=https://chatwork.connpass.com/event/231183/>だいくしーのスクラム Bar #1</a> や <a href=https://smn.connpass.com/event/226002/>Scrum Masters Night! Online 〜第10夜〜</a> に参加してやり取りした内容や考察したことなどをいろいろ話してた。そのうちの話題の1つに、スクラムマスターの役割とは何だろうかがある。スクラムマスターはプロダクトをよくすることに責任をもち、メンバーが働きやすいように支えるような役割である。ここまでは共通認識として、その範囲がどこまでかは人によって意見が異なるように思えた。あくまでプロダクトやチームの範囲内で行動するスクラムマスターと、スクラムを組織全体に広めたり、人事・評価制度や経営にも参加していくスクラムマスターがある。スクラムマスターは社外の人間でもできるという考え方があるが、必然的に後者の役割も担うなら社内の人間に限定される。後者の役割は越権行為ではないか、いやいや、チームのために働いたメンバーの評価が下がってしまえば現場でよりよいプロダクト開発はできないから大事ではないかという意見も出た。便宜上、前者を (普通の) スクラムマスター、後者を「意識の高い」スクラムマスターと呼ぶ。私の考えでは、意識の高いスクラムマスターの言わんとしていることはわかるが、それをやりたいなら部長や役員などになってから職責とともに改善すべきであり、スクラムマスターという組織におけるラインではない人が経営に口出ししたりすることによる、組織の歪みはまた別の問題を引き起こすのではないかとも思えた。私も経営をやっていて経営側の視点でみるとやはりおかしい。</p>
<p>その後にワーケーションについて相談した。城崎温泉にある <a href=https://kinosaki-kinoie.com/>きのいえ</a> でワーケーションをやってみようかと考えている。参加のお誘いややり方についていくつか相談しながら前向きに検討しようということになった。</p>
<h2 id=忘年会>忘年会</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/231602/>【初参加大歓迎】三宮.dev＆bizpy 合同忘年会</a> に参加してきた。忘年会の前に運営に入ってもらった、わたなべさんと軽く bizpy の運営について話してきた。1月はわたなべさんに機械学習の勉強会をやってもらう。私は昨年も三宮.devの忘年会に出てた。昨年は3人だったのが今年は4人になった。名物の大きなポークカツレツ。4人とも勉強会の常連みたいな人たちなのでお酒を飲みながらわいわいやって、コロナ禍になる前のコミュニティの勉強会の飲み会を思い出したりしてた。ワーケーションの話をしたら2人は興味を示してくれて、メンバーが4人集まったので開発合宿の企画をしてみることに決めた。</p>
<figure><img src=/diary/img/2021/1210-katsu.jpg>
</figure>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1209/>2年目の創立記念日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-09
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/dapr/>dapr</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
</span>
<div class=post-content>
<p>0時半に寝て6時半に起きた。久しぶりに22時までお仕事やって区切りもよかったからそれからお惣菜を買って23時頃から晩ご飯を食べてた。生活が乱れるなぁ。</p>
<h2 id=dapr-の分散トレーシングと-w3c-trace-context>dapr の分散トレーシングと W3C trace context</h2>
<p>お仕事で dapr の分散トレーシングを検証してた。知らない人は <a href=https://cero-t.hatenadiary.jp/entry/2021/12/08/071742>Dapr Advent Calendar 8日目 - DaprとZipkinで分散トレーシング</a> のチュートリアルをお勧めする。dapr は <a href=https://www.w3.org/TR/trace-context/>W3C Trace Context</a> を使って分散トレーシングを扱う。rest api では、具体的には <code>traceparent</code> と <code>tracestore</code> という http ヘッダーにトレース用途の情報を付けて転送する。すごいところは pubsub のメッセージングを経由してもそれらの情報を転送できる。pubsub 間でこれらの情報は <a href=https://github.com/cloudevents/spec>CloudEvents</a> という標準化されたデータのフォーマットでやり取りされる。実際には CloudEvents の中に <code>traceparent</code> と <code>tracestore</code> の値を含めて通信するけれど、外部からみたら http ヘッダーを転送できているようにみえる。しかし、http ヘッダーの任意の値を転送したい場合、それができない。<code>tracestore</code> はトレースのためのベンダー独自情報を付与できるとあったので、ここに任意の値をセットして送ってみたけど、http ヘッダーの付け替えは行われなかった。あとで dapr のソースを読んだら publish するときはそのまま送っているけど、subscribe するときに <code>tracestore</code> の仕様を満たしているか検証しながらパースしていて、任意の値を送っても仕様に沿っていなければ捨てられてしまうことがわかった。dapr の issue でも要望として登録されてた。誰もやってないならコントリビュートするチャンスかもしれない。</p>
<ul>
<li><a href=https://github.com/dapr/dapr/issues/3642>Propagate arbitrary/configurable http headers from publisher to subscribers #3642</a></li>
</ul>
<h2 id=創立記念日>創立記念日</h2>
<p>今日が会社の創立記念日。無事に2周年を迎えた。創立記念日をお休みにするしないを考えたのだけど、いま休日も普通に働いている状況で、且つ役員は勤怠管理をする必要はないので平日になんの意味もなく休むメリットが何もないということに行き着いた。創立記念日だから休むのではなく、いつでも必要なときに休めばいい。もっと言うと、休む理由がなければ働くという逆転現象が生じていて、休む理由は私用か疲労ぐらいしかなくて、基本的に疲れてない限りはずっと働くみたいな理屈になってしまっている。社員が増えて会社に余裕が出てから創立記念日は休みみたいな制度を作ればいい。それまではたぶん来年もそれ以降も普通に働いていると思う。</p>
<p>1年目は訳分からず働いていたから経営的なことは全くわからなかったけど、2年目は経営上の諸問題が出てきて、経営的な意思決定や考察も増えてきて、行政手続きも熟れて、会社の実績も増えていっていて、会社を育てるという意識もかなり出てきた。率直に言えば、いまの経営状態は可もなく不可もなくといったものなので何もアピールすることはない。しかし、経営したことない人間が経営というキャリアを積み重ねていることには大きな意義があって、自身のキャリアアップには確かな手応えも感じつつある。これからもがんばっていこう。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1208/>整理・整頓・清掃・清潔・躾</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-08
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時に起きた。今日はがんばって起きた！久しぶりに7時半から始業してた。</p>
<h2 id=トヨタの5s>トヨタの5S</h2>
<p>スクラムイベントのふりかえりをしていて <a href=https://circu.co.jp/pro-sharing/mag/article/2964/>トヨタの5S</a> の話題が出た。聞いたことがあるようないような、スクラムを勉強しているいま見返すとじわじわ聞いてくる。玄人ぶって「そうそう、こういうのが大事なんだよ」とか言いたくなりそうな雰囲気がある。普通にやっていたら当たり前のことなのに、忙しかったり複雑な問題に対応してたりすると、普通の状態を維持できなくなって混沌がもたらされる気がする。そういう状況のときに初心に戻るにはこういった原則や標榜を使って啓蒙することに意義があるんだと、いまは思うようになってきた。これ自体をよいとかわるいとか言うのは適切ではなくて、うまくいっていない状態からより戻すときに活用するといった考え方の方が正しいのかもしれない。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1207/>クロスデフォルト</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-07
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/economy/>economy</a>&nbsp;
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/logging/>logging</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時半に起きた。5時台には起きているんだけど、起き上がるところまではなかなかいけない。</p>
<h2 id=恒大集団のデフォルト>恒大集団のデフォルト</h2>
<p>11月から利払の期日の日はチェックしていて、支払うときは2-3日前には支払いを完了したというニュースが出ていたように思う。今日の支払いは前日に支払いしたというニュースが出ないからダメなんだろうなと様子をみていた。</p>
<ul>
<li><a href=https://jp.reuters.com/article/evergrande-idJPKBN2IM0F0>中国恒大、猶予期間終了までにオフショア債利払いできず＝関係筋</a></li>
</ul>
<p>1つの債務がデフォルトした場合、残りの債務も一括返済しないといけないことを <a href=https://www.ifinance.ne.jp/glossary/loan/loa259.html>クロスデフォルト</a> と呼ぶらしい。契約書にクロスデフォルト条項として書いてあるらしい。記事によると、クロスデフォルトによって約190億ドル (約2.1兆円) のオフショア債の返済を一括でしないといけないらしい。リーマンショックのようなことは起きないという見通しだけど、うちみたいな零細企業は世の中の影響を諸に受けるのでお仕事に影響がでなければいいなぁといったところ。</p>
<h2 id=アプリケーションログの調査>アプリケーションログの調査</h2>
<p>昨日の続き。ecs-logging-java で JSON Lines でログを制御するところで spring-boot の設定で tomcat のアクセスログの設定ができる。tomcat のアクセスログを log4j のレイアウトの仕組みを使って ecs-logging-java が提供する EcsLayout に変更できないかを3時間ほど調査して、どうもできないようだというのを教えてもらった。tomcat は apache のログを出力するという目的で実装されているから log4j の柔軟なログに対応していないという理屈。</p>
<p>じゃあ、どうやって apache のアクセスログを JSON Lines にするかというと、PatternLayout のパターンに json のフォーマットを直書きしてしまうというやり方がある。なんかプログラミングでスマートに解決したいところだけど、その仕組みがないなら仕方ないかって感じでこれでやろうと思う。</p>
<ul>
<li><a href=https://ogugu.hateblo.jp/entry/2018/08/03/153930>apacheのaccess_logをjson化しtd-agentで集約サーバへ収集する</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1206/>アプリケーションログの調査</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-06
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/logging/>logging</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て7時に起きた。</p>
<h2 id=アプリケーションログの調査>アプリケーションログの調査</h2>
<p>お仕事でログの整理をやろうとしていて、そのためのライブラリとして ecs-logging-java を調べてた。</p>
<ul>
<li><a href=https://www.elastic.co/guide/en/ecs-logging/java/current/setup.html>ECS Logging Java Reference 1.x » Get started</a></li>
<li><a href=https://speakerdeck.com/shibadog/ecs-logging-javatukatutemita>ecs-logging-javaつかってみた</a></li>
</ul>
<p>一番のモチベーションは <a href=https://jsonlines.org/>JSON Lines</a> でログを管理したいというところ。この手の実装や読み込んでログ分析したりとかはあちこちでやってきたので親近感はある。既存のログからの移行も含めていろいろ設計していかないといけない。私の感覚だとアプリケーションの開発初期にログの設計や出力周りを作り込むものだけど、そうじゃない文化の開発もあるんだなという印象。あとからログ設計するとか、移行や既存のコードに手を入れたり、開発初期に作り込むより手間暇かかる気がするんだけど、そんな時間もなく開発してたってことなのかなぁ。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1205/>頭文字Dを読了</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-05
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/commic/>commic</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/dapr/>dapr</a>&nbsp;
#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て7時に起きてだらだらやってて午前中は <a href=https://ja.wikipedia.org/wiki/%E9%A0%AD%E6%96%87%E5%AD%97D>頭文字D</a> のアニメをみてた。漫画 (アニメも？) はすでに完結しているのでいつか読もうと思いつつ最後まで読んでいない。ゴッドフットやゴッドアームが出てくるぐらいまでは読んだ気がする。その後どうなったのかを知らない。イニシャルDをみていると、ストーリーも絵も演出もまったく派手さはなくて普通なんだけど、なぜかおもしろくて続きをみてしまうという人間の娯楽の本質をついている気がしてくる。なんでなんだろうなぁ。</p>
<h2 id=頭文字d>頭文字D</h2>
<p>たまたま思い出したので夜に漫画喫茶行って頭文字Dを最後まで読んできた。全48巻で、31巻ぐらいから読み始めて3-4時間ぐらいで読み終えた。漫画なので仕方ないけど、対戦相手がどんどん強くなっていって勝ち方が玄人好みというのか、単純に抜いた・抜かれたの話しではなく、タイヤマネージメントがどうこうとか、恐怖に対する心理がどうこうとか、ドライバーと車のセッティングも含めた駆け引きが強くなっていって、どちらが速いかというよりは戦略通りの展開にもっていって最後はそれがうまくはまるみたいな、これまでもずっとそうだったんだけど、ここからはよりトップレベルのほんの僅かな差が勝敗を分けるといった描き方になっていったように思う。それはそれで現実に近い気はするけど、漫画的には派手な演出にならないので玄人好みなストーリーになっていった気がする。但し、そこまでやってきて最後の対戦相手だけは、個人的には納得感がなくて、ここまで緻密に作り上げてきた理論や個々のドライバーの修練の積み重ねが圧倒的天才の前にひれ伏すみたいな切り口が急展開していて、頭の切り替えができなかった感じがした。とはいえ、最後まで読み終えられてよかったし、作品としてはすごくおもしろかった。作者はモータースポーツが本当に好きなんだろうなというのが伝わってくる漫画だと思う。</p>
<h2 id=ふるさと納税>ふるさと納税</h2>
<p>あまり欲しいものもないし、ふるさと納税の行政手続きも一通り理解したから今年はやらなくてもいいかとも思っていた。しかし、<a href=https://www.satofull.jp/static/campaign/202112_pcp.php>paypayボーナスキャンペーン</a> をみてやってみるかという気になった。paypay はいろんなものと連携していて見かけるたびにすごいなと思う。お得だからと必要もないものを買うことはないけど、ふるさと納税はやらなかったとしても、どのみち納税は必要なものなので還元があるということは節税につながるのかな？理屈はよくわからないけど、言いたいことは paypay はすごいという話でした。</p>
<h2 id=dapr-の-api-トークンを使った認証>dapr の api トークンを使った認証</h2>
<p><a href=https://docs.dapr.io/operations/security/api-token/>Enable API token authentication in Dapr</a> を一通り読んだ。内容はとくに難しくなく、こんな風に dapr の manifest を書けば <a href=https://jwt.io/>JWT</a> トークンを設定できますということを書いてある。私はずっとサーバーサイドばっかりやってきたからフロントエンドで使われる技術や仕組みに弱い。JWT トークンもその1つで、自分でちゃんと実装したことがないからちゃんとよく分かってない。これが OAuth2 なら provider を実装したこともあるからその仕組みも意図も理解できる。一度どこかで自分で JWT も実装してみないといけないのだろうな。</p>
<p>少し前にお仕事で kubernetes の secret の移行作業をやった。既存の secret にキーバリューを追加するときは patch を使う。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl patch secret mydata -p<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{&#34;stringData&#34;:{&#34;mykey&#34;: &#34;myvalue&#34;}}&#39;</span>
</code></pre></div><p>secret の内容を確認するときも2つのやり方がある。キーだけを確認するならこれでよい。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl describe secrets mydata
</code></pre></div><p>キーに対応する値もデコードして確認するならこうする。但し、閲覧注意。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get secret mydata -o json | jq <span style=color:#e6db74>&#39;.data | map_values(@base64d)&#39;</span>
</code></pre></div>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1204/>github actions のビルドキャッシュ運用</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-04
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/github/>github</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て5時に起きてちょっと作業してまた寝て7時に起きた。お仕事も働き始めて1ヶ月が経過して、だいぶチームの雰囲気や業務に慣れてきたところ。稼働日の18日間で作成した pr が16件。入ったときに割当てられた3つの課題から10数件の issue を派生させてちょうどすべて fix した。来週から新しい課題に取り組む。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今週もお仕事に注力してたらストレッチは2日/週とあまりできなかった。ウォーキングもやってない。今日の開脚幅は開始前165cmで、ストレッチ後167cmだった。さぼってたせいか、数値が悪くなってしまった。右股関節の関節の可動域がよくないところは少しずつまがるようになってきてよくなってきている実感がある。一方で右太ももの後ろの筋が張りが大きいことに気付いた。トレーナーさんに聞くと、この筋は椅子に座っていると張りやすいという話しなので、最近はお仕事に注力して椅子に座っている時間が以前より伸びているせいだと思う。あと会議に出席している時間も増えているため、その時間は椅子に座っておかないといけないという制約も増えている。</p>
<h2 id=actionscache-の-exclude-設定>actions/cache の exclude 設定</h2>
<p>github actions でビルドキャッシュを扱う方法は <a href=https://docs.github.com/ja/actions/advanced-guides/caching-dependencies-to-speed-up-workflows>Caching dependencies to speed up workflows</a> に書いてあって、それは <a href=https://github.com/actions/cache>actions/cache</a> という github actions がキャッシュ機能を提供している。ここでドキュメントにはキャッシュの除外設定については何も書かれていないが、リポジトリに含まれる <code>examples.md</code> には次のような説明と設定例が出てくる。</p>
<blockquote>
<p>Depending on the environment, huge packages might be pre-installed in the global cache folder. With actions/cache@v2 you can now exclude unwanted packages with <a href=https://github.com/actions/toolkit/tree/main/packages/glob#exclude-patterns>exclude pattern</a></p>
<p><a href=https://github.com/actions/cache/blob/main/examples.md#c---nuget>https://github.com/actions/cache/blob/main/examples.md#c---nuget</a></p>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml>- <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/cache@v2</span>
  <span style=color:#f92672>with</span>:
    <span style=color:#f92672>path</span>: |<span style=color:#e6db74>
</span><span style=color:#e6db74>      ~/.nuget/packages
</span><span style=color:#e6db74>      !~/.nuget/packages/unwanted</span>      
    <span style=color:#f92672>key</span>: <span style=color:#ae81ff>${{ runner.os }}-nuget-${{ hashFiles(&#39;**/packages.lock.json&#39;) }}</span>
    <span style=color:#f92672>restore-keys</span>: |<span style=color:#e6db74>
</span><span style=color:#e6db74>      </span>      <span style=color:#ae81ff>${{ runner.os }}-nuget-</span>
</code></pre></div><p><code>!</code> を入れるだけかと思って検証してみたらどうも意図した振る舞いにならない。実はこの設定はバグっていて実際には動かない。なぜ動かないかを追いかけてないけど、issue にも登録されている。<code>path</code> の記述方法によって動いたり動かなかったりするというのが現状の振る舞いになるらしい。</p>
<ul>
<li><a href=https://github.com/actions/cache/issues/494>Excluded sub directory not working #494</a></li>
<li><a href=https://github.com/actions/toolkit/issues/713>Cache - excluding files or folders with ! not working #713</a></li>
</ul>
<p>ちなみに正しい動く設定は次になる。ワイルドカードを使わないといけないらしい。ドキュメントに除外設定について書いていないのはバグってて中途半端な振る舞いをしているからかもしれない。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml>- <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/cache@v2</span>
  <span style=color:#f92672>with</span>:
    <span style=color:#f92672>path</span>: |<span style=color:#e6db74>
</span><span style=color:#e6db74>      ~/.nuget/packages/*
</span><span style=color:#e6db74>      !~/.nuget/packages/unwanted</span>      
    <span style=color:#f92672>key</span>: <span style=color:#ae81ff>${{ runner.os }}-nuget-${{ hashFiles(&#39;**/packages.lock.json&#39;) }}</span>
    <span style=color:#f92672>restore-keys</span>: |<span style=color:#e6db74>
</span><span style=color:#e6db74>      </span>      <span style=color:#ae81ff>${{ runner.os }}-nuget-</span>
</code></pre></div><p>あとビルドキャッシュのキーにパッケージ管理のファイルのハッシュ値を取るようになっている。この背景も github actions がキャッシュをクリアする機能を提供していないからであろう。<a href=https://github.com/actions/cache/issues/2>Clear cache #2</a> でも議論されているが、キャッシュをクリアできないため、同じキーにパッケージが溜まり続けるような運用は開発者にとっても github 社にとってもリソースを浪費するので好ましくない。いまは7日以上アクセスされていないキャッシュを削除する運用になっているため、なるべくフレッシュなキャッシュが生成されるような運用となるよう、ハッシュ値を取得するようなキーの運用が行われているように推測される。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1203/>チームごっこ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-03
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。</p>
<h2 id=朝活-アジャイル開発とスクラム-第2版>朝活: アジャイル開発とスクラム 第2版</h2>
<p>第7章の残りと第8章を読んだ。事例紹介なので軽く読み流した感じ。インタビュー記事のタイトルが気になった。</p>
<blockquote>
<p>「合宿で、「仕事での同僚」から「チームの仲間」になれました</p>
</blockquote>
<p>このタイトルと内容に私は違和感があるので反論としてそれを書いていく。</p>
<p><a href=https://pub.jmam.co.jp/book/b517388.html>心理的安全性のつくりかた</a> に書いてあったが、MIT のオスターマン教授によると、チームという概念は比較的新しいものらしい。</p>
<blockquote>
<p>職場における、チームという概念は1980年以降、最も広まったイノベーションのひとつだ。</p>
</blockquote>
<p>「心理的安全性のつくりかた」ではチームとグループの違いは次になる。</p>
<ul>
<li>チームは共通の目標に向かってともに問題解決やアイディアを出す集団</li>
<li>グループはそうなっていない、ただの寄せ集めの集団</li>
</ul>
<p>共通の目標に対して互いに対話や協働することでチームになっていく。この考え方は私の経験則とも合致するし支持している。実際の業務や作業を通してチームは築かれていくと私は考える。しかし、コミュニケーションの活性化や親睦を深めればチームになると誤解している人もいるように思う。</p>
<p>件のインタビュー記事では、次の内容があった。</p>
<blockquote>
<p><strong>合宿の最大の成果は、何だったのでしょう？</strong></p>
<p>「仕事での同僚」から「チームの仲間」になれたことだと思います。昨今、ハラスメントやプライバシーの観点からなかなか個人の深い話ができないことが多いと思いますが、お互いを信頼した上で自分の生い立ちや経験から「私がなぜここにいるのか」を深掘りできたことが大きいと思います。</p>
<p>具体的には、誰とも話さず、自分を見つめる時間として三浦海岸の浜辺に全員を１時間放置しました（笑）。その時間で自分の今までをふりかえり、再集合したときに１人ずつ語り、お互いのことを尊重し受け入れることで心理的安全性が一気に高まったと思います。</p>
</blockquote>
<p>私だったら転職を考えますね。浜辺に放置されて再集合して生い立ちとか語れとか言われて、そんな上司だと懸念を抱くと思う。その場で抗議はしなかったとしても。仕事を通して結果的に信頼関係が深くなって、同じ行動をするなら理解できるが、そうじゃない状態で職位の高い人がメンバーに合宿を半強制参加させてプライベートの内容を話させるのはハラスメントと紙一重かもしれない。おそらくこれはたまたまうまくいったケースだというだけで再現性のあるプラクティスにはまったく思えない。厳しい言い方をすると、偉い人の自己満足によるチームごっこではないかと思う。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>「仕事での同僚」から「チームの仲間」になれたというインタビューが書かれていた。私の感覚ではやや違和感がある。グループではなくチームという概念が認識されるようになったのはわりと最近の話だというのはたしか心理的安全性のつくりかたに書いてあった気がする。 <a href="https://twitter.com/hashtag/%E9%87%91%E6%9C%9D%E3%83%84%E3%83%A1%E3%83%88%E3%82%AE?src=hash&ref_src=twsrc%5Etfw">#金朝ツメトギ</a></p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1466528241661874179?ref_src=twsrc%5Etfw">December 2, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<h2 id=本番リリース作業>本番リリース作業</h2>
<p>今日は非稼働日なんだけど、インフラ周りの修正をしていたので本番リリースの作業を見守っていた。ハドルで画面共有しながらみんなでわいわいできるので、これはこれでリリース作業の雰囲気を学ぶ機会にもなる。私が本番リリースすることはないだろうけど、担当者がどういった作業でリリースしているかを知っておく方が運用に役に立つ仕組みも導入できるかもしれない。音声通話と画面共有さえあればフルリモートワークでもなにも困ることはない。よい世の中になったと思う。RabbitMQ と Dapr 周りで私が懸念に思っていたことを本番リリースを通して検証したり振る舞いを観察できたので新たな知見を得た。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1202/>スクラムイベントにもの思い</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-02
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
</span>
<div class=post-content>
<p>23時に寝て6時半に起きた。昨日は疲労困憊だったのでなんもせずすぐ寝た。</p>
<h2 id=スクラムイベント>スクラムイベント</h2>
<p>お仕事のスクラム開発で木曜日はスプリントレビューとプロダクトバックログリファインメントを行う。主にステークホルダーとプロジェクトオーナーがプロダクトバックログアイテムの優先度を議論したり、タスクに細分化されていない課題をタスクにしていくための作業に当てたりしている。本当はタスク化されたイシューをさらにリファイメントするイベントなのだろうだけど、まだそこまで業務やチームの体制が成熟していないため、タスクの細分化のための時間になっていたりしている。</p>
<p>これらのイベントで開発者がイニシアティブをとることはないけど、プロダクトオーナーやその業務チームにいるメンバーたちがどうやって業務をタスク化しているかのやり取りもみえたりする。開発者にとってそのやり取りをみていることに意味があるかどうかはまだ私にはわからないが、業務チームのメンバーがどういった働き方をしているかを知るきっかけにはなる。業務チームは <a href=https://miro.com/>miro</a> を使ってメンバーみんなで同時編集しながら課題を付箋代わりのメモに落としていく。その個々のメモがタスクに近いものになるのだろうけど、私からみたら業務すべてを知っている人がまとめて細分化してドキュメントに書き記して2-3回みんなでレビューすれば終わるようなものを、みんなで付箋紙に書いていって整合性が取れているのかどうかわからないメモの固まりを作っているようにみえる。この作業はみんなでやらないと進捗しないので1週間に1回とかになる。</p>
<ul>
<li>チームが扱うすべての業務を知っているメンバーはいない</li>
<li>業務に必要な機能の優先順位や優先度を決める権限をもっていない</li>
<li>情報が足りないと思ったときにメンバーが自律的に動いて補う体制が整っていない</li>
</ul>
<p>あとステークホルダーが話す要件や仕様に関わってくる話の大半が口頭で行われていてドキュメントや課題管理に文章として書き記されていない。だから同じ話しを何度も繰り返し聞くようなケースも発生する。わからないことを聞くことも、繰り返し聞くことも問題ではないが、議事録以外にそこで話す内容がドキュメント化されないのはどうしてだろう？という気もした。もっともっと文章を書かないと情報共有やノウハウをためることにはつながっていかないだろうということも垣間みえる。</p>
<p>総括すれば、どんな開発方法論を使っても、リーダーやマネージャークラスが圧倒的に文章を書けないと、その配下のメンバーは自律的に行動できないというだけの話しでしかないが、どうやったら解消できるか？はまだまだこれからの私の課題でもある。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1201/>師走入り</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-12-01
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/dapr/>dapr</a>&nbsp;
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
</span>
<div class=post-content>
<p>1時から1時間ほど仮眠をとって2時から4時過ぎまで作業して帰ってお風呂に入ってそのまま6時から <a href=https://kobe-sannomiya-dev.connpass.com/event/232426/>【三宮.dev オンライン】リモート朝活もくもく会</a> の朝活に参加した。30分ほど雑談して眠くなって7時過ぎから9時前まで寝てた。</p>
<h2 id=dapr-の-pubsub-の-dead-letter-サポート>dapr の pubsub の dead letter サポート</h2>
<p>お仕事で dapr を触っている。pubsub で dead letter queue の仕組みを導入しようとしているが、<a href=https://github.com/dapr/dapr/issues/2217>PubSub&rsquo;s DeadLetter Topic #2217</a> によると v1.6 (2022年1月20日リリース予定) のマイルストーンになっている。本当にその予定ならそろそろベータ版が実装されていて、開発ブランチあったらテストしようかと考えていた。調べてたら rabbitmq はすでに v1.5 で dead letter のサポートがマージされているのを発見した。</p>
<ul>
<li><a href=https://github.com/dapr/docs/pull/1844>Add dead letter support for RabbitMQ pubsub #1844</a></li>
</ul>
<p>たまたま、いま使っている pubsub も rabbitmq だった。ドキュメントをみたら確かにその設定が追加されている。</p>
<blockquote>
<p><a href=https://docs.dapr.io/reference/components-reference/supported-pubsub/setup-rabbitmq/>dapr RabbitMQ</a></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Required</th>
<th>Details</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>enableDeadLetter</td>
<td>N</td>
<td>Enable forwarding Messages that cannot be handled to a dead-letter topic. Defaults to &ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo;, &ldquo;false&rdquo;</td>
</tr>
<tr>
<td>maxLen</td>
<td>N</td>
<td>The maximum number of messages of a queue and its dead letter queue (if dead letter enabled). If both maxLen and maxLenBytes are set then both will apply; whichever limit is hit first will be enforced. Defaults to no limit.</td>
<td>&ldquo;1000&rdquo;</td>
</tr>
<tr>
<td>maxLenBytes</td>
<td>N</td>
<td>Maximum length in bytes of a queue and its dead letter queue (if dead letter enabled). If both maxLen and maxLenBytes are set then both will apply; whichever limit is hit first will be enforced. Defaults to no limit.</td>
<td>&ldquo;1048576&rdquo;</td>
</tr>
</tbody>
</table>
</blockquote>
<p>enableDeadLetter=true に設定して、適当にエラーが発生しそうなリクエストを作って dead letter にメッセージが入るかどうかを検証してた。ひとまず dead letter にメッセージが入ること自体は確認できた。</p>
<h2 id=bizpy-勉強会>bizpy 勉強会</h2>
<p><a href=https://bizpy.connpass.com/event/229239/>Python で Slack のインテグレーションをやってみる勉強会 #3</a> を開催した。月曜日から2時間もあればできる資料作成をだらだら先送りしていて夜中に作った。なんか体調を崩しているのかもしれない。たまたま勉強会の前にせらさんから激励のコメントをいただいて嬉しかった。</p>
<blockquote>
<p>今日の分も含めコンテンツ拝見しましたが、素晴らしいですね</p>
</blockquote>
<p>私見だけど、slack インテグレーションで調べものをしているとせらさんの記事や issue のやり取りをみかけることが多い。twitter で slack インテグレーションに関してつぶやくと100%せらさんからレスポンスがある (個人の経験談) 。過去に私は外資の ISV で働きたいと思って活動したこともあったけど、せらさんをみていて自分のレベルでは無理だったなと得心がいった。なにがすごいって、bizpy の勉強会のようなところにもわざわざやってきて、講師にコメントしたりアドバイスしてくれるんだからね。</p>
<p>2ヶ月に渡り、slack インテグレーションのチュートリアルレベルの記事を実際に設定してみて、サンプルコード書いてみて、動かしてみて、slack でどんなことができそうかの理解を深めることができた。今回の内容はビジネスパーソン向けではなかったのでちょっと敷居が高かったかもしれないが、全3回でやり切ることができてよかった。終わってから運営に新たにわたなべさんが加わったことを参加者に紹介しつつ、次回の企画について雑談していた。次回はわたなべさんから機械学習入門のような勉強会をしてもらうことに決まった。</p>
</div>
</div>
<div class=pagination>
<div class=pagination__buttons>
<span class="button previous">
<a href=/diary/dates/2021/12/page/2/>
<span class=button__icon>←</span>
<span class=button__text>最近の日記</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class="copyright copyright--user">
<span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span>
</div>
</div>
</footer>
<script src=/diary/assets/main.js></script>
<script src=/diary/assets/prism.js></script>
</div>
</body>
</html>