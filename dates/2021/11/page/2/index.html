<!doctype html><html lang=en>
<head>
<title>2021/11 :: forest nook</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=keywords content>
<meta name=robots content="noodp">
<link rel=canonical href=/diary/dates/2021/11/>
<link rel=stylesheet href=/diary/assets/style.css>
<link rel=stylesheet href=/diary/assets/green.css>
<link rel=stylesheet href=/diary/style.css>
<link rel=apple-touch-icon href=/diary/img/apple-touch-icon-192x192.png>
<link rel="shortcut icon" href=/diary/favicon.ico>
<meta name=twitter:card content="summary">
<meta name=twitter:site content="t2y">
<meta name=twitter:creator content>
<meta property="og:locale" content="en">
<meta property="og:type" content="website">
<meta property="og:title" content="2021/11">
<meta property="og:description" content>
<meta property="og:url" content="/diary/dates/2021/11/">
<meta property="og:site_name" content="forest nook">
<meta property="og:image" content="/diary/favicon.ico">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<link href=/diary/dates/2021/11/index.xml rel=alternate type=application/rss+xml title="forest nook">
</head>
<body class=green>
<div class="container full headings--one-size">
<header class=header>
<div class=header__inner>
<div class=header__logo>
<a href=/diary>
<div class=logo>
forest nook
</div>
</a>
</div>
<div class=menu-trigger>menu</div>
</div>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/diary/about>自己紹介</a></li>
<li><a href=/diary/dates>月別一覧</a></li>
<li><a href=/diary/tags>タグ一覧</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/diary/about>自己紹介</a></li>
<li><a href=/diary/dates>月別一覧</a></li>
<li><a href=/diary/tags>タグ一覧</a></li>
</ul>
</nav>
</header>
<div class=content>
<div class=posts>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1119/>メタ認知にもの思い</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-19
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/metacognition/>metacognition</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時に起きた。昨日も疲れててウォーキングには出掛けられなくて寝て、3時や4時に起きつつも気付いたら5時半に起きてて、そう言えばと思い出したときに6時だったというふわふわした寝起きだった。</p>
<h2 id=朝活-ミクロ経済学入門の入門>朝活: ミクロ経済学入門の入門</h2>
<p><a href="https://www.youtube.com/watch?v=g9-KQ76QmtI">［金朝ツメトギ］ 2021-11-19 AM 6</a> で第10章の再分配を読んだ。この本はほとんど朝活で読み終えた。</p>
<p>市場は社会的余剰が最大化されるので社会全体の富を増やす働きの強い制度だという。その増える富の方向性をタテとヨコで表現しているが、タテ方向に増やす働き (資本家が莫大な富をもつ) はあっても、ヨコ方向に拡げていく (みんなが裕福になる) 機能はないという。本章では所得の再分配と、再分配が適正かどうかを測るための指標として <strong>ジニ係数</strong> について説明されている。ジニ係数を使うと、所得分布から不平等の状態を客観的に把握することに優れているという。</p>
<p>富める者から貧しい者へ所得を移転することでジニ係数が下がる。ただし、両者の貧富を逆転させないものを <strong>ピグー・ドールトン移転</strong> と呼ぶ。このピグー・ドールトン移転を実行し続けると、最終的に所得分布は全員が同じである <strong>完全平等分布</strong> になる。このときのジニ係数はゼロになる。その逆に、1人がこの世すべての所得を独り占めすると <strong>完全不平等分布</strong> となり、そのジニ係数は 1 (に近い値) となる。</p>
<figure><img src=/diary/img/2021/1119_gini-coefficient.png>
</figure>
<ul>
<li>絶対的貧困: 世界銀行は生命の維持に必要な基準として1日の所得1.25ドルと定めている、絶対的貧困の指標の1つと考えられる</li>
<li>相対的貧困: 所得分布の真ん中の50%と OECD が定めている
<ul>
<li>相対的貧困の基準に満たない人口の占める割合を <strong>相対的貧困率</strong> と呼ぶ</li>
<li><a href=https://www.mhlw.go.jp/toukei/saikin/hw/k-tyosa/k-tyosa19/dl/03.pdf>2019年 国民生活基礎調査の概況</a> によると、2019年の値は 15.7% になるらしい。6-7人に1人ぐらいの割合になる。</li>
</ul>
</li>
</ul>
<h2 id=メタ認知が暴走>メタ認知が暴走</h2>
<p><a href=https://kentarokuribayashi.com/journal/2021/11/18/2021%e5%b9%b411%e6%9c%8818%e6%97%a5>あんちぽさんの日記</a> に次の動画が紹介されてた。<a href=https://note.com/t2y1979/n/n4713058f48ce>メタ認知で〈学ぶ力〉を高める：認知心理学が解き明かす効果的学習法</a> を読んでから、学びや書くことについてメタ認知というキーワードを意識して考えるようになっている。この動画ではメタ認知を「相対化」と説明していた。自己を相対化して、様々な文脈や状況、相手の意図なども考慮して結論が出せなくなったり、思考がまとまらなくなってしまうという。そういうメタ認知が暴走する人間を <em>メタモン</em> と名付けていた。ここでいう「モン」はモンスターの短縮なのかな？なかなかおもしろい。こんな極端ではないけど、私も相手の意図や状況を深読みしてしまって静観の姿勢を取るものの、なにも考えてない人だったりすると無駄に時間を浪費してしまうこともある。他にも <a href=https://ja.wikipedia.org/wiki/%E9%8A%83%E3%83%BB%E7%97%85%E5%8E%9F%E8%8F%8C%E3%83%BB%E9%89%84>銃・病原菌・鉄</a> の話題が気になって wikipedia を軽く読んだりした。</p>
<div class=video-container>
<iframe src=https://www.youtube.com/embed/sj7eer2tArs allowfullscreen title=意図せずメタ認知が暴走する悲しき怪物【ミーム提案委員会2】＃71></iframe>
</div>
<h2 id=会食>会食</h2>
<p>姪が大学に進学するそうでその面接に来たので一緒に晩ご飯することに。姉の勤め先の関係会社で <a href=https://kobe-plaisir.jp/>神戸プレジール</a> という神戸牛ステーキのややたっかい系のレストランで食べてきた。コース料理で1万円/人で飲みものやデザートなどは別途6千円ほどだった。但馬牛や神戸牛のステーキはもちろんとてもおいしかったんだけど、もう自分はこういう料理を求めてないなというのも感じた。個室で食べてたんやけど、姉の仕事の関係者が5-6人ぐらい、入れ代わり立ち代わりにやってきて、姉は直売所のパートだったのが、いつの間にか社員になって、いつの間にかナンバー2になっているらしい。おまけでフォークリフト免許まで取っている。なんやかんやも含めて、この場所を晩ご飯に選んでいるのもあるんだろうけど、職場の周りの人にしか言っていない今日の予定を、どこかで聞きつけて挨拶にくる関係者の人たち。私が学生の頃「田舎の噂は isdn より速い」と言ったものだけど、いまは「光回線よりも速い」と言うらしい。姉がいろんな関係者に挨拶しているのをみながら、もう自分はこういう仕事もたぶんできないなと実感した。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1118/>今年は忘年会やる</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-18
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/git/>git</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て3時に起きて2度寝して6時に起きた。起き上がれなくて6時半までだらだらしてから起きた。</p>
<h2 id=リポジトリの改行コード指定>リポジトリの改行コード指定</h2>
<p>git のリポジトリ設定で <a href=https://git-scm.com/docs/gitattributes>.gitattributes</a> という設定方法がある。ざっくり理解するには <a href=https://kiririmode.hatenablog.jp/entry/20170416/1492300735>.gitattributesによる改行コードの変換設定</a> を読むのが早い。とりあえずこんな設定にしてみた。すでに crlf の改行コードでコミットされたファイルがあるため、それらを lf に変換しないといけない。<code>eol=lf</code> にすると crlf でコミットされている既存ファイルも変換してくれるみたい。おそらくチェックアウトしたときにそうなるのかな？</p>
<pre tabindex=0><code>*       text=auto eol=lf
*.jar   binary
</code></pre><p>ここ数年は Windows マシンを開発に使っている開発者と一緒に働いたことがなかったけど、OS 混在環境だとリポジトリ設定が必要だということに気付いた。多様性は大事。</p>
<h2 id=忘年会>忘年会</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/231602/>三宮.dev＆bizpy 合同忘年会</a> に参加登録した。bizpy だけだと、忘年会の参加者を集めるのは厳しそうなので三ノ宮.devと共同でやる。これなら最低でも2人は確定しているのでイベントがなくなることはない。日程は参加者の希望を聞きながら水曜か金曜でやるみたい。いましか飲み会できないだろうからいいと思う。</p>
<h2 id=ミクロ経済学入門の入門>ミクロ経済学入門の入門</h2>
<p>第9章の公共財を読んだ。市場を考察するときに扱う財は一般論として <strong>私的財</strong> を想定している。私的財は次の2つの性質を満たす。</p>
<ul>
<li>競合的: 複数の人々が同時に利用できない</li>
<li>排除的: 拠出に貢献した特定のメンバーしか利用できない</li>
</ul>
<p>一方で私的財と対偶の関係にある競合的でも排除的でもない財を <strong>公共財</strong> と呼ぶ。例えば、国防サービスや一般道路などが相当する。侵攻してくる敵国から自国を防衛するときにすべての国民、納税していない人であっても国防の利益にあずかれる。非競合的だが、排除的である財を <strong>クラブ財</strong> と呼ぶ。高速道路などが相当する。みんなが利用できるが、利用料金を収めないと利用できない。競合的だが非排除的な財を <strong>コモンプール財</strong> と呼ぶ。漁場などが相当する。どの漁師が魚を獲るかは競合しているが、漁業権をもっている限り漁そのものは制限されない。</p>
<p>これをまとめると、財は次の4つの分類になる。</p>
<table>
<thead>
<tr>
<th style=text-align:center></th>
<th style=text-align:center>競合的</th>
<th style=text-align:center>非競合的</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>排除的</td>
<td style=text-align:center>私的財</td>
<td style=text-align:center>クラブ財</td>
</tr>
<tr>
<td style=text-align:center>非排除的</td>
<td style=text-align:center>コモンプール財</td>
<td style=text-align:center>公共財</td>
</tr>
</tbody>
</table>
<p>公共財の自発的供給の問いとして、排除的でも競合的でもない公共財が人々の自発的な行動で十分に供給できるかを考える。自分のお金を寄付する・寄付しないの2択でマトリクスを作成する。自分は寄付せず、他人の寄付から利益を得ることを <strong>フリーライド</strong> と呼ぶ。みんながフリーライドをしようとすると公共財はまったく供給されない。A と B の2者間における利得表を表すと次のようになる。相手が寄付して、自分が寄付しないときに最大の利益となり、どちらも寄付しないよりは両者が寄付した方が利益が大きくなる。</p>
<table>
<thead>
<tr>
<th style=text-align:center>A \ B</th>
<th style=text-align:center>寄付する</th>
<th style=text-align:center>寄付しない</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>寄付する</td>
<td style=text-align:center>4, 4</td>
<td style=text-align:center>2, 5</td>
</tr>
<tr>
<td style=text-align:center>寄付しない</td>
<td style=text-align:center>5, 2</td>
<td style=text-align:center>3, 3</td>
</tr>
</tbody>
</table>
<p>A が寄付するか・しないかの選択は、B の寄付の有無に関係なく、A は寄付しない方が寄付したよりもトクすることになる。相手がどういった選択をしても自分にとって一番トクな選択肢が同じときにその選択肢を <strong>支配戦略</strong> という。この話は B からみても同じになる。A も B も寄付しないがトクする状態のことを <strong>支配戦略均衡</strong> という。この状態が最善かと言えば、そうではなく、両者が寄付した方が両者が寄付しないよりもトクする状態になる。このように公共財の供給を個々のプレイヤーに任せていては <strong>パレート劣位</strong> な結果となってしまう。この状態からどうやって両者が寄付する <strong>パレート優位</strong> な状態に移行できるかを考えるのが、政府の徴税の方策と言える。</p>
<p>政府が誰にいくらの税を課して、どの程度の量の公共財を適切と決めるのかは難しい問題である。放っておいて上手くいかないものの、政府に任せて上手くいくことも保証されない。このようなゲーム理論を制度設計に活用する <strong>メカニズムデザイン</strong> という専門分野がある。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1117/>Testcontainers を触ってみた</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-17
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/java/>java</a>&nbsp;
</span>
<div class=post-content>
<p>23時頃に寝て3時に起きて、そこから寝たり起きたりしながら6時に半に起きた。怖い夢をみて眠れなくなって中途半端に寝てた。</p>
<h2 id=朝活-雑談>朝活: 雑談</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/231078/>【三宮.dev オンライン】リモート朝活もくもく会</a> に参加した。寝坊、、、というよりは起きてたけど、イベントを忘れていて6時45分ぐらいから参加して主催者しかいなかったのでそのまま7時半まで雑談してた。始めが悪いとだらだらしてしまう。気をつけねば。</p>
<p>三宮.dev の主催者や参加者の常連さんたちとはだいぶ身近に話すにようになってきた。コミュニティって人間関係だと思っていて、話したり顔をあわせたりする回数が増えるに従って身近な知人になっていって、それ自体が価値の1つだったりすると思う。いま忘年会の企画を三宮.dev でも行っているが、bizpy と合同でやっていいんじゃないかと考えている。</p>
<h2 id=testcontainers>Testcontainers</h2>
<p>DB を使ったユニットテストのために <a href=https://www.testcontainers.org/modules/databases/postgres/>Testcontainers Postgres Module</a> を使ってみた。docker hub からイメージを取得して JUnit のテストプロセスの中からアクセスできるようにするためのライブラリになる。コンテナの扱いをテストコードから管理したいときなどに便利。ちょっと調べて簡単に設定できたのでまた時間のあるときに会社のブログに記事を書こうと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1116/>カスタム GitHub Actions のサンプルを作ってみた</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-16
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/github/>github</a>&nbsp;
</span>
<div class=post-content>
<p>23時半に寝て5時半に起きた。昨夜は夜にウォーキングに出掛けようと思いつつ、22時頃に1時間ほど寝てしまった。それで出掛けるのが面倒になってそのまま寝てた。早く寝た分、早く起きた。せっかく早起きしたのでドラクエタクトのデイリーミッションやって、それから起きて7時ぐらいにはオフィスに着いてたと思う。</p>
<h2 id=カスタム-github-actions-作成>カスタム GitHub Actions 作成</h2>
<p>GitHub Docs の <a href=https://docs.github.com/ja/actions/creating-actions>アクションの作成</a> をみながらサンプルを作ってみた。カスタムアクションは3つの作成方法がある。</p>
<ul>
<li>docker コンテナを使ったアクション</li>
<li>javascript を使ったアクション</li>
<li>シェルスクリプトなどを使ったアクション (composite アクション)</li>
</ul>
<p>たぶんランタイムに何を使うかでアクションの作り方が異なるようにみえる。最後の composite アクションは呼び出される環境で動くことを想定しているのかな？サンプルには bash 上で動くものを紹介していた。ほとんどチュートリアルの内容そのままんだけど、動かして雰囲気を掴むために自分で composite アクションを作ってみた。単一のリポジトリに閉じたものなら通常のワークフローの設定に書けばいいけど、複数のリポジトリで同じ処理をしたい場合は composite アクションとして再利用できるようにするとよさそう。</p>
<ul>
<li><a href=https://github.com/t2y/gh-actions-sample>https://github.com/t2y/gh-actions-sample</a></li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1115/>お仕事しかしなかった一日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-15
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;
</span>
<div class=post-content>
<p>2時に寝て6時半に起きた。寝る前にウォーキングしてくるとよく眠れる気がする。お仕事で簡単に終わると思ってた作業にちょっとはまってトラブルシューティングしてたら疲れた。原因はわかって自己解決できたのはよかったけど、消耗して早くお仕事を終えて帰ってくつろいでた。</p>
<h2 id=ローカル開発環境の整備>ローカル開発環境の整備</h2>
<p>お仕事でローカルの k8s 環境の保守の作業をしている。<a href=https://minikube.sigs.k8s.io/docs/>minikube</a> でローカルの k8s クラスターを作成して <a href=https://kubernetes.io/docs/reference/kubectl/overview/>kubectl</a> コマンドで制御する。k8s の yaml の設定ファイルのことをマニフェストと呼ぶのかな？そのテンプレート？ジェネレーター的なツールに <a href=https://kustomize.io/>kustomize</a> を使っている。先週から1週間触っていたので cli の操作にはだいぶ慣れてきた。</p>
<p>まだ基本的な delete & apply みたいなことしかやってないけど、また余裕のあるときに細かいコマンドやロールバックのやり方なども学習しようと思う。デプロイで一番重要なのはロールバック、次にローリングアップデート、ローリングアップデートができればカナリアリリースもできるかな？その2つがあれば運用は大幅にコスト削減できるし、開発のアジリティも上げられる。たぶん k8s を使えば簡単にできるんだろうなというのは delete & apply だけみてもそう受け取れる。k8s クラスターさえマネージドならよく出来た仕組みだなと感心した。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1114/>リーンキャンバスやってみた</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-14
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/writing/>writing</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/xr/>xr</a>&nbsp;
#<a href=/diary/tags/disease/>disease</a>&nbsp;
</span>
<img src=/diary/img/2021/1114_lean-canvas.png class=post-cover alt=リーンキャンバスやってみた>
<div class=post-content>
<p>2時に寝て8時に起きた。起きてからドラクエタクトのダイの大冒険コラボイベントをお昼前までやってた。午前中遊んでた割には今日はいろいろ作業した。ゆっくり寝たせいか、個々の作業は集中してできた。</p>
<h2 id=リーンキャンバス>リーンキャンバス</h2>
<p>友だちにプロダクトの設計についてレビューしてもらう機会を調整してたらリーンキャンバス作るとよいとアドバイスをもらった。全然やったことがないので試しに自分でもやってみることにした。<a href=https://monstar-lab.com/dx/solution/lean-canvas/>リーンキャンバス（Lean Canvas）を活用した企画書の書き方【テンプレート付】</a> を読みながら <a href=https://canvanizer.com/>Canvanizer</a> というツールで作成してみた。リーンキャンバスの利点の1つとしてA4サイズ1枚程度におさめるので短時間で作成できるというのがある。プロダクトの要件定義と設計はすでにできているので、リーンキャンバスは1時間も経たないうちにたたき台を作成できた。また友だちにレビューしてもらうときにフィードバックをもらいながら精度をあげていく。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>昨日から 9.4 分散トランザクションと合意の後半の3つの節を読んだ。第Ⅱ部、400ページを超えたので2/3ほど読み終えた。</p>
<ul>
<li>9.4.3 耐障害性を持つ合意</li>
<li>9.4.4 メンバーシップと協調サービス</li>
<li>まとめ</li>
</ul>
<p>合意の問題は、次のように形式化される。1つ以上のノードが値を <strong>提案（propose）</strong> し、合意アルゴリズムはそれらの値の中から1つを <strong>決定（deside）</strong> する。この形式化においては、合意アルゴリズムは次の性質を満たさなければならない。</p>
<ul>
<li>一様同意（uniform agreement） : 2 つのノードが異なる決定をしていないこと</li>
<li>整合性（integrity） : 2 回決定をしているノードがないこと</li>
<li>妥当性（validity） : ノードが値 v を決定したら、 v を提案しているノードがあること</li>
<li>終了性（termination） : クラッシュしていないすべてのノードは、最終的に何らかの値を決定すること</li>
</ul>
<p>耐障害性を持つ合意アルゴリズムで最も広く知られているのは、Viewstamped Replication（ VSR ）、Paxos、Raft、Zab であり、こういった合意のアルゴリズムは全順序ブロードキャストを実装しており、複数回にわたって合意が行われる。全順序ブロードキャストによって耐障害性を保ちながら線形化可能でアトミックな操作を実装できる。ZooKeeper のようなツールが、アプリケーションから利用できる合意、障害検出、メンバーシップの「アウトソーシング」サービスを提供する上で、重要な役割を果たしている。分散システムにおける様々な問題に耐えうるようなアルゴリズムを独自に開発するよりははるかによいといえる。合意へと落とし込めるような問題の処理が必要で、さらに耐障害性が求められるなら ZooKeeper のようなサービスを使うとよい。</p>
<h2 id=神戸駆動開発イベント>神戸駆動開発イベント</h2>
<p><a href=https://osaka-driven-dev.connpass.com/>大阪駆動開発</a> という xr (vr/ar/mr) のコミュニティがあって、いろんな地域に拡張しているようで、その支部？の1つに神戸駆動開発ができて、そのイベントとして <a href=https://kobe-driven-dev.connpass.com/event/230296/>【神戸】XR体験&交流会</a> に参加してきた。会場が <a href=https://www.kobedenshi.ac.jp/>神戸電子専門学校</a> だったのでどんなところかを見に行く意図でも出かけてきた。三宮.dev の主催者も神戸電子専門学校の中の人とつながりがあるらしく、今度オフラインの勉強会をそこでしようか検討しているといった話しもあった。bizpy もコロナが落ち着いたらオフラインの勉強会をやってもいいかなとは考えているので接点を作っておいてもいいかもしれない。神戸なんて狭い地域なのでコミュニティ関係者はすぐにつながるけど、神戸でオフラインの勉強会を開くに当たって適当な場所がないというのはあちこちで聞く話しでもあるので、神戸電子専門学校がそういったコミュニティをつなぐハブ的な場になるならそれはそれでいいのかもしれない。</p>
<p><a href=https://www.microsoft.com/en-us/hololens>HoloLens 2</a> と <a href=https://www.nreal.ai/light/>Nreal Light</a> と iphone や apple watch とレンズやミラーを組み合わせて作った手作りのデバイスなども体験させてもらった。HoloLens が思ったよりも映像がみえにくくて、ロボットを操作してロケットを発射させるコンテンツをやってみたんだけど、操作よりもコンテンツが明確にみえなくて難しかった。もしかしたら装着の仕方が悪かったのかもしれない。それに比べて Nreal Light はアイドルのライブみたいなコンテンツをみたんだけど、映像も音声もはっきりしていたので印象はよかった。</p>
<p>適当にスタッフの人と話していて、センサーを使って現実のモノや事象を vr 空間に持ち込むと vr コンテンツを作るのは簡単かも？という話しをした。なんかセンサーを探してもいいかもしれない。そのスタッフの人はピアノを弾くのでピアノ音を取り込んで加工したりしていると話していた。</p>
<h2 id=傾斜枕>傾斜枕</h2>
<blockquote>
<p>胃食道逆流症（英語表記Gastro Esophageal Reflux DiseaseからGERD（ガード）とも呼ばれています）は、主に胃の中の酸が食道へ逆流することにより、胸やけ（みぞおちの上の焼けるようなジリジリする感じ、しみる感じなど）や呑酸（酸っぱい液体が上がってくる感じ）などの不快な自覚症状を感じたり、食道の粘膜がただれたり（食道炎）する病気です。胸が詰まるような痛みを感じたり、のどの違和感や慢性的に咳が持続する患者さんもいます。胃酸の逆流は食後2～3時間までに起こることが多いため、食後にこれらの症状を感じたときは胃酸の逆流が起きている可能性を考える必要があります。</p>
<p>(&mldr;)</p>
<p>現在では成人の10～20％がこの病気にかかっていると推測されています。</p>
<p><a href=https://www.jsge.or.jp/guideline/disease/gerd.html>胃食道逆流症(GERD)</a></p>
</blockquote>
<p>ここ1-2年、睡眠がうまくとれなくなったことと関連して、寝ていて胃酸が逆流してむせるといったことも2-3ヶ月に1回ぐらいと稀ではあるけれど、起きるということに気付いた。2年ほど前、健康診断で胃カメラを受診したときに医師から胃の入り口の弁が、普通の人は逆流しないように閉じているものが私のは開いているという話があった。そのときは特に日常生活に困ってないからいいんじゃないで流してたんだけど、加齢とともに胃食道逆流症が起こっているのかもしれないと、いくつかの事象を認識して思うようになってきた。喉の違和感も気になるようになっていた。その症状の軽減に逆流しにくいように傾斜を付けて寝るとよさそうというのをみつけて、傾斜枕を買ってみた。しばらく試してみて寝心地や胃食道逆流症がどうなるかを観察してみる。</p>
<p><a href="https://www.amazon.co.jp/dp/B07VNDPD8Y?&linkCode=li2&tag=t2y-diary-22&linkId=f2a28286ce04219213b577e23c7d45c4&language=ja_JP&ref_=as_li_ss_il" target=_blank><img border=0 src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B07VNDPD8Y&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=t2y-diary-22&language=ja_JP"></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=t2y-diary-22&language=ja_JP&l=li2&o=9&a=B07VNDPD8Y" width=1 height=1 border=0 alt style=border:none!important;margin:0!important></p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1113/>寝てた</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-13
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て8時に起きた。もっと早く目覚めてはいたけど、休日なんでゆっくりするかとのんびりしてた。本を読んで眠くなってきたので夕方から帰って寝てた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今週は勉強会の発表や週の真ん中で飲みにいってバテてしまってウォーキングは4日ぐらいしかできてなかった。前の週よりはあまり運動ができていない。前週からの右足太もも後ろの筋が張りはまだ少し残っているものの、ちょっとよくなった気がする。今日の開脚幅は開始前168cmで、ストレッチ後169cmだった。前週よりは数値がよくなって、また170cmの大台にのりそうな雰囲気になってきた。</p>
<p>中殿筋 (ちゅうでんきん) という、お尻の横の筋肉があまりよくなくて、ここが悪いと腰痛の原因になるらしい。歩いたり走ったりするときにも使う筋肉だという。<a href=https://kaiseihp.jp/news/id_14953>中殿筋のストレッチとトレーニング</a> のようなストレッチはいまもやっているけど、トレーニングはやってなかったのでまたやってみようと思う。</p>
<h2 id=勉強会兼もくもく会>勉強会兼もくもく会</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/227757/>【三宮.dev オンライン】ついに出たぜNuxt3！Nuxt.js LT大会</a> に参加した。LT 発表する人が少なかったのでもくもく会になって本を読んでた。70歳の参加者の方がいて web 開発をするのに vue.js と react.js のどちらを選べばいいか？といった話題で盛り上がりつつ、その方の背景などを聞いていた。技術の話しは通じたのである程度、開発の素養もあってちゃんと勉強している人にみえた。私と同じマイクロ法人をやっているようで、自分のビジネスのアプリケーションを自分で開発するといったスタンスで取り組まれていて、70歳になってもやっている姿勢に敬意をもてた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1112/>打ち合わせでズタズタ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-12
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て5時半に起きた。体調はよいが、新しい環境で働き始めたのと勉強会が続いたのでややバテた。今日は軽めの活動で休むことにした。今日は打ち合わせが3つ入って、作業が途中でズタズタになって集中力を書いた。打ち合わせするなら固めて連続的にやらないとなかなか難しいな。今週は新しい環境での仕事もあって疲れてたので17時にお仕事を終えて、夕方にお昼寝して、夜にオンライン飲み会でだべってた。</p>
<h2 id=朝活-ミクロ経済学入門の入門>朝活: ミクロ経済学入門の入門</h2>
<p><a href="https://www.youtube.com/watch?v=ddTgbwdpRzg">[金朝ツメトギ] 2021-11-12 AM 6 金曜朝6時開催のもくもく会</a> で第8章のリスクと保険を読んだ。用語を次にまとめる。</p>
<ul>
<li>条件付き財: 将来に特定の条件が成立したときのみ特定の行為を可能とする財
<ul>
<li>例) 保険、賭けごと、宝くじ、投資など</li>
</ul>
</li>
<li>確実性等価: 不確実な対価と、それと無差別になる確実な金額における経済価値
<ul>
<li>例) 50%の確率で1万円もらえるくじを、千円払って購入するときのくじの価格を確実性等価という</li>
<li>人々のリスクへの態度を分類する上で便利な概念になる</li>
</ul>
</li>
</ul>
<p>ある人は、それぞれの金額 <em>m</em> について、満足度の指標 <em>U(m)</em> をもっているとする。このとき <em>U(m)</em> を効用、<em>U</em> を効用関数と呼ぶ。</p>
<p><em>m</em> が増えると <em>U(m)</em> 、つまり効用も高まるが、それには限界がある。増える量は <strong>限界効用逓減</strong> の形になる。次の図では <em>U(5)</em> から <em>U(10)</em> になると <em>m</em> は2倍になるが、効用は2倍にはならない。ここで <strong>期待効用理論</strong> では「人は条件付き財を、効用を発生確率で加重和した <strong>期待効用</strong> で評価する」と考える。この <strong>期待値</strong> は 0.5 * 1万円 + 0.5 * 0円 = 5千円となる。効用は 0.5 x U(10) + 0.5 * U(0) となる。</p>
<figure><img src=/diary/img/2021/1112_Um.png>
</figure>
<p>確実性等価が期待値より高いか低いかは個人によって異なり、少額でも確実にもらえるお金を好むと確実性等価が期待値より低くなる。これを <strong>リスク回避的</strong> と呼び、多くの人々がリスク回避的だからこそ保険という商品が成立する。その逆で確実性等価が期待値より高くなることを <strong>リウス愛好的</strong> と呼ぶ。また確実性等価が期待値が等しいときは <strong>リスク中立的</strong> と呼ぶ。そして確実性等価と期待値の差額を <strong>リスクプレミアム</strong> と呼ぶ。</p>
<p>保険会社がある疾病の保険を提供し、顧客が加入する。顧客は自分がその疾病にかかりやすいかどうかを知っているが保険会社からはわからない。そのため一律の価格で保険を販売する。これを <strong>情報の非対称性</strong> と呼ぶ。この状態で疾病のリスクが高い人たちが増えていくと、保険会社はさらに保険料を引き上げる。それによってリスクの低い人たちが加入しなくなり、さらにリスクの高い人たちの割合を高めてしまう。これを <strong>逆選抜</strong> と呼ぶ。逆選抜の解消方法は、個々人のリスクとは無関係に強制的に保険に加入させてしまう。これが日本の国民皆保険制度と言える。さまざまな人のリスクを社会全体でヘッジ (低減) する仕組みであり、リスクの社会化と言える。</p>
<p>民間の保険会社が遺伝子検査などにより、利潤の追求のため、ハイリスクな顧客を除外しようとすることは不当なのかどうか、保険倫理に関わる難問である。この難問の存在が公的保険制度の意義が高めている。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1111/>PMBOK セミナー</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-11
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/subcontract/>subcontract</a>&nbsp;
#<a href=/diary/tags/pmbok/>pmbok</a>&nbsp;
</span>
<div class=post-content>
<p>22時に寝て4時半に起きた。昨日は勉強会を連日でやって疲れ果ててからバテてすぐに寝た。久しぶりによく眠れた。起きてから1時間ほどドラクエタクトやって、ストレッチやって、7時半にはオフィスに行って8時からお仕事してた。</p>
<h2 id=スクラム談義>スクラム談義</h2>
<p>お仕事で本格的なスクラム開発に参加することになった。スクラムマスターのかわのさんと少しスクラムで雑談した。アジャイル、スクラム、チケット駆動、課題管理などの話題であれこれ話してた。かわのさんはスクラムやアジャイルのアーリーアダプターのようで、かなり昔からやっているから経験や実績が多そうなので私の疑問や懸念に的確に返答をくれた。実際の現場でどう応用するかは別の話題としても、スクラムはそもそも「良い結果」を出すためのものではく「現状をありのままに見る」ものらしい。うまくやろうと思ったらスクラムにプラクティスや開発方法論を組み合わせないといけないし、そのための軽量フレームワークになっているのに、スクラムだけ実践すればうまくいくと誤解している人たちもいるといった話題もあった。私がスクラムうまくいってなさそうなチームをみていて微妙だと感じたのは、自分たちの課題に向き合ったプラクティスや改善に取り組んでなくて、スクラムの方法論を守ることに注力しているようにみえたからかもしれない。</p>
<h2 id=紙の契約書に挑戦>紙の契約書に挑戦</h2>
<p>新しいお仕事の契約は紙の契約で結ぶ。実はこれまで <a href=https://www.cloudsign.jp/>クラウドサイン</a> で電子契約しかしたことなくて、紙の契約書は初めてでどきどきした。言うても印鑑を押すだけなんやけどな。でも、印鑑押すのってきれいに押したいという気持ちが出てちょっと緊張するからあまり好きではない。</p>
<h2 id=pmbok-セミナー>PMBOK セミナー</h2>
<p><a href=https://aitrainingcenter.axis-ing.com/pmbok-quick>PMBOK®ガイド第7版 Quick Review</a> に参加した。</p>
<p>参加者は60人で、すでに PMBOK ガイド第7版を購入またはダウンロードした人が十数人だったらしい。
PMBOK ガイドは4-5年ごとに更新されるものらしい。
本セミナーでは第6版と第7版の違いがどういったものかの概要を説明していた。第7版は第6版の拡張であり、実務で PMBOK ガイドが必要な人は依然として第6版も購入した方がよいと話されていた。</p>
<p>というのは、第7版は過去のガイドを更新したものではなく、PMP 試験は第6版の時点でアジャイルな要素も取り入れているため、第7版のために変更を加えるといった予定は現時点ではない。
つまり、少なくとも PMP 試験やプロジェクトマネジメントの国際規格である ISO 21500 は第6版をベースにした内容があるため、それらが急になくなったりすることはないらしい。第6版と第7版の違いとして次のような話しをされていた。</p>
<ul>
<li>プロジェクトマネジメントの節目の切り口が変わった？
<ul>
<li>第6版: プロセスベース</li>
<li>第7版: 原理原則</li>
</ul>
</li>
<li>第7版でガイドに <strong>チーム</strong> が登場するようになった
<ul>
<li>主語がチームとなり、チームが○○するための原理原則はこうであるといった内容に変わった
<ul>
<li>主役はプロセスではなくチーム</li>
</ul>
</li>
<li>プロジェクトにチームが寄り添うようになった</li>
</ul>
</li>
</ul>
<p>これらの違いは、第6版と第7版をテキストマイニングして、共起ネットワークを構築して比較してみるとよくわかると分析されていた。あとおもしろかったのが、第6版と第7版ではページ数は半減したものの、文字数は3割減程度となっており、箇条書きが多かった内容が説明ベースの文章に変わったためだろうといった話しもあった。</p>
<figure><img src=/diary/img/2021/1111_pmbok-text-mining.png>
</figure>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1110/>低空飛行</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-10
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
</span>
<div class=post-content>
<p>3時に寝て7時半に起きた。昨日2時まで呑んだくれてたので水曜日の朝活はお休み。完全に忘れてたし寝坊した。やや2日酔いでしんどかったけど、朝にはちゃんと起きれたので体調はよい。お仕事では会議体の見直しがあって、私が必要な会議に invite されてなくてバタバタしてた。</p>
<h2 id=bizpy-勉強会>bizpy 勉強会</h2>
<p><a href=https://bizpy.connpass.com/event/229091/>Python で Slack のインテグレーションをやってみる勉強会 #2</a> を開催した。10人ほど参加してくれた。資料は作ってあったし、内容も難しくないものだったので管理画面の設定とコードをみながら1時間ほどで説明して、30分ほど質疑応答や雑談をしながら8時半には勉強会を終えた。前日の睡眠不足でしんどかったので早く終えて帰りたかったのもある。あと一回 Block Kit の開発をやって slack インテグレーションの勉強会は終えようと思う。次は12月1日なので年内はそれで終わりでいいかな。いまのうちに忘年会やりたい気持ちがあるけど、神戸だと人が集まらんやろなぁ。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1109/>呑んだくれ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-09
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/github/>github</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;
</span>
<div class=post-content>
<p>1時半に寝て6時に起きた。夜にウォーキングに出かけようとしたらたまたま雨が降ってきて諦めた。そしたら寝付けなかった。やっぱり歩いて疲弊すると寝付けやすいのかもしれない。ストレッチしたりしてたら寝るの遅くなった。</p>
<h2 id=中間申告の納付>中間申告の納付</h2>
<p>法人税・地方法人税の申告用紙が届いていたので内容を確認しながら e-tax で申請して pay-easy で税金の支払いを完了した。国税は一番最後に書類が届く。今年の書類が届いた日はこんな感じ。毎年記録しているから届く時期に準備していて慌てなくて済む。</p>
<ul>
<li>法人市民税: 10月16日</li>
<li>法人県民税: 10月20日</li>
<li>法人税・地方法人税: 11月8日</li>
</ul>
<p>国税の納付をもって中間申告をすべて終えた。中間申告は税金の先払いだからキャッシュフローが悪いと払えないみたいなことが起きる可能性がある。そうすると仮決算して支払い金額を抑えるみたいなことが必要になるんだろうな。まさに貧乏暇無し。</p>
<h2 id=github--slack-integration>GitHub + Slack Integration</h2>
<p><a href=https://github.com/integrations/slack>integrations/slack</a> の内容をみて subscribe する内容を確認した。4月頃にアップグレードしてそれまでの設定の互換性をなくして、その影響でうまく動かなかったりしてた。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>github の slack 連携のときの commits:all が commits:* に変更されたみたい。4月中旬のバージョンアップ以降に作ったリポジトリか設定だと commits:all だと連携されないみたい。<a href=https://t.co/mGVUyEbgGQ>https://t.co/mGVUyEbgGQ</a></p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1387999605959188481?ref_src=twsrc%5Etfw">April 30, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<p>その後、追いかけてなかったけど、いま README をみたら次の5つのイベントはデフォルトで有効になるみたい。</p>
<ul>
<li>issues</li>
<li>pulls</li>
<li>commits</li>
<li>releases</li>
<li>deployments</li>
</ul>
<p>必要に応じて他のイベントも追加するとよいみたい。私は次の3つかな。</p>
<ul>
<li>reviews</li>
<li>comments</li>
<li>commits:*</li>
</ul>
<p>デフォルトのイベントは指定しなくてもよいけど、コピペですべて明示的に設定するならこんな感じ。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>/github subscribe owner/repo issues,pulls,commits:*,releases,deployments,reviews,comments
</code></pre></div><h2 id=みんなの-python-勉強会>みんなの Python 勉強会</h2>
<p><a href=https://startpython.connpass.com/event/228136/>みんなのPython勉強会#75</a> で発表した。参加者は190人となっているけど、実際に zoom に参加していた人の最高値は110人ぐらいだったかな。190 * 0.6 = 114 なので無料イベントの参加者数は6割前後の法則に合致する。人数が増えるほどこの法則は精度が高いように思う。発表者は3人いて、私は2番目に発表して、持ち時間は30分だった。録画していたので後でアーカイブをみれるようにするみたい。私は録画否定派で録画すると参加者がオンタイムで見なくなるのと、いつでも見れるものは見ないということもあるので勉強会のレベルは録画しなくてもいいんじゃないかと考えている。もちろん大きなカンファレンスは録画があった方が参加できない人も後から興味のある発表を見返せていいとは思う。25分発表で質疑応答5分で発表の時間配分はうまくいった。あまり準備できなかった割には伝えたいことはだいたい話せたと思う。なんか質疑応答で「カザモリ社は python のお仕事を受けてくれますか？」といった質問があってちょっと驚いた。ここ数年 python をメインにしたお仕事してなくて、仕事は java, go が多いと言っているせいか、python の仕事はやってないようにみえてしまうのかもしれない。python, java, go の3つの言語のお仕事は受けますよと回答した。発表終わってから1時間ほど懇親会をした。ほとんどコミュニティの主催者と発表者で雑談してた。久しぶりに外部の勉強会でいろんな人とお話することができて楽しかった。たまには外に出かけていくことに重要性も認識できた。またネタがあったら発表したいなとは思う。</p>
<h2 id=呑み>呑み</h2>
<p>懇親会が終わったのが22時で、疲れと空腹から仲のよい焼き鳥屋さんのお店に寄って晩ご飯を食べることにした。時短が終わっているので22時からでも飲みに行ける。お店は翌2時まで営業している。22時過ぎに行ったらお客さんは誰もいなくて、野菜サラダと焼き鳥を注文してマスターと雑談してた。</p>
<p>時短が終わってから景気はどうかを聞いてみると、まだまだお客さんの戻りはコロナ前とくらべてまだまだだという。0時まわってから他の飲食店で働いている人たちが店内を埋まるぐらいは来てくれていたそうだけど、まだまだ余裕がないのか全然戻ってきてないと話されていた。0時半頃に2人組で「○○さんの紹介で来ました」みたいな既に酔っ払っているお客さんが来たりして、終電終わってからこういうお客さんが来たりしていたんだなと雰囲気は理解できた。マスターも2時に閉店して5時まで開いている他の飲食店に飲みに行くと話してた。そうやってお互いにお店に飲みに行って付き合いのようなものができているんだというのが理解できた。どこかのスナック行って3万円ほど使っても、必ずそのスナックの人がお店に来てくれて3万円以上使ってくれるという。お金をまわすってそういうことなんやなとマスターの話しを聞いていて理解できた。自分のお店を2時に閉店して、5時まで飲み歩いて、それから寝てまた次の日に仕事というのは体力的にすごくしんどそうで、マスター自身もコロナ明けは体調をみながら飲み歩いているとも話されてた。結局、2時前までマスターと雑談してて、私も22時から4時間弱ほど居座ってた。久しぶりに外で飲んでハイになっていたかもしれない。</p>
<p>マスターのお勧めで <a href=https://www.hamadasyuzou.co.jp/daiyame_brand>だいやめ</a> という芋焼酎をお湯割りで飲んだ。香熟芋という珍し？芋を使っていて、ライチのような香りのする芋焼酎でおいしかった。お土産によさそうなので覚えておこうと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1108/>Kubernetes 使い始めの雑感</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-08
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;
</span>
<div class=post-content>
<p>1時に寝て7時に起きた。夜にウォーキングし始めてからよく眠れるようになった気がする。</p>
<h2 id=udemy-kubernetes入門>udemy: Kubernetes入門</h2>
<p><a href=/diary/posts/2021/1107/#udemy-kubernetes入門>昨日</a> の続き。今日はセクション6から最後まで。CI/CD のセクションだけスキップして、他は一通り目を通した。</p>
<h3 id=セクション6-kubernetes実践>セクション6 Kubernetes実践</h3>
<p>1つずつ書くのは大変だけど、数をこなして徐々に覚えていけばよい。手で書くのもよいが、別のやり方としてクライアント側で dry run すると、設定のひな型を作ってくれるのでそれに必要な設定を足すのもよい。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl create deploy mysql --image<span style=color:#f92672>=</span>mysql:5.7 --dry-run<span style=color:#f92672>=</span>client -o yaml
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl exec -n database -it mysql-787f86d65c-nflxx -- mysql -uroot -ppassword
</code></pre></div><p>データベースとアプリケーションを異なる namespace にデプロイして、それらが通信できるような設定を行う。基本的には <code>--dry-run=client</code> でひな型を作りつつ、必要な設定を追加していくやり方が簡単そうにみえた。とはいえ、実際に設定していくときはどういう設定を追加するとどういう振る舞いになるかを調べながら作業すると思うのでこんな簡単にはできないとは思う。次のようなアプリケーションをデプロイする一覧の流れを理解できた。</p>
<ol>
<li>namespace 作成</li>
<li>Deployment 作成</li>
<li>ConfigMap 作成</li>
<li>Secret 作成</li>
<li>Deployment, ConfigMap, Secret 適用</li>
<li>Service 適用</li>
<li>port-forward でローカルからアクセス</li>
<li>(作成したリソースをすべて削除)</li>
</ol>
<h3 id=セクション7-kubernetesのdebug>セクション7 KubernetesのDebug</h3>
<p>基本は pod のステータスを確認しながら問題があれば、その箇所を追いかけていって原因を調査する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get pod -A
$ kubectl get pod -A --selector run<span style=color:#f92672>=</span>nginx
</code></pre></div><p>k8s 上で実行しているアプリケーションの依存先へ接続できない場合は Service の確認が必要となる。kubectl の get, describe, logs などのサブコマンドをあれこれみながらエラーの原因を把握して、yaml の設定を変更していく。k8s のアーキテクチャとコマンドを覚えていないとなかなか難しそう。</p>
<p>とりあえず動かした後にまとめて全部削除できるのがテストやデバッグに便利そう。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl delete -f .
</code></pre></div><p>もしくは開発用に独自の namespace を作成して、あとで丸ごと namespace を削除するのでもよさそう。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl delete ns mynamespace
</code></pre></div><h2 id=k8s-の調査>k8s の調査</h2>
<p>業務のアプリケーションを minikube で作ったローカル k8s クラスターで動かしてみた。ローカルの開発環境の構築方法をメンテナンスして、自分でも一通り k8s の yaml を書いて、デプロイして、振る舞いを確認したりしていた。最初なのでおもしろい。自分で一通りやってみて、k8s が難しいとみんなが言っているのは k8s クラスターを自前で構築するのが難しいのだとようやく理解できた。k8s クラスターがすでにある状態なら kubectl の使い方を覚えるだけで全く難しくない。GKE や EKS を使って運用するなら k8s の運用コストは大したことがないと理解できた。k8s クラスター向けの yaml はたくさん書かないといけないけど、どうせ ECS や EC2 でやっていても CDK や Terraform などのインフラ設定を書くのは同じなのでそこはあまり差がない。k8s はコンテナオーケストレーションをやってくれるメリットが大きいので minikube と EKS の環境の差異があまり問題にならないようなアプリケーション開発であれば、普通に使っていって問題ないように思えた。ローカルで環境作るのが大変なんじゃないかという先入観があったけど、全然そんなことはなかった。コンテナのイメージをビルドしないといけないのが追加のコストかな。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1107/>普通の休日の翌日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-07
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/bizpy/>bizpy</a>&nbsp;
#<a href=/diary/tags/kubernetes/>kubernetes</a>&nbsp;
</span>
<div class=post-content>
<p>5時に寝て10時に起きた。昨日は夕方に2-3時間寝てたのでその分、夜に調べものをしていた。休みたい気持ちもあるけど、調べるものが多過ぎて全然時間が足りない。</p>
<h2 id=bizpy-勉強会の資料作り>bizpy 勉強会の資料作り</h2>
<p><a href=/diary/posts/2021/1106/#slack-apps-の調査>昨日</a> の続き。昨日サンプルコードを実装したので、その設定や要点を <a href=https://github.com/t2y/python-study/tree/master/BizPy/slack/20211027>資料</a> に作成した。現時点で <a href=https://bizpy.connpass.com/event/229091/>Python で Slack のインテグレーションをやってみる勉強会 #2</a> の参加者は10人。連続シリーズは回を重ねるごとに減っていくものなのでこんなもんかな。あともう1回やったら終わりにする。</p>
<h2 id=udemy-kubernetes入門>udemy: Kubernetes入門</h2>
<p>友だちから udemy の k8s のコースがよいと聞いたんだけど、そのコースはいまは提供されていなくて、せっかくなので適当に検索してヒットした <a href=https://www.udemy.com/course/kubernetes-basics-2021/>Kubernetes入門</a> を受講することに決めた。本当は英語の本格的なコースを受講した方がよいのだろうけど、余裕のあるときはそれでいいけど、いま数日で概要を把握して使えるようにしたいので日本語のコースにしてみた。</p>
<ul>
<li><a href=https://blog.ayakumo.net/entry/2018/01/27/010000>Udemy の Learning Docker and Kubernetes by Lab がとてもよい</a></li>
<li><a href=https://blog.ayakumo.net/entry/2018/02/15/232918>Docker, Kubernetes 学習とツールとコンピュータサイエンス</a></li>
</ul>
<p>昨日インストールした minikube のクラスターを使って「Kubernetes入門」のセクション1からセクション5までやった。だいたい半分ぐらい。所感としては、全く何も知らない人には要点をかいつまんで教えてくれるのと、最初に覚えるとよい基本的な CLI のコマンドとその振る舞いや設定を紹介してくれるのでよかった。初めて k8s に挑戦する自分にとってはちょうどよいレベル感だった。全体像の概念を捉えてコンテキストに沿って順番にハンズオン形式で学習していくスタイル。<a href=https://github.com/nakamasato/kubernetes-basics>nakamasato/kubernetes-basics</a> を使って自分でも CLI でコマンドを打ちながら進めてみた。yaml ファイルを定義するのもこれはこれで面倒だけど、この辺は慣れの問題かな？とも思う。いくつか学んだことを整理しておく。</p>
<h3 id=セクション1-introduction>セクション1 Introduction</h3>
<p>k8s には2つのコンポーネントがあり、これを k8s クラスターと呼んでいる。</p>
<ul>
<li>Control Plane (API サーバー)</li>
<li>複数の Worker (Kubelet)</li>
</ul>
<p>yaml で設定する Desired State (理想状態) と呼ばれる設定が登録されると、Control Plane の API サーバーと Worker の kubelet が通信してそれを実現しようとする。pod とは k8s のデプロイの最小単位となる。コンテナ、ポート、レプリカ数などを設定する。pod をそれぞれの Worker にデプロイしたり、Worker がダウンしたときに別の Worker で起動させたりする。</p>
<h3 id=セクション2-kubernets-概要>セクション2 Kubernets 概要</h3>
<p>k8s はコンテナ化したアプリケーションのデプロイ、スケーリング、管理を行うためのオープンソースのコンテナオーケストレーションシステムである。</p>
<ul>
<li>コンテナ
<ul>
<li>独立した環境でアプリケーションを実行する仕組み</li>
<li>コンテナの実態はプロセス</li>
<li>Kernel Namespaces を利用し、プロセスID、ネットワークインターフェース、リソースなどを分離してコンテナ間で干渉しない</li>
<li>ホストマシンへの依存度を最小化してアプリケーションをどこでも実行可能にする
<ul>
<li>従来のやり方の最大の違いはライブラリがホストマシンにインストールされるのではなく、コンテナの内部にインストールされる</li>
</ul>
</li>
</ul>
</li>
<li>オーケストレーション
<ul>
<li>デプロイ、スケーリング、管理などの仕組み</li>
</ul>
</li>
</ul>
<p>1つのアプリケーションは複数のマシン上で動かすことで可用性を高めたいが、コンテナを動かすために考えることが増えていくと管理コストも増えていく。コンテナオーケストレーション機能により次のようなシステム管理者が行っていたことが自動化される。</p>
<ul>
<li>デプロイメント</li>
<li>スケジューリング</li>
<li>オートスケーリング
<ul>
<li>負荷に応じてコンテナ数やマシン数を増減させる</li>
</ul>
</li>
<li>ネットワーク</li>
<li>リソースマネジメント</li>
<li>セキュリティ
<ul>
<li>ネットワークポリシーやリソースの権限定義</li>
</ul>
</li>
</ul>
<p>k8s クラスターの構造は次になる。</p>
<ul>
<li>Control Plane
<ul>
<li>api: kubelet と通信するサーバー</li>
<li>etcd: 設定などを格納するキーバリューストア</li>
<li>shed: kube スケジューラー</li>
<li>c-m: コントロールマネージャー</li>
<li>c-c-m: クラウドプロバイダと api 連携する
<ul>
<li>ローカルで使うときは必要ない</li>
</ul>
</li>
</ul>
</li>
<li>Worker ノードはコンテナランタイムをいインストールしておく必要がある
<ul>
<li>kubelet は Control Plane と通信するためのエージェントとして動作する</li>
</ul>
</li>
</ul>
<p>一番需要なこととして、k8s は理想状態と現実状態を比較して、理想状態に近づけようとする。app.yaml の理想状態を kubectl を用いて api サーバーを介して etcd に格納する。現実状態は kubelet から api サーバーを介して etcd に格納される。c-m は理想状態と現実状態のチェックを行い、異なっていれば理想状態に近づけることをしていく。</p>
<h3 id=セクション4-kubectl>セクション4 kubectl</h3>
<p>minikube で最初に起動しているのは Control Plane を起動していることが理解できた。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ minikube start
$ kubectl config current-context
minikube
</code></pre></div><p>同時に ~/.kube/config に kubectl の設定も追加される。<code>minikube</code> という名前でクラスター、ユーザー、コンテキストが設定される。</p>
<p>リソース一覧の確認。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl api-resources
</code></pre></div><p>出力フォーマットも様々。例えば、デフォルトの表示は次になる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get node
NAME       STATUS   ROLES                  AGE     VERSION
minikube   Ready    control-plane,master   7m21s   v1.22.2

$ kubectl get node -o wide
NAME       STATUS   ROLES                  AGE     VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME
minikube   Ready    control-plane,master   8m38s   v1.22.2   192.168.49.2   &lt;none&gt;        Ubuntu 20.04.2 LTS   5.11.0-38-generic   docker://20.10.8
</code></pre></div><p>より詳細な情報をそれぞれのフォーマットで表示する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get node -o json
$ kubectl get node -o yaml
</code></pre></div><p>namespace を確認する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get namespace
NAME              STATUS   AGE
default           Active   10m
kube-node-lease   Active   10m
kube-public       Active   10m
kube-system       Active   10m
</code></pre></div><p>namespace を指定して pod 一覧を取得する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get pod --namespace kube-system
NAME                               READY   STATUS    RESTARTS      AGE
coredns-78fcd69978-qxqbn           1/1     Running   <span style=color:#ae81ff>0</span>             11m
etcd-minikube                      1/1     Running   <span style=color:#ae81ff>0</span>             11m
kube-apiserver-minikube            1/1     Running   <span style=color:#ae81ff>0</span>             11m
kube-controller-manager-minikube   1/1     Running   <span style=color:#ae81ff>0</span>             11m
kube-proxy-g55hg                   1/1     Running   <span style=color:#ae81ff>0</span>             11m
kube-scheduler-minikube            1/1     Running   <span style=color:#ae81ff>0</span>             11m
storage-provisioner                1/1     Running   <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>10m ago<span style=color:#f92672>)</span>   11m
</code></pre></div><p>グローバルな CLI のオプションを確認する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl options
</code></pre></div><p>ノードの詳細を表示する。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl describe node
</code></pre></div><p>describe は名前の接頭辞を指定できるので namespace ならこんな感じに実行できる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl describe namespace kube-
</code></pre></div><h3 id=セクション5-kubernetes-リソース>セクション5 Kubernetes リソース</h3>
<p>pod とは k8s 上のデプロイの最小単位である。</p>
<ul>
<li>1つまたは複数のコンテナをもつ</li>
<li>ネットワークやストレージを共有リソースとしてもつ</li>
<li>コンテナの実行方法に関する仕様をもつ</li>
</ul>
<p>pod が使えなくなった場合に他のノードにデプロイされることもある。1つのアプリケーションを複数の pod でデプロイすることが多い。なるべく複数のアプリケーションを1つの pod に入れない。個別の pod を直接操作しない。</p>
<p>共有コンテキスト</p>
<ul>
<li>同一 pod 内のコンテナは同じストレージにアクセスできる</li>
<li>同一 pod 内のコンテナは ip アドレスとポートを含むネットワーク名前空間を共有する</li>
</ul>
<p>k8s オブジェクト</p>
<ul>
<li>クラスタの状態を表現する</li>
<li>2つのフィールドをもつ
<ul>
<li>spec: 理想状態 (desired status)</li>
<li>status: 現実状態 (current status)</li>
</ul>
</li>
</ul>
<p>pod の作成は k8s オブジェクトを作成している。オブジェクト作成時の必須フィールドが4つある。</p>
<ul>
<li>apiVersion</li>
<li>kind</li>
<li>metadata</li>
<li>spec</li>
</ul>
<p>namespace は同一クラスター上で複数の仮想クラスターの動作をサポートする。</p>
<ul>
<li>仮想クラスターとは、物理的には同じマシンで動いているかもしれないが、仮想的に環境を分離している
<ul>
<li>1つのクラスターを論理的にわける</li>
<li>チームや部署ごとにわけて使い分けたりすることも多い</li>
</ul>
</li>
</ul>
<p>namespace を使うメリットは次になる。</p>
<ul>
<li>pod やコンテナのリソースの範囲設定</li>
<li>namespace 全体の総リソース制限</li>
<li>権限管理</li>
</ul>
<p>初期の namespace として4つあるが、初心者は最初の2つだけをまず覚えておく。</p>
<ul>
<li>default:</li>
<li>kube-system:</li>
<li>kube-public:</li>
<li>kube-node-lease</li>
</ul>
<p>namespace と cluster の違い。</p>
<ul>
<li>Namespace-scoped リソース
<ul>
<li>namespace に属しているリソース</li>
</ul>
</li>
<li>Cluster-scoped リソース
<ul>
<li>クラスター全体で使われるもの</li>
</ul>
</li>
</ul>
<p>次のコマンドで確認できる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl api-resources --namespaced<span style=color:#f92672>=</span>true 
</code></pre></div><p>namespace の作成</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl create namespace my-namespace
</code></pre></div><p>ワークロードリソースとは複数の pod を作成・管理するためのリソース。ワークロードリソースは pod テンプレートを使って pod を作成する。</p>
<ul>
<li>ReplicaSet
<ul>
<li>常に指定したレプリカ数の pod を保つ</li>
</ul>
</li>
<li>Deployment
<ul>
<li>ローリングアップデートやロールバックなどのアップデート機能を提供</li>
<li>ReplicaSet のロールアウト</li>
<li>不安定な場合の前のバージョンへロールバック</li>
<li>使用頻度が高い
<ul>
<li>ほとんどのアプリケーションは Deployment で管理</li>
</ul>
</li>
</ul>
</li>
<li>Secret
<ul>
<li>機密情報を保存・管理し、Pod から参照可能</li>
<li>主な使用方法としてコンテナの環境変数の設定
<ul>
<li>アプリケーションの DB のパスワードなどに使う</li>
</ul>
</li>
</ul>
</li>
<li>Service
<ul>
<li>pod の集合を抽象化して公開する
<ul>
<li>pod の集合に対する DNS 名</li>
<li>pod の集合に対する負荷分散</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1106/>普通の休日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-06
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/saying/>saying</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て5時半に起きたが、休日だからゆっくりするかと思って二度寝して8時に起きた。知人のタイムラインで紹介されていていい言葉だなと思ったので書いておく。日記があるとこういう流れていくちょっとしたことを書く場所にもなるな。コミュニティ活動の本質はこれなんじゃないかという気もする。</p>
<blockquote>
<p>自分にまったく利益をもたらさない人間を、どう扱うかでその人がどんな人間かがはっきりわかる</p>
<p><a href=https://ja.wikipedia.org/wiki/%E3%82%B5%E3%83%9F%E3%83%A5%E3%82%A8%E3%83%AB%E3%83%BB%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%BD%E3%83%B3>サミュエル・ジョンソン</a></p>
</blockquote>
<h2 id=ストレッチ>ストレッチ</h2>
<p>今週もジョギングの代わりにウォーキングをしてた。ジョギングやると筋肉痛や疲労から他の日を休みがちになるけど、ウォーキングならジョギングよりは継続しやすい。今週は4-5日ほど歩いた。ただストレッチはさぼってて2日しかできなかった。ウォーキングのせいかわからないけど、右足太もも後ろの筋が張るようになった。ストレッチを始めてから日々の運動や生活の変化と関節や筋肉の張りが変化するのも意識するようにもなってきた。今日の開脚幅は開始前167.5cmで、ストレッチ後168cmだった。前週よりは数値がよくなっているのでこんなもんかもしれない。</p>
<h2 id=神戸のコワーキングスペースの半歩先の未来を考える>神戸のコワーキングスペースの半歩先の未来を考える</h2>
<p>たまたまタイムラインでみかけたので <a href=https://2021.078kobe.jp/events/16089/>神戸のコワーキングスペースの半歩先の未来を考える</a> を視聴していた。私はシェアオフィスとコワーキングスペースが併設された場所で働いているのでテーマには関心がある。途中からだけど、13時半から15時までみていた。</p>
<p>第一部はコワーキングスペースの運営者が登壇して、どちらかというそれぞれの運営者がやっていることの、宣伝的な要素が強かったように思う。ある運営者が起業家を育てるのは大学生からでは遅くて、保育園から起業家教育をしているという話題があった。そこで何を教えているかというと、子どもの頃から徹底的に自己肯定感を高めるための教育をしているらしい。たまたま <a href=https://studyhacker.net/self-esteem-high>自己肯定感が高い人の4大特徴が明らかに！</a> の記事をみたら、自己肯定感が高い人は他人も肯定するという内容がある。たしかに日本/日本人の同調圧力は異質なものを拒む傾向があると考えると、自己肯定感の高低がそういった文化の背景にも現れているのかもしれないと思えた。</p>
<p>第二部はコワーキングスペースの利用者として、二地域居住シェアハウスプロジェクトの研究/実践をしている佐藤さんと、メディアアートをされている <a href=https://www.nobumichiasai.com/>浅井宣通</a> さんが登壇していた。佐藤さんが冒頭でコワーキングスペースにはびっくりするほどすごい人がいるみたいな話しをした後で、浅井さんが登場するといった流れが偶然できてて、ほんとだ、これはすごいとなったw 浅井さんはメディアアートを言葉で説明しても伝わりにくいので動画でみてもらうようにしていると話されていた。私もみてこれはすごい人だとすぐに理解できた。私が興味をもつ作品だと <a href=http://www.sign.site/koukaku_vr/>攻殻機動隊 新劇場版Virtual Reality Diver</a> の Creative Director も務められたらしい。企業やイベントの PR のための映像で浅井さんが手伝っている作品はいくつもあるそうだ。</p>
<p>浅井さんは東京を脱出したいという想いがずっとあって、コロナでリモートワークが普通になり、奥さんの実家の須磨に引っ越してきたらしい。ただ自身は神戸にはほとんど知り合いがいない状態でコワーキングスペースを利用しているうちに、人を紹介してもらって人脈を形成することができたという。東京は大半が地方から出てきた人たちの集まりなので必然として孤立しており、競争関係になってしまうという。神戸の人たちは地元で育ってそのつながりが強いという違いを感じているらしい。地元の人なので協力の関係を築きやすい。コワーキングスペースがその触媒になっていると話されていた。人がつながるには、場所や触媒が必要でコミュニティマネージャーもそういった役割を担っていて大事だという。</p>
<p>多様性は大事だが、多様性だけでも人のつながりができない。同じ分野だとライバル関係になってしまったりする。そこで対話の深さが重要だと話されていた。同じ分野であってもお互いが対話を通して理解を深めると、共通項があったり、細かい得意分野が違ったりもする。デザイナー同士がかぶってしまうと、よく競争の関係になってしまうし、全然違う人と話しても話が噛みあわなくて仕事で苦労することもあったという話があった。それで対話の深さが大事ということに気付いたといった話だった。もう1点、おもしろかった話が地元の人は土地への感情として、この場所・土地が好きだという共通項があるので協力の関係を築きやすいのではないかと。東京は多くの人が生まれ育った土地ではないのでそういった感情は抱きにくいが、神戸っ子という言葉があるように神戸の人たちにはそういった土地に根ざした愛着があり、それを媒介につながるのも美しいといったことを話されていた。</p>
<p>第三部はコワーキングスペースを支える人たちとして、<a href=http://cahootz.jp/>カフーツ</a> の伊藤さん、<a href=https://jocr.jp/sunday/repo/1656/>ANCHOR KOBE の立ち上げ</a> に関わった神戸市のイノベーション専門官の松山さん、<a href=https://fixu.jp/>fixU</a> というサービスを提供している山岡さんが登壇していた。</p>
<p>私がもっとも興味深かったのは伊藤さんの話しだったのでそれをまとめておく。コワーキングスペースはただ作業する場所ではなく、課題を解決したい人がいて、それを手伝いたいという人がつながることで価値が生まれるという。長い間、コワーキングスペースに関わってきたことから経験が積み重なってわかってきたことがあると話されていた。「コミュニティはどうやって作るんですか？」という質問に答えるのは難しいものの、その取っ掛かりとして、まず課題をみえる化するのが大事だという話しをされていた。イベントなどで課題を表明して、多くの人たちに知ってもらうことで、その課題の解決に興味をもつ人たちが集まってきて、それが協調となり、コミュニティへとつながっていくという。Facebook 社が Meta 社に社名変更して、Microsoft もそれに追従し、メタバースの話題が盛り上がっている。ビッグワードに流されるつもりはないが、コロナによりオンラインでできることの幅が広いことを、仕事はオンラインでよいと多くの人たちは気付いた。じゃあ人と人との関わりがどんな価値をもつのか、コロナが落ち着いてくる時期 (この先1-2年) でそういう方法論も新たに出てくるんじゃないかとも話されていた。</p>
<h2 id=slack-apps-の調査>Slack apps の調査</h2>
<p>次回の bizpy 勉強会向けに <a href=https://api.slack.com/lang/ja-jp/app-home-with-modal>新機能、アプリのホーム・ヴューを活用しよう🏡</a> を読んで実際に <a href=https://github.com/slackapi/bolt-python>bolt-python</a> やってみた。UI の設定は JSON で記述できるようになっていて、<a href=https://app.slack.com/block-kit-builder/>Block Kit Builder</a> でぽちぽちやるとどんな JSON を書けばよいかのサンプルのペイロードを確認できる。これらの UI に対して操作すると、プログラミングの用語で言えば、すべてイベントが発生してリクエストが届くような仕組みになっている。bolt のコード上ではそれぞれ <code>event</code> と <code>action</code> と <code>view</code> という名前が付いたイベントを扱うことで任意のモーダル画面を表示したり、そのフォームのユーザー入力を取得したりできる。一通りサンプルコードはできた。あとは簡単に資料をまとめるだけ。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1105/>調べものだらけ</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-05
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/rabbitmq/>rabbitmq</a>&nbsp;
#<a href=/diary/tags/dapr/>dapr</a>&nbsp;
</span>
<div class=post-content>
<p>1時半に寝て6時に起きた。昨日の夜はウォーキングして (朝活あるから) すぐに寝たんで早く起きた分、朝からストレッチをしてた。今週はバタバタしていてあまりストレッチできてない。</p>
<h2 id=朝活-ミクロ経済学入門の入門>朝活: ミクロ経済学入門の入門</h2>
<p><a href="https://www.youtube.com/watch?v=33vXvmnAHq0">[金朝ツメトギ] 2021-11-05 AM 6 金曜朝6時開催のもくもく会</a> で第7章の独占と寡占を読んだ。用語を次にまとめる。</p>
<ul>
<li>プライステイカー: 生産量を増やしたり減らしたりしても価格に影響を与えられない会社</li>
<li>完全市場: すべての会社がプライステイカーである市場</li>
<li>不完全市場: 完全市場ではない市場、プライステイカーではない会社がいる</li>
<li>独占市場: 1つの独占企業だけが存在する市場</li>
<li>クルーノー寡占市場: 同じ財を生産する少数の会社の総生産量から市場の価格が決まる市場
<ul>
<li>寡占: 少数の企業がいる市場
<ul>
<li>複占: 企業が2つだけの市場</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>前に出てきた市場均衡の話から、供給量を下げると価格が上昇する。生産者余剰がが大きくなり、生産者は得をする。実際にあった事例として、2016年に石油輸出機構 (OPEC) が石油の減産に合意して価格が上昇した。2012年に豊作だった歳に値崩れが起きるのをおそれて、全国農業組合連合会は価格を上げるために農家に野菜の廃棄処分を要請した。</p>
<p>独占市場にいる会社は高い価格で高い利潤を得ることはできるが、やがて価格競争を仕掛けてくる新規参入者を招き、長期的な利益を低めてしまう懸念がある。一方で高品質な財を低い利潤で販売していると、新規参入者が現れずに長期的な利益を得られる可能性がある。一概にどちらが正しいとは言えない。こうした状況を端的に描く <strong>展開型ゲーム</strong> を考えると、財を高値にするか安値にするかの思考実験ができるう。 <strong>ゲームツリー</strong> という図でこのゲームを表している。</p>
<figure><img src=/diary/img/2021/1105_game-tree.png>
</figure>
<p>A は安値を選び、B が参入しないという選択の組み合わせは、「自分がこう選択したら相手はこう選択してくる」とプレイヤーが予想して、そのうえで自分にとって最も利潤が高まる選択をする状況を表している。これを <strong>サブゲーム完全均衡</strong> の結果と呼ぶ。また、このような推論のやり方を <strong>逆向き帰納法 (バックワード・インダクション)</strong> と呼ぶ。サブゲーム完全均衡の結果は逆向き帰納法により求められる。</p>
<h2 id=rabbitmq-の-dead-letter-exchange-の調査>RabbitMQ の dead letter exchange の調査</h2>
<p>昨日の続き。RabbitMQ には exchange という概念がある。私が過去に使ったメッセージキュー (Kafka, AWS SQS) にはない概念でトピックをグルーピングしたり、メッセージのルーティングを制御する仕組みになる。普通のメッセージキューではデッドレターキューと呼ばれるものが RabbitMQ だと <a href=https://www.rabbitmq.com/dlx.html>Dead Letter Exchanges</a> になる。ドキュメントの概要はこんな感じ。</p>
<blockquote>
<p>次のイベントが発生したときに &ldquo;デッドレター&rdquo; とみなす。</p>
<ul>
<li>consumer が basic.reject または requeue=false の basic.nack を ack で返したとき</li>
<li>メッセージの TTL の期限切れになったとき</li>
<li>queue の最大長さを超えてメッセージが drop されたとき</li>
</ul>
<p>注意事項として queue の有効期限が切れても queue 内のメッセージはデッドレターとならない。</p>
<h4 id=設定方法>設定方法</h4>
<p>デッドレター exchange (DLXs) は普通の exchange であり、普通に宣言して通常の種別をセットする。任意の queue に対して2通りの設定方法がある。</p>
<ul>
<li>クライアント: queue の引数を使って定義する</li>
<li>サーバー: ポリシーを使って定義する</li>
</ul>
<p>詳細は割愛。</p>
<h4 id=ルーティング>ルーティング</h4>
<p>デッドレターメッセージのルーティングは、次のどちらかで行われる。</p>
<ul>
<li>デッドレターの queue に routingKey が設定されていればそれを使う</li>
<li>デッドレターの queue に routingKey が設定されていなければ、オリジナルのメッセージが publish されたときの routingKey を使う</li>
</ul>
<p>例えば、foo という routingKey をもつ exchange にメッセージを publish して、そのメッセージがデッドレターになった場合、foo という routingKey をもつデッドレターの exchange に publish される。もしそのメッセージが x-dead-letter-routing-key を bar にセットした queue に届いた場合は、そのメッセージは bar という routingKey をもつデッドレター exchange に publish される。</p>
<p>queue に特定の routingKey が設定されていなかった場合、その queue のメッセージは、すべてオリジナルの routingKey でデッドレター化されることに注意してください。これには CC および BCC ヘッダによって追加された routingKey も含む (詳細は割愛) 。</p>
<p>デッドレターメッセージが循環する可能性がある。例えば、queue がデッドレター用のルーティングキーを指定せずに、デフォルトの exchange にメッセージをデッドレターした場合などに起こる。このとき同じ queue に2回届いたメッセージは no rejections in the entire cycle だった場合にドロップされる。</p>
<h4 id=安全性>安全性</h4>
<p>デッドレターメッセージは内部的に publisher confirm を行わずに re-publish される。クラスタ環境の rabbitmq でデッドレターキューを使ったとしても安全性は保証されない。メッセージはデッドレターキューの対象の queue に publish された後でオリジナルの queue からは削除される。このときに対象の queue が受け取れなければメッセージがなくなってしまう可能性がある。</p>
<h4 id=デッドレターメッセージの副作用>デッドレターメッセージの副作用</h4>
<p>デッドレターメッセージはヘッダーを変更する。</p>
<ul>
<li>exchange の名前がデッドレター exchange の名前に置き換わる</li>
<li>routingKey がデッドレターキューの routingKey に置き換わる可能性がある</li>
<li>↑ が起きると、CC ヘッダーが削除される</li>
<li>Sender-selected Distribution ごとに BCC ヘッダーは削除される</li>
</ul>
<p>デッドレターの処理では x-death という名前の配列を、それぞれのデッドレタリングされたメッセージのヘッダに追加する。この配列には {queue, reason} のペアで識別される各デッドレタリングイベントのエントリが含まれる。詳細は割愛。</p>
</blockquote>
<h2 id=dapr-の調査>dapr の調査</h2>
<p><a href=https://docs.dapr.io/>dapr</a> について調べた。dapr は分散システム (アプリケーション) の複雑さを解決することを目的としている。様々なミドルウェア (分散システム) とのやり取りを http/grpc の api 呼び出し経由にして、その詳細を隠蔽する。ミドルウェアの上位に抽象化レイヤーを設けて統合的なインターフェースを提供したり、それぞれのミドルウェアにおける設定や運用の面倒なことなどを簡略化してくれる。サイドカーパターンを採用しているので言語に依らず、アプリケーションに dapr のコードを書く必要もない。dapr cli をインストールして dapr init すると docker で dapr プロセスが動いて、それだけで dapr にリクエストできるようになる。使い始めの学習コストは低いし、デプロイも簡単だし、意図している目的もわかりやすい。マイクロソフト社がスポンサーしていてプロジェクトの運営も安定してそうだし、おもしろいツールだと思う。</p>
<h2 id=k8s-の調査>k8s の調査</h2>
<p>せっかくの機会なのでちゃんと勉強することにした。今日は <a href=https://github.com/kubernetes/minikube>minikube</a> の <a href=https://minikube.sigs.k8s.io/docs/start/>Get Started!</a> やっただけ。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1104/>新しい職場で働き始め</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-04
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/subcontract/>subcontract</a>&nbsp;
</span>
<div class=post-content>
<p>0時に寝て6時半に起きた。朝活の日以外に6時に起きるのは難しいけど、だいたい6-7時の間には起きているような気がする。とはいえ、休日は8時に起きたりもしてたけど。<a href=/diary/posts/2021/1025/>10月25日</a> から生活リズムの移行を促してちょっとずつ近づいている気はする。</p>
<h2 id=働き始め>働き始め</h2>
<p>今日から新しい職場で働き始め。3ヶ月ほど自社のお仕事をしていたが、ずっとやっていると会社が倒産するので出稼ぎに行くことに決めた。まずは開発の定例会議に出てみた。最初なんで話していることがなんもわからん。3ヶ月ぐらいは業務のキャッチアップに集中する。intellij idea のコードフォーマッターで開発しているそうなので intellij idea を使うことにした。eclipse をやめて vscode に移行したいとは思っていたが、コードフォーマッターの問題は厄介なので仕方ない。コミュニティエディションを使う。</p>
<p><a href=https://www.rabbitmq.com/tutorials/tutorial-one-java.html>RabbitMQ のチュートリアル</a> を1から5までやった。チュートリアルのサンプルコードはそのままだけど maven でビルドできるようにして <a href=https://github.com/t2y/rabbitmq-sample>https://github.com/t2y/rabbitmq-sample</a> に置いた。今日のところはチュートリアルに書いてあることの振る舞いなどを確認していた。なんか調査や検証するときにまた使うと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1103/>ASUS ROG Zephyrus G15 GA503QR</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-03
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;
</span>
<img src=/diary/img/2021/1103_rog-zephyrus-g15.jpg class=post-cover alt="ASUS ROG Zephyrus G15 GA503QR">
<div class=post-content>
<p>1時に寝て6時に起きた。朝活があると起きれるな。</p>
<h2 id=朝活-ミクロ経済学入門の入門>朝活: ミクロ経済学入門の入門</h2>
<p><a href=https://kobe-sannomiya-dev.connpass.com/event/229642/>【三宮.dev オンライン】リモート朝活もくもく会</a> で第5章の市場均衡と第6章の外部性を読んだ。</p>
<p>まず第5章から。用語を次にまとめる。</p>
<ul>
<li>完全市場: 誰もがプライステイカー (自分の生産量が価格に影響を与えられない) である市場</li>
<li>社会的余剰: 消費者余剰 (価格より多めに払ってよいと考える金額の和) と生産者余剰 (利潤の和) を足し合わせたもの</li>
<li>従量税: 販売する量に応じて一定の金額を納める税
<ul>
<li>例) たばこ税、酒税、揮発油税 (ガソリン)</li>
</ul>
</li>
</ul>
<p>これまでの章で学んだ内容から価格は需要曲線Dと供給曲線Sが交差する点p*になる。この価格を <strong>市場均衡価格</strong> と呼ぶ。市場全体のよさを測るモノサシとして <strong>社会的余剰</strong> を使う。市場均衡価格に対して価格を上げたり下げたりしたときにできる社会的余剰の差額を <strong>死荷重</strong> と呼ぶ。次の図の C の面積に相当する。</p>
<figure><img src=/diary/img/2021/1103_market-equilibrium.png>
</figure>
<p>図から市場均衡価格は社会的余剰を最大化させた価格だとわかる。</p>
<p>生産者や消費者に従量税を課すと市場にどのようなことが起きるかを考察する。納税方法として、生産者が納税する方式 (価格に税を含める) と消費者が納税する方式 (価格と税は別) があるが、どちらも社会的余剰が C の分だけ減少するグラフとなり、社会的損失が発生していると言える。余剰の視点からはどちらの方式も全く同じだが、政府が徴税するしやすさの視点だと、相対的に数の少ない生産者から納税する方が管理しやすい。</p>
<figure><img src=/diary/img/2021/1103_specific-duty.png>
</figure>
<p>狙い撃ち課税のダメな点として酒税を例にあげている。ビールの酒税を逃れるために、メーカーは1990年代に発泡酒、2003年に第3のビールを開発した。2016年時点での350ml (1缶) あたりの酒税は、ビール77円、発泡酒47円、第3のビール28円となった。同年、政府はすべて55円へ統一していく方針を発表した。ビールへの従量税が与えた社会的損失として死荷重だけでなく、発泡酒や第3のビールのような劣化ビールの技術開発のコストがあげられる。特定の品目を狙い撃つ従量税は社会的損失を生みやすいと述べられてる。</p>
<p>次に第6章から。用語を次にまとめる。</p>
<ul>
<li>負の外部性: ある生産活動が他者へマイナスの影響を与える
<ul>
<li>例) 公害や花粉症など</li>
</ul>
</li>
<li>正の外部生: ある生産活動が市場取引を経ずにプラスの影響を与える
<ul>
<li>例) 電鉄会社が駅や路線を開通させるとその地域に経済効果をもたらすなど</li>
</ul>
</li>
<li>限界被害: 企業の生産活動が住民に与える被害の生産量に対する総和の金額</li>
<li>ピグー税: 住民に補償を与える環境税</li>
<li>ネットワーク外部性: SNS など、サービスの価値がユーザー数に大きく既存する性質</li>
<li>調整ゲーム: 何を選ぶかよりも、他人と同じものを選ぶことが重要な状況</li>
<li>ナッシュ均衡: 自分の行動を変えると損になるので誰も行動を変えない状況</li>
</ul>
<p>企業の生産活動が住民に被害をもたらせていた場合、その被害をピグー税を通じて企業が支払う。これを <strong>外部性の内部化</strong> と呼ぶ。負の外部性は社会問題となるが、対して正の外部性は社会問題とならない。</p>
<p>調整ゲームにおいて、一方がもう一方よりも好ましい状態を <strong>パレート優位</strong>、またその逆の状態を <strong>パレート劣位</strong> と呼ぶ。ネットワーク外部性においては優勝劣敗が必ずしも正しいとは限らない。先行者としてユーザー数を獲得し、ナッシュ均衡の座をつかむことが勝ちにつながる。</p>
<h2 id=asus-rog-zephyrus-g15-ga503qr>ASUS ROG Zephyrus G15 GA503QR</h2>
<p>今日届いたのでセットアップだけ終えた。Windows アップデートすると次々に更新が出てくる仕組みは昔と変わってなかった。4回再起動した。</p>
<p>前々から Windows マシンがほしいと思っていて、次のお仕事が決まったので思い切って購入することにした。買おうかどうしようかを迷っている心の中の動きのコストというか、検討事項としてずっと残り続けるのもあまり生産的ではないなと最近は思うようになっていた。私が Widnows マシンが必要になった背景はこれら。</p>
<ul>
<li>行政の電子申請・手続きはまだまだ Windows アプリが主流</li>
</ul>
<p>最近は Windows アプリ版とは別に、Web 版というブラウザベースのアプリケーションが提供されつつあるが、まだまだ黎明期で一部の機能しか対応してなかったり、不具合で macos だと動きませんと障害情報が出てたり、ひどい場合だとブラウザベースなのに Linux はサポートしてませんとか言われたりする。毎年この申請は Web 版で対応したやろか？と調べて、やっぱりまだできんかったと紙ベースの申請に切り替えるときの、調べるコスト (とがっかりするコスト) がしんどくなった。</p>
<ul>
<li>VR 系アプリケーションのプラットフォームは Windows</li>
</ul>
<p>Facebook 社が Meta 社になって、ややメタバースが盛り上がりをみせつつある。<a href=https://www.oculus.com/quest-2/>Oculus Quest 2</a> を買ったものの、VR 系アプリケーションは Windows がメインターゲットらしく macos や linux は、現時点ではサポートしていないことが多い。<a href=https://www.oculus.com/accessories/oculus-link/>Oclus Link</a> も Windows しかサポートしていない。せっかくヘッドマウントディスプレイを購入したので、そのデバイスをもっと活用するためにも Windows マシンがあった方がよいと考えた。</p>
<ul>
<li>Microsoft Teams を使いたい</li>
</ul>
<p>私の周りでも <a href=https://www.microsoft.com/ja-jp/microsoft-teams/group-chat-software>Microsoft Teams</a> を使うことが増えてきた。ゲストアカウントでも会議できるのでエージェントと打ち合わせするときは Teams を使ったりしていた。社内システムを MS 系のプロダクトで固めている企業は普通に Teams を使っているし、顧問さんから聞く話しでも Teams (と MS 製品とのインテグレーション) の評判はよい。チャットツールを対象としたプロダクトを作っていくにあたり、今後は Slack だけではなく Teams 対応も必須になっていく気がする。実際に私も Slack/Teams 両対応のプロダクトもみかけるようになりつつある。Microsoft Teams を Linux で使えるかどうかは調べてないのでわからないけど、Windows マシンが1台あった方が手っ取り早いと考えた。</p>
<ul>
<li>オフィスと自宅にパソコンを据え置きたい</li>
</ul>
<p>オフィスでは普段デスクトップマシンを使いつつ、macbook をサブマシンとして使っている。自宅で作業するときは macbook を持ち帰ったりしていた。人間はどんどん怠惰になるのでこの持ち運びが面倒になってきたり、持ち帰ってないときにパソコンで作業したくなったりしたときは、オフィスに出かけるといったことをするようになってストレスにもなってた。徒歩でも15分あれば行ける場所にオフィスがあるので、タブレットやスマホでの作業効率を考えたらオフィスに行ってしまう。ラップトップを自宅とオフィスに置いておけるといいなぁとは薄々思っていた。これを機にオフィスには asus マシンを、自宅には macbook を据え置くようにしたい。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>9.4 分散トランザクションと合意の前半の2つの節を読んだ。</p>
<ul>
<li>9.4.1 アトミックなコミットと2相コミット（2PC）</li>
<li>9.4.2 分散トランザクションの実際</li>
</ul>
<p>分散トランザクションという扱っているテーマが難しいけど、書いてある内容は1つずつ追っていけば理解できるのでそこまで難しくはない。一言で分散トランザクションと言っても次の2つに大別される。</p>
<ul>
<li>データベース内部の分散トランザクション</li>
<li>ヘテロジニアスな分散トランザクション</li>
</ul>
<p>前者は特定のデータベースシステムだけで動くので相対的に最適化ができたり、うまく運用できるケースもある。後者は複数のシステムを介した汎用の仕組みになるので2相コミットのような プロトコル を使って <strong>アトミックなコミット</strong> を保証しなければならない。2PC はコーディネータの障害が運用上の大きな問題となることがわかっている。ヘテロジニアスな技術間での2相コミットの標準を <strong>X/Open XA（eXtended Architecture の省略）</strong> と呼ぶ。多くの RDB やメッセージブローカーでもサポートされているらしい。Java EE アプリケーションの世界だと Java Transaction API （ JTA ）で実装されているらしい。全く聞いたことがなくて、私はいままでこの技術に関わることがなかった。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1102/>ワイヤレス REALFORCE</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-02
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;
#<a href=/diary/tags/subcontract/>subcontract</a>&nbsp;
</span>
<img src=/diary/img/2021/1102_realforce.jpg class=post-cover alt="ワイヤレス REALFORCE">
<div class=post-content>
<p>3時に寝て7時に起きた。ウォーキングから帰ってきて0時にベッドに入ったものの、選挙結果の総括記事を読んだり、<a href=http://yorimoi.com/story/>宇宙よりも遠い場所</a> をみたりしていたら3時になってしまった。全13話すべてみた。どちらかと言えばおもしろかったけど、ツィートみて期待値が高かった分、そこまで私の中に響くものはなかったかな。南極へ行く道中や南極の生活がわりと遊んでいるようにみえてあまり大変そうにみえなかった。とはいえ、実際の船上や南極でもやることなくて娯楽ないと持て余すのかなとも思えた。<a href=https://www.nipr.ac.jp/antarctic/>南極地域観測隊</a> って現実にあるんだなとみてた。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>僕はだいたいプログラミングしてるときは既に内容を知ってるアニメを常に流してるんですが今週はまた「宇宙よりも遠い場所」を観ていました。これほどまでに13話すべて足すところも引くところもない完璧な作品は他に早々思いつかないです。</p>&mdash; しろやま (@fushiroyama) <a href="https://twitter.com/fushiroyama/status/1453610090632663048?ref_src=twsrc%5Etfw">October 28, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>9.3 順序の保証を読んだ。</p>
<blockquote>
<p>データベースや分散システムにおいて順序付けは重要な基本的概念である。順序と線形化可能性、合意との間には深い関係がある。順序付けが重要なのは <strong>因果関係</strong> を保つのに役立つことがあげられる。</p>
<p><strong>全順序</strong> があれば任意の2つの数を比較して大小関係を必ず判断できる。たとえば自然数には全順序があると言える。線形化可能なシステムは操作に全順序がある。一方で因果律には並行という概念があり、どちらが先に行われたかが重要ではない場合に操作が並行に行われたとみなせる。したがって、因果律は全順序ではなく、 <strong>半順序</strong> を定義すると言える。半順序とは、大小関係を比較できる場合もあるしできない場合もあることを指す。</p>
<p>因果律に基づく順序と線形化可能性との関係は、線形化可能性は因果関係を <strong>暗に含む</strong> といえる。線形化可能性を持つシステムは、因果律を正しく保持する。しかし、システムを線形化可能にすればパフォーマンスや可用性が損なわれる可能性がある。特にネットワークの遅延が大きい（たとえば地理的に分散している）システムで問題になる。そのため、分散データシステムの中には線形化可能性をあきらめることでパフォーマンスを向上させたものの、扱いが難しいものもある。因果律を保持する方法は、線形化可能性が唯一というわけではなく他の方法もある。多くの場合、システムに本当に必要なのは線形化可能性ではなく因果律における一貫性だけであり、これは線形化可能性よりも効率の良い実装が可能となる。</p>
<p>因果律における一貫性を保持する方法として次のものがあげられている。</p>
<ul>
<li>シーケンス番号またはタイムスタンプ</li>
<li>ランポートタイムスタンプ（Lamport timestamp）</li>
</ul>
<p>しかし、分散システムではネットワークを介して他のノードの状態を確認しないと因果律の一貫性を確定できない。たとえシングルリーダーアプリケーションであっても、リーダーに障害が発生したときにリーダーのフェイルオーバーが必要となる。この問題は <strong>全順序のブロードキャスト</strong> と呼ばれる。ZooKeeper や etcd のような合意サービスが全順序ブロードキャストを実装している。</p>
<p>詳細は省くが、ネットワークを介した分散システムで線形化可能な compare-and-set （あるいは increment-and-get ）を実装しようとすると、必然的に合意アルゴリズムに行き着く。これらと全順序ブロードキャストは等価であることが証明できる。したがって、これらの問題のいずれかを解決できれば、他方の問題の解決策に変換できるという点は重大な知見である。</p>
</blockquote>
<h2 id=realforce-のワイヤレスモデル>REALFORCE のワイヤレスモデル</h2>
<p>ユーザーから待望されていた REALFORCE のワイヤレスモデルがとうとう発売された。</p>
<ul>
<li><a href=https://weekly.ascii.jp/elem/000/004/073/4073042/>高級キーボードREALFORCEから待望のワイヤレス機「R3」が登場、見どころは？</a></li>
</ul>
<p>先週から amazon で予約販売を受け付けていたので <a href=https://amzn.to/3EJivAF>REALFORCE 東プレ R3 キーボード 静音 ハイブリッドモデル 日本語配列 91キー ブラック R3HC12</a> を予約して、本日届いた。私はとくに必要ないけど、bluetooth のマルチペアリングに対応していて最大4つまで接続できる。オフィスの机はそこそこ広いけれど、本とラップトップとモニター2台置いたらスペースが埋まってしまっている。ご飯を食べるときや書類を作成するときにキーボードを立てかけたりしてスペースを確保していて不便に感じていた。</p>
<p>ubuntu 環境での bluetooth の設定に少し手こずった。GUI の設定マネージャー (blueman) でペアリングしようとしても失敗する。キーボードの情報は取得できるけど、ペアリングは失敗する。試しに macos でペアリングしてみたらパスキーの入力画面が表示されて、6桁の数字を入力して ENTER した後に接続するとペアリングできた。blueman だとパスキーが表示されないなと気付いてググってたら <a href="https://bbs.archlinux.org/viewtopic.php?id=174239">[SOLVED] Bluetooth keyboard: Unable to pair (authentication timeout)</a> を見かけて、bluetoothctl でも設定できそうなのでやってみた。</p>
<pre tabindex=0><code>キーボードの情報を表示
[REALFORCE_3]# info F6:9D:A5:80:B7:1F
Device F6:9D:A5:80:B7:1F (random)
	Name: REALFORCE_3
	Alias: REALFORCE_3
	Appearance: 0x03c1
	Icon: input-keyboard
	Paired: no
	Trusted: yes
	Blocked: no
	Connected: yes
	LegacyPairing: no
	UUID: Generic Access Profile    (00001800-0000-1000-8000-00805f9b34fb)
	UUID: Generic Attribute Profile (00001801-0000-1000-8000-00805f9b34fb)
	UUID: Device Information        (0000180a-0000-1000-8000-00805f9b34fb)
	UUID: Battery Service           (0000180f-0000-1000-8000-00805f9b34fb)
	UUID: Human Interface Device    (00001812-0000-1000-8000-00805f9b34fb)
	RSSI: -45
</code></pre><pre tabindex=0><code>ペアリングを実行
* エージェントからパスキーが表示されて、キーボードで入力して ENTER したらペアリングに成功した
[bluetooth]# pair F6:9D:A5:80:B7:1F
Attempting to pair with F6:9D:A5:80:B7:1F
[CHG] Device F6:9D:A5:80:B7:1F Connected: yes
[agent] Passkey: 323759
[CHG] Device F6:9D:A5:80:B7:1F Paired: yes
Pairing successful
[CHG] Device F6:9D:A5:80:B7:1F Modalias: usb:v08ACp0302d0001
[CHG] Device F6:9D:A5:80:B7:1F ServicesResolved: yes
</code></pre><pre tabindex=0><code>キーボードを信頼する
[REALFORCE_3]# trust F6:9D:A5:80:B7:1F
Changing F6:9D:A5:80:B7:1F trust succeeded
</code></pre><h2 id=契約書の確認>契約書の確認</h2>
<p><a href=/diary/posts/2021/1026/#選考面談>先日</a> の業務委託案件の契約書が届いたので内容を確認した。</p>
<p>これまで <a href=https://www.cloudsign.jp/>クラウドサイン</a> でしか契約したことがなくて、紙の契約書で契約を締結するのは初めての挑戦でもある。<a href=https://www.post.japanpost.jp/service/letterpack/>レターパック</a> を使って郵送するのがお作法？といったところから調べてた。明後日から働き始める。フルリモートなので物理的な職場は変わらないけど、新しい職場は緊張するな。うまく入っていけるやろか。フルリモートの経験もだいぶたまってきたし、体調も万全だし、憂うことは何もないはず。いまの状況は純粋に私ががんばるだけだ。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1101/>資料作り完了</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-11-01
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/government/>government</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
</span>
<img src=/diary/img/2021/1101_learning.png class=post-cover alt=資料作り完了>
<div class=post-content>
<p>4時に寝て8時に起きた。夜に資料作りに集中していたので家に帰ってきたのが3時頃で、くつろいだりアニメみたりしてから寝た。遅くに帰ってきてもすぐに寝るわけじゃなくて、だらだらして実際に寝るまで1-2時間はかかる。こういうところ、生活が堕落していて改善していくべきなのかもしれない。良かったこととして、ウォーキングのせいか、夜はよく眠れた。</p>
<h2 id=みんなの-python-勉強会の資料作り>みんなの Python 勉強会の資料作り</h2>
<p>昨日の続き。一晩寝てから最後の仕上げをした。時間を置く、とくに一度寝てから資料を洗練させると改善点があちこち出てきてより良いものになっていく気がする。午前中に主催者に連絡したものの、午後になってから思い付いたことをちょくちょく修正したりもした。オンラインの資料だと、先方に連絡した後でも微修正できるところがよい。業務の資料だとさらに2-3日かけて洗練させていくけど、勉強会の資料だからこれでいいかな。タイトルはすごく気に入っているというわけではないけど「本と学びの段階」とした。ひとまず完成したので自分のやりたいことに取り組める。</p>
<h2 id=神戸市長選>神戸市長選</h2>
<p>神戸市は衆議院選挙とは別に市長選挙も一緒にあった。<a href=https://www.nhk.or.jp/senkyo2/kobe/17581/skh50331.html>神戸市長選</a> によると、投票率は53.79％で439,749 (67.7%)の得票を得た現職の市長が完勝した。3回目の当選になるらしい。私が神戸に戻ってきてから初めての市長選挙だった。起業してから手続きなどで行政が身近になったことから関心をもつようになってきた。自分ごとで考えるというのか、どんなものでも身近なことは関心をもつのかもしれない。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>9.2 線形化可能性を読んだ。</p>
<blockquote>
<p><strong>線形化可能性</strong> とは、データのコピーが1つしかなく、そのデータに対する操作がすべてアトミックであるかのようにシステムにみせることを指す。古くなったキャッシュやレプリカからの値ではないことを保証する、<strong>最新性の保証（recency guarantee）</strong> と言える。トランザクションの章に出てきた <strong>直列化可能性</strong> とはまったく異なる。直列化可能性が保証するのは、複数のトランザクションが何らかの順序で実行された場合に同じ結果になることを保証するもの。</p>
<p>あと「役に立たない CAP 定理」というコラムもおもしろい。CAP 定理とは次の3つはすべて成り立たず、2つを選択することを強いる。</p>
<ul>
<li>一貫性（Consistency）</li>
<li>可用性（Availability）</li>
<li>分断耐性（Partition tolerance）</li>
</ul>
<p>CAP 定理は歴史的にデータベースのトランザクションのトレードオフについての議論の出発点として引用され、有名な定理ではあるが、分散データベースの研究者の中では1970年代から知られていたことであったらしい。そして、ネットワークを介した分散システムは、分断耐性が必須 (ネットワークが切断しないことはないから) であることから一貫性か可用性のどちらかを選択するしかない。ここで一貫性とは線形化可能なシステムを実装することだが、これはパフォーマンスのデメリットが大きい。そのため、現代の多くの分散データベースは線形化可能性を提供しないことを選択しており、結果として可用性と分断耐性を選択することになっている。したがって、CAP 定理から議論を始めることは無意味であると言う。</p>
</blockquote>
</div>
</div>
<div class=pagination>
<div class=pagination__buttons>
<span class="button previous">
<a href=/diary/dates/2021/11/>
<span class=button__icon>←</span>
<span class=button__text>最近の日記</span>
</a>
</span>
<span class="button next">
<a href=/diary/dates/2021/11/page/3/>
<span class=button__text>過去の日記</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class="copyright copyright--user">
<span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span>
</div>
</div>
</footer>
<script src=/diary/assets/main.js></script>
<script src=/diary/assets/prism.js></script>
</div>
</body>
</html>