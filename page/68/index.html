<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.109.0"><title>forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content="t2y"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="forest nook"><meta property="og:description" content><meta property="og:url" content="/diary/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0729/>ストーリーポイント運用は信仰に近い</a></h1><div class=post-meta><span class=post-date>2022-07-29 (Fri.)</span></div><span class=post-tags>#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/career/>career</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ストーリーポイント見直し大会>ストーリーポイント見直し大会</a></li></ul></nav></div><div class=post-content><p>3時に寝て7時に起きた。一昨日からやっているリファクタリングが佳境なので1時ぐらいまでコードを書いてた。コミットするときにソースコードを自動整形したらリファクタリングと関係ないところに diff がたくさん出てしまって、数十箇所は diff と突き合わせながらフォーマットを手で直さないといけない状況になった。量が多かったので不満が溜まってコミットしたときに課題管理にこんなコメントをした。</p><blockquote><p>ソースコードがフォーマットされてないから自動フォーマットするとリファクタリングと関係ないところに差分が出るからそれを元のフォーマットに手作業で戻す作業を1時間ぐらいしてた。帰りたい。</p><p>2022/07/29 00:33:45</p></blockquote><p>翌朝に来た PO がたまたまコメントをみかけてデイリースクラムで質問を受けて恥ずかしかった。変なコメントしてごめんなさい。</p><h2 id=ストーリーポイント見直し大会>ストーリーポイント見直し大会</h2><p>導入前からもいまもずっと私は一貫してこのプロジェクトでストーリーポイントの運用は不向きではないかという姿勢をとっている。ストーリーポイントを嫌っているわけではなく、論理的にうまくいかない課題をどうやって解決して運用にのせるかの施策が何もないのに盲目的に運用しているところに懸念をもっている。私の懸念を解決する施策を誰かが責任をもって進めるなら反対することない。2時間という時間を設けていたのでストーリーポイントの是非も含めての見直し大会だと私は考えていた。しかし、そうではなかった。始まって30分ぐらいは見直し大会をどう進めるかの会議の進め方を議論していた。この時点では私はこの会議にやる気をなくした。誰もなにも準備してなく、ただ2時間という時間をとっただけの会議だった。次の1時間で直近の実際のチケットをもってきて、内容を説明してみんなでポイントを付けていく作業をしていた。その後の30分はプランニングポーカーやって遊んでただけ。ストーリーポイントの運用の見直しという視点は何もなくて、いまの数値はデタラメだから正しい数値がつくリファレンスストーリーを作り直せばいいというだけだった。誰も責任をもってないので時間を潰すだけの会議だったと思う。</p><p>ちょうど10月末でお手伝いを終了することを伝えたのもあって、プロジェクトから去る開発者があれこれ大勢側に疑義を申し上げるのもどうかという思いもあって、これ以上はストーリーポイントの運用に口出ししないことに決めた。おそらくチームというよりは組織としてどうしてもストーリーポイントを運用したい動機が別の理由からあるようにみえた。ストーリーポイントさえ付けておけば、プロジェクトのスケジュールがどうなっても誰も責任を追求されなくて責任者は楽なんだろうと推測する。</p><p>一方で、協力会社の若い開発者がチケットの内容を説明していて、何度か「コピペしただけ」という説明の仕方をした。私は違和感があって気になっていた。本人は悪気なく大した工数ではなかったと伝えたかったのだと思う。開発作業の説明でコピペしただけと発言して恥ずかしいという感覚もない。仮にコピペしたコードを扱うとしても、そのコードの拡張性や保守性を考慮して抽象化することはあるだろうし、論理にあわせて修正するからまったく完全なコピペなどあり得ない。この発言をプロの料理人に例えたら「既成品をレンジでチンしただけ」と言っているに等しい。推測だが、プロの料理人は仮に既成品を使ってもそのまま客に出すことはなく、必ずプロとしての付加価値をつけていると私は思う。プロの開発者として開発の姿勢に問題があることがわかってしまうのに加えて、ビジネスパーソンとしても適切な発言ではないことに気付いていないのが不憫に思えた。まともな会社で働いていれば、先輩に叱られたり指導を受けたりできるのが、そんなことすら知らずにキャリアを歩んでしまう懸念がある。このまま中堅になったときにどこかで失言して信頼をなくしてしまうのではないかと心配になった。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0728/>スクラムのふりかえりは感情に寄り添い過ぎ</a></h1><div class=post-meta><span class=post-date>2022-07-28 (Thu.)</span></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#内覧前に>内覧前に…</a></li><li><a href=#大ふりかえり大会>大ふりかえり大会</a></li></ul></nav></div><div class=post-content><p>2時に寝て7時に起きた。前日はリファクタリングで0時過ぎぐらいまでコードを書いてた気がする。</p><h2 id=内覧前に>内覧前に…</h2><p><a href=/diary/posts/2022/0713/#窓付きオフィスの空きをみつけた>窓付きオフィスの空き</a> をみつけて内覧依頼をしていた。昨日入居者が退去したということで日程調整して今日の13時から内覧を申し込みしていた。朝起きて楽しみにしていたら、午前中に電話が掛かってきて昨日たまたま申し込みがあって成約してしまったとのこと。もちろん内覧前に成約があることは承知しているのでそれ自体は仕方ないことだと理解している。タイミングがよすぎて陰謀論のように妄想していた。本当はもっと事前に決まっていたのに連絡するのを忘れてたとか、私の場合は同じ施設間の移動になるので利益だけを考えると外部からのご新規さんを優先されたとか、いくつかパターンは考えられる。妄想遊びはともかく、最低でも1ヶ月前には空き情報がサイトに掲載されるので十分な時間があるので他のお客さんが申し込む可能性は高い。私はそれも含めて縁があるかどうかを試していたところはあった。これは縁がなかったということで受け入れた。契約はできないけど、今後のために内覧だけさせてほしいとお願いして行ってきた。普通に内覧してよい部屋だった。空いていれば内覧後にすぐ申し込みをしていたので1日の差で希望が叶わなかった。とはいえ、すでに内覧したので次に空きが出ているのをみつけたら内覧せずに申し込みできる状態になったとも言える。もしかしたら、昨日申し込みした人も私と同じように事前に内覧はしていたが、なんらかの理由で申し込みできなくて今回は縁があったのではないかとも考えられる。いずれにしても、また次の縁があるときを待つ。</p><p><figure><img src=/diary/img/2022/0728_office1.jpeg></figure><figure><img src=/diary/img/2022/0728_office2.jpeg></figure></p><h2 id=大ふりかえり大会>大ふりかえり大会</h2><p>サービスインが落ち着いたのでお手伝いしている開発プロジェクトの大きなふりかえりイベントがあった。スクラムのスプリントが1週間単位なのでふりかえり自体は毎週やっている。ホストがスクラムマスターで、どんな風に数ヶ月分の大きなふりかえりをするのか興味があったんだけど、とくに目新しいことはなく、総論として期待はずれだった。毎週のふりかえりイベントの延長でしかなく、区切りとしての総括もなければ、次の開発に向けての改善や展望もほとんどなかったと思う。スクラムマスターは業務を理解していないのでまともにファシリテーションできなかったとも言える。みんながんばった、サービスインできてよかった、これからもがんばっていこうのレベル。</p><p>スクラムマスターがこのプロジェクトに参加したのは昨年の10月で、私が11月からお手伝いしているのでほぼ同期だということもわかった。その開発プロジェクト自体はその1年前ぐらいからやっていたのかな？現時点で2年ぐらい経っているのだと推測する。私がイニシアティブをとったところで評判のよかった項目はこれら。コメントを求められたので、開発者が開発しやすい環境を作った方が開発のサイクルが早くなって結果的にプロダクトの品質が上がるという当たり前のことを話した。</p><ul><li>課題管理を backlog/github issues に分かれていた運用を backlog に一元化した</li><li><a href=/diary/posts/2022/0328/>backlog-github-integration-action の導入</a></li><li><a href=https://note.com/hoshino_technote/n/n6afff42aeee0>ビルド／デプロイのワークフロー改善</a></li></ul><p>1つがっかりしたのが、<a href=/diary/posts/2022/0726/>ストーリーポイントを用いたバーンダウンチャートの実績</a> のふりかえり。ネガティブな結果が出ているのに、そのバーンダウンチャートがあったから間に合わないということがわかって納期を延期できたみたいなことを話していて呆れてしまった。導入当初、納期が守れなくて五月雨式に延期してしまう課題への対応として導入したはずだった。導入時に私は2回スクラムマスターにストーリーポイントで納期を見積もるのは誤った運用だと指摘した。しかし、スクラムマスターが他プロジェクトでうまくいっているからと強引に導入した経緯がある。そして納期をまったく守ってもいないのにその事実を真剣に総括しようとしない姿勢が不誠実だった。また翌日ストーリーポイント見直し大会をするという話しがあったからこの場は丸くおさめた。</p><p>スクラムマスターはポジティブな内容とネガティブな内容を交互にふりかえるようにファシリテーションしていた。あとネガティブ内容の厳しい指摘は意図的に避けているようにもみえた。おそらく担当者の心情を慮ったのだろう。人を責めるわけではなく、ネガティブな事実や結果と向き合って、組織として仕組みで次の改善につなげるというのは、私が言うほど簡単ではないのかもしれない。私は sier 時代にお客さんからも社内からも怒られるのが日常だったからいまの若い人たちよりはネガティブな事実に対する耐性が高くてギャップに映るだけかもしれない。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0727/>無障害インフラ移行</a></h1><div class=post-meta><span class=post-date>2022-07-27 (Wed.)</span></div><span class=post-tags>#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#本番環境リリースのサポート>本番環境リリースのサポート</a></li></ul></nav></div><div class=post-content><p>0時に寝て6時に起きた。</p><h2 id=本番環境リリースのサポート>本番環境リリースのサポート</h2><p><a href=/diary/posts/2022/0719/#2つ目のサービスイン>サービスイン</a> のバタバタによって毎週の定例リリースを先週はやらなかった。そのため、今回は2週間分の変更をまとめてリリースすることになった。インフラの変更が複数あったので私も万全の準備をして作業に備えた。</p><ul><li><a href=/diary/posts/2022/0725/#waf-のカスタムレスポンス>waf を使ったメンテナンス切り替えの導入</a></li><li><a href=/diary/posts/2022/0720/>k8s のノードグループと nodeSelector の導入</a></li></ul><p>他にもいくつか本番のマスターデータの更新など、箇条書きにした作業項目は15個になった。今回はインフラとアプリケーションが相互に依存する変更を加えているので意図した順番で作業しないといけない。ノードグループ導入による k8s の作業内容は wiki にすべて作業方法を書いていたのでその通りに作業してもらった。メンテナンスモードに切り替える初動もうまくいったので現場の運用担当者が間違って使うこともない。意図した作業内容と順番でうまくリリース作業もできた。メンテナンス時間を2時間もらっていて、宿泊業だとその時間帯が12-14時になる。宿泊客のチェックアウト後、チェックイン前の空き時間だ。メンテナンス後に運用担当者にすぐ確認もしてもらえるし、リリース作業の時間帯としては深夜早朝にしなくてよいのは助かる。私が想定した通りに作業は進み、1時間でリリース作業を終えた。障害も一切なかった。インフラ担当者は想定外の障害に備えて、切り戻しやリスク管理をする。まったく問題なく想定内だったので晴れ晴れしい気持ちになった。こういう気持ちはインフラ担当者にしかわからないと思う。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0726/>ストーリーポイントの運用と現実</a></h1><div class=post-meta><span class=post-date>2022-07-26 (Tue.)</span></div><span class=post-tags>#<a href=/diary/tags/scrum/>scrum</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ストーリーポイント再考>ストーリーポイント再考</a></li></ul></nav></div><div class=post-content><p>0時に寝て6時に起きた。</p><h2 id=ストーリーポイント再考>ストーリーポイント再考</h2><p>スクラムのふりかえりイベントでストーリーポイントの見直しをしようという話題が出た。この半年ほどストーリーポイントを使って実際に開発をやった事実から整理してみる。</p><ul><li>開発者のタスクも非開発者のタスクも同じ尺度のストーリーポイントを設定していた</li><li>あるチケットのタスクをやっていてチケット分割すると、最低でもストーリーポイントが1増えていた<ul><li>元チケットと分割したチケットのストーリーポイントの総数が同じであれば問題はないが、ストーリーポイント1が設定されたチケットを2つに分割するとそれぞれにストーリーポイント1をセットしても2倍になってしまう。タスク分割したのにストーリーポイントをゼロにセットするのもなんか違う</li></ul></li><li>ストーリーポイントの数値からバーンダウンチャートを生成した (みえる化)<ul><li>このバーンダウンチャートで運用して実際に2回の延期が発生し精度が低いことがわかった<ul><li>納期の2週間前に延期することがわかった</li><li>シニア開発者の勘と経験の方が精度が高かった</li></ul></li></ul></li></ul><p>これらの事実から私の所感をまとめてみる。</p><ul><li>開発者と非開発者 (プロダクトオーナー) の業務を同じ数値で表して合算するのは論理的におかしい</li><li>複雑な業務の開発プロジェクトでストーリーポイントの数値を設定するのは難しい<ul><li>複数のマイクロサービスを担当</li><li>複数の技術領域を担当 (インフラ、フロントエンド、バックエンド、要件定義)</li></ul></li><li>チケット駆動開発と相性が悪い<ul><li>チケット分割は担当者がタスクを完了させやすい粒度や内容で分割すればよかったのがストーリーポイントを考慮すると複雑さが増す</li><li>チケットの粒度はチームで統一されているのが理想的ではあるが、現実的にそのような運用の統制が取れているのを私はみたことがない<ul><li>チケットの粒度とストーリーポイントの合計に相関が出てしまい、それは個人差 (属人化) が生じやすい</li></ul></li></ul></li><li>安易なみえる化による弊害がある<ul><li>ストーリーポイントは開発の状況を表す指標の1つではあるが、現実をすべて表しているわけではない</li><li>多次元的なパラメーターからストーリーポイントというただ1つの指標を用いて2次元にすることで他の情報が欠落する<ul><li>偏ったデータによる意思決定に使われる懸念がある (その情報を外部に発信していればとくに)</li></ul></li></ul></li></ul><p>ストーリーポイントによる運用をうまくまわすにはいくつか制約があるように私からは思えた。</p><ul><li>開発プロジェクトのスコープや業務内容が一定の複雑さにおさめられる<ul><li>一定の制約や制限がないと論理的に説明可能な適切な数値を割り当てられない</li><li>例) 外部要因に影響をうけない1つのマイクロサービスを開発する</li><li>例) 開発者はフロントエンドだけの開発をする</li></ul></li><li>開発者と非開発者のタスクは別で管理する (合算しない)</li></ul></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0725/>メンテンナンス切り替えの設計</a></h1><div class=post-meta><span class=post-date>2022-07-25 (Mon.)</span></div><span class=post-tags>#<a href=/diary/tags/cdk/>cdk</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#waf-のカスタムレスポンス>waf のカスタムレスポンス</a></li></ul></nav></div><div class=post-content><p>0時に寝て6時に起きた。</p><h2 id=waf-のカスタムレスポンス>waf のカスタムレスポンス</h2><p>メンテンナンス時にエンドユーザーがアプリケーションにアクセスできないようにしたい。いろんなやり方があるけど、どういった手段で対応するのが最もシンプルで運用も容易かを少し前から頭を悩ませていた。</p><p>当初は cloudfront のディストリビューションをアプリケーションの assets とメンテナンスページの html の2つを作って、cdk のデプロイで切り替えできないかと考えた。cloudfront はドメイン名と密接に紐付いていて、同じドメイン名を2つのディストリビューションに設定することはできないようにみえる。あらかじめそれぞれのディストリビューションを2つ作っておいて route53 で必要に応じて向き先を切り替えるといった構成はできなかった。その次に waf について調べていたら waf がルールでカスタムレスポンスを返すことができることに気付いた。</p><ul><li><a href=https://aws.amazon.com/jp/blogs/news/customize-requests-and-responses-with-aws-waf/>AWS WAFによるリクエストとレスポンスのカスタマイズ</a></li></ul><p>ちょうどいまエンドユーザーからのアクセスは ipSet で許可し、それ以外のネットワークからのアクセスをブロックしていた。そのルールを更新して、メンテナンス時はエンドユーザーからのリクエストのみをブロックに変更してカスタムレスポンスを返せることに気付いた。waf を管理するスタックなら cdk デプロイで1分ぐらいで更新できた。このやり方のよいところの1つに開発者の ip アドレスを許可することで開発者だけはアクセスできるようにもできる。あと具体的に cdk でカスタムレスポンスをどう実装するかのドキュメントがわかりにくい。サンプルとしてはこんな感じ。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>acl</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>wafv2</span>.<span style=color:#a6e22e>CfnWebACL</span>(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#39;MyAcl&#39;</span>, {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>defaultAction</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>block</span><span style=color:#f92672>:</span> {} },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;my-acl&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>scope</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;CLOUDFRONT&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>customResponseBodies</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>maintenanceInProgress</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&lt;html lang=&#34;en&#34;&gt;Maintenance in progress&lt;/html&gt;&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>contentType</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;TEXT_HTML&#39;</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rules</span><span style=color:#f92672>:</span> [{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>action</span><span style=color:#f92672>:</span> { 
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>block</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>customResponse</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>responseCode</span>: <span style=color:#66d9ef>503</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>customResponseBodyKey</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;maintenanceInProgress&#39;</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>statement</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>ipSetReferenceStatement</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>arn</span>: <span style=color:#66d9ef>ipSet.attrArn</span>,
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }],
</span></span><span style=display:flex><span>});
</span></span></code></pre></div></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0724/>ホテル経営の本を読み終えた</a></h1><div class=post-meta><span class=post-date>2022-07-24 (Sun.)</span></div><span class=post-tags>#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#もてなしだけではもう食えない>もてなしだけではもう食えない</a><ul><li></li></ul></li></ul></nav></div><div class=post-content><p>0時に寝て7時に起きた。</p><h2 id=もてなしだけではもう食えない>もてなしだけではもう食えない</h2><p>読み終えた。あとで総評を書く。</p><h4 id=第10章-不動産屋の悪知恵>第10章 不動産屋の悪知恵</h4><p>2000年に改正された借地借家法38条の「定期借家」の条項から賃貸契約には2種類あるらしい。</p><ul><li>普通借家</li><li>定期借家</li></ul><p>普通借家は契約期間更新の概念があり、借り主が契約更新を拒否するには「正当な事由」が必要になる。一般的な賃貸マンションなどの契約も多くのケースでこちらの契約になる。ここでいう正当な事由とは、建物が老朽化して立て直す必要があるとか、貸し主がそこに住むといったものらしい。一方で定期借家は契約期間が終了すれば、一旦契約は終了してから新たに再契約するといった段取りになる。この定期賃貸借契約の条件を満たすには、契約期間更新の定めがないことを説明した書面を交付する必要がある。その書面がない場合はすべて普通借家とみなされるという。その是非を巡って争った最高裁の判例があるらしくググるとすぐに出てくる。当事者同士で双方の合意があったとしても説明書面がない場合は無効とするような判例となっている。これを逆手に取れば、普通借家として契約更新を主張できるというストーリー展開になっている。</p><ul><li><a href=https://hibiya-law.jp/posts/post2.html>■Q&A不動産の豆知識（定期建物賃貸借）－弁護士伊藤</a></li></ul><p>あとは PDCA サイクルのうち、日本の会社で一番弱いところはどこ？という話題が出てくる。Check だろう？という主人公の答えに、アドバイザーは Plan じゃないかと返す。Plan が曖昧だから Check できないという背景になっているのではないかと。一理あるかもしれない。日本人は気質として誰か1人が責任を担うのを嫌う文化があるように思う。個人の責任にしたくない・されたくないという空気から Check を曖昧にしたがる傾向があると私は考えている。</p><h4 id=第11章-エピローグ>第11章 エピローグ</h4><p>タイトルのままの章でホテル経営についてのアドバイスがあるわけではなく、ストーリ仕立てで展開してきた物語の結末や登場人物たちのその後のキャリアや展望などを紹介している。総じてハッピーエンドと言えるし、総じて人生の中のスナップショットとしてこんなもんとも言える。区切りがきてなんらかの結果が出たとしても、さらに人生は続くので日常が少し変わっていくだけといった展開になっていた。</p><h4 id=あとがき>あとがき</h4><p>著名なホテルの総支配人と著者との対談がある。読んでいて関心をもてたところは Job Description (職務分掌記述書) の重要性が説かれている。適正な評価、公平な人事、採用にも必要とされる。この考え方はメンバーシップ雇用を長く続けてきた日本の会社の年功序列とは大きな違いがあるため、制度設計の見直しは時間がかかるのだろうと思える。過去のしがらみがない新興企業が新たに制度設計して台頭していくのがよいのだろう。</p><p>また外資系という言葉に抵抗感のあるスタッフに対して「トヨタやファーストリテイリングは外資系ですか？日系ですか？」と尋ねるという話題も出てくる。そうすると、外資系や日系というグルーピングに意味がないことに気付く。その違いを対談の中ではグローバルかノングローバルかの違いでしかないと説明されている。ビジネスの規模や競合をグローバルの視野で考える必要があるかどうかによって変わってくるという。</p><blockquote><p>勝てる能力があってもその素地となる基礎体力がないと発揮できない。野球でも基礎体力があるから速い球を投げられる。</p></blockquote><p>これもホテル経営に限った話しではないなと思えた。私自身、昨今の開発チームをみていて感じることでもある。クラウドでアプリケーション開発が簡単になったがために基礎がなく、スキルが低い開発者もメンバーの一員として働けるようになった。もちろん最初は誰もがそうだけど、適切な指導や教育を受けないとそのまま経験年数だけが経ってしまう。さらにそんな人が偶然リーダーになってしまうと <a href=https://yshibata.blog.ss-blog.jp/2016-07-01>許される無知の範囲は開発経験年数に反比例する</a> という現象が起きる。一定の水準を超えていない開発者がなにを作ってもうまくいかないのではないかと私は感じるようになってきた。私はそういったプロダクトを「ただ動くだけ」と呼んでいる。その後の拡張や保守に必要以上にコストがかかり、それが原因で将来の開発計画に支障をきたすこともある。そして、多くのケースでその状況を作った人はその後いないことが多い。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0723/>コーポレートファイナンスの入門</a></h1><div class=post-meta><span class=post-date>2022-07-23 (Sat.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/finance/>finance</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ストレッチ>ストレッチ</a></li><li><a href=#もてなしだけではもう食えない>もてなしだけではもう食えない</a><ul><li></li></ul></li></ul></nav></div><div class=post-content><p>0時に寝て6時に起きて7時半に起きた。</p><h2 id=ストレッチ>ストレッチ</h2><p>今日の開脚幅は開始前158cmで、ストレッチ後162cmだった。まだ右腰と右股関節、両腕の張りは少し残っているものの、先週末の田んぼ仕事の疲労はかなり抜けた。今週は暑くて家に帰ってきたらエアコンをつけてだらだらしていたのであまり数値はよくならないんじゃないかと思っていて、実際に開始前の数値はいま一つだったんだけど、ストレッチを受けたらいつも通りに戻った。トレーナーさんと雑談しているときにふと「毎日パソコンを使いますか？」と質問を受けた。トレーナーさんからプログラマーの自分にとってそんな質問をされるとは予想外で思わず吹き出して笑ってしまった。その質問は「毎日水を飲みますか？」と私にとっては同じですよと答えた。トレーナーさんも愚問だったと理解して一緒に笑ってた。</p><h2 id=もてなしだけではもう食えない>もてなしだけではもう食えない</h2><h4 id=第7章-ホテルが客を動かせ>第7章 ホテルが客を動かせ</h4><p>ホテル側が自分たちの問題を解決するために客の行動を制御するといった展開になっている。米国のスーパーマーケットでは Express Lane という、購入品目が少ない客向けに手早く決済するためのレジが設けられているらしい。日本にはないのかな？この運用には客に学習コストを強いるのが欠点となる。キャパシティ問題の問題解決のアプローチは次の3つになる。</p><ol><li>キャパシティを増やす</li><li>供給を変える</li><li>需要を変える</li></ol><p>本章の展開としては3番目の客側の導線や行動を変えてしまう方法で需要を変える手法が説明されている。本題ではないけど、さらっと出てくる説明にも納得感がある。ダメなホテルの共通点として、他社でうまくいった改善策、ベストプラクティスに飛びつき、それ以上考えようとせず、問題の本質を理解しようとしない。そういうホテルはコンサルタントが去ってしまうといずれでダメな経営に陥るとある。ホテルに限らず、ダメな会社の特徴だと思う。</p><p>客にピーク時の利用を避けてもらうための施策として次の2つがある。</p><ul><li>混雑することをあらかじめ伝えておく</li><li>混雑を避けることのインセンティブをつける</li></ul><p>ホテル側が客の行動をコントロールするのは構わないが、客にとってそれが不利益にならないように配慮する必要がある。人間の心理として混雑することがあらかじめわかっていればクレームにならず許容できたりする。人は不意に混雑に出くわして不満をもつことが多いという。そういった人の心理を利用して人の行動を制御して経営に生かすという考え方は比較的新しい研究領域である。行動経済学などもその分野の1つで、古典経済学では人は合理的に行動するとされてきた。しかし、現実では必ずしもそうではないことも行動経済学によってわかってきた。</p><h4 id=第8章-リスクを知らないリスク>第8章 リスクを知らないリスク</h4><p>親会社の不動産会社からリスク管理報告書を提出しろという業務に沿ってリスクマネジメントについての話題が出てくる。契約の話しだったり、建築に関する話しだったり、あまり一般的な経営とは異なる内容にみえる。余談だけど、過去にうちの会社で業務内容が変わったにも関わらず、契約内容を更新せずに更新された新たな業務を継続してうまくいかなかった経験がある。うまくいかなかったときに原点に立ち戻る場所が契約であり、契約を曖昧に扱うと後でしっぺ返しがあるという失敗をまさに経験した。ふりかえりをするときにそもそもの基準が適切でないとその反省や改善点も曖昧になってしまうという話し。</p><p>さて、リスク管理報告書のアウトラインとして次の用語が出てくる。</p><ul><li>ハザードコントロール<ul><li>ハザードとは危険を生じさせるもののこと</li><li>ホテル経営だと、食中毒を防ぐ施策とか、横領できないように決済承認に2名以上必要とか</li></ul></li><li>ペリルコントロール<ul><li>ペリルとは事件・事故のこと</li><li>起きてしまった事件・事故から最小限の損害・被害に食い止める施策</li></ul></li><li>ロスコントロール<ul><li>ロスとは事故発生時に発生してしまった経済的損失のこと</li><li>具体的には保険購入であり、どんな保険にどのぐらいの補償額で加入するかになるが、これがなかなか難しい</li></ul></li></ul><p>peril という英単語の辞書を引くと、差し迫った危険という意味が出てくる。リスク管理の文脈の用語と英語の意味はやや違うのかもしれない。</p><h4 id=第9章-タイムバリューを理解せよ>第9章 タイムバリューを理解せよ</h4><p>親会社に投資ファンドからホテルの買収提案があり、ホテルの事業価値を測るコーポレートファイナンスの話題が出てくる。上場企業であれば株価 x 発行済株式数で時価総額がすぐにわかるが、未上場企業の価値を査定するのは難しいという説明からその手法が紹介される。</p><ul><li>類似業種比準方式<ul><li>上場している同業者の株価を参考にする</li><li>但し、ビジネスモデルを無視して業種だけで比較しようとしても単純比較はできない</li></ul></li></ul><p>不動産を所有しているかどうかで株式評価は大きく異なる。単純に不動産をもっていればよいというわけでもなく、資産と負債のバランスが取れているかが大事。「また貸し」のことを業界用語で転貸 (サブリース) と呼ぶ。</p><ul><li>純資産方式<ul><li>会社のもっているものを全部売って借金を返した残りのお金という評価方法</li><li>貸借対照表の資本がマイナスになっているとすべてを換金しても負債が残る = 債務超過</li></ul></li></ul><p>株価の利回りを株価収益率 (Price Earnings Ratio: PER) と呼ぶ。時価総額 / 純利益で計算される。この計算式から時価総額を知りたければ、純利益 x PER で計算できる。比較可能な会社の PER がわかれば未上場会社の株価を計算できる。但し、PER は会社が未来永劫事業を継続させることを前提としている。会社の継続性に疑義があると PER を用いる根拠がなくなる。株主に説明するときの利益とは、正式には <strong>税引き後当期利益</strong> になる。この金額から配当がなされる。うちの会社だとざっくり粗利から20-30%ほど (法人税 + 消費税) 引いたものが税引き後当期利益になる。会社が予定する配当額は同じだが、株価をディスカウントすることで配当の利回りをよくするという考え方を <strong>リスクプレミアム</strong> と呼ぶ。会社の展望や事業の不確実性を数値化したとみなすことができる。</p><ul><li>株価1000円で配当額が20円だと、利回りは2.0%</li><li>株価500円で配当額が20円だと、利回りは4.0% (この 2.0% の差がリスクプレミアム)</li></ul><p>いま現在もらえる現金の1万円は1年後もらえる1万円よりも価値が高いと言える。それは1年後にはもらえないかもしれないリスクや運用機会損失リスクが含まれるから。その価値をどの程度低く見積もるかを <strong>割引率</strong> と言う。この割引率を用いて将来の現金をいまの現金価値に置き換える評価方法を <strong>DCF (Discounted Cash Flow) 法</strong> と呼ぶ。仮に割引率を10%とすると、1年後の100万円をいまの価値にすると、100 / (1 + 0.1) = 90.9 万円になる。2年後の100万円だと 100 / (1 + 0.1)^2 = 82.6 万円になる。</p><figure><img src=/diary/img/2022/0723_dcf-expression.png></figure><p>本文中ではこの計算式を使って年間の利益と割引率を考慮した現在価値をエクセルでモデル化している。python で書くと次のようになる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>f</span>(profit, discount_rate, year):
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>   <span style=color:#66d9ef>return</span> profit <span style=color:#f92672>/</span> pow((<span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> discount_rate), year)
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#66d9ef>for</span> i, profit <span style=color:#f92672>in</span> enumerate([<span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>120</span>, <span style=color:#ae81ff>125</span>, <span style=color:#ae81ff>130</span>, <span style=color:#ae81ff>135</span>, <span style=color:#ae81ff>140</span>, <span style=color:#ae81ff>145</span>, <span style=color:#ae81ff>150</span>, <span style=color:#ae81ff>155</span>, <span style=color:#ae81ff>160</span>, <span style=color:#ae81ff>165</span>], <span style=color:#ae81ff>1</span>): i, round(f(profit, <span style=color:#ae81ff>0.1</span>, i), <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>...</span> 
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>90.9</span>)
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>99.2</span>)
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>93.9</span>)
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>88.8</span>)
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>83.8</span>)
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>79.0</span>)
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>74.4</span>)
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>70.0</span>)
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>65.7</span>)
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>61.7</span>)
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>11</span>, <span style=color:#ae81ff>57.8</span>)
</span></span></code></pre></div><p>例えば、割引率が10%で5年後の利益が135万円ならば、その現在価値は83.8万円になる。本文の中ではこの金額が投資ファンドが提示している金額だとだいたい一致していることから、これ以上の精度の高いモデルを作らないといけないみたいなストーリー展開になっている。いずれにしてもパラメーターの変数の精度が高くないと適切なモデルとは言えない。割引率を用いた現在価値を計算する考え方を <strong>タイムバリュー (時間の価値)</strong> と呼ぶ。意思決定が遅れるほどプロジェクトの収益化も遅れるため、割引率を計算する現在価値が小さくなっていくという考え方ができる。</p></div></div><div class=pagination><div class=pagination__buttons><a href=/diary/page/67/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span></a>
<a href=/diary/page/69/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>