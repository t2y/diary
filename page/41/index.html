<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.123.1"><title></title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content="t2y"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content><meta property="og:description" content><meta property="og:url" content="/diary/"><meta property="og:site_name" content><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/index.xml rel=alternate type=application/rss+xml title></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0520/>価値観のあう人たちとお酒を飲みながら語り合う</a></h1><div class=post-meta><span class=post-date>2023-05-20 (Sat.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/coworking/>coworking</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ストレッチ>ストレッチ</a></li><li><a href=#カフーツさん訪問>カフーツさん訪問</a></li></ul></nav></div><div class=post-content><p>3時に寝て7時に起きた。昨日は深夜まで yubikey bio で 1password のロック解除の設定を調べていて遅くなった。また後日まとめる。</p><h2 id=ストレッチ>ストレッチ</h2><p>今週は出張があったり、飲み会があったり、前日に深夜まで作業して疲弊していたりとあまり調子はよくなかった。いつも通りの右股関節の関節痛はあるし、腰の張りも少しあったし、右の太もも後ろの筋に違和感があるように感じた。太ももの後ろの筋を伸ばすストレッチが快適でお気に入りの1つなんだが、そこの部位でいつもとはやや違う別の張りを感じた。筋の張りの違和感をトレーナーさんにどう伝えてよいか、表現方法がわからなくて困ることが多い。今日の開脚幅は開始前156cmで、ストレッチ後158cmだった。疲労した体調を立て直すきっかけになってよかったと思う。</p><h2 id=カフーツさん訪問>カフーツさん訪問</h2><p>カフーツさんへ <a href=/diary/posts/2022/0618/#カフーツさん訪問>昨年の6月以来</a> となる訪問をしてきた。毎月オンラインでいとうさんと話しているので身近ではあるけれど、リアルで会うのは約1年振りになる、本当に月日の流れる早さを実感する。<a href="https://www.facebook.com/events/155507457318971/?active_tab=discussion">ブログJelly Vol.132</a> に参加してきた。参加者は3人で18時から始まって1時半ぐらいまでお酒を飲みながらうだつの上がらない話しをしていたw ここにいる人たちと私は価値観があうのでだらだら話しているのが楽しい。</p><p>神戸と実家で2拠点生活しようと考えているという話しをしたら、実家のはなれを改修したスペースに宿泊できるなら <a href=https://www.airbnb.jp/>airbnb</a> で貸し出したらいいんじゃない？という話題が出て、たしかにそういう取り組みもできるなと感心した。そして、そのスペースにもう少し手を入れて小さいコワーキングスペースにしてもよいのかもしれない。すぐ側に田んぼもあるので農業体験なども簡単にできる。淡路島は気候もよくそこそこよい環境でコワーキングの拠点になるかはともかく、海が好きな人向けにはよいところかもしれない。実家のコワーキングスペース化という視点を今後も考えていきたい。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0519/>issue を作るとストレスが軽減する</a></h1><div class=post-meta><span class=post-date>2023-05-19 (Fri.)</span></div><span class=post-tags>#<a href=/diary/tags/issue-management/>issue management</a>&nbsp;
#<a href=/diary/tags/writing/>writing</a>&nbsp;
#<a href=/diary/tags/container/>container</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#issue-を作ることによるストレス軽減>issue を作ることによるストレス軽減</a></li><li><a href=#コンテナ勉強会>コンテナ勉強会</a></li></ul></nav></div><div class=post-content><p>お酒飲んで新幹線乗ったせいか、新幹線の中であまり寝られなくて暑くていつもより移動に疲れた。その後1時に寝て何度か起きて7時に起きた。2日酔いではないが、寝起きの気分はよくなかった。</p><h2 id=issue-を作ることによるストレス軽減>issue を作ることによるストレス軽減</h2><p>昨日の打ち合わせのメモから議事録を作ったり、そこから新しい issue を作ったりしながら来週の打ち合わせの資料作りをしていた。資料を作っている途中、割り込みでメンバーのコードレビューが入ったりして、あまり資料作りは進捗しなかった。</p><p>打ち合わせした内容から issue を作る作業を、私は好きだったりする。何をやってよいかわからない状況というのは苦しい。issue を作ること、要件を言語化したり、背景を調べたり、他の issue との関連付けしたり、そういった手を動かすことがきっかけになって、その issue を明確化していく作業を積み重ねれば時間の経過とともに課題が解決するということを経験的に理解しているからだ。</p><p>大雑把に言えば、私にとって、issue さえ作れればその課題解決は優先順位付けと (解決までの) 時間の問題に置き換えられる。あれやらなきゃ、これもやらなきゃ、なにか抜け・漏れがあるんじゃないかと頭の中でもやもやしているものを issue という概念に変換することで考えなくて済むようになっていく過程がストレスを軽減している気もする。</p><h2 id=コンテナ勉強会>コンテナ勉強会</h2><p><a href=/diary/posts/2023/0516/#テックブログ公開>先日公開したテックブログ</a> とプラスアルファで勉強会をした。コンテナという汎用的な話題だったので CTO から社内向けにアナウンスされて (半業務命令っぽい雰囲気で) いつもより参加者は多かったように思える。10人前後は参加されていた。40分ぐらいで話し終えて20分ほど雑談の時間をとって盛り上がりは微妙だったけど、いくつか意見や質問が出たのでよかったのではないかと思う。</p><p>チームのメンバーが発表するときは私がモデレーターの役割をしている。私が発表するときはモデレーター兼発表者になってしまう。モデレーターと発表者を兼任するのはとても難しい。おそらく脳の集中力を向ける先が異なるからではないかと思う。モデレーターは質問者の質問を広げたり、コミュニケーションがうまくいくように手伝ったりする。回答から次の質問を考えたりもする。一方で発表者は自分の調べたことや伝えたいことを聴衆にわかりやすく伝えることのみに注力する。</p><p>モデレーターと発表者が同じになってしまうと、自分の説明のどこが伝わっていないのか、質問者の意図を組むにはどうすればいいかといったモデレーターの視点がなくなってしまう。以前 <a href=/diary/posts/2023/0401/#個人カンファレンス>tenntenn さんの個人カンファレンス</a> に参加したときに1人2役でパネルディスカッションをされていて、そのときに同僚からあまりやり過ぎると人格崩壊するから気をつけた方よいといった忠告を受けたと冗談で話されていた意味が理解できた。役者が他人になりきるように、これは兼任じゃなくて1人で2つの人格を演じないといけない。そんな器用なことはそうそうできない。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0518/>次開発と打ち上げ</a></h1><div class=post-meta><span class=post-date>2023-05-18 (Thu.)</span></div><span class=post-tags>#<a href=/diary/tags/issue-management/>issue management</a>&nbsp;
#<a href=/diary/tags/team-building/>team building</a>&nbsp;
#<a href=/diary/tags/food/>food</a>&nbsp;
#<a href=/diary/tags/drink/>drink</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;
</span><img src=/diary/img/2023/0518_unagi.jpg class=post-cover alt=次開発と打ち上げ><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#開発課題の打ち合わせ>開発課題の打ち合わせ</a></li><li><a href=#打ち上げ>打ち上げ</a></li></ul></nav></div><div class=post-content><p>能のサイトを眺めつつ <a href=https://www.nhk.jp/p/ts/9N81M92LXV/episode/te/6XWRL58JNK/>世界を変えた“愚か者”フラーとジョブズ</a> をみているうちに寝落ちした。0時過ぎに寝て何度か起きて8時過ぎに起きた。休日以外に8時まわるまで寝ていたという記憶が直近数ヶ月にはないので久しぶりに寝坊した。起きたら8時10数分でそんなことあるはずないとか思ってしまって脳が現実を受け入れられなくて起きた時間を認識できなかった。明らかに8時10数分なんだけど、時計が壊れているなとか思ってしまった。</p><h2 id=開発課題の打ち合わせ>開発課題の打ち合わせ</h2><p>大きく時間を使って次開発の打ち合わせ。事前にいくつか開発課題を洗い出せているが、その優先順位付けをしていかないといけない。開発メンバー + 別チームのコンサルタントにも入ってもらって各々の意見を出し合うといった会議をした。私が議題の資料を予め作っておいた。その進行に応じて議論や意見が盛り上がったのでうまくいってよかったと思う。
大項目でまとまった機能をやるよりも、個々の機能単位に優先順位付けした方がよいだろうという話しになって小さい単位で担当者を割り当てて開発を進めていくことになる。いずれはすべてやるが、開発の順番を決めていくのは意外と難しい。</p><p>話し終えてからメモをまとめ直しているうちに私自身が要件を詳細に把握できていない要件があることもわかってきた。空中戦だとわからないままふわっと進んでしまうので、文字に落とし込んで整理した上で、本当に必要なものをさらに深堀りして議論しないといけないことに気付いた。</p><p>少ない人数で会議をやる利点の1つとして、みんなの意見を順番に聞いていく余裕をもてることがあげられる。「誰一人取り残されない」とどこかの省庁がミッションにあげているように、うちのチームも課題管理を駆使して、それぞれのメンバーができることややりたいことでチームに貢献するような開発にしていきたい。もう半年やって課題管理に慣れてきているので、次開発は前回のようなやり方を教えるところからスタートにはならないはずだと思う。</p><h2 id=打ち上げ>打ち上げ</h2><p>4月末にリリースを終えたので区切りとして打ち上げしてきた。うちのチームメンバーと偉い人の5人で行くのだと思っていたら直前に社内のメンバーにたくさん声を掛けたそうで10数人での飲み会になって送別会や部署のキックオフみたいな飲み会になった。賑やかでよかった。個人だとあまり行かないようなちょっとお値段のするコースでよいものを食べられておいしかった。日本酒もいろいろ飲んだ。神戸の酒どころに住んでいるので日本酒に関心をもつようになってきた。</p><ul><li><a href=https://www.kigawaya.com/sake/jyouki/>山形 上喜元</a></li><li><a href=https://kuheiji.co.jp/>愛知 醸し人九平次</a></li></ul><p>18-20時と打ち上げやって、21時に新幹線を予約していたのでそのまま帰ってきた。このスケジュールの段取りもちょうどよかった。お酒を飲んで新幹線に乗ると思いの外眠れなくてそこだけ疲れた。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0517/>出張の中日</a></h1><div class=post-meta><span class=post-date>2023-05-17 (Wed.)</span></div><span class=post-tags>#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/container/>container</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#資料作成>資料作成</a></li><li><a href=#aws-app-runner-の情報収集>aws app runner の情報収集</a></li><li><a href=#コワーキングのオンラインイベント>コワーキングのオンラインイベント</a></li></ul></nav></div><div class=post-content><p>0時に寝て何度か起きて5時半に起きてテレビで朝のニュースを聞き流しながら7時に起きた。</p><h2 id=資料作成>資料作成</h2><p>今日はメンバーの1人が休暇だったため、打ち合わせはなしで資料ばかり作っていた。今週のチーム勉強会の発表は私が担当するのでその資料を作ったり、リリースを終えて社内向けにプロダクトの説明のための資料を準備したりしていた。これまでたくさんの資料を作ってきてるので改めて作るというよりは、過去に作ったものを洗練させたり、集めてきて補足する程度の作業になりそうな雰囲気だけわかってきた。</p><h2 id=aws-app-runner-の情報収集>aws app runner の情報収集</h2><p><a href=https://aws-startup-community.connpass.com/event/282015/>App Runner Night !!</a> にオンラインで参加した。<a href=https://aws-startup-community.connpass.com/>AWS Startup Community</a> というコミュニティがあることも知らなかった。顧問のはらさんが LT 発表すると聞いていたのでそれをみようと思ってながらで聞いていたので他の発表はあまりちゃんとみていてない。特別に目新しいことはなかったし、発表の中でもいくつかちょっとそこ怪しいんじゃない？とか思いながら他の作業をしていた。</p><p>私も余裕があれば app runner でサービスを動かしてみてその勘所を把握しておきたい。ecs がやりたいことに比べて使いにくいという印象は私もずっと思っていた。実質 k8s 以外のコンテナプラットフォームは aws しかないので app runner がよいものかどうかに関心をもっている。</p><h2 id=コワーキングのオンラインイベント>コワーキングのオンラインイベント</h2><p>月例のカフーツさんのオンラインイベントに参加した。<a href=/diary/posts/2023/0419/#コワーキングのオンラインイベント>先月の所感はここ</a> 。今日は「移動」というテーマでいつも通りいとうさんがわーっと話をしていた。この2ヶ月に新しい官民の取り組みが始まったらしい。なんか空気だけでダメそうにみえる。</p><ul><li><a href=https://www.mlit.go.jp/kankocho/workation-bleisure/news/230218/>「テレワーク・ワーケーション官民推進協議会」を設立しました！</a></li></ul><p>このサイトでは次の2つの用語を定義している。ブレジャーを初めて知ったけど、発音しにくくて語呂が悪いだろとか思えた。</p><ul><li>ワーケーション (Work + Vacation)</li><li>ブレジャー (Business + Leisure)</li></ul><p>このサイトにあるワーケーションの実施形態には共感するところもあって次の4つに分類している。IT 業界で多いのは合宿型とサテライトオフィス型かな。</p><ul><li>福利厚生型</li><li>地域課題解決型</li><li>合宿型</li><li>サテライトオフィス型</li></ul><p>あとどういう文脈だったか忘れてしまったが、<a href=https://www.shunjusha.co.jp/book/9784393436400.html>身体感覚で「芭蕉」を読みなおす。 『おくのほそ道』謎解きの旅</a> という本を紹介された。能の探求者が書いた独特の視点から松尾芭蕉を取り上げた本らしくて、なんかおもしろそうにみえたのですぐに購入してみた。紙の文庫本しかなかった。読んでみる。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0516/>半期に1回のふりかえり大会</a></h1><div class=post-meta><span class=post-date>2023-05-16 (Tue.)</span></div><span class=post-tags>#<a href=/diary/tags/writing/>writing</a>&nbsp;
#<a href=/diary/tags/postmortem/>postmortem</a>&nbsp;
#<a href=/diary/tags/issue-management/>issue management</a>&nbsp;
#<a href=/diary/tags/team-building/>team building</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#テックブログ公開>テックブログ公開</a></li><li><a href=#半年間の開発のふりかえり>半年間の開発のふりかえり</a></li></ul></nav></div><div class=post-content><p>少し寝ようかと思って横になった時間はあったものの、寝過ごすのが怖くて結局は新幹線の始発まで起きていた。この時期は4時を回り始めると徐々に外が明るくなっていき、5時は普通に明るくなっている。夏至も近い。</p><h2 id=テックブログ公開>テックブログ公開</h2><p><a href=/diary/posts/2023/0509/#Docker-についてのテックブログ執筆>先日書いてレビューを終えた</a> テックブログを公開した。</p><ul><li><a href=https://blog.osstech.co.jp/posts/2023/05/what-is-docker/>Docker とは何か？</a></li></ul><blockquote><p>コンテンツは狙ってバズらない</p></blockquote><p>私の言葉だ。多くの開発者が関心をもつ話題ではないけれど、仲間内では評判がよかったので拡散されると嬉しい、、、。と淡い期待を寄せていたが、そうでもなかった。工数をかけて丁寧に書いても関心をもたれないことはよくある。個々のコンテンツがバズらなくてもコンテンツは積み重ねることも大事なので私がよいと思う記事を今後も書いていく。</p><h2 id=半年間の開発のふりかえり>半年間の開発のふりかえり</h2><p>2時間をとって半年間の開発のふりかえりをやった。課題管理システムから定量的な数字をみたり、定性的なのは、過去のマイルストーンのふりかえりのふりかえりをしたり、課題管理システムから特定の issue を取り上げて改善するにはどうしたらよいかなどを議論したりしてみた。</p><p>私もチームのファシリテーションに慣れてきて、自由に意見を求めるよりも、個人個人を指してどうですか？と尋ねる方が意見がわーっと出てきて議論が活発になることに気付いた。なにか議題があったら必ず当てられて意見を言わないといけないとメンバーも察してくれるようになっていると思う。そういう空気になってきた。そして、ちゃんと答えてくれるのでそれで問題ないと思う。大人しいというのか、消極的というのか、うちのチームのメンバーには意見を求められなければ言わないという姿勢が垣間みえる。これは開発の自律性とは反対にある価値観なのでなるべくそこから脱却して自分から議題に意見を言うようになってほしい。もしかしたら私が喋り過ぎなのかもしれない？</p><p>ふりかえりをしないチームは多いので何もしないよりはなにかしら <a href=/diary/posts/2023/0424/#示唆を与えなければならない>示唆は与えられた</a> のではないかと思いたい。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0515/>goleak と context によるキャンセル制御</a></h1><div class=post-meta><span class=post-date>2023-05-15 (Mon.)</span></div><span class=post-tags>#<a href=/diary/tags/rabbitmq/>rabbitmq</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#amqp091-go-の-context-制御>amqp091-go の context 制御</a></li></ul></nav></div><div class=post-content><p>0時に寝て何度か起きて7時に起きた。いつもなら日曜日は徹夜して翌日の早朝に出掛けるのが月曜日は行かなくて済むのでちょっと楽になった。</p><h2 id=amqp091-go-の-context-制御>amqp091-go の context 制御</h2><p>goroutine リークを検出するツールに <a href=https://github.com/uber-go/goleak>uber-go/goleak</a> がある。ずっと前から余裕のあるときに結合テストの導入しようという issue を作っていたものの、適当なタイミングがなかった。先週末に少し手が空いたので着手した。goleak は個別のテストメソッドにも TestMain にも両方に対応している。結合テストの TestMain に入れた方が保守コストが下がるのでそういった用途がよいのではないかと思う。</p><p>go の TestMain がこういうものかもしれないが、defer 文を使う終了処理があるとそのコードを直接 TestMain には実装できない。関数で wrap して m.Run() を実行した結果を返すようにしないといけない。そこに goleak を入れる場合、goleak.Cleanup を何もしない関数に置き換えて m.Run() の結果を返せばよいのではないかと思う。そして VerifyTestMain() は m.Run() を実行してからすぐに goroutine が動いていないかをチェックする。ここで結合テストを動かすための、環境構築のために http サーバーを goroutine で起動するとか、テストのための goroutine が動いているとそれも検出してしまうのでそれらの goroutine は無視できるよう、2つのオプションが用意されている。</p><ul><li>IgnoreTopFunction: 明示的に無視してよい goroutine のトップ関数を指定する</li><li>IgnoreCurrent: オプションを登録した時点で稼働している goroutine を無視する</li></ul><p>これらを踏まえて TestMain で goleak を使うと次のようなコードになった。しかし、おそらくこの使い方はあまりよくない。いくつか goroutine を無視する設定を追加したために、そこに意図しない goroutine リークが隠蔽されてしまう懸念がある。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>(<span style=color:#a6e22e>m</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>M</span>) <span style=color:#66d9ef>int</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>myTearDown</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>code</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>goleak</span>.<span style=color:#a6e22e>VerifyTestMain</span>(
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>m</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>goleak</span>.<span style=color:#a6e22e>Cleanup</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>exitCode</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;skip goleak cleanup&#34;</span>, <span style=color:#a6e22e>exitCode</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>code</span> = <span style=color:#a6e22e>exitCode</span>
</span></span><span style=display:flex><span>		}),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>goleak</span>.<span style=color:#a6e22e>IgnoreTopFunction</span>(<span style=color:#e6db74>&#34;net/http.(*persistConn).readLoop&#34;</span>),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>goleak</span>.<span style=color:#a6e22e>IgnoreTopFunction</span>(<span style=color:#e6db74>&#34;net/http.(*persistConn).writeLoop&#34;</span>),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>goleak</span>.<span style=color:#a6e22e>IgnoreTopFunction</span>(<span style=color:#e6db74>&#34;internal/poll.runtime_pollWait&#34;</span>),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>goleak</span>.<span style=color:#a6e22e>IgnoreCurrent</span>(),
</span></span><span style=display:flex><span>	)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>code</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestMain</span>(<span style=color:#a6e22e>m</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>M</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Exit</span>(<span style=color:#a6e22e>main</span>(<span style=color:#a6e22e>m</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>さらにこの調査をしているときに amqp091-go の api も context 受け取った方がシンプルでいいんじゃない？と思って提案の pr を送ってみた。context 使わなくても自前でキャンセルする api は提供されているため、開発者の考え方によってこの提案を拒否するのも妥当な判断だと思える。次のメジャーバージョンとか、互換性を維持しなくてよいタイミングから取り入れようという考え方もあるかもしれない。</p><ul><li><a href=https://github.com/rabbitmq/amqp091-go/pull/192>Add Channel.ConsumeWithContext to be able to cancel delivering #192</a></li></ul></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0514/>出張前々日</a></h1><div class=post-meta><span class=post-date>2023-05-14 (Sun.)</span></div><span class=post-tags>#<a href=/diary/tags/business/>business</a>&nbsp;
#<a href=/diary/tags/license/>license</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/project-management/>project management</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ソフトウェアライセンス事業を加速させる-oss-戦略>ソフトウェアライセンス事業を加速させる OSS 戦略</a></li><li><a href=#近況報告の資料作り>近況報告の資料作り</a></li></ul></nav></div><div class=post-content><p>0時に寝て何度か起きて7時に起きた。雨降りだったので午前中はドラクエタクトしてた。午後から雨が小さくなったのをみて、オフィスで出張前の資料作りをしてた。夕方には雨がやんでお土産を購入するために出掛けたらすみよさんさんに偶然会った。</p><h2 id=ソフトウェアライセンス事業を加速させる-oss-戦略>ソフトウェアライセンス事業を加速させる OSS 戦略</h2><p><a href=https://www.chuokeizai.co.jp/bjh/archive/detail_009856.html>ビジネス法務 2023年6月号</a> という雑誌に寄稿したとなかいさんのタイムラインをみかけたので読んでみた。電子版は年間契約でないと購入できないようで仕方なく紙の雑誌を購入した。ライセンス契約の特集の中の1記事らしい。3ページの記事だったので OSS というソフトウェアのビジネス形態の紹介といった記事のようにみえる。OSS や web 業界の開発者からみたら目新しい内容ではないが、こういった雑誌に紹介されること自体がすごいことだと思いながら読んでみた。自社ソフトウェアを OSS とする戦略の特徴として次の3つをあげていた。</p><ul><li>ユーザーの開発者が動作を確認したり、カスタマイズできる</li><li>製品の透明性を証明できる (ソースコードを読めるから)</li><li>技術力のアピールできる</li></ul><p>うちも近いうちに OSS でプロダクト開発を始めるので参考にしながらやろうと思う。うちは OSS で儲けようと考えていないが、うちで作るものは原則として OSS で公開していく方針で考えている。</p><h2 id=近況報告の資料作り>近況報告の資料作り</h2><p><a href=/diary/posts/2023/0425/#リリース>4月末にリリース</a> できているのでそれほど重要ではないけど、毎月出張したタイミングで報告会をしているので急にやめるのもどうかな？という気がして資料を作って打ち合わせする。リリースして GW を挟んで次の開発への準備期間という隙間時間がいまになる。ある種のゆとりになっていて、これはパッケージベンダーだからこそなのか、中小企業ゆえの労務管理や目標管理の緩さからなのか、いずれにしてもこういう隙間時間を使って自分で考えて、自分で調査して、自分でふりかえるといった自律性を養うのによいかもしれない。私もゆっくり考える時間を取れてよかった。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0513/>書きものしていただけの土曜日</a></h1><div class=post-meta><span class=post-date>2023-05-13 (Sat.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ストレッチ>ストレッチ</a></li></ul></nav></div><div class=post-content><p>0時に寝て何度か起きて6時に起きた。朝からなんとなくだらだらしていた。午後から日記を書きながら外をみると雨降りでのんびり過ごした一日だった。</p><h2 id=ストレッチ>ストレッチ</h2><p>今週も資料作りをしていただけでプレッシャーやストレスなどは皆無なので体調よいのだろうと思っていたけど、思いの外、腰の張りはあったので想定したよりは疲れていたかもしれない。もしかしたら、その前の週が連休だっただけに連休明けの週だから身体的に余計に疲れたのかもしれない。今日の開脚幅は開始前155cmで、ストレッチ後159cmだった。いつも通りの数値。初めて縦方向に開脚するストレッチをしてみたら、股関節の可動域のよくないところがきつかった。家でも意識して伸ばしてみようと思う。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0512/>第5期の展望</a></h1><div class=post-meta><span class=post-date>2023-05-12 (Fri.)</span></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/marketing/>marketing</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#隔週の雑談>隔週の雑談</a></li></ul></nav></div><div class=post-content><p>0時に寝て6時に起きた。昨日の夜に展望の資料を作りやるつもりがバテて寝てしまったので朝から作ってた。日中はふりかえりの資料を作っていて、それも作り終えたので来週の東京出張の準備は概ね終わった。</p><h2 id=隔週の雑談>隔週の雑談</h2><p>顧問のはらさんと隔週の打ち合わせ。今日の議題はこれら。</p><ul><li>デザイナーさんとの契約の話し</li><li>第5期の展望</li></ul><p>後者の資料を昨日の夜に作ろうと思いながら帰って晩ご飯食べたら疲れて家でのんびりしてしまった。最近あまりよくない傾向として、晩ご飯を食べに家に帰ると戻って来れなくなることが多い。たまに日記でも書いているが、23時や24時に晩ご飯を食べると寝ているときに胃酸が逆流して吐き気を催したり、最悪、吐いたりする。そうなると夜中に1-2時間は眠れなくなって辛いので夜遅くに食べるのを避けるため、19時前後に家に帰って晩ご飯を食べるようにし始めた。おそらく身体的には晩ご飯なんかもう食べなくてよいはずなのに食べてしまうのはストレスや糖質への依存症なのかもしれない。これはまた別の話し。</p><p>オフィスから家が近いので晩ご飯を外食せずに済むことはよいことなのだが、本来なら晩ご飯を食べて20-21時頃にオフィスへ戻って作業の続きをするのが望ましい。このモチベーション管理がとても難しい。本当の意味では、オフィスに戻って作業しなくてもよいと頭で理解してしまうとついついさぼってしまう。それは私のモチベーションが低いだけでしかない。さぼると多少の自己嫌悪があってさらにモチベーション管理が難しくなる。</p><p>閑話休題。今朝7時からオフィスへ出掛けて資料を作り始めた。期ごとのふりかえりや展望を毎年やっていることには意味があって、昨年の資料を見返すきっかけになる。昨年立てた展望がどうなったかというふりかえりにもなるし、できていないことは今季も継続するのか、やめてしまうのかという判断材料にもなる。毎年の積み重ねとして気付きを溜めていくという見方もできる。どんなことでも継続していると役に立つ。</p><p>起業したときにざっくり10年の計画を3つのステージに見立てた。そして、最初のステージは想定通り進捗し、今季は2つ目のステージへの過渡期となる。起業してもう4年目、4年も経ったんやなぁと思う。年月は早い。マイルストーンの1つとしていた <a href=https://www.smrj.go.jp/kyosai/tkyosai/index.html>経営セーフティ共済</a> の積立が完了する。</p><p>昨年からマーケティングの施策をやっていこうと立案したが、<a href=/diary/posts/2022/0619/>jjug ccc</a> で発表したこと以外は目立った成果をあげていない。日々のお仕事にいっぱいいっぱいになっていて、最低限のことをやっていくだけで生活に余裕はあまりない。その余裕のなさは、先にも書いたモチベーション管理からきているのか？体力的なものなのか、それらが加齢によるものなのかはまだよくわからない。普通に考えると40歳を超えると、いろんな要素が下り坂になっていくことは想定されるので元気のあるうちに新しい施策や行動につなげるのが安全な考え方ではないかと思う。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0511/>gitlab issues と mongodb による分析</a></h1><div class=post-meta><span class=post-date>2023-05-11 (Thu.)</span></div><span class=post-tags>#<a href=/diary/tags/gitlab/>gitlab</a>&nbsp;
#<a href=/diary/tags/mongodb/>mongodb</a>&nbsp;
#<a href=/diary/tags/cli/>cli</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#gitlab-issues-の解析>gitlab issues の解析</a></li></ul></nav></div><div class=post-content><p>0時に寝て何度か起きて7時に起きた。今日も一日資料作りをしていた。</p><h2 id=gitlab-issues-の解析>gitlab issues の解析</h2><p>ふりかえりの資料を作っていて gitlab issues の解析を始めた。gitlab にも分析系機能は提供されているが、大半が有償機能で free では使えない。実質 free で役に立ちそうなレポートを私はみつけられなかった。</p><ul><li><a href=https://docs.gitlab.com/ee/user/analytics/>Analyze GitLab usage</a></li></ul><p>gitlab は <a href=https://gitlab.com/gitlab-org/cli>glab cli</a> というツールを提供している。試しに glab を使って issues の解析ができないかとやってみたが、グループ単位ではなくプロジェクト単位でしか操作できないようにみえた。そこで rest api を呼び出すための便利ツールとして使うことにした。要は rest api で任意のデータを取得してそれを使ってローカルで解析することにした。例えば、次のようにして特定ラベルを除外した特定グループのマイルストーンごとの issues をすべて取得できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ mygrpid<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;xxx&#34;</span>
</span></span><span style=display:flex><span>$ milestones<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;2022-11 2022-12 2023-01 2023-02 2023-03 2023-04&#34;</span>
</span></span><span style=display:flex><span>$ <span style=color:#66d9ef>for</span> i in $milestones; <span style=color:#66d9ef>do</span> echo $i; glab api --paginate <span style=color:#e6db74>&#34;groups/</span><span style=color:#e6db74>${</span>mygrpid<span style=color:#e6db74>}</span><span style=color:#e6db74>/issues?milestone=</span><span style=color:#e6db74>${</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>&amp;not[labels]=Duplicate,Invalid,Wontfix&#34;</span> | jq -c <span style=color:#e6db74>&#39;.[]&#39;</span> &gt; <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>-issues.json&#34;</span>; <span style=color:#66d9ef>done</span>
</span></span></code></pre></div><p>あとはこの json データをそのまま分析のためのデータベースに取り込む。今回は mongodb にインポートしてみた。mongodb だとスキーマを定義しなくても json データをそのままインポートできてアドホックな分析に便利そうに思えた。オブジェクトの入れ子構造をもつ json データのようなものを rdbms にインポートするのはひと工夫必要なことから json データをそのままインポートできるドキュメントデータベースの有効性を理解できた。インポートしたら <a href=https://www.mongodb.com/products/shell>MongoDB Shell</a> を使うとてっとり早い。例えば、マイルストーンごとの issues の件数などは次のようにして集計できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gitlab&gt; db.issues.aggregate<span style=color:#f92672>([{</span> $group: <span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;_id&#34;</span>: <span style=color:#e6db74>&#34;</span>$milestone<span style=color:#e6db74>.title&#34;</span>, count: <span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;</span>$sum<span style=color:#e6db74>&#34;</span>: <span style=color:#ae81ff>1</span> <span style=color:#f92672>}</span> <span style=color:#f92672>}</span> <span style=color:#f92672>}</span>, <span style=color:#f92672>{</span> $sort: <span style=color:#f92672>{</span> _id: <span style=color:#ae81ff>1</span> <span style=color:#f92672>}}])</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span> _id: <span style=color:#e6db74>&#39;2022-11&#39;</span>, count: <span style=color:#ae81ff>348</span> <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span> _id: <span style=color:#e6db74>&#39;2022-12&#39;</span>, count: <span style=color:#ae81ff>346</span> <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span> _id: <span style=color:#e6db74>&#39;2023-01&#39;</span>, count: <span style=color:#ae81ff>338</span> <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span> _id: <span style=color:#e6db74>&#39;2023-02&#39;</span>, count: <span style=color:#ae81ff>357</span> <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span> _id: <span style=color:#e6db74>&#39;2023-03&#39;</span>, count: <span style=color:#ae81ff>347</span> <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span> _id: <span style=color:#e6db74>&#39;2023-04&#39;</span>, count: <span style=color:#ae81ff>336</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>]</span>
</span></span></code></pre></div><p>担当者別に <code>Enhance</code> ラベルが付いた issues の件数を数えるときには次のようになる。sql を使えないというデメリットを json データをそのままインポートできるメリットの方が上回るときは mongodb のクエリを学ぶ機会になる。私も mongodb の aggregation の実行方法をドキュメントみながらやってた。全然わからないので慣れが必要になる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gitlab&gt; db.issues.aggregate<span style=color:#f92672>([{</span> $group: <span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;_id&#34;</span>: <span style=color:#f92672>{</span> assignee: <span style=color:#e6db74>&#34;</span>$assignee<span style=color:#e6db74>.username&#34;</span>, enhance: <span style=color:#f92672>{</span>$in: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;Enhance&#34;</span>, <span style=color:#e6db74>&#34;</span>$labels<span style=color:#e6db74>&#34;</span><span style=color:#f92672>]}</span> <span style=color:#f92672>}</span>, count: <span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;</span>$sum<span style=color:#e6db74>&#34;</span>: <span style=color:#ae81ff>1</span> <span style=color:#f92672>}</span> <span style=color:#f92672>}</span> <span style=color:#f92672>}</span>, <span style=color:#f92672>{</span>$match: <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;_id.enhance&#34;</span>: true<span style=color:#f92672>}}</span>, <span style=color:#f92672>{</span> $sort: <span style=color:#f92672>{</span> _id: <span style=color:#ae81ff>1</span> <span style=color:#f92672>}}])</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span> _id: <span style=color:#f92672>{</span> assignee: <span style=color:#e6db74>&#39;bob&#39;</span>, enhance: true <span style=color:#f92672>}</span>, count: <span style=color:#ae81ff>84</span> <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span> _id: <span style=color:#f92672>{</span> assignee: <span style=color:#e6db74>&#39;john&#39;</span>, enhance: true <span style=color:#f92672>}</span>, count: <span style=color:#ae81ff>143</span> <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span> _id: <span style=color:#f92672>{</span> assignee: <span style=color:#e6db74>&#39;mary&#39;</span>, enhance: true <span style=color:#f92672>}</span>, count: <span style=color:#ae81ff>53</span> <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span> _id: <span style=color:#f92672>{</span> assignee: <span style=color:#e6db74>&#39;parks&#39;</span>, enhance: true <span style=color:#f92672>}</span>, count: <span style=color:#ae81ff>78</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>]</span>
</span></span></code></pre></div></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0510/>未登記の建物の扱い</a></h1><div class=post-meta><span class=post-date>2023-05-10 (Wed.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/registration/>registration</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#建物の登記>建物の登記</a></li></ul></nav></div><div class=post-content><p>1時に寝て7時に起きた。来週は出張なのでその準備もいるし、連休明けから急に忙しくなってきた。今日も一日中資料を作成していた。来週に東京出張して集中的に打ち合わせする。その叩き台の資料を作っていた。</p><h2 id=建物の登記>建物の登記</h2><p>登記の専門家として <a href=https://www.chosashi.or.jp/investigator/about/>土地家屋調査士</a> という士業があるらしい。相続に関して土地家屋調査士さんと話したので少し書いておく。相続のやり取りで実家の建物を母が相続する段取りで進めていたが、どうやらうちの建物はすべて未登記らしい。土地家屋調査士さんが言うには、未登記の建物は相続できないという。いまは建物を建てると原則として法務局に不動産として登記することが義務付けられている。昔もそうだったかもしれないけど、昔はいまよりも適当だったので未登記の建物がたくさんあるという。</p><p>最近は法律が改正され、未登記だと10万円以下の過料を支払うという罰則が設けられた。しかし、歴史的経緯によって現実として世の中に未登記の建物がたくさんあるとわかっていて、本当にすべての建物に10万円以下の過料を行政が取り立てるのか？というと、土地家屋調査士さんもそれは懐疑的だという。おそらく過渡期においてはなんらかの救済措置が取られるのではないかといった話しもされていた。</p><p>建物が未登記であっても固定資産税の支払いはできるために、実質的に登記というのは誰がその建物を所有しているかを第3者向けに証明するのみに過ぎない。例えば融資を受ける場合には必須となる。他人が住んでいる建物を自分のものだと主張して裁判になるといったことは、普通に生活していて起きることではない。未登記でも実質的に困ることはない。何十年も昔から未登記でそんなことは1度も起こっていない。固定資産税は地方自治体が管理している固定資産税評価額に基づいて支払うため、その金額に基づいて相続税も申告して支払える。土地家屋調査士さんによれば、未登記の建物は相続できないのに。これは行政の管轄の違いによって起きていると推測される。</p><p>そして、いま未登記だということは、祖父から父への相続がなされていないという解釈になるという。そのため、登記にあたって父ではなく、祖父の相続人に対しての確認をした上でいくつかの手順を踏んで登記の手続きを進めないといけないという。</p><ul><li><a href=https://www.yasiro.co.jp/eitaikuyo/media/archives/6972>未登記建物がもたらすリスクとは？登記方法と相続する場合の手続きも解説</a></li></ul><blockquote><p>表題登記を行うためには、司法書士への依頼費用が2〜3万円ほど、土地家屋調査士へ依頼する費用が8〜12万円ほど必要です。</p></blockquote><p>調べていると、なぜ未登記の建物が多いかというと士業への費用を節約するためだという。士業の方々に登記を依頼するとそれなりの費用がかかる。この費用を支払っても得られるメリットがないときにこれまで未登記が選択されてきたという。土地家屋調査士さんに「このまま未登記で困ることありますか？」と聞いたら、親族でお金に困った人が出てきたときにその建物の所有権を主張して云々みたいな話しを始めたので、途中で嫌になって「そのリスクは受け入れます。」と遮ってしまった。ほとんど資産価値のない、田舎にある老朽化した建物を、お金に困った人が所有権を主張するとは現実的に考えにくい。</p><p>うちにとっては未登記の建物のデメリットは事実上ないようにみえる。土地家屋調査士さんの作業だけで登記できるならやってもらって構わないが、祖父からの相続を考慮して親戚をまわって念書と印鑑証明を集めて登記するといったことは、デメリットに対して労力が大き過ぎると私は判断した。相続税は支払うが、建物は未登記／未相続で進めてもらってよいという主旨の回答をした。士業の方々がその要件に納得するかどうかはまだわからない。</p></div></div><div class=pagination><div class=pagination__buttons><a href=/diary/page/40/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span>
</a><a href=/diary/page/42/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>