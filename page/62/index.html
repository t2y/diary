<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.123.1"><title></title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content="t2y"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content><meta property="og:description" content><meta property="og:url" content="/diary/"><meta property="og:site_name" content><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/index.xml rel=alternate type=application/rss+xml title></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1121/>http フレームワークの選び方</a></h1><div class=post-meta><span class=post-date>2022-11-21 (Mon.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/design/>design</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#母の入院>母の入院</a></li><li><a href=#echo-と-chi-でサンプルコードを書いてみた>echo と chi でサンプルコードを書いてみた</a></li></ul></nav></div><div class=post-content><p>昨夜いろいろあって帰ってくるのが0時過ぎになった。23時過ぎから雨降りで雨の中、自転車で帰ってきた。2時に寝て5時に起きて7時半に起きた。危うく寝坊するところだった。</p><h2 id=母の入院>母の入院</h2><p>昨夜のいろいろのすべて。最悪の事態を想定してお手伝い先にも今日休むかも？と昨日の夜時点で一報を入れていた。結論としては休む必要はなかった。「ろれつが回らない」という連絡を受けて姉が救急車で病院へいくことを指示して即検査で即入院した。母は過去に目がみえなくなって脳梗塞だったことがある。幸い一通り検査して問題はなかったものの、念のために2日間入院して明日退院する予定。姉に病院の付き添いとかいろいろやってもらったので、私も週末に帰って様子をみてくる。お仕事が立て込んでてんやわんやだけど、そのために神戸で自分の会社をやっているのもあるので仕方ない。母は車を運転しない方がよいだろうという見立てで週末にレンタカーも借りた。久しぶりに高速バスではなく、高速道路をドライブしながら実家へ帰る。</p><h2 id=echo-と-chi-でサンプルコードを書いてみた>echo と chi でサンプルコードを書いてみた</h2><p><a href=/diary/posts/2022/1117/#go-の-http-フレームワークの選定>go の http フレームワークの選定</a> の続き。明日、定例があるのでメンバーにソースコードを共有しつつ、http フレームワークの採用を決めようと考えている。特定のルーティングとミドルウェアの適用をする簡単なサンプル。</p><ul><li><a href=https://gitlab.com/t2y/echo-sample>https://gitlab.com/t2y/echo-sample</a></li><li><a href=https://gitlab.com/t2y/chi-sample>https://gitlab.com/t2y/chi-sample</a></li></ul><p>net/http のレイヤーであれこれカスタマイズしたいなら <a href=https://github.com/go-chi/chi>chi</a> でよい気もするけど、web api のアプリケーションのレイヤーにのみ注力したいなら <a href=https://echo.labstack.com/>echo</a> を使った方が楽そうという私の第一印象。web api サーバーを書いてて request のパラメーターを扱うことはあっても response writer を扱う必要性をあまり感じたことがない。json しか返さないのだし、構造体を返したら勝手に json に変換してくれたらそれでいいんじゃないかと私は考えている。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1120/>寝ることとお仕事の選び方</a></h1><div class=post-meta><span class=post-date>2022-11-20 (Sun.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/jira/>jira</a>&nbsp;
#<a href=/diary/tags/issue-tracking-system/>issue tracking system</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#睡眠時間と仕事始め>睡眠時間と仕事始め</a></li><li><a href=#仕事を受ける判断>仕事を受ける判断</a></li><li><a href=#jira-の-epic-運用にもの思い>jira の epic 運用にもの思い</a></li></ul></nav></div><div class=post-content><p>20時過ぎに寝て0時に起きて、何度か寝たり起きたりしながら7時に起きた。<a href=https://kobe-marathon.net/2022/>神戸マラソン</a> のスタート地点が近所なので朝から神戸マラソンのアナウンスが聞こえてきた。</p><h2 id=睡眠時間と仕事始め>睡眠時間と仕事始め</h2><p><a href=https://note.com/goto_finance/membership>後藤達也 note</a> の掲示板 (たぶんメンバーしかみれない) に後藤さんがいつ寝ているのかという質問への回答を書かれていた。</p><blockquote><p>よくある睡眠パターンは21:30ごろ～4:30とかだと思います。これだと7時間寝ているので十分です。</p></blockquote><p>後藤さんも早寝早起き派らしい。私はだいたい0-6時が平均的なパターンだと思うけど、ちゃんと眠れないので6時間も寝ていない。体調の悪いときは横になっているものの1-2時間しか寝ていないときもある。7時半までには家を出てオフィスに向かい8時までにはお仕事を始める。開発が佳境に入ってきて集中力が上がっていれば仕事始めが6時半から7時ぐらいになる。開発のピークにそういう時期をもっていくように調整しながら働くときもある。最近は働き方改革でそういった密度の高い開発を要求されることも少なくはなりつつあるけど。</p><h2 id=仕事を受ける判断>仕事を受ける判断</h2><p>後藤さんはすごいなーと読んでいたら睡眠時間の投稿が思いの外盛り上がったらしく、第2段として仕事の選び方について投稿されていた。</p><blockquote><p>そのなかで仕事を受ける判断として大事にしているのが、「発見があるか」「広がりがあるか」です。</p></blockquote><p>これも私にとって共感のある内容でその投稿を読み入ってしまった。これまでも日記のあちこちに断片的には書いてきている。私も2021年1月31日に会社として引き受けないお仕事の基準を設けた。次の項目に該当したら基本的に引き受けない。</p><ul><li>自分の目指すキャリアの延長上にない</li><li>自分がもっている知識や経験だけでできる</li><li>すでにあるものを維持していく、手伝うだけ</li><li>そこそこの開発メンバーがいて人手が足りないのを補うだけ</li><li>権限委譲がなくてイニシアティブを取れない</li></ul><p>どういうお仕事を受けて、どういう働き方をするかを課題管理し、その後も継続的にずっと考えていてまだ答えは出ていない。もう2-3年かければより明確になりそうな気はしている。やりたいことよりもやりたくないことを定義する方がずっと簡単で具体的と言える。</p><h2 id=jira-の-epic-運用にもの思い>jira の epic 運用にもの思い</h2><p>jira に特化した話だけど、チケットの整理をしていて自分の中での結論を言語化できたので書いてみる。前からずっと思っていたことではある。twitter に書いた通りだけど、epic のサブタスクはあまり使わない運用がよいのではないかと思うようになった。そもそも epic という単位が story よりも大きな機能のグルーピングを表す概念なのだから epic チケットはシステム上の制約で存在しているだけでそれを通常のチケットのように扱わなくてもよいのではないかと思う。epic に限らず、チケットを束ねるだけのハブチケットまたは親チケットに通常のチケット機能を設けない方がユーザーにとってわかりやすいようにも考えている。ハブチケットや親チケットに特化した要件や振る舞いはあるはずで、多くの課題管理システムはそれを追求していないようにもみえる。</p><blockquote class=twitter-tweet><p lang=ja dir=ltr>epic の子課題は新機能や改善の種別のみにしてしまう。複数チケットに分割が想定される調査タスクなどの子課題は「○○を研究する」ように新機能や改善に置き換える。epic のサブタスクは階層化を必要としない単発のタスクのみに限定して使う、もしくは一切使わない運用にする。</p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1594185795589795840?ref_src=twsrc%5Etfw">November 20, 2022</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1119/>ふりかえりの目的とワークショップ</a></h1><div class=post-meta><span class=post-date>2022-11-19 (Sat.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/postmortem/>postmortem</a>&nbsp;
#<a href=/diary/tags/workshop/>workshop</a>&nbsp;
#<a href=/diary/tags/community/>community</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ストレッチ>ストレッチ</a></li><li><a href=#ふりかえりとワークショップの定義からコミュニティ作りのなにか>ふりかえりとワークショップの定義からコミュニティ作りのなにか</a></li></ul></nav></div><div class=post-content><p>早めに帰ってきて晩ご飯を食べてからまたオフィスに戻って作業して2時に寝て7時半に起きた。</p><h2 id=ストレッチ>ストレッチ</h2><p>今日の開脚幅は開始前153cmで、ストレッチ後155cmだった。先週よりは体力的に回復しているものの、今週も多忙で椅子に座っている時間が長かったので数値が悪くなっているのかもしれない。基本的には、お仕事が忙しい = 座っている時間が長い = 同じ姿勢の状態を維持する = 筋肉が固まったり運動不足に陥るという理屈で体調が悪化する。今週はなぜか右太ももの前あたりの張りが強かった。逆に腰や全身の負担は軽減したように感じた。開脚幅の数値はよくないものの、先週よりは復調しているような感触。実際のところはまだよくわからない。</p><h2 id=ふりかえりとワークショップの定義からコミュニティ作りのなにか>ふりかえりとワークショップの定義からコミュニティ作りのなにか</h2><p>書籍同様、タイムラインなどでみかけた記事を後で読もうと積ん読しておくときがある。次の記事もおそらく公開時期にみかけて気付いたら積ん読のまま1ヶ月が経過していたのを精読してみた。</p><ul><li><a href=https://research.sakura.ad.jp/2022/10/21/workshop/>価値発見に焦点化した振り返りワークショップの意義と、その教育学的分析</a></li></ul><p>読み始めて、いくつかもの思いにふけりつつ、そこから派生して他の作業もしながら戻ってまた読み進めて、この記事を読むのに5時間かかった。そのぐらい私にとっては示唆のある読み応えのある記事だった。書いてあることのいくつかの点が他の事柄に繋がっていて、その点と線を確認しながら読み進めたので時間がかかってしまった。よくぞこの記事をブックマークしただけで流さなかったと過去の自分に感心したぐらいにはよい記事だった。ワークショップという言葉はよく聞く言葉ではないし、グループワークをする小さいセミナーのイメージを私はもっていた。教育学の分野の研究者によると次のような定義があるらしい。</p><blockquote><p>ワークショップとは</p><ul><li>講義など一方的な知識伝達のスタイルではなく、参加者が自ら参加・体験して共同で何かを学びあったり創り出したりする学びと創造のスタイル (中野民夫, 2001)</li><li>コミュニティ形成 (仲間づくり) のための他者理解と合意形成のエクササイズ (練習) (仮宿俊文, 2017)</li></ul></blockquote><p>ちょうど課題管理の文脈でふりかえりをどう設計しようかを考えていたときにこの記事を読んだ。ふりかえりの目的を多義的に捉えるという発想そのものが私にはなかったのでそういった目的も含め、ふりかえりを実践していければよいのではないかと、自分の中にももともと燻っていた火種を見事に言語化してくれて示唆に富む記事だと感じた。</p><ul><li>既存の業務に対する課題や改善の洗い出し (一般的なふりかえりの目的)</li><li>チームのメンバーとコラボレーションする上で他者の考え方や意見を理解するきっかけの1つにする</li><li>エージェンシーは自分一人では育まれず、同僚や上司、チームや組織との関係性の中で育まれる</li></ul></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1118/>新しいお仕事で3週間</a></h1><div class=post-meta><span class=post-date>2022-11-18 (Fri.)</span></div><span class=post-tags>#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#盛り上がってないイベント>盛り上がってないイベント</a></li><li><a href=#go-の-time-型とタイムゾーン>go の Time 型とタイムゾーン</a></li></ul></nav></div><div class=post-content><p>2時に寝て4時に起きて仮眠して6時半に起きた。たぶん寝たんだろうぐらいの感覚。10月まで対外的には週4日で働いていたのを、11月から週5日フルタイムの働き方に移行して、やっぱりしんどいという実感がある。対外的に週4日でも10月もオフィスに来て自社のお仕事をしていたり、半日ぐらいは社外のお仕事をしたりはしていた。それでも働く義務の有無によって、意識の違いか、プレッシャーやストレスの面からなにか働き方が違うように思える。生活も働き方もまったく同じなのに。</p><h2 id=盛り上がってないイベント>盛り上がってないイベント</h2><p><a href="https://twitter.com/hashtag/techverse_ja?src=hashtag_click&f=live">ハッシュタグ</a> をみてもほとんど関係者や発表者しかコメントしていないようにみえた。過去に新規事業の立ち上げに協力したプロジェクトの発表があると元同僚のタイムラインで知ったのでその発表だけみてみた。私が辞めてから3年ほど経つので新規サービスも追加されていてその内容がメインだったように思う。</p><ul><li><a href=https://tech-verse.me/ja/sessions/133>DataSolution事業を支える技術</a></li></ul><iframe class=speakerdeck-iframe frameborder=0 src=https://speakerdeck.com/player/86cb588632a647e9baf4697c8f79110e title="Technologies that Support the Data Solution Business" allowfullscreen mozallowfullscreen=true webkitallowfullscreen=true style="border:0;background:padding-box padding-box rgba(0,0,0,.1);margin:0;padding:0;border-radius:6px;box-shadow:rgba(0,0,0,.2)0 5px 40px;width:560px;height:314px" data-ratio=1.78343949044586></iframe><p>あまり技術的な内容ではなく、ビジネス向けでもなく、どういった属性の聴衆向けの発表なのか、私にはあまりピンとこなかった。発表の準備不足な印象を受けた。発表を無理やり押し付けられたのかもしれない。</p><h2 id=go-の-time-型とタイムゾーン>go の Time 型とタイムゾーン</h2><p>go の <a href=https://pkg.go.dev/time#Time>Time</a> 型は <a href=https://pkg.go.dev/time#Location>Location</a> をもっていて、タイムゾーンも一緒に扱える。モダンな言語なら時刻を扱うときにタイムゾーンをセットで扱うのでよいと私も思う。タイムゾーンをもっていない時刻型とタイムゾーンを設定するための余分なコードのことを考えずに済む。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>mustGetJST</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Location</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>jst</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>LoadLocation</span>(<span style=color:#e6db74>&#34;Asia/Tokyo&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>jst</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>now</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;now:&#34;</span>, <span style=color:#a6e22e>now</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;jst:&#34;</span>, <span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>In</span>(<span style=color:#a6e22e>mustGetJST</span>()))
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;utc:&#34;</span>, <span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>UTC</span>())
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>実行結果。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ export TZ<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;CET&#34;</span>
</span></span><span style=display:flex><span>$ go run test_time_now.go
</span></span><span style=display:flex><span>now: 2022-11-18 17:00:30.08305121 +0100 CET m<span style=color:#f92672>=</span>+0.000011788
</span></span><span style=display:flex><span>jst: 2022-11-19 01:00:30.08305121 +0900 JST
</span></span><span style=display:flex><span>utc: 2022-11-18 16:00:30.08305121 +0000 UTC
</span></span></code></pre></div></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1117/>技術選定の根拠</a></h1><div class=post-meta><span class=post-date>2022-11-17 (Thu.)</span></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/programming/>programming</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#go-の-http-フレームワークの選定>go の http フレームワークの選定</a></li></ul></nav></div><div class=post-content><p>0時に寝て5時に起きた。夜中に目覚めたかどうかはわからないぐらいにはたぶん寝てたと思う。</p><h2 id=go-の-http-フレームワークの選定>go の http フレームワークの選定</h2><p>net/http で実装していた web api サーバーにフレームワーク導入しようかと考えている。いままでは認証・認可を外部で行う想定だったが、やっぱり api サーバーに実装した方がよいだろうと要件を再確認したので routing と middleware を再利用できるフレームワークを使うメリットが出てくる。net/http 上で直接 routing, middleware を実装するのは別に難しくないから自分で実装すればよいという考え方がある。一方で誰が実装しても大して変わらないものを車輪の再発明する必要があるのかというところに私は懸念に感じる。また <a href=https://pkg.go.dev/context>context</a> があとから標準ライブラリに追加されたため、net/http の HandlerFunc は context をシグネチャにもっていない。リクエストコンテキストをもっていないのが net/http の欠点だと私は考えていた。しかし、調べてたら <a href=https://pkg.go.dev/net/http#NewRequestWithContext>NewRequestWithContext</a> が追加されていてハンドラーではなくリクエストからリクエストコンテキストを扱えるようになっていた。これは私の勘違いだった。</p><p>フレームワークを使おうと決めて難しいのはなにを選ぶか。最近の流行り廃りや動向を私は知らないので基準がない。たまたましぶかわさんの記事をみつけて読んでいた。</p><ul><li><a href=https://future-architect.github.io/articles/20210714a/>Goのおすすめのフレームワークはnet/http</a></li></ul><p>この中で紹介されている <a href=https://github.com/go-chi/chi>chi</a> か <a href=https://echo.labstack.com/>echo</a> のどちらかにしようと直観で決めた。echo は以前 go の勉強会をしたときにいけうちさんが採用していたのでよく覚えている。そのときの話しを聞いていてもよさそうにみえた。たまたま echo のサイトをみたら Shiguredo さんのロゴがあって驚いた。スポンサーをされているらしい。chi はまったく知らない。どちらも十分によく使われていて middleware も揃っているフレームワークにみえる。本質的にはどちらを選んでも構わない。一方でマネージャーとしてどういう調査をして、どういう根拠で、どの技術を選定するのか。メンバーに対して説明責任を果たすためにこの2つのフレームワークの調査をすることに決めた。私自身がどちらもフレームワークも使ったことがないので軽くコードも書いてみてどんな雰囲気なのか感触を掴みつつ、フレームワークのソースコードも読んでみようと思う。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1116/>デジタルノマドへの関心</a></h1><div class=post-meta><span class=post-date>2022-11-16 (Wed.)</span></div><span class=post-tags>#<a href=/diary/tags/mermaid/>mermaid</a>&nbsp;
#<a href=/diary/tags/coworking/>coworking</a>&nbsp;
#<a href=/diary/tags/community/>community</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#pandoc-と-mermaid-charts-の扱い>pandoc と mermaid charts の扱い</a></li><li><a href=#コワーキングのオンラインイベント>コワーキングのオンラインイベント</a></li></ul></nav></div><div class=post-content><p>0時に寝て2時に起きて6時に起きた。いまは眠れる状態に落ち着きつつある。</p><h2 id=pandoc-と-mermaid-charts-の扱い>pandoc と mermaid charts の扱い</h2><p>markdown のドキュメントに <a href=https://mermaid-js.github.io/mermaid/#/>mermaid</a> で図を描く機会が増えてきた。markdown を pdf に変換するツールがあって内部的に pandoc を使っている。そのツールで pdf 変換してみたら mermaid 記法がそのままテキストで出力されたので変換するときに図に置き換えられないかを調べてみた。例えば、次のようにして markdown から html に変換できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pandoc mydoc.md -f gfm -o mydoc.html
</span></span></code></pre></div><p>次のように mermaid 記法がそのまま出力される。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;pre</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;mermaid&#34;</span><span style=color:#f92672>&gt;&lt;code&gt;</span>flowchart TB
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>subgraph cr [Container Registry]
</span></span><span style=display:flex><span>  repo[repository]
</span></span><span style=display:flex><span>end
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>mermaid を cli ツールとして <a href=https://github.com/mermaid-js/mermaid-cli>mermaid-cli</a> がある。markdown を直接渡しても mermaid のコードブロックを検出して画像変換してくれる。複数あってもよい。これはちょっと驚いた。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ git clone git@github.com:mermaid-js/mermaid-cli.git
</span></span><span style=display:flex><span>$ cd mermaid-cli
</span></span><span style=display:flex><span>$ yarn add @mermaid-js/mermaid-cli
</span></span><span style=display:flex><span>$ npx mmdc --version
</span></span><span style=display:flex><span>9.1.7
</span></span><span style=display:flex><span>$ npx mmdc -i mydoc.md -o mydiagram.png
</span></span><span style=display:flex><span>Found <span style=color:#ae81ff>2</span> mermaid charts in Markdown input
</span></span><span style=display:flex><span> ✅ ./mydiagram-1.png
</span></span><span style=display:flex><span> ✅ ./mydiagram-2.png
</span></span></code></pre></div><p>cli でできるなら何とでもなるんじゃないかともう少し調べていたら次の gist をみつけた。</p><ul><li><a href=https://gist.github.com/letientai299/2c974b4f5e7b05be52d369ff8693c29a>Render PDF from Markdonw that using mermaid</a></li></ul><p><a href=https://pandoc.org/filters.html>pandoc filters</a> という仕組みがあって、pandoc の ast を操作するためのインターフェースを提供している。その仕組みを使って mermaid の変換を行う <a href=https://github.com/raghur/mermaid-filter>mermaid-filter</a> を誰かが作ってくれていた。このツールをインストールして次のように pandoc を実行すると base64 でエンコードした画像を使って html に変換できた。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm i -g mermaid-filter
</span></span><span style=display:flex><span>$ pandoc mydoc.md -F mermaid-filter -f gfm -o mydoc.html
</span></span><span style=display:flex><span>$ vi mydoc.html
</span></span><span style=display:flex><span>&lt;p&gt;システム構成図&lt;/p&gt;
</span></span><span style=display:flex><span>&lt;p&gt;&lt;img src<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;data:image/png;base64,iVBORw0KGgoAAAANSU...EnAAAAAElFTkSuQmCC&#34;</span> alt<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> /&gt;&lt;/p&gt;
</span></span></code></pre></div><p>mermaid-cli を使うか mermaid-filter を使うかは要件や好みにもよるけど、すでにツールがあるので組み合わせれば何とかできそうというところまで確認した。</p><h2 id=コワーキングのオンラインイベント>コワーキングのオンラインイベント</h2><p>月例のカフーツさんのオンラインイベントに参加した。<a href=/diary/posts/2022/1029/#コワーキングのオンラインイベント>先月の所感はここ</a> 。いとうさんが岩手県普代村のコワーキングスペースに行ってきてそのお話しから始まった。私はまだ岩手県に行ったことすらないんやけど、めっちゃ田舎の、断崖絶壁の眺めのよい高台にある国民宿舎にコワーキングスペースがあるらしい。</p><ul><li><a href=https://note.com/kanzan10to9/n/n7802c47b1174>人口2500人弱の村でコワーキング運営の研修をしてきた〜ローカルコワーキングこそ地方創生の鍵〜</a></li></ul><p>研修の講師として、いとうさんは呼ばれてワークショップをしたらしい。参加者が付箋に課題を書き出してグループワークするといった作業に不慣れで、グループ内で話しはしているものの、あまり付箋に書いてくれなかったとかぼやいていた。<a href=https://www.soumu.go.jp/main_sosiki/jichi_gyousei/c-gyousei/02gyosei08_03000066.html>地域おこし協力隊</a> として19歳の隊員が参加者にいたらしい。19歳で地域おこし協力隊になれるの？といとうさんが驚いていた。どうやら年齢は自治体の募集要項次第らしく、たまたま普代村の要項が18歳以上で自治体もまさかそんな若い人がくるとは思ってなかったと19歳の隊員が活躍していたという。若いから頭の回転も速いし活発でワークショップもてきぱきとこなしていたらしい。</p><p>先月のお仕事探しでマネージャー実績のない私を雇う会社はほぼないという現実に直面した。いまのお仕事を終えた後で、地域おこし協力隊の要件を私が満たすなら課題管理を実践する場として行ってみてもいいかもしれないなと話しを聞いていて少し思った。ソフトウェア開発に特化した課題管理しかできないというスコープの狭さが私のスキルの欠点でもある。仮に地域おこし協力隊としてなにかに役立てられるなら、そのスコープをさらに広げられる可能性も出てくる。</p><p>それから次の記事の話題に移っていった。<a href=https://nomadlist.com/>Nomad List</a> というデジタルノマド向けポータル兼 sns のようなサイトを紹介してくれた。</p><ul><li><a href=https://workmill.jp/jp/webzine/future-coworking-20221108/>世界のデジタルノマドが集まるサイトはホスピタリティに満ちている　テクノロジーとヒトが持ち寄る情報の力</a></li></ul><p>試しに <a href=https://nomadlist.com/kobe>kobe</a> のスコアをみてみる。現時点のランキングは1182位と低い。日本はこの2年ほどコロナ禍で鎖国していたからノマドを受け入れてないのでどの都市もランキングは下がっているらしい。ざっとみてスコアがよくないのは次の項目。神戸に住んでいる私の感覚とも合致しているのでこのスコアは一定の信頼ができると思う。神戸の大半のお店は21時までには閉まるし、スタートアップ企業なんか数えるほどしかいない。とはいえ、全体としてはスコアは良好だし世界に誇れる都市の1つとしてデジタルノマドを受け入れる器はあると思う。</p><ul><li>Cost</li><li>Vulnerability to climate change</li><li>English speaking</li><li>Nightlife</li><li>Free WiFi in city</li><li>Startup Score</li></ul><figure><img src=/diary/img/2022/1116_nomadlist-kobe.png></figure><p>あと <a href=https://livinganywherecommons.com/base/mima/>徳島県美馬市脇町</a> の町興しのようなコワーキングやデジタルノマド向けの取り組みの話しがあって関心をもって聞いていた。徳島県なら実家から近い。こんな場所あったんやと聞いていた。このサイトで紹介されているのどけやさんというゲストハウスはいつ行っても外国人がいるといとうさんが話されていた。そう言われると本当なんやろか？と確かめに行きたくなる。たぶん実家から車で1時間もあれば行けそうな気がする。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1115/>課題の洗い出し</a></h1><div class=post-meta><span class=post-date>2022-11-15 (Tue.)</span></div><span class=post-tags>#<a href=/diary/tags/issue-tracking-system/>issue tracking system</a>&nbsp;
#<a href=/diary/tags/management/>management</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ソースコードを読むマネージャー>ソースコードを読むマネージャー</a></li></ul></nav></div><div class=post-content><p>20時に寝て0時に起きて、3時に起きて6時に起きた。春先のような、なぜかたくさん眠れる状態になった。</p><h2 id=ソースコードを読むマネージャー>ソースコードを読むマネージャー</h2><p>アリエルをやめてから複数の組織で働いてきたけれど、以降ソースコードを読むマネージャーを1人もみたことがない。アリエルなんか cto が日々の開発のソースコードを読んでいたぐらいなのに。もしかしたらテックリードというマネジメントはしないが、開発のリーダー役のポジションができたせいかもしれない。そしてエンジニアリングマネージャーがソースコードを読んでいるのも見たことがない。いま私はプロダクト開発のマネージャーとしてお手伝いしているわけだけど、毎日変わるソースコードを読みながら、私が懸念に思ったコードについて issue 登録したり、技術的な課題であれば改善提案したりしている。もし開発リソースが足りそうになければ、私も開発に参戦しようと虎視眈々と狙っているのもある。</p><p>まだ初期開発フェーズなので粗いところが多々あるから読みがいがある (提案しやすい) というのもあるかもしれない。ソースコードも読めない (読まない) マネージャーが開発の進捗を正しく検査できると私は考えていない。その姿勢でプロジェクトマネジメントがどのように進捗して、どのような結果になるのか、これから私が実践して自分なりの考えをまとめたい。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1114/>久しぶりに go のテストコードを書いた</a></h1><div class=post-meta><span class=post-date>2022-11-14 (Mon.)</span></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/testing/>testing</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#go-のテストコードのサンプル>go のテストコードのサンプル</a></li><li><a href=#uuid-ライブラリの歴史的経緯>uuid ライブラリの歴史的経緯</a></li></ul></nav></div><div class=post-content><p>0時に寝て3時と5時に起きて7時に起きた。まぁまぁ眠れたと思う。</p><h2 id=go-のテストコードのサンプル>go のテストコードのサンプル</h2><p>先日 <a href=/diary/posts/2022/1111/#Logger-の再実装>Logger のコード</a> を書いて、テストコードのサンプルも書いてみた。いま微妙に <a href=https://github.com/golang/go/wiki/TableDrivenTests>TableDrivenTests</a> が書けてないので参照実装として Logger のデータ駆動テストを書いてチームに共有した。私も future さんのテストのチュートリアル記事を読みながら復習してた。</p><ul><li><a href=https://future-architect.github.io/articles/20200601/>Goのテストに入門してみよう！</a></li></ul><p>昔、私が go 開発していた頃にはなかった新機能としてサブテストを並列に実行できる。</p><ul><li><a href=https://pkg.go.dev/testing#hdr-Subtests_and_Sub_benchmarks>Subtests and Sub-benchmarks</a></li></ul><h2 id=uuid-ライブラリの歴史的経緯>uuid ライブラリの歴史的経緯</h2><p>たまたま Version 1 UUID を返す <a href=https://pkg.go.dev/github.com/google/UUID#NewUUID>NewUUID</a> のコードをみていて、err を返しているけど、現時点の実装では err が返ることはなく、これは歴史的経緯でシグネチャを変える方が影響が大きいだろうという意図でそうなっているらしい。</p><ul><li><a href=https://github.com/google/uuid/issues/83>https://github.com/google/uuid/issues/83</a></li></ul><p>ここでは <a href=https://pkg.go.dev/github.com/google/UUID#New>New</a> を使えとも書いてあるけれど、これはエラーが発生したときに panic が発生するのでこれはこれでいいんやろか？という疑問も出てくる。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1113/>ftx 事件</a></h1><div class=post-meta><span class=post-date>2022-11-13 (Sun.)</span></div><span class=post-tags>#<a href=/diary/tags/cryptocurrency/>cryptocurrency</a>&nbsp;
#<a href=/diary/tags/economy/>economy</a>&nbsp;
#<a href=/diary/tags/web3/>web3</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ftx-破産事件>ftx 破産事件</a></li></ul></nav></div><div class=post-content><p>眠くて19時には帰ってきて、20時ぐらいには寝て、夜に何度か起きても寝て、9時まで寝ていた。疲労過多でなんもやる気しない。</p><h2 id=ftx-破産事件>ftx 破産事件</h2><p>金曜日ぐらいから大きな事件のようにタイムラインで話題になっていたので経済や金融の勉強の1つとして事件の成り行きを調べていた。いくつかニュース記事を読んだ。直近の数日間の時系列をまとめたものが次の記事になる。</p><ul><li><a href="https://coinpost.jp/?p=406333">仮想通貨市場に激震、アラメダショックとFTX騒動の動向まとめ</a></li></ul><p>過去の経緯や人間関係がわりと複雑らしいので時間がない人は次のフィクションを読んで雰囲気を理解するとよさそう。あくまでフィクション。</p><ul><li><a href=https://note.com/shinjiro_tigers/n/nf7f11fa7989b>猿でも分かる？　FTX破産騒動</a></li></ul><p>twitter のタイムラインでもいろいろみつかる。数億円もの暗号資産をすべて ftx に置いていて資産を失った人。</p><blockquote class=twitter-tweet><p lang=ja dir=ltr>Now on public. 公開します<br>All gone 全て逝きました <a href=https://t.co/iQBaLo19ud>pic.twitter.com/iQBaLo19ud</a></p>&mdash; ダニエル 全資産FTX (@Daniel58656357) <a href="https://twitter.com/Daniel58656357/status/1591414911179325440?ref_src=twsrc%5Etfw">November 12, 2022</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>今後の暗号資産や web3 界隈の資金繰りを心配する人。</p><blockquote class=twitter-tweet><p lang=ja dir=ltr>もっと正直に言うと↓<br><br>今引所、何とかプロダクト、何とかNFT関係、何とかDAO、何とかWeb3で務めてる方々へ：あなたが務めている会社（組織）の資金ぐりは今後急速に悪化します。その時に打つ手はあなたをクビにするしかない。だったら早めに転職の準備をしても１つの手、するかどうかは別としても。</p>&mdash; Sonny Wang｜生涯努力家 (@LinksSonny) <a href="https://twitter.com/LinksSonny/status/1591384722105864194?ref_src=twsrc%5Etfw">November 12, 2022</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>破産申請された内容から負債総額は100億ドルから500億ドル (1.4超円から7超円) の間とされていて、リーマンショックの負債総額は約6,000億ドル（約64兆円）だったことから規模はその10分の1ぐらい。また取引所にある顧客資産を流用していたことが発覚していることから、これはポンジ・スキームに近いものらしく、会社ぐるみで不正をしていたエンロンショックに近い詐欺事件として当局の調査もこれから行われていくらしい。今後、不正の手口なども明らかになっていくのだろうから経営や財務の勉強材料にする。</p><p>現時点で私が ftx 破産事件から学んだことはこれら。どのぐらい経済の影響を与えるのか、まだよくわからないのでしばらく注視していく。</p><ul><li>姉妹会社であるアラメダリサーチ社の資産の大半が ftx トレーディング社が発行するトークン (ftx token) で構成 (25%) されていた<ul><li>他の資産も流動性の低いトークンで構成されていて売却時のコストを考慮すると資産の評価は適切ではない懸念が指摘された暴露記事が騒動の発端</li><li>現金及び現金等価物は20億ドルしかなかった</li></ul></li><li>取引所が発行するトークンを、取引所同士で大量に持ち合いして価値の下支えをしている<ul><li>こういったトークンは流動性がないことから、大量保有者が売ると大幅に価値が下落する</li><li>ftx トレーディング社は自分たちで発行したトークンでグループ企業の資産価値を過剰に高くみせていた</li></ul></li><li>ftx トレーディング社の社長 (Sam Bankman-Fried) は経理システムにバックドアを作っていて顧客資産を流用していた<ul><li>破産申請の前夜にそのバックドアが使われて100億ドルの顧客資金が社長の投資会社に移され、そのうちの10億ドルから20億ドルの行方が分からなくなっている<ul><li>誰が何のためにバックドアを利用して資金移動したのかはまだ調査中</li></ul></li></ul></li><li>1つの取引所にすべての暗号資産を置かないこと</li><li>取引所に暗号資産をずっと置きっぱなしにしないこと</li><li>暗号資産はまったく安全ではないこと<ul><li>取引所という脆弱性、普通に盗難されるし、不正されるし、破産したら資産を失う</li></ul></li></ul></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1112/>go の nil を学び直し</a></h1><div class=post-meta><span class=post-date>2022-11-12 (Sat.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ストレッチ>ストレッチ</a></li><li><a href=#オンライン読書会>オンライン読書会</a></li></ul></nav></div><div class=post-content><p>3時半から起きていたせいか夕方に眠くなって19時過ぎから23時まで寝て、それからまたオフィス行って4時ぐらいまで作業してから戻って寝て8時半に起きた。生活がめちゃくちゃ。</p><h2 id=ストレッチ>ストレッチ</h2><p>今日の開脚幅は開始前154cmで、ストレッチ後158cmだった。生活が不規則になって体力的にバテているのもあって右股関節、右腰の張りが強かった。さらに加えてふくらはぎ、腕と全身的にいつもより張りがあるように感じた。トレーナーさんが言うには座っている時間がいつもの週より多かったならその分だけ筋肉が固まってしまう可能性はあるとのこと。先週の東京出張から帰ってきて、リモート環境の構築、macbook 環境でメモをとった内容の見直し、リモートワークでマネージャー業をやるための準備や足りない知識の習得とか、さらに2つの社外イベントにも参加していたので普段の週よりも長い時間を机に向かって作業していたのは正しい。新しいお仕事を受けると一時的に仕事量の負荷が増える。それ自体は悪いことではないけれど、2-3ヶ月は余裕のない生活になりそうな気がする。毎週ストレッチがあるとそういった過労の疲労軽減に役立ってくれているので助かっている。</p><h2 id=オンライン読書会>オンライン読書会</h2><p>ずっと参加しようと思いつつ、都合があわなくて参加できていなかった <a href=https://technical-book-reading-2.connpass.com/event/262819/>第4回『Go言語による分散サービス』オンライン読書会</a> に4回目にして初参加した。7.4 発見されたサービスにリクエストし、ログをレプリケーションする (130ページ) から 8.2.3 有限ステートマシーン (163ページ) まで読んだ。途中からなので過去の経緯はわからないものの、柴田さんが詳しく解説してくれるのでまったくついていけないということはならなかった。出てくるサンプルコードのスニペットからでも学ぶことは多々ある。effective java 読書会に参加してた人だと柴田さんに覚えていてもらっていて嬉しかった。おそらく参加者の記録を自前で管理されているようにみえた。</p><p>go でインターフェースを実装しているかを確認するイディオムとして次のような宣言がある。nil を任意の struct のポインタにキャストするのを試す。変数は _ を宣言しているので実際にはこのコードはなにも定義しない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>_</span> <span style=color:#a6e22e>mypkg</span>.<span style=color:#a6e22e>MyInterface</span> = (<span style=color:#f92672>*</span><span style=color:#a6e22e>MyImplements</span>)(<span style=color:#66d9ef>nil</span>)
</span></span></code></pre></div><p>なぜこんなことができるのかは <a href=https://text.baldanders.info/golang/nil-is-nil/>nil は nil</a> という記事で解説されている。interface 型は型への参照と値への参照を属性にもつオブジェクトであり、そのゼロ値は nil である。interface 型の nil は型への参照をもっているから nil をキャストするといったコードを書ける。python や java のような言語で nil に相当する None や null といった primitive はキャストするといった概念はない。事実上のシングルトンと言ってよいはず。一方で go の nil は原則として型への参照 nil 且つ、値への参照も nil なものではあるが、interface 型のゼロ値を表すため、この例で言えば、型への参照として mypkg.MyInterface 且つ、値への参照が nil のオブジェクトを生成できる。シングルトンではない。つまり <code>(*MyImplements)(nil) != nil</code> となる。go の nil は他言語からみて特殊ということを知ってはいたんだけど、読書会に出てそのことを確認するサンプルコードをみつけたことで私の学び直しになった。感謝。</p><p>ソースコードはここに置いた。</p><ul><li><a href=https://gitlab.com/t2y/misc/-/tree/main/implements>https://gitlab.com/t2y/misc/-/tree/main/implements</a></li></ul></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1111/>ログおじさん</a></h1><div class=post-meta><span class=post-date>2022-11-11 (Fri.)</span></div><span class=post-tags>#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
#<a href=/diary/tags/mermaid/>mermaid</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/logging/>logging</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#システム構成の検討>システム構成の検討</a></li><li><a href=#logger-の再実装>Logger の再実装</a></li></ul></nav></div><div class=post-content><p>23時に寝て3時半に起きて眠れそうになかったからそのまま5時からオフィスで作業してた。</p><h2 id=システム構成の検討>システム構成の検討</h2><p>コンサルタントから顧客要件のヒアリングを行い、プロダクトを提供するインフラのシステム概要を mermaid で書いた。オンプレとクラウド環境のそれぞれを同じコンテナアプリケーションで動かすための構成を検討した。クラウド環境の一例として aws の構成を考えていて、https と http のプロトコル変換のようなことをするには api gateway を経由しないといけないと考えていたら、alb に証明書を設定して api gateway なくてもいけるとはらさんに教えてもらった。昔からできたそうで、なぜか私が長い間ずっと勘違いしていた。また時間があるときに自分でもやってみようと思う。</p><ul><li><a href=https://dev.classmethod.jp/articles/for-begginer-ssl-communication-by-aws-certificate-manager/>AWS Certificate Managerを使用してインターネットからELBへの通信をHTTPS化してみた</a></li></ul><h2 id=logger-の再実装>Logger の再実装</h2><p>プロダクトのコアな部分の実装は私がみた方がよいだろうと考えていて、そのうちの1つ Logger の設計がよくなかったので私が作り直した。といっても <a href=https://github.com/cybozu-go/log>cybozu-go/log</a> を使った薄いラッパーを設けただけ。チームメンバーからどこでエラーが起きているか追跡しにくいという声があったのでログ出力したところのソースコードの情報を出力しようと考えた。ググればたくさん出てくる。スタックフレームにアクセスする標準パッケージとして runtime を使うとできる。<a href=https://pkg.go.dev/runtime#Caller>runtime.Caller</a> と runtime.Callers は似て非なる関数のようでファイル名と行番号だけでよければ Caller を使った方がシンプルになると思う。関数名もほしかったら Callers を使ったスタックフレーム自体から取得する必要がある。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Trace</span>(<span style=color:#a6e22e>skip</span> <span style=color:#66d9ef>int</span>) (<span style=color:#a6e22e>file</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>funcName</span> <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pc</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>uintptr</span>, <span style=color:#ae81ff>15</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>n</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>Callers</span>(<span style=color:#a6e22e>skip</span>, <span style=color:#a6e22e>pc</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>frames</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>CallersFrames</span>(<span style=color:#a6e22e>pc</span>[:<span style=color:#a6e22e>n</span>])
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>frame</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>frames</span>.<span style=color:#a6e22e>Next</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>_file</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>frame</span>.<span style=color:#a6e22e>File</span>[<span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Index</span>(<span style=color:#a6e22e>frame</span>.<span style=color:#a6e22e>File</span>, <span style=color:#a6e22e>sourceRepositoryPath</span>)<span style=color:#f92672>+</span><span style=color:#ae81ff>8</span>:]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>file</span> = <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;%s:%d&#34;</span>, <span style=color:#a6e22e>_file</span>, <span style=color:#a6e22e>frame</span>.<span style=color:#a6e22e>Line</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>frame</span>.<span style=color:#a6e22e>Function</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>この情報を cybozu-go/log の map に追加するようなログ関数を提供するようにした。cybozu-go/log は標準の log パッケージに足りないところだけを追加していて、そのシンプルさと拡張性の高さを私は気に入ってよく使っている。私が気に入っているのでもっと有名になってほしい。</p><p>前のお手伝いでもログ基盤を含めて Logger を作っていて、またいまも Logger を作り直していて、気付いたら私は Logger やログ出力に一家言あるような、ログおじさんになりつつある。</p></div></div><div class=pagination><div class=pagination__buttons><a href=/diary/page/61/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span>
</a><a href=/diary/page/63/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>