<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.123.1"><title></title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content="t2y"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content><meta property="og:description" content><meta property="og:url" content="/diary/"><meta property="og:site_name" content><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/index.xml rel=alternate type=application/rss+xml title></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0907/>組織やプロジェクト横断的なメトリクスの視覚化</a></h1><div class=post-meta><span class=post-date>2023-09-07 (Thu.)</span></div><span class=post-tags>#<a href=/diary/tags/ldap/>ldap</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/issue-management/>issue management</a>&nbsp;
#<a href=/diary/tags/information-exchange/>information exchange</a>&nbsp;
#<a href=/diary/tags/visualization/>visualization</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#dirsync-周りのリファクタリング>dirsync 周りのリファクタリング</a></li><li><a href=#go-イベントのパネルディスカッション>go イベントのパネルディスカッション</a><ul><li><a href=#gonew-の提供>gonew の提供</a></li><li><a href=#derrors-の是非>derrors の是非</a></li><li><a href=#go-2-はもうリリースされない>go 2 はもうリリースされない</a></li></ul></li></ul></nav></div><div class=post-content><p>0時に寝て4時に起きてもう1回ぐらい起きて6時半に起きた。</p><p>もうすぐ期限がやってくる。私が担当している issue 対応はあらかた終わってメンバーに「大きいもので見落としある？」って尋ねて「ない」って返ってきたのでもうクローズに向けて調整していく感じ。今週末から月曜日と3日間お休みする (土日も含めて休むというのも変ではあるが) ので一安心。</p><h2 id=dirsync-周りのリファクタリング>dirsync 周りのリファクタリング</h2><p>ずっとレビューが放置されていた。おそらくいま go-ldap のプロジェクトで最も活発なメンテナーが夏休みだったのではないかと推測する。昨日帰ってきたようで怒涛のレビューをされていて、私が3週間前に送っていた pr もレビューしてくれた。</p><ul><li><a href=https://github.com/go-ldap/ldap/pull/458>Refactor DirSync search process #458</a></li></ul><p>概ね同意してくれて public な関数名をより適切な関数名に変えたところを、1度公開したものは互換性を維持するために deprecated のコメントをして残しておいてと言われたところだけ修正した。修正後、数時間ですぐにマージしてくれた。感謝。</p><p>go-ldap にいくつかコントリビュートした機能はうちのプロダクトのシステムに使われていて、それなりの qa テストをやった上で動いているので一定の品質は担保していると思う。<a href="https://github.com/go-ldap/ldap/graphs/contributors?from=2022-09-08&to=2023-09-07&type=c">直近1年間のコントリビューター</a> を参照すると、私は2番目に貢献しているようにみえる。こういう見える化が自分のモチベーションになるならそれはそれでよいと思う。</p><figure><img src=/diary/img/2023/0907_contributor.png></figure><p>組み込みの課題管理のプロダクトを作る上で、個人がみたいメトリクスを簡単に集計できるような機能を提供しようと考えている。それは自分が伸ばしたいスキルやプラクティスに対して、会社やプロダクトを横断的に計測できる仕組みがあるといいと私は考えている。とくにいまどきはプログラマーが転職するのは当たり前だが、転職したら前の会社でやっていたメトリクスがみれないとか、別の会社でのメトリクスと相対比較したいとか、そういうニーズはあるなと私自身が感じているからでもある。</p><h2 id=go-イベントのパネルディスカッション>go イベントのパネルディスカッション</h2><p><a href=https://mercari.connpass.com/event/294164/>mercari.go #23 Go1.21 パネルディスカッション オンライン開催</a> に参加した。視聴者が少なかったのか、youtube のコメント欄でちょくちょくツッコミもいれたら現場で拾ってくれておもしろかった。私が関心のあった話題を3つあげてみる。</p><h3 id=gonew-の提供>gonew の提供</h3><blockquote><p>For a long time now, we have heard from Go developers that getting started is often the hardest part.</p><p><a href=https://go.dev/blog/gonew>Experimenting with project templates</a></p></blockquote><p>go で新規プロジェクトを始めるときにテンプレートからプロジェクトのレイアウトを作ってくれるユーティリティとして gonew というツールが公式から提供されたらしい。知らんかった。私も新しいリポジトリ作るときに標準的なものはファイルを基本コピペしているのでこういうのできれいに作れると嬉しいかもしれない。
￼</p><h3 id=derrors-の是非>derrors の是非</h3><p><a href=https://github.com/golang/pkgsite>pkgsite</a> という pkg.go.dev というサイトのリポジトリの internal として実装されている derrors というパッケージがある。defer を使って必ず関数がエラーを返すときに wrap するという、ユニークな発想で実装されたツール。明示的なコードを書くという go の文化とはあわない気はするけど、ユニークな使い方ではあるのでおもしろい。</p><ul><li><a href=https://github.com/golang/pkgsite/blob/master/internal/derrors/derrors.go>https://github.com/golang/pkgsite/blob/master/internal/derrors/derrors.go</a></li></ul><p>この延長でエラーが発生したときにレポートを生成する derrors のユーティリティもあったりする。google がやっていることだから、わりと開発者間でもこれと同じものを自前で実装する開発者が増えているといった話しも聞く。</p><h3 id=go-2-はもうリリースされない>go 2 はもうリリースされない</h3><blockquote><p>The answer is never. Go 2, in the sense of breaking with the past and no longer compiling old programs, is never going to happen. Go 2 in the sense of being the major revision of Go 1 we started toward in 2017 has already happened.</p><p><a href=https://go.dev/blog/compat>Backward Compatibility, Go 1.21, and Go 2</a></p></blockquote><p>これまでの go の言語処理系の開発の中で非互換な変更について「go 2 で」とプロポーザルだったり、issue の議論で先送りされてきた。最近コア開発者の Russ Cox 氏が (現時点で) go 2 はもう出ないと宣言した。go は既存のプログラムをコンパイルできない状態で新しいバージョンを出すことはしない。この背景の1つとして、誰もがジェネリクスの導入で go の互換性は崩れると思っていたものが互換性を維持して導入できたことが大きいと思う。(現時点で) go 2 はもうリリースされないらしい。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0906/>openldap サーバーのデバッグ</a></h1><div class=post-meta><span class=post-date>2023-09-06 (Wed.)</span></div><span class=post-tags>#<a href=/diary/tags/ldap/>ldap</a>&nbsp;
#<a href=/diary/tags/debug/>debug</a>&nbsp;
#<a href=/diary/tags/testing/>testing</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#openldap-25-の-ldappasswd-の振る舞い>openldap 2.5 の ldappasswd の振る舞い</a></li></ul></nav></div><div class=post-content><p>1時に寝て3時に起きて5時に起きて6時半に起きた。あとひと踏ん張りなのでこのまま突っ切る。</p><h2 id=openldap-25-の-ldappasswd-の振る舞い>openldap 2.5 の ldappasswd の振る舞い</h2><p>openldap サーバーでパスワードを変更時の平文パスワードを連携するために <a href=/diary/posts/2023/0525/#カスタム-overlay-モジュールの改修>カスタム overlay モジュール</a> を使っている。前回の改修をしたときは openldap 2.4 向けのみの振る舞いを検証していた。今回は開発フェーズでは openldap 2.5 向けにもモジュールをビルドしてパッケージングしていた。その qa テストをしていて ldappasswd だけ、意図したパスワード連携が行われないという。</p><p>開発時に私が振る舞いを検証したつもりが ldapadd, ldapmodify は確認済みだったが、ldappasswd の確認をしていなかった。これは完全に私のミスで2つのフックポイントに対してカスタム overlay モジュールが動くのだから ldappasswd も大丈夫だろうと見通していた。しかし、そうではなかった。それぞれにフックポイントのコールバック設定があって、フックポイントもロジックが違うのだから当然ではあるのだけど、ちゃんと動作検証をしないといけないという、初歩的なミスをした。こんなこともあるんやと反省した。</p><p>gdb でデバッグしていて原因は 2.5.3 に含まれる次の修正だとわかった。私が検証していた openldap サーバーのバージョンは 2.5.14 だった。</p><ul><li><a href="https://bugs.openldap.org/show_bug.cgi?id=8698">Issue 8698 - ppolicy: responses from pwdCheckModule discarded when using an extended password modify</a></li><li><a href=https://git.openldap.org/openldap/openldap/-/merge_requests/304/diffs>ITS#8698 Propagate policy checker message through even if using PW Extop</a></li></ul><p>簡潔に言えば、なんらかの不具合対応でもともと設定してあるコールバックを別のものに上書きしていた。カスタム overlay モジュールが設定したコールバックが別のものに上書きされてしまって意図した振る舞いをしないという現象が起きていた。これは明らかに openldap のリグレッションなので 2.5.15 で修正されてた。</p><ul><li><a href="https://bugs.openldap.org/show_bug.cgi?id=9990">Issue 9990 - Part of the ITS#8698 fix breaks exop overlays that set a callback</a></li></ul><p>たまたまピンポイントにバグを踏んだ形にはなったが、qa テストという別の人がテストをする仕組みでこのバグを検出できたことがうちの開発の品質基準を担保していることの表れでもある。</p><blockquote><p>生きるということは嬉しいこと半分、辛いこと半分なのですよ。 采王</p></blockquote></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0905/>開発フェーズの完了まであと2週間</a></h1><div class=post-meta><span class=post-date>2023-09-05 (Tue.)</span></div><span class=post-tags>#<a href=/diary/tags/project-management/>project management</a>&nbsp;
#<a href=/diary/tags/issue-management/>issue management</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#定例会議>定例会議</a></li></ul></nav></div><div class=post-content><p>0時に寝て何度か起きて7時に起きた。オーバートレーニング気味で夜帰ってきてゆっくり過ごしている。</p><h2 id=定例会議>定例会議</h2><p>次のマイルストーンでこの開発フェーズを完了させる。その最後の打ち合わせとなる定例会議。話題が多過ぎて、始める前から今日の会議は1時間におさまらないんじゃないかと話しながら始めて10分ほどオーバーして終えた。会議時間が私の感覚とも一致していてよかった (違う) 。</p><p>qa テストでいろいろ issue が洗い出されていて、その中のアーキテクチャや仕様の抜本的な見直しを検討するのが2つ、管理画面の ui/ux に関する設計の2つ、よいことではあるが、私の設計の目が及ぶ範囲を超えて issue が上がるようになりつつある。本当はフロントエンド向けに ui/ux デザイナーがいれば画面設計について委譲したいところだが、そんな人はいないのでチームで話し合い、私が方針を決めて暫定的に修正していく。</p><p>また致命的な issue は出ていないという私の認識から、次の2週間でこの開発は収束させるという合意を行った。やや qa テストや issue の収束は遅れ気味ではある。いまから慌てても大きく変わることはないし、このチームは十分に私の課題管理の慣習にしたがって作業しているので、このまま成り行きでもうまく着地できるんじゃないかなと楽観的には考えている。その感覚は過去の経験からも来ているのだろうけど、もうこの歳になると脳ができることを自動的に判断している気がする。できるとわかっているから不安や焦燥感といった危機を感じられない。悪い言い方をするとさぼっているだけという見方もあるが、そういう感覚をここ2-3年で実感するようになってきた。</p><p>会議が終わってから私は reflection 関連のバグを2つ直した。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0904/>週末遊んで月曜日を迎える</a></h1><div class=post-meta><span class=post-date>2023-09-04 (Mon.)</span></div><span class=post-tags>#<a href=/diary/tags/testing/>testing</a>&nbsp;
#<a href=/diary/tags/issue-management/>issue management</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#qa-テストとバグ修正>qa テストとバグ修正</a></li></ul></nav></div><div class=post-content><p>21時に寝て何度か起きて7時に起きた。決して夜更ししているわけでもないのにずっと疲れている感があって早めに寝ていた。それでさらにお仕事が溜まる。</p><h2 id=qa-テストとバグ修正>qa テストとバグ修正</h2><p>先々週から qa テストが始まっていて、私はあまり参加できていないけれど、上がってくる issue のトリアージや致命的なバグの修正、インフラ周りの不具合の修正などをしている。1つは1つは難しくない小さい粒度のものだけれど、他の issue との関連があったり、アーキテクチャや既存の仕様そのものを見直した方がよいものもあったりと、背景の調査に時間がかかっていて、思ったよりも「ちぎっては投げちぎっては投げ」といった対応は取れていない。issue の優先順位付けしようにも、先に解決しないといけない issue があったり、この仕様はそもそもおかしいとか、よいことではあるのだけど qa でみつかる issue のトリアージが難しくなっている。それだけメンバーのシステムへの習熟度が上がって精度の高い issue をあげられるようになってきたという現れでもある。私がまごまごしているのは紛れもない事実ではある。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0903/>LT 資料のたたき台作り</a></h1><div class=post-meta><span class=post-date>2023-09-03 (Sun.)</span></div><span class=post-tags>#<a href=/diary/tags/translation/>translation</a>&nbsp;
#<a href=/diary/tags/sns/>sns</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/marketing/>marketing</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#昨日の翻訳の手直し>昨日の翻訳の手直し</a></li><li><a href=#lt-資料の作成>LT 資料の作成</a></li></ul></nav></div><div class=post-content><p>3時に寝て朝起きたものの、体調がよくなくて10時まで寝てた。朝ご飯をゆっくり作って食べてからお昼前にオフィスへ着いた。</p><h2 id=昨日の翻訳の手直し>昨日の翻訳の手直し</h2><p><a href=/diary/posts/2023/0902/#deepl-で翻訳したものの手直し>昨日の推敲途中で公開した記事</a> の手直しから行う。後半眠くなってしまいチェックできてなくて、先に公開しちゃえってやったらいろいろ不備があって直していた。どうせ誰も読まないだろうと思ったら、ぽつぽつアクセスが増えてきてお昼ぐらいにはホットエントリーになっていたかもしれない。午前中に読んだ人はひどい記事の体裁でごめんなさいという気分だ。</p><p>この記事はうちの会社の社内 sns にしか共有していない (たぶん知人もなにもしていない) のに、ホットエントリーになっているのをみて、本当によい記事ならほとんど宣伝しなくても勝手に広まるというのを実感した。私は基本的に sns をやめようと考えていて facebook 以外はほぼやっていない。facebook を年賀状のような使い方にしている。年に1回、私の近況を見にきた方が近況を分かるようにだけしている。あとはお仕事の依頼がたまにくるのでそういった人たちとのインタフェースとして置いておく。とはいえ、依頼がきても9割は断るしかないというのがうちの会社のいまの辛いところでもある。以前2つの会社のお仕事を掛け持ちして大失敗したため、色気を出さず、できないお仕事は受けないというのを徹底している。</p><h2 id=lt-資料の作成>LT 資料の作成</h2><p>来週 <a href=https://osk.connpass.com/event/292551/>オープンセミナー2023@香川</a> で LT してくる。そのための資料のたたき台を作った。課題管理に関する話題なので会社として発表してこようと思う。会社用のスライドテンプレートを使って2回目の発表となる。こういったマーケティング活動も、本当は昨年からどんどんやるつもりが、まったくお仕事がうまく進んでなくて後手後手後手といった状況。昨年は1年の計画のうち1割しかやっていなかった。</p><ul><li>貧すれば鈍す</li><li>窮すれば濫す</li><li>貧乏暇なし</li></ul><p>こういう言葉が似合う。がんばってもがんばってもお仕事が終わらず、もしかしたら加齢でパフォーマンスも落ちているのか、モチベーションコントロールが出来てなくて集中力が低いのかもしれない。あと実家のいろいろも少しある。そんなことを言ってももうどうにもならんので、今年初めてのマーケティング活動なのでがんばって話してこようと思う。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0902/>linkedin による dm の効果</a></h1><div class=post-meta><span class=post-date>2023-09-02 (Sat.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/translation/>translation</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ストレッチ>ストレッチ</a></li><li><a href=#deepl-で翻訳したものの手直し>deepl で翻訳したものの手直し</a></li></ul></nav></div><div class=post-content><p>22時に寝て何度か起きて6時に起きた。もうがんばれない状態。本当はお仕事すべきではあったんだが、モチベーションが売り切れてしまって違うことした方が気分転換になりそうなので翻訳していた。</p><h2 id=ストレッチ>ストレッチ</h2><p>先週が疲労のピークだった気がする。先週よりはましになったものの、右足全般がやばい感じだった。かなり辛かった。ここ1-2週間、歩いていて知人からも足悪いの？と聞かれるぐらいには、まともに歩けなくなっているようだ。あと何年歩けるのだろう？という危機感も少しある。腰もやや右側の張りが強かった感じはした。今日の開脚幅は開始前155cmで、ストレッチ後158cmだった。先週よりは少しだけ改善した。ただお仕事のピークは超えたのでこれから少しずつ回復していくといいなと想定している。</p><h2 id=deepl-で翻訳したものの手直し>deepl で翻訳したものの手直し</h2><p>来週の LT 発表ネタの準備。</p><p>ある英語の記事を紹介するにあたり、その日本語翻訳を用意しておこうと考えた。要約をちょろっと話して詳細はこれ読んでねみたいな LT にしようと思う。先週から著者に翻訳の許諾をしてほしいというメールを送っていたが1週間経っても返信なし。著者との別のコンタクト方法の1つに linkedin があった。linkedin でメッセージを送ると3時間後に OK の返信がきた。そっか linkedin だと、相手がどんな人かといった情報がわかるからメールよりも返信するモチベーションになりやすいのかもしれないと気付いた。少なくともスパムではないと確認できて安心できる。今後は linkedin で dm を受け付けている人には linkedin を積極的に使っていこうと思った。</p><p>今回は deepl を使って翻訳しようと考えていた。プロライセンスを購入していれば、翻訳した成果物の著作権を主張しないと規約に書いてある。基本は deepl で翻訳するものの、「てにをは」を直したり、スキップされた文章を再翻訳したり、訳文がおかしいところを見直したり、あとテーブルや図の英語を手入力して翻訳したりとか、あと細かいレイアウトの調整とか、文章量が多かったのでそういった細々したことをやってたら7時間ぐらいはかけたと思う。</p><p>ポッドキャストを聞きながら手を動かしていたり、途中で晩ご飯を食べに行ったりしながら、お昼から始めて夜中の2時前ぐらいになって、もう眠くなって推敲に疲れて、半分ぐらいチェックし終えたところで公開しちゃうことにした。公開した方が慌てて直すモチベーションになるから意図的にそういうことをするときもある。</p><ul><li><a href=https://t2y.hatenablog.jp/entry/2023/09/03/011023>(翻訳) ビッグテックのプロジェクトマネジメントとスクラム不在の謎</a></li></ul><p>今日はもう眠くて無理で公開後、家に帰ってすぐに寝てしまった。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0901/>クレームへの階段</a></h1><div class=post-meta><span class=post-date>2023-09-01 (Fri.)</span></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/project-management/>project management</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#隔週の雑談>隔週の雑談</a></li><li><a href=#オフィスの担当者との電話>オフィスの担当者との電話</a></li></ul></nav></div><div class=post-content><p>0時に寝て何度か起きて6時に起きた。</p><h2 id=隔週の雑談>隔週の雑談</h2><p>顧問のはらさんと隔週の打ち合わせ。先週は多忙でお休みした。今日の議題はこれら。</p><ul><li><a href=https://twitter.com/svpino>santiago</a> 氏のスクラム批判の話題<ul><li><a href=https://twitter.com/svpino/status/1695806027256475777>Scrum is a cancer.</a></li><li><a href=https://twitter.com/svpino/status/1696187613739208878>Software estimates are one of the oldest lies we tell ourselves.</a></li><li><a href=https://twitter.com/svpino/status/1696869327335571833>I wrote, &ldquo;Scrum is a cancer,&rdquo; and the Internet had thoughts about it.</a></li><li><a href=https://twitter.com/svpino/status/1697250711632003260>Story Points don&rsquo;t work.</a></li></ul></li><li><a href=https://osk.connpass.com/event/292551/>オープンセミナー2023@香川</a> で LT する話題</li><li>角印のデータ化の共有</li></ul><p>たまたま X (twitter) でスクラム批判しているツィートを教えてもらってリンクにあるように <code>Scrum is a cancer.</code> というインパクトのある書き出しで聴衆を一気に掴んで盛り上がっていた。多少の誇張はあるものの、内容も真っ当で私が読んでみてもそんなに違和感がなかった。スクラムの懸念をうまく言語化したポストになっていたと思う。その延長で他にも、見積もり、フィードバック、ストーリーポイントにも言及していて、これらの話題についてはらさんと雑談してみた。はらさんとは1-2年前からスクラムの話題で何時間も話しているので、もうお互いに食傷気味ではある。ただ時事ネタなのと1年ぐらい経ったらアップデートもあるかな？という期待もあって話題に選択してみた。次のような意見が出た。</p><ul><li>スクラムの開発プロジェクトをそんなに経験している開発者は少ないから主語が大きくなりがち</li><li>マネージャー入門としての、スクラムという開発方法論を評価してもよいのでないか？</li><li>「スクラムにはマネージャーいない」と骨髄反射で返答をよくもらうがそれは理想論ではないか？</li><li>スクラムの失敗と事業／業務の失敗は違う</li><li>スクラムは毎日見積もり、デイリースクラムで確認できるというメリットがある</li><li>スクラムはチームの限定合理性を重視するため、個人の限定合理性を重視するメンバーを排除できる</li><li>スクラムの懸念の1つに全然できていないのに「できている」というメッセージを出し過ぎるのではないか？</li><li>ソフトウェア開発は前提として見積もりできないという認識をもつべき</li></ul><p>お腹いっぱいなので詳細はあまり書かない。</p><h2 id=オフィスの担当者との電話>オフィスの担当者との電話</h2><p>先日の <a href=/diary/posts/2023/0812/>暑さ対策委員会</a> の続き。</p><p>昨日、運営会社にその後の進捗を確認するために電話したらお休みだったので再度電話した。昨日もコールバックすると言いながら15時過ぎてもコールバックがなくて、もういい加減エスカレーションして偉い人に正式なクレームをあげようと考え始めていた。ようやく電話つながったと思ったら通話の音質が悪くて話しているうちに切断して、その後もつながらない。本当にイライラがつのる。2回目のコールバックで話していると、エアコンの工事によって隣のオフィスの人たちは問題ないと言っていたといったコメントが出てきた。</p><p>私のイライラが最高潮に達したのはこのとき。私はこれまでもずっと隣のオフィスの社員さんと暑さどうですか？という会話を何度かして先方も室内は暑いという話しを聞いていた。隣のオフィスの社員さんが問題ないなんて言うわけがないと思って、そのまま隣のオフィスへ言ってそこの社員さんにも電話に出てもらった。もちろん隣のオフィスの社員さんはこの件について一切やり取りしていない。社員さんも「(暑さについて) すぐ分かるから現場に来いっ！」って怒っていた。</p><p>ほんとその通りで7月の中旬からずっと伝えている。何もしていないわけではないのは理解するが、現地で確認したらこれまでの施策の効果がないことは一目瞭然である。一切確認せずに作業したから問題ないと判断して放置していたようにみえる。一連の対応が終わったときに正式なクレームとして運営会社にあげようと考えている。</p><ul><li>1ヶ月半の間に5回電話して一度もコールバックも進捗報告もなかった</li><li>効果が出ていないことは報告しているにも関わらず、なんら施策を検討していない</li><li>現地で確認すれば、ひどい暑さであることがすぐわかるのに1度も調べようとしなかった</li></ul></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0831/>qa と最初のキャリア</a></h1><div class=post-meta><span class=post-date>2023-08-31 (Thu.)</span></div><span class=post-tags>#<a href=/diary/tags/testing/>testing</a>&nbsp;
#<a href=/diary/tags/career/>career</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#qa-という業務の懐の広さ>qa という業務の懐の広さ</a></li></ul></nav></div><div class=post-content><p>0時に寝て何度か起きて6時に起きた。1-2週間前に2年ほどやっていたドラクエタクトをやめた。飽きたのか自然ともういいかって感じでやめられた。それ以来、家に帰ってからゆっくり休む時間が増えた気がする。</p><h2 id=qa-という業務の懐の広さ>qa という業務の懐の広さ</h2><p>先週の水曜日から qa テストに移行している。スケジュールとしてはこのために1ヶ月を確保している。おそらくもう少し早く終えられるんじゃないかという気はしている。早く終われば次の開発の計画づくりを前倒しにすればよいのでそれは構わない。私は先週から残タスクのリファクタリングが終わりきらなかったのでややバタバタしていたが、メンバーはテストに専念してテスト環境で動かして意図しない振る舞いを issue 登録したり、直感とは反する振る舞いを issue 登録したりしている。</p><p>新人さんや、未経験だけと開発者になりたいとジョブチェンジする人たち向けに、最初のキャリアとしてテスターや qa をするのがよいのではないかと私は考えている。きっかけは More Joel on Software に、テクニカルサポートは開発者を配置する必要があると書いてあった。しかし、テクニカルサポートだとスキルを身につけると持て余してしまうため、その業務ためのキャリアパスを考えないといけないと書いてあった。まったく同感だ。私がお手伝いしたある会社でもテクニカルサポートは1-2年で辞めているのを見聞きした。みんな開発したいからね。</p><blockquote><p>(おまけ) カスタマーサービスの人たちのためのキャリアパスを用意する</p><ul><li>テクニカルサポートにはデバッグ能力を要求するため、資質の高い人を配置する必要がある</li></ul><p><a href=https://t2y.hatenablog.jp/entry/2021/10/09/162618>More Joel on Software</a></p></blockquote><p>新卒以外の採用ルートで未経験から開発者になるのは、いまは相当に難しいと思う。そんな人たちがキャリアアップするための試金石としてテスターがよいと思う。重要なお仕事だし、テストツールをプログラミングすることで開発者になるための準備期間 (学習) にもあてられる。システムの振る舞いや知識もテストを通して身につけられる。このお仕事を2-3年務められて、プログラミングも少し理解できるようになって、それでも開発者になりたいという意志があるなら開発者にステップアップすればよい。適正があるかどうかわからない状態で開発者を始めるよりも、ゆっくり学んでいけるのでうまくいくのではないか？と思ったりする。うちの会社はまだ社員を雇う余裕がないので私の持論の検証はできないが、どこかの会社でやってみてほしい。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0830/>トークン認証のプロバイダ実装</a></h1><div class=post-meta><span class=post-date>2023-08-30 (Wed.)</span></div><span class=post-tags>#<a href=/diary/tags/auth/>auth</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/design/>design</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#client-ライブラリのトークン認証対応>client ライブラリのトークン認証対応</a></li></ul></nav></div><div class=post-content><p>22時から寝始めて何度か起きて6時に起きた。最近は早寝早起きにしている。</p><h2 id=client-ライブラリのトークン認証対応>client ライブラリのトークン認証対応</h2><p>いまの開発の新機能の1つにローカルアカウントの管理機能がある。普通のパスワード認証により、JWT によるアクセストークンを発行し、リフレッシュトークンを使ってアクセストークンの再取得を行う。api サーバーで実装してもらったこれらの web api を使って、api client 側でもログインしてアクセストークンを取得して web api のリクエストができるようにする。一般的にアクセストークンは有効期限が短いため、有効期限が切れたときは透過的にリフレッシュトークンを使ってアクセストークンを再取得する。またリフレッシュトークンの有効期限が切れたときは再ログインして、アクセストークンとリフレッシュトークンを再取得する。</p><p>文章で書けばこれだけの機能だけど、このための <em>AuthProvider</em> を実装した。最終的には次のインターフェースになった。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>AuthProvider</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>CanRefresh</span>() <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>GetAuthorization</span>() (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>GetType</span>() <span style=color:#a6e22e>AuthType</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Refresh</span>() <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>先週たまたま <a href=https://github.com/Azure/azure-sdk-for-go>Azure/azure-sdk-for-go</a> の <em>AuthProvider</em> のソースコードを読んだ。やりたいことに対して、かなり複雑なことをしているようにみえたが、アクセストークンのキャッシュ、有効期限が切れたときのリフレッシュを透過的に行うコードだった。このライブラリの実装が読みにくいコードで、私だったらもっとシンプルに実装するというイメージが先週からあったのでそのイメージ通りに実装して1日で対応を終えた。本当はこの機能をいまの開発フェーズで提供する予定はなかったんだけど、うまく簡潔に実装できたので一部 agent で導入してテストで検証することにした。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0829/>コンテナー間のデータ通信と named pipe</a></h1><div class=post-meta><span class=post-date>2023-08-29 (Tue.)</span></div><span class=post-tags>#<a href=/diary/tags/container/>container</a>&nbsp;
#<a href=/diary/tags/linux/>linux</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#コンテナー間のデータのやり取り>コンテナー間のデータのやり取り</a></li></ul></nav></div><div class=post-content><p>22時頃から寝ていて2回起きて3時に起き出して、4時までネットみたりしていて、また寝て6時に起きた。生活のリズムがおかしい。</p><h2 id=コンテナー間のデータのやり取り>コンテナー間のデータのやり取り</h2><p>昨日 <a href=/diary/posts/2023/0828/>モジュール分割</a> したことにより、いままで1つのモジュールで管理していたが、モジュールを分割したのでそれぞれのバージョンを取得できるとよいという話題が出た。コンテナー内にアプリケーションのバイナリがあり、バイナリを実行するとバージョン情報を取得できる。それぞれのモジュールは独立したコンテナで動いてるため、コンテナー間でその情報を受け渡す方法が必要になる。ググってみると次の so がヒットして named pipe がプラクティスだという。</p><ul><li><a href=https://stackoverflow.com/questions/32163955/how-to-run-shell-script-on-host-from-docker-container>How to run shell script on host from docker container?</a></li></ul><p>ホスト os 上の named pipe をコンテナーの volumes でマウントして、それぞれのコンテナーが読み書きすればよい。構築時に named pipe さえ作ったらコンテナー内での読み書きでデータ通信を実現できるため、シンプルでよいんじゃないかと思えた。</p><p>mypipe という named pipe を作る。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ mkfifo mypipe
</span></span></code></pre></div><p>読み込み用コンテナーのための read-Dockerfile を作る。tail コマンドで named pipe を読む。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ vi read-Dockerfile
</span></span><span style=display:flex><span>From bash:latest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ENTRYPOINT <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;tail&#34;</span>, <span style=color:#e6db74>&#34;-f&#34;</span>, <span style=color:#e6db74>&#34;/app/mypipe&#34;</span> <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>$ docker build -t mypipe-read:latest -f read-Dockerfile .
</span></span></code></pre></div><p>named pipe をマウントして読み込み用コンテナーを起動する。</p><pre tabindex=0><code>$ docker run --rm --mount type=bind,source=&#34;$(pwd)&#34;/mypipe,target=/app/mypipe,readonly mypipe-read
</code></pre><p>書き込み用のエントリーポイントのスクリプトはちょっと工夫がいる。おそらく Dockerfile 内で直接リダイレクトの操作ができない (やり方がわからなかった) 。シェルスクリプトを呼び出す形にして、シェルスクリプト内部でリダイレクトにより、named pipe に書き込みする。</p><p>エントリーポイントのスクリプトは次のような感じ。<code>eval "$@"</code> で任意のコード実行できるようにちょっと細工。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ vi myentrypoint.sh
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cleanup<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;cleanup ...&#34;</span>
</span></span><span style=display:flex><span>    exit <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>trap cleanup INT TERM
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> true
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    eval <span style=color:#e6db74>&#34;</span>$@<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    sleep <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><p>書き込み用コンテナーのための write-Dockerfile を作る。先の myentrypoint.sh を <code>ENTRYPOINT</code> として起動させる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ vi write-Dockerfile
</span></span><span style=display:flex><span>From bash:latest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>COPY myentrypoint.sh /app/
</span></span><span style=display:flex><span>RUN chmod +x /app/myentrypoint.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ENTRYPOINT <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;/app/myentrypoint.sh&#34;</span> <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>$ docker build -t mypipe-write:latest -f write-Dockerfile .
</span></span></code></pre></div><p>適当に乱数を生成する cli を eval 実行させる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker run --rm --mount type<span style=color:#f92672>=</span>bind,source<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>/mypipe,target<span style=color:#f92672>=</span>/app/mypipe mypipe-write <span style=color:#e6db74>&#34;tr -dc 0-9 &lt; /dev/urandom | fold -w 8 | head -1  &gt; /app/mypipe&#34;</span>
</span></span></code></pre></div><p>読み込み用コンテナーで乱数を表示できるはず。</p><p>なにも難しくなく、linux の標準の機能を使ってコンテナー間のデータ通信を実現できたことにちょっと驚いた。</p><p>go で named pipe を読むときは linux ならば <code>syscall.O_NONBLOCK</code> を指定することで書き込みしていなくてもブロックせずに読める。値を取得できない可能性はあるけど、それが許される要件ならこれで済む。またテックブログにまとめたい。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>readNamedPipe</span>(<span style=color:#a6e22e>path</span> <span style=color:#66d9ef>string</span>) ([]<span style=color:#66d9ef>byte</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>flag</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>O_RDONLY</span> | <span style=color:#a6e22e>syscall</span>.<span style=color:#a6e22e>O_NONBLOCK</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>pipe</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>OpenFile</span>(<span style=color:#a6e22e>path</span>, <span style=color:#a6e22e>flag</span>, <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>ModeNamedPipe</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to open path: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>pipe</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>reader</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bufio</span>.<span style=color:#a6e22e>NewReader</span>(<span style=color:#a6e22e>pipe</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>ReadLine</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to read line: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0828/>go の処理系も驚く sdk のコード生成</a></h1><div class=post-meta><span class=post-date>2023-08-28 (Mon.)</span></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/design/>design</a>&nbsp;
#<a href=/diary/tags/openapi/>openapi</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#msgraph-sdk-go-のサイズ問題>msgraph-sdk-go のサイズ問題</a></li></ul></nav></div><div class=post-content><p>0時に寝て何度か起きて6時に起きた。そのまま7時過ぎまでだらだらしてた。しんどい。</p><h2 id=msgraph-sdk-go-のサイズ問題>msgraph-sdk-go のサイズ問題</h2><p>先週 <a href=/diary/posts/2023/0825/#msgraph-sdk-go-を使った開発>msgraph-sdk-go を使った開発</a> を終えてデプロイする段階になってライブラリのサイズが大きくて、コンパイル速度が遅くなったり、バイナリサイズが大きくなったりする弊害があることに気付いた。コンパイル速度は2-3倍遅くなり (3分が7-10分ぐらい)、バイナリサイズも2-3倍大きくなる (30 MiB が 100 MiB とか) 。たまたまこのリポジトリは他のツール類からも依存パッケージとして使われるものなので想定よりも影響が大きいことに気付いた。</p><p>朝からチームのメンバーとミーティングして、本来は qa に入ったこの時期にこんな変更をすべきではないが、これは放置するデメリットが大きいのでリポジトリ分割 (モジュール分割) しようと提案して了承を得た。私がやれば作業は1日もあれば完了するだろうと見積もって、見積もり通り、夕方には分割したモジュールをテスト環境にデプロイして当面の解決を得た。アプリケーションのモジュール構造をちゃんとレイヤー化して作ってあるから、今回みたいに急遽、モジュール分割が必要になってもほぼ変更する必要はなかった (たった1箇所だけ) 。</p><p>この本質的な問題は次の issue のコメントで説明されている。</p><ul><li><a href=https://github.com/microsoftgraph/msgraph-sdk-go/issues/129#issuecomment-1098028043>Issue with the size of the API surface of the models package #129</a></li></ul><p>ざっと機械翻訳してみる。</p><blockquote><p><strong>コンテキスト</strong></p><p>この SDK は <a href=https://github.com/microsoft/kiota>kiota</a> を使用してメタデータから自動的に生成されます。オリジナルのメタデータは、Microsoft Graph の配下にあるすべてのサービスチーム（v1用とベータ用）によって入力された CSDL です。この CSDL は最終的に OpenAPI のフォーマットに変換されますが、これは非常に大きなものです（1k 以上のエンドポイント、1.5k のモデル &mldr;）。API のサイズが大きいため、完全な API surface の SDK を手作りすることは実現不可能でしょう。</p><p>私たちは、SDK を複数のサブモジュール（ファイル用、メール用など）に &ldquo;スライス&rdquo; して、人々が関心のあるものだけを簡単に入手できるようにすることをしばらく考えてきました。実際、私たちは PowerShell でこれを実現しました。しかし、&ldquo;グラフ&rdquo; の性質（すべてのモデルは互いにある程度関連している）と構築されるアプリケーションの多様性により、スライスは誰にとっても &ldquo;正しい&rdquo; ものにはならない（大きすぎたり、小さすぎたり、モデルの重複につながったり&mldr;）。</p><p>そのような理由から、私たちは「完全なSDK」を提供することにしました。すべての人にとって理想的とは言えないかもしれませんが、Go開発者の中には「アプリケーションを作るためのSDKが欲しいだけ」という人もいると感じています（以下で説明する2つ目のオプションとは対照的です）。</p></blockquote><blockquote><p><strong>Go の欠点</strong></p><p>Go の探求を通して、いくつかの欠点に気づいた。現時点では、私たちのプロジェクトやパッケージが適切にセットアップされていないせいなのか、Go や大規模プロジェクトの制限のせいなのかはわからない：</p><p>go build は、変更されておらず、依存関係も変更されていないサブパッケージをリビルドすることが多い。go build が直前に実行されていても、go test がリビルドすることがよくあります。なぜある種のキャッシュに頼らないのでしょうか？同じ問題が go lint にもある。<br>私には、たくさんのサブパッケージがある大きなプロジェクトをビルドするコストは、依存関係が更新されたり、キャッシュが削除されたり、コードが変更されたりしない限り、「セッションごとに一度」だけ支払われるべきだと感じます。</p><p>私たちのプロジェクト構成／構造において、そのような状況を改善するための最適化について、自由に概説してください。また、Goコミュニティ（Goコンパイラを開発している人たちなど）と関わって、そのようなフィードバックを提供する方法があれば、喜んでそうします。私たちのプロジェクトは、その規模の大きさから、世の中にあるほとんどのGoパッケージと比べると、ちょっと変わり者だとわかっています。</p></blockquote><blockquote><p><strong>適切なサイズの SDK</strong></p><p>最後に、すべてのエンドポイントを備えた完全な SDK を持つことは、様々な理由からすべての人に適しているわけではないことを認識しています。私たちは新しい &ldquo;適切なサイズのセルフサービスSDKエクスペリエンス&rdquo; を可能にするために取り組んでいます。そこでは、APIユーザーは誰でも、この SDK と同じように見え、同じように感じる SDK を生成することができますが、完全な API サーフェスの代わりに、彼らのアプリケーションのために彼らが気にするエンドポイント/モデルのみが含まれています。
私たちは今、そのような取り組みに本当に早くから取り組んでいますが、それでもフィードバックをいただけるとうれしいです。大まかな手順はこんな感じだ：</p><ol><li>新しいgoプロジェクトを作成するか、既存のプロジェクトを特定する。</li><li>kiotaの依存関係を追加するか、msgraph-sdk-go-coreを追加します（これはKiotaの依存関係をプルし、いくつか追加します）。</li><li>グラフエクスプローラで必要なリソースを選択（左パネル、2番目のタブ、&mldr;、&ldquo;コレクションに追加&rdquo;）。</li><li>コレクションをプレビューをクリックし、postmanコレクションとしてエクスポートします。</li><li>hidi を postmanコレクションと先ほど共有したOpenAPIの完全な説明文と一緒に使って、&ldquo;フィルタリングされた&rdquo; OpenAPI フォーマットを生成する。</li><li>kiotaを使って、プロジェクトにMicrosoft Graph用のGoクライアントを生成する。</li><li>APIの呼び出しを開始する。</li></ol><p>この時点で、私たちはこれらのステップをすべて文書化し、効率化するために取り組んでいます（おそらくステップ4～5を圧縮しています）。このアプローチの素晴らしいところは、ステップ5から7までが、Microsoft Graphだけでなく、呼び出したいOpenAPIで記述されたAPIで動作することだ。<br>繰り返しますが、この最後の提案はまだ初期段階です。自由に試して、様々な場所でフィードバックを提供してください。</p><p>この長い投稿で、私たちがどこに向かっているのかが明らかになり、Goコミュニティからこれらの側面すべてについてさらにフィードバックが得られると本当に助かる！</p></blockquote><p>簡単に言えば、ms graph api の体系が巨大過ぎて、その定義は <a href=https://raw.githubusercontent.com/microsoftgraph/msgraph-metadata/master/openapi/v1.0/openapi.yaml>openapi.yaml</a> にあるが、この定義からすべてコード生成すると巨大なモデル定義をもつ sdk が出来上がってしまったという話しである。後半に書いてあるワークアラウンドとして kiota で必要なモデルだけを選択して専用 sdk を生成すればサイズを小さくできるとある。しかし、それはそれで <a href=https://developer.microsoft.com/en-us/graph/graph-explorer>graph explorer</a> で選択しないといけなかったりして面倒そうではある。次のドキュメントでもその手順について書いてある。</p><ul><li><a href=https://devblogs.microsoft.com/microsoft365dev/building-go-applications-with-the-microsoft-graph-go-sdk/#create-a-smaller-and-tailored-microsoft-graph-go-client-library>Create a smaller and tailored Microsoft Graph Go client library</a></li></ul><p>うちの用途ではモジュール分割により、局所化したのでひとまずこの問題は大きな影響をもたないようになった。また余裕があるときにモデルを選択して専用 sdk を自動的に生成する仕組みを構築できるならそれに挑戦してもよいかもしれない。</p></div></div><div class=pagination><div class=pagination__buttons><a href=/diary/page/25/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span>
</a><a href=/diary/page/27/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>