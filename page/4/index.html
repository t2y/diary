<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.123.1"><title></title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content="t2y"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content><meta property="og:description" content><meta property="og:url" content="/diary/"><meta property="og:site_name" content><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/index.xml rel=alternate type=application/rss+xml title></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0120/>ダブル掃除</a></h1><div class=post-meta><span class=post-date>2024-01-20 (Sat.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/issue-tracking-system/>issue tracking system</a>&nbsp;
#<a href=/diary/tags/wiki/>wiki</a>&nbsp;
#<a href=/diary/tags/business/>business</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ストレッチ>ストレッチ</a></li><li><a href=#電子帳簿保存法対応の事務処理規定と運用ガイドラインの策定>電子帳簿保存法対応の事務処理規定と運用ガイドラインの策定</a></li><li><a href=#モニター変更>モニター変更</a></li><li><a href=#オフィス掃除>オフィス掃除</a></li><li><a href=#部屋のレイアウト変更>部屋のレイアウト変更</a></li></ul></nav></div><div class=post-content><p>0時に寝て3時に起きてちょっとネットみたりしてまた寝て7時に起きた。</p><p>今日の筋トレは腹筋:10x2,スクワット20x1をした。</p><h2 id=ストレッチ>ストレッチ</h2><p>筋トレの疲労がたまっているのかもしれないが、今日も太ももの後ろの筋がかなり張っていた。胸筋もやや張りがあったように感じた。トレーナーさんによると、筋トレした後に使ったところはストレッチして伸ばした方がよいという。今日の開脚幅は開始前153cmで、ストレッチ後156cmだった。先週とほぼ同じ。</p><p>筋トレを継続できているのでトレーナーさんにいろいろ聞いてみた。</p><ul><li>筋トレメニューに慣れてきたら強度をあげる？回数を増やす？<ul><li>回数を増やした方がよい</li><li>負荷をかけてしんどくなるとフォームが崩れて適切なトレーニングではなくなる懸念がある</li></ul></li><li>種別をもう1つ増やすなら何がよいか？<ul><li>背筋がいいんじゃないか</li></ul></li><li>筋トレを毎日やるのはどうか？<ul><li>大きな筋肉を使うトレーニングは2-3日休みを入れながらやった方がよい</li><li>小さな筋肉なら毎日でも構わない</li><li>私がやっている筋トレは10分でできるようなレベルなので毎日でよいだろう</li></ul></li></ul><h2 id=電子帳簿保存法対応の事務処理規定と運用ガイドラインの策定>電子帳簿保存法対応の事務処理規定と運用ガイドラインの策定</h2><p>税理士さんに <a href=/diary/posts/2024/0105/#事務処理規定の叩き台作成>電子帳簿保存法対応の事務処理規定の叩き台</a> をレビューしていただいた内容を規定に反映した。念のため、再レビューしてもらうが、これで完了とする予定。規定から実際の運用のためにガイドラインを作る。運用ガイドラインは <a href=https://www.notion.so/ja-jp>notion</a> にまとめる。</p><p>あまり notion を使う気になれないのは、課題管理システムをメインに使っているから wiki もそこにセットで付いていてほしいという願望がある。うちは jira cloud を使っているので本当は atlassian の wiki プロダクトを使いたいところだが confluence が使いにくいから使っていない。atlassian は confluence とは別にもっと軽量でシンプルな wiki プロダクトを別途提供すればよいのでないかとすら思う。一方で <a href=https://esa.io/>esa</a> や notion のような、wiki 単体のサービスを活用するのは課題管理システムとの連携において不便なように思えた。だから notion は最近プロジェクト管理の方に手を広げているのかもしれない。 github や gitlab のように、課題管理システムと wiki はとても相性がよいのでツールセットで提供するのがよいと思う。今後のプロダクト構想の中で wiki を考えていなかったけれど、アプリケーション間連携という視点から考察してもよいかもしれない。</p><p>sns などで電子帳簿保存法対応がすごく大変といったメッセージをたまにみかける。この法律は電子取り引き (請求書や領収書を pdf ベースでやり取りするサービスなど) に対応するもので紙の請求書や領収書でやり取りしている事業者には影響はない。しかし、昨今取り引きが電子化されていく流れでもあるため、電子取り引きはまったくないという事業者もあまり存在しないのではないかと思う。そして、これまではそういった事業者が取り引きの証拠となる電子データを消失してしまっても法律から言及できないという状態だった。電子取り引きはデータしかその取り引きがあったことを証明する証拠がないのにそのデータを消失して OK なわけないよね？というのが本来の電子帳簿保存法の目的になる。</p><p>おそらくパソコンやシステムでデータ管理していない事業者にとっては取引データ保存の仕組みや運用を新規構築する必要があってコスト増になって大変なのだと推測する。しかし、私のような、最初から大半の取り引きは電子取り引きであり、そのデータもすべてクラウドストレージに整理した上で保存している事業者にとってはほとんど運用に影響を与えない。もちろん現行の運用にあうようにするには事務処理規定を策定しないといけない。ここで影響があるのは訂正・削除の運用時に記録を残すという点ぐらいしか、既存の運用と変わることはない。そして、過去の電子取り引きの訂正・削除が発生したことは私の記憶にないぐらい稀にしか発生しないと推測される。</p><p>低辺 sier のひどい労働環境や多重請負契約の構造を it 業界の代表的なもののように揶揄されるのと同様、いかに世の中のできない人たちが自分たちのスキル不足や知識不足を大騒ぎしてその内容が正当であるかのように喧伝しているのかが伺える。まともにシステムを使っている会社は電子帳簿保存法で大きな影響を受けない。多少の運用手順が変わったり、システムの開発が必要になったりする程度だと思われる。これはインボイス対応もそう。うちのようなマイクロ法人でもインボイス対応は新規の取引先を登録していく作業が増えたぐらいで日々の会計処理にほとんど影響を受けていない。世の中のニュースと実際の実務運用に大きな乖離がある。そして、実際にやったこともないような人たちが「弱者いじめ」だと党派性をもって大騒ぎする。</p><h2 id=モニター変更>モニター変更</h2><p>これまで27インチと24インチのダブルディスプレイを使ってきた。実家 (コワーキングスペース) に27インチのモニターを持って帰ろうと思って、24インチのモニターをもう1つ買ってその入れ替えをしていた。24インチ x 2 のダブルディスプレイに変更した。27インチ x 2 は有効視野を考えると幅が広過ぎて私にはあわない。首振りが疲れる。1台でもっと大きいモニターを使うという選択肢もあるかもしれない。しかし、私はなんとなく2台のディスプレイで1つをコードを書くメイン、もう1つをブラウザで調べたものを表示させておくためのサブという使い方を気に入っている。ただの習慣かもしれない。</p><blockquote><p>人間の視野は左右の眼を合わせると180度以上あります。 片眼の視野は鼻側に約60度、耳側に約100度、上方向に約60度、下方向に約70度と言われています。その中で、標識の文字を読むなど、モノのカタチや色などがキチンと認識できる範囲を中心視と言い、わずか1～2度ほど。中心視のまわりの必要なものを識別できる範囲、有効視野は左右に35度ほど。その外側である周辺視野では、カタチや色などをハッキリと認識することはできません。</p><p><a href=https://global.honda/jp/safetyinfo/think_safety/vol14/vision/>中心視と周辺視野</a></p></blockquote><h2 id=オフィス掃除>オフィス掃除</h2><p>モニターを入れ替えしたら埃っぽくなったのでついでにオフィスも掃除した。掃除機は sharp の <a href=https://jp.sharp/souji/products/ecct12.html>EC-CT12-C</a> を使っている。サイクロンだからパワーもあるし、ゴミ捨ても紙パックいらないから簡単。コンパクトで数ヶ月に1回ぐらいしか使わない私の用途にちょうどよい。普段は箱にしまってある。</p><p>箱から掃除機を取り出して、終わったら片付けるときに箱にしまい方も書いてある。他の掃除機はどうなのか知らないけど、たまにしか使わない家電で使ったらまた箱にしまうよねと気の利いたこの絵が嬉しい。掃除機を作ることに一生懸命だとこういう気遣いはできない。こういった配慮ができるのは会社の文化や組織や開発体制に「余白」があるからじゃないかと、私もマネジメントをしていて最近は思うようになってきた。この絵があるからこの掃除機を購入するわけではない。それでも、この掃除機を使っていて故障してもまた sharp の掃除機を買おうかなという気持ちにさせる。</p><figure><img src=/diary/img/2024/0120.jpg></figure><h2 id=部屋のレイアウト変更>部屋のレイアウト変更</h2><p>マンションに帰って22時半から部屋のレイアウト変更を始めた。少し前に <a href=https://jp.sharp/hotcook/>ホットクック</a> を購入したものの、思いの外、大きくて置く場所がなくてそのための <a href=/diary/posts/2023/1125/#スタンディングデスク受け取り>置き台</a> をジモティーで購入していた。その置き台を台所の横に設置するには、本棚をどかす必要があって、それは重労働になるのでついつい先延ばししていた。こんな感じ。</p><figure><img src=/diary/img/2024/0120_hotcook.jpg></figure><p>設置して無線 LAN の接続や <a href=https://cocoroplus.jp.sharp/home/>COCORO HOME</a> に家電登録してアプリ間連携の設定をしていた。私のような Web 系の開発者からみると設定 UI やわかりにくさはひどいものだったが、家電メーカーの作るアプリはそんなものだろう。ホットクックの WiFi は 2.4GHz しかサポートしていない。うちの無線 LAN ルーターは 5GHz only で稼働させていたので 2.4GHz も有効化して接続した。私が購入したホットクック (KN-HW24G-W) は <a href=https://cocoroplus.jp.sharp/kitchen/>COCORO KITCHEN</a> に非対応だった。COCORO KITCHEN は deprecated で今後は COCORO HOME になるのかな？COCORO KITCHEN で家電登録しようとしてうまくいかないとまごまごしていた。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0119/>年明けからコーポレート業務いろいろ</a></h1><div class=post-meta><span class=post-date>2024-01-19 (Fri.)</span></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/finance/>finance</a>&nbsp;
#<a href=/diary/tags/coworking/>coworking</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/debug/>debug</a>&nbsp;
#<a href=/diary/tags/network/>network</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#隔週の雑談>隔週の雑談</a></li><li><a href=#smtp-接続のタイムアウト>smtp 接続のタイムアウト</a></li></ul></nav></div><div class=post-content><p>23時に寝て4時半頃に起きてそのまま6時半までだらだらして起きた。早寝早起き。</p><p>今日の筋トレは腹筋:20x1,腕立て:15x1,スクワット20x1をした。</p><h2 id=隔週の雑談>隔週の雑談</h2><p>顧問のはらさんと隔週の打ち合わせ。今日の議題はこれら。内容が多くて1時間超えた。</p><ul><li><a href=/diary/posts/2024/0105/#事務処理規定の叩き台作成>電子帳簿保存法対応の事務処理規定の共有</a><ul><li>まだ始まったばかりで税理士さんの温度感も低い</li><li>事務処理規定が省令に沿っているかどうかの判断はプロセス監査で行われる</li><li>電子帳簿保存法には規定されていないため、事務処理規定の妥当性の検証は行われない</li></ul></li><li><a href=/diary/posts/2024/0107/#経営の価値観と財務>融資を受ける構想作り</a><ul><li>日本政策金融公庫のみで検討していたが、融資実績を作りたいなら信用金庫も加えた方がよい</li><li>借金のメンタリティ、担当者との折衝や審査など余裕のあるときに経験を積んでおくことはよいように思えた</li></ul></li><li><a href=/diary/posts/2024/0113/#ファイナンシャルプランナーとの打ち合わせ>ファイナンシャルプランナーさんとのやり取り</a><ul><li>会社の経費で役員のための保険に入ろうと考えている</li><li>個人の保険控除は8万円らしい</li></ul></li><li><a href=https://note.com/kanzan10to9/n/n49d8fe09ad5b>ローカル複業化プロジェクトの考察</a><ul><li>IT コミュニティに老人や子どもたちは入りにくい。農業なら老若男女誰でも入れる気がする</li><li>農業や地元の特産品を切り口にコワーキング (コミュニティ) で街の人たちと田舎の人たちをつなげるのはすごいことだと思う (関係人口の創出)</li><li>地元の有力者と仲良くなると、行政の口利きもしてくれて活動しやすくなる</li></ul></li></ul><p>はらさんが <a href=https://yorihiroi-frontend.engineer/ja>よりひろいフロントエンド</a> を始めたそうでその話しも聞いていた。個人のブログサイトにするのか、複数人で記事を共有するサイトにするのかもまだ曖昧だという。<a href=https://www.contentful.com/>Contentful</a> + Next.js + Cloudflare Pages という構成らしい。Contentful というツールを私が知らなかったのでまた時間のあるときに調べてみようと思う。</p><p>母が一人暮らしをしていて体調もよくないことから要介護状態になるリスクがそこそこあると考えている。最悪の場合、会社を休眠させてしばらく介護をするかもしれない。はらさんが仰るには休眠はよいアイディアだという。会社員に例えると退職した日の帰り道を想像するとよいと話されていたのだけど、私は過去の記憶があまりないというのもあるが、これまで6回も退職してきたのに退職日を特別に思ったことはあまりない。退職日と他の日に大きな違いはなくて、次のお仕事の準備や調査をしていることが私は多かったと思う。それでも退職にあわせて有休を1-2ヶ月とってゆっくり過ごしていたことには変わりない。私もそういう、メリハリのある働き方が好きだ。</p><h2 id=smtp-接続のタイムアウト>smtp 接続のタイムアウト</h2><p>たまたまメンバーが誤った設定で smtp サーバーに接続したときにタイムアウトするまで5分ほどかかるという現象を発見した。タイムアウトの設定をせずに接続しようとするからそんなことが起きるのかな？と考えて smtp クライアントのタイムアウト設定を調べてみると <a href=https://pkg.go.dev/net#DialTimeout>net.DialTimeout</a> を使えばよいという。</p><ul><li><a href=https://github.com/golang/go/issues/16436#issuecomment-233829112>https://github.com/golang/go/issues/16436#issuecomment-233829112</a></li></ul><p>多めに見積もって30秒のタイムアウトを設定して接続するようにして再度メンバーに再現検証してもらったら直っていないという。接続そのものは出来ていたのだ。ソースを読んでみると、smtp クライアントを生成するときに <code>220</code> というレスポンスを読むことがわかる。誤った接続設定でもコネクションは確立するが、レスポンスが返ってこなくて待ち状態になっていた。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewClient</span>(<span style=color:#a6e22e>conn</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>Conn</span>, <span style=color:#a6e22e>host</span> <span style=color:#66d9ef>string</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>Client</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>text</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>textproto</span>.<span style=color:#a6e22e>NewConn</span>(<span style=color:#a6e22e>conn</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>text</span>.<span style=color:#a6e22e>ReadResponse</span>(<span style=color:#ae81ff>220</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>text</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Client</span>{<span style=color:#a6e22e>Text</span>: <span style=color:#a6e22e>text</span>, <span style=color:#a6e22e>conn</span>: <span style=color:#a6e22e>conn</span>, <span style=color:#a6e22e>serverName</span>: <span style=color:#a6e22e>host</span>, <span style=color:#a6e22e>localName</span>: <span style=color:#e6db74>&#34;localhost&#34;</span>}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>tls</span> = <span style=color:#a6e22e>conn</span>.(<span style=color:#f92672>*</span><span style=color:#a6e22e>tls</span>.<span style=color:#a6e22e>Conn</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>調べてみると Conn インターフェースにデッドラインを設定する API が提供されている。注意事項としては接続した後にデッドラインをリセットしないといけない。</p><blockquote><p>デッドラインとは、I/O操作がブロックされずに失敗する絶対時間のことである。デッドラインは、ReadやWriteを呼び出した直後のI/Oだけでなく、将来の保留中の I/O すべてに適用される。デッドラインを超過した後は、未来にデッドラインを設定することで、接続をリフレッシュすることができる。</p><p>デッドラインを超えた場合、ReadやWrite、その他のI/Oメソッドの呼び出しは、os.ErrDeadlineExceeded をラップしたエラーを返します。これは、errors.Is(err, os.ErrDeadlineExceeded)を使用してテストすることができます。errorのTimeoutメソッドはtrueを返しますが、期限を超過していなくてもTimeoutメソッドがtrueを返すエラーが他にもあることに注意してください。</p><p>アイドルタイムアウトは、ReadまたはWrite呼び出しに成功した後、デッドラインを繰り返し延長することで実装できる。tの値が0であれば、I/O操作はタイムアウトしない。</p><p><a href=https://pkg.go.dev/net#Conn>https://pkg.go.dev/net#Conn</a></p></blockquote><p>次のように <code>SetReadDeadline()</code> を使ってタイムアウトを5分から30秒に短縮できた。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Clinet</span>) <span style=color:#a6e22e>connectWithReadDeadline</span>(<span style=color:#a6e22e>conn</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>Conn</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>smtp</span>.<span style=color:#a6e22e>Client</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>conn</span>.<span style=color:#a6e22e>SetReadDeadline</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>dialTimeout</span>)); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to set read deadline: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>smtp</span>.<span style=color:#a6e22e>NewClient</span>(<span style=color:#a6e22e>conn</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>Host</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to connect to the smtp server: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#75715e>// clear read deadline
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>conn</span>.<span style=color:#a6e22e>SetReadDeadline</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>{}); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to reset read deadline: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0118/>ローカルに window server をインストールした</a></h1><div class=post-meta><span class=post-date>2024-01-18 (Thu.)</span></div><span class=post-tags>#<a href=/diary/tags/ldap/>ldap</a>&nbsp;
#<a href=/diary/tags/cli/>cli</a>&nbsp;
#<a href=/diary/tags/virtualization/>virtualization</a>&nbsp;
#<a href=/diary/tags/windows/>windows</a>&nbsp;
#<a href=/diary/tags/active-directory/>active directory</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#windows-server-2022-試用版のインストール>windows server 2022 試用版のインストール</a></li><li><a href=#明石海峡大橋海上ウォーク>明石海峡大橋海上ウォーク</a></li></ul></nav></div><div class=post-content><p>1時過ぎに寝て6時半に起きた。久しぶりによく眠れた。6時半に起きてたのに8時ぐらいまでだらだらしてた。</p><p>今日の筋トレは腹筋:20x1,腕立て:15x1,スクワット20x1をした。</p><h2 id=windows-server-2022-試用版のインストール>windows server 2022 試用版のインストール</h2><p><a href=https://www.microsoft.com/ja-jp/evalcenter/evaluate-windows-server-2022>Windows Server 2022</a> の試用版が提供されていると知ったのでローカルの <a href=https://www.virtualbox.org/>VirtualBox</a> 環境にインストールしてみた。Active Directory の検証に使うのでディレクトサービスや ldaps 接続のための証明書サービスなどを設定する。メンバーがインストールして課題管理システムにメモを残してくれてあったのでそれを見ながらインストールや設定自体はすぐにできた。1つだけうまく接続できないことがあった。</p><p>ホスト os から ldapsearch で ldaps で接続しようとすると次のようなエラーになる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ldapsearch -x -H <span style=color:#e6db74>&#34;ldaps://192.168.56.101&#34;</span> -W -b <span style=color:#e6db74>&#34;CN=Users,DC=myad,DC=com&#34;</span> -D <span style=color:#e6db74>&#34;CN=Administrator,CN=Users,DC=myad,DC=com&#34;</span>
</span></span><span style=display:flex><span>ldap_sasl_bind<span style=color:#f92672>(</span>SIMPLE<span style=color:#f92672>)</span>: Can<span style=color:#960050;background-color:#1e0010>&#39;</span>t contact LDAP server <span style=color:#f92672>(</span>-1<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>ldap では接続できるので tls の検証のチェックに失敗していることは自明だったが、メンバーは接続できているようにみえたので私の環境の設定が誤っているのかどうかを調べていた。2時間ぐらいデバッグしたりしながら調べてもよくわからなくて、たまたまチーム勉強会があったので終わったときにメンバーに聞いてみた。すぐに完結した。ldapsearch は <code>LDAPTLS_REQCERT</code> という環境変数で tls のリクエストの振る舞いを制御できる。次のように明示的に指定すると接続できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ LDAPTLS_REQCERT<span style=color:#f92672>=</span>never ldapsearch -x -H <span style=color:#e6db74>&#34;ldaps://192.168.56.101&#34;</span> ...
</span></span></code></pre></div><p>この設定はいくつかの方法で設定ファイルに書いておくこともできる。メンバーが使っている環境には <code>ldap.conf</code> でこの設定を有効にしていたので ldaps 接続できていたというオチだった。私が openldap について明るくないのでこういった背景知識をもっていなくてはまっていただけだった。</p><pre tabindex=0><code>Thus the following files and variables are read, in order:
    variable     $LDAPNOINIT, and if that is not set:
    system file  /etc/openldap/ldap.conf,
    user files   $HOME/ldaprc,  $HOME/.ldaprc,  ./ldaprc,
    system file  $LDAPCONF,
    user files   $HOME/$LDAPRC, $HOME/.$LDAPRC, ./$LDAPRC,
    variables    $LDAP&lt;uppercase option name&gt;.
Settings late in the list override earlier ones.
</code></pre><h2 id=明石海峡大橋海上ウォーク>明石海峡大橋海上ウォーク</h2><p>神戸ジャーナルの記事をみかけて、そういうイベントがあるのは知っていた。</p><ul><li><a href=https://kaijo-uzushio-walk.jp/>神戸淡路鳴門自動車道 2橋ウォーク同時開催！ 明石海峡大橋海上ウォーク/大鳴門橋うずしおウォーク 令和6年3月9日(土)・10日(日)</a></li></ul><p>開発合宿の翌週だし、わざわざ行くほどでもないかとスルーしていたものの、関東から知人がわざわざ歩きに来るという話しを聞いて、せっかくの機会なので私も参加することにした。土曜日の午前中に明石海峡大橋を歩いてくる。まだ申込みが始まったばかりなので希望の時間帯を選択できると思う。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0117/>勉強のやり方の基本</a></h1><div class=post-meta><span class=post-date>2024-01-17 (Wed.)</span></div><span class=post-tags>#<a href=/diary/tags/team-building/>team building</a>&nbsp;
#<a href=/diary/tags/communication/>communication</a>&nbsp;
#<a href=/diary/tags/issue-management/>issue management</a>&nbsp;
#<a href=/diary/tags/donation/>donation</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/coworking/>coworking</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#業務での勉強のやり方の基本>業務での勉強のやり方の基本</a></li><li><a href=#災害義援金の推移>災害義援金の推移</a></li><li><a href=#コワーキングのオンラインイベント>コワーキングのオンラインイベント</a></li></ul></nav></div><div class=post-content><p>3時過ぎに寝て1度起きて7時半に起きた。また体調を崩さないか心配になってくる。</p><p>今日の筋トレは腹筋:15x2,腕立て:10x1,スクワット20x1をした。</p><h2 id=業務での勉強のやり方の基本>業務での勉強のやり方の基本</h2><p>隔週で水曜日はメンバーと1on1をしている。今日は年明けで最初の1on1になる。あるメンバーと勉強のやり方について話題になった。私が普段、業務で行っている勉強のやり方を紹介してみた。</p><ol><li>業務の中で未知の内容やわからないことに遭遇する</li><li>ツールやフレームワークを学ぶなら公式ドキュメントを一通り読む</li><li>チュートリアルやサンプルコードを書くためにサンプルリポジトリを作る</li><li>実際にコードを書いて、動かしてみて、ドキュメントの内容を理解する</li><li>自分が理解した内容をテックブログに書く</li><li>対象への理解の解像度が上がってから業務に応用する</li></ol><p>業務をしながらこれを繰り返してプロダクト開発をしている。</p><p>私からみると、経験の浅い開発者は勉強せずに、インターネットでググった内容をそのまま業務に応用しようとする。そして、理解の解像度が低いために誤った設計や実装をしてしまう。それで手戻りが発生したり、品質が悪かったりする。何度も公式ドキュメントを読んだ方がよいと提唱しているものの、これがなかなか勉強しないといけない人には通じない。私も過去にそういう時期があったので意図が理解できないというのも理解できる。だからこそ、この話しは何度でもするし、いつかそのことを理解できるときがきたら役に立つことだと考えている。</p><p>メンバーから「公式ドキュメントを読んでも書いてあることが理解できない」というコメントをもらう。そう。理解できないから自分でコードを書いて、動かしてみて、その勉強をするんだよと教える。本当にそれだけのことなんだけど、それだけのことも理解できずに他人が書いた信頼できるかどうかわからない記事のコードを使う人が多い。本質的には技術の勉強を過小評価している。経験の浅い人は1-2時間読み書きしただけでモダンなフレームワークの抽象化や振る舞いを理解できるはずがない。私でもバックエンドならたいていのことは理解できるが、経験の浅いフロントエンドは怪しい。だから、分かるまでもっともっと勉強しないといけないという認識が必要だ。1-2時間で終えようではなく、勉強も含めて2-3日かけようと思うぐらいでちょうどよい。</p><p>さらに私はメンバーに「時間がかかってもよいからちゃんと理解して開発しなさい」と、これも何度も何度もメンバーに伝えている。それによってタスクが遅れても構わないとすら言っている。他社のプロダクト開発でそこまで言うと経営者からクレームがくる可能性はあるが、おそらくお手伝い先の経営者もいっときの開発の速度よりも、地に足の着いた開発者として成長してもらう方がずっと価値があると理解してもらっていると、私は考えている。だからこそ、メンバーにそう言って、みせかけだけで開発しないように伝えている。</p><p>今日話していて、ようやく自覚できるようになってきたんじゃないかと手応えを感じた。1年かかったけれど。私自身マネージャーとして未熟でもあるし、マネジメントがよくなかったところもあるし、伝え方もよくなかったのかもしれない。それでも繰り返し繰り返し、開発において大事な価値観はメンバーに伝えていこうと気持ちを新たにした。</p><h2 id=災害義援金の推移>災害義援金の推移</h2><p>先日 <a href=/diary/posts/2024/0109/#災害義援金の寄付>石川県の災害義援金に寄付した</a> ときにサイトにその日の残高を掲載していることに気付いた。関心をもったのでその記録を付けている。チェックを忘れたときは internet archive から分かる範囲で調べた。次のような感じに推移していて、そろそろ落ち着くのかもしれない。約60億円といったところ。他の団体や期間からの寄付もあるだろうけど、被害総額は約8,000億円らしいのでまだまだ全然足らない。</p><figure><img src=/diary/img/2024/0116_donation.png></figure><h2 id=コワーキングのオンラインイベント>コワーキングのオンラインイベント</h2><p>月例のカフーツさんのオンラインイベントに参加した。<a href=/diary/posts/2023/1220/#コワーキングのオンラインイベント>前回の所感はここ</a> 。今回のテーマは「自治体とコワーキング」だった。私は行政を好ましく思っていない。行政と関わるお仕事もいくつかやってきた中で行政側の態度がよくなかったり、担当者も上から指示されたからやってますといったやっつけだったり、若い担当者は理解があっても決済権をもってなくて上司に没にされたり、一緒に働いていて楽しいようなお仕事に巡りあわなかったからだ。そして、目的意識からの違いから行政とのお仕事やプロジェクトが失敗とまで言わなくても、うまくいかないケースをいくつも見聞きしてきた。うまくいかないのに対して、うまくいったというのはほとんど聞いたことがないからまずうまくいかない。</p><p>それはともかく、行政と一緒になってコワーキングの事業をやろうとしている人たちもいるのでそれはそれでどんなことをやっているのかを聞いていた。今回は新しい参加者がいてその人の経歴ややっているコワーキングの行動なども聞けておもしろかった。街の人たちとどうやって仲良くなるかという話しで単純接触効果がもっとも効果が大きいのではないかと話されていた。なにもしなくてもそこにいて、徐々に人がくるようになって、人と会っているうちに仲良くなるといった話し。営業さんが取引先をまわるのもその戦略。</p><p><a href=https://www.homes.co.jp/akiyabank/>空き家バンク</a> は住居向けしか対象としていなくて事業用にはなっていない。事業に使える空き家を探すのが難しい。空き家のマッチングシステムはあるようでないらしい。空き家がいっぱいあるのはわかっているので空き家をコワーキングスペースに改装して、町興しの拠点に使えばいいのではないかといった話しがあった。それはそうかもしれないが、私の感覚では、田舎にスペースは山ほどあるが人がいない。コワーキング的な新しい価値観で個々が自律して課題解決するような人を田舎でみつけるのはなかなか難しいと考えている。どちらかというと、一定の人口がいる地方都市や大きめの市が落とし所なのではないかと思う。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0116/>テスト環境を作り直す</a></h1><div class=post-meta><span class=post-date>2024-01-16 (Tue.)</span></div><span class=post-tags>#<a href=/diary/tags/testing/>testing</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
#<a href=/diary/tags/hugo/>hugo</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#テスト環境の見直し>テスト環境の見直し</a></li><li><a href=#hugo-のハンズオン資料作り>hugo のハンズオン資料作り</a></li></ul></nav></div><div class=post-content><p>21時頃から寝て何度か起きて7時半に起きた。昨日は頭が痛かったら早く帰って安静にしてた。安静にしたら直ったので大したことはなかったみたい。</p><p>今日の筋トレは腹筋:15x2,腕立て:10x1,スクワット15x2をした。</p><h2 id=テスト環境の見直し>テスト環境の見直し</h2><p>いまどきの開発の定番としては ci/cd でコミット単位にテスト環境にデプロイする仕組みを構築している。テスト環境は1つだけになるのだけど、プロダクトの開発を1年以上やってきて機能が増えたことによって、1つのテスト環境で相容れない複数の要件や機能を混在させることで管理や運用が煩雑になってきた。気付いたタイミングがよい時期だと思うのでこの機会に1つのテスト環境を3つのテスト環境に分散させようと思う。既存データを確認するだけなら1つでもよいが、id 連携という機能の特性上、複数のシステム間でデータ連携するため、システム間での依存関係が発生する。それを整理しないといけなくなったという次第。今日のところは現状把握や移行に必要な段取りなどを設計していた。</p><h2 id=hugo-のハンズオン資料作り>hugo のハンズオン資料作り</h2><p><a href=/diary/posts/2024/0115/>昨日の続き</a> 。23時過ぎに外に出たついでにオフィスに寄り道して書き始めたらまた熱中してしまって2時ぐらいまで書いていた。ハンズオンで説明する内容は一通り書いたつもり。せっかくの機会だから上級者向けにもう少し知っていることを書いてみようとは思う。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0115/>頭痛でダウン</a></h1><div class=post-meta><span class=post-date>2024-01-15 (Mon.)</span></div><span class=post-tags>#<a href=/diary/tags/testing/>testing</a>&nbsp;
#<a href=/diary/tags/hugo/>hugo</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/document/>document</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ldap-エントリーの更新リクエストをランダムに行うツール>ldap エントリーの更新リクエストをランダムに行うツール</a></li><li><a href=#hugo-のハンズオン資料作り>hugo のハンズオン資料作り</a></li></ul></nav></div><div class=post-content><p>4時半に寝て7時半に起きた。深夜にハンズオン資料を作っていたらまた眠れなくなった。朝から頭痛くて調子が悪い。きっと生活のリズムが崩れているせい。早くお仕事を終えて帰って寝てた。</p><p>今日の筋トレは腕立て:10x1,スクワット15x1をした。</p><h2 id=ldap-エントリーの更新リクエストをランダムに行うツール>ldap エントリーの更新リクエストをランダムに行うツール</h2><p>先週末から作っていたテストツールがようやく一通り動くようになった。ldap エントリーを生成したり、既存のエントリーに対して更新、削除、パスワード変更のリクエストをランダムに自動生成して送る。常時 id 連携の処理を動かしたときの並行処理の問題であったり、やや負荷をかけたときになにかの敷居値を超えて不具合がないかといった検証に使える。8月末に開発に着手して、年末から再開して、1月明けでようやく完成した。テストツールの開発の優先度が低いので後回し後回しにしているうちにどんどん後ろに流れていった。悪い開発の典型例。</p><h2 id=hugo-のハンズオン資料作り>hugo のハンズオン資料作り</h2><p><a href=/diary/posts/2024/0114/>昨日の続き</a> 、、、をやろうと思っていたけど、頭痛でしんどかったので今日はお休み。イベントが公開された。</p><ul><li><a href=https://fin-py.connpass.com/event/307453/>静的サイトジェネレーター勉強会</a></li></ul><p>他のツールをみていて slate というツールは知らなかった。api ドキュメントを書くためのツールとある。</p><ul><li><a href=https://github.com/slatedocs/slate>https://github.com/slatedocs/slate</a></li><li><a href=https://slatedocs.github.io/slate/>https://slatedocs.github.io/slate/</a></li></ul><p>うちはいま <a href=https://redocly.com/>redocly</a> というツールを使って openapi のフォーマット (yml) で api ドキュメントを管理している。開発は openapi を使ってなくてドキュメントのためだけに openapi を使っている。量が増えてくると yml でドキュメントを書くのも辛くなってくるので markdown で api ドキュメントを書けるならそれもよいかもしれない。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0114/>ハンズオン資料を作って、出掛けて、ハンズオン資料を作って</a></h1><div class=post-meta><span class=post-date>2024-01-14 (Sun.)</span></div><span class=post-tags>#<a href=/diary/tags/hugo/>hugo</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#hugo-のハンズオン資料作り>hugo のハンズオン資料作り</a></li><li><a href=#もくもく会>もくもく会</a></li><li><a href=#hugo-のハンズオン資料作り-2回目>hugo のハンズオン資料作り (2回目)</a></li></ul></nav></div><div class=post-content><p>2時過ぎに帰ってなんか眠れなくて4時半に寝て8時に起きた。なんか夜型になってきて変な生活リズム。</p><p>今日の筋トレは腕立て:10x1,スクワット15x1をした。</p><h2 id=hugo-のハンズオン資料作り>hugo のハンズオン資料作り</h2><p><a href=/diary/posts/2024/0113/#hugo-のハンズオン資料作り>昨日の続き</a> 。</p><p>朝からいろいろ直していた。やり始めると凝ってくる。スタイルやシンタックスハイライトなどを修正していた。</p><h2 id=もくもく会>もくもく会</h2><p><a href=https://kobe-sannomiya-dev.connpass.com/event/305200/>新年もくもく会</a> に参加した。なぜか今回は参加者が多くて15人ぐらいほぼ満席だった。lt 大会の内容は新年なので今年はこんなことやりたいという抱負を発表する人が多かったように思う。一通り lt を聞いてから、午前中に引き続き、ハンズオン資料の調査をしていた。夕方眠くなって集中力がなくなっていた。軽く1次会だけ行って眠くてそのまま帰ってきた。</p><h2 id=hugo-のハンズオン資料作り-2回目>hugo のハンズオン資料作り (2回目)</h2><p>飲み会から帰ってきて2時間ほど寝て、それからまた再開して2時半ぐらいまでやってた。サイトの構築とテーマの設定のところを書き終えた。初心者向けにハンズオン資料を書いているが、テーマの設定はなかなか難しいなと思える。拡張を作り込んでいるテーマもあるが、設定方法のドキュメントはあまりないことが多い。デモ画面とそのソースの設定ファイルをみながら空気を読むみたいなところで初期設定をしていかないといけない。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0113/>ハンズオン資料の作成に着手</a></h1><div class=post-meta><span class=post-date>2024-01-13 (Sat.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/pypi/>pypi</a>&nbsp;
#<a href=/diary/tags/iostat/>iostat</a>&nbsp;
#<a href=/diary/tags/finance/>finance</a>&nbsp;
#<a href=/diary/tags/hugo/>hugo</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ストレッチ>ストレッチ</a></li><li><a href=#ハンガーラック受け取り>ハンガーラック受け取り</a></li><li><a href=#iostat-tool-のメンテナンス>iostat-tool のメンテナンス</a></li><li><a href=#ファイナンシャルプランナーとの打ち合わせ>ファイナンシャルプランナーとの打ち合わせ</a></li><li><a href=#hugo-のハンズオン資料作り>hugo のハンズオン資料作り</a></li></ul></nav></div><div class=post-content><p>晩ご飯食べてくつろいでからまたオフィスに戻って作業してた。3時過ぎに寝て8時に起きた。寝不足のせいか、今日も夕方に眠くなって家に戻って3時間ほど寝てた。</p><p>今日の筋トレは腹筋:25x1,腕立て:10x0,スクワット15x1をした。</p><h2 id=ストレッチ>ストレッチ</h2><p>今週もとくにお仕事で疲労や負荷はないものの、筋トレを継続しているせいか、やや腰が痛いかなといったところ。トレーナーさんによると、筋トレで筋肉痛になっていると体が硬くなるという。おそらくそのせいでやや硬めの印象になっているのだと思う。腰や太ももの前・後ろの筋に張りがあったのでこれらはスクワットの反動ではないかと思われる。今日の開脚幅は開始前152cmで、ストレッチ後157cmだった。先週と同じだ。</p><h2 id=ハンガーラック受け取り>ハンガーラック受け取り</h2><p>ジモティーで「ハンガーラック」を500円で購入した。これもコワーキングスペースで使う。この前帰ったときにジャケットを掛けるものがないと気付いた。引き取りに東灘区へ行く機会が増えてきてだいぶ道を覚えてきた。マンションの駐車場まで行って、そこでハンガーラックを受け取った。解体してくれていたので難なく荷室に積めた。丁寧な方で駐車場から車が出ていくときまでお見送りしてくれた。ジモティーだと受け渡しが終わったらすぐ帰る人の方が普通なので性格なのかホスピタリティの違いが出るなと思った。</p><h2 id=iostat-tool-のメンテナンス>iostat-tool のメンテナンス</h2><p><a href=/diary/posts/2021/0926/>日記を書こうと決めて初日に書いた内容</a> が iostat-tool の保守だったなと思い出した。2年半ほど前。一昨日からプルリクエストが届いていたのでレビューしたり、CI 環境の設定を更新したりしてマージした。</p><ul><li><a href=https://github.com/t2y/iostat-tool/pull/6>Use %H for output generated with iostat -t #6</a></li></ul><p>マージしてから 0.3.1 として <a href=https://pypi.org/project/iostat-tool/>https://pypi.org/project/iostat-tool/</a> にパッケージをアップロードした。</p><h2 id=ファイナンシャルプランナーとの打ち合わせ>ファイナンシャルプランナーとの打ち合わせ</h2><p><a href=/diary/posts/2024/0106/#ファイナンシャルプランナーとの打ち合わせ>先週の続き</a> 。17時からの予定だったが、プランナーさんの前の予定が早く終わったそうで15時半からに変更になった。お昼以降ならいつでもよいと伝えていたのでこういった調整ができてよいと思う。卓上カレンダーをお土産にもってきてくれた。今日は次のような内容を話した。</p><ul><li>人生のキャッシュフローに問題ない</li><li>預貯金が多いのでもう少し運用にまわしたい<ul><li>どういった運用があるのかノーアイディアなので提案してほしい</li></ul></li><li>資産形成ではなく万が一のときのための役員向けの保険を提案してほしい</li></ul><p>先方もどうせ来るならもっと準備して来たらいいんじゃないかとも思うが、次は teams でテレビ会議にしましょうと提案した。30分の打ち合わせのために三ノ宮のオフィスまで来てもらうのも申し訳なく思えてきた。その際にメールアドレスを伝えていて「すべて小文字ですか？」と聞くのでメールアドレス (ドメイン名) は大文字小文字を区別せず、大文字でも届きますよと教えてあげたら思いの外驚かれていた。昔からある古い仕様は大文字小文字を区別しなかったりする。大文字小文字を区別しないというのは、多くのケースで百害あって一利なしだけれども、互換性のために変更することもできない。</p><h2 id=hugo-のハンズオン資料作り>hugo のハンズオン資料作り</h2><p><a href=/diary/posts/2024/0111/#静的サイトジェネレーターの勉強会の打ち合わせ>先日の打ち合わせ</a> を受けて資料作りに着手した。hugo のサイト構築やテーマ設定は一度行ったらそうそう変更することはないので久しぶりに設定したら忘れていて、これどうだったかな？とか、このフォーマットはどこからきているのか？とか、いろいろ調べて思い出しながらやっていた。</p><p>hugo は設定ファイルを yaml, toml, json で記述できる。フォーマットを複数対応するというのはよくないということに気付いた。json はみたことないけど、テーマのサンプルの設定ファイルを yaml と toml の、開発者が慣れた方を使う。そうすると、テーマのサンプルの設定ファイルを yaml で提供していて、hugo.toml でサイトの設定をしていた場合、テーマの設定を yaml から toml に変換する作業が発生する。コンテンツの markdown も toml と yaml の両方で記述できるからフォーマットの統一感もなかったりする。なによりも初心者が調べたときに設定ファイルが toml だったり、yaml だったりして混乱する。</p><ul><li><a href=https://gohugo.io/getting-started/configuration/>Configure Hugo</a></li></ul><p>デフォルト設定は toml になっているので hugo で yaml は使わない方がいいんだろうなと思えた。</p><p>さらに設定ファイルの名前も昔は <code>config.toml</code> だったのが、最近は <code>hugo.toml</code> に変わり、さらにどちらのファイル名でもよいという仕様になっている。こんなことになんの意味があるのかもわからない。</p><blockquote><p>With v0.109.0 and earlier the basename of the site configuration file was config instead of hugo. You can use either, but should transition to the new naming convention when practical.</p></blockquote><p>まずはサイト構築して github actions で github pages へアップロードする環境構築を完了した。</p><ul><li><a href=https://t2y.github.io/hugo-hands-on/>https://t2y.github.io/hugo-hands-on/</a></li></ul><p>徐々にコンテンツを追加していく。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0112/>RWMutex の試用</a></h1><div class=post-meta><span class=post-date>2024-01-12 (Fri.)</span></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/design/>design</a>&nbsp;
#<a href=/diary/tags/kobe/>kobe</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#go-の-rwmutex-を使う>go の RWMutex を使う</a></li><li><a href=#4年ぶりの神戸ルミナリエ>4年ぶりの神戸ルミナリエ</a></li></ul></nav></div><div class=post-content><p>0時に寝て3時半に起きてネットみたてたら6時半になってそれから寝て7時半に起きた。やっぱり生活のリズムがおかしい。</p><p>今日の筋トレは腹筋:20x1,腕立て:10x1,スクワット10x1をした。あと1kmほど散歩した。</p><h2 id=go-の-rwmutex-を使う>go の RWMutex を使う</h2><p>テストツールでちょっとしたプールを実装していて mutex を使うコードを書いた。書き込みはロックしないといけないけど、読み込みはロックする必要がないようなものは <a href=https://pkg.go.dev/sync#RWMutex>RWMutex</a> を使うと普通の Mutex よりは読み込みが並行に動くので効率がよくなる。実際に RWMutex を使ってコードを書いたことがなかったので試しに書いて単体テストを実行して振る舞いを確認してみた。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>pool</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>l</span>  []<span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>m</span>  <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>struct</span>{}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mu</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>RWMutex</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>pool</span>) <span style=color:#a6e22e>exists</span>(<span style=color:#a6e22e>dn</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>ldap</span>.<span style=color:#a6e22e>DN</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>RLock</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>RUnlock</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>m</span>[<span style=color:#a6e22e>dn</span>.<span style=color:#a6e22e>String</span>()]
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ok</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>pool</span>) <span style=color:#a6e22e>get</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>ldap</span>.<span style=color:#a6e22e>DN</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>RLock</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>RUnlock</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>length</span> <span style=color:#f92672>:=</span> len(<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>l</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>length</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>l</span>[<span style=color:#a6e22e>rand</span>.<span style=color:#a6e22e>Intn</span>(<span style=color:#a6e22e>length</span>)]
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>mustParseDN</span>(<span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>pool</span>) <span style=color:#a6e22e>put</span>(<span style=color:#a6e22e>dn</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>ldap</span>.<span style=color:#a6e22e>DN</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>Lock</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>Unlock</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>dn</span>.<span style=color:#a6e22e>String</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>l</span> = append(<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>m</span>[<span style=color:#a6e22e>s</span>] = <span style=color:#66d9ef>struct</span>{}{}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=4年ぶりの神戸ルミナリエ>4年ぶりの神戸ルミナリエ</h2><p>たまたま <a href=https://www.feel-kobe.jp/kobe_luminarie/>第29回 神戸ルミナリエ</a> が1月の19日から28日にかけて行われるという記事をみかけた。そう言えば、いつも12月に開催されていたのが今回から1月に変わったみたい。毎年今回が最後みたいな含みをもたせて、なんやらかんやらでもう29回も続いているんやね。今回が第29回だからおそらく来年に第30回もやるのでしょう。「4年ぶりの開催が決定」と書いてあって、あれ？やってなかったっけ？と思ったらコロナ禍のために2020-2023年まで中止という意思決定はされていて、代替イベントとして小さいルミナリエっぽいイルミネーションをやっていたらしい。ルミナリエの展示場となる東遊園地がうちの近所なのでこれまでもやっていたような記憶があるのはそのせいかもしれない。今年は規模を拡張してやるのかな？久しぶりなので時間があるときに観に行ってみようと思う。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0111/>仕事して打ち合わせしてレンタカーの手配</a></h1><div class=post-meta><span class=post-date>2024-01-11 (Thu.)</span></div><span class=post-tags>#<a href=/diary/tags/svelte/>svelte</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/hugo/>hugo</a>&nbsp;
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#sveltekit-のエラー制御>sveltekit のエラー制御</a></li><li><a href=#静的サイトジェネレーターの勉強会の打ち合わせ>静的サイトジェネレーターの勉強会の打ち合わせ</a></li><li><a href=#開発合宿の準備>開発合宿の準備</a></li></ul></nav></div><div class=post-content><p>0時に寝て何度か起きて6時半に起きた。ようやく生活のリズムが戻ってきた。</p><p>今日の筋トレは腹筋:15x1,腕立て:10x1,スクワット15x1をした。</p><h2 id=sveltekit-のエラー制御>sveltekit のエラー制御</h2><p>svelte のエラーハンドラーの仕組みを調べた。</p><ul><li><a href=https://kit.svelte.jp/docs/errors>sveltekit: エラー</a></li></ul><p><code>error()</code> ヘルパーの内部で例外を throw して <code>+error.svelte</code> ファイルがエラーハンドラーでその例外を捕捉してエラーの表示を制御する。とくに目新しくない、普通のフレームワークなら用意してあるであろう例外ハンドラーのようにみえる。公式ドキュメントを読みなさいと常々メンバーに言っているが、なかなか読んでくれなくて、例外ハンドラーを知らずに自前のエラー制御を実装してしまう。私からツッコミが入って作り直しになる。公式ドキュメントを一通り読んだ方が開発が速いと何度も指摘しているのだが。</p><h2 id=静的サイトジェネレーターの勉強会の打ち合わせ>静的サイトジェネレーターの勉強会の打ち合わせ</h2><p>fin-py で2月に静的サイトジェネレーターのハンズオンをやるそうで hugo なら私が使っているので紹介ぐらいできますよと言ったらそのままハンズオンの講師をやることになった。今日はそのための打ち合わせを行うことになった。だいたい次の内容になった。私以外にも4人ほど講師がいて、他の静的サイトジェネレーターのハンズオンも行う。</p><ul><li>ハンズオンは1人30分を持ち時間とする<ul><li>質問も込みで30分</li><li>時間に余裕があるので少しぐらいなら超えてもよい</li><li>デプロイ先やホスティングについての話しは個別にやらない<ul><li>静的サイトジェネレーターとは別のセッションで話す</li></ul></li><li>ローカルでビルドするまでをハンズオンで話す</li></ul></li><li>このハンズオンの対象とする参加者の要項を書く<ul><li>ターゲットの参加者層を決めないと、どのレベルで解説してよいかわからない</li><li>git/github は使えるという前提</li><li>ターミナルでコマンドライン操作もできるという前提</li></ul></li><li>1月20日までにハンズオンのドキュメントを書いて connpass の要項を完成させる</li></ul><p>hugo をインストールして、サイト環境を構築して、記事の生成／ビルドをする。あとはメタデータ付きマークダウンやテーマの設定ぐらいを説明するかなぁ。</p><h2 id=開発合宿の準備>開発合宿の準備</h2><p>ちゃくちゃくと準備を進めている。今回は神戸から4人、関東から3人の合計7人が参加する。うちの会社の社用車で行く予定だったが5人しか乗れない。みんなで移動するのに車が2台になるのも面倒なのでレンタカーでミニバンを借りることにした。スタッドレスタイヤのオプションを付けると2泊3日で11,880円になる。これはスタッドレスタイヤのレンタルとほぼ同じぐらいの料金にみえる。これによって社用車のスタッドレスタイヤ換装の難しい課題からも解放される。キャンペーン割引があって保険も追加して2泊3日で合計61,215円となった。ミニバンなら7-8名は乗れるし、荷物も余裕をもって積み込みできる。このアイディアはいいなと思って、きのいえの定員もそのぐらいの人数がちょうどよさそうに思う。今回の開発合宿では人数の上限はどうかという点にも注目して取り組みたい。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2024/0110/>vhs コマンドの使い方</a></h1><div class=post-meta><span class=post-date>2024-01-10 (Wed.)</span></div><span class=post-tags>#<a href=/diary/tags/svelte/>svelte</a>&nbsp;
#<a href=/diary/tags/cli/>cli</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#sveltekit-で-context-のデータを扱う>sveltekit で context のデータを扱う</a></li><li><a href=#アニメ-gif-をスクリプトから作る>アニメ gif をスクリプトから作る</a></li></ul></nav></div><div class=post-content><p>23時過ぎに寝始めて何度か起きて7時半に起きた。</p><p>今日の筋トレは腹筋:10x1,腕立て:10x1,スクワット15x1をした。</p><h2 id=sveltekit-で-context-のデータを扱う>sveltekit で context のデータを扱う</h2><p>ui 側でページに依存しない形で設定情報などを扱いたいとする。svelte の store と context api を組み合わせて sveltekit として context を管理するサンプルコードが紹介されている。</p><ul><li><a href=https://kit.svelte.jp/docs/state-management#using-stores-with-context>context と共に store を使う</a></li></ul><p>これだけですぐ動くのだけど、このときに <code>LayoutData</code> はサーバー側で作るとバックエンドの仕組みを隠蔽できて嬉しい。そういったときは <code>src/routes/+layout.server.ts</code> にバックエンドの api 呼び出しを隠蔽することで意図した振る舞いになる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#66d9ef>type</span> { <span style=color:#a6e22e>LayoutServerLoad</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;./$types&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>load</span>: <span style=color:#66d9ef>LayoutServerLoad</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>`localhost:18080/myapi`</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>json</span>();
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h2 id=アニメ-gif-をスクリプトから作る>アニメ gif をスクリプトから作る</h2><p><a href=https://zenn.dev/kou_pg_0131/articles/favorite-cli-tools>お気に入りのコマンドラインツールを淡々と紹介する</a> をみていて <a href=https://github.com/charmbracelet/vhs>vhs</a> という cli でアニメ gif を作ってくれることを知った。試しにやってみた。ターミナルを録画するようなやり方と比べて、録画時にタイプミスしてしまうようなミスを防げる。次のようなスクリプトファイルを新規作成する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ vhs new bf.tape 
</span></span></code></pre></div><pre tabindex=0><code>Output bf.gif

Require echo

Set Shell &#34;bash&#34;
Set FontSize 14
Set Width 800
Set Height 380

Type &#34;genact -m bruteforce&#34; Sleep 500ms  Enter

Sleep 10s
</code></pre><p>あとはこの設定でアニメ gif を作る。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ vhs bf.tape 
</span></span></code></pre></div><figure><img src=/diary/img/2024/0110_bf.gif></figure><p>これで 4.8 MiB なのでサイズはまぁまぁ大きい。サイズやカラーの調整をすればもう1桁は縮小できるかもしれない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ls -lh img/2024/0110_bf.gif 
</span></span><span style=display:flex><span>-rw-rw-r-- <span style=color:#ae81ff>1</span> 4.8M  1月 <span style=color:#ae81ff>10</span> 19:48 img/2024/0110_bf.gif
</span></span></code></pre></div></div></div><div class=pagination><div class=pagination__buttons><a href=/diary/page/3/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span>
</a><a href=/diary/page/5/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>