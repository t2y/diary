<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.109.0"><title>forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content="t2y"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="forest nook"><meta property="og:description" content><meta property="og:url" content="/diary/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1013/>サイトコントローラーの障害は大変そう</a></h1><div class=post-meta><span class=post-date>2022-10-13 (Thu.)</span></div><span class=post-tags>#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;
#<a href=/diary/tags/java/>java</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#サイトコントローラーの障害>サイトコントローラーの障害</a></li><li><a href=#java-のちょっとした小技>java のちょっとした小技</a></li><li><a href=#シャンプー>シャンプー</a></li></ul></nav></div><div class=post-content><p>0時に寝て3時に起きて6時半に起きた。だいぶよく眠れるようになってきた。</p><h2 id=サイトコントローラーの障害>サイトコントローラーの障害</h2><p>お手伝いしている宿泊業のシステムでトラブルが発生している。厳密には外部サービスになるのだが、複数のオンライン予約サイトの違いを吸収して単一のインターフェースを提供する宿泊業のハブシステムのような存在をサイトコントローラーと呼ぶらしい。週明けから全国旅行支援という新しいGoToトラベルが開始されて、その予約が想定以上のトラフィックになっていてサイトコントローラーがダウンしてしまった。web 開発者向けに例えれば aws の s3 が落ちて大半のサービスに影響が出てなんもできないみたいな状況かな。</p><ul><li><a href=https://www.traicy.com/posts/20221012252499/>宿泊施設向け予約・販売管理システム「TL-リンカーン」、復旧目処立たず　約5,100施設に影響</a></li></ul><p>全国レベルのニュースになるぐらいの障害規模が大きいらしい。それだけユーザーが多いシステム／事業者なんだろうとは思う。システムと向き合う上で障害が発生するのは仕方ないが、フォールトトレランスは常に意識して設計・運用しないといけないことを、今回の障害を傍からみていて感じた。</p><h2 id=java-のちょっとした小技>java のちょっとした小技</h2><p>java で1つのリストを複数のリストに分割したいときに <a href=https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/List.html#subList(int,int)>List.subList</a> というメソッドがある。複数の値を並行処理するときなど入力を分割するのに便利そう。使い方は次の通り。toIndex を超えると IndexOutOfBoundsException が投げられるのでそこだけ注意かな。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>var total <span style=color:#f92672>=</span> myList<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>var step <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> total<span style=color:#f92672>;</span> i <span style=color:#f92672>+=</span> step<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    var toIndex <span style=color:#f92672>=</span> i <span style=color:#f92672>+</span> step<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>toIndex <span style=color:#f92672>&gt;</span> total<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        toIndex <span style=color:#f92672>=</span> total<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    var subList <span style=color:#f92672>=</span> myList<span style=color:#f92672>.</span><span style=color:#a6e22e>subList</span><span style=color:#f92672>(</span>i<span style=color:#f92672>,</span> toIndex<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// do something
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=シャンプー>シャンプー</h2><p>散髪屋さんのマスターからシャンプーを変えた方がいいんじゃないかとアドバイスされた。髪は油分と水分のバランスが大事らしく、シャンプーによって変わることもあるらしい。いつからか記憶にないけど、少なくとも学生時代から私はずっと <a href=https://www.kao.co.jp/merit/products/norinse/>メリット リンスのいらないシャンプー</a> を使っている。20年ぐらい？こだわりがあるわけでもないし、このシャンプーを使っていて懸念があったことは一度もない。マスターから <a href=https://hscare.jp/shop-products/men/all-collections>h&s scalp</a> がよいとお勧めされた。せっかくの機会だから試してみようかなと思う。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1012/>踊龍を学ぶ</a></h1><div class=post-meta><span class=post-date>2022-10-12 (Wed.)</span></div><span class=post-tags>#<a href=/diary/tags/book/>book</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#リーダーとしての易経>リーダーとしての易経</a></li></ul></nav></div><div class=post-content><p>0時に寝て3時に起きて6時に起きた。わりとよく眠れた。朝一でバグに気付いて慌てて修正したりしていた。</p><h2 id=リーダーとしての易経>リーダーとしての易経</h2><p>「第四段階 踊龍 龍が飛躍する時」を読んだ。</p><p>龍の成長過程を年齢に当てはめると、潜龍は10代、見龍が20代、君子終日乾乾すが30代とある。実際には第3段階は量から質を磨く時なので相対的に長くなる。20代後半から40代ぐらいとみてもよい。そうやって40代には実力が十分に備わっていると言える。踊龍から飛龍になれるかどうかは実力だけではなれない。ここで時、つまりは好機をとらえる必要がある。ここでいう時とは時・処・位の3つを指している。飛龍になるには早すぎても遅すぎてもダメだという。機と期と気を観ないといけない。観るというのは洞察力を指している。</p><ul><li>機: 機会</li><li>期: 期日</li><li>気: 気運と兆し</li></ul><p>志は変容したり、しぼんでいく。世の中の流れに押し流され、埋没してしまうこともある。志を失うと乾乾することも放棄して、やがて亢龍となり衰退していく。潜龍のときに抱いた志を持ち続けられていれば、龍の変遷過程を経てイメージが実際に実現できていて、踊龍で最終段階になっている。1つ1つのパーツが適所にはまり、描いてきた志のビジョンが明確になる。機が熟し時が満ちる。</p><p>いくつか分かるような分からないようなキーワードもあるし「兆しを観て適切な時に動け」と言われてもプラクティスというより精神論に近い。易経とは時の変化の法則性を理解して、人間が然るべき時を理解できるようにする学問ではあるが、一朝一夕ではないことが文章からわかる。それでもいくつか共感するところはあって、志とまで昇華しなくても思い付きでよいアイディアだと思ったことが1週間も経つとそう思わなくなったり、1ヶ月もするとやる気をなくしたりすることが私は多々ある。別の観点では、初期の挑戦というのは得てしてうまくいかない、いや大半が失敗する。余談だが本書の中に「潜龍用うるなかれ。」という言葉が出てくる。重用したり責任をもたせてはいけないとある。自分が潜龍だとしたら焦って早成を求めてはいけない。経験も実力もないこの時期にすべきことは志を抱くこと。</p><p>会社を始めて最初の2年で大きな失敗をしたときに課題管理を自社のビジネスにできないかと思い付いた。その後、3ヶ月間調べたり話したりして、その後1年間スクラム開発に勤しみ、そしてこれからプロダクトマネージャーとして実践する。決して順風満帆ではないが、たしかに時が変わり、やっていることも変わり続けている。そして、課題管理という分野における解像度は1年前よりも高くなった。易経の乾為天をフラクタルに考えるのは正しくないのかもしれないけど、製品開発のサイクルとみなしても理は通りそうな気もする。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1011/>自分史を易経から読み解く</a></h1><div class=post-meta><span class=post-date>2022-10-11 (Tue.)</span></div><span class=post-tags>#<a href=/diary/tags/book/>book</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#リーダーとしての易経>リーダーとしての易経</a><ul><li><a href=#易の三義>易の三義</a></li><li><a href=#時の三要素>時の三要素</a></li><li><a href=#時の変遷過程の原則>時の変遷過程の原則</a></li></ul></li></ul></nav></div><div class=post-content><p>0時に寝て3時に起きて5時に起きて7時半に起きた。夜に紅茶を飲むのをやめて少し眠れるようになった。QA レビュー待ちのタスクが溜まっていて、リリース前でやることないから軽微なバグ修正してた。</p><h2 id=リーダーとしての易経>リーダーとしての易経</h2><p>週末に三ノ宮.devの勉強会がある。発表者が少なかったら私もなにかしら発表しようかと考えている。</p><blockquote><p>テーマは「継続」でみなさんが継続していることについて色々教えてください！</p></blockquote><p>継続と聞いて思い浮かべるのは過去に menta に書いた記事とかも見返していた。</p><ul><li><a href=https://menta.work/post/detail/12952/LzRIJkovXazr4cqpzgg7>プログラミングと書くこと</a></li></ul><p>いまになって <a href=/diary/posts/2022/0904/#40代は改革と革命>易経の本</a> も軽く読み直してみたいと考えている。もう10年以上プログラミングを学び続けてきたし、転職や起業など自分がやってきた歴史からふりかえるとなにか発見があるかもしれない。</p><h3 id=易の三義>易の三義</h3><ul><li>変易: 森羅万象、すべてひと時たりとも変化しないものはない</li><li>不易: 変化には必ず一定不変の法則性がある</li><li>易簡: その変化の法則性を理解すれば、わかりやすいものになる</li></ul><p>時は必ず変化するので、良い時は悪い時へ向かい、また悪い時は良い時へ向かう。変化するから成長と発展がある。</p><h3 id=時の三要素>時の三要素</h3><p>易経のいう時には時間だけでなく空間も含む。次の3つの要素で成り立つ。</p><ul><li>時: 時間、期、タイミング、兆し</li><li>処: 環境、状況、場</li><li>位: 位置、立場、社会的地位、人間関係</li></ul><p>時・処・位を踏まえた判断と行動がリーダーには必要。</p><h3 id=時の変遷過程の原則>時の変遷過程の原則</h3><p>易経の64の時の中でもっとも原則的な時の変遷をたどる龍の話しが乾為天 (けんいてん) という卦になる。次の6段階で力を蓄え、師に仰ぎ、繰り返し、試みて、変化を為し、衰退する。</p><ol><li>潜龍: 変化の始まり</li><li>見龍: 目が開かれる時</li><li>君子終日乾乾す: 道を反復する</li><li>踊龍: 自ら試みる時</li><li>飛龍: 変化を起こす</li><li>亢龍: 平らかなものは必ず傾く</li></ol></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1010/>出張もくもく会を催す</a></h1><div class=post-meta><span class=post-date>2022-10-10 (Mon.)</span></div><span class=post-tags>#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#出張もくもく会>出張もくもく会</a></li><li><a href=#m2-macbook-air-が届いた>m2 macbook air が届いた</a></li></ul></nav></div><div class=post-content><p>0時に寝て8時に起きた。本当は休日なんだけど、運用に影響を与える変更の pr を金曜日に送っていて、その approve が出たのでマージ処理とデプロイをしてテストのお願いをしようと考えていたら、要件漏れがあることに気付いてその修正を行って再度 pr を出した。この変更はちゃんと検証しないといけない修正なのでできれば今日中にはテスト環境にデプロイしておきたかった。</p><h2 id=出張もくもく会>出張もくもく会</h2><p>出張中の隙間に当たる11月3日(木)は祝日でやることがない。普段の土日祝日は元気ならオフィスで調べものや自社のお仕事をしている。出張中だからコワーキングスペースに出掛けて作業しようという延長上で、いまシェアオフィスを借りている業者さんは全国展開しているので東京のコワーキングスペースの会議室も借りられるのであれば、会議室を1日借りてしまってもくもく会にしてしまおうと思い付いた。</p><p>会議室の予約システムからは東京のコワーキングスペースの会議室も予約できた。どうやって入室すればいいかわからないなと思ってサポートに電話してみた。そしたら、シェアオフィスの借り主が全国の施設を利用できるかどうかは契約次第らしい。最近の契約はそうなっているらしいが、私が契約したとき (約3年前) はどうだったかを忘れてしまった。たしか契約するときに関西は使い放題プランがサービスで付いていたのは契約書で確認できたが、関東はどうなるのかよく覚えていなかった。うちの施設に常駐しているコンシェルジュさんにどういう契約になっているのかを聞いてみた。すぐに調べてくれて問題ないと確認できた。せっかくなので connpass にイベントページを作ってみた。会議室なので8席しかない。この人数なら知り合い限定でよいとも考えている。とはいえ人が集まらなかったら寂しいので一応は一般枠も設けておく。一般枠は参加しにくいように金額設定しているが、様子をみてからあとで無料にする予定。</p><ul><li><a href=https://kazamori.connpass.com/event/262898/>出張もくもく会</a></li></ul><h2 id=m2-macbook-air-が届いた>m2 macbook air が届いた</h2><p>先日購入した <a href=/diary/posts/2022/1004/#m2-macbook-air-購入>macbook air</a> が届いた。ひとまず起動してマシンの初期設定を行う。デスクトップまで起動して、最初にやることとして思い付いたのが google chrome をインストールして <a href=https://1password.com/jp/>1password</a> のインストールと初期設定だった。すべての認証は 1password で管理しているのでこのサービスが使えないと業務できなくなる。また空き時間に少しずつ設定していく。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1009/>iphone のデータ移行が簡単になってた</a></h1><div class=post-meta><span class=post-date>2022-10-09 (Sun.)</span></div><span class=post-tags>#<a href=/diary/tags/device/>device</a>&nbsp;
#<a href=/diary/tags/migration/>migration</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#iphone-移行>iphone 移行</a></li><li><a href=#ストレッチ>ストレッチ</a></li></ul></nav></div><div class=post-content><p>0時に寝て7時に起きた。オフィスで荷物を受け取る必要があったので8時にはオフィスに行って普通に作業してた。午前中は金曜日の作業で途中になってた単体テストを仕上げた。</p><h2 id=iphone-移行>iphone 移行</h2><p>iphone 11 から <a href=https://www.apple.com/jp/iphone-14-pro/>14 pro</a> に移行した。色はディープパープルにした。本当は 11 のグリーンが気に入っていたのでグリーンしたかったけどないから仕方なく。先月の上旬ぐらいから iphone のスクリーンの一部が操作を受け付けなくなった。タッチしても反応しないといった状態になる。最初はドラクエタクトをする上であるボタンが押せない程度だったのだけど、その後も使い続けているうちにその反応しない領域が少しずつ拡大していった。文字入力のパネルなら「や」と「ら」の領域が反応しない、paypay で支払うときに8や9が入力できない、電話が掛かってきてもスワイプで着話できないとか。一部の領域が反応しなくなってから1ヶ月ぐらいで普段使いに支障がでるようになっていた。</p><p>幸いにも9月半ばにはらさんとも相談しながら 14 pro を購入する決断をしていた。9月16日に注文したものが本日届いた。注文時の予定では10月20-27日の予定になっていたのがかなり前倒しになったみたい。朝から古い端末の ios を最新の 16.0.2 にアップグレードしたり、icloud へのバックアップを取ったりしていた。私はとくに icloud のストレージ容量を契約していないので無料の5GiBしかない。それなのにバックアップは成功して、なぜだろう？と調べたら機種変更時の icloud へのバックアップは容量無制限で使えるらしい。とても助かった。</p><ul><li><a href=https://www.itmedia.co.jp/news/articles/2109/21/news113.html>iPhone機種変時のiCloudバックアップ、容量無制限で無料に　iOS 15の新機能、その手順を解説</a></li></ul><p>iphone のデータ移行は <a href=https://support.apple.com/ja-jp/HT210216>クイックスタート</a> という仕組みが3年前から提供されていて、基本的にはこの機能を使えばとくに労力なく移行できた。もちろんアプリによっては個別の移行作業が必要になるけれど、クイックスタートのおかげで基本的には古い端末と新しい端末を並べて移行の承認のような作業をするだけで済む。クイックスタートは iphone 同士を bluetooth 接続で繋ぐ。bluetooth 通信でもデータ移行できるそうだけど、wifi に比べると速度が遅いので256GiBなら3時間ぐらいかかる見通しらしい。icloud経由にするとwifiなので速度も速く15分程度で復元処理を完了できた。私の場合、電話、line、認証系アプリといったコアな機能の移行を1時間ほどで完了できた。一昔前に比べてかなり簡単になっているように感じた。</p><h2 id=ストレッチ>ストレッチ</h2><p>本当は田んぼに実家に帰っている予定だったので日曜日の夜からストレッチ。今日の開脚幅は開始前157cmで、ストレッチ後161cmだった。最近はまったくストレッチしないようになりつつあるのだけど、腰の張りのアンバランスさは解消されていて、トレーナーさん曰くそれはよい状態だと言えるらしい。ストレッチを受ける前から雨降りでストレッチを終えてから何をしようかふらふらとアーケードを散歩して、結局のところ、やることがなくて雨に振られながら帰ってきた。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1008/>議論の前提条件としての悪意の排除</a></h1><div class=post-meta><span class=post-date>2022-10-08 (Sat.)</span></div><span class=post-tags>#<a href=/diary/tags/facilitation/>facilitation</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#建設的な議論のためのファシリテーション>建設的な議論のためのファシリテーション</a></li></ul></nav></div><div class=post-content><p>20時ぐらいに寝て0時に起きてだらだらしてまた寝てお昼ぐらいまで寝てた。寝不足が深刻になってきて生活が乱れてきた。昨日の夜から実家に帰って田んぼする予定が雨降りでまたキャンセルになった。秋の天候は難しい。</p><h2 id=建設的な議論のためのファシリテーション>建設的な議論のためのファシリテーション</h2><blockquote><p>しかしながら本当に素晴らしいなと思ったのは司会のアナウンサー平石さんで、恐らく途中で「これは反ひろゆき側の分が悪い」と思ったのか、現地のひろゆきさんの態度を責めたり、ひろゆきさんに「揚げ足取りはやめてください」ってバッサリやったりであのゴチャゴチャした話をバランス取りながらよくまとめたなぁと思いました。あれがなかったら「番組ぐるみでひろゆきの肩持った！沖縄をバカにした！偏向報道だ！」みたいな批判が絶対産まれてたはず。</p><p>ほんと、動画を見れば良くわかるんですが、平石さんはかなり上手に、でも時には強引にバランス取りに行ってるのがわかると思います。朝生、田原さんが引退したら後任は平石さんしか居ないんじゃないかな～～。</p></blockquote><p><a href=https://www.facebook.com/yoppymodel/posts/pfbid0vyY3ViRsTPdVAgPzQDcq4mx1H1jkqkxPfCQ2M4Jetp7DqBMo4NjHgiXhESwgd7TEl>ヨッピーさんの投稿</a> をみかけて関心をもったので abema prime の動画をみた。たぶん1週間ぐらいしか youtube ではみれないはず。</p><div class=video-container><iframe src=https://www.youtube.com/embed/vnD3MHD3ccE allowfullscreen title=「抗議の声をどう発信？ひろゆき＆せやろがいおじさん」></iframe></div><p>論理的な正しさだけで言えば、ひろゆきの方が分があるように私も思う。一方でひろゆきの姿勢のなにが悪いかもこの番組のファシリテーションの過程で明らかになっていくのが私には受け取れた。というのは、ひろゆきは言葉の定義を大事にしているわけでもなく、沖縄問題に関心があるわけでもなく、ひろゆき自身が現状を想定できないわけでもなく、論理的に正しくなかったとしても活動している団体や人々を嘲笑する悪意があることは明白だと思える。世の中をよりよくしようという想いから主張しているわけではないことは、ひろゆきと大空さんの対話の姿勢の違いをみれば明らかだと私も思う。一方でひろゆきは一般人の代表という意味ではそうだろうと思う。ほとんどの人は自分の身の回りことや生活以外のことに関心がない。</p><p>平石さんのファシリテーションが素晴らしいというのは私からもそうみえた。とくに論理的にひろゆきが正しかったとしても、ひろゆきの悪意が垣間見えたときは平石さんが議論を中断させて軌道修正していたようにみえた。あの場で悪意をもっていたのはひろゆきだけで、他の参加者は現状の問題や虐げられた人たちへの配慮をもった上での発言や議論を進めようとしていた。平石さんは悪意を断ち切ったファシリテーションをしたと言えるかもしれない。悪意があることは珍しく熱くなってひろゆきも「きたない文字」と失言したことからも明らか。ひろゆきも人間なんだなとみえた瞬間でもあった。建設的な議論をするためには、現状の課題を共有し、少なくとも現状よりもよくしようという想いがあることを前提にしないといけないのを今回の議論をみていて感じた。</p><p>平石さんのファシリテーションのよかったところをまとめる。</p><ul><li>悪意を断ち切るように議論を促した</li><li>平行線の議論を仕切り直した</li><li>論理的ではなかったとしてもメンバー全員に配慮をした</li></ul><p>余談だけど、大空さんが本来の座り込みという言葉は、例えば刑務所や入国管理局にいる人たち、自分の体以外に抗議活動ができない人たちの、もっと自由が制限された人たちの特別な抗議活動であったものが、くだんの抗議活動も本来の座り込みとは大きく異なるものだという主張には関心がもてた。本来の言葉の意味を軽くしてしまうことは、例として刑務所や入国管理局にいる人たちのやっている活動を台無しにしてしまうというのは別の視点で学びになった。とくに大空さんはリベラルはそういった議論から逃げてはいけないと自ら難しい問題に対して在るべき姿勢で解決しようとしていて、その姿勢には共感できた。同じ主張をしていてもひろゆきとは対照的にみえた。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1007/>フォームの enter key の振る舞いと制御</a></h1><div class=post-meta><span class=post-date>2022-10-07 (Fri.)</span></div><span class=post-tags>#<a href=/diary/tags/vue.js/>vue.js</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#vuetify-の-v-form-の-enter-key-無効化>vuetify の v-form の enter key 無効化</a></li></ul></nav></div><div class=post-content><p>1時に寝て3時に起きて5時までだらだらしてて8時に起きた。季節の変化のせいかな？夜眠れない生活が普通になってきた。最近セブンイレブンのマスカット紅茶をよく飲んでいるのでカフェインの摂り過ぎなのかもしれない。</p><h2 id=vuetify-の-v-form-の-enter-key-無効化>vuetify の v-form の enter key 無効化</h2><p>あるフォーム画面でテキスト入力欄で enter key を押下すると xhr リクエストが送信されてしまう。これがフォームのデフォルトの振る舞いかどうか、私はフロントエンドに詳しくないからよくわからない。検索などはその方が便利なときもあるだろうからそういう振る舞いがあることは知っている。業務の重要な情報を誤って確定してしまってはいけないから、画面によっては禁止した方がよい状況もある。vuetify の v-form を使っている画面だとデフォルトで enter key を入力すると submit 処理が実行されてしまう。パラメーターに渡される event 情報からもマウスクリックとキー入力の見分けがつかない。</p><ul><li><a href=https://vuetifyjs.com/en/api/v-form/#events>v-form events</a></li><li><a href=https://vuetifyjs.com/en/api/v-text-field/#events>v-text-field events</a></li></ul><p>それぞれのコンポーネントの events をみると、v-form は <code>input</code> と <code>submit</code> しか対応していない。v-form の設定で直接 enter key 入力のイベント制御はできない。<a href=https://v2.vuejs.org/v2/guide/components-custom-events.html#Binding-Native-Events-to-Components>Binding Native Events to Components</a> によると、そういった状況のために <code>.native</code> を使うと直接イベントをフックできるらしい。ここで v-text-field は <code>keyup</code> ではなく <code>keydown</code> のみを提供しているせいか <code>keydown</code> を次のように prevent してあげることでテキスト入力欄で enter key を押下しても submit 処理は呼ばれなくなった。但し、副作用として v-form の slots にあるすべてのコンポーネントの enter key の <code>keydown</code> イベントを prevent してしまう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>  <span style=color:#f92672>&lt;v-form</span>
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>submit=</span><span style=color:#e6db74>&#34;submit&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>@keydown.native.enter.prevent</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&gt;</span>
</span></span></code></pre></div><p>vuetify の issue をみていると過去には無効だったものを有効化したようにもみえる。なにが正しい振る舞いなのかよくわからないし、どうやって制御するのが正しい方法なのかよくわからなかった。</p><ul><li><a href=https://github.com/vuetifyjs/vuetify/issues/1545>[Feature Rquest] v-form prop: Enter key submits form #1545</a></li></ul></div></div><div class=pagination><div class=pagination__buttons><a href=/diary/page/48/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span></a>
<a href=/diary/page/50/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>