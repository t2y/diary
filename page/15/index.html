<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.123.1"><title></title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content="t2y"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content><meta property="og:description" content><meta property="og:url" content="/diary/"><meta property="og:site_name" content><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/index.xml rel=alternate type=application/rss+xml title></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1202/>ミニカンファレンスみながら作業してた</a></h1><div class=post-meta><span class=post-date>2023-12-02 (Sat.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ストレッチ>ストレッチ</a></li><li><a href=#ミニカンファレンスのオンライン参加>ミニカンファレンスのオンライン参加</a></li></ul></nav></div><div class=post-content><p>1時に寝て7時に起きて朝からゲームしてた。お酒飲んだせいで眠りが浅かったような気がする。</p><h2 id=ストレッチ>ストレッチ</h2><p>先週は前日に車であちこち移動して、長時間運転していたのもあり腰に負担がかかっていた。今週は東京出張だったものの、すねの外側の筋やふくらはぎの張りをやや感じた程度でとくに悪いところのない状態に戻ったようにみえる。寒くなってきたのもあり、上半身の肩周りの動きが堅くなっているとトレーナーさんは話していた。今日の開脚幅は開始前153cmで、ストレッチ後158cmだった。</p><h2 id=ミニカンファレンスのオンライン参加>ミニカンファレンスのオンライン参加</h2><p>オンラインのミニカンファレンスを視聴しながらいつも通りの作業をしていた。あまりちゃんと聞いていたわけではないけど、要所要所でおもしろい発表もあった。</p><ul><li><a href=https://kyotogo.connpass.com/event/285351/>Go Conference mini 2023 Winter IN KYOTO</a></li></ul><p>tinygo の中の人が自作キーボードに関する発表をしていて、その人は明石市に住んでいるので、明石市から三ノ宮にかけてイベントをやりたいと話されていた。go について話す相手がいると私も嬉しい。またなにかの機会でご一緒できればと思う。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1201/>SakeBash と LT 発表</a></h1><div class=post-meta><span class=post-date>2023-12-01 (Fri.)</span></div><span class=post-tags>#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/community/>community</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;
#<a href=/diary/tags/management/>management</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#sakebash>SakeBash</a></li><li><a href=#2次会>2次会</a></li></ul></nav></div><div class=post-content><p>2時に寝て4時に起きて5時に起きて7時に起きた。<a href=/diary/posts/2023/1123/>呪術廻戦ゲーム</a> の初心者ミッションだけクリアしたらやめようと思って、なかなかミッションのレベルが高くて届かない。あともうちょっと。</p><h2 id=sakebash>SakeBash</h2><p>神戸に <a href=https://www.acall.inc/>acall (アコール)</a> さんという会社があって、コロナ禍が始まる前に SakeBash イベントを開催されていた。2019-2020年にかけてのとき。それ以来ずっと開催されていなかったイベントを復活させたみたい。コロナ禍が acall さんの転機になったようで、オフィスのオートメーションに関するプロダクトを開発していて会社が大きくなっているらしい。</p><ul><li><a href=https://acall.connpass.com/event/302038/>Kobe Engineer SakeBash #2 ~神戸のエンジニアコミュニティを盛り上げよう</a></li></ul><p>acall さんは go でプロダクト開発をしていると知っていたので神戸で go の話しができると思って次の LT 発表をした。発表したら向こうから声をかけてくれて go の話しができるかな？と期待したのだけど、あまりそういう雰囲気でもなかった。私はコミュ障なので知らない人に話すのが苦手。</p><iframe class=speakerdeck-iframe frameborder=0 src=https://speakerdeck.com/player/18d191169877476193d56bbd535a32a3 title="go-ldap Contribution" allowfullscreen style="border:0;background:padding-box padding-box rgba(0,0,0,.1);margin:0;padding:0;border-radius:6px;box-shadow:rgba(0,0,0,.2)0 5px 40px;width:600px;height:auto;aspect-ratio:560/315" data-ratio=1.7777777777777777></iframe><p>acall さんの社員でしやさんという方が宮崎県から来られて、始めて LT 発表するということで応援しながら聞いた。</p><ul><li><a href="https://docs.google.com/presentation/d/1R16dnV6ewhZWqe5mBKKIGf6jmZdNoNWDoE7tbX6APp8/edit#slide=id.gc6f73a04f_0_0">そろそろどうなん？Flutter</a></li></ul><p>私の周りでも flutter を採用している人たちがいるので気にはなっていた。最近は flutter web というのも出ていて、flutter でフロントエンドとスマホアプリの両方に対応できそうにも思えた。次にスマホアプリ対応が必要になったら flutter を採用してみてもいいなと思えた。acall さんの制度をみていてユニークだなと感じたものに「いまあい旅費」がある。リモートワーク前提の会社だからこそ、こういった制度の価値が出てきたとも言える。一昔前は出張するのが当たり前だったのでこんな制度に意味はなかったが、リモートワークにより出張しないことが当たり前になったのでこういう制度設計になったんだと思えた。</p><blockquote><p>いま、あいにいきます旅費</p><p>リモート勤務でオフラインで集うことが難しいメンバーと「会うこと」の価値を再認識し、オフィスで自社プロダクトのプラクティスを行うことで、製品のアップデートに貢献することを目的とした制度です。自宅から100km以上離れた神戸または東京オフィスに行くための旅費を支給します。（1往復分の交通費と宿泊費／ケ月）</p></blockquote><p>イベントに acall の社員さんが10人ぐらい参加していた。勢いのある会社は会社イベントに参加する人も多くてよい雰囲気にみえた。宮崎県から来られていたしやさんの他にも埼玉県から来られていたとしさんという方もいた。他にも遠方から来ていた方もいたのかもしれない。</p><h2 id=2次会>2次会</h2><p>いまひとつ飲み足りなかったので三ノ宮.dev の仲のよい人たちと飲みに行った。<a href=https://tabelog.com/hyogo/A2801/A280101/28037644/>RailRoad no.57</a> というバーでよい雰囲気のお店だった。またなにかの機会で使いたいと思う。葉っぱ (ハーブ？) がたくさん入っているはちみつカクテルがおいしかった。</p><figure><img src=/diary/img/2023/1201_drink.jpg></figure><p>そこで以前コミュニティで起業相談にのった方の経営について話題になった。創業してから1年弱かけて少し前にある web サービスをリリースした。その web サービスはコモディティで、すでに競合も数社ある。あまり新規のベンチャー企業にとって勝ち目のある分野だと私からはみえない。どうやってこの web サービスを黒字化するのだろう？と私は疑問に思っていた。創業者の相談に乗った方も今後の戦略について尋ねても明確な答えは返ってこなかったようでとても不安になったと話されていた。融資を受けたという話しを聞いていたのでしばらく会社を存続できるのかもしれないけど、作った web サービスを収益化しないと次の融資を受けられることはないだろうから先行きは厳しいのではないかと推測する。外部からみえる範囲内では今後の先行きは危ぶまれる。創業して1年もたつのに、若い開発者にすら心配されるような戦略しかもっていない経営者というのはちょっと想像できない。融資を受けることが出来たぐらいだから、起業や経営について相談にのってくれる人は周りにいるんじゃないかと思うんだけど、経営目線で厳しいことを言ってくれる人はいないのかもしれない。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1130/>複数の kit アプリケーションを共存させる仕組みの考察</a></h1><div class=post-meta><span class=post-date>2023-11-30 (Thu.)</span></div><span class=post-tags>#<a href=/diary/tags/svelte/>svelte</a>&nbsp;
#<a href=/diary/tags/debug/>debug</a>&nbsp;
#<a href=/diary/tags/node.js/>node.js</a>&nbsp;
#<a href=/diary/tags/javascript/>javascript</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#kitvite-アプリケーションのデバッグ>kit/vite アプリケーションのデバッグ</a></li></ul></nav></div><div class=post-content><p>1時に寝て3時に起きて5時に起きて7時半に起きた。なんとなく布団に入らずにベッドの上でそのまま寝てた。それでもあまり寒くはなかった。</p><h2 id=kitvite-アプリケーションのデバッグ>kit/vite アプリケーションのデバッグ</h2><p><a href=/diary/posts/2023/1127/#kitvite-アプリケーションのデバッグ>先日の続き</a> の続き。</p><p>kit アプリケーションを kit アプリケーションに埋め込むといったことができないかどうかの調査をしている。いろいろ調べている中で kit の discussions でもそういった議論はいくつか行われている。マイクロフロントエンドというキーワードも出てくる。</p><ul><li><a href=https://github.com/sveltejs/kit/discussions/4151>MicroFrontends with Svelte + SvelteKit #4151</a></li><li><a href=https://github.com/sveltejs/kit/discussions/5003>Approach to embedding Kit #5003</a></li></ul><p>これらの議論をみていても kit の ssr はそれ自体が1つのアプリケーションとして動かすことを前提にビルドされているため、kit アプリケーション内に別の kit アプリケーションを埋め込んだり、一部のコンポーネントを外部のアプリケーションと組み合わせて動かすことはなかなか難しいようにみえる。マイクロフロントエンドのような思想で設計されていない。しかし、既存のアプリケーションを動かしつつ、少しずつ kit アプリケーションへ移行するといった運用をしたいという世の中のニーズも根強いことが伺える。</p><p>ここで svelte.config.js でエントリーポイントを置き換えるぐらいはできる。デフォルトは <code>/</code> がエントリーポイントになるのを <code>/myapp</code> に置き換えるには次のように設定する。relative は es モジュールのインポートを相対パスで行うか、絶対パスにするかの設定も変更できる。これもデプロイ先のインフラの都合にあわせて調整できるようになっている。この設定を切り替えられるのだからエンドポイントをハックすること自体はそう難しくないのかもしれない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>kit</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>paths</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>relative</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>base</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;/myapp&#39;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>さらに調査していて、adapter-node を使ってビルドするとデフォルトでは <a href=https://github.com/lukeed/polka>polka</a> というアプリケーションサーバーが起動するコードが生成される。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>polka</span> (<span style=color:#a6e22e>opts</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Polka</span>(<span style=color:#a6e22e>opts</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>path</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>env</span>(<span style=color:#e6db74>&#39;SOCKET_PATH&#39;</span>, <span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>host</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>env</span>(<span style=color:#e6db74>&#39;HOST&#39;</span>, <span style=color:#e6db74>&#39;0.0.0.0&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>port</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>env</span>(<span style=color:#e6db74>&#39;PORT&#39;</span>, <span style=color:#f92672>!</span><span style=color:#a6e22e>path</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#e6db74>&#39;3000&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>server</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>polka</span>().<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>handler</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>listen</span>({ <span style=color:#a6e22e>path</span>, <span style=color:#a6e22e>host</span>, <span style=color:#a6e22e>port</span> }, () =&gt; {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Listening on </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>path</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>path</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>host</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;:&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>port</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>ここで任意のアプリケーションサーバーを使いたいという issue があって、それに対する回答から adapter-node のドキュメントにカスタムサーバーについて書かれていることに気付く。</p><ul><li><a href=https://github.com/sveltejs/kit/issues/8794>Custom server options for adapter-node #8794</a></li><li><a href=https://kit.svelte.dev/docs/adapter-node#custom-server>Node servers: Custom server</a></li></ul><blockquote><p>アダプタは、ビルドディレクトリにindex.jsとhandler.jsの2つのファイルを作成します。index.js を実行すると (デフォルトのビルドディレクトリを使用している場合は node ビルドなど)、設定されたポートでサーバが起動します。</p><p>あるいは、Express、Connect、Polka（あるいは組み込みのhttp.createServer）に適したハンドラをエクスポートするhandler.jsファイルをインポートして、独自のサーバをセットアップすることもできます。</p></blockquote><p>handler.js さえインポートすればそのまま動くことはデバッグしていて知ってはいたのだけど、この自前のアプリケーションサーバーを <a href=https://kit.svelte.dev/docs/hooks>hooks</a> を使って起動すれば任意のサーバーに置き換えできると issue の中で回答されていた。kit アプリケーションは1つのサーバーが1つのシステムとして動かすことを前提に設計されているが、サーバーを複数起動することでそれらを共存できるのではないか？と考えた。検証のために node.js から子プロセスを生成するには次のようなコードで起動する。些事だけど adapter-node の生成したコードが shell を介しないとポート番号を設定できなかったので <code>shell: true</code> もセットしている。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>spawn</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;child_process&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>start_server() {</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;called start_server&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>opts</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shell</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>env</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      ...<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>PORT</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;3005&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ORIGIN</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;http://localhost:5174&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>NODE_ENV</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;production&#39;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>node</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>spawn</span>(<span style=color:#e6db74>&#39;node&#39;</span>, [<span style=color:#e6db74>&#39;apps/myapp/build/index.js&#39;</span>], <span style=color:#a6e22e>opts</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>stdout</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;data&#39;</span>, (<span style=color:#a6e22e>data</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>stderr</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;data&#39;</span>, (<span style=color:#a6e22e>data</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;exit&#39;</span>, (<span style=color:#a6e22e>code</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Child exited with code </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>code</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>この node.js の子プロセスを起動する処理を hooks で呼び出すことである kit アプリケーションを起動したときに、別の kit アプリケーションを提供するアプリケーションサーバーの node.js プロセスも起動できる。そしてパスを解決できるようにするため、さらに es モジュールのインポートパスにあわせたプロキシを実装する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>start_server</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;$lib/index&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>start_server</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#66d9ef>type</span> { <span style=color:#a6e22e>Handle</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@sveltejs/kit&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handle</span>: <span style=color:#66d9ef>Handle</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> ({ <span style=color:#a6e22e>event</span>, <span style=color:#a6e22e>resolve</span> }) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>pathname</span>.<span style=color:#a6e22e>startsWith</span>(<span style=color:#e6db74>&#39;/myapp&#39;</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>method</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;GET&#39;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;http://localhost:3005&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>pathname</span>);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>method</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;POST&#39;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>formData</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>endpoint</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://localhost:3005&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>pathname</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>search</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>endpoint</span>, { <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;POST&#39;</span>, <span style=color:#a6e22e>body</span>: <span style=color:#66d9ef>data</span> });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>resolve</span>(<span style=color:#a6e22e>event</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>これは kit のデモアプリが動くことを確認するためだけに実装したプロキシで GET/POST のリクエストを localhost:3005 に起動した node.js のプロセスへプロキシしている。これで2つの kit アプリケーションが1つのサーバーで共存しているかのように振る舞うことは確認できた。この延長上に私のやりたいことが実現できるかどうかをさらに調査する必要がある。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1129/>気付きというスキル</a></h1><div class=post-meta><span class=post-date>2023-11-29 (Wed.)</span></div><span class=post-tags>#<a href=/diary/tags/project-management/>project management</a>&nbsp;
#<a href=/diary/tags/issue-management/>issue management</a>&nbsp;
#<a href=/diary/tags/information-exchange/>information exchange</a>&nbsp;
#<a href=/diary/tags/communication/>communication</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#プロジェクトの進捗報告>プロジェクトの進捗報告</a></li></ul></nav></div><div class=post-content><p>2時に寝てあまり眠れなくて6時半に起きた。スマホで <a href=https://goblinslayer.jp/>ゴブリンスレイヤーⅡ</a>をみてから寝た。</p><h2 id=プロジェクトの進捗報告>プロジェクトの進捗報告</h2><p>出張したときの月例報告の12回目。<a href=/diary/posts/2023/1101/>前回の進捗報告はこちら</a> 。</p><p>開発の中盤を過ぎて、これから追い込みへ入っていく。予定していたバックエンドの機能開発は完了した。私の頭の中ではもう完了までの見通しができていて、あとはフロントエンドの新規画面を構築したり、品質や堅牢性のための小さい改善をしていくといったことを残りの1ヶ月で行う。若いメンバーに経験を積んでもらうことも考慮しているため、サポートを最小限にしながらメンバーの成長を期待したいところ。見た目上の開発スケジュールは順調なのでマネージャーとしスケジュールの懸念はほとんどない。<a href=/diary/posts/2023/1127/#kitvite-アプリケーションのデバッグ>kit/vite アプリケーションの調査</a> を私が自らやっていて、これを一区切りつけないと次の作業に進めないところが、私の課題でもある。インターネットを検索してもみつからないことを、どのように考え、仮説を立て、調査して、意思決定していくかをメンバーに示したい。マネージャーが一連のワークフローについて業務の参考になるようものをみせることができればいいなと考えている。</p><p>以前 <a href=/diary/posts/2022/0107/#情報共有とコミュニケーションコスト>コミュニケーションのレベルについて考えたこと</a> をベースにした方法論を社内の wiki にも書いてある。5段階のコミュニケーションのレベルがあり、多くの人たちはレベル4までしか到達しないのだけど、課題管理のスキルを身につけるとレベル5の「聞かなくてもわかる」というエスパーのような状態に達する。メンバーのうちの1人はこのレベルに片足を踏み入れていて、十分にうまく課題管理できているという話題も共有した。一方でレベル5に至るためのプラクティスや施策を、課題管理という文脈でもっとうまくできないか？というのはうちの会社のビジネスの中核でもある。とても難しい。いわば「気付き」を習得するための短期修行コースのようなものを作りたい、業務の中で。この話題を話し始めると、気付きの有無はその人の性格や動機づけにも関連するせいか、賛否両論の多様な議論に発散しやすい。私の立場としては、一定レベルまでは誰でも身につけられるスキルとして扱いたいが「気付き」が本当にスキルなのかどうか、実は確信がない。しかし、諦めることなく継続的に考えていきたい。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1128/>新規メンバーを受け入れないという意思決定</a></h1><div class=post-meta><span class=post-date>2023-11-28 (Tue.)</span></div><span class=post-tags>#<a href=/diary/tags/biztrip/>biztrip</a>&nbsp;
#<a href=/diary/tags/project-management/>project management</a>&nbsp;
#<a href=/diary/tags/team-building/>team building</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#出張前の朝ご飯>出張前の朝ご飯</a></li><li><a href=#マイルストーン定例>マイルストーン定例</a></li></ul></nav></div><div class=post-content><p>19時過ぎに帰って晩ご飯食べて、21時から0時過ぎまでオフィスで作業して、また帰ってから一休みして出張準備して、5時前に出掛けた。1ヶ月ぶりの出張。</p><h2 id=出張前の朝ご飯>出張前の朝ご飯</h2><p>三ノ宮駅のすぐ近くに24時間営業のなか卯がある。うまく眠れなくて時間があるときはここで朝ご飯を食べながら一息つくのがよいのではないかと考えた。今回の実際のタイムスケジュールが次になる。市営地下鉄の駅が5時30分ぐらいにならないと開かないため、あまり早く行ってもやることなくて手持ち無沙汰になる。その隙間時間を埋める場所としてなか卯がよいことに気付いた。</p><ul><li>4:56 家を出る</li><li>5:10 なか卯に着く</li><li>5:11 親子丼を注文する</li><li>5:16 親子丼食べ終わる</li><li>5:30 なか卯を出る</li><li>5:35 市営地下鉄三宮駅のホームに着く</li><li>5:41 市営地下鉄の始発に乗って新神戸駅へ</li></ul><h2 id=マイルストーン定例>マイルストーン定例</h2><p>隔週の火曜日は開発状況の共有や進捗確認、設計レビューなどを行う定例会議。<a href=/diary/posts/2023/1031/#マイルストーン定例>先月の定例会議</a> でも確認していたが、新規メンバーの参加がうまく進捗していない。機能開発を3ヶ月と見積もっているうちの、2ヶ月が過ぎた。さすがにここから開発に参加して追いつくのは厳しいので、新規メンバーの今後の兼務状況に関係なく、今回の開発からは外すという意思決定をした。五月雨式に2回遅れたところで私の中では開発運営の構想から外すように徐々に調整してきていたし、2週間のイテレーションの節目でも既存メンバーにタスクを再割当てするようにもしていた。そのため、いまの開発に大きく影響を与えるわけではない。しかし、参加する可能性も残ってはいたのであからさまに除外することもできなかった。3回に渡って「いついつからやります」と言いながら、(兼務の業務が忙しいとしても) 何もやっていないことに、この開発やチームに責任をもつ私の立場としては印象が悪かった。なによりも業務として責任を果たしていない状況を問題であると当事者が自覚しているようにはみえないところにも懸念があった。よくない開発文化の実例の1つに思えた。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1127/>sveltekit/vite アプリケーションの調査を再開</a></h1><div class=post-meta><span class=post-date>2023-11-27 (Mon.)</span></div><span class=post-tags>#<a href=/diary/tags/svelte/>svelte</a>&nbsp;
#<a href=/diary/tags/vite/>vite</a>&nbsp;
#<a href=/diary/tags/debug/>debug</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#kitvite-アプリケーションのデバッグ>kit/vite アプリケーションのデバッグ</a></li><li><a href=#小規模企業共済オンライン手続きポータル>小規模企業共済オンライン手続きポータル</a></li></ul></nav></div><div class=post-content><p>1時に寝て起きたか起きてないか覚えてない感じで6時に起きた。起きてちょっとゲームして気付いたら7時だった。</p><h2 id=kitvite-アプリケーションのデバッグ>kit/vite アプリケーションのデバッグ</h2><p><a href=/diary/posts/2023/1124/#テックブログ公開>先週公開したテックブログ</a> の続き。</p><p><a href=https://ja.vitejs.dev/guide/backend-integration.html>vite アプリケーションのバックエンドインテグレーション</a> の詳細を調査している。丸1日デバッグしていていくつか振る舞いがわかってきて、designer アプリケーションを作りたいという要件に対して、こうすればできるんじゃないかという仮説も立てられるようになった。いまやりたい要件は kit の ssr アプリケーションを埋め込みたい。これは要件に満たないが、kit の ssg アプリケーションならば static ディレクトリに置くだけで参照できるし、インポートパスさえ書き換えてやれば別の kit アプリに埋め込むこともできるのを確認した。意図した通りの振る舞い。</p><p>vite アプリケーションはビルドオプションで manifest.json を出力し、エントリーポイントやどのファイルがどのファイルをインポートしているかといった情報を管理している。sveltekit はこれらの manifest.json から rollup でバンドルするために manifest.js を生成している。厳密には、sveltekit では production ビルド向けのチューニングをしたビルドツールを <a href=https://kit.svelte.dev/docs/adapters>adapter</a> と呼び、vite のビルドをフックする場所に1つになっている。node.js サーバー向けに production ビルドするときは <a href=https://kit.svelte.dev/docs/adapter-node>adapter-node</a> を使う。この実装を読んでみると、vite がビルドした成果物に対して、再度 rollup でバンドルして成果物を作り直すといったことをしている。そして、vite の成果物 (manifest.json も含む) を抽象化したものが <a href=https://kit.svelte.dev/docs/types#public-types-builder>Builder</a> となる。adapter は Builder のインスタンスを使ってビルドの成果物を制御できる。先の manifest.js もこのときに生成していて、rollup でバンドルするためのパラメーターの1つとして使っているようにみえる。しかし、rollup のドキュメントをみても直接的に manifest.js の説明はなく、rollup の拡張の仕組みで manifest.js を作っているというよりは、sveltekit の要件によるもののようにもみえる。ここの背景はまだよくわからない。</p><p>私はフロントエンドのことが全然わからないのでライブラリのソースコードを読みながら、ドキュメントとあわせて調べて、1つずつ理解を深めていくというアプローチで進めている。こういった調査のやり方もメンバーへ伝えていければと考えている。</p><h2 id=小規模企業共済オンライン手続きポータル>小規模企業共済オンライン手続きポータル</h2><p><a href=/diary/posts/2022/0206/#2021年度の個人の確定申告>2021年度から小規模企業共済</a> に加入している。今年から掛け金を7万円/月に変更した。年間で84万円の所得控除となる。ちょうど2023年9月1日からポータルサイトが作成されたらしい。いずれマイナポータルと紐付くのかもしれない。</p><ul><li><a href=https://www.smrj.go.jp/org/info/press/2023/ool3bn000000kxx5-att/20230901_press01.pdf>「オンライン手続きポータル」を公開しました</a></li></ul><p>利用登録しようと思って、メールアドレスを登録しようとしたら会社のメールアドレスはなぜかバリデーションエラーになって gmail のアドレスなら登録できた。その後も氏名の半角カナ入力を強制されたりしながら、マイナンバーカードを読み取って認証チェックして利用登録の申請はできた。しかし、自動で本登録されるわけではなく、おそらく申請内容が先方に届いてなんらかの運用があって本登録されるみたい。オンラインポータルのホームでも半角カナを使っていたり、<code>&lt;title></code> タグには「マイナ手続きポータル」とあったり、申請しただけでいくつも不備がわかるようなひどいサイトになっている。2023年にまともな開発者が作ったサイトとは思えない。デジタル庁に作り直してもらった方がよいと思う。</p><ul><li><a href="https://portal.e-shishobako.ne.jp/dp_apl/pw-usr/#/portal/landing?riyoCd=RGO0226000">小規模企業共済ｵﾝﾗｲﾝ手続きﾎﾟｰﾀﾙ</a></li></ul></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1126/>フルリモートとヒトリ</a></h1><div class=post-meta><span class=post-date>2023-11-26 (Sun.)</span></div><span class=post-tags>#<a href=/diary/tags/event/>event</a>&nbsp;
#<a href=/diary/tags/coworking/>coworking</a>&nbsp;
#<a href=/diary/tags/community/>community</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/drinking/>drinking</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#友だちを探しに勉強会へ>友だちを探しに勉強会へ</a></li><li><a href=#ストレッチ>ストレッチ</a></li></ul></nav></div><div class=post-content><p>1時に寝て珍しく夜中起きずに7時ぐらいまで寝ていたかもしれない。午前中は昨日受け取ったスタンディングデスクを仮組みの状態からネジを締め付けて本組みした。ちょうど探していたものにぴったりはまる感じ。</p><h2 id=友だちを探しに勉強会へ>友だちを探しに勉強会へ</h2><p><a href=https://kobe-sannomiya-dev.connpass.com/event/299312/>もくもく会</a> に参加した。今日の参加者は6人とやや少なかったものの、初めて来られた方が2人いて、どちらもフルリモートで働いているものの、技術の話し相手や相談する場所がなくて、そういうものを求めて来ましたと話されていた。私も5年前に東京から神戸へ引っ越してきたとき、友だちがいないから探そうと思ってこのコミュニティへ来た。みんな同じところで落とし穴にはまるなと思って親近感を覚えた。以前 <a href=/diary/posts/2023/1014/>Python Boot Camp のお手伝い</a> をしたときに知り合った、現地スタッフのにしたにさんが淡路島出身で、三ノ宮.dev にも関心があったようなので来られて挨拶した。そうやってつながりが増えていくのもまた嬉しい。</p><p>今後はフリーランスや個人事業主、マイクロ法人といった1人で働くスタイルがより増えていくと私は考えている。以前にも <a href=/diary/posts/2023/0827/#マイクロ法人のススメ>マイクロ法人のススメ</a> を書いたが、1人で働くメリットは大きいものの、デメリットとして相談相手がいなかったり、困ったときに他者へ助けを求められないなどがある。コワーキングや勉強会コミュニティはそういった1人のデメリットを補う形で発展していくのではないかと想像している。そして、そのときのための準備を2年前ぐらいから始めている。</p><h2 id=ストレッチ>ストレッチ</h2><p>土曜日に実家へ帰っていたのでストレッチを日曜日の夜に変更していた。昨日、車でジモティーのスタンディングデスクを引き取りに行ったり、実家との往復をしたので腰への負担が大きかった。それ以外は大きな疲労や張りなどはなかったと思う。勉強会後に飲み会へ行って、軽く1杯だけ飲んでやめとくつもりが、ビール2杯とハイボール1杯飲んでしまって、酒臭かったら悪いなぁと思いながらストレッチを受けていた。トレーナーさんはお酒の匂いしないと言ってくれてたけれど、本当のところはどうだったのか。ほろ酔いでストレッチを受けていた。今日の開脚幅は開始前152cmで、ストレッチ後157cmだった。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1125/>他人の言うことを聞かないと気付けない</a></h1><div class=post-meta><span class=post-date>2023-11-25 (Sat.)</span></div><span class=post-tags>#<a href=/diary/tags/career/>career</a>&nbsp;
#<a href=/diary/tags/communication/>communication</a>&nbsp;
#<a href=/diary/tags/failure/>failure</a>&nbsp;
#<a href=/diary/tags/coworking/>coworking</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#しくじり先生>しくじり先生</a></li><li><a href=#スタンディングデスク受け取り>スタンディングデスク受け取り</a></li><li><a href=#実家との往復>実家との往復</a></li></ul></nav></div><div class=post-content><p>23時に寝て1時に起きて4時過ぎに起きた。昨日、打ち合わせに来た親がうちに泊まっている。親がいると4時起きになる。</p><h2 id=しくじり先生>しくじり先生</h2><p>たまたま元プロ野球選手の <a href=https://ja.wikipedia.org/wiki/%E6%A3%AE%E6%9C%AC%E7%A8%80%E5%93%B2>森本稀哲</a> 選手のしくじり先生をみた。日ハムで新庄選手が活躍していたときにブレークした選手としてしか私は知らなくて、その後、どうなったのかも知らなかったが、キャリアハイを迎えた後は期待された成績を残せず、苦労しながらも野球を続けて引退試合をしてもらえるぐらいには活躍された選手だったようだ。無名のまま引退するプロ野球選手もたくさんいる中で、本人も話していた通り、一時期レギュラーとして活躍して、16年3球団もプロ野球選手で入れたことは間違いなく幸せな選手の側だと思う。</p><div class=video-container><iframe src=https://www.youtube.com/embed/80O0t4uQUKw allowfullscreen title="神回復活！森本稀哲 新庄剛志先輩に影響を受けすぎてしくじり連発？！"></iframe></div><p>病気のため、小さい頃からコンプレックスを抱えてきた人生の中、それが改善したり悪化したりもしながら、いまふりかえっているのは、人は共通してそういうところに陥ると思えて親近感もわく。いろいろなしくじりもあった中での私にとって気になったのは次の言葉だった。</p><blockquote><p>うまくいっていないときに頑固で他人の言うことを聞かないから自分で悪い状態に気付けなかった。</p></blockquote><p>マイクロ法人やフリーランスの一番の難しさはここにあると私も思う。1人だとキャリアに与える影響に自身の状態がかなり大きい。<a href=https://www.gcd.org/blog/2010/04/576/>「無知の無知」への 3ステップ</a> を常に私は意識していて、自分の誤りに自分で気付けていない状態が一番怖い。私にもいくつか成功体験があるから、自信過剰になるとこのやり方ならうまくいくはずと誤った方向に進んでしまう懸念は避けられない。周りにいる人たちに「それ、おかしいよ」とか「何をやっているのか理解できない」とか言ってもらう機会や制度設計に気を配っている。私も他人の言うことをあまり聞かない傾向があるので稀哲さんの頑固で失敗したという体験談は親身に思えた。</p><h2 id=スタンディングデスク受け取り>スタンディングデスク受け取り</h2><p>ジモティーで引っ越しで処分していた「DEVAISE スタンディングデスク」を2000円で購入した。メーカーのサイトがどこかわからにので amazon のリンクを張っておく。これは実家の離れではなく、うちのマンションでホットクックを置く台として使う。お昼に東灘区まで引き取りに行ってきた。メッセージを送ると相手のレスポンスの早い方で20分以内には返信が届いていた。メッセージのやり取りだけでシステムに慣れた相手だというのがわかる。本当は引き取りも13時の予定だったのだけど、こっちの都合が変わったので11時頃に早くできない？と訪ねたら20分後には11時45分にいけるよと返ってきて早く引き取りした。</p><p><a href="https://www.amazon.co.jp/DEVAISE-%E3%82%B9%E3%82%BF%E3%83%B3%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%83%87%E3%82%B9%E3%82%AF-%E3%82%B9%E3%82%BF%E3%83%B3%E3%83%89%E3%83%87%E3%82%B9%E3%82%AF-%E4%BE%BF%E5%88%A9%E3%81%AA%E3%82%BF%E3%83%83%E3%83%97%E5%8F%8E%E7%B4%8D%E4%BB%98%E3%81%8D-%E3%81%8D%E3%82%8C%E3%81%84%E3%81%AA%E9%85%8D%E7%B7%9A%E3%81%AE%E6%B5%81%E3%82%8C/dp/B07VSYRRML?&linkCode=li2&tag=t2y-diary-22&linkId=9c97dd7fcf3d819292d32719dbabc9b9&language=ja_JP&ref_=as_li_ss_il" target=_blank><img border=0 src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B07VSYRRML&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=t2y-diary-22&language=ja_JP"></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=t2y-diary-22&language=ja_JP&l=li2&o=9&a=B07VSYRRML" width=1 height=1 border=0 alt style=border:none!important;margin:0!important></p><h2 id=実家との往復>実家との往復</h2><p>親を送るのと、実家コワーキングスペース化のための椅子を運ぶのと、親戚と打ち合わせの3つを兼ねて実家へ車で帰る。道中、姉の職場へ立ち寄り相続関連の書類を渡して、親戚の家にお邪魔して少し打ち合わせして、16時過ぎには実家へ着いた。<a href=/diary/posts/2023/0918/#椅子の引き取り>カフーツのいとうさんから引き取った椅子4脚</a> をようやく実家の離れまで運んだ。2脚ずつで2回かかった。あとは机を1-2つ探してくればコワーキングスペースとして形は成り立ちそう。</p><figure><img src=/diary/img/2023/1125_chairs.jpg></figure><p>それからまた神戸へ戻る。1日で神戸と実家を往復したのは初めてかもしれない。帰りは途中で眠くなって淡路 SA で休憩した。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1124/>家族信託の打ち合わせ</a></h1><div class=post-meta><span class=post-date>2023-11-24 (Fri.)</span></div><span class=post-tags>#<a href=/diary/tags/svelte/>svelte</a>&nbsp;
#<a href=/diary/tags/blog/>blog</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/investing/>investing</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#テックブログ公開>テックブログ公開</a></li><li><a href=#家族信託の打ち合わせ>家族信託の打ち合わせ</a></li></ul></nav></div><div class=post-content><p>1時に寝て4時に起きてもう1度どこかで起きて7時半に起きた。</p><h2 id=テックブログ公開>テックブログ公開</h2><p><a href=/diary/posts/2023/1122/>テックブログレビュー</a> を終えて公開した。この機会に <a href=/diary/posts/2023/1120/#hugo-で書いた記事に目次を生成する>個々の記事に目次</a> も追加した。はらさんレビューから修正をして2時間後に公開しますよと宣言して勝手に公開した。</p><ul><li><a href=https://blog.osstech.co.jp/posts/2023/11/how-sveltekit-compiles/>SvelteKit はどのようにコンパイルしているのか？</a></li></ul><h2 id=家族信託の打ち合わせ>家族信託の打ち合わせ</h2><p>15時にお仕事を早退して、親と一緒に明石市にある弁護士さんの事務所へ訪問した。三ノ宮から車で向かって、ナビゲーションに従っていたら京橋から高速道路に入って若宮でおろされて、なんでこんな早く高速道路おりるんやろ？と不思議に思ったけど、須磨からの海岸線はそれほど渋滞せず信号も多くないから下道で行ってもそんなに時間はかからないという判断だったようにみえる。だいたい40-50分ほどで明石市の中心地に着いた。3分ほど遅刻して打ち合わせが始まった。</p><p>遺産を相続するとさまざまなリスクがある。大きなお金をもつというだけで詐欺のターゲットにされる。家族信託 (民事信託) という制度を使って、そのとき必要なお金のみを受け取るように運用する。構成要素は次の通り。</p><ul><li>委託者: 母</li><li>受託者: 私と姉</li><li>信託財産: 預金</li></ul><p>受託者は最低2人必要で、うちは姉もいるのでよいのではないかと弁護士さんが話されていた。たしかに1人っ子なら誰かにお願いしないといけない。大雑把に言えば、母の貯金を子どもに管理してもらうような制度になる。但し、最初の契約書に記載された内容の範囲内でしか、受託者はお金を引き出せないのでその契約書をしっかり作ることが重要になる。契約書に記載していれば、資産運用もできるらしい。契約書の叩き台として、どういった内容を書いておくかを相談した。弁護士さん曰く、契約書に書いておかないとその用途に使えなくなるため、1%でも可能性があれば、書くだけ書いておいた方がよいとのこと。書いておいて、実際に使わないというのはなんの問題もない。</p><p>3人でブレストするような感じで項目を洗い出した。</p><ul><li>生活費<ul><li>冠婚葬祭で払うお金<ul><li>10万円以内なら生活費として引き出してもよい</li><li>例えば30万円いるとして、建替え可能なら10万円/月を3ヶ月かけて引き出すでもよい</li></ul></li><li>(お金に困った親戚がいたと仮定して) 親戚への資金援助<ul><li>生活費の範囲内でやればよいはず</li></ul></li></ul></li><li>看護、療養といった通院も含めた医療費</li><li>老人ホームの入居費用</li><li>納税 (一時所得)<ul><li>太陽光発電で得た収益のうち、所得税をこの口座から引き出して支払うといったこともできる</li></ul></li><li>家の改築、修繕、取り壊しの費用</li><li>農業のための費用<ul><li>農機具の購入や修理など</li><li>トラクターが一番高い、100万円〜1,000万円ぐらいとピンからキリまである</li></ul></li><li>土地 (田んぼ、宅地) の購入</li><li>太陽光発電設備の撤去費用</li><li>自家用車の購入費用</li><li>生命保険の支払い<ul><li>死亡保険金は500万円 x 法定相続人数まで非課税なので相続税の節税になるらしい<ul><li>例) 母の死亡時に姉と私が500万円受け取るような生命保険に入る</li></ul></li><li>相続税の基礎控除が3,000万円 + 600万円 * 法定相続人数<ul><li>例) うちは私と姉で 3000 + 600 * 2 = 4,200万円が基礎控除となる<ul><li>この金額を超える遺産があれば相続税の課税対象となる</li><li>生命保険へ付け替えることで 4200 + 500 * 2 = 5,200万円まで非課税にできる？</li></ul></li></ul></li></ul></li><li>資産運用<ul><li>投資信託<ul><li>積み立て系の投資信託がもっとも望ましいのではないか<ul><li>リスクヘッジとして大きなお金を1度に動かすのはなるべく避けたい</li><li>NISA 口座を開設できるかどうかは調べないとわからない</li></ul></li><li>信託口座とは別に証券口座も開設しないといけない<ul><li>受託者が預金口座からお金を引き出して証券口座へ振り込むような運用になる？</li></ul></li><li>具体的にどういった運用にするかは信託銀行と応相談になるかもしれない<ul><li>なんらかの制約が課されるのではないかと推測される</li></ul></li></ul></li><li>株式投資<ul><li>可能ではあるが、条件を指定しないといけないため、中長期での実運用は難しいのではないか</li></ul></li></ul></li></ul><p>私が信託口座からお金を引き出すときに、一定金額以下の生活費 (例えば10万円) ならノーチェックだが、100万円とか大きなお金を引き出すときには銀行員からチェックがかかり、正当な使途なのかどうかを確認されるという。場合によっては見積もり書の提出なども必要かもしれないとのこと。それはとくに問題ない。契約書の作り直し自体は委託者が元気であればできる。しかし、手数料や手間暇もかかるため、実運用としては最初に作った契約書を変更するといったことはそうそう行われない。最初が大事。弁護士さんが契約書を作成するのに2-3週間かかる。その後に三井住友銀行さんで赤ペン先生のチェックが入る。契約内容の修正などのやり取りをしてその後手続きに進む。</p><p>思考実験として、詐欺にあって借金してしまった、または連帯保証人となって借金してしまった。その場合はどうなるか？というのも考えてみた。信託銀行に確認してみるとのことだったが、弁護士さんが言うには、家族信託の目的は財産を守ることにあるため、本来の使途ではないものへ支払いは抵抗があるかもしれないとのこと。その状況によって銀行員の判断次第かもしれないとのこと。</p><p>受託者は年に1回報告書 (帳簿) を作り、どのように運用したかを委託者へ報告する義務がある。これは家族間だけの話ではある。この手の情報処理 (データ処理) は私が得意とするのでそんなのすぐやりますと回答できた。弁護士さんによると、こういう事務作業を嫌がる受託者もいるという。スプレッドシートでちゃちゃっと作ればよいはず。</p><p>契約書を作成したら、それをもって委託者、受託者、弁護士の3人で <a href=http://kobe-koushou-center.jp/>神戸公証役場</a> へ一緒に行く。その公正証書をもって三井住友信託銀行へ行って、母が口座を開設して、そこに弁護士さんが遺産を振り込むといった段取りになる。将来、委託者の健康を害して成年後見人がつく状況になったとしても家族信託の口座はそのまま受託者が管理できる。成年後見人に信託口座が移管されるようなことはない。</p><p>最後に契約書の条項をチェックしていて次の内容を教えてもらった。</p><blockquote><p>弁護士業務の適正の確保</p><p>甲は、本件事件等の処理の依頼目的が犯罪収益移転に関わるものではないことを、表明し保証する。</p></blockquote><p>「半社チェックのようなもの？」と聞いたらちょっと違っていて、弁護士は大きなお金を動かしても監査を受けないという特権 (信頼) があって、その特権はマネーロンダリングできてしまうという諸刃の剣でもあるらしい。今回のお金は遺産なので半社会的なものに該当しないが、契約書では弁護士が扱う業務がマネーロンダリングではないことをチェックする必要があるみたい。</p><p>帰りに <a href=https://www.go-akashiyaki.com/>明石焼き ゴ</a> というお店で明石焼きを買った。駐車場の近くにあったお店に立ち寄ってテイクアウトしたのだけど、とてもおいしかった。それで <a href=https://tabelog.com/hyogo/A2804/A280401/28005563/>食べログ</a> の評価もみたら 3.49 とかなり高い。たまたま買ったところがよいお店だった。18時半頃に店内もほぼ満席だったと思う。また明石へ行く機会があれば寄ってみようと思う。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1123/>なにも手につかない休日</a></h1><div class=post-meta><span class=post-date>2023-11-23 (Thu.)</span></div><span class=post-tags>#<a href=/diary/tags/investing/>investing</a>&nbsp;
#<a href=/diary/tags/game/>game</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#呪術廻戦のスマホゲーム>呪術廻戦のスマホゲーム</a></li></ul></nav></div><div class=post-content><p>1時までオフィスで作業して3時に寝てやや吐き気で起きて9時前に起きた。夕方から「翔んで埼玉」の1作目をみた。想像した雰囲気とはちょっと違っていた。私が関東圏に関心がないからそれほど親近感はなかった。</p><h2 id=呪術廻戦のスマホゲーム>呪術廻戦のスマホゲーム</h2><p>コロナ禍明けから広告系の会社の株価が落ちている。<a href=https://www.nikkei.com/article/DGXZQOUC319TX0R31C23A0000000/>サイバーの23年9月期、純利益78%減「ウマ娘」失速</a> にあるように、サイバーエージェントはとくにウマ娘のヒットが落ち着きあるようで、さらに株価が落ちていた。直近の高値2,441円から <a href=https://www.nomura.co.jp/terms/japan/ha/a01849.html>半値八掛け二割引</a> で算出すると781円になる。</p><blockquote><p>2441 * 0.5 * 0.8 * 0.8 ≠ 781 円</p></blockquote><p>1年ぐらい前からサイバーエージェントの株価もたまたま観測していた。この計算式はだいたい1/3ぐらいと覚えていたので800円台が底値かなと目安にみていて、いま計算し直したら781円だった。そろそろ底値付近かなと少しずつ買っていた。直近の約定日の時系列の推移が次になる。</p><table><thead><tr><th style=text-align:center>日付</th><th style=text-align:right>始値</th><th style=text-align:right>高値</th><th style=text-align:right>安値</th><th style=text-align:right>終値</th><th style=text-align:right>出来高</th><th style=text-align:right>調整後終値</th></tr></thead><tbody><tr><td style=text-align:center>2023-07-27</td><td style=text-align:right>959</td><td style=text-align:right>970</td><td style=text-align:right>900.4</td><td style=text-align:right>923.8</td><td style=text-align:right>33,373,800</td><td style=text-align:right>923.8</td></tr><tr><td style=text-align:center>2023-09-08</td><td style=text-align:right>900</td><td style=text-align:right>901.9</td><td style=text-align:right>851.7</td><td style=text-align:right>854.8</td><td style=text-align:right>26,553,700</td><td style=text-align:right>854.8</td></tr><tr><td style=text-align:center>2023-09-22</td><td style=text-align:right>790.6</td><td style=text-align:right>812.1</td><td style=text-align:right>787.4</td><td style=text-align:right>802.7</td><td style=text-align:right>8,628,700</td><td style=text-align:right>802.7</td></tr><tr><td style=text-align:center>2023-10-20</td><td style=text-align:right>782</td><td style=text-align:right>785.3</td><td style=text-align:right>775</td><td style=text-align:right>777.9</td><td style=text-align:right>3,993,600</td><td style=text-align:right>777.9</td></tr><tr><td style=text-align:center>2023-10-27</td><td style=text-align:right>768.7</td><td style=text-align:right>774.7</td><td style=text-align:right>758.2</td><td style=text-align:right>773.2</td><td style=text-align:right>5,453,700</td><td style=text-align:right>773.2</td></tr><tr><td style=text-align:center>2023-11-10</td><td style=text-align:right>815.6</td><td style=text-align:right>815.6</td><td style=text-align:right>792.4</td><td style=text-align:right>810.7</td><td style=text-align:right>6,552,700</td><td style=text-align:right>810.7</td></tr><tr><td style=text-align:center>2023-11-16</td><td style=text-align:right>847</td><td style=text-align:right>850.3</td><td style=text-align:right>824.2</td><td style=text-align:right>831.9</td><td style=text-align:right>6,180,300</td><td style=text-align:right>831.9</td></tr><tr><td style=text-align:center>2023-11-17</td><td style=text-align:right>831.9</td><td style=text-align:right>833.9</td><td style=text-align:right>817.3</td><td style=text-align:right>819.6</td><td style=text-align:right>5,098,200</td><td style=text-align:right>819.6</td></tr></tbody></table><p>ここ2-3日で気付いたら評価益が増えているなと気付いて調べたら <a href=https://jujutsuphanpara.jp/>呪術廻戦 ファントムパレード</a> というサイバーエージェントのグループ企業がゲームをリリースしてランキングが1位になっているらしい。一応チェックするかと思って、午前中はこのゲームをダウンロードして2-3時間やってみた。現時点ではソーシャル要素はほとんどなく、原作に忠実なキャラクターゲームという構成になっている。ストーリーのムービーはアニメの台詞をそのままをゲームの映像にあわせて流しているようなもの。私は原作をみたことがあるからスキップするけど、知らない人たちはこれをみながらストーリーを進めていくのだろうか。</p><p>全体として原作ファンならそこそこ楽しめると思う。五条悟が最強で領域展開しない限り攻撃が当たらない、しかし最強なので7ターンしたら戦闘離脱 (戦闘不能) するという設定になっている。ある程度、強い敵と連続的に戦闘しないといけないときは途中離脱してしまうのでそれでゲームバランスを調整している。最初のガチャだけ引き直しが出来て、自分の好きなキャラが出るまでやり直せる。それで五条悟が出るまで粘った。20回ぐらい引き直しした。</p><p>戦闘シーンもよく出来ているし、ムービーや声優さんの台詞もあり、大きな欠点のない普通のゲームといった印象。原因はわからないが、タップの操作を受け付けなくなるときがちらほらある。通信でブロックしているのか、イベントを処理できていないのか。プレイヤーだけでなく、アイテムやスキルにレベルを上げる要素があって、完凸を目指すような人は2-3年はやり続けるのかもしれない。ガチャで取得した五条悟の必殺技は術式反転「赫」になる。半年後のガチャでは虚式「茈」も実装されるのだろうと推測がつく。たしかに茈の戦闘シーンをみてみたい。出足からランキング1位でアクティブユーザーが多いなら予算もついて今後もゲームのコンテンツがパワーアップしていく可能性は高い。大ヒットしないまでも、普通のヒット作になって2-3年は続くのではないかと思えた。一方で私のような、ゲームも呪術廻戦の漫画 (アニメ) もにわかファンには、レベルをずっと上げ続けないといけないゲームはしんどいので、課金しないならそのうちに離脱してしまうと思う。時間がないから継続できない。</p><p>たまたまなのか、トレンド転換としてもよいタイミングなので順張りしながら様子をみてみようと思う。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/1122/>テックブログレビュー</a></h1><div class=post-meta><span class=post-date>2023-11-22 (Wed.)</span></div><span class=post-tags>#<a href=/diary/tags/writing/>writing</a>&nbsp;
#<a href=/diary/tags/motivation/>motivation</a>&nbsp;
#<a href=/diary/tags/food/>food</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#テックブログ執筆>テックブログ執筆</a></li><li><a href=#鶏もも肉-2kg-まとめ買い>鶏もも肉 2kg まとめ買い</a></li></ul></nav></div><div class=post-content><p>この前の <a href=/diary/posts/2023/1120/#ガンダムに学ぶ経営学>テレ東の番組</a> に影響をうけて夜にファーストガンダムをみたりしていた。1時に寝て3時半に起きて何をしていたか覚えていないが、気付いたら5時半だった。その後、slack のメッセージに気付いて返信するために6時半に起きた。</p><h2 id=テックブログ執筆>テックブログ執筆</h2><p><a href=/diary/posts/2023/1121/#テックブログ執筆>昨日の続き</a> 。残り 1/3 の <a href=https://ja.vitejs.dev/>Vite</a> についての調査内容を書いて昼過ぎにはレビュー依頼のマージリクエストを送った。といっても、お手伝い先の社内にはフロントエンドに詳しい開発者はほぼいないと推測される。はらさんにもお願いしていて、このレビューは実質的にはらさんが担当することになると想定される。はらさんの OK が出たらそのまま公開してしまおうと考えている。できれば金曜日中には公開してしまいたい。</p><p>学生の頃、物理の先生が言ったかどうか定かではないが「物体が動き出す直前が最も摩擦が大きい」という言葉を気に入っている。先週に大半を調べていた内容を、週末、月・火と4日もまたいで水曜日に記事を書き終えるというのが、私の職務レベルからすると怠慢と指摘されたら認めるしかない。金曜日の夜に能鑑賞して、土曜日はもくもく会へ行って、日曜日は深夜コワーキングをしていた。要は遊んでいた、楽しかったんだけど。加齢でモチベーションコントロールが難しいから土日の両方を遊んでしまうと、やらないといけないことがなにも進まないといった状況に陥ってしまう。そして、やらなくても誰からも怒られないというのが悲しい現実だ。</p><h2 id=鶏もも肉-2kg-まとめ買い>鶏もも肉 2kg まとめ買い</h2><p><a href=/diary/posts/2023/1112/#業務スーパー>業務スーパーの買いもの</a> の続き。17時にお仕事を終えて、時間があったので業務スーパーへ買いものへ行った。オフィスから近所の業務スーパーへ行くのは20分ほどかかることから、19時閉店のお店へ平日行くのはやや難しい。今日の目当ては鶏もも肉まとめ買い。2kg を買うと1,780円 (税抜き) で7つの肉片が入っていた。100g あたりに換算すると89円になる。さっそく炒めて食べてみたが、とくに調理や風味に問題はない。</p><ul><li><a href="https://www.gyomusuper.jp/product/detail.php?go_id=6037">吉備高原どりもも肉</a></li></ul><p>(おそらく) 同じ鶏肉の肉片1枚入りに小分けした真空パックだと 100g 98円になる。通常の肉のパッキングの消費期限は2-3日といったところが、真空パックだと7日に延びる。この9円の差異を真空パック料金だと捉えることもできる。この前 KOHYO で購入した国産鶏もも肉は 100g 138円だった。格段に安い。</p><figure><img src=/diary/img/2023/1122_chicken.jpg></figure><p>2kg も一度に消費できないので肉片の2つを冷蔵庫へ、5つは冷凍保存する。冷凍保存すると2-3週間はもつらしい。冷凍保存するためのラップで包んだり、解凍したりするのが面倒でもある。仮に1日で肉片1つを消費するとして7日分の食材になる。1枚入りの真空パックを3-4個買って冷蔵庫で保存して7日以内に食べるのでもよいかもしれない。</p></div></div><div class=pagination><div class=pagination__buttons><a href=/diary/page/14/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span>
</a><a href=/diary/page/16/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>