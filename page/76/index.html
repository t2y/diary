<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.109.0"><title>forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content="t2y"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="forest nook"><meta property="og:description" content><meta property="og:url" content="/diary/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0601/>手抜き</a></h1><div class=post-meta><span class=post-date>2022-06-01 (Wed.)</span></div><span class=post-tags>#<a href=/diary/tags/scrum/>scrum</a>&nbsp;
#<a href=/diary/tags/information-exchange/>information exchange</a>&nbsp;
#<a href=/diary/tags/issue-tracking-system/>issue tracking system</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#mvpminimum-viable-productで対応した>mvp（minimum viable product）で対応した</a></li></ul></nav></div><div class=post-content><p>2時に寝て6時に起きた。疲れていたからよく眠れた。</p><h2 id=mvpminimum-viable-productで対応した>mvp（minimum viable product）で対応した</h2><p>スクラムに限った話しではないと思うが、プロダクト開発をしていると mvp（minimum viable product）という言葉を聞くことがままある。昔ながらのイテレーション開発よりも、アジャイル開発の文脈でよく使われるように思う。というのは、短い開発期間でプロトタイプを作ったり、最低限の動く機能を作ったりすることをよしとする考え方があるから。昔ながらのやり方だと、イテレーション期間の中でそういった段階的な開発はするものの、外部からみたとき (もしくはマイルストーン) においてはそこそこの機能が提供されているので mvp といった言い方をすることはなかった。もしかしたらアルファとかベータとか呼んでいたかもしれない。最近ある lambda 関数の移行作業を行った。serverless framework でデプロイしていたリソースを cdk で一元管理する。その過程で既存のコードを読むと、ある id をハードコーディングで指定して <em>FIXME</em> がこんな感じに書いてあった。この id が指すリソースはその後なくなっており、本番環境で不要な処理が定期実行でずっと動き続けていたのと、本来は複数の id リソースに対して行うべき処理を実行していなかった。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># FIXME 対象 id 一覧を取得する。(Phase2までに対応します)</span>
</span></span><span style=display:flex><span>id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;ABC001&#39;</span>
</span></span></code></pre></div><p>チームの開発リーダーはその存在を全く忘れていたし、このスクリプトを実装したさらに上位の開発リーダーからはこの処理の要否はよくわからないからチームで確認してという曖昧な返事が返ってきた。チームで確認したところ、この処理は必要だとわかり、この機に複数の id リソースに対して対応するようにした。何も知らない私が修正しても5分で対応を完了した。</p><blockquote><p>mvp で対応したんで</p></blockquote><p>このように実装者は話していたが、本当なのだろうか？と思えた。さらにこのスクリプトのエラーログのログストリームを監視して slack 通知する lambda 関数も移行対象で、コードの検証をしていたところ、slack 通知をするための lambda 関数が別途あり、その動作検証をしていたところ、その lambda 関数を呼び出す権限 <em>lambda:InvokeFunction</em> が足りないことに気付いた。これも実装者に問い合わせたところ、動作検証はやっていないし、過去に1度も slack 通知は発生していないという。状況証拠から考えると、権限が足りないために正常に動作していなかったと推測される。結果的に mvp で対応したという2つの lambda 関数は実運用で半年間、無駄にリソースを浪費して何の役にも立っていなかった。当然、引き継ぎも、課題管理システムのチケットも、ドキュメントも何ら残されていなかった。mvp で対応したという表現に開発で大事なものを誤魔化してはいないだろうか。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0531/>締め切りの45分前</a></h1><div class=post-meta><span class=post-date>2022-05-31 (Tue.)</span></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#法人決算の間違い>法人決算の間違い</a></li></ul></nav></div><div class=post-content><p>0時に寝て4時に起きて7時に起きた。最近は4時に一回起きることも多くなってきた。ちょっとゲームしていつの間にか、寝たりもするけど。</p><h2 id=法人決算の間違い>法人決算の間違い</h2><p>5月の最終日なのでお昼休みに社会保険の引き落としの明細を手動で入力していた。ufj 銀行 (法人口座) の api 連携は有償サービスで、主に社会保険や経営セーフティ共済の引き落としにしか使っていないのでうちの会社は有償サービスを使っていない。通帳もしくは当日残高の明細をみて、それを手入力で freee の口座に登録する。そこで稀に利息がつくというのを失念していた。2月の利息15円の明細登録が漏れていることに気付いた。freee には登録残高という自動計算された口座残高をもっているので、それと明細の残高を見比べれば気付けるようになっているのだけど、たった15円の差異だったのでこれまで私が見落としていた。</p><p>法人決算の確定申告をすでに終えているのに15円の受取利息が漏れていることに気付いてしまった。ひとまず税務署に電話してどうしたらいいかを相談した。今日中に訂正するなら上書き更新、明日以降なら修正申告と言われた。所得や税引き前純利益の金額に15円の差異があり、3つか4つぐらいの帳票の項目の値が変わる。法人税の金額計算には影響しない。欠損金の繰り戻し還付の申請でも15円の違いから2円の差額になった。銀行の受け取り利息の消費税は非課税なので消費税の申告には影響しない。</p><p>e-tax で送信したデータをコピーして、元データがある状態で誤り箇所を修正して再送信するのはすぐできて30分ぐらいで訂正送信できた。電子申告の良さを実感した。紙だとこうはいかなかったかもしれない。財務諸表は紙で提出しないといけないので、e-tax の修正送信後に慌てて税務署へ行って再提出してきた。それが16時15分。法人決算締め切りの45分前。オフィスから税務署まで自転車で5分の距離だから間に合った。思いの他、最終日に落とし穴にはまったものの、ちゃちゃっと訂正できたので行政の事務手続きスキルは上がってきたなと自信ももてた。こんな失敗をしておけば今後は登録残高と明細残高のチェックも忘れることはないだろう。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0530/>aws サービスと ipv6</a></h1><div class=post-meta><span class=post-date>2022-05-30 (Mon.)</span></div><span class=post-tags>#<a href=/diary/tags/cdk/>cdk</a>&nbsp;
#<a href=/diary/tags/infrastructure/>infrastructure</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#cloudfront-と-waf-と-s3-と-ipv6-と>cloudfront と waf と s3 と ipv6 と</a></li></ul></nav></div><div class=post-content><p>0時に寝て6時頃に起きて7時半に起きた。</p><h2 id=cloudfront-と-waf-と-s3-と-ipv6-と>cloudfront と waf と s3 と ipv6 と</h2><p>aws サービスについて ipv6 について調べると、少しずつ対応してきた経緯があって、ipv4 と ipv6 の両対応のことを aws は dualstack と読んでいる。エンドポイントのサブドメインに dualstack があれば、ipv6 対応していると考えてよいと思う。リモートワークしている開発者がテスト環境に接続するときに、その開発者の IP アドレスを登録する aws lambda 関数がある。その lambda 関数にリクスとすると、リクエストしたクライアントの IP アドレスを waf の IP sets に登録することで、パケットフィルタリングのルールを更新している。たまたま、そのインフラを cdk 移行したところ、ある開発者は ipv6 で登録しようとしてエラーになるということがわかった。移行のときに api gateway を使わずに直接 lambda の fuction url を使うようにしたところ、lambda は ipv6 対応しているのでそのまま ipv6 の IP アドレスを登録しようとして waf の設定が ipv4 しか対応していなかったためにエラーになっていた。</p><ul><li><a href=https://aws.amazon.com/jp/about-aws/whats-new/2021/12/aws-lambda-ipv6-endpoints-inbound-connections/>AWS Lambda がインバウンド接続用のインターネットプロトコルバージョン 6 (IPv6) エンドポイントのサポートを開始</a></li></ul><p>cloudfront, waf, s3 の ipv6 対応は2016年頃に対応していて、この3つのサービスに対して一緒にブログ記事を書いているのは、これらのサービスを一緒に使うことを想定しているとみなすべきだろう。</p><ul><li><a href=https://aws.amazon.com/jp/blogs/news/ipv6-support-update-cloudfront-waf-and-s3-transfer-acceleration/>IPv6 サポートの更新 – CloudFront、WAF、S3 Transfer Acceleration</a></li></ul><p>cdk のコードで cloudfront, waf は ipv6 対応したのだけど、cloudfront のオリジンに当たる s3 の ipv6 対応を cdk からどうやって設定していいかわからなかった。<a href=https://github.com/aws/aws-cdk/tree/master/packages/%40aws-cdk/aws-cloudfront-origins>aws-cloudfront-origins</a> の <code>S3Origin</code> のコードを読むと、どうも s3 の ipv6 対応のエンドポイント (dualstack) を考慮して制御しているようにはみえない。バグではないけど、設定方法がわからないので feature request として issue 登録してみた。aws-cdk に issue 登録するのは初めて。余談だけど、<a href=https://github.com/aws/aws-cdk/tree/master/.github/ISSUE_TEMPLATE>ISSUE_TEMPLATE</a> もよく出来ていて、これを参考にして自分たちのリポジトリにも取り入れてもよさそう。</p><ul><li><a href=https://github.com/aws/aws-cdk/issues/20550>(aws-cloudfront-origins): Support dualstack domain name (ipv6) for S3 origin #20550</a></li></ul></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0529/>レンタカーで気分転換</a></h1><div class=post-meta><span class=post-date>2022-05-29 (Sun.)</span></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/workcation/>workcation</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#レンタカーで運転の練習>レンタカーで運転の練習</a></li><li><a href=#資料作成の準備>資料作成の準備</a></li></ul></nav></div><div class=post-content><p>0時に寝て7時に起きた。</p><h2 id=レンタカーで運転の練習>レンタカーで運転の練習</h2><p>ふと思い立って8時からレンタカーを借りて運転の練習をしてきた。今週末に <a href=/diary/posts/2022/0515/#ワーケーションの打ち合わせ>ワーケーション</a> を予定しているが、城崎温泉との往復を私が参加者を乗せて車で運転しないといけない。たまに実家に帰ったときに家にある車を運転する程度なので私の運転スキルには不安しかない。言うても田舎の交通量の少ないところを走る分には問題ないはずだけど、それでも準備しておくに越したことはない。レンタカーの慣れない車だと予期しないことで失敗することもあるだろう。そういうリハーサルも兼ねてレンタカーを借りて六甲山、六甲アイランド、灘五郷と50kmぐらい、5時間ほど走って、時間貸駐車場での駐車して料金支払いをやってみた。普段は週末を自社のお仕事で過ごしているし、今月は法人決算に時間をとられていて、その鬱屈した気持ちの気分転換にもなってよかった。</p><h2 id=資料作成の準備>資料作成の準備</h2><p>ワーケーションでは、参加者の親睦も兼ねて内容自由のプレゼン大会を企画している。その準備で資料を作り始めた。なんの話しをしようかなぁと考えて、私は会社紹介をすることに決めた。営業さんと一緒に初めて訪問する会社へ行ったり、ピッチなどに参加すると、発表者が会社紹介をしているのを過去にもよくみかけていた。うちにお仕事を依頼してくれる会社は基本的に知人なので会社に依頼しているというよりも、私個人に仕事を依頼している。だからこれまで会社紹介を必要とされなかった。今後のマーケティングやプロダクト開発をしていくにあたり、いずれ様々な場面で知らない人たちに会社紹介をしなければいけなくなることが想定される。直近で必要はないけど、いまから数ヶ月かけて少しずつ会社紹介を作っていって「ぼくのかんがえたさいきょうのかいしゃしょうかい」ができればいいかなといったところ。その最初の叩き台をつくって、参加者にレビューしてもらおうと考えた。ちょうど <a href=posts/2022/0509.md#%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%89%E3%83%9E%E3%82%B9%E3%82%BF%E3%83%BC%E3%81%AE%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E4%BD%9C%E6%88%90>スライドマスターのデザイン</a> もできたばかりなのでスライドに熟れる必要もあった。3時間ほど資料作りして続きはまた翌日に持ち越し。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0528/>法人決算をほぼ完了</a></h1><div class=post-meta><span class=post-date>2022-05-28 (Sat.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ストレッチ>ストレッチ</a></li><li><a href=#法人決算をほぼ完了>法人決算をほぼ完了</a></li></ul></nav></div><div class=post-content><p>0時に寝て6時に起きた。</p><h2 id=ストレッチ>ストレッチ</h2><p>今日の開脚幅は開始前160cmで、ストレッチ後162cmだった。先週とほぼ変わらないので現状維持といったところ。右腰に張りがあって今週は椅子に座って後ろに寄りかかっていてもやや右腰が張るなぁと自覚症状もあった。ストレッチを受けていても効くなぁって感じだった。新しいトレーナーさんに代わってから1ヶ月のストレッチを受けてだいぶ打ち解けた感はある。</p><h2 id=法人決算をほぼ完了>法人決算をほぼ完了</h2><p><a href=/diary/posts/2022/0524/#消費税と地方消費税の申告>法人決算の e-tax 申請</a> の続き。前に消費税の申告をしたときに別表五以外はすべて作成していた。別表五はどこに何の数字を入力するのかが難しくて、過去の書類と数字を見返しながらやらないと詳細を覚えていなかったりする。その作業をするのが面倒でずっと先送りしていた。本気出してやれば1-2時間もあれば完了した。なんやらかんやらで eltax も e-tax の電子申告も自分でできるようになった。できることが増えていくことそのものが楽しい。</p><p>今回の法人決算で申告・申請したのは次の3つ。</p><figure><img src=/diary/img/2022/0528_e-tax-list1.png></figure><p>e-tax の画面は基本的に帳票そのものなので数値を入力した後で紙に印刷することで帳票を保管することもできる。例えば、法人税・地方法人税の申告に必要な帳票がこれらになる。過去2年は手書きで作成していたけど、ほぼ同じの内容を画面で作成してデータで送付するだけの違いしかない。紙なら2時間で終えられる作業を、(使いにくい) アプリケーションの画面で入力すると余分に数時間かかってしまうものの、システムだと差し引きや合計値の計算は自動でやってくれるので記入ミスは起こりにくい。とはいえ、システムの自動計算が間違っていることもあるので強制入力が必要になるときもある。</p><figure><img src=/diary/img/2022/0528_e-tax-list2.png></figure><p>税務署へ電話で問い合わせたときに財務諸表を pdf 添付でよいと話していたけど、いざやろうとしたら財務諸表は xml または xbrl 形式でないとダメだと説明が出てきた。仕方ないので月曜日に税務署へ行って紙で提出してくる。電子申告と紙を組み合わせて法人決算やることは構わないとのこと。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0527/>スクラムマスターは超人か</a></h1><div class=post-meta><span class=post-date>2022-05-27 (Fri.)</span></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/scrum/>scrum</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#隔週の雑談>隔週の雑談</a></li></ul></nav></div><div class=post-content><p>0時に寝て6時に起きた。調子よくて7時からオフィスで作業してた。なんだかんだで今日は主にお手伝い先のお仕事をしてた。</p><h2 id=隔週の雑談>隔週の雑談</h2><p>顧問のはらさんと隔週の打ち合わせ。今日の話題はたくさんあった。</p><ul><li>スライドマスター作成のふりかえり</li><li>課題管理のためのメンタルモデルづくり</li><li>スクラムの悪いところの共有</li><li>住民税の変遷について</li></ul><p>会社としての発表のスライドを管理するために speakerdeck の会社アカウントを作成した。jjug の主催者のスライドチェックが完了したらアップロードしようと思う。google docs をそのまま公開するのと speakerdeck のどちらがいいかを検討した。google docs だと、スライド資料のノートまで公開されてしまうのでスライドだけなら speakerdeck の方がよさそうかなと判断した。</p><ul><li><a href=https://speakerdeck.com/kazamori>https://speakerdeck.com/kazamori</a></li></ul><p>スクラムの悪いところの1つとして、スクラムマスターが現状認識を誤っているときの是正方法がないという話題をした。スクラムマスターは po や開発者にアドバイスするのだけど、アドバイス自体が誤っているのではなく、アドバイスしている内容がプロジェクトの置かれている状況にあっていないというギャップに対しての、ふりかえりや是正の仕組みがスクラムに包含されていない。ある知人によると、スクラムマスターは超人でなければ務まらないという前提になっているのではないかという意見もあった。現時点でとくに結論はないのだけど、難しい課題だなぁと議論していた。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/0526/>aws-lambda-python-alpha を使っておけばいい</a></h1><div class=post-meta><span class=post-date>2022-05-26 (Thu.)</span></div><span class=post-tags>#<a href=/diary/tags/cdk/>cdk</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#aws-lambda-python-alpha>aws-lambda-python-alpha</a></li><li><a href=#jjug-ccc-2022-spring-のタイムテーブル>JJUG CCC 2022 Spring のタイムテーブル</a></li></ul></nav></div><div class=post-content><p>0時に寝て6時に起きて7時半に起きた。なんかバテバテ。</p><h2 id=aws-lambda-python-alpha>aws-lambda-python-alpha</h2><p>cdk 標準の lambda モジュールで python スクリプトをデプロイすることはもちろんできるが、その python スクリプト内でサードパーティのライブラリを使いたい場合、layer という機能を使って複数の lambda 関数で再利用するというのがもともとのやり方っぽい。とはいえ、サードパーティの依存ライブラリも python スクリプトによって使うものが違ったりするので lambda 関数単位に管理したいという場合もある。その要件を考慮した場合、python のパッケージングを lambda 関数のデプロイ時に再利用できるのが望ましくて、そのためのモジュールが aws-lambda-python-alpha になる。説明が長い。</p><ul><li><a href=https://www.npmjs.com/package/@aws-cdk/aws-lambda-python-alpha>@aws-cdk/aws-lambda-python-alpha</a></li><li><a href=https://docs.aws.amazon.com/cdk/api/v2/docs/aws-lambda-python-alpha-readme.html#packaging>Amazon Lambda Python Library - Packaging</a></li></ul><h2 id=jjug-ccc-2022-spring-のタイムテーブル>JJUG CCC 2022 Spring のタイムテーブル</h2><p>タイムテーブルが公開された。</p><blockquote class=twitter-tweet><p lang=ja dir=ltr>タイムテーブルが公開されたみたい。2022/06/19 10:25〜 Track C <a href="https://twitter.com/hashtag/jjug_ccc_c?src=hash&ref_src=twsrc%5Etfw">#jjug_ccc_c</a> でカスタム github actions の話しをします。よかったらご覧ください。スライド資料も主催のチェック完了後に公開予定です。<a href=https://t.co/AjP1aLt9EM>https://t.co/AjP1aLt9EM</a></p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1529788493895188480?ref_src=twsrc%5Etfw">May 26, 2022</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>私の前の発表が大橋さんという、一緒のチームでお仕事している方で github actions で運用している開発のワークフロー全般を改善したという話しをされる。その大半は私が設計して既存のワークフローを作り直したものなので応援している。改善の前後におけるワークフローの実行時間の比較や資料のレビューなども手伝っていて、私が主導してやったんだから内容についての責任は私にあると考えていろいろサポートしていた。おそらく github actions つながりで連続しているのかなと推測する。当初はお互いに送客すればいいかなと考えていたけど、普通のセッションの規定が厳しくて、スポンサーじゃなければ会社や製品の宣伝はダメという話しなので送客は断念した。</p></div></div><div class=pagination><div class=pagination__buttons><a href=/diary/page/75/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span></a>
<a href=/diary/page/77/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>