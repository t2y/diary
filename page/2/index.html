<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.109.0"><title>forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content="t2y"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="forest nook"><meta property="og:description" content><meta property="og:url" content="/diary/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0129/>だんご転がし</a></h1><div class=post-meta><span class=post-date>2023-01-29 (Sun.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/kobe/>kobe</a>&nbsp;
#<a href=/diary/tags/history/>history</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#35日-だんご転がし>35日 (だんご転がし)</a></li><li><a href=#本髙砂屋の金つば>本髙砂屋の金つば</a></li></ul></nav></div><div class=post-content><p>昨日から実家に帰ってた。23時に寝て5時に起きた。親が3時ぐらいから起きているから4時ぐらいから布団の中で起きてた気がする。親がだんご転がしで登る山の場所を確認しておきたいというから7時から山登りしてきた。</p><h2 id=35日-だんご転がし>35日 (だんご転がし)</h2><p>住職が来る前にだんご転がしを済ませておく。親戚に9時半に近所のお寺に集まってもらってだんご (おにぎり) を持って山登りをする。私は今日2回目。</p><figure><img src=/diary/img/2023/0129_dango.jpg></figure><p>言うても低い山なので往復20分ぐらいの山登り。登ったところから1人3個、崖に向かって後ろ向きにおにぎりを谷へ放り投げる。<a href="http://nihon.syoukoukai.com/modules/stories/index.php?lid=1431">三十五日目の山参り</a> というタイトルで日本昔ばなしでも放送されていたらしい。ググれば youtube でみつかるけど、著作権的によいのかどうかわからなかったのでここでは紹介しない。</p><p>11時から住職に来てもらってお経をあげていただく。お経後の住職の法話でだんご転がしの風習について話しがあった。そこで日本昔ばなしでも取り上げられたというのを教えてもらった。日本では淡路島にしか残っていない風習だという。その理由を聞いてみたら住職は次の3つをあげていた。</p><ul><li>島であること</li><li>島民の大半が <a href=https://ja.wikipedia.org/wiki/%E7%9C%9F%E8%A8%80%E5%AE%97>真言宗</a> であること</li><li>お米が取れる地域であること</li></ul><p>仏教の宗派が異なれば葬式の風習も異なる。たまたま島なので外部の影響を受けなかったのではないかという。昔は兵庫の北部や徳島県でもだんご転がしの風習はあったものの、徐々に廃れていったのは他の宗派の影響があるのではないかと話されていた。だんご転がしと言いながら実際はおにぎりを転がすのもややこしい歴史的経緯になっている。昔はお米は貴重であったため、おにぎりの代わりに団子を放っていた時代があって、その後またおにぎりに戻ってきたのではないかと考えられる。現代ならおにぎり転がしというのが正しい。お餅を祀るという習慣も関西では普通だが、関東では行われないという。それもお米が取れる地域の影響があるのではないかと話されていた。歴史の勉強になっておもしろかった。</p><h2 id=本髙砂屋の金つば>本髙砂屋の金つば</h2><p><a href=https://www.hontaka.jp/>本髙砂屋</a> という老舗の和菓子屋さんがある。洋菓子も売っているようだけど。35日に来てくれた親戚に配るためにお土産に買って帰っていた。これまでもお店があるのは知っていたけど、購入する機会がなくて初めてお店に入って買ってみた。詰め合わせは自由に好きなものを組み合わせてくれるという。</p><blockquote><p>現在の「角きんつば」は、神戸元町の紅花堂（現在の本高砂屋）の創業者である杉田太吉により明治時代に考案されたものである。</p><p><a href=https://ja.wikipedia.org/wiki/%E3%81%8D%E3%82%93%E3%81%A4%E3%81%B0>wikipedia: きんつば</a></p></blockquote><p>wikipedia によると、当初は刀の「つば」のような丸い形状で、その色から銀つばと呼ばれていたという。大阪で発明されたものが江戸に伝わったときに銀よりも金の方が景気がよいという理由で名前が金つばになったらしい。またいまの四角い金つばは本高砂屋さんがオリジナルで始めたことらしい。なるほど。歴史つきの神戸のお土産として素晴らしい。甘さ控え目で上品な風味になっている。あんこの甘いのが好きな人とそうじゃない人で好みは分かれるかも？私は甘さ控え目の方が好みかな。普通においしいと思う。</p><figure><img src=/diary/img/2023/0129_kintsuba.jpg></figure></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0128/>週末はドライブで気分転換</a></h1><div class=post-meta><span class=post-date>2023-01-28 (Sat.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/team-building/>team building</a>&nbsp;
#<a href=/diary/tags/issue-management/>issue management</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ストレッチ>ストレッチ</a></li><li><a href=#2-2-傾聴可視化リフレーミング>2-2. 傾聴・可視化・リフレーミング</a></li><li><a href=#車を運転して実家へ>車を運転して実家へ</a></li></ul></nav></div><div class=post-content><p>22時に寝て2時前に吐き気で起きて少しだらだらして寝て7時に起きた。</p><h2 id=ストレッチ>ストレッチ</h2><p>今日の開脚幅は開始前154cmで、ストレッチ後158cmだった。あまり数値は振るわなかったものの、この1ヶ月ぐらいではもっとも復調しつつある。まだ腰の張りがやや残っていて全快とまではいかないものの先週よりはよくなりつつある気はする。先週から左右への開脚以外に前後の開脚のときの股関節のストレッチを重視するよう、トレーナーさんからも指示はあったものの、今週は全然そんな余裕がなくてあまり取り組めなかった。それを余暇でうまくできなかった分の、数値の悪化かなとも受け取れた。</p><h2 id=2-2-傾聴可視化リフレーミング>2-2. 傾聴・可視化・リフレーミング</h2><p><a href=https://gihyo.jp/book/2018/978-4-7741-9605-3>エンジニアリング組織論への招待</a> のメンタリングの技術の章を読み直し。<a href=/diary/posts/2022/1106/#2-1-メンタリングで相手の思考をリファクタリング>前回</a> からだいぶ間があいた。</p><blockquote><p>メンターはメンティに対して「問題を解決してあげよう」ではなく「モヤモヤしていない問題に変換してあげよう」と考えることが重要。問題を次のように考え、</p><ul><li>感情的に固執していて解けないので「傾聴」をする</li><li>客観視できずに解けないので「可視化」をする</li><li>そもそも解けない問題なので前提を変える「リフレーミング」をする</li></ul><p>というのが、メンタリングで意識すべき流れになる。</p><p>共感と同感の違い</p><ul><li>共感という言葉の意味は「相手がそのような気持ちになった理由を理解する」こと</li><li>同感は「自分が相手と同じ気持ちになる」こと</li></ul><p>傾聴において示すべきことは、「共感」であって、「同感」ではありません。</p><p>認知フレームとリフレーミング</p><ul><li>人はありのままに物事を見られない<ul><li>人は認知する枠組みの範囲でしか処理できない</li><li>この枠組みのことを「認知のフレーム」と呼ぶ<ul><li>この外側にあることは「心理的な盲点」と呼ばれる</li></ul></li></ul></li><li>対話によって認知フレームを変えることを「リフレーミング」と呼ぶ<ul><li>「解けない問題」を「解ける問題」へと変えていく</li></ul></li></ul><p>確認された前提を「一旦、この前提がなかったらどうなりますか？」というように外して考えるようにすることで、リフレーミングを促すことができます。 また、この中で「一番重要だと思うものは何ですか？」というように前提の優先順位を問うこともリフレーミングを促します。気になって仕方なかったことが、実はあまり重要ではないかもしれないと気がつく契機になります。</p><p>「情報の非対称性」を解消するには、</p><ul><li>自分の情報を相手に伝える</li><li>相手の情報を自分が聞く</li></ul><p>という行動をとればよいのですが、この当たり前のことができなくなってしまうケースがある</p><p>これは、メンター役になる人に対しても重要な警句です。メンターは、メンティの問題を「自分の課題」として捉えてはいけません。メンターにとっての課題は「メンティを自立的な問題解決」に導くことであって、「メンティの課題を解決すること」ではないのです。</p></blockquote><p>この節を読み終えて、課題管理とは、メンターを必要とせず、自分で自分をメンタリングするツールとも言い換えられるかもしれないと思えた。課題管理を習熟すると自分で自分の間違いに気付けるというメリットを周りに伝えたりしていたことがメンタリングで大事なことのいくつかの共通することが書いてあった。</p><h2 id=車を運転して実家へ>車を運転して実家へ</h2><p>明日は父の35日なので夕方から購入した車で初めて実家に帰った。神戸の高速道路の路面が少し濡れていたり北淡で小雪が降ってきたりして、さっそくタイヤ周りを汚れてしまった。まぁ仕方ないか。door-to-door で1時間15分ぐらいで実家に帰れる。高速バスで帰るとこんな段取りになる。</p><ul><li>マンションからバス停へ移動する (10分)</li><li>バス停でバスが到着するのを待つ (待ち時間10分)</li><li>高速バスで移動する (1時間20分)</li><li>バス停まで親に車で迎えに来てもらって実家へ移動する (15分)</li></ul><p>待ち時間の調整が入ると2時間ほどはかかっていた。これが自分の都合で移動できるので調整時間がない分のストレスが溜まらない。帰ろうと思って1時間強で移動できる気楽さがある。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0127/>コードリーディングの成果</a></h1><div class=post-meta><span class=post-date>2023-01-27 (Fri.)</span></div><span class=post-tags>#<a href=/diary/tags/code-reading/>code reading</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#最後のコードリーディング>最後のコードリーディング</a></li></ul></nav></div><div class=post-content><p>22時に寝て4時に起きて1時間ほどだらだらしていて8時に起きた。生活のリズムが少しズレてきてしまっている。</p><h2 id=最後のコードリーディング>最後のコードリーディング</h2><p>先週からコードリーディングの勉強会をやっていて今日が最後。今日の対象のプログラムは windows サーバーで動く c++ のコードなので私はどちらも素人であまりよく分からない。上長の判断で別チームのベテランの開発者に来てもらうとよいとアドバイスを受けてお願いして来てもらった。これは本当によかった。実装されたコードだけではなく、設計を見直した方がよい視点なども指摘してもらって、もう少し時間をかけてこの windows プログラムを改修した方がよいと私は判断した。windows サーバーをクラッシュさせてしまうリスクのあるサービスにフックして実行されるコードを書いているので、windows サーバーの振る舞いや異常系処理の経験がないと潜在的にリスクのあるコードを動かしてしまう。web のアプリケーションなら多少のバグは後で直せばよいけど、os をクラッシュさせてしまうものは慎重にレビューした方がよいように思えた。次回の定例で話題にあげて課題を掘り下げようと思う。結論としてはコードリーディングしてよかったという話し。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0126/>pure go の javascript 処理系を使ってみた</a></h1><div class=post-meta><span class=post-date>2023-01-26 (Thu.)</span></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/javascript/>javascript</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#pure-go-の-javascript-処理系>pure go の javascript 処理系</a></li></ul></nav></div><div class=post-content><p>23時に寝て2時に起きてだらだらして寝て7時に起きた。<a href=https://yanmaga.jp/comics/%E3%83%86%E3%83%B3%E3%82%AB%E3%82%A4%E3%83%81_%E6%97%A5%E6%9C%AC%E6%9C%80%E5%BC%B7%E6%AD%A6%E8%8A%B8%E8%80%85%E6%B1%BA%E5%AE%9A%E6%88%A6>テンカイチ 日本最強武芸者決定戦</a> という漫画を読んでた。</p><h2 id=pure-go-の-javascript-処理系>pure go の javascript 処理系</h2><p>ユーザー定義スクリプトを実行する要件がある。システム管理者がスクリプトを書くなら javascript がいいかなと次のリファレンスを調べたりしていた。</p><ul><li><a href=https://prasanthmj.github.io/go/javascript-parser-in-go/>How to support custom Javascript scripting in Go Applications</a></li><li><a href=https://go.libhunt.com/goja-alternatives>goja alternatives</a></li><li><a href=https://www.reddit.com/r/golang/comments/u8gyii/choosing_scripting_extension_need_advice/>Choosing scripting extension - need advice</a></li></ul><p>これらを読んだ結果として <a href=https://github.com/dop251/goja>dop251/goja</a> がよいだろうと判断した。README だけ読めばすぐに実装できてめっちゃ簡単で感心した。こういうライブラリを私も会社のプロダクトとして作ってみたい。万人が使うものではなくても、必要なときがたまにあって、すごく使いやすいみたいな。こんな感じで goja の機能を使ってライブラリ実装してみた。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FunctionCaller</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>funcName</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>args</span> <span style=color:#f92672>...</span><span style=color:#66d9ef>interface</span>{}) (<span style=color:#66d9ef>interface</span>{}, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewFunctionCaller</span>(<span style=color:#a6e22e>script</span> <span style=color:#66d9ef>string</span>) (<span style=color:#a6e22e>FunctionCaller</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>vm</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>goja</span>.<span style=color:#a6e22e>New</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>vm</span>.<span style=color:#a6e22e>RunString</span>(<span style=color:#a6e22e>script</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>funcName</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>args</span> <span style=color:#f92672>...</span><span style=color:#66d9ef>interface</span>{}) (<span style=color:#66d9ef>interface</span>{}, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>goja</span>.<span style=color:#a6e22e>AssertFunction</span>(<span style=color:#a6e22e>vm</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>funcName</span>))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to get function: %s&#34;</span>, <span style=color:#a6e22e>funcName</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>funcArgs</span> <span style=color:#f92672>:=</span> make([]<span style=color:#a6e22e>goja</span>.<span style=color:#a6e22e>Value</span>, <span style=color:#ae81ff>0</span>, len(<span style=color:#a6e22e>args</span>))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>arg</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>args</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>funcArgs</span> = append(<span style=color:#a6e22e>funcArgs</span>, <span style=color:#a6e22e>vm</span>.<span style=color:#a6e22e>ToValue</span>(<span style=color:#a6e22e>arg</span>))
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>value</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>f</span>(<span style=color:#a6e22e>goja</span>.<span style=color:#a6e22e>Undefined</span>(), <span style=color:#a6e22e>funcArgs</span><span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to call javascript function: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>Export</span>(), <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	}, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><a href=https://github.com/dop251/goja#is-it-goroutine-safe>Is it goroutine-safe?</a> によると、goroutine-safe ではないので毎回 js の runtime を生成する必要がある。用途によっては、実行したいスクリプトが大きくなるとオーバーヘッドを無視できない状況もあるかもしれない。うちの要件は小さいユーザー定義スクリプトを実行するだけなのでおそらくそれほど問題にはならないだろうという想定。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0125/>テックブログ草稿</a></h1><div class=post-meta><span class=post-date>2023-01-25 (Wed.)</span></div><span class=post-tags>#<a href=/diary/tags/frontend/>frontend</a>&nbsp;
#<a href=/diary/tags/tech-selection/>tech selection</a>&nbsp;
#<a href=/diary/tags/writing/>writing</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#フロントエンドの技術選定のテックブログ>フロントエンドの技術選定のテックブログ</a></li></ul></nav></div><div class=post-content><p>2時に寝て7時に起きた。生活リズムがやや乱れ気味。メンバーの1on1以外はスポット的に時間が空いていてテックブログを書いてた。</p><h2 id=フロントエンドの技術選定のテックブログ>フロントエンドの技術選定のテックブログ</h2><p>顧問のはらさんに勉強会をお願いして、技術選定の観点を教えてもらい、その後 next.js と sveltekit でチュートリアルやって感触を確かめ、最終的には CTO 判断でエイヤで決めた。その過程や調査結果などをそのままテックブログに書いた。お手伝い先のテックブログも hugo で動いている。私にとっては慣れた環境なので環境構築やプレビュー確認などはすぐにできた。テーマの違いによるテーブルやスタイルの定義などを他の記事を参考にしながら調整するのに手間取ったぐらい。半日ぐらいがっつり時間をとって草稿を書き上げた。これからレビューしてもらって問題なければ公開することになる。私の名前で普通に書いたけど、それが OK なら事例紹介に近いものにもなる。いつも半年働いてから、私が自分で納得できる品質を提供できていれば事例紹介をお願いしている。いまじゃなくてももう3ヶ月経ってからでもいいかもしれない。</p><p>私は会社のテックブログを書くのが嫌じゃない。私ぐらいになると、あちこちの会社でテックブログを書いてきたからお手伝いした会社は記事を1つぐらい書いて記念を残したいとまで考えるようになってきた。昔、ある会社でお手伝いしたときに調査した技術情報を社内 wiki にまとめただけで、長文をちゃんと書ける人は少ないと高い評価を得たことがあった。テックブログを書く開発者が少ないことを考慮するとさもありなんと言えるかもしれない。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0124/>起業相談が再び</a></h1><div class=post-meta><span class=post-date>2023-01-24 (Tue.)</span></div><span class=post-tags>#<a href=/diary/tags/svelte/>svelte</a>&nbsp;
#<a href=/diary/tags/founding/>founding</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#sveltekit-の-ui-からのリクエスト>sveltekit の ui からのリクエスト</a></li><li><a href=#起業相談>起業相談</a></li></ul></nav></div><div class=post-content><p>1時に寝て8時に起きた。寝坊して朝起きれないものの、わりかしよく眠れるようになってきた。</p><h2 id=sveltekit-の-ui-からのリクエスト>sveltekit の ui からのリクエスト</h2><p><a href=https://kit.svelte.dev/docs/routing#page-page-svelte>+page.svelte</a> のスクリプトで <code>onMount()</code> を定義すると bff へ http リクエストを fetch できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>lang</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ts&#34;</span>&gt;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>import</span> <span style=color:#66d9ef>type</span> { <span style=color:#a6e22e>User</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;$lib/types/users&#39;</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>onMount</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;svelte&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>data</span>: <span style=color:#66d9ef>User</span>[] <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>onMount</span>(<span style=color:#66d9ef>async</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;/api/users&#39;</span>);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>ok</span>) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>json</span>();
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	});
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><p>bff 側では web api を提供する必要がある。それは <a href=https://kit.svelte.dev/docs/routing#server>+server.ts</a> を定義することで実装できる。内部的にはバックエンドの web api を呼び出して、それを返すだけの実装になる。こういった連携も sveltekit だと簡単に実装できる。前のお仕事は bff も java で作っていたけど、bff なら node.js でいいんじゃないかと思うぐらいにはフロントエンドの技術に慣れてきた自分がいる。</p><h2 id=起業相談>起業相談</h2><p><a href=/diary/posts/2023/0120/#起業相談>少し前にも起業相談</a> に乗ったが、まったく別の人で12月に起業された方が三ノ宮.dev のコミュニティに入られて起業相談にのってほしいというので行ってきた。個人でもわりと有名な方らしく、ある2つのキーワードでググるとトップに出てくる。スタートアップを目指している方で、できるだけ多くのお金を資金調達して作りたいものを開発したいという話し。いまは金融緩和から緊縮に向かう状況なのでベンチャー資金も渋い状況ではないかと推測する。そんな中で cto をどうやって探せばよいかという質問が大きな話題だった。資金調達する上でもちゃんとした cto がいる方が融資する側からみても印象が違うという。それはそうかなとも思う。</p><p>一方で cto を探すのは相当に難しいという話しを私からした。基本的には過去に一緒に働いた人でスキルのある人や同じ意思をもっている知人や友だちに依頼するのがよいだろうと。それも難しい話しだけど、cto 募集なんかでよい人がみつかる確率は低いし、ましては ceo が技術に明るくないのであれば応募してくる求職者のスキルや知識を評価するのも難しい。他のコミュニティメンバーも同意見で、最初は cto を雇わず、普通にテックリードになれる開発者を雇って、プロダクトを開発して実績を作って資金調達した後に再度 cto を探してはどうか？と提案した。</p><p>あと資金調達は実績がないと難しいから、最初はすぐにお金を稼げるプロダクト開発をして、それで十分な収益をあげ、その実績から資金調達するのはどうかといった計画の話しをしていて、それはもっと難しそうだと私からは感じた。お金のためだけにやりたくもないプロダクト開発を1-2年やって、その後に本当にやりたいプロダクト開発を資金調達してからやる。それぞれのプロダクトはまったく関係がなく、組織も2つになるという。そんなやり方で成功したスタートアップを私は聞いたことがない。組織の難しさをあまりにも軽視していて無謀だとアドバイスした。</p><p>私も起業して早3年が経った。マイクロ法人だから簡単でしょと言われたらそれまでなんだけど、起業相談を依頼されるケースも増えてきた。これはこれで顧問やコンサル業ができるのではないかと少し皮算用していたりする。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0123/>人間の体調もマシンの調子も悪い</a></h1><div class=post-meta><span class=post-date>2023-01-23 (Mon.)</span></div><span class=post-tags>#<a href=/diary/tags/nginx/>nginx</a>&nbsp;
#<a href=/diary/tags/tls/>tls</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#デスクトップマシンの調子が悪い>デスクトップマシンの調子が悪い</a></li><li><a href=#nginx-の-multi-upstream-対応>nginx の multi upstream 対応</a></li></ul></nav></div><div class=post-content><p>1時に寝て7時に起きた。冬のせいか、朝起きるのが辛くなってきた。自身の体調がパッとしないと思っていたらマシンにも移ってしまった。</p><h2 id=デスクトップマシンの調子が悪い>デスクトップマシンの調子が悪い</h2><p>何の前触れもなく os がいきなりストールする。これまでも稀にあったり、サスペンドから復帰しないとかも1ヶ月に1回ぐらいはあったりしていたけど、今日は2時間以内に3回発生した。使い始めてちょうど3年を超えたところなのでそろそろ故障が出てきてもおかしくはない。もっとも疑わしいディスクの S.M.A.R.T チェックをやってみた。<a href=https://qiita.com/ken-yossy/items/ffecfd31d41d71f27dca#smart--health-information%E3%81%AE%E5%86%85%E5%AE%B9>SMART / Health Informationの内容</a> をみると、<em>Percentage Used</em> という値がメーカーが独自計算した耐久値を表しているとのころ。しかし、値は13%なのでまだまだ大丈夫そう。その他のエラーチェックなどでもまったく問題は検出されなかった。どうやらディスクではないみたい。</p><pre tabindex=0><code>=== START OF SMART DATA SECTION ===
SMART overall-health self-assessment test result: PASSED

SMART/Health Information (NVMe Log 0x02)
Critical Warning:                   0x00
Temperature:                        28 Celsius
Available Spare:                    100%
Available Spare Threshold:          50%
Percentage Used:                    13%
Data Units Read:                    48,536,210 [24.8 TB]
Data Units Written:                 57,978,947 [29.6 TB]
Host Read Commands:                 1,818,481,150
Host Write Commands:                1,973,810,058
Controller Busy Time:               9,182
Power Cycles:                       1,863
Power On Hours:                     4,576
Unsafe Shutdowns:                   80
Media and Data Integrity Errors:    0
Error Information Log Entries:      0
Warning  Comp. Temperature Time:    0
Critical Comp. Temperature Time:    0
Temperature Sensor 1:               28 Celsius
Thermal Temp. 1 Transition Count:   90
Thermal Temp. 2 Transition Count:   50
Thermal Temp. 1 Total Time:         2246
Thermal Temp. 2 Total Time:         50
</code></pre><h2 id=nginx-の-multi-upstream-対応>nginx の multi upstream 対応</h2><p><a href=/diary/posts/2023/0120/#sveltekit-アプリのデプロイ>先週末の続き</a> 。docker compose でデプロイして node.js 上のポートに http 接続できるところまでやっていた。nginx のリバースプロキシ経由でアクセスできるようにする。web api も外部から https 接続できるようにすると2つの upstream が必要になる。ホスト名を dns 登録していないから同じ ip アドレスでアクセスしているため、ポート番号を変えないといけない。そのまま server 設定を行うと location 設定が dry の原則に反してしまう。どうやったら再利用できるかを調べたら conf として外部に出してしまって include すればいいとあったので次のようにして再利用できた。これで node.js アプリは 443 を、web api は 8443 で https 接続できた。</p><pre tabindex=0><code>http {

    upstream my-app {
        server app:3000;
    }

    upstream web-api {
        server api:18080;
    }

    server {
        listen 443 ssl;
        server_name server-app;
        location / {
            include     /etc/nginx/common_proxy.conf;
            proxy_pass  http://my-app;
        }
    }

    server {
        listen 8443 ssl;
        server_name server-api;
        location / {
            include     /etc/nginx/common_proxy.conf;
            proxy_pass  http://web-api;
        }
    }
}
</code></pre></div></div><div class=pagination><div class=pagination__buttons><a href=/diary/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span></a>
<a href=/diary/page/3/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>