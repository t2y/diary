<!doctype html><html lang=en>
<head>
<meta name=generator content="Hugo 0.88.1">
<title>forest nook</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=keywords content>
<meta name=robots content="noodp">
<link rel=canonical href=/diary/>
<link rel=stylesheet href=/diary/assets/style.css>
<link rel=stylesheet href=/diary/assets/green.css>
<link rel=stylesheet href=/diary/style.css>
<link rel=apple-touch-icon href=/diary/img/apple-touch-icon-192x192.png>
<link rel="shortcut icon" href=/diary/favicon.ico>
<meta name=twitter:card content="summary">
<meta name=twitter:site content="t2y">
<meta name=twitter:creator content="t2y">
<meta property="og:locale" content="en">
<meta property="og:type" content="website">
<meta property="og:title" content="forest nook">
<meta property="og:description" content>
<meta property="og:url" content="/diary/">
<meta property="og:site_name" content="forest nook">
<meta property="og:image" content="/diary/favicon.ico">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<link href=/diary/index.xml rel=alternate type=application/rss+xml title="forest nook">
</head>
<body class=green>
<div class="container full headings--one-size">
<header class=header>
<div class=header__inner>
<div class=header__logo>
<a href=/diary>
<div class=logo>
forest nook
</div>
</a>
</div>
<div class=menu-trigger>menu</div>
</div>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/diary/about>自己紹介</a></li>
<li><a href=/diary/dates>月別一覧</a></li>
<li><a href=/diary/tags>タグ一覧</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/diary/about>自己紹介</a></li>
<li><a href=/diary/dates>月別一覧</a></li>
<li><a href=/diary/tags>タグ一覧</a></li>
</ul>
</nav>
</header>
<div class=content>
<div class=posts>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1025/>新しい生活リズムへの移行</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-25
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/slack/>slack</a>&nbsp;
</span>
<img src=/diary/img/2021/1025_pumpkin.jpg class=post-cover alt=新しい生活リズムへの移行>
<div class=table-of-contents>
<h2>
目次
</h2>
<nav id=TableOfContents>
<ul>
<li><a href=#ミクロ経済学入門の入門>ミクロ経済学入門の入門</a></li>
<li><a href=#設計ドキュメントレビュー>設計ドキュメントレビュー</a></li>
<li><a href=#slack-apps-の調査>Slack apps の調査</a></li>
<li><a href=#お昼寝>お昼寝</a></li>
</ul>
</nav>
</div>
<div class=post-content>
<p>3時に寝て6時に起きた。今日はちゃんと起き上がって朝からお茶を煮出して粗熱とって冷やしたりしてた。その後、準備してオフィスに着いたのが7時20分。いつもより1時間早く起きているのでオフィスに着くのも1時間早くなる。<a href=/diary/posts/2021/1022/>先週</a> の水曜日と金曜日だけ朝活やってみて逆に生活のリズムが乱れてよくない感じがした。今週は毎日6時に起きて朝活に参加してみるのを試す。</p>
<h2 id=ミクロ経済学入門の入門>ミクロ経済学入門の入門</h2>
<p>早起きしたので打ち合わせ前の隙間時間に第3章の需要曲線を読んだ。まずは用語の整理から。</p>
<ul>
<li>上級財: 所得が増えたときに消費が増える財</li>
<li>下級財: 所得が増えたときに消費が減る財</li>
</ul>
<blockquote>
<p>一般的な傾向として、ものは消費するほど有り難みが減る。たとえば僕はコーヒー1杯目に最大4ドルまでなら払ってよいけれど、2杯目には最大2ドルまでしか払いたくない、そして3杯目には最大1ドルまでしか払いたくない、というように。</p>
</blockquote>
<p>食べものとか実際にボリュームディスカウントされることが多いので食べものだとイメージしやすい。スーパーで半額になった豚カツを2枚買うときの私の気持ちはこんな感じ。定価なら1枚しか買わないのに半額なら2枚買ってもいいかと思ったりする。たまに2枚を一度に食べて気分悪くなって後悔する。たいていは晩ご飯に1枚、翌日のお昼ゴハンに1枚を分けて食べる。</p>
<ul>
<li>余剰: 価格と消費者がお金を払ってもよい金額との差額
<ul>
<li>コーヒー1杯に400円払ってよいと考えていて、100円のコーヒーを買うなら300円が余剰といえる
<ul>
<li>さらにコーヒー2杯目を50円で買ってよいと考えるなら350円が余剰と言える</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>すべての消費者の余剰を計算したものを消費者余剰という。需要曲線からある価格 p を取るときの次のグラフにおける面積を消費者余剰と呼ぶ。グラフにすると直観的にわかりやすい。</p>
<figure><img src=/diary/img/2021/1025_consumer-surplus.png>
</figure>
<p>消費者余剰に対して、売る側の利潤の合計を生産者余剰と呼ぶ。消費者余剰と生産者余剰との和を社会的余剰と呼ぶ。社会的余剰を「市場のよさ」のモノサシとして使うと談合は禁止すべしということになる。</p>
<ul>
<li>ベルトラン価格競争
<ul>
<li>同品質で同費用の業者が価格競争をした場合、顧客は価格が安い方から商品を購入する。こうした市場をベルトラン寡占市場と呼ぶ</li>
<li>このとき業者間の価格競争は最終的に「底辺への競争」が起こり、経費と同じ価格に近づく
<ul>
<li>この状態をベルトラン均衡と呼ぶ</li>
</ul>
</li>
<li>業者間で談合して価格を据え置けばよいが、業者の数が多くなるとこれは難しい
<ul>
<li>裏切りが発生したり、信頼関係を維持するのが難しかったりして、長期的な利益や全体の利益を追求するのが難しい
<ul>
<li>ゲーム理論の話しのように読めた</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>価格弾力性
<ul>
<li>価格の変化によって需要がどのぐらい弾んで動くかをあらわす</li>
<li>弾力性が低いというと、価格が動いても需要はあまり変わらない状態をいう</li>
<li>弾力性が高い財は値上げすると需要が大幅に下がる
<ul>
<li>必需品は値上げしても需要が下がりにくい
<ul>
<li>課税で考えると、必需品への課税は貧しい人の生活に与えるダメージが大きい</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>ギッフェン財
<ul>
<li>需要曲線は右下がりのカーブになるのが通常だが、経験的事実に即している
<ul>
<li>そうした財を正常財と呼ぶ</li>
</ul>
</li>
<li>ごく稀に価格が上がるにつれ売れ行きが増すものがある、それをギッフェン財と呼ぶ</li>
</ul>
</li>
<li>代替効果: ある商品が値上げしたときに別の商品に置き換えたくなる</li>
<li>所得効果: 生活にゆとりがなくなると、高いものは買えなくなり、安いものを買おうとする</li>
</ul>
<p>内容はそう難しくないが、急にたくさんの用語が出てきて読み解くのに時間がかかった。</p>
<h2 id=設計ドキュメントレビュー>設計ドキュメントレビュー</h2>
<p>先週から作っていた設計ドキュメントを顧問さんと一緒にレビューした。スライド40枚を2時間がっつり話してめっちゃ疲れた。話し終えて20-30分抜け殻になって軽く散歩してきた。ここ3ヶ月、調べものをしてきた内容の集大成でもあり、頭の中にしかなかった課題管理の実践知を明文化するといった取り組みの (途中) 結果でもある。品質の良し悪しで言えば、たった3ヶ月で出来たものなので大したことはない。あくまで途上における段階でしかないのだけど、私の中でも納得感は出てきたし、レビューしてもらって厳しい指摘もなかったので方向性は出てきた感じがある。このまま時間のあるときに進めていく。</p>
<h2 id=slack-apps-の調査>Slack apps の調査</h2>
<p>この水曜日にある勉強会の <a href=https://github.com/t2y/python-study/tree/master/BizPy/slack/20211027>資料作成</a> が完了した。Slack apps の調査を勢いよくやりたいので2週間ごとに開催することにする。ドキュメントを眺めていて次回は <a href=https://api.slack.com/lang/ja-jp/app-home-with-modal>新機能、アプリのホーム・ヴューを活用しよう:house_with_garden:</a> のチュートリアルをやってみることに決めた。</p>
<h2 id=お昼寝>お昼寝</h2>
<p>睡眠時間が短かったせいか、朝早かったせいか、夕方に集中力がなくなったので17時に切り上げて帰って寝てた。今日は雨だったので徒歩通勤だったのもありウォーキングにもなった。途中でスーパーに寄って買いものして帰った。運動目的だと1時間ぐらい歩いても平気なのに通勤だと15分歩くだけで疲れる。同じ行動をしていても目的意識で変わってくる。18時ぐらいには家に着いてそのまま4時間ほど寝てた。その後、また起きて夜の作業に入った。起きてからお腹すいて即席でめんつゆと醤油とかぼちゃとささみと卵で煮物を作ってみたら意外とおいしかった。お腹すいているとちょっとしたものでもおいしい。気に入ったのでカバー画像にしてみた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1024/>bolt アプリ開発</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-24
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/slack/>slack</a>&nbsp;
</span>
<img src=/diary/img/2021/1024_bolt-app.png class=post-cover alt="bolt アプリ開発">
<div class=table-of-contents>
<h2>
目次
</h2>
<nav id=TableOfContents>
<ul>
<li><a href=#slack-apps-の調査>Slack apps の調査</a></li>
</ul>
</nav>
</div>
<div class=post-content>
<p>2時に寝て9時に起きた。寝る前に1時間ほどウォーキングしてきたせいか、よく眠れた。田んぼをしたり運動をしたり体を動かして疲れた方がよく眠れるような気がしてきた。しばらく続けてみようと思う。お昼は調べものをしていて夕方に眠くなって2時間ほど寝てまた夜も調べものをしていた。</p>
<h2 id=slack-apps-の調査>Slack apps の調査</h2>
<p>この水曜日に勉強会があるので調査と <a href=https://github.com/t2y/python-study/blob/master/BizPy/slack/20211027/README.md#slack-apps>資料作成</a> をしていた。いつの間にか slack app 作成のためのドキュメントもいくつか <a href=https://api.slack.com/lang/ja-jp>日本語化</a> されていることに気付いた。<a href=https://api.slack.com/lang/ja-jp/hello-world-bolt>Bolt フレームワークを使って Slack Bot を作ろう</a> のドキュメントをみながら <a href=https://github.com/slackapi/bolt-python>bolt-python</a> を使って簡単な bot アプリを作成した。アプリの設定・開発の流れはだいたいこんな感じ。</p>
<ol>
<li>slack app 作成</li>
<li>bot ユーザー作成</li>
<li>oauth スコープの設定</li>
<li>bolt アプリケーションの実装</li>
<li>イベントサブスクリプションの設定</li>
</ol>
<p>bolt とは別に <a href=https://github.com/slackapi/python-slack-sdk>python-slack-sdk</a> というライブラリが提供されていて、このライブラリを使って bolt というフレームワークが実装されている。bolt でやりにくいことがあったら直接 sdk を触ることもあるのかもしれない。</p>
<p>現時点で勉強会の参加者は17人もいる。半年以上さぼっていたけど、けっこうな人数が参加してくれている。slack app の調査も兼ねて3-4回ぐらいは勉強会を開く予定。初回はアプリを作成するときの雰囲気を学んでもらえればと思う。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1023/>普通の休日</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-23
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/life/>life</a>&nbsp;
</span>
<img src=/diary/img/2021/1023_issue-tracking.png class=post-cover alt=普通の休日>
<div class=table-of-contents>
<h2>
目次
</h2>
<nav id=TableOfContents>
<ul>
<li><a href=#ストレッチ>ストレッチ</a></li>
<li><a href=#設計ドキュメント修正>設計ドキュメント修正</a></li>
<li><a href=#ウォーキング>ウォーキング</a></li>
</ul>
</nav>
</div>
<div class=post-content>
<p>3時に寝て9時に起きた。前日の夕方お昼寝して21時から2時ぐらいまで作業してから寝たので生活のリズムが狂ってしまったかもしれない。それでもよく眠れたので体調は良いように感じた。</p>
<h2 id=ストレッチ>ストレッチ</h2>
<p><a href=/diary/posts/2021/1016/#ストレッチ>先週は木・金と連日にジョギングして筋肉痛になってた</a> ので、今週は木曜日だけジョギングして金曜日はお休みしてストレッチを受けた。それでもまだ右股関節の違和感と若干の筋肉の張りは残っている。終わってから少し体が楽になったので疲れが溜まっていたのかもしれない。今日の開脚幅は開始前168cmで、ストレッチ後170cmだった。先週とほぼ変わらないので股関節の可動域は現状維持。トレーナーさんに自分でストレッチしていて感じた左右の違いや右股関節の違和感を相談してみてもらったりした。物理的な身体の変化や状態を相談できるというのもこのサービスの価値の1つでもあると思う。相談してこういうストレッチするとよいですよというアドバイスをもらうだけでも安心した気持ちになるように感じた。</p>
<h2 id=設計ドキュメント修正>設計ドキュメント修正</h2>
<p><a href=/diary/posts/2021/1021/#設計ドキュメント作成>先日たたき台として作成したもの</a> を見直しながら手直したしたりしてた。資料を作ってから2-3日寝かせてから見返すと粗がみえたり不足している内容を思いついたりする。事前に資料を作って余裕があるときはよくそうやって洗練させている。リファクタリングをやるような感覚。カバー画像にあるスライドを追加した。自分の頭の中にあるイメージを図として具現化できると、それ自体を楽しい・嬉しいといったポジティブな感情に捉えられる。資料を作成していて頭の中にある情報をうまく整理できないときに苦痛やしんどさを感じる。言いたいことがあり過ぎたり曖昧だったりしてまとめられないことがある。その反対だから快ちよく感じるのかもしれない。</p>
<h2 id=ウォーキング>ウォーキング</h2>
<p>ジョギングしない日でもなるべく運動した方がいいかと思い始め、23時をまわってから歩くために出かけた。いまオフィスに着いてこれを書いている。19時頃に家に帰れば近所の公園へ行ってジョギングをする。21時をまわると晩ご飯を食べるのが遅くなってしまうから先に食べてしまって、くつろぐと面倒くさくなって外に出なくなる。あと夜遅くに公園で一人走るのも周りに人がいたらこわがられるんじゃないかと思ったりする。前に深夜2時に走りに行ったことがあるんだけど、最初は私1人しか走ってなかったのに途中でもう1人いるようになった。誰もいないと思って走ってて人がいるとなんかこわくなったので夜遅くに走るのはやめようと思った。ジョギングしなくても1時間ほど歩くだけでも健康にはよさそうだし、なるべく続けられるよう努めてみよう。</p>
<p>たまたま繁華街の付近を歩いてみたら、飲食店の営業時間制限が解除されていて、昔のように飲み歩くお客さんで賑わっていた。お店の中を覗くと繁盛しているお店もあれば、全然お客さんが入っていないお店もあった。完全にお客さんが戻ってくるのはちょっと時間がかかるのかな。いまは一時の休息のようなものなんだろうけど、コロナ禍で寂しかった街並みに活気が戻ったようでなんか気分がよかった。でも、狭い店舗でマスクせずに飲食しててまた感染者増えるんじゃないかと不安に思ったりもする。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1022/>睡眠不良</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-22
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/morning-activity/>morning activity</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
#<a href=/diary/tags/jira/>jira</a>&nbsp;
</span>
<div class=table-of-contents>
<h2>
目次
</h2>
<nav id=TableOfContents>
<ul>
<li><a href=#朝活>朝活</a></li>
<li><a href=#法人県民税と法人市民税の中間申告と納付>法人県民税と法人市民税の中間申告と納付</a></li>
<li><a href=#jira-のフィルターとリマインダー>Jira のフィルターとリマインダー</a></li>
</ul>
</nav>
</div>
<div class=post-content>
<p>4時に寝て6時に起きた。朝活があると何時に寝ても6時に起きれる。終わってからやっぱり眠くなって1時間ほど寝てた。お昼の外出から戻ってきて雑務やってから、なんか集中できなくて15時から帰ってお昼ご飯食べて2-3時間寝てた。寝る時間帯がずれると生活のリズムが狂ってしまい、全体でみると生産性が落ちるように思えてきた。水と金だけ6時に起きるのをやめて毎日6時に起きるべきだと強く思うようになった。</p>
<h2 id=朝活>朝活</h2>
<p><a href=https://www.youtube.com/channel/UC1rVx0vAg66su1WvH3X-RJg>Webデザイントレンドのよりみち</a> の金朝ツメトギに参加した。今回から「つめとぎ」から「ツメトギ」のカタカナに名前変更してパワーアップ？したみたい。本を読んでもよかったんだけど、チャット欄でコメントしながら live をみてみようと思って普通に聴いていた。<a href="https://twitter.com/hashtag/%E9%87%91%E6%9C%9D%E3%83%84%E3%83%A1%E3%83%88%E3%82%AE?src=hashtag_click&f=live">#金朝ツメトギ</a> というハッシュタグは私がコメントして生まれた。コミュニティ的に盛り上げるならタイムラインを共有した方がよいとは思う。youtube live のチャットにコメントした方がいいか、twitter で気軽にコメントした方がいいか、まだよくわかってない。youtube のチャット欄のコメントの一覧性とか、普段使いのツールになっていないせいか、なんとなく抵抗感がある。いま参加者が少ないせいか、コメントするとスピーカーがコメントに反応して返答したりするので、あまりカジュアルに書き過ぎるとスピーカーの作業の邪魔にならないかな？とか思ったりもした。youtube live という勉強会の人間関係の距離感が難しい。</p>
<p>あと <a href=https://www.facebookconnect.com/ja-jp/>Facebook Connect 2021</a> というイベントがあることを教えてもらった。友だちに共有したら会社を休んで参加するとか言っているので私も参加してみることにした。どうしようか迷ってたけど、身近な人たちが参加するとつられるのかもしれない。</p>
<h2 id=法人県民税と法人市民税の中間申告と納付>法人県民税と法人市民税の中間申告と納付</h2>
<p>前日(というか今日)に4時まで起きてたのは申告書の内容確認や記入をしてたから。せっかく申告書を作成したのですぐ納付したくなった。それで新長田の合同庁舎まで申告に行ってきた。<a href=https://www.eltax.lta.go.jp/>eltax</a> は相変わらず windows 向けの DL 版でないと申告できそうにない。WEB 版もあって一部対応しているようだけど、よくよく調べていくと DL 版でしかできないようにみえる。毎年 WEB 版でできるようになっているかどうかを調べている。この互換性を調べるような作業を都度やるのが面倒になってきた。vr 用途 (oculus link を使いたい) にも使えるので windows マシンを購入してもいいかもしれないと考えるようになってきた。申告書を郵送してもよいけど、1時間もあれば往復できる距離なので気分転換も兼ねて合同庁舎に出向いてきた。</p>
<p>帰りに新長田駅の近くの三菱UFJ銀行の支店で納付する。前回は窓口納付をしたが、今回は STM (Store Teller Machine) での納付に初挑戦した。<a href=https://life-is-miracle-wind.blog.jp/archives/22922687.html>STM(Store Teller Machine)の存在意義とは</a> のブログ記事にも書かれている通り、納付書を OCR でスキャンすることでどんな納付書でも対応できるという汎用性はすごいと思うものの、その裏で人間がチェックしているんじゃないかと思えるメッセージや引き落とす合計金額はユーザーが手入力で決定する (OCR で合計がどの金額かわからなかった場合のみ？) といったオペレーションになっていて、なんか全く自動化されてない感があって残念に思った。見た目上、機械化されているけど、運用には人手がかかっているようにみえた。まぁでも、初めて使ってみて経験としてはおもしろかった。</p>
<h2 id=jira-のフィルターとリマインダー>Jira のフィルターとリマインダー</h2>
<p>所得税や住民税の納付は原則毎月納付する必要があるけど、小さい企業は納付の特例という制度があって6ヶ月単位にまとめて納付できる。小さい企業の事務手続きの工数削減を狙いとしてある制度だと思う。うちもその特例制度を利用して6ヶ月ごとに納付している。カレンダーに繰り返し予定として登録してあるのでカレンダーをみていれば見落とすことはないのだけど、そのときに都度チケットを作ってやるのも面倒なので納付の親チケットを作っておいて、子タスクとして毎回作業するようにしている。それをみていて、納付期限を設定しておいてリマインダーしたら課題管理システムっぽくていいなと思って Jira でのやり方を調べてみた。<a href=https://community.atlassian.com/t5/Jira-articles/Jira%E3%81%AB%E3%81%A6%E6%9C%9F%E9%99%90%E3%81%AE%E8%BF%91%E3%81%84%E8%AA%B2%E9%A1%8C%E3%81%AE%E9%80%9A%E7%9F%A5%E3%82%92%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8A%E3%81%9F%E3%81%84/ba-p/770716>Jiraにて期限の近い課題の通知を受け取りたい</a> というのがあって、任意の JQL で期限を調べるフィルターを書いて、そのフィルターに対してサブスクリプションというメール配信設定を行う仕組みになっている。これはこれでよくできたうまい仕組みだと思う。しかし、いまチケットのイベントに対してメールを送る設定は無効にしていて、Slack インテグレーションを使ってすべて Slack の通知チャンネルにイベントを流すようにしている。できれば、Slack インテグレーションで期限のリマインダーを通知できるのが望ましいた。公式の <a href=https://www.atlassian.com/partnerships/slack>Jira Slack app</a> だと、JQL でフィルターはできるけど、イベント発生時に通知する仕組みなので毎週フィルター実行するような用途には使えない。</p>
<p>たまたまそんな話しをツィートしてたら Jira API と Slack API を使ってスクリプトを書いているというのを教えてもらった。これはこれで便利そう。</p>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>こんな感じのスクリプトでJIRAからslackに通知してます <a href=https://t.co/UzeIZ9Nbol>https://t.co/UzeIZ9Nbol</a></p>&mdash; Takanori Suzuki (@takanory) <a href="https://twitter.com/takanory/status/1451572269768003589?ref_src=twsrc%5Etfw">October 22, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1021/>読書はお休み2日目</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-21
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/slack/>slack</a>&nbsp;
#<a href=/diary/tags/writing/>writing</a>&nbsp;
</span>
<div class=table-of-contents>
<h2>
目次
</h2>
<nav id=TableOfContents>
<ul>
<li><a href=#設計ドキュメント作成>設計ドキュメント作成</a></li>
<li><a href=#ジョギング>ジョギング</a></li>
<li><a href=#slack-community>Slack Community</a></li>
</ul>
</nav>
</div>
<div class=post-content>
<p>0時に寝て7時に起きた。昨日は寝不足だったせいかぐっすり眠れた。</p>
<h2 id=設計ドキュメント作成>設計ドキュメント作成</h2>
<p>昨日の続き。着手すると徐々に興が乗ってくる。朝からずっとやり続けて17時ぐらいに一通りたたき台ができた。なぜか朝ご飯もお昼ご飯も食べずに資料を作り続けてた。お腹もあまりすかなかった。経緯や背景、設計の意図やシステム構成、展望やビジネス戦略など、スライドで39枚になった。顧問さんに情報共有するための資料なんだけど、自分一人の会社で自分一人で開発するのに2日もかけて資料作る必要あるのだろうかと考える人も多いと思う。この資料に書いた内容はすべて課題管理システム上のチケットのどこかに書いてあることなので、私の視点からは全部知っている内容ではある。ちょうど100を超えたばかりのチケット上のどこかに書いてあることを、39枚のスライドにまとめて今日の時点でのスナップショットを作るというのは思考の整理に役立っている。去年はそういうことをやらなかったので何かうまくいかなくなったのを <a href=https://note.com/t2y1979/n/n84deed5fd934>リモートワークと相談相手</a> に書いた。今年はうまくいってないという感覚がないので気持ちに余裕がある。気持ちに余裕があるから新しい施策やアイディアに集中できているように考えている。</p>
<h2 id=ジョギング>ジョギング</h2>
<p>資料できたのが嬉しくて気分がよかったのでそのまま帰ってジョギングしてきた。今週初めて。19時までに帰ってくると行く気するんだけど、それよりも遅く帰ってくるとお腹空いて晩ご飯を先に食べてしまい、晩ご飯を食べると走りに行く気力がなくなってしまう。前に軽く調べたら健康的には食べる前に走った方がよいみたい。<a href=/diary/posts/2021/1014/#ジョギング>先週とだいたい同じ時間帯に行った</a> んやけど、陸上部の人たちが減ってて走りやすかった。曜日じゃなくて何か別のサイクルがあるのかな。ちょっと寒いぐらいだから走っててもあまり汗も書かないし、走った後にストレッチするのも汗だくにはならない。</p>
<h2 id=slack-community>Slack Community</h2>
<p><a href=https://qiita.com/seratch/items/d67f36d0ff7dfaadcc3b#slack-community-%E6%97%A7-slack-platform-community>Slack Community</a> というのがあるのをみかけたので参加してみた。これからしばらく Slack apps についてがっつり調べていく予定。困ったときに相談できるように。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1020/>読書はお休み</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-20
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/slack/>slack</a>&nbsp;
#<a href=/diary/tags/xr/>xr</a>&nbsp;
</span>
<div class=table-of-contents>
<h2>
目次
</h2>
<nav id=TableOfContents>
<ul>
<li><a href=#slack-apps-の調査>Slack apps の調査</a></li>
<li><a href=#設計ドキュメント着手>設計ドキュメント着手</a></li>
<li><a href=#vr-イベント参加>VR イベント参加</a></li>
</ul>
</nav>
</div>
<div class=post-content>
<p>4-5時に6時に起きた。寝られなかったというよりは寝る気がなくて3時頃にお茶を沸かして冷ましたりしてた。6時から <a href=https://kobe-sannomiya-dev.connpass.com/event/228152/>【三宮.dev オンライン】リモート朝活もくもく会</a> に参加してメンバーと雑談してた。もはや朝活というよりは雑談会になっているw 普通に起きたら7時まわってから起きるのが、イベントがあると6時に起きれるのでそれはそれで早起きするモチベーションになっていいかとは思っている。とはいえ、お昼やっぱり眠くなって1時間ほど昼寝した。昨日あまり寝てなかったら夜も集中力なくなってバテた。</p>
<h2 id=slack-apps-の調査>Slack apps の調査</h2>
<p>日記に書くの忘れてた。さらに3つのアプリを試してみた。</p>
<p><a href=https://www.thetodobot.com/>ToDoBot</a></p>
<blockquote>
<p>Task Management App for Slack</p>
</blockquote>
<p>これは基本的には個人向けのタスク管理ツール。タスクをグルーピングする機能をもっているのでそれを共有することでチーム単位でも使えるとは思うけど、あまりチーム向けに機能が用意されているようにはみえない。</p>
<p><a href=https://www.getsidequest.app/>Sidequest</a></p>
<blockquote>
<p>Meet the Missing Task Manager for Slack.</p>
</blockquote>
<p>個人/グループのタスク管理とチームでタスクを共有する用途にも機能が提供されている。タスクを作る際にチャンネルに作成すると、そのチャンネルにいるユーザーが確認して適切な人を担当者として割り当てるといった運用になる。タスク作成からの導線と担当者を割り当てる UI が自然な流れになっていてよさそうに思えた。課題管理システムの代わりにはならないけど、ヘルプデスクの用途にはちょうどよさそうにみえる。</p>
<p><a href=https://happybara.io/apps/streamly/>Streamly</a></p>
<blockquote>
<p>A complete task management suite in Slack</p>
</blockquote>
<p>目指しているものは課題管理システムではあるけど、Stream (プロジェクト)、Request (チケット) といった新しい名前 (概念) を導入しているので、まず用語からして学習コストが上がる。プロジェクトはチャンネルごとに設定して、Request の接頭辞やカスタムフィールドも設定できるようになっていて、課題管理システムを目指しているんだなという雰囲気はする。UI は Slack のフォームを使っているので1つ1つの操作が API 呼び出しになって操作量やフォーム入力が増えてあまり使いやすくは感じなかった。同じような操作を何度もさせられるといった印象を受ける。</p>
<p>一旦、これで Slack apps で適当に検索した課題管理システムに近いツールの調査を終える。1-2時間さらっと表面的なところしか触ってないけど、どれもプロダクション品質になっているのだから、内部はよく作り込まれているんだと推測する。</p>
<h2 id=設計ドキュメント着手>設計ドキュメント着手</h2>
<p>課題管理システムの設計を資料にまとめ始めた。先週ぐらいからチケットに設計の要素を書き始めてだいたいのイメージは頭の中では固まっている。これまで3ヶ月調べた内容もあるのでそれなりの背景をもった設計資料にはなる。頭の中のイメージはできているけど、それを言語化する作業を今日・明日ぐらいでやりたい。書くことの難しいところはいざ言語化しようとするとやっぱり時間がかかる。たぶんわかった気になって本当のところはちゃんと分かってないことの裏返しだと思う。</p>
<h2 id=vr-イベント参加>VR イベント参加</h2>
<p><a href=https://osaka-driven-dev.connpass.com/event/226481/>【大阪オンライン】XRミーティング 2021/10/20【AR/CR/MR/SR/VR】</a> に参加した。zoom を複数地域と接続して youtube live で配信していたせいか、始まるまで時間がかかった。参加者のアバターがそれぞれ独自のものでかっこいいなと思って眺めてた。登壇者が5名いて全員が HoloLens を使っていた。電話してたり調べものしてたりしたので断片的にみていた。長めの発表と LT のような短い発表とバラバラ。適当に所感を書いていく。HoloLens の Moving Platform Mode の紹介はあまり見た目は派手ではなかったけど、どういう仕組みかを説明して動画で実際の振る舞いを説明してた。へーって感じで聞いていた。次に HoloLens 触ってはまって20年働いた会社をやめて VR 系の会社に転職した人。前職が大企業だったので給料もだいぶ下がったけど、家族を説得したらしい。給与以上に HoloLens の将来性を感じたとのこと。HoloLens で OpenCV や Azure Face API を使って顔認識するアプリケーションの紹介してた。おもしろそうだった。最後は HoloLens のアプリ開発の発表だった。Microsoft が Mixed Reality Tool Kit というライブラリを提供していて、クラウスプラットフォームで開発できる。ライブラリの Plane Finding という機能を紹介してた。空間の平面だしをする部品。水平面や垂直面を抽出したりできる。この機能を使ってアプリケーション開発のサンプルなどの話をしてた。</p>
</div>
</div>
<div class="post on-list">
<h1 class=post-title>
<a href=/diary/posts/2021/1019/>改正法人税法等の説明会</a>
</h1>
<div class=post-meta>
<span class=post-date>
2021-10-19
</span>
</div>
<span class=post-tags>
#<a href=/diary/tags/book/>book</a>&nbsp;
#<a href=/diary/tags/tax/>tax</a>&nbsp;
</span>
<img src=/diary/img/2021/1019_water-spout.jpg class=post-cover alt=改正法人税法等の説明会>
<div class=table-of-contents>
<h2>
目次
</h2>
<nav id=TableOfContents>
<ul>
<li><a href=#データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</a>
<ul>
<li></li>
</ul>
</li>
<li><a href=#改正法人税法等の説明会>改正法人税法等の説明会</a></li>
</ul>
</nav>
</div>
<div class=post-content>
<p>0-1時ぐらいに寝て7時半に起きた。よく眠れたか眠れてないかもわからないような目覚め方をして少しぼおっとしてた。朝ゆっくりしてもいいかと思いつつ準備して移動したら9時前にはオフィスにいたので普通の日とそう変わらない一日の始めだった。夜にジョギング行こうかと思ってたけど、ちょうど通り雨が降ったりやんだりしててやめた。代わりに雨やんでからオフィス行って調べてものしてた。</p>
<h2 id=データ指向アプリケーションデザイン>データ指向アプリケーションデザイン</h2>
<p>7.3を読んで7章トランザクションを読み終えた。トランザクションの章は言葉も知らないし、あまりクリティカルなアプリケーションの開発に関わってこなかったのでそこまで意識したことがなかった。トランザクションで問題が発生する分離レベルと典型的なパターンが体系的に整理されていてすごく勉強になった。結果的にトランザクションを使わないとしても、トランザクションの要否や起きうる整合性の問題を理解しておくとデータ定義やアプリケーションの設計にも活かせる気がする。7章まで読んだ中でもっとも知らないことが多かった。約300ページなのでだいたい半分読み終えた。まだまだ先は長い。</p>
<p>トランザクションの開始時点でロックをかけるべきオブジェクトが存在せず、あるトランザクションでの書き込みが他のトランザクションの検索クエリの結果を変化させてしまう問題を <strong>ファントム</strong> と呼ぶ。ファントムの対策の1つとして、あらかじめそのデータを作っておき <code>SELECT FOR UPDATE</code> でロックを取得するやり方を <strong>衝突の実体化 (materializing conflicts)</strong> と呼ぶらしい。グループウェアの開発をしていた頃、1つのスレッドしかトランザクションを実行できないことを保証するための切り札として、ロック用途のテーブルを設けておき、そのロックを獲得したスレッドだけ処理できるようにしていた。当時はわからなかったけど、あれは衝突の実体化という手法だったんだといま気付いた。</p>
<blockquote>
<p>データベースのクラッシュや整合性に関する問題に対する信頼性を保つために、それらの問題を単純化するために、この数十年にわたって選択されてきた仕組みが <strong>トランザクション</strong> である。トランザクションは、アプリケーションが複数の読み書きを論理的な単位としてまとめる方法である。概念的には、トランザクション中のすべての読み書きは1つの操作として実行される。トランザクションは抽象化のレイヤーであり、アプリケーションはある種の並行性の問題や、ある種のハードウェアやソフトウェアの問題が存在しないかのように振る舞えるようになる。</p>
<p>トランザクションは全体として成功（ <strong>コミット（commit）</strong> ）もしくは失敗（ <strong>中断（abort）</strong> 、 <strong>ロールバック（rollback）</strong> ）する。トランザクションが失敗した場合には、アプリケーションは安全にリトライできる。トランザクションは自然法則ではなく、データベースにアクセスするアプリケーションのためのプログラミングモデルをシンプルにするという目的を持って生み出された。トランザクションを利用すれば、ある種の潜在的なエラーの状況や並行性の問題はデータベースが面倒を見てくれるので、アプリケーションはそれらを気にしなくてよくなる（このことは <strong>安全性の保証</strong> と呼ばれる）。</p>
<p>トランザクションが提供する安全性の保証は <strong>ACID</strong> で示される。</p>
<h5 id=原子性-atomicity>原子性 (Atomicity)</h5>
<ul>
<li><strong>原子（アトミック）</strong> はそれ以上小さな部分に分割できないものを指して使われる言葉</li>
<li>マルチスレッドのプログラミングにおいては、あるスレッドがアトミックな処理を実行しているというなら、それは他のスレッドからはその処理の半分だけ完了した途中の状態を見る方法が存在しないことを意味する。システムが取りえる状態は、その処理が始まる前と終わった後の状態だけであり、その中間の状態になることはない
<ul>
<li>前にメモリモデルの文脈で、あるプロセスが書き込み完了したデータが、他のプロセスからも確実に読めることをアトミックな操作と習ったことがある</li>
</ul>
</li>
<li>原子性と並行性は関係がない</li>
<li>エラーの際にトランザクションを中断し、そのトランザクションのすべての書き込みを破棄できることが、 ACID の原子性を決定づける特徴と言える
<ul>
<li>アプリケーションがリトライしても安全であることを保証する</li>
<li><strong>中断可能性（abortability）</strong> の方が原子性よりも良い言葉だったと思われる</li>
</ul>
</li>
</ul>
<h4 id=一貫性-consistency>一貫性 (Consistency)</h4>
<ul>
<li>一貫性は多くの意味で使われる
<ul>
<li>とくに日本語では整合性とも訳される</li>
</ul>
</li>
<li>非同期のレプリケーションシステムでは結果整合性の問題が発生する (5章)</li>
<li>コンシステントハッシュ法は、リバランシングのためにいくつかのシステムで利用されているパーティショニングのアプローチ</li>
<li>CAP 定理では、一貫性という言葉は線形化可能性の意味で使われる (9章)</li>
<li>ACID の文脈における一貫性は、データベースが「良い状態」にあることを示すアプリケーション固有の概念を指す</li>
</ul>
<p>同じ言葉を少なくとも4つの異なる意味で使われている。ACID における一貫性という概念は、データについて常に真でなければならない何らかの言明（ <strong>不変性</strong> ）があることを指す。たとえば、会計システムの場合、すべてのアカウントでまとめれば常に貸方と借方は等しくならなければならない。この一貫性の概念はアプリケーション固有の不変性の概念に依存しており、一貫性を保つようにトランザクションを適切に定義することはアプリケーションの責任となる。原子性、分離性、永続性はデータベースの特性だが、一貫性は（ ACID という考え方においては）アプリケーションの特性である。したがって、 C は実際には ACID に属していない。</p>
<h4 id=分離性-isolation>分離性 (Isolation)</h4>
<p>多くのデータベースは、同時に複数のクライアントからアクセスされる。データベース中の同じレコードにアクセスするときに並行性の問題（レース条件［ race condition ］）が生じる可能性がある。データベース中に保存されているカウンタを、2つのクライアントが同時にインクリメントすると仮定する。それぞれのクライアントは現在の値を読み取り、1を加え、新しい値を書き戻す。ACID における分離性とは、並行して実行されたトランザクションがお互いから分離されており、お互いのつま先を踏みつけあうようなことがないという意味である。実際の運用では、パフォーマンスの制約から分離レベルによって保証される分離性が変わってくる。</p>
<h4 id=永続性-durability>永続性 (Durability)</h4>
<p>データベースシステムが目的とするのは、データを失う恐れなく保存できる安全な場所を提供すること。永続性は、トランザクションのコミットが成功したら、仮にハードウェアの障害やデータベースのクラッシュがあったとしても、そのトランザクションで書き込まれたすべてのデータは失われないことを約束する。</p>
<h4 id=用語の整理>用語の整理</h4>
<p>トランザクションはデータモデルがどういったものであるかにかかわらず、価値あるデータベースの機能と言える。並行に実行されたトランザクションがお互いに影響しあわない分離性における保証を <strong>分離レベル</strong> と呼ぶ。</p>
<ul>
<li>read committed</li>
<li>スナップショット分離（repeatable read とも呼ばれる）</li>
<li>直列化可能</li>
</ul>
<p>これらの分離レベルに対してトランザクションで発生する様々なレース条件がある。</p>
<ul>
<li>ダーティリード
<ul>
<li>あるクライアントが他のクライアントのまだコミットされていない書き込みを読める</li>
<li>read committed 分離レベル及びそれ以上に強い分離レベルはダーティリードは生じない</li>
</ul>
</li>
<li>ダーティライト
<ul>
<li>あるクライアントが他のクライアントによるまだコミットされていない書き込みの内容を上書きしてしまう</li>
<li>ほぼすべてのトランザクションの実装は、ダーティライトを生じない</li>
</ul>
</li>
<li>読み取りスキュー（nonrepeatable read）
<ul>
<li>クライアントが異なる時刻にデータベースの異なる部分を見ること</li>
<li>この問題の最も一般的な回避策はスナップショット分離によるもので、これはトランザクションがある時点での一貫したスナップショットから読み取りを行えるようにする</li>
<li>通常、MVCC（multi-version concurrency control）を利用して実装される</li>
</ul>
</li>
<li>更新のロスト
<ul>
<li>2つのクライアントが並行して read-modify-write サイクルを実行するとき、片方が他方の書き込みをその変更内容を考慮せずに上書きしてしまい、データが失われること</li>
<li>スナップショット分離レベルの実装にはこの異常を自動的に回避してくれるものもあるが、明示的なロック（ SELECT FOR UPDATE ）をしなければならない実装もある</li>
</ul>
</li>
<li>書き込みスキュー
<ul>
<li>トランザクションが何かを読み取り、その値に基づいて判断を下し、その結果をデータベースに書き込む</li>
<li>この状況で、書き込みが行われた時点で判断の根拠となったプレミスが真ではなくなっている場合を指す</li>
<li>直列化可能分離レベルのみがこの異常を回避できる</li>
</ul>
</li>
<li>ファントムリード
<ul>
<li>トランザクションが何らかの検索条件にマッチするオブジェクトを読み取り、他のクライアントはその検索結果に影響する書き込みを行う</li>
<li>スナップショット分離レベルは単純なファントムリードを回避してくれるが、書き込みスキューを伴うファントムに対してはインデックス範囲ロックのような特別な対応が必要となる</li>
</ul>
</li>
</ul>
<p>弱い分離レベルは、これらの異常のいくつかを防いでくれるが、それ以外はアプリケーション開発者に対処する必要がある（たとえば明示的なロックなど）。すべての問題に対する保護を提供してくれるのは直列化可能分離レベルのみ。直列化可能なトランザクションの実装方法は、3 種類ある。</p>
<ul>
<li>トランザクションを順次実行する
<ul>
<li>それぞれのトランザクションをきわめて高速に実行でき、加えて単一の CPU コアで十分処理できる程度にトランザクションのスループットが低いのであれば、これはシンプルで効果的な選択肢となる</li>
</ul>
</li>
<li>ツーフェーズロック
<ul>
<li>数十年にわたって直列化可能分離レベルの実装において標準的な方法であった</li>
<li>パフォーマンス上の特性から多くのアプリケーションがツーフェーズロックの利用は避けている</li>
</ul>
</li>
<li>直列化可能スナップショット分離（SSI、serializable snapshot isolation）
<ul>
<li>新しいアルゴリズムであり、これまでのアプローチが持つ欠点のほとんどを回避している</li>
<li>SSI は楽観的アプローチを取っており、トランザクションはブロックされることなく処理を進められる</li>
<li>トランザクションはコミットの時点でチェックされ、その実行が直列化可能になっていなければ中断される</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id=改正法人税法等の説明会>改正法人税法等の説明会</h2>
<p><a href=https://www.nk-net.co.jp/kobe/assets/files/schedule/2021/211019.pdf>改正法人税法等の説明会</a> に参加してきた。所感からまとめるとこんな感じ。</p>
<ul>
<li>神戸文化ホールについて
<ul>
<li>電源がない</li>
<li>FREESPOT が提供されていてフリー wifi として利用できるが、通信品質は不安定
<ul>
<li>スマホでテザリングもやってみたが、電波状態がよくなくてもっと不安定</li>
</ul>
</li>
<li>ラップトップ向きの場所ではない</li>
</ul>
</li>
<li>税制を身近にするイベントとしては参加してもよい</li>
<li>もらった資料をたんたんと説明するだけなのでイベントに参加することで得られる付加価値はとくにない</li>
<li>気分転換や時間があれば参加すればいい、忙しかったら参加しなくてもよさそう</li>
</ul>
<p><a href=https://www.nk-net.co.jp/kobe/index.html>公益社団法人 神戸納税協会</a> という組織がある。年会費 (うちの会社だと7,800円) がいるのでいまは入らないけど、無料税務相談があるので余裕ができたら困ったときの相談相手になってもらう意図で入会してもよいかもしれない。冒頭の神戸税務署長の挨拶で法人税の申告における e-tax の利用率は 88.4% だと話してた。うちは紙で申請しているので意外とみんな e-tax 使っているんだなと自社を恥じた。だって Windows マシンないとできへんねんもん。参加したことによる学びとして書いていくとこれらかな。</p>
<ul>
<li>「研究開発費」は会計上の用語、「試験研究費」は税法上の用語</li>
<li>DX 投資促進税制の創設</li>
</ul>
<p>内容は基本知らないことなので、知らないことに触れるイベントという点では斬新ではあった。ほうほうと聞いてただけなんだけど。直接うちの会社に影響を与える税法の改正はインボイス制度ぐらいかな。</p>
</div>
</div>
<div class=pagination>
<div class=pagination__buttons>
<span class="button previous">
<a href=/diary/page/26/>
<span class=button__icon>←</span>
<span class=button__text>最近の日記</span>
</a>
</span>
<span class="button next">
<a href=/diary/page/28/>
<span class=button__text>過去の日記</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class="copyright copyright--user">
<span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span>
</div>
</div>
</footer>
<script src=/diary/assets/main.js></script>
<script src=/diary/assets/prism.js></script>
</div>
</body>
</html>