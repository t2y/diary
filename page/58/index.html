<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.109.0"><title>forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content="t2y"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="forest nook"><meta property="og:description" content><meta property="og:url" content="/diary/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1220/>ケーブル配線トレー気に入った</a></h1><div class=post-meta><span class=post-date>2022-12-20 (Tue.)</span></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;</span>
<img src=/diary/img/2022/1220_cable.jpg class=post-cover alt=ケーブル配線トレー気に入った><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ケーブル配線トレー>ケーブル配線トレー</a></li><li><a href=#rabbitmq-の-management-api>rabbitmq の management api</a></li></ul></nav></div><div class=post-content><p>20時に寝て22時に起きて、24時ぐらいまでだらだらやって6時まで寝た。本当は晩ご飯食べてオフィスに戻るつもりが疲れて寝てた。</p><h2 id=ケーブル配線トレー>ケーブル配線トレー</h2><p><a href=/diary/posts/2022/1218/#リモートワークの道具>たいちさんの記事</a> を参考に購入した <a href="https://www.sanwa.co.jp/product/syohin?code=CB-CT4">ケーブルトレー (CB-CT4)</a> が届いたのですぐ机に取り付けてみた。ちょうど机のサイズやオフィスの空間にもマッチしていてケーブルの配線をよい感じに収納できた。新しいオフィスには幅広な棚がついていてその棚もそうなんだけど、縦の空間を分割して使えると効率がよい。普段プログラミングや ci/cd で効率のことばかり考えているから日常生活でも効率のよいことがあると嬉しい気持ちになる。ケーブルトレーはオフィス空間の効率化に寄与する。物理的なメリット以上に、私にとっては精神的に作用した気がする。</p><h2 id=rabbitmq-の-management-api>rabbitmq の management api</h2><p>rabbitmq には <a href=https://www.rabbitmq.com/management.html>Management Plugin</a> という拡張があって、これをインストールすると管理画面と <a href=https://www.rabbitmq.com/management.html#http-api>HTTP API</a> が付いてくる。<a href=https://hub.docker.com/_/rabbitmq>docker image</a> だと、たぶん <code>management</code> のタグが付いているものを選べばよいと思う。exchange や queue の初期設定を go のアプリケーションからできるようにしようと思って <a href=https://github.com/michaelklishin/rabbit-hole>rabbit-hole</a> というライブラリを使ってすぐに実装できた。最低限の必要な機能をもつサブコマンドな cli からも呼べるようにした。本番環境でもこの cli を使って rabbitmq の初期設定や確認をする運用ツールにしようと思う。管理画面でもできるけど、cli でできた方がマニュアルを作る上でも簡単だし作業ログも管理しやすい。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1219/>dind をやってみた</a></h1><div class=post-meta><span class=post-date>2022-12-19 (Mon.)</span></div><span class=post-tags>#<a href=/diary/tags/gitlab/>gitlab</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
#<a href=/diary/tags/docker/>docker</a>&nbsp;
#<a href=/diary/tags/testing/>testing</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#gitlab-cicd-で-docker-in-docker>gitlab ci/cd で docker in docker</a></li></ul></nav></div><div class=post-content><p>3時に寝て7時半に起きた。最後なのでワールドカップの決勝戦をみてた。接戦で試合もおもしろかったしよかったと思う。</p><h2 id=gitlab-cicd-で-docker-in-docker>gitlab ci/cd で docker in docker</h2><p>ミドルウェアを伴う結合テストは <a href=https://github.com/ory/dockertest>dockertest</a> というツールを使って docker でミドルウェアを起動して実行している。デフォルトで作成した gitlab runner で docker を使おうとすると失敗する。これは gitlab runner が ci/cd ジョブを docker で動かすため docker in docker (これを <em>dind</em> と呼ぶらしい) のための設定が必要になる。大雑把に言えば gitlab runner にそのための権限を設定する必要がある。gitlab の次のドキュメントに詳細が書いてある。</p><ul><li><a href=https://docs.gitlab.com/ee/ci/docker/using_docker_build.html#use-docker-in-docker>Use Docker-in-Docker</a></li></ul><p>gitlab runner に権限を設定したら次のような job が動けば docker in docker は成功と言える。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>hello-dind</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>stage</span>: <span style=color:#ae81ff>test</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>image</span>: <span style=color:#ae81ff>docker:20.10.21</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>variables</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>DOCKER_HOST</span>: <span style=color:#ae81ff>tcp://docker:2375</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>DOCKER_TLS_CERTDIR</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>docker:20.10.21-dind</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>allow_failure</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>before_script</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>docker info</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>script</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>docker run hello-world</span>
</span></span></code></pre></div><p>あとになって気付いたことだけど、dockertest の README にも <a href=https://github.com/ory/dockertest#running-dockertest-in-gitlab-ci>Running dockertest in Gitlab CI</a> としていくつか tips が紹介されている。dockertest で作成したリソースからホスト名とポート番号を取得するには次のようなユーティリティを使う必要がある。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getHostPort</span>(<span style=color:#a6e22e>resource</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>dockertest</span>.<span style=color:#a6e22e>Resource</span>, <span style=color:#a6e22e>id</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>dockerURL</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Getenv</span>(<span style=color:#e6db74>&#34;DOCKER_HOST&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>dockerURL</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>GetHostPort</span>(<span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>u</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>Parse</span>(<span style=color:#a6e22e>dockerURL</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>Hostname</span>() <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>GetPort</span>(<span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1218/>オフィスでのんびり過ごす</a></h1><div class=post-meta><span class=post-date>2022-12-18 (Sun.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#リモートワークの道具>リモートワークの道具</a></li><li><a href=#マイナポータルへの登録>マイナポータルへの登録</a></li></ul></nav></div><div class=post-content><p>21時に寝て何度も夜起きながら頭痛の機嫌をとりつつ8時に起きた。頭痛はほとんどなくなったもののお腹が痛かったりして微妙な体調。お仕事は断念してブログの記事を読んだりみかん食べたり買いものしたりしてのんびりしていた。</p><h2 id=リモートワークの道具>リモートワークの道具</h2><p>たいちさんが <a href=https://blog.satotaichi.info/working-area/>二年以上のリモートワークを生き残っている道具を紹介する</a> という記事を書いていて同じマウスを使っているなと親近感をもって読んでいた。引っ越したばかりのオフィスでケーブル周りがあまりしっくりこないと思っていたので <a href="https://www.sanwa.co.jp/product/syohin?code=CB-CT4">ケーブルトレー (CB-CT4)</a> を購入してみることにした。机の上にわさわさしているケーブルや電源タップの取り回しをすっきりできそう。</p><h2 id=マイナポータルへの登録>マイナポータルへの登録</h2><p>親が <a href=https://mynumbercard.point.soumu.go.jp/>マイナポイントのキャンペーン</a> がどうこうと、マイナンバーカードを取得して申し込みなどをしていた話しを聞いた。うちの親が手続きしているぐらいなのでそれなりに一般の人たちがマイナンバーカードを取得して申し込みしているのではないかと思う。私もよくわかっていなかったけど、12月中に手続きをすれば20,000ポイントをもらえるとあるので paypay 経由で手続きをしてみた。次の2つに登録するとよいみたい。</p><ul><li>健康保険証としての利用申し込み</li><li>公金受取口座の登録</li></ul><p>どちらも行政手続きの簡略化が期待される。システムに関わっている私は受け入れて申し込みした。手続きがうまくいけば paypay でマイナポイントをチャージして使えるらしい。paypay はふるさと納税とも連携するし、こういった行政との連携も抜群で便利な決済アプリになったなぁという印象。また以前はボーナス運用と呼ばれていた paypay を使ったときに還元されるポイントを資産運用している。それがパワーアップして <a href=https://www.paypay-sec.co.jp/>paypay証券</a> になったみたい。paypay はイケイケやね。積立もできるらしいので投資信託の代わりのようなものだと思う。いままでのポイント運用プラス積立を気軽にできる資産運用としてよさそうに思えたので申し込みしてみた。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1217/>コミュニティ忘年会</a></h1><div class=post-meta><span class=post-date>2022-12-17 (Sat.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/day-off/>day off</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;</span>
<img src=/diary/img/2022/1217_bigpork.jpg class=post-cover alt=コミュニティ忘年会><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ストレッチ>ストレッチ</a></li><li><a href=#もくもく会--忘年会>もくもく会 & 忘年会</a></li></ul></nav></div><div class=post-content><p>22時に寝て0時に起きて、4時5時と起きて7時に起きた。昨日の夜ぐらいからずっと頭痛がする。体調悪い。</p><h2 id=ストレッチ>ストレッチ</h2><p>今日の開脚幅は開始前153cmで、ストレッチ後157cmだった。先週とほぼ変わらず疲弊と疲労が抜けきっていない。右太もも周りの張りや違和感が依然として強い。腰も自覚症状はなかったもののストレッチを受けていると張りが強いことに気付いた。トレーナーさんからも調子悪そうみたいなコメントもあった。田んぼ・出張を経てのオフィス移転から引っ越しに伴う行政手続きと、この3週間のバタバタした負荷が残っているみたい。土日もずっと作業を継続しているのもよくないのかもしれない。とはいえ、お仕事も引っ越しの行政手続きも一段落はついたので徐々に復調していくはず。</p><h2 id=もくもく会--忘年会>もくもく会 & 忘年会</h2><p>ストレッチを終えたら普段はオフィスで調べものをしているところ、頭痛でしんどいから家に帰って寝てた。そして14時から <a href=https://kobe-sannomiya-dev.connpass.com/event/265510/>【三宮.dev】今年を〆るもくもく会</a> に参加した。2022年7月頃に移転したばかりの中央区の区役所の上に <a href=https://www.kobe-bunka.jp/facilities/chuo/>中央区文化センター</a> がある。そこで開催されて初めて施設に入った。新設した施設なのできれいで設備も充実していてよさそうにみえた。うちのオフィスからも近い。うちの会社にお客さんが来ることはないのだけど、大人数の打ち合わせにも使えそう。</p><p>オフィスへ行かなかった日は <a href=/diary/tags/day-off/>day off</a> というタグで記録している。オフィスへ行ったからといった必ずしもお仕事しているわけではないけれど、役員は考えること・為すことすべてが事業に関連するという考えからオフィスへ行く・行かないという基準で <em>day off</em> という概念を私の中で切り替えている。家で寝てても頭痛はおさまらなかったものの、気合を入れてもくもく会へ行って日記を書いたり調べものをしたりしていた。17時にもくもく会が終わって忘年会へ続く。頭痛はまだ残っていたものの、お昼よりは少しましになった。忘年会も休もうかどうか迷ったんだけど、普段来られない方々もいたのでせっかくの機会だと思って、本気出して忘年会へ行ってきた。体調悪いからお酒は控えた。忘年会でいろいろな話しを聞けたので行って楽しかった。</p><p>体調悪いから2次会は控えて家に帰ってきてそのまますぐ寝てた。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1216/>openapi 勉強会</a></h1><div class=post-meta><span class=post-date>2022-12-16 (Fri.)</span></div><span class=post-tags>#<a href=/diary/tags/docker/>docker</a>&nbsp;
#<a href=/diary/tags/nginx/>nginx</a>&nbsp;
#<a href=/diary/tags/tls/>tls</a>&nbsp;
#<a href=/diary/tags/openapi/>openapi</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#nginx-でつくるリバースプロキシ>nginx でつくるリバースプロキシ</a></li><li><a href=#openapi-勉強会>openapi 勉強会</a></li></ul></nav></div><div class=post-content><p>1時に寝て7時に起きた。昨日はたまたま遅くなって0時頃に帰ってきたが、最近は22時前後に帰ってくることが多い。疲労困憊。</p><h2 id=nginx-でつくるリバースプロキシ>nginx でつくるリバースプロキシ</h2><p>ちょっとググってみつかる記事を参考にして設定したらすぐにできた。私は tls 周りの設定に詳しくないのでこういうまとめ記事はとても助かる。インターネットって便利。</p><ul><li><a href=https://gist.github.com/dahlsailrunner/679e6dec5fd769f30bce90447ae80081>Docker with SSL and an nginx reverse proxy</a></li><li><a href=https://mpolinowski.github.io/docs/DevOps/NGINX/2020-08-27--nginx-docker-ssl-certs-self-signed/2020-08-27/>NGINX Docker with SSL Encryption (Self-signed)</a></li></ul><h2 id=openapi-勉強会>openapi 勉強会</h2><p>昨日の続き。openapi についてチーム勉強会を開催した。wiki に次の目次で説明を書いてその内容を勉強会で話した。ちょうど1時間におさまって内容もわかりやすいものができたのではないかと自画自賛。毎週のチーム勉強会のネタとしてちょうどよい粒度だった。</p><ul><li>code generator が fork した背景</li><li>スキーマ駆動開発<ul><li>メリット</li><li>デメリット</li></ul></li><li>OpenAPI スキーマからドキュメント生成</li><li>OpenAPI スキーマからコード生成</li><li>リファレンス</li></ul><p>余談だけど、過去に働いていた会社の発表資料が slideshare から docswell というサービスに移管されてた。slideshare は広告が鬱陶しいサービスになってしまってひどいユーザー体験だからこれは適切な判断だと思う。</p><ul><li><a href=https://www.docswell.com/s/ydnjp/Z3YQV5-2019-11-21-120351>https://www.docswell.com/s/ydnjp/Z3YQV5-2019-11-21-120351</a></li></ul></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1215/>openapi 再び</a></h1><div class=post-meta><span class=post-date>2022-12-15 (Thu.)</span></div><span class=post-tags>#<a href=/diary/tags/openapi/>openapi</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#openapi-generator-の調査>openapi-generator の調査</a></li><li><a href=#chatgpt-で遊ぶ>chatgpt で遊ぶ</a></li></ul></nav></div><div class=post-content><p>1時に寝て何度か起きて7時に起きた。1-2時頃に吐き気がして苦しむ割に後半はなにもなかったかのように眠れることがある。</p><h2 id=openapi-generator-の調査>openapi-generator の調査</h2><p>毎週の勉強会に向けて最新の <a href=https://github.com/OpenAPITools/openapi-generator>openapi-generator</a> を使って出力した go client のコードを読んだりしていた。openapi-generator を簡単に試すためのチュートリアルのようなものとして、過去にリポジトリに整理しておいた。このリポジトリを使うとコード生成とドキュメント生成の両方を試してスキーマがあることのメリットを体験できるようになっている。</p><ul><li><a href=https://github.com/kazamori/try-openapi-generator-cli>https://github.com/kazamori/try-openapi-generator-cli</a></li></ul><h2 id=chatgpt-で遊ぶ>chatgpt で遊ぶ</h2><p><a href=https://play2learn.connpass.com/event/268391/>【おあそぶ会】GPT3と遊ぶ</a> に参加した。gpt3 についてちょうさんが調べたメモにも目を通して参考になった。</p><ul><li><a href=https://peridot-balmoral-923.notion.site/20221215-GPT3-31a50d35e2b14c38a73693d1cf1d339a>20221215【おあそぶ会】GPT3と遊ぶ</a></li></ul><p>ちょうさんの gpt3 の説明を聞きながら chatgpt で葬送のフリーレンについてチャットしてた。今日の成果はこれかな。</p><figure><img src=/diary/img/2022/1215_chatgpt1.png></figure></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2022/1214/>技術選定の調査開始</a></h1><div class=post-meta><span class=post-date>2022-12-14 (Wed.)</span></div><span class=post-tags>#<a href=/diary/tags/frontend/>frontend</a>&nbsp;
#<a href=/diary/tags/tech-selection/>tech selection</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#フロントエンドの技術選定の調査>フロントエンドの技術選定の調査</a></li><li><a href=#インフレ勉強会>インフレ勉強会</a></li></ul></nav></div><div class=post-content><p>1時に寝て2時に起きて吐き気に苦しんで6時に起きた。後半はよく眠れた気がする。</p><h2 id=フロントエンドの技術選定の調査>フロントエンドの技術選定の調査</h2><p>はらさんにお願いした <a href=/diary/posts/2022/1209/#フロントエンド勉強会>フロントエンド勉強会</a> の内容を踏まえて技術選定を行う。次の3つを候補とした。</p><ul><li>react</li><li>svelte</li><li>solid</li></ul><p>客観的な指標で3つの技術を調査して比較した時点で solid はうちのチームにはあわないと候補から除外することにした。なので react vs svelte の一騎討ちとなる。なにか理由がない (デファクトスタンダード) なら react だし、うちのチームにとって有効だと判断できる項目があるなら svelte になる。ここで next.js と svelte kit でちょっとコードを書いてみて自分なりの感触も探ろうと考えている。</p><ul><li><a href=https://scrimba.com/articles/svelte-vs-react/>Svelte vs React: Which framework to learn in 2023?</a></li></ul><h2 id=インフレ勉強会>インフレ勉強会</h2><p><a href=https://inflation.connpass.com/event/266172/>エンジニアのためのインフレ研究会 #1</a> に参加した。お仕事の調べものをしながら聞いてた。私はもう常連で前々から同じような話を聞いているものの、発表者の資料も説明もわかりやすいものだったと思う。</p></div></div><div class=pagination><div class=pagination__buttons><a href=/diary/page/57/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span></a>
<a href=/diary/page/59/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>