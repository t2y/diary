<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.109.0"><title>forest nook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/diary/><link rel=stylesheet href=/diary/styles.css><link rel=stylesheet href=/diary/style.css><link rel="shortcut icon" href=/diary/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="t2y"><meta name=twitter:creator content="t2y"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="forest nook"><meta property="og:description" content><meta property="og:url" content="/diary/"><meta property="og:site_name" content="forest nook"><meta property="og:image" content="/diary/favicon.ico"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/diary/index.xml rel=alternate type=application/rss+xml title="forest nook"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/diary><div class=logo>forest nook</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/diary/about>自己紹介</a></li><li><a href=/diary/dates>月別一覧</a></li><li><a href=/diary/tags>タグ一覧</a></li></ul></nav></header><div class=content><div class=posts><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0323/>デスクトップマシンの買い替え</a></h1><div class=post-meta><span class=post-date>2023-03-23 (Thu.)</span></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/device/>device</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#dell-マシンの買い替え>dell マシンの買い替え</a></li></ul></nav></div><div class=post-content><p>1時に寝て5時に起きて7時に起きた。昨日も吐き気がしてうまく眠れなかった。</p><h2 id=dell-マシンの買い替え>dell マシンの買い替え</h2><p><a href=/diary/posts/2023/0123/#デスクトップマシンの調子が悪い>1月頃からデスクトップマシンの調子が悪かった</a> 。ちょうど3年経ったところでそろそろ故障してもおかしくないと言える。ちょうど年度末なので dell の半期に一度の大感謝祭を待って購入することにした。これまでは <a href=https://www.dell.com/ja-jp/shop/%E8%A3%BD%E5%93%81%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BA/sf/vostro-desktops>vostro</a> を使っていた。そろそろメモリが16GiBだと厳しくなってきたところ。メモリが32GiBついているデスクトップマシンは限られてくる。
その制約もあって <a href=https://www.dell.com/ja-jp/shop/%E8%A3%BD%E5%93%81%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BA/sf/xps-desktops>xps</a> マシンを購入をすることにした。</p><p>昨日のお昼過ぎに注文したのに翌日の午前中にマシンが届いた。あまりの早さに驚いた。dell の配送のワークフローの凄さを実感した。デスクトップマシンを注文して1週間ぐらいで来たらいいと普通の感覚で思っていたら翌日なんやもんな。24時間も経ってなかったしな。</p><p>グラフィックボードからモニタに接続しようとしたら4つのインターフェースのうち3つが displayport で1つが hdmi になっていた。いまどきは displayport が主流なんやね。そんなことすらも知らなくて変換アダプタ買わないととか思っていたら、モニターも displayport をもっていて、モニターの箱にも displayport ケーブルが同梱されていて、そのまま接続できることに気付いた。3年ぐらいでマシンを買い替えないとハードウェアのデバイスの変更にもついていけないのだなということも実感した。</p><p>私はもう世の中についていけてなくて、たまに普段やらないことをやるとそこで起きることに驚いて右往左往している。windows を起動して dell update から bios やファームウェアを最新のもの更新したりしていた。windows 上からダウンロードして設定して、再起動時に自動的に bios の更新がかかるような振る舞いをする。uefi のなせる技なんだろうけど、こういうところにも驚いて感心したりする。</p><p>ubuntu 22.04.02 が 4.8GiB あって dvd-r にぎりぎりおさまらない。もう dvd-r でもインストールメディアを作ることができなくなったんやなと気付く。22.04.01 は 3.6 GiB なので1つ前のバージョンをインストールしてアップグレードすればいいかとやってみたらブート時に次のようなエラーになった。</p><blockquote><p>Verification failed:(0x1A) Security Violation</p></blockquote><p>bios に secure boot 機能なるものがあって 22.04.01 ではインストールできないように署名チェックが行われるらしい。古いディストリビューションをインストールするには secure boot を一時的に無効にするしかなさそう。</p><ul><li><a href=https://askubuntu.com/questions/1456460/verification-failed-0x1a-security-violation-while-installing-ubuntu>https://askubuntu.com/questions/1456460/verification-failed-0x1a-security-violation-while-installing-ubuntu</a></li></ul></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0322/>プライベートリポジトリの go アプリケーションの依存解決</a></h1><div class=post-meta><span class=post-date>2023-03-22 (Wed.)</span></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/ci/cd/>ci/cd</a>&nbsp;
#<a href=/diary/tags/coworking/>coworking</a>&nbsp;
#<a href=/diary/tags/event/>event</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#gomod-のプライベートリポジトリの依存解決>go.mod のプライベートリポジトリの依存解決</a></li><li><a href=#コワーキングのオンラインイベント>コワーキングのオンラインイベント</a></li></ul></nav></div><div class=post-content><p>0時に寝て6時半に起きた。面倒なお仕事を朝から集中して片づけた。</p><h2 id=gomod-のプライベートリポジトリの依存解決>go.mod のプライベートリポジトリの依存解決</h2><p>非公開のプライベートリポジトリで開発している go アプリケーションを他のリポジトリから依存ライブラリとして使う方法を調べた。go modules は基本的に公開されたパブリックなリポジトリを前提としている。go.mod のワークフローで他の依存ライブラリと同様にバージョン管理ができるようにするには、プライベートリポジトリであることを go.mod に認識させ、トークンなどを使って認証する必要がある。</p><p><a href=https://go.dev/doc/go1.13>go 1.13</a> から <code>GOPROXY</code> と <code>GOPRIVATE</code> という環境変数が追加された。デフォルトでは GOPROXY は <a href=https://proxy.golang.org>https://proxy.golang.org</a> に設定されており、このプロキシサーバー経由で依存ライブラリを取得する。これは公開リポジトリを、ある日、作者が急に削除したり非公開にしたときにビルドできないといった問題を防ぐために依存ライブラリのリポジトリをキャッシュしてくれる役割を担っている。</p><p>一方でインターネット上のプロキシサーバーからはプライベートリポジトリへアクセスできないので <code>GOPRIVATE</code> を設定してアクセスできないサイトを go.mod へ教えてあげる必要がある。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ go env -w GOPRIVATE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;private.repo.jp&#34;</span>
</span></span><span style=display:flex><span>$ go env | grep GOPRIVATE
</span></span><span style=display:flex><span>GOPRIVATE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;private.repo.jp&#34;</span>
</span></span></code></pre></div><p>通常 go.mod は https で依存ライブラリをリポジトリから取得 (クローン) しようとする。このときに git の設定を変更することで特定のサイトへのアクセスを ssh 経由に変更できる。次の例では <code>https://private.repo.jp</code> へのアクセスをすべて <code>ssh://git@private.repo.jp</code> でクローンできる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ git config --global url.<span style=color:#e6db74>&#34;ssh://git@private.repo.jp&#34;</span>.insteadOf <span style=color:#e6db74>&#34;https://private.repo.jp&#34;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>$ tail -n <span style=color:#ae81ff>2</span> ~/.gitconfig
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>url <span style=color:#e6db74>&#34;ssh://git@gitlab.osstech.co.jp&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>        insteadOf <span style=color:#f92672>=</span> https://gitlab.osstech.co.jp
</span></span></code></pre></div><p>これで git リポジトリのクローンは ssh で行われるようになるが、go.mod のワークフローでは https でもアクセスする処理があるようにみえる。https でもアクセスできるように PAT などのトークンを取得して次のように <code>~/.netrc</code> に https でプライベートリポジトリへアクセスするための認証設定を追加する。</p><pre tabindex=0><code>machine private.repo.jp
login t2y 
password ${PERSONAL_ACCESS_TOKEN}
</code></pre><ul><li><a href=https://www.digitalocean.com/community/tutorials/how-to-use-a-private-go-module-in-your-own-project>How to Use a Private Go Module in Your Own Project</a></li><li><a href=https://erwinvaneyk.nl/private-repositories-with-go-mod/>How to use private repositories with Go modules</a></li></ul><h2 id=コワーキングのオンラインイベント>コワーキングのオンラインイベント</h2><p>月例のカフーツさんのオンラインイベントに参加した。<a href=/diary/posts/2023/0215/#コワーキングのオンラインイベント>先月の所感はここ</a> 。いとうさんの近況を把握していないが、どうやらバリ島 (インドネシア) のコワーキングスペースをいくつか訪問してきたらしい。その旅程を写真をみながらふりかえるようなイベントだった。バリ島の自然や建物の雰囲気が伺えてとてもおもしろかった。</p><p>いとうさんからバリ島はデジタルノマドの先進的な取り組みをしているように聞いていた。例えば <a href=https://cosmicalz.com/indonesianomadvisaunderconsideration>バリ島でリモートも可能!?インドネシアのノマドビザは最長5年を検討中</a> にあるように最長5年のビザを用意しているという話しが日本で盛り上がっているが、現地ではまだ正式にそのようなビザがあるようには存在が確認されていないらしい。それに近い長期のビザを取得するには、一定の金融資産があることを証明しないといけないらしく、日本円だと数千万円程度ないとビザを取得できないのではないか？といった話題もあったと思う。基本的にインドネシア政府は海外から金持ちを呼び込みたいらしく、金持ち向けに待遇のよいビザを整備するのではないかとのこと。ビザの話しはともかく、ここ2-3年でバリ島のコワーキングスペースもいくつか廃業しているらしい。それは利用者の大半が外国人であったため、コロナ禍により、インドネシア政府からの要請もあって外国人に帰国を促したという。外国人利用者の半分ぐらいが自分たちの国に帰ってしまい、施設の運用コストを維持できなくなった。バリ島は今後の成長が見込まれていることから数年前から外資が入ってきて土地や家賃が急騰しているために利用者が激減すると運用コストを維持できなくなったとのこと。</p><p>肝心のバリ島のコワーキングスペースの雰囲気を聞いていると、利用者は外国人が大半で、感覚的にはヨーロッパから来ている人が多そうだといとうさんが話された。バリ島のコワーキングスペースでいとうさんが見学していたときには、現地の人たちと外国人のコミュニティが活発に活動しているようにはあまりみえなかったらしい。利用者もそう多くはなかったし、その人たちも静かにただ作業しているだけのように映ったという。いとうさんはコワーキングスペースとはコミュニティやコラボレーションが重要という話しをよくしているけれど、バリ島のコワーキングスペースに関しては裕福な外国のデジタルノマドを呼び込むのに成功しただけのような、もしかしたらコロナ禍でそのコミュニティが破壊されてしまったのかもしれないが、普段このイベントで話しているような高い期待値に応えられるような状況ではないようにみえたという。</p><p>とはいえ、日本の田舎よりは遥かにデジタルノマドが集まる場所として世界的に認知されているところなので写真をみながら私もいつか行ってみたいと思えた。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0321/>出張所オフィスの準備</a></h1><div class=post-meta><span class=post-date>2023-03-21 (Tue.)</span></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#駐車場の契約書作成>駐車場の契約書作成</a></li><li><a href=#ツールの開発とリファクタリング>ツールの開発とリファクタリング</a></li><li><a href=#実家の出張所オフィスの準備>実家の出張所オフィスの準備</a></li></ul></nav></div><div class=post-content><p>1時に寝て7時に起きて朝だらだらして9時過ぎからオフィスへ行って軽くお仕事をしていた。</p><h2 id=駐車場の契約書作成>駐車場の契約書作成</h2><p>午前中に駐車場の契約書を作成して送付した。管理会社さんとやり取りしたときに <a href=/diary/posts/2023/0105/#駐車場の契約と保管場所使用承諾証明書の手配>保管場所使用承諾証明書</a> を即日作ってくれてスムーズに納車できた。その駐車場の契約書をいま手続きしている。便宜を図ってもらって感謝。週末から車を動かした方がよいなと思いつつ、雨降りでタイミングが悪く出掛けるのに億劫になっている。</p><h2 id=ツールの開発とリファクタリング>ツールの開発とリファクタリング</h2><p>いつも通り3時間ほどお仕事していた。時間はたった3時間だけど、割り込みが入らないことがわかっているので開発に集中できて生産性は高い。issue を3つほど fix して区切りがよかったので夕方には家に帰ってお昼ご飯を作ってのんびりしていた。</p><h2 id=実家の出張所オフィスの準備>実家の出張所オフィスの準備</h2><p>親とやり取りしていて、出張所のオフィスとするための部屋にエアコンとインターネットの回線を繋ごうといった話しをしていた。エアコンは14畳のやや大きいものを購入しないといけない。工事に来てもらわないといけないので近所の量販店で信頼できるメーカーの製品を買った方がよいだろうと話していて、いま実家で取り付けしているエアコンのメーカーを聞いたらダイキンだという。日本の会社だったらまぁいっかと思ってダイキンでいいんちゃうと返しておいた。インターネット回線もスマートフォンのキャリアとセットにした方が割引で安くなるからショップ行って聞いてみたら教えてくれるだろうと伝えておいた。これを伝えてから実際に購入するまで何ヶ月かかるのかはわからないが。</p><blockquote class=twitter-tweet><p lang=ja dir=ltr>親とエアコンを買う話しをしていて、いまどこのメーカーを使っているのか聞いたらダイキンと返ってきて、ダイキンってビルの大きい空調やと思っていたら普通に家庭用のエアコンも販売していたんやね。知らんかった。</p>&mdash; Tetsuya Morimoto (@t2y) <a href="https://twitter.com/t2y/status/1638046291291947017?ref_src=twsrc%5Etfw">March 21, 2023</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0320/>リファクタリングにはまった</a></h1><div class=post-meta><span class=post-date>2023-03-20 (Mon.)</span></div><span class=post-tags>#<a href=/diary/tags/go/>go</a>&nbsp;
#<a href=/diary/tags/ldap/>ldap</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#go-のシリアライズデシリアライズとポインタ>go のシリアライズ/デシリアライズとポインタ</a></li></ul></nav></div><div class=post-content><p>2時に寝て変な夢をみて何度か起きて7時に起きた。いつも通りな感じ。</p><h2 id=go-のシリアライズデシリアライズとポインタ>go のシリアライズ/デシリアライズとポインタ</h2><p><a href=/diary/posts/2023/0306/#ldap-の-dn-の仕様>ldap の distinguished name (以下dn) をパース</a> するときはエスケープを扱う必要があるのでわりとややこしいのでライブラリを使った方がよいことを前回学んだ。</p><p>複数の web api で dn を扱っていると、それぞれで dn をパースして正規化した形で扱わないと大文字小文字の表記揺れなどに対応できなくて困るということに気付いた。いや、前回もうっすら気付いていたのだけど、既存の api はすべて対応しているからいいかなと楽観的に考えていた。すると、たまたま新規に dn を扱う web api を作ったときに正規化を忘れていることに気付いた。今後の保守や拡張を考慮すると、dn を <code>string</code> 型として扱うのは潜在的に正規化漏れの懸念があることからよくないと理解できた。そのため、既存のリクエストで受け取る dn を特別な型として必ず正規化して扱えるようにリファクタリングすることにした。あちこち直す必要はあったが、幸いにも単体テストも結合テストもそこそこあるのでバグっていればテストが落ちることで不具合には気付けるようになっていた。</p><p><a href=https://pkg.go.dev/encoding/json>encoding/json</a> に Marshaler/Unmarshaler のインターフェースが定義されているのでそれぞれのメソッドを実装する必要がある。DNParameter の値を json にシリアライズするときは値レシーバで MarshalJSON メソッドを実装し、デシリアライズするときはポインタレシーバで UnmarshalJSON メソッドを実装しないと json ライブラリで意図した振る舞いにならないようにみえる。ここで UnmarshalJSON するときに byte 列から一旦 json の文字列に変換 (引用符を外す) してから <code>ldap.ParseDN()</code> しないといけない処理を直接 <code>string</code> 型に変換する誤ったコードを書いてしまって、この誤りに気付くのに1-2時間はまってしまった。</p><ul><li>誤ったコード</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>DNParameter</span>) <span style=color:#a6e22e>UnmarshalJSON</span>(<span style=color:#a6e22e>data</span> []<span style=color:#66d9ef>byte</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>dn</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ldap</span>.<span style=color:#a6e22e>ParseDN</span>(string(<span style=color:#a6e22e>data</span>))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		(<span style=color:#f92672>*</span><span style=color:#a6e22e>p</span>).<span style=color:#a6e22e>Value</span> = <span style=color:#a6e22e>dn</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span></code></pre></div><ul><li>正しいコード</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>DNParameter</span>) <span style=color:#a6e22e>UnmarshalJSON</span>(<span style=color:#a6e22e>data</span> []<span style=color:#66d9ef>byte</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>s</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>data</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>s</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;dn should be a string&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>dn</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ldap</span>.<span style=color:#a6e22e>ParseDN</span>(<span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		(<span style=color:#f92672>*</span><span style=color:#a6e22e>p</span>).<span style=color:#a6e22e>Value</span> = <span style=color:#a6e22e>dn</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span></code></pre></div><p>このときに引用符を ldap のパーサーがエスケープした形で扱えてしまい、テストは失敗するけれど、見た目がほとんど同じ文字列で動いてしまうのにはまった。引用符がエスケープされてテストが落ちることには気付いたものの、どこの処理が問題なのかが分からなくてはまっていた。おそらくスクラッチからこの仕様でコードを書いていたらすぐに気付いたと思えるが、リファクタリングであちこち書き換えていたからどこの処理が誤っているのかの切り分けに時間がかかった。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0319/>予算作り</a></h1><div class=post-meta><span class=post-date>2023-03-19 (Sun.)</span></div><span class=post-tags>#<a href=/diary/tags/founding/>founding</a>&nbsp;
#<a href=/diary/tags/accounting/>accounting</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#来季の予算策定>来季の予算策定</a></li></ul></nav></div><div class=post-content><p>1時に寝て夜中に気分が悪くて何度も起きて吐き気と戦いながら7時に起きた。なぜか体調がよくなかった。</p><h2 id=来季の予算策定>来季の予算策定</h2><p>いつもは3月の上旬には出来ていて、外部の有識者にレビューしてもらって雑談したり意見をもらったりしているところが、今期は納期に追われていてまだ何もできていない。ひとまず来季の予算策定から着手した。ざっくり算出すると来季は数百万の赤字になる。数字をみるのが嫌になる。半年ほどで受託開発を辞めてプロダクト開発へ移行する年にしていこうという展望はある。とはいえ、お客さんがいることなので私がいなくなっても開発が問題ない状況に調整してからの話しにはなる。なるべくそれを半年以内に完了させて自社のプロダクト開発へ移行していければよいと考えている。が、そんなうまく予定が進むかどうかはわからない。事業の移行が遅れて受託開発期間が伸びればその分の赤字は減るので会社の財務的にはその方がよいという見方もできる。</p><p>本当は来期から役員報酬を半減させて社会保険料も下げて3年間ほどプロダクト開発に投資しようと考えていた。会社も個人も3年ぐらい遊んでいても支障のない程度の蓄えができた。おそらく私の人生において挑戦するのはこれが最後の機会になるだろう。この挑戦が終わったら私の人生は十分かなと思う。<a href=/diary/posts/2022/1226/>父の介護を完了</a> して、いずれ母の介護が必要な時期も来るだろう。来季は実家に出張所のオフィスも作る予定。<a href=/diary/posts/2023/0104/#社用車の購入相談>社用車</a> を購入して神戸と淡路島の行き来もしやすくなった。淡路島で業務できるようになれば実家で田んぼしながら開発に注力する時期なんかもあるかもしれない。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0318/>gpt-4 に課金した</a></h1><div class=post-meta><span class=post-date>2023-03-18 (Sat.)</span></div><span class=post-tags>#<a href=/diary/tags/life/>life</a>&nbsp;
#<a href=/diary/tags/gpt/>gpt</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#ストレッチ>ストレッチ</a></li><li><a href=#gpt-4-談義>gpt-4 談義</a></li></ul></nav></div><div class=post-content><p>1時に寝て8時に起きた。昨日は久しぶりに飲みに行ってきてよい気分で寝た。</p><h2 id=ストレッチ>ストレッチ</h2><p>今日の開脚幅は開始前154cmで、ストレッチ後158cmだった。すねの外側の筋は大分よくなって通常の状態に近くなってきたと思う。今日の張りが強かったところは右股関節の内側と右腰になる。これまでもずっとよくない部分ではあるが、いつも体調に戻ってきたという見方もできる。あと右のお尻の後ろの筋もやや張りが強い気がした。2月中旬から納期に間に合わせるためにいくつかズルをしてきたところの埋め合わせというか、体調管理をこれから少しずつやっていく。結果的にその方が日々の活動のパフォーマンスが高くなる気がする。</p><h2 id=gpt-4-談義>gpt-4 談義</h2><p>タイムラインをみていると <a href=https://openai.com/research/gpt-4>GPT-4</a> がすごいという投稿が散見されるので課金して使ってみることにした。$20/月なので十分に安いと思う。会社のお金を自由にできると、技術調査や業務に関することの決済を即決できる。これは経験を積んでお金をかけるところとそうではないところに一家言もつようになってくるとそのストレスの度合いも違ってくる。まだ使い始めたばかりなので技術調査をするときにググる代わりに gpt-4 に尋ねて回答を確認するといった使い方しかしていない。具体的に言うとどう使ったらいいのかわからないので誰でもやる使い方から慣れていって、そのうちにもっと幅広い応用に気付くようになったらいい。</p><p>タイムラインをみてもどう使ったらいいかをあーだこーだと議論しているようにみえる。次の資料をみていて、対話形式というのは人間の質問や誤りの指摘をアノテーションとして gpt-4 はより正しい言葉選びをしているとある。ドメイン知識がある人が品質の高いアウトプットを得られるというのは、アノテーションを正しく gpt-4 に与えてあげないといけないという理屈で理解できた。</p><ul><li><a href=https://speakerdeck.com/eumesy/chatgpt-and-intro-of-ot-for-nlp>ChatGPT と自然言語処理 / 言語の意味の計算と最適輸送</a></li></ul><p>アノテーションの与え方が従来の検索のように lang=go のように構造化されたパラメーター指定ではなく、自然言語のまま非構造化データで与えられるというのが、従来の検索よりも進化したとも受け取れる。一方で gpt-4 に質問して文章を生成するのに1-2分かかるのでその待ち時間は検索よりも体験が悪い。私が大学のときはインターネット検索というのが普及し始めた時期だったから「どうやってその情報をみつけたの？」「検索するときにコツがあるんですよ」みたいな会話がよく聞かれた。いま gpt-4 を使っていて、その時代と同じような既視感を覚える。</p></div></div><div class="post on-list"><h1 class=post-title><a href=/diary/posts/2023/0317/>syncrepl ことはじめ</a></h1><div class=post-meta><span class=post-date>2023-03-17 (Fri.)</span></div><span class=post-tags>#<a href=/diary/tags/ldap/>ldap</a>&nbsp;
#<a href=/diary/tags/go/>go</a>&nbsp;</span><div class=table-of-contents><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#openldap-の-syncrepl>openldap の syncrepl</a></li></ul></nav></div><div class=post-content><p>1時に寝て5時に起きて7時に起きた。</p><h2 id=openldap-の-syncrepl>openldap の syncrepl</h2><p>openldap サーバー同士のレプリケーションの仕組みとして syncrepl (LDAP Sync Replication) と呼ばれる仕組みがある。experimental ではあるものの、仕様は rfc で提案されていてオープンになっている。実際には openldap サーバー (slapd) で実装されている参照実装が仕様みたいなものかもしれない。</p><ul><li><a href=https://www.rfc-editor.org/rfc/rfc4533.html>rfc-4533</a></li><li><a href=https://www.openldap.org/doc/admin25/replication.html>18. Replication</a></li></ul><p>既存の java のアプリケーションで syncrepl の機能を使うツールがあって、ソースコードを読むとかなりレガシーで、もっと言うと設計はひどく、コードも推定バグのような実装をみかけるのであまり使いたくない。go-ldap で syncrepl できれば作り直してしまえばよいのではないかと考えている。ドキュメントには provider (master) と consumer (slave) という用語で説明されているので pubsub に近いような仕組みで実装されているのではないかと推測する。slapd は provider にも consumer にもなる可能性があるのでどちらの実装ももっている。私がやりたいことは更新エントリを取得したいだけなので go-ldap で consumer として振る舞うモジュールのみを作ればよい。</p><p>基本的には openldap サーバーに接続して bind して、syncrepl に準拠したやり取りをすればよいのでそんな難しそうにはみえない。いくつかの定型的な通信の実装をすれば consumer ができるのではないかと思う。go-ldap のソースを grep してみる分には特別な機能はなさそうにみえる。ないならないで私が作ってもいいし、このライブラリでやらない方がよい背景があるのであれば、それに従う。ひとまず背景がわかっていないので issue を立てて聞いてみた。</p><ul><li><a href=https://github.com/go-ldap/ldap/issues/422>About implementing syncrepl (rfc-4533) consumer #422</a></li></ul></div></div><div class=pagination><div class=pagination__buttons><a href=/diary/page/41/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>最近の日記</span></a>
<a href=/diary/page/43/ class="button next"><span class=button__text>過去の日記</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2021 Tetsuya Morimoto</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/diary/bundle.min.js></script></div></body></html>